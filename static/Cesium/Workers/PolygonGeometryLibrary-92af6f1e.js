define(["exports","./ArcType-29cf2197","./arrayRemoveDuplicates-d2f048c5","./Cartesian2-47311507","./Cartographic-3309dd0d","./ComponentDatatype-c140a87d","./when-b60132fc","./EllipsoidRhumbLine-ed1a6bf4","./GeometryAttribute-3a88ba31","./GeometryAttributes-252e9929","./GeometryPipeline-9d1ef0b6","./IndexDatatype-8a5eead4","./Math-119be1a3","./PrimitiveType-a54dc62f","./PolygonPipeline-660e1625"],(function(e,t,r,i,a,n,o,s,u,l,h,c,f,p,d){"use strict";function y(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(y.prototype,{length:{get:function(){return this._length}}}),y.prototype.enqueue=function(e){this._array.push(e),this._length++},y.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,r=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,r}},y.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},y.prototype.contains=function(e){return-1!==this._array.indexOf(e)},y.prototype.clear=function(){this._array.length=this._offset=this._length=0},y.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var g={computeHierarchyPackedLength:function(e){for(var t=0,r=[e];r.length>0;){var i=r.pop();if(o.defined(i)){t+=2;var n=i.positions,s=i.holes;if(o.defined(n)&&(t+=n.length*a.Cartesian3.packedLength),o.defined(s))for(var u=s.length,l=0;l<u;++l)r.push(s[l])}}return t},packPolygonHierarchy:function(e,t,r){for(var i=[e];i.length>0;){var n=i.pop();if(o.defined(n)){var s=n.positions,u=n.holes;if(t[r++]=o.defined(s)?s.length:0,t[r++]=o.defined(u)?u.length:0,o.defined(s))for(var l=s.length,h=0;h<l;++h,r+=3)a.Cartesian3.pack(s[h],t,r);if(o.defined(u))for(var c=u.length,f=0;f<c;++f)i.push(u[f])}}return r},unpackPolygonHierarchy:function(e,t){for(var r=e[t++],i=e[t++],n=new Array(r),o=i>0?new Array(i):void 0,s=0;s<r;++s,t+=a.Cartesian3.packedLength)n[s]=a.Cartesian3.unpack(e,t);for(var u=0;u<i;++u)o[u]=g.unpackPolygonHierarchy(e,t),t=o[u].startingIndex,delete o[u].startingIndex;return{positions:n,holes:o,startingIndex:t}}},v=new a.Cartesian3;function m(e,t,r,i){return a.Cartesian3.subtract(t,e,v),a.Cartesian3.multiplyByScalar(v,r/i,v),a.Cartesian3.add(e,v,v),[v.x,v.y,v.z]}g.subdivideLineCount=function(e,t,r){var i=a.Cartesian3.distance(e,t)/r,n=Math.max(0,Math.ceil(f.CesiumMath.log2(i)));return Math.pow(2,n)};var C=new a.Cartographic,b=new a.Cartographic,w=new a.Cartographic,I=new a.Cartesian3;g.subdivideRhumbLineCount=function(e,t,r,i){var a=e.cartesianToCartographic(t,C),n=e.cartesianToCartographic(r,b),o=new s.EllipsoidRhumbLine(a,n,e).surfaceDistance/i,u=Math.max(0,Math.ceil(f.CesiumMath.log2(o)));return Math.pow(2,u)},g.subdivideLine=function(e,t,r,i){var n=g.subdivideLineCount(e,t,r),s=a.Cartesian3.distance(e,t),u=s/n;o.defined(i)||(i=[]);var l=i;l.length=3*n;for(var h=0,c=0;c<n;c++){var f=m(e,t,c*u,s);l[h++]=f[0],l[h++]=f[1],l[h++]=f[2]}return l},g.subdivideRhumbLine=function(e,t,r,i,a){var n=e.cartesianToCartographic(t,C),u=e.cartesianToCartographic(r,b),l=new s.EllipsoidRhumbLine(n,u,e),h=l.surfaceDistance/i,c=Math.max(0,Math.ceil(f.CesiumMath.log2(h))),p=Math.pow(2,c),d=l.surfaceDistance/p;o.defined(a)||(a=[]);var y=a;y.length=3*p;for(var g=0,v=0;v<p;v++){var m=l.interpolateUsingSurfaceDistance(v*d,w),T=e.cartographicToCartesian(m,I);y[g++]=T.x,y[g++]=T.y,y[g++]=T.z}return y};var T=new a.Cartesian3,E=new a.Cartesian3,P=new a.Cartesian3,x=new a.Cartesian3;g.scaleToGeodeticHeightExtruded=function(e,t,r,n,s){n=o.defaultValue(n,i.Ellipsoid.WGS84);var u=T,l=E,h=P,c=x;if(o.defined(e)&&o.defined(e.attributes)&&o.defined(e.attributes.position))for(var f=e.attributes.position.values,p=f.length/2,d=0;d<p;d+=3)a.Cartesian3.fromArray(f,d,h),n.geodeticSurfaceNormal(h,u),c=n.scaleToGeodeticSurface(h,c),l=a.Cartesian3.multiplyByScalar(u,r,l),l=a.Cartesian3.add(c,l,l),f[d+p]=l.x,f[d+1+p]=l.y,f[d+2+p]=l.z,s&&(c=a.Cartesian3.clone(h,c)),l=a.Cartesian3.multiplyByScalar(u,t,l),l=a.Cartesian3.add(c,l,l),f[d]=l.x,f[d+1]=l.y,f[d+2]=l.z;return e},g.polygonOutlinesFromHierarchy=function(e,t,i){var n,s,u,l=[],h=new y;for(h.enqueue(e);0!==h.length;){var c=h.dequeue(),f=c.positions;if(t)for(u=f.length,n=0;n<u;n++)i.scaleToGeodeticSurface(f[n],f[n]);if(!((f=r.arrayRemoveDuplicates(f,a.Cartesian3.equalsEpsilon,!0)).length<3)){var p=c.holes?c.holes.length:0;for(n=0;n<p;n++){var d=c.holes[n],g=d.positions;if(t)for(u=g.length,s=0;s<u;++s)i.scaleToGeodeticSurface(g[s],g[s]);if(!((g=r.arrayRemoveDuplicates(g,a.Cartesian3.equalsEpsilon,!0)).length<3)){l.push(g);var v=0;for(o.defined(d.holes)&&(v=d.holes.length),s=0;s<v;s++)h.enqueue(d.holes[s])}}l.push(f)}}return l};var _=new a.Cartesian3(6378137,6378137,6378137);g.polygonsFromHierarchy=function(e,t,i,n){var s=[],u=[],l=new y;for(l.enqueue(e);0!==l.length;){var h,c,p,g=l.dequeue(),v=g.positions,m=g.holes,C=v.slice();if(i)for(c=v.length,h=0;h<c;h++)n.scaleToGeodeticSurface(v[h],C[h]);if(o.defined(n)&&!a.Cartesian3.equals(n._radii,_)&&(p=f.CesiumMath.EPSILON7),!((v=r.arrayRemoveDuplicates(C,a.Cartesian3.equalsEpsilon,!0,p)).length<3)){var b=t(v);if(o.defined(b)){var w=[],I=d.PolygonPipeline.computeWindingOrder2D(b);I===d.WindingOrder.CLOCKWISE&&(b.reverse(),v=v.slice().reverse());var T,E=v.slice(),P=o.defined(m)?m.length:0,x=[];for(h=0;h<P;h++){var A=m[h],L=A.positions;if(i)for(c=L.length,T=0;T<c;++T)n.scaleToGeodeticSurface(L[T],L[T]);if(!((L=r.arrayRemoveDuplicates(L,a.Cartesian3.equalsEpsilon,!0,f.CesiumMath.EPSILON7)).length<3)){var M=t(L);if(o.defined(M)){(I=d.PolygonPipeline.computeWindingOrder2D(M))===d.WindingOrder.CLOCKWISE&&(M.reverse(),L=L.slice().reverse()),x.push(L),w.push(E.length),E=E.concat(L),b=b.concat(M);var G=0;for(o.defined(A.holes)&&(G=A.holes.length),T=0;T<G;T++)l.enqueue(A.holes[T])}}}s.push({outerRing:v,holes:x}),u.push({positions:E,positions2D:b,holes:w})}}}return{hierarchy:s,polygons:u}};var A=new i.Cartesian2,L=new a.Cartesian3,M=new u.Quaternion,G=new p.Matrix3;g.computeBoundingRectangle=function(e,t,r,i,n){for(var s=u.Quaternion.fromAxisAngle(e,i,M),l=p.Matrix3.fromQuaternion(s,G),h=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,y=r.length,g=0;g<y;++g){var v=a.Cartesian3.clone(r[g],L);p.Matrix3.multiplyByVector(l,v,v);var m=t(v,A);o.defined(m)&&(h=Math.min(h,m.x),c=Math.max(c,m.x),f=Math.min(f,m.y),d=Math.max(d,m.y))}return n.x=h,n.y=f,n.width=c-h,n.height=d-f,n},g.createGeometryFromPositions=function(e,r,i,a,o,s){var l=d.PolygonPipeline.triangulate(r.positions2D,r.holes);l.length<3&&(l=[0,1,2]);var c=r.positions;if(a){for(var f=c.length,y=new Array(3*f),g=0,v=0;v<f;v++){var m=c[v];y[g++]=m.x,y[g++]=m.y,y[g++]=m.z}var C=new u.Geometry({attributes:{position:new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:y})},indices:l,primitiveType:p.PrimitiveType.TRIANGLES});return o.normal?h.GeometryPipeline.computeNormal(C):C}return s===t.ArcType.GEODESIC?d.PolygonPipeline.computeSubdivision(e,c,l,i):s===t.ArcType.RHUMB?d.PolygonPipeline.computeRhumbLineSubdivision(e,c,l,i):void 0};var S=[],D=new a.Cartesian3,N=new a.Cartesian3;g.computeWallGeometry=function(e,r,i,o,s){var h,d,y,v,m,C=e.length,b=0;if(o)for(d=3*C*2,h=new Array(2*d),y=0;y<C;y++)v=e[y],m=e[(y+1)%C],h[b]=h[b+d]=v.x,h[++b]=h[b+d]=v.y,h[++b]=h[b+d]=v.z,h[++b]=h[b+d]=m.x,h[++b]=h[b+d]=m.y,h[++b]=h[b+d]=m.z,++b;else{var w=f.CesiumMath.chordLength(i,r.maximumRadius),I=0;if(s===t.ArcType.GEODESIC)for(y=0;y<C;y++)I+=g.subdivideLineCount(e[y],e[(y+1)%C],w);else if(s===t.ArcType.RHUMB)for(y=0;y<C;y++)I+=g.subdivideRhumbLineCount(r,e[y],e[(y+1)%C],w);for(d=3*(I+C),h=new Array(2*d),y=0;y<C;y++){var T;v=e[y],m=e[(y+1)%C],s===t.ArcType.GEODESIC?T=g.subdivideLine(v,m,w,S):s===t.ArcType.RHUMB&&(T=g.subdivideRhumbLine(r,v,m,w,S));for(var E=T.length,P=0;P<E;++P,++b)h[b]=T[P],h[b+d]=T[P];h[b]=m.x,h[b+d]=m.x,h[++b]=m.y,h[b+d]=m.y,h[++b]=m.z,h[b+d]=m.z,++b}}C=h.length;var x=c.IndexDatatype.createTypedArray(C/3,C-6*e.length),_=0;for(C/=6,y=0;y<C;y++){var A=y,L=A+1,M=A+C,G=M+1;v=a.Cartesian3.fromArray(h,3*A,D),m=a.Cartesian3.fromArray(h,3*L,N),a.Cartesian3.equalsEpsilon(v,m,f.CesiumMath.EPSILON10,f.CesiumMath.EPSILON10)||(x[_++]=A,x[_++]=M,x[_++]=L,x[_++]=L,x[_++]=M,x[_++]=G)}return new u.Geometry({attributes:new l.GeometryAttributes({position:new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:h})}),indices:x,primitiveType:p.PrimitiveType.TRIANGLES})},e.PolygonGeometryLibrary=g}));
