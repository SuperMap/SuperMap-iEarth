define(["exports","./Cartesian3-3a8bdb0b","./Cartographic-a2c313d7","./when-92c6cf3c","./Check-52a7d806","./buildModuleUrl-9eef8841","./Math-ecf82623","./FeatureDetection-cec0163f"],(function(e,r,t,n,i,o,a,u){"use strict";var s={};function f(e,r,t){var n=e+r;return a.e.sign(e)!==a.e.sign(r)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(r)))<t?0:n}s.computeDiscriminant=function(e,r,t){if("number"!=typeof e)throw new i.t("a is a required number.");if("number"!=typeof r)throw new i.t("b is a required number.");if("number"!=typeof t)throw new i.t("c is a required number.");return r*r-4*e*t},s.computeRealRoots=function(e,r,t){if("number"!=typeof e)throw new i.t("a is a required number.");if("number"!=typeof r)throw new i.t("b is a required number.");if("number"!=typeof t)throw new i.t("c is a required number.");var n;if(0===e)return 0===r?[]:[-t/r];if(0===r){if(0===t)return[0,0];var o=Math.abs(t),u=Math.abs(e);if(o<u&&o/u<a.e.EPSILON14)return[0,0];if(o>u&&u/o<a.e.EPSILON14)return[];if((n=-t/e)<0)return[];var s=Math.sqrt(n);return[-s,s]}if(0===t)return(n=-r/e)<0?[n,0]:[0,n];var c=f(r*r,-(4*e*t),a.e.EPSILON14);if(c<0)return[];var w=-.5*f(r,a.e.sign(r)*Math.sqrt(c),a.e.EPSILON14);return r>0?[w/e,t/w]:[t/w,w/e]};var c={};function w(e,r,t,n){var i,o,a=e,u=r/3,s=t/3,f=n,c=a*s,w=u*f,h=u*u,l=s*s,d=a*s-h,p=a*f-u*s,m=u*f-l,b=4*d*m-p*p;if(b<0){var g,v,q;h*w>=c*l?(g=a,v=d,q=-2*u*d+a*p):(g=f,v=m,q=-f*p+2*s*m);var M=-(q<0?-1:1)*Math.abs(g)*Math.sqrt(-b),y=(o=-q+M)/2,R=y<0?-Math.pow(-y,1/3):Math.pow(y,1/3),S=o===M?-R:-v/R;return i=v<=0?R+S:-q/(R*R+S*S+v),h*w>=c*l?[(i-u)/a]:[-f/(i+s)]}var O=d,P=-2*u*d+a*p,N=m,L=-f*p+2*s*m,$=Math.sqrt(b),E=Math.sqrt(3)/2,I=Math.abs(Math.atan2(a*$,-P)/3);i=2*Math.sqrt(-O);var C=Math.cos(I);o=i*C;var x=i*(-C/2-E*Math.sin(I)),z=o+x>2*u?o-u:x-u,U=a,T=z/U;I=Math.abs(Math.atan2(f*$,-L)/3);var W=-f,B=(o=(i=2*Math.sqrt(-N))*(C=Math.cos(I)))+(x=i*(-C/2-E*Math.sin(I)))<2*s?o+s:x+s,Z=W/B,D=-z*B-U*W,V=(s*D-u*(z*W))/(-u*D+s*(U*B));return T<=V?T<=Z?V<=Z?[T,V,Z]:[T,Z,V]:[Z,T,V]:T<=Z?[V,T,Z]:V<=Z?[V,Z,T]:[Z,V,T]}c.computeDiscriminant=function(e,r,t,n){if("number"!=typeof e)throw new i.t("a is a required number.");if("number"!=typeof r)throw new i.t("b is a required number.");if("number"!=typeof t)throw new i.t("c is a required number.");if("number"!=typeof n)throw new i.t("d is a required number.");var o=r*r,a=t*t;return 18*e*r*t*n+o*a-27*(e*e)*(n*n)-4*(e*a*t+o*r*n)},c.computeRealRoots=function(e,r,t,n){if("number"!=typeof e)throw new i.t("a is a required number.");if("number"!=typeof r)throw new i.t("b is a required number.");if("number"!=typeof t)throw new i.t("c is a required number.");if("number"!=typeof n)throw new i.t("d is a required number.");var o,a;if(0===e)return s.computeRealRoots(r,t,n);if(0===r){if(0===t){if(0===n)return[0,0,0];var u=(a=-n/e)<0?-Math.pow(-a,1/3):Math.pow(a,1/3);return[u,u,u]}return 0===n?0===(o=s.computeRealRoots(e,0,t)).Length?[0]:[o[0],0,o[1]]:w(e,0,t,n)}return 0===t?0===n?(a=-r/e)<0?[a,0,0]:[0,0,a]:w(e,r,0,n):0===n?0===(o=s.computeRealRoots(e,r,t)).length?[0]:o[1]<=0?[o[0],o[1],0]:o[0]>=0?[0,o[0],o[1]]:[o[0],0,o[1]]:w(e,r,t,n)};var h={};function l(e,r,t,n){var i=e*e,o=r-3*i/8,u=t-r*e/2+i*e/8,f=n-t*e/4+r*i/16-3*i*i/256,w=c.computeRealRoots(1,2*o,o*o-4*f,-u*u);if(w.length>0){var h=-e/4,l=w[w.length-1];if(Math.abs(l)<a.e.EPSILON14){var d=s.computeRealRoots(1,o,f);if(2===d.length){var p,m=d[0],b=d[1];if(m>=0&&b>=0){var g=Math.sqrt(m),v=Math.sqrt(b);return[h-v,h-g,h+g,h+v]}if(m>=0&&b<0)return[h-(p=Math.sqrt(m)),h+p];if(m<0&&b>=0)return[h-(p=Math.sqrt(b)),h+p]}return[]}if(l>0){var q=Math.sqrt(l),M=(o+l-u/q)/2,y=(o+l+u/q)/2,R=s.computeRealRoots(1,q,M),S=s.computeRealRoots(1,-q,y);return 0!==R.length?(R[0]+=h,R[1]+=h,0!==S.length?(S[0]+=h,S[1]+=h,R[1]<=S[0]?[R[0],R[1],S[0],S[1]]:S[1]<=R[0]?[S[0],S[1],R[0],R[1]]:R[0]>=S[0]&&R[1]<=S[1]?[S[0],R[0],R[1],S[1]]:S[0]>=R[0]&&S[1]<=R[1]?[R[0],S[0],S[1],R[1]]:R[0]>S[0]&&R[0]<S[1]?[S[0],R[0],S[1],R[1]]:[R[0],S[0],R[1],S[1]]):R):0!==S.length?(S[0]+=h,S[1]+=h,S):[]}}return[]}function d(e,r,t,n){var i=e*e,o=-2*r,u=t*e+r*r-4*n,f=i*n-t*r*e+t*t,w=c.computeRealRoots(1,o,u,f);if(w.length>0){var h,l,d,p,m,b,g=w[0],v=r-g,q=v*v,M=e/2,y=v/2,R=q-4*n,S=q+4*Math.abs(n),O=i-4*g,P=i+4*Math.abs(g);if(g<0||R*P<O*S){var N=Math.sqrt(O);h=N/2,l=0===N?0:(e*y-t)/N}else{var L=Math.sqrt(R);h=0===L?0:(e*y-t)/L,l=L/2}0===M&&0===h?(d=0,p=0):a.e.sign(M)===a.e.sign(h)?p=g/(d=M+h):d=g/(p=M-h),0===y&&0===l?(m=0,b=0):a.e.sign(y)===a.e.sign(l)?b=n/(m=y+l):m=n/(b=y-l);var $=s.computeRealRoots(1,d,m),E=s.computeRealRoots(1,p,b);if(0!==$.length)return 0!==E.length?$[1]<=E[0]?[$[0],$[1],E[0],E[1]]:E[1]<=$[0]?[E[0],E[1],$[0],$[1]]:$[0]>=E[0]&&$[1]<=E[1]?[E[0],$[0],$[1],E[1]]:E[0]>=$[0]&&E[1]<=$[1]?[$[0],E[0],E[1],$[1]]:$[0]>E[0]&&$[0]<E[1]?[E[0],$[0],E[1],$[1]]:[$[0],E[0],$[1],E[1]]:$;if(0!==E.length)return E}return[]}function p(e,t){t=r.o.clone(n.u(t,r.o.ZERO)),r.o.equals(t,r.o.ZERO)||r.o.normalize(t,t),this.origin=r.o.clone(n.u(e,r.o.ZERO)),this.direction=t}h.computeDiscriminant=function(e,r,t,n,o){if("number"!=typeof e)throw new i.t("a is a required number.");if("number"!=typeof r)throw new i.t("b is a required number.");if("number"!=typeof t)throw new i.t("c is a required number.");if("number"!=typeof n)throw new i.t("d is a required number.");if("number"!=typeof o)throw new i.t("e is a required number.");var a=e*e,u=r*r,s=u*r,f=t*t,c=f*t,w=n*n,h=w*n,l=o*o;return u*f*w-4*s*h-4*e*c*w+18*e*r*t*h-27*a*w*w+256*(a*e)*(l*o)+o*(18*s*t*n-4*u*c+16*e*f*f-80*e*r*f*n-6*e*u*w+144*a*t*w)+l*(144*e*u*t-27*u*u-128*a*f-192*a*r*n)},h.computeRealRoots=function(e,r,t,n,o){if("number"!=typeof e)throw new i.t("a is a required number.");if("number"!=typeof r)throw new i.t("b is a required number.");if("number"!=typeof t)throw new i.t("c is a required number.");if("number"!=typeof n)throw new i.t("d is a required number.");if("number"!=typeof o)throw new i.t("e is a required number.");if(Math.abs(e)<a.e.EPSILON15)return c.computeRealRoots(r,t,n,o);var u=r/e,s=t/e,f=n/e,w=o/e,h=u<0?1:0;switch(h+=s<0?h+1:h,h+=f<0?h+1:h,h+=w<0?h+1:h){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return l(u,s,f,w);case 1:case 2:case 5:case 8:case 11:return d(u,s,f,w);default:return}},p.clone=function(e,t){if(n.e(e))return n.e(t)?(t.origin=r.o.clone(e.origin),t.direction=r.o.clone(e.direction),t):new p(e.origin,e.direction)},p.getPoint=function(e,t,o){return i.o.typeOf.object("ray",e),i.o.typeOf.number("t",t),n.e(o)||(o=new r.o),o=r.o.multiplyByScalar(e.direction,t,o),r.o.add(e.origin,o,o)};var m={rayPlane:function(e,t,o){if(!n.e(e))throw new i.t("ray is required.");if(!n.e(t))throw new i.t("plane is required.");n.e(o)||(o=new r.o);var u=e.origin,s=e.direction,f=t.normal,c=r.o.dot(f,s);if(!(Math.abs(c)<a.e.EPSILON15)){var w=(-t.distance-r.o.dot(f,u))/c;if(!(w<0))return o=r.o.multiplyByScalar(s,w,o),r.o.add(u,o,o)}}},b=new r.o,g=new r.o,v=new r.o,q=new r.o,M=new r.o;m.rayTriangleParametric=function(e,t,o,u,s){if(!n.e(e))throw new i.t("ray is required.");if(!n.e(t))throw new i.t("p0 is required.");if(!n.e(o))throw new i.t("p1 is required.");if(!n.e(u))throw new i.t("p2 is required.");s=n.u(s,!1);var f,c,w,h,l,d=e.origin,p=e.direction,m=r.o.subtract(o,t,b),y=r.o.subtract(u,t,g),R=r.o.cross(p,y,v),S=r.o.dot(m,R);if(s){if(S<a.e.EPSILON6||(f=r.o.subtract(d,t,q),(w=r.o.dot(f,R))<0||w>S)||(c=r.o.cross(f,m,M),(h=r.o.dot(p,c))<0||w+h>S))return;l=r.o.dot(y,c)/S}else{if(Math.abs(S)<a.e.EPSILON6)return;var O=1/S;if(f=r.o.subtract(d,t,q),(w=r.o.dot(f,R)*O)<0||w>1||(c=r.o.cross(f,m,M),(h=r.o.dot(p,c)*O)<0||w+h>1))return;l=r.o.dot(y,c)*O}return l},m.rayTriangle=function(e,t,i,o,a,u){var s=m.rayTriangleParametric(e,t,i,o,a);if(n.e(s)&&!(s<0))return n.e(u)||(u=new r.o),r.o.multiplyByScalar(e.direction,s,u),r.o.add(e.origin,u,u)};var y=new p;m.lineSegmentTriangle=function(e,t,o,a,u,s,f){if(!n.e(e))throw new i.t("v0 is required.");if(!n.e(t))throw new i.t("v1 is required.");if(!n.e(o))throw new i.t("p0 is required.");if(!n.e(a))throw new i.t("p1 is required.");if(!n.e(u))throw new i.t("p2 is required.");var c=y;r.o.clone(e,c.origin),r.o.subtract(t,e,c.direction),r.o.normalize(c.direction,c.direction);var w=m.rayTriangleParametric(c,o,a,u,s);if(!(!n.e(w)||w<0||w>r.o.distance(e,t)))return n.e(f)||(f=new r.o),r.o.multiplyByScalar(c.direction,w,f),r.o.add(c.origin,f,f)};var R={root0:0,root1:0};function S(e,t,i){n.e(i)||(i=new o.o);var a=e.origin,u=e.direction,s=t.center,f=t.radius*t.radius,c=r.o.subtract(a,s,v),w=function(e,r,t,n){var i=r*r-4*e*t;if(!(i<0)){if(i>0){var o=1/(2*e),a=Math.sqrt(i),u=(-r+a)*o,s=(-r-a)*o;return u<s?(n.root0=u,n.root1=s):(n.root0=s,n.root1=u),n}var f=-r/(2*e);if(0!==f)return n.root0=n.root1=f,n}}(r.o.dot(u,u),2*r.o.dot(u,c),r.o.magnitudeSquared(c)-f,R);if(n.e(w))return i.start=w.root0,i.stop=w.root1,i}m.raySphere=function(e,r,t){if(!n.e(e))throw new i.t("ray is required.");if(!n.e(r))throw new i.t("sphere is required.");if(t=S(e,r,t),n.e(t)&&!(t.stop<0))return t.start=Math.max(t.start,0),t};var O=new p;m.lineSegmentSphere=function(e,t,o,a){if(!n.e(e))throw new i.t("p0 is required.");if(!n.e(t))throw new i.t("p1 is required.");if(!n.e(o))throw new i.t("sphere is required.");var u=O;r.o.clone(e,u.origin);var s=r.o.subtract(t,e,u.direction),f=r.o.magnitude(s);if(r.o.normalize(s,s),a=S(u,o,a),!(!n.e(a)||a.stop<0||a.start>f))return a.start=Math.max(a.start,0),a.stop=Math.min(a.stop,f),a};var P=new r.o,N=new r.o;function L(e,r,t){var n=e+r;return a.e.sign(e)!==a.e.sign(r)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(r)))<t?0:n}function $(e,t,n,i,o){var f,c=i*i,w=o*o,l=(e[u.p$1.COLUMN1ROW1]-e[u.p$1.COLUMN2ROW2])*w,d=o*(i*L(e[u.p$1.COLUMN1ROW0],e[u.p$1.COLUMN0ROW1],a.e.EPSILON15)+t.y),p=e[u.p$1.COLUMN0ROW0]*c+e[u.p$1.COLUMN2ROW2]*w+i*t.x+n,m=w*L(e[u.p$1.COLUMN2ROW1],e[u.p$1.COLUMN1ROW2],a.e.EPSILON15),b=o*(i*L(e[u.p$1.COLUMN2ROW0],e[u.p$1.COLUMN0ROW2])+t.z),g=[];if(0===b&&0===m){if(0===(f=s.computeRealRoots(l,d,p)).length)return g;var v=f[0],q=Math.sqrt(Math.max(1-v*v,0));if(g.push(new r.o(i,o*v,o*-q)),g.push(new r.o(i,o*v,o*q)),2===f.length){var M=f[1],y=Math.sqrt(Math.max(1-M*M,0));g.push(new r.o(i,o*M,o*-y)),g.push(new r.o(i,o*M,o*y))}return g}var R=b*b,S=m*m,O=b*m,P=l*l+S,N=2*(d*l+O),$=2*p*l+d*d-S+R,E=2*(p*d-O),I=p*p-R;if(0===P&&0===N&&0===$&&0===E)return g;var C=(f=h.computeRealRoots(P,N,$,E,I)).length;if(0===C)return g;for(var x=0;x<C;++x){var z=f[x],U=z*z,T=Math.max(1-U,0),W=Math.sqrt(T),B=(a.e.sign(l)===a.e.sign(p)?L(l*U+p,d*z,a.e.EPSILON12):a.e.sign(p)===a.e.sign(d*z)?L(l*U,d*z+p,a.e.EPSILON12):L(l*U+d*z,p,a.e.EPSILON12))*L(m*z,b,a.e.EPSILON15);B<0?g.push(new r.o(i,o*z,o*W)):B>0?g.push(new r.o(i,o*z,o*-W)):0!==W?(g.push(new r.o(i,o*z,o*-W)),g.push(new r.o(i,o*z,o*W)),++x):g.push(new r.o(i,o*z,o*W))}return g}m.rayEllipsoid=function(e,t){if(!n.e(e))throw new i.t("ray is required.");if(!n.e(t))throw new i.t("ellipsoid is required.");var a,u,s,f,c,w=t.oneOverRadii,h=r.o.multiplyComponents(w,e.origin,P),l=r.o.multiplyComponents(w,e.direction,N),d=r.o.magnitudeSquared(h),p=r.o.dot(h,l);if(d>1){if(p>=0)return;var m=p*p;if(a=d-1,m<(s=(u=r.o.magnitudeSquared(l))*a))return;if(m>s){f=p*p-s;var b=(c=-p+Math.sqrt(f))/u,g=a/c;return b<g?new o.o(b,g):{start:g,stop:b}}var v=Math.sqrt(a/u);return new o.o(v,v)}return d<1?(a=d-1,f=p*p-(s=(u=r.o.magnitudeSquared(l))*a),c=-p+Math.sqrt(f),new o.o(0,c/u)):p<0?(u=r.o.magnitudeSquared(l),new o.o(0,-p/u)):void 0};var E=new r.o,I=new r.o,C=new r.o,x=new r.o,z=new r.o,U=new u.p$1,T=new u.p$1,W=new u.p$1,B=new u.p$1,Z=new u.p$1,D=new u.p$1,V=new u.p$1,A=new r.o,F=new r.o,j=new t.a;m.grazingAltitudeLocation=function(e,t){if(!n.e(e))throw new i.t("ray is required.");if(!n.e(t))throw new i.t("ellipsoid is required.");var o=e.origin,s=e.direction;if(!r.o.equals(o,r.o.ZERO)){var f=t.geodeticSurfaceNormal(o,E);if(r.o.dot(s,f)>=0)return o}var c=n.e(this.rayEllipsoid(e,t)),w=t.transformPositionToScaledSpace(s,E),h=r.o.normalize(w,w),l=r.o.mostOrthogonalAxis(w,x),d=r.o.normalize(r.o.cross(l,h,I),I),p=r.o.normalize(r.o.cross(h,d,C),C),m=U;m[0]=h.x,m[1]=h.y,m[2]=h.z,m[3]=d.x,m[4]=d.y,m[5]=d.z,m[6]=p.x,m[7]=p.y,m[8]=p.z;var b=u.p$1.transpose(m,T),g=u.p$1.fromScale(t.radii,W),v=u.p$1.fromScale(t.oneOverRadii,B),q=Z;q[0]=0,q[1]=-s.z,q[2]=s.y,q[3]=s.z,q[4]=0,q[5]=-s.x,q[6]=-s.y,q[7]=s.x,q[8]=0;var M,y,R=u.p$1.multiply(u.p$1.multiply(b,v,D),q,D),S=u.p$1.multiply(u.p$1.multiply(R,g,V),m,V),O=u.p$1.multiplyByVector(R,o,z),P=$(S,r.o.negate(O,E),0,0,1),N=P.length;if(N>0){for(var L=r.o.clone(r.o.ZERO,F),k=Number.NEGATIVE_INFINITY,G=0;G<N;++G){M=u.p$1.multiplyByVector(g,u.p$1.multiplyByVector(m,P[G],A),A);var Y=r.o.normalize(r.o.subtract(M,o,x),x),_=r.o.dot(Y,s);_>k&&(k=_,L=r.o.clone(M,L))}var H=t.cartesianToCartographic(L,j);return k=a.e.clamp(k,0,1),y=r.o.magnitude(r.o.subtract(L,o,x))*Math.sqrt(1-k*k),y=c?-y:y,H.height=y,t.cartographicToCartesian(H,new r.o)}};var k=new r.o;m.lineSegmentPlane=function(e,t,o,u){if(!n.e(e))throw new i.t("endPoint0 is required.");if(!n.e(t))throw new i.t("endPoint1 is required.");if(!n.e(o))throw new i.t("plane is required.");n.e(u)||(u=new r.o);var s=r.o.subtract(t,e,k),f=o.normal,c=r.o.dot(f,s);if(!(Math.abs(c)<a.e.EPSILON6)){var w=r.o.dot(f,e),h=-(o.distance+w)/c;if(!(h<0||h>1))return r.o.multiplyByScalar(s,h,u),r.o.add(e,u,u),u}},m.trianglePlaneIntersection=function(e,t,o,a){if(!(n.e(e)&&n.e(t)&&n.e(o)&&n.e(a)))throw new i.t("p0, p1, p2, and plane are required.");var u,s,f=a.normal,c=a.distance,w=r.o.dot(f,e)+c<0,h=r.o.dot(f,t)+c<0,l=r.o.dot(f,o)+c<0,d=0;if(d+=w?1:0,d+=h?1:0,(1===(d+=l?1:0)||2===d)&&(u=new r.o,s=new r.o),1===d){if(w)return m.lineSegmentPlane(e,t,a,u),m.lineSegmentPlane(e,o,a,s),{positions:[e,t,o,u,s],indices:[0,3,4,1,2,4,1,4,3]};if(h)return m.lineSegmentPlane(t,o,a,u),m.lineSegmentPlane(t,e,a,s),{positions:[e,t,o,u,s],indices:[1,3,4,2,0,4,2,4,3]};if(l)return m.lineSegmentPlane(o,e,a,u),m.lineSegmentPlane(o,t,a,s),{positions:[e,t,o,u,s],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===d){if(!w)return m.lineSegmentPlane(t,e,a,u),m.lineSegmentPlane(o,e,a,s),{positions:[e,t,o,u,s],indices:[1,2,4,1,4,3,0,3,4]};if(!h)return m.lineSegmentPlane(o,t,a,u),m.lineSegmentPlane(e,t,a,s),{positions:[e,t,o,u,s],indices:[2,0,4,2,4,3,1,3,4]};if(!l)return m.lineSegmentPlane(e,o,a,u),m.lineSegmentPlane(t,o,a,s),{positions:[e,t,o,u,s],indices:[0,1,4,0,4,3,2,3,4]}}},e.f=p,e.g=m}));
