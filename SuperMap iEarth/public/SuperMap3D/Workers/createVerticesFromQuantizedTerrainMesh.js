define(["./AttributeCompression-4cf880dc","./EllipsoidTangentPlane-ee91c10e","./buildModuleUrl-1b968a9d","./Cartesian2-59a54ee7","./Cartographic-81e9e8b2","./when-39df26e1","./TerrainEncoding-6f3d720e","./IndexDatatype-be421fbf","./Math-5e067eb3","./FeatureDetection-2d4141ff","./OrientedBoundingBox-7144be8f","./Check-ff445961","./GeometryAttribute-9b3921a3","./WebMercatorProjection-9bf14d38","./createTaskProcessorWorker","./Cartesian4-a56bd360","./IntersectionTests-036daea1","./Plane-775a5120","./Event-e109b23e","./RuntimeError-251a1d8d","./ComponentDatatype-7d28dd1c","./WebGLConstants-42651efd","./PolygonPipeline-ae195f4e","./EllipsoidRhumbLine-61b02483"],(function(e,t,r,n,i,o,a,s,h,d,u,c,I,l,m,g,T,f,v,y,p,w,E,N){"use strict";function b(){c.t.throwInstantiationError()}Object.defineProperties(b.prototype,{errorEvent:{get:c.t.throwInstantiationError},credit:{get:c.t.throwInstantiationError},tilingScheme:{get:c.t.throwInstantiationError},ready:{get:c.t.throwInstantiationError},readyPromise:{get:c.t.throwInstantiationError},hasWaterMask:{get:c.t.throwInstantiationError},hasVertexNormals:{get:c.t.throwInstantiationError},availability:{get:c.t.throwInstantiationError}});var S=[];b.getRegularGridIndices=function(e,t){if(e*t>=h.e.FOUR_GIGABYTES)throw new c.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=S[e];o.e(r)||(S[e]=r=[]);var n=r[t];return o.e(n)||F(e,t,n=e*t<h.e.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6+3*(e+t-2)):r[t]=new Uint32Array((e-1)*(t-1)*6+3*(e+t-2)),0),n},b.getRegularGridIndicesForReproject=function(e,t){if(e*t>=h.e.FOUR_GIGABYTES)throw new c.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=S[e];o.e(r)||(S[e]=r=[]);var n=r[t];return o.e(n)||F(e,t,n=e*t<h.e.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),n};var A=[];b.getRegularGridIndicesAndEdgeIndices=function(e,t){if(e*t>=h.e.FOUR_GIGABYTES)throw new c.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=A[e];o.e(r)||(A[e]=r=[]);var n=r[t];if(!o.e(n)){var i=b.getRegularGridIndices(e,t),a=_(e,t),s=a.westIndicesSouthToNorth,d=a.southIndicesEastToWest,u=a.eastIndicesNorthToSouth,I=a.northIndicesWestToEast;n=r[t]={indices:i,westIndicesSouthToNorth:s,southIndicesEastToWest:d,eastIndicesNorthToSouth:u,northIndicesWestToEast:I}}return n};var x=[];function _(e,t){var r,n=new Array(t),i=new Array(e),o=new Array(t),a=new Array(e);for(r=0;r<e;++r)a[r]=r,i[r]=e*t-1-r;for(r=0;r<t;++r)o[r]=(r+1)*e-1,n[r]=(t-r-1)*e;return{westIndicesSouthToNorth:n,southIndicesEastToWest:i,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function F(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i,h=s+e,d=h+1,u=s+1;r[n++]=s,r[n++]=h,r[n++]=u,r[n++]=u,r[n++]=h,r[n++]=d,++i}++i}var c=(t-1)/2,I=(e-1)/2;i=0;for(a=0;a<I;a++)r[n++]=i,r[n++]=i+1,r[n++]=i+2,i+=2;i=e*(t-1);for(a=0;a<I;a++)r[n++]=i+1,r[n++]=i,r[n++]=i+2,i+=2;i=0;for(a=0;a<c;a++)r[n++]=i+e,r[n++]=i,r[n++]=i+2*e,i+=2*e;i=e-1;for(a=0;a<c;a++)r[n++]=i,r[n++]=i+e,r[n++]=i+2*e,i+=2*e}function M(e,t,r,n,i){for(var a=o.e(i),s=e[0],h=e.length,d=1;d<h;++d){var u=e[d];!a||i[s+"_"+u]?(r[n++]=s,r[n++]=u,r[n++]=t,r[n++]=t,r[n++]=u,r[n++]=t+1,s=u,++t):(s=u,++t)}return n}b.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){if(e*t>=h.e.FOUR_GIGABYTES)throw new c.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=x[e];o.e(r)||(x[e]=r=[]);var n=r[t];if(!o.e(n)){var i=e*t,a=(e-1)*(t-1)*6,d=2*e+2*t,u=i+d,I=3*(e+t-2),l=a+6*Math.max(0,d-4)+I,m=_(e,t),g=m.westIndicesSouthToNorth,T=m.southIndicesEastToWest,f=m.eastIndicesNorthToSouth,v=m.northIndicesWestToEast,y=s.IndexDatatype.createTypedArray(u,l);F(e,t,y,0),b.addSkirtIndices(g,T,f,v,i,y,a+I),n=r[t]={indices:y,westIndicesSouthToNorth:g,southIndicesEastToWest:T,eastIndicesNorthToSouth:f,northIndicesWestToEast:v,indexCountWithoutSkirts:a}}return n},b.addSkirtIndices=function(e,t,r,n,i,o,a,s){var h=i;a=M(e,h,o,a,s),a=M(t,h+=e.length,o,a,s),a=M(r,h+=t.length,o,a,s),M(n,h+=r.length,o,a,s)},b.heightmapTerrainQuality=.25,b.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*b.heightmapTerrainQuality/(t*r)},b.prototype.requestTileGeometry=c.t.throwInstantiationError,b.prototype.getLevelMaximumGeometricError=c.t.throwInstantiationError,b.prototype.getTileDataAvailable=c.t.throwInstantiationError,b.prototype.loadTileDataAvailability=c.t.throwInstantiationError;var P=32767,G=new i.o,B=new i.o,W=new i.o,O=new i.a,Y=new n.o,k=new i.o,C=new d.p,H=new d.p;function R(e,t,r,n,o,a,s,u,c){var I=Number.POSITIVE_INFINITY,l=o.north,m=o.south,g=o.east,T=o.west;g<T&&(g+=h.e.TWO_PI);for(var f=e.length,v=0;v<f;++v){var y=e[v],p=r[y],w=n[y];O.longitude=h.e.lerp(T,g,w.x),O.latitude=h.e.lerp(m,l,w.y),O.height=p-t;var E=a.cartographicToCartesian(O,G);d.p.multiplyByPoint(s,E,E),i.o.minimumByComponent(E,u,u),i.o.maximumByComponent(E,c,c),I=Math.min(I,O.height)}return I}function V(t,r,n,a,s,u,c,m,g,T,f,v,y,p,w){var E=o.e(c),N=g.north,b=g.south,S=g.east,A=g.west;S<A&&(S+=h.e.TWO_PI);for(var x=n.length,_=0;_<x;++_){var F=n[_],M=s[F],P=u[F];O.longitude=h.e.lerp(A,S,P.x)+p,O.latitude=h.e.lerp(b,N,P.y)+w,O.height=M-T;var B,W=m.cartographicToCartesian(O,G);if(E){var R=2*F;if(Y.x=c[R],Y.y=c[R+1],1!==f){var V=e.t.octDecode(Y.x,Y.y,k),U=I.m.eastNorthUpToFixedFrame(G,m,H),z=d.p.inverseTransformation(U,C);d.p.multiplyByPointAsVector(z,V,V),V.z*=f,i.o.normalize(V,V),d.p.multiplyByPointAsVector(U,V,V),i.o.normalize(V,V),e.t.octEncode(V,Y)}}a.hasWebMercatorT&&(B=(l.t.geodeticLatitudeToMercatorAngle(O.latitude)-v)*y),r=a.encode(t,r,W,P,O.height,Y,B)}}function U(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),o.e(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}var z=m((function(c,m){var g,T,f=c.quantizedVertices,v=f.length/3,y=c.octEncodedNormals,p=c.westIndices.length+c.eastIndices.length+c.southIndices.length+c.northIndices.length,w=c.includeWebMercatorT,E=n.h.clone(c.rectangle),N=E.west,S=E.south,A=E.east,x=E.north,_=n.t.clone(c.ellipsoid),F=c.exaggeration,M=c.minimumHeight*F,z=c.maximumHeight*F,L=o.e(c.validMinimumHeight)?c.validMinimumHeight*F:M*F,D=o.e(c.validMaximumHeight)?c.validMaximumHeight*F:z*F,j=c.relativeToCenter,q=I.m.eastNorthUpToFixedFrame(j,_),K=d.p.inverseTransformation(q,new d.p);w&&(g=l.t.geodeticLatitudeToMercatorAngle(S),T=1/(l.t.geodeticLatitudeToMercatorAngle(x)-g));var Q=f.subarray(0,v),X=f.subarray(v,2*v),Z=f.subarray(2*v,3*v),J=o.e(y),$=new Array(v),ee=new Array(v),te=new Array(v),re=w?new Array(v):[],ne=B;ne.x=Number.POSITIVE_INFINITY,ne.y=Number.POSITIVE_INFINITY,ne.z=Number.POSITIVE_INFINITY;var ie=W;ie.x=Number.NEGATIVE_INFINITY,ie.y=Number.NEGATIVE_INFINITY,ie.z=Number.NEGATIVE_INFINITY;for(var oe=Number.POSITIVE_INFINITY,ae=Number.NEGATIVE_INFINITY,se=Number.POSITIVE_INFINITY,he=Number.NEGATIVE_INFINITY,de=0;de<v;++de){var ue=Q[de],ce=X[de],Ie=ue/P,le=ce/P,me=h.e.lerp(M,z,Z[de]/P);O.longitude=h.e.lerp(N,A,Ie),O.latitude=h.e.lerp(S,x,le),O.height=me,oe=Math.min(O.longitude,oe),ae=Math.max(O.longitude,ae),se=Math.min(O.latitude,se),he=Math.max(O.latitude,he);var ge=_.cartographicToCartesian(O);$[de]=new n.o(Ie,le),ee[de]=me,te[de]=ge,w&&(re[de]=(l.t.geodeticLatitudeToMercatorAngle(O.latitude)-g)*T),d.p.multiplyByPoint(K,ge,G),i.o.minimumByComponent(G,ne,ne),i.o.maximumByComponent(G,ie,ie)}var Te,fe,ve=U(c.westIndices,(function(e,t){return $[e].y-$[t].y})),ye=U(c.eastIndices,(function(e,t){return $[t].y-$[e].y})),pe=U(c.southIndices,(function(e,t){return $[t].x-$[e].x})),we=U(c.northIndices,(function(e,t){return $[e].x-$[t].x}));fe=r.i.fromPoints(te),Te=u.y.fromRectangle(E,M,z,_);var Ee,Ne=u.y.fromRectangle(E,L,D,_);(1!==F||M<0)&&(Ee=new a.s(_).computeHorizonCullingPointPossiblyUnderEllipsoid(j,te,M));var be=M;be=Math.min(be,R(c.westIndices,c.westSkirtHeight,ee,$,E,_,K,ne,ie)),be=Math.min(be,R(c.southIndices,c.southSkirtHeight,ee,$,E,_,K,ne,ie)),be=Math.min(be,R(c.eastIndices,c.eastSkirtHeight,ee,$,E,_,K,ne,ie)),be=Math.min(be,R(c.northIndices,c.northSkirtHeight,ee,$,E,_,K,ne,ie));for(var Se=new t.e(ne,ie,j),Ae=new a.h(Se,be,z,q,J,w),xe=Ae.getStride(),_e=new Float32Array(v*xe+p*xe),Fe=0,Me=0;Me<v;++Me){if(J){var Pe=2*Me;if(Y.x=y[Pe],Y.y=y[Pe+1],1!==F){var Ge=e.t.octDecode(Y.x,Y.y,k),Be=I.m.eastNorthUpToFixedFrame(te[Me],_,H),We=d.p.inverseTransformation(Be,C);d.p.multiplyByPointAsVector(We,Ge,Ge),Ge.z*=F,i.o.normalize(Ge,Ge),d.p.multiplyByPointAsVector(Be,Ge,Ge),i.o.normalize(Ge,Ge),e.t.octEncode(Ge,Y)}}Fe=Ae.encode(_e,Fe,te[Me],$[Me],ee[Me],Y,re[Me])}var Oe=Math.max(0,2*(p-4)),Ye=c.indices.length+3*Oe,ke=s.IndexDatatype.createTypedArray(v+p,Ye);ke.set(c.indices,0);var Ce=1e-4,He=(ae-oe)*Ce,Re=(he-se)*Ce,Ve=-He,Ue=He,ze=Re,Le=-Re,De=v*xe;V(_e,De,ve,Ae,ee,$,y,_,E,c.westSkirtHeight,F,g,T,Ve,0),V(_e,De+=c.westIndices.length*xe,pe,Ae,ee,$,y,_,E,c.southSkirtHeight,F,g,T,0,Le),V(_e,De+=c.southIndices.length*xe,ye,Ae,ee,$,y,_,E,c.eastSkirtHeight,F,g,T,Ue,0),V(_e,De+=c.eastIndices.length*xe,we,Ae,ee,$,y,_,E,c.northSkirtHeight,F,g,T,0,ze);var je=function(e,t,r,n){if(n<12)return;for(var i={},o=e.length,a=0;a<o;a+=3){var s=e[a],h=e[a+1],d=e[a+2];(t[s]===P&&t[h]===P||0===t[s]&&0===t[h]||r[s]===P&&r[h]===P||0===r[s]&&0===r[h])&&(i[s+"_"+h]=1,i[h+"_"+s]=1),(t[h]===P&&t[d]===P||0===t[h]&&0===t[d]||r[h]===P&&r[d]===P||0===r[h]&&0===r[d])&&(i[h+"_"+d]=1,i[d+"_"+h]=1),(t[d]===P&&t[s]===P||0===t[d]&&0===t[s]||r[d]===P&&r[s]===P||0===r[d]&&0===r[s])&&(i[d+"_"+s]=1,i[s+"_"+d]=1)}return i}(c.indices,Q,X,c.level);return b.addSkirtIndices(ve,pe,ye,we,v,ke,c.indices.length,je),m.push(_e.buffer,ke.buffer),{vertices:_e.buffer,indices:ke.buffer,westIndicesSouthToNorth:ve,southIndicesEastToWest:pe,eastIndicesNorthToSouth:ye,northIndicesWestToEast:we,vertexStride:xe,center:j,minimumHeight:M,maximumHeight:z,boundingSphere:fe,orientedBoundingBox:Te,validOrientedBoundingBox:Ne,occludeePointInScaledSpace:Ee,encoding:Ae,indexCountWithoutSkirts:c.indices.length}}));return z}));
