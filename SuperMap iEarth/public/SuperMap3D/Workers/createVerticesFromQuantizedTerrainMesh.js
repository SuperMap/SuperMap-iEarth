import{a as Rr,b as Ur}from"./chunk-K7EPBLTH.js";import{a as $}from"./chunk-VZ2V43FJ.js";import{a as Cr}from"./chunk-AMRCVYIA.js";import{a as yr}from"./chunk-I6IKQZ7N.js";import{a as Lr}from"./chunk-HOZ5IOFP.js";import"./chunk-ZMHH4UFY.js";import"./chunk-6X6ULKRC.js";import{a as J}from"./chunk-MQMYX2JZ.js";import"./chunk-REXJO6A6.js";import"./chunk-EUSYH4JF.js";import{a as ar}from"./chunk-44AFRGCG.js";import{d as Yr,j as tr}from"./chunk-CJHFPVIB.js";import"./chunk-NPAFDOYL.js";import{a as x}from"./chunk-SSYG2MIY.js";import"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import"./chunk-Z4SOZDEW.js";import"./chunk-MX7ZM7WW.js";import"./chunk-EHDXVZQM.js";import{a as Vr}from"./chunk-NLYLRNUA.js";import{a as gr,b as kr}from"./chunk-7TOCOFC3.js";import"./chunk-ZVKIUA3Y.js";import{b as Hr}from"./chunk-3HZNWEV7.js";import{a as A}from"./chunk-LBR6REQR.js";import{a as h}from"./chunk-GXFCHGTA.js";import"./chunk-UBHQMGET.js";import"./chunk-EDZQSM3T.js";import{a as m}from"./chunk-PJGSCWXZ.js";import{a as g}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";function T(){m.throwInstantiationError()}Object.defineProperties(T.prototype,{errorEvent:{get:m.throwInstantiationError},credit:{get:m.throwInstantiationError},tilingScheme:{get:m.throwInstantiationError},ready:{get:m.throwInstantiationError},readyPromise:{get:m.throwInstantiationError},hasWaterMask:{get:m.throwInstantiationError},hasVertexNormals:{get:m.throwInstantiationError},availability:{get:m.throwInstantiationError}});var or=[];T.getRegularGridIndices=function(r,a){if(r*a>=h.FOUR_GIGABYTES)throw new m("The total number of vertices (width * height) must be less than 4,294,967,296.");var t=or[r];g(t)||(or[r]=t=[]);var e=t[a];return g(e)||(r*a<h.SIXTY_FOUR_KILOBYTES?e=t[a]=new Uint16Array((r-1)*(a-1)*6+3*(r+a-2)):e=t[a]=new Uint32Array((r-1)*(a-1)*6+3*(r+a-2)),Nr(r,a,e,0)),e};T.getRegularGridIndicesForReproject=function(r,a){if(r*a>=h.FOUR_GIGABYTES)throw new m("The total number of vertices (width * height) must be less than 4,294,967,296.");var t=or[r];g(t)||(or[r]=t=[]);var e=t[a];return g(e)||(r*a<h.SIXTY_FOUR_KILOBYTES?e=t[a]=new Uint16Array((r-1)*(a-1)*6):e=t[a]=new Uint32Array((r-1)*(a-1)*6),Nr(r,a,e,0)),e};var Er=[];T.getRegularGridIndicesAndEdgeIndices=function(r,a){if(r*a>=h.FOUR_GIGABYTES)throw new m("The total number of vertices (width * height) must be less than 4,294,967,296.");var t=Er[r];g(t)||(Er[r]=t=[]);var e=t[a];if(!g(e)){var n=T.getRegularGridIndices(r,a),u=zr(r,a),o=u.westIndicesSouthToNorth,i=u.southIndicesEastToWest,v=u.eastIndicesNorthToSouth,s=u.northIndicesWestToEast;e=t[a]={indices:n,westIndicesSouthToNorth:o,southIndicesEastToWest:i,eastIndicesNorthToSouth:v,northIndicesWestToEast:s}}return e};var Sr=[];T.getRegularGridAndSkirtIndicesAndEdgeIndices=function(r,a){if(r*a>=h.FOUR_GIGABYTES)throw new m("The total number of vertices (width * height) must be less than 4,294,967,296.");var t=Sr[r];g(t)||(Sr[r]=t=[]);var e=t[a];if(!g(e)){var n=r*a,u=(r-1)*(a-1)*6,o=r*2+a*2,i=Math.max(0,o-4)*6,v=n+o,s=3*(r+a-2),M=u+i+s,E=zr(r,a),d=E.westIndicesSouthToNorth,l=E.southIndicesEastToWest,S=E.eastIndicesNorthToSouth,N=E.northIndicesWestToEast,w=ar.createTypedArray(v,M);Nr(r,a,w,0),T.addSkirtIndices(d,l,S,N,n,w,u+s),e=t[a]={indices:w,westIndicesSouthToNorth:d,southIndicesEastToWest:l,eastIndicesNorthToSouth:S,northIndicesWestToEast:N,indexCountWithoutSkirts:u}}return e};T.clearIndicesCache=function(){Er=[],Sr=[]};T.addSkirtIndices=function(r,a,t,e,n,u,o,i){var v=n;o=er(r,v,u,o,i),v+=r.length,o=er(a,v,u,o,i),v+=a.length,o=er(t,v,u,o,i),v+=t.length,er(e,v,u,o,i)};function zr(r,a){var t=new Array(a),e=new Array(r),n=new Array(a),u=new Array(r),o;for(o=0;o<r;++o)u[o]=o,e[o]=r*a-1-o;for(o=0;o<a;++o)n[o]=(o+1)*r-1,t[o]=(a-o-1)*r;return{westIndicesSouthToNorth:t,southIndicesEastToWest:e,eastIndicesNorthToSouth:n,northIndicesWestToEast:u}}function Nr(r,a,t,e){for(var n=0,u=0;u<a-1;++u){for(var o=0;o<r-1;++o){var i=n,v=i+r,s=v+1,M=i+1;t[e++]=i,t[e++]=v,t[e++]=M,t[e++]=M,t[e++]=v,t[e++]=s,++n}++n}var E=(a-1)/2,d=(r-1)/2;n=0;for(var o=0;o<d;o++)t[e++]=n,t[e++]=n+1,t[e++]=n+2,n+=2;n=r*(a-1);for(var o=0;o<d;o++)t[e++]=n+1,t[e++]=n,t[e++]=n+2,n+=2;n=0;for(var o=0;o<E;o++)t[e++]=n+r,t[e++]=n,t[e++]=n+2*r,n+=2*r;n=r-1;for(var o=0;o<E;o++)t[e++]=n,t[e++]=n+r,t[e++]=n+2*r,n+=2*r}function er(r,a,t,e,n){for(var u=g(n),o=r[0],i=r.length,v=1;v<i;++v){var s=r[v];if(u&&!n[o+"_"+s]){o=s,++a;continue}t[e++]=o,t[e++]=s,t[e++]=a,t[e++]=a,t[e++]=s,t[e++]=a+1,o=s,++a}return e}T.heightmapTerrainQuality=.25;T.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(r,a,t){return r.maximumRadius*2*Math.PI*T.heightmapTerrainQuality/(a*t)};T.prototype.requestTileGeometry=m.throwInstantiationError;T.prototype.getLevelMaximumGeometricError=m.throwInstantiationError;T.prototype.getTileDataAvailable=m.throwInstantiationError;T.prototype.loadTileDataAvailability=m.throwInstantiationError;var Br=T;var y=32767,Q=new A,lt=new A,It=new A,I=new Hr,b=new gr,Dr=new A,qr=new x,Qr=new x;function mt(r,a){var t=r.quantizedVertices,e=t.length/3,n=r.octEncodedNormals,u=r.westIndices.length+r.eastIndices.length+r.southIndices.length+r.northIndices.length,o=r.includeWebMercatorT,i=Vr.clone(r.rectangle),v=i.west,s=i.south,M=i.east,E=i.north,d=kr.clone(r.ellipsoid),l=r.exaggeration,S=r.minimumHeight*l,N=r.maximumHeight*l,w=g(r.validMinimumHeight)?r.validMinimumHeight*l:S*l,K=g(r.validMaximumHeight)?r.validMaximumHeight*l:N*l,p=r.relativeToCenter,F=tr.eastNorthUpToFixedFrame(p,d),Y=x.inverseTransformation(F,new x),O,W;o&&(O=$.geodeticLatitudeToMercatorAngle(s),W=1/($.geodeticLatitudeToMercatorAngle(E)-O));var j=t.subarray(0,e),q=t.subarray(e,2*e),sr=t.subarray(e*2,3*e),X=g(n),c=new Array(e),f=new Array(e),C=new Array(e),Z=o?new Array(e):[],_=lt;_.x=Number.POSITIVE_INFINITY,_.y=Number.POSITIVE_INFINITY,_.z=Number.POSITIVE_INFINITY;var P=It;P.x=Number.NEGATIVE_INFINITY,P.y=Number.NEGATIVE_INFINITY,P.z=Number.NEGATIVE_INFINITY;for(var ur=Number.POSITIVE_INFINITY,cr=Number.NEGATIVE_INFINITY,dr=Number.POSITIVE_INFINITY,lr=Number.NEGATIVE_INFINITY,H=0;H<e;++H){var Kr=j[H],Xr=q[H],fr=Kr/y,Ar=Xr/y,xr=h.lerp(S,N,sr[H]/y);I.longitude=h.lerp(v,M,fr),I.latitude=h.lerp(s,E,Ar),I.height=xr,ur=Math.min(I.longitude,ur),cr=Math.max(I.longitude,cr),dr=Math.min(I.latitude,dr),lr=Math.max(I.latitude,lr);var br=d.cartographicToCartesian(I);c[H]=new gr(fr,Ar),f[H]=xr,C[H]=br,o&&(Z[H]=($.geodeticLatitudeToMercatorAngle(I.latitude)-O)*W),x.multiplyByPoint(Y,br,Q),A.minimumByComponent(Q,_,_),A.maximumByComponent(Q,P,P)}var Ir=vr(r.westIndices,function(B,D){return c[B].y-c[D].y}),mr=vr(r.eastIndices,function(B,D){return c[D].y-c[B].y}),hr=vr(r.southIndices,function(B,D){return c[D].x-c[B].x}),Tr=vr(r.northIndices,function(B,D){return c[B].x-c[D].x}),Mr,pr;pr=Yr.fromPoints(C),Mr=yr.fromRectangle(i,S,N,d);var Zr=yr.fromRectangle(i,w,K,d),Or;if(l!==1||S<=0){var Jr=new Rr(d);Or=Jr.computeHorizonCullingPointPossiblyUnderEllipsoid(p,C,S)}var k=S;k=Math.min(k,nr(r.westIndices,r.westSkirtHeight,f,c,i,d,Y,_,P)),k=Math.min(k,nr(r.southIndices,r.southSkirtHeight,f,c,i,d,Y,_,P)),k=Math.min(k,nr(r.eastIndices,r.eastSkirtHeight,f,c,i,d,Y,_,P)),k=Math.min(k,nr(r.northIndices,r.northSkirtHeight,f,c,i,d,Y,_,P));for(var $r=new Lr(_,P,p),L=new Ur($r,k,N,F,X,o),R=L.getStride(),jr=e*R+u*R,U=new Float32Array(jr),wr=0,V=0;V<e;++V){if(X){var Fr=V*2;if(b.x=n[Fr],b.y=n[Fr+1],l!==1){var G=J.octDecode(b.x,b.y,Dr),Wr=tr.eastNorthUpToFixedFrame(C[V],d,Qr),rt=x.inverseTransformation(Wr,qr);x.multiplyByPointAsVector(rt,G,G),G.z*=l,A.normalize(G,G),x.multiplyByPointAsVector(Wr,G,G),A.normalize(G,G),J.octEncode(G,b)}}wr=L.encode(U,wr,C[V],c[V],f[V],b,Z[V])}var tt=Math.max(0,(u-4)*2),at=r.indices.length+tt*3,rr=ar.createTypedArray(e+u,at);rr.set(r.indices,0);var _r=1e-4,Pr=(cr-ur)*_r,Gr=(lr-dr)*_r,et=-Pr,ot=0,nt=Pr,it=0,vt=0,st=Gr,ut=0,ct=-Gr,z=e*R;ir(U,z,Ir,L,f,c,n,d,i,r.westSkirtHeight,l,O,W,et,ot),z+=r.westIndices.length*R,ir(U,z,hr,L,f,c,n,d,i,r.southSkirtHeight,l,O,W,ut,ct),z+=r.southIndices.length*R,ir(U,z,mr,L,f,c,n,d,i,r.eastSkirtHeight,l,O,W,nt,it),z+=r.eastIndices.length*R,ir(U,z,Tr,L,f,c,n,d,i,r.northSkirtHeight,l,O,W,vt,st);var dt=ht(r.indices,j,q,r.level);return Br.addSkirtIndices(Ir,hr,mr,Tr,e,rr,r.indices.length,dt),a.push(U.buffer,rr.buffer),{vertices:U.buffer,indices:rr.buffer,westIndicesSouthToNorth:Ir,southIndicesEastToWest:hr,eastIndicesNorthToSouth:mr,northIndicesWestToEast:Tr,vertexStride:R,center:p,minimumHeight:S,maximumHeight:N,boundingSphere:pr,orientedBoundingBox:Mr,validOrientedBoundingBox:Zr,occludeePointInScaledSpace:Or,encoding:L,indexCountWithoutSkirts:r.indices.length}}function ht(r,a,t,e){if(!(e<12)){for(var n={},u=r.length,o=0;o<u;o+=3){var i=r[o],v=r[o+1],s=r[o+2];(a[i]===y&&a[v]===y||a[i]===0&&a[v]===0||t[i]===y&&t[v]===y||t[i]===0&&t[v]===0)&&(n[i+"_"+v]=1,n[v+"_"+i]=1),(a[v]===y&&a[s]===y||a[v]===0&&a[s]===0||t[v]===y&&t[s]===y||t[v]===0&&t[s]===0)&&(n[v+"_"+s]=1,n[s+"_"+v]=1),(a[s]===y&&a[i]===y||a[s]===0&&a[i]===0||t[s]===y&&t[i]===y||t[s]===0&&t[i]===0)&&(n[s+"_"+i]=1,n[i+"_"+s]=1)}return n}}function nr(r,a,t,e,n,u,o,i,v){var s=Number.POSITIVE_INFINITY,M=n.north,E=n.south,d=n.east,l=n.west;d<l&&(d+=h.TWO_PI);for(var S=r.length,N=0;N<S;++N){var w=r[N],K=t[w],p=e[w];I.longitude=h.lerp(l,d,p.x),I.latitude=h.lerp(E,M,p.y),I.height=K-a;var F=u.cartographicToCartesian(I,Q);x.multiplyByPoint(o,F,F),A.minimumByComponent(F,i,i),A.maximumByComponent(F,v,v),s=Math.min(s,I.height)}return s}function ir(r,a,t,e,n,u,o,i,v,s,M,E,d,l,S){var N=g(o),w=v.north,K=v.south,p=v.east,F=v.west;p<F&&(p+=h.TWO_PI);for(var Y=t.length,O=0;O<Y;++O){var W=t[O],j=n[W],q=u[W];I.longitude=h.lerp(F,p,q.x)+l,I.latitude=h.lerp(K,w,q.y)+S,I.height=j-s;var sr=i.cartographicToCartesian(I,Q);if(N){var X=W*2;if(b.x=o[X],b.y=o[X+1],M!==1){var c=J.octDecode(b.x,b.y,Dr),f=tr.eastNorthUpToFixedFrame(Q,i,Qr),C=x.inverseTransformation(f,qr);x.multiplyByPointAsVector(C,c,c),c.z*=M,A.normalize(c,c),x.multiplyByPointAsVector(f,c,c),A.normalize(c,c),J.octEncode(c,b)}}var Z;e.hasWebMercatorT&&(Z=($.geodeticLatitudeToMercatorAngle(I.latitude)-E)*d),a=e.encode(r,a,sr,q,I.height,b,Z)}}function vr(r,a){var t;return typeof r.slice=="function"&&(t=r.slice(),typeof t.sort!="function"&&(t=void 0)),g(t)||(t=Array.prototype.slice.call(r)),t.sort(a),t}var Lt=Cr(mt);export{Lt as default};
