define(["exports","./arrayFill-c1a6b724","./buildModuleUrl-36ce0ebc","./Ellipsoid-ca2b8eb1","./Cartesian3-c1138337","./ComponentDatatype-3cfb1146","./defaultValue-2110bb17","./Check-92c551fb","./GeometryAttribute-b12ab6bd","./GeometryAttributes-3cad3ff9","./GeometryOffsetAttribute-da5a1d35","./IndexDatatype-d833345d","./Math-cd1437d9","./PrimitiveType-d9ba7368","./VertexFormat-295b1d1f"],(function(t,e,n,i,a,o,r,m,s,u,c,f,d,p,l){"use strict";var _=new a.o,v=new a.o,y=new a.o,h=new a.o,b=new a.o(1,1,1),w=Math.cos,k=Math.sin;function C(t){t=r.u(t,r.u.EMPTY_OBJECT);var e=r.u(t.radii,b),n=r.u(t.innerRadii,e),i=r.u(t.minimumClock,0),o=r.u(t.maximumClock,d.e.TWO_PI),s=r.u(t.minimumCone,0),u=r.u(t.maximumCone,d.e.PI),c=Math.round(r.u(t.stackPartitions,64)),f=Math.round(r.u(t.slicePartitions,64)),p=r.u(t.vertexFormat,l.n.DEFAULT);if(f<3)throw new m.t("options.slicePartitions cannot be less than three.");if(c<3)throw new m.t("options.stackPartitions cannot be less than three.");this._radii=a.o.clone(e),this._innerRadii=a.o.clone(n),this._minimumClock=i,this._maximumClock=o,this._minimumCone=s,this._maximumCone=u,this._stackPartitions=c,this._slicePartitions=f,this._vertexFormat=l.n.clone(p),this._offsetAttribute=t.offsetAttribute,this._workerName="createEllipsoidGeometry"}C.packedLength=2*a.o.packedLength+l.n.packedLength+7,C.pack=function(t,e,n){if(!r.e(t))throw new m.t("value is required");if(!r.e(e))throw new m.t("array is required");return n=r.u(n,0),a.o.pack(t._radii,e,n),n+=a.o.packedLength,a.o.pack(t._innerRadii,e,n),n+=a.o.packedLength,l.n.pack(t._vertexFormat,e,n),n+=l.n.packedLength,e[n++]=t._minimumClock,e[n++]=t._maximumClock,e[n++]=t._minimumCone,e[n++]=t._maximumCone,e[n++]=t._stackPartitions,e[n++]=t._slicePartitions,e[n]=r.u(t._offsetAttribute,-1),e};var A,x=new a.o,P=new a.o,g=new l.n,F={radii:x,innerRadii:P,vertexFormat:g,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};C.unpack=function(t,e,n){if(!r.e(t))throw new m.t("array is required");e=r.u(e,0);var i=a.o.unpack(t,e,x);e+=a.o.packedLength;var o=a.o.unpack(t,e,P);e+=a.o.packedLength;var s=l.n.unpack(t,e,g);e+=l.n.packedLength;var u=t[e++],c=t[e++],f=t[e++],d=t[e++],p=t[e++],_=t[e++],v=t[e];return r.e(n)?(n._radii=a.o.clone(i,n._radii),n._innerRadii=a.o.clone(o,n._innerRadii),n._vertexFormat=l.n.clone(s,n._vertexFormat),n._minimumClock=u,n._maximumClock=c,n._minimumCone=f,n._maximumCone=d,n._stackPartitions=p,n._slicePartitions=_,n._offsetAttribute=-1===v?void 0:v,n):(F.minimumClock=u,F.maximumClock=c,F.minimumCone=f,F.maximumCone=d,F.stackPartitions=p,F.slicePartitions=_,F.offsetAttribute=-1===v?void 0:v,new C(F))},C.createGeometry=function(t){var m=t._radii;if(!(m.x<=0||m.y<=0||m.z<=0)){var l=t._innerRadii;if(!(l.x<=0||l.y<=0||l.z<=0)){var b=t._minimumClock,C=t._maximumClock,A=t._minimumCone,x=t._maximumCone,P=t._vertexFormat,g=t._slicePartitions+1,F=t._stackPartitions+1;(g=Math.round(g*Math.abs(C-b)/d.e.TWO_PI))<2&&(g=2),(F=Math.round(F*Math.abs(x-A)/d.e.PI))<2&&(F=2);var T,D,I=0,L=[A],O=[b];for(T=0;T<F;T++)L.push(A+T*(x-A)/(F-1));for(L.push(x),D=0;D<g;D++)O.push(b+D*(C-b)/(g-1));O.push(C);var M=L.length,z=O.length,E=0,N=1,G=l.x!==m.x||l.y!==m.y||l.z!==m.z,R=!1,U=!1,S=!1;G&&(N=2,A>0&&(R=!0,E+=g-1),x<Math.PI&&(U=!0,E+=g-1),(C-b)%d.e.TWO_PI?(S=!0,E+=2*(F-1)+1):E+=1);var W=z*M*N,q=new Float64Array(3*W),B=e.d(new Array(W),!1),Y=e.d(new Array(W),!1),V=g*F*N,J=6*(V+E+1-(g+F)*N),X=f.IndexDatatype.createTypedArray(V,J),Z=P.normal?new Float32Array(3*W):void 0,j=P.tangent?new Float32Array(3*W):void 0,H=P.bitangent?new Float32Array(3*W):void 0,K=P.st?new Float32Array(2*W):void 0,Q=new Array(M),$=new Array(M);for(T=0;T<M;T++)Q[T]=k(L[T]),$[T]=w(L[T]);var tt=new Array(z),et=new Array(z);for(D=0;D<z;D++)et[D]=w(O[D]),tt[D]=k(O[D]);for(T=0;T<M;T++)for(D=0;D<z;D++)q[I++]=m.x*Q[T]*et[D],q[I++]=m.y*Q[T]*tt[D],q[I++]=m.z*$[T];var nt,it,at,ot,rt=W/2;if(G)for(T=0;T<M;T++)for(D=0;D<z;D++)q[I++]=l.x*Q[T]*et[D],q[I++]=l.y*Q[T]*tt[D],q[I++]=l.z*$[T],B[rt]=!0,T>0&&T!==M-1&&0!==D&&D!==z-1&&(Y[rt]=!0),rt++;for(I=0,T=1;T<M-2;T++)for(nt=T*z,it=(T+1)*z,D=1;D<z-2;D++)X[I++]=it+D,X[I++]=it+D+1,X[I++]=nt+D+1,X[I++]=it+D,X[I++]=nt+D+1,X[I++]=nt+D;if(G){var mt=M*z;for(T=1;T<M-2;T++)for(nt=mt+T*z,it=mt+(T+1)*z,D=1;D<z-2;D++)X[I++]=it+D,X[I++]=nt+D,X[I++]=nt+D+1,X[I++]=it+D,X[I++]=nt+D+1,X[I++]=it+D+1}if(G){if(R)for(ot=M*z,T=1;T<z-2;T++)X[I++]=T,X[I++]=T+1,X[I++]=ot+T+1,X[I++]=T,X[I++]=ot+T+1,X[I++]=ot+T;if(U)for(at=M*z-z,ot=M*z*N-z,T=1;T<z-2;T++)X[I++]=at+T+1,X[I++]=at+T,X[I++]=ot+T,X[I++]=at+T+1,X[I++]=ot+T,X[I++]=ot+T+1}if(S){for(T=1;T<M-2;T++)ot=z*M+z*T,at=z*T,X[I++]=ot,X[I++]=at+z,X[I++]=at,X[I++]=ot,X[I++]=ot+z,X[I++]=at+z;for(T=1;T<M-2;T++)ot=z*M+z*(T+1)-1,at=z*(T+1)-1,X[I++]=at+z,X[I++]=ot,X[I++]=at,X[I++]=at+z,X[I++]=ot+z,X[I++]=ot}var st=new u.a;P.position&&(st.position=new s.o({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:q}));var ut,ct=0,ft=0,dt=0,pt=0,lt=W/2,_t=i.t.fromCartesian3(m),vt=i.t.fromCartesian3(l);if(P.st||P.normal||P.tangent||P.bitangent){for(T=0;T<W;T++){ut=B[T]?vt:_t;var yt=a.o.fromArray(q,3*T,_),ht=ut.geodeticSurfaceNormal(yt,v);if(P.st){var bt=Math.atan2(ht.y,ht.x);bt<0&&(bt+=d.e.TWO_PI),K[ct++]=bt/d.e.TWO_PI,K[ct++]=Math.asin(ht.z)/Math.PI+.5}if(P.normal&&(Y[T]&&a.o.negate(ht,ht),Z[ft++]=ht.x,Z[ft++]=ht.y,Z[ft++]=ht.z),P.tangent||P.bitangent){var wt,kt=y,Ct=0;if(B[T]&&(Ct=lt),wt=!R&&T>=Ct&&T<Ct+2*z?a.o.UNIT_X:a.o.UNIT_Z,a.o.cross(wt,ht,kt),a.o.normalize(kt,kt),P.tangent&&(j[dt++]=kt.x,j[dt++]=kt.y,j[dt++]=kt.z),P.bitangent){var At=a.o.cross(ht,kt,h);a.o.normalize(At,At),H[pt++]=At.x,H[pt++]=At.y,H[pt++]=At.z}}}P.st&&(st.st=new s.o({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:K})),P.normal&&(st.normal=new s.o({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:Z})),P.tangent&&(st.tangent=new s.o({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j})),P.bitangent&&(st.bitangent=new s.o({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:H}))}if(r.e(t._offsetAttribute)){var xt=q.length,Pt=new Uint8Array(xt/3),gt=t._offsetAttribute===c.z.NONE?0:1;e.d(Pt,gt),st.applyOffset=new s.o({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:Pt})}return new s.I({attributes:st,indices:X,primitiveType:p._0xa706e5.TRIANGLES,boundingSphere:n.i.fromEllipsoid(_t),offsetAttribute:t._offsetAttribute})}}},C.getUnitEllipsoid=function(){return r.e(A)||(A=C.createGeometry(new C({radii:new a.o(1,1,1),vertexFormat:l.n.POSITION_ONLY}))),A},t.b=C}));
