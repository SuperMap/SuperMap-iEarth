import{a as G}from"./chunk-MMOQDUXZ.js";import{a as H}from"./chunk-YORLYHDF.js";import"./chunk-DDMVSBHB.js";import{a as J}from"./chunk-3NSVWFJG.js";import{a as Y}from"./chunk-AMRCVYIA.js";import{a as z}from"./chunk-PJQXYAHT.js";import"./chunk-MPSLJKIO.js";import"./chunk-RYEDLSXB.js";import{a as W}from"./chunk-44AFRGCG.js";import"./chunk-UIA2BV6O.js";import{d as T}from"./chunk-CJHFPVIB.js";import"./chunk-NPAFDOYL.js";import{a as o}from"./chunk-SSYG2MIY.js";import"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import"./chunk-Z4SOZDEW.js";import"./chunk-MX7ZM7WW.js";import"./chunk-EHDXVZQM.js";import"./chunk-NLYLRNUA.js";import"./chunk-7TOCOFC3.js";import"./chunk-ZVKIUA3Y.js";import"./chunk-3HZNWEV7.js";import{a}from"./chunk-LBR6REQR.js";import"./chunk-GXFCHGTA.js";import"./chunk-UBHQMGET.js";import"./chunk-EDZQSM3T.js";import"./chunk-PJGSCWXZ.js";import{a as l}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";function $(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var K=$;var F=new a,j=o.packedLength+a.packedLength,ee=o.packedLength+2,re=o.packedLength+a.packedLength,ne=a.packedLength+1,u={modelMatrix:new o,boundingVolume:new T};function ae(e,t){var r=t*j,i=a.unpack(e,r,F);r+=a.packedLength;var c=o.unpack(e,r,u.modelMatrix);o.multiplyByScale(c,i,c);var n=u.boundingVolume;return a.clone(a.ZERO,n.center),n.radius=Math.sqrt(3),u}function te(e,t){var r=t*ee,i=e[r++],c=e[r++],n=a.fromElements(i,i,c,F),d=o.unpack(e,r,u.modelMatrix);o.multiplyByScale(d,n,d);var s=u.boundingVolume;return a.clone(a.ZERO,s.center),s.radius=Math.sqrt(2),u}function de(e,t){var r=t*re,i=a.unpack(e,r,F);r+=a.packedLength;var c=o.unpack(e,r,u.modelMatrix);o.multiplyByScale(c,i,c);var n=u.boundingVolume;return a.clone(a.ZERO,n.center),n.radius=1,u}function ie(e,t){var r=t*ne,i=e[r++],c=a.unpack(e,r,F),n=o.fromTranslation(c,u.modelMatrix);o.multiplyByUniformScale(n,i,n);var d=u.boundingVolume;return a.clone(a.ZERO,d.center),d.radius=1,u}var oe=new a;function S(e,t,r,i,c){if(!!l(t)){for(var n=r.length,d=i.attributes.position.values,s=i.indices,O=e.positions,m=e.vertexBatchIds,f=e.indices,x=e.batchIds,p=e.batchTableColors,h=e.batchedIndices,U=e.indexOffsets,P=e.indexCounts,C=e.boundingVolumes,Z=e.modelMatrix,D=e.center,L=e.positionOffset,y=e.batchIdIndex,w=e.indexOffset,q=e.batchedIndicesOffset,M=0;M<n;++M){var E=c(t,M),B=E.modelMatrix;o.multiply(Z,B,B);for(var I=r[M],A=d.length,v=0;v<A;v+=3){var b=a.unpack(d,v,oe);o.multiplyByPoint(B,b,b),a.subtract(b,D,b),a.pack(b,O,L*3+v),m[y++]=I}for(var V=s.length,k=0;k<V;++k)f[w+k]=s[k]+L;var g=M+q;h[g]=new K({offset:w,count:V,color:G.fromRgba(p[I]),batchIds:[I]}),x[g]=I,U[g]=w,P[g]=V,C[g]=T.transform(E.boundingVolume,B),L+=A/3,w+=V}e.positionOffset=L,e.batchIdIndex=y,e.indexOffset=w,e.batchedIndicesOffset+=n}}var Q=new a,X=new o;function ce(e){var t=new Float64Array(e),r=0;a.unpack(t,r,Q),r+=a.packedLength,o.unpack(t,r,X)}function le(e){for(var t=e.length,r=0,i=0;i<t;++i)r+=G.packedLength+3+e[i].batchIds.length;return r}function se(e,t,r){var i=r.length,c=1+1+i*T.packedLength+1+le(t),n=new Float64Array(c),d=0;n[d++]=e,n[d++]=i;for(var s=0;s<i;++s)T.pack(r[s],n,d),d+=T.packedLength;var O=t.length;n[d++]=O;for(var m=0;m<O;++m){var f=t[m];G.pack(f.color,n,d),d+=G.packedLength,n[d++]=f.offset,n[d++]=f.count;var x=f.batchIds,p=x.length;n[d++]=p;for(var h=0;h<p;++h)n[d++]=x[h]}return n}function ue(e,t){var r=l(e.boxes)?new Float32Array(e.boxes):void 0,i=l(e.boxBatchIds)?new Uint16Array(e.boxBatchIds):void 0,c=l(e.cylinders)?new Float32Array(e.cylinders):void 0,n=l(e.cylinderBatchIds)?new Uint16Array(e.cylinderBatchIds):void 0,d=l(e.ellipsoids)?new Float32Array(e.ellipsoids):void 0,s=l(e.ellipsoidBatchIds)?new Uint16Array(e.ellipsoidBatchIds):void 0,O=l(e.spheres)?new Float32Array(e.spheres):void 0,m=l(e.sphereBatchIds)?new Uint16Array(e.sphereBatchIds):void 0,f=l(r)?i.length:0,x=l(c)?n.length:0,p=l(d)?s.length:0,h=l(O)?m.length:0,U=z.getUnitBox(),P=H.getUnitCylinder(),C=J.getUnitEllipsoid(),Z=U.attributes.position.values,D=P.attributes.position.values,L=C.attributes.position.values,y=Z.length*f;y+=D.length*x,y+=L.length*(p+h);var w=U.indices,q=P.indices,M=C.indices,E=w.length*f;E+=q.length*x,E+=M.length*(p+h);var B=new Float32Array(y),I=new Uint16Array(y/3),A=W.createTypedArray(y/3,E),v=f+x+p+h,b=new Uint16Array(v),V=new Array(v),k=new Uint32Array(v),g=new Uint32Array(v),_=new Array(v);ce(e.packedBuffer);var R={batchTableColors:new Uint32Array(e.batchTableColors),positions:B,vertexBatchIds:I,indices:A,batchIds:b,batchedIndices:V,indexOffsets:k,indexCounts:g,boundingVolumes:_,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:X,center:Q};S(R,r,i,U,ae),S(R,c,n,P,te),S(R,d,s,C,de),S(R,O,m,C,ie);var N=se(A.BYTES_PER_ELEMENT,V,_);return t.push(B.buffer,I.buffer,A.buffer),t.push(b.buffer,k.buffer,g.buffer),t.push(N.buffer),{positions:B.buffer,vertexBatchIds:I.buffer,indices:A.buffer,indexOffsets:k.buffer,indexCounts:g.buffer,batchIds:b.buffer,packedBuffer:N.buffer}}var Oe=Y(ue);export{Oe as default};
