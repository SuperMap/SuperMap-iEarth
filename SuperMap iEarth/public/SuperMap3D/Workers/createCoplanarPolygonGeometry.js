import{a as te}from"./chunk-UWLNAHLB.js";import{a as y}from"./chunk-RYEDLSXB.js";import{a as V}from"./chunk-7EIPFHRT.js";import"./chunk-GBIJBBIM.js";import{a as D}from"./chunk-6XL2J7NU.js";import"./chunk-SP6GVFX5.js";import"./chunk-LA5E7NVT.js";import{b as oe}from"./chunk-5MCHN7YC.js";import{a as re}from"./chunk-D45ASFTR.js";import"./chunk-6X6ULKRC.js";import{a as ee}from"./chunk-UPTNMXYL.js";import{a as I}from"./chunk-JV52GS34.js";import"./chunk-MQMYX2JZ.js";import"./chunk-KW5QJXXE.js";import"./chunk-5YCA7L25.js";import"./chunk-4J7EQ5UP.js";import{a as J}from"./chunk-44AFRGCG.js";import{a as $}from"./chunk-UIA2BV6O.js";import{d as K,g as M,k as Y,l as S}from"./chunk-CWROUHP4.js";import"./chunk-NPAFDOYL.js";import{b as X}from"./chunk-F5UB2CPM.js";import{a as H}from"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import{a as u}from"./chunk-KJYJTW2V.js";import"./chunk-6NA2GRXE.js";import"./chunk-EHDXVZQM.js";import"./chunk-NLYLRNUA.js";import{a as j,b as s}from"./chunk-7TOCOFC3.js";import"./chunk-ZVKIUA3Y.js";import"./chunk-3HZNWEV7.js";import{a as o}from"./chunk-LBR6REQR.js";import{a as N}from"./chunk-GXFCHGTA.js";import{a as v}from"./chunk-UBHQMGET.js";import{a as E}from"./chunk-EDZQSM3T.js";import"./chunk-PJGSCWXZ.js";import{a as z}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";var pe=new o,me=new te,se=new j,le=new j,fe=new o,ve=new o,ye=new o,R=new o,ue=new o,he=new o,ie=new M,de=new u,ge=new u,we=new o;function Pe(r,e,t,l,m,i,n,a){var c=r.positions,f=oe.triangulate(r.positions2D,r.holes);f.length<3&&(f=[0,1,2]);var F=J.createTypedArray(c.length,f.length);F.set(f);var d=de;if(l!==0){var C=M.fromAxisAngle(i,l,ie);if(d=u.fromQuaternion(C,d),e.tangent||e.bitangent){C=M.fromAxisAngle(i,-l,ie);var G=u.fromQuaternion(C,ge);n=o.normalize(u.multiplyByVector(G,n,n),n),e.bitangent&&(a=o.normalize(o.cross(i,n,a),a))}}else d=u.clone(u.IDENTITY,d);var A=le;e.st&&(A.x=t.x,A.y=t.y);for(var b=c.length,g=b*3,T=new Float64Array(g),k=e.normal?new Float32Array(g):void 0,w=e.tangent?new Float32Array(g):void 0,h=e.bitangent?new Float32Array(g):void 0,O=e.st?new Float32Array(b*2):void 0,p=0,_=0,q=0,Q=0,Z=0,U=0;U<b;U++){var B=c[U];if(T[p++]=B.x,T[p++]=B.y,T[p++]=B.z,e.st){var ne=u.multiplyByVector(d,B,pe),x=m(ne,se);j.subtract(x,A,x);var ae=N.clamp(x.x/t.width,0,1),ce=N.clamp(x.y/t.height,0,1);O[Z++]=ae,O[Z++]=ce}e.normal&&(k[_++]=i.x,k[_++]=i.y,k[_++]=i.z),e.tangent&&(w[Q++]=n.x,w[Q++]=n.y,w[Q++]=n.z),e.bitangent&&(h[q++]=a.x,h[q++]=a.y,h[q++]=a.z)}var L=new $;return e.position&&(L.position=new S({componentDatatype:H.DOUBLE,componentsPerAttribute:3,values:T})),e.normal&&(L.normal=new S({componentDatatype:H.FLOAT,componentsPerAttribute:3,values:k})),e.tangent&&(L.tangent=new S({componentDatatype:H.FLOAT,componentsPerAttribute:3,values:w})),e.bitangent&&(L.bitangent=new S({componentDatatype:H.FLOAT,componentsPerAttribute:3,values:h})),e.st&&(L.st=new S({componentDatatype:H.FLOAT,componentsPerAttribute:2,values:O})),new Y({attributes:L,indices:F,primitiveType:X.TRIANGLES})}function P(r){r=v(r,v.EMPTY_OBJECT);var e=r.polygonHierarchy;E.defined("options.polygonHierarchy",e);var t=v(r.vertexFormat,y.DEFAULT);this._vertexFormat=y.clone(t),this._polygonHierarchy=e,this._stRotation=v(r.stRotation,0),this._ellipsoid=s.clone(v(r.ellipsoid,s.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=D.computeHierarchyPackedLength(e)+y.packedLength+s.packedLength+2}P.fromPositions=function(r){r=v(r,v.EMPTY_OBJECT),E.defined("options.positions",r.positions);var e={polygonHierarchy:{positions:r.positions},vertexFormat:r.vertexFormat,stRotation:r.stRotation,ellipsoid:r.ellipsoid};return new P(e)};P.pack=function(r,e,t){return E.typeOf.object("value",r),E.defined("array",e),t=v(t,0),t=D.packPolygonHierarchy(r._polygonHierarchy,e,t),s.pack(r._ellipsoid,e,t),t+=s.packedLength,y.pack(r._vertexFormat,e,t),t+=y.packedLength,e[t++]=r._stRotation,e[t]=r.packedLength,e};var Ae=s.clone(s.UNIT_SPHERE),be=new y,Te={polygonHierarchy:{}};P.unpack=function(r,e,t){E.defined("array",r),e=v(e,0);var l=D.unpackPolygonHierarchy(r,e);e=l.startingIndex,delete l.startingIndex;var m=s.unpack(r,e,Ae);e+=s.packedLength;var i=y.unpack(r,e,be);e+=y.packedLength;var n=r[e++],a=r[e];return z(t)||(t=new P(Te)),t._polygonHierarchy=l,t._ellipsoid=s.clone(m,t._ellipsoid),t._vertexFormat=y.clone(i,t._vertexFormat),t._stRotation=n,t.packedLength=a,t};P.createGeometry=function(r){var e=r._vertexFormat,t=r._polygonHierarchy,l=r._stRotation,m=t.positions;if(m=re(m,o.equalsEpsilon,!0),!(m.length<3)){var i=fe,n=ve,a=ye,c=ue,f=he,F=V.computeProjectTo2DArguments(m,R,c,f);if(!!F){if(i=o.cross(c,f,i),i=o.normalize(i,i),!o.equalsEpsilon(R,o.ZERO,N.EPSILON6)){var d=r._ellipsoid.geodeticSurfaceNormal(R,we);o.dot(i,d)<0&&(i=o.negate(i,i),c=o.negate(c,c))}var C=V.createProjectPointsTo2DFunction(R,c,f),G=V.createProjectPointTo2DFunction(R,c,f);e.tangent&&(n=o.clone(c,n)),e.bitangent&&(a=o.clone(f,a));var A=D.polygonsFromHierarchy(t,C,!1),b=A.hierarchy,g=A.polygons;if(b.length!==0){m=b[0].outerRing;for(var T=K.fromPoints(m),k=D.computeBoundingRectangle(i,G,m,l,me),w=[],h=0;h<g.length;h++){var O=new ee({geometry:Pe(g[h],e,k,l,G,i,n,a)});w.push(O)}var p=I.combineInstances(w)[0];p.attributes.position.values=new Float64Array(p.attributes.position.values),p.indices=J.createTypedArray(p.attributes.position.values.length/3,p.indices);var _=p.attributes;return e.position||delete _.position,new Y({attributes:_,indices:p.indices,primitiveType:p.primitiveType,boundingSphere:T})}}}};var W=P;function ke(r,e){return z(e)&&(r=W.unpack(r,e)),W.createGeometry(r)}var $e=ke;export{$e as default};
