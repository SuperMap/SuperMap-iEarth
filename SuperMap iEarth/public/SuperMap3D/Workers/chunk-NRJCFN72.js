import{a as X}from"./chunk-J67OD5PY.js";import{b as ur}from"./chunk-HOZ5IOFP.js";import{g as er,j as tr}from"./chunk-CJHFPVIB.js";import{a as F}from"./chunk-SSYG2MIY.js";import{a as b}from"./chunk-Z4SOZDEW.js";import{a as fr}from"./chunk-7TOCOFC3.js";import{a as dr}from"./chunk-ZVKIUA3Y.js";import{b as hr}from"./chunk-3HZNWEV7.js";import{a as r}from"./chunk-LBR6REQR.js";import{a as W}from"./chunk-GXFCHGTA.js";var Ir={ROUNDED:0,MITERED:1,BEVELED:2},q=Object.freeze(Ir);var d=[new r,new r],Sr=new r,Br=new r,Er=new r,xr=new r,Tr=new r,zr=new r,Ar=new r,Cr=new r,Nr=new r,J=new r,nr=new r,K={},yr=new hr;function Dr(t,v){for(var l=new Array(t.length),e=0;e<t.length;e++){var a=t[e];yr=v.cartesianToCartographic(a,yr),l[e]=yr.height,t[e]=v.scaleToGeodeticSurface(a,a)}return l}function k(t,v,l,e){var a=t[0],o=t[1],n=r.angleBetween(a,o),i=Math.ceil(n/e),m=new Array(i),c;if(v===l){for(c=0;c<i;c++)m[c]=v;return m.push(l),m}var y=l-v,B=y/i;for(c=1;c<i;c++){var w=v+c*B;m[c]=w}return m[0]=v,m.push(l),m}var vr=new r,lr=new r;function Fr(t,v,l,e){var a=new ur(l,e),o=a.projectPointOntoPlane(r.add(l,t,vr),vr),n=a.projectPointOntoPlane(r.add(l,v,lr),lr),i=fr.angleBetween(o,n);return n.x*o.y-n.y*o.x>=0?-i:i}var Lr=new r(-1,0,0),L=F.clone(F.IDENTITY),Vr=new F,P=new b,Mr=b.IDENTITY.clone(),Or=new r,Gr=new dr,or=new r;function I(t,v,l,e,a,o,n,i){var m=Or,c=Gr;L=tr.eastNorthUpToFixedFrame(t,a,L),m=F.multiplyByPointAsVector(L,Lr,m),m=r.normalize(m,m);var y=Fr(m,v,t,a);P=b.fromRotationZ(y,P),or.z=o,L=F.multiplyTransformation(L,F.fromRotationTranslation(P,or,Vr),L);var B=Mr;B[0]=n;for(var w=0;w<i;w++)for(var s=0;s<l.length;s+=3)c=r.fromArray(l,s,c),c=b.multiplyByVector(B,c,c),c=F.multiplyByPoint(L,c,c),e.push(c.x,c.y,c.z);return e}function $(t,v,l,e,a,o,n,i,m){var c=Or,y=Gr;L=tr.eastNorthUpToFixedFrame(t,a,L),c=F.multiplyByPointAsVector(L,Lr,c),c=r.normalize(c,c);var B=Fr(c,v,t,a);P=b.fromRotationZ(B,P),or.z=o,L=F.multiplyTransformation(L,F.fromRotationTranslation(P,or,Vr),L);var w=Mr;w[0]=n;for(var s=0;s<i;s++)for(var p=0;p<l.length;p+=3)y=r.fromArray(l,p,y),y=b.multiplyByVector(w,y,y),y=F.multiplyByPoint(L,y,y),y=F.multiplyByPoint(m,y,y),e.push(y.x,y.y,y.z);return e}var Ur=new r;function rr(t,v,l,e,a,o,n){for(var i=0;i<t.length;i+=3){var m=r.fromArray(t,i,Ur);e=I(m,v,l,e,a,o[i/3],n,1)}return e}function Qr(t,v,l,e,a,o,n,i){for(var m=0;m<t.length;m+=3){var c=r.fromArray(t,m,Ur);e=$(c,v,l,e,a,o[m/3],n,1,i)}return e}function _r(t,v){var l=t.length,e=new Array(l*6),a=0,o=v.x+v.width/2,n=v.y+v.height/2,i=t[0];e[a++]=i.x-o,e[a++]=0,e[a++]=i.y-n;for(var m=1;m<l;m++){i=t[m];var c=i.x-o,y=i.y-n;e[a++]=c,e[a++]=0,e[a++]=y,e[a++]=c,e[a++]=0,e[a++]=y}return i=t[0],e[a++]=i.x-o,e[a++]=0,e[a++]=i.y-n,e}function cr(t,v){for(var l=t.length,e=new Array(l*3),a=0,o=v.x+v.width/2,n=v.y+v.height/2,i=0;i<l;i++)e[a++]=t[i].x-o,e[a++]=0,e[a++]=t[i].y-n;return e}var gr=new er,pr=new r,wr=new b;function ir(t,v,l,e,a,o,n,i,m,c){var y=r.angleBetween(r.subtract(v,t,J),r.subtract(l,t,nr)),B=e===q.BEVELED?0:Math.ceil(y/W.toRadians(5)),w;a?w=b.fromQuaternion(er.fromAxisAngle(r.negate(t,J),y/(B+1),gr),wr):w=b.fromQuaternion(er.fromAxisAngle(t,y/(B+1),gr),wr);var s,p;if(v=r.clone(v,pr),B>0)for(var E=c?2:1,S=0;S<B;S++)v=b.multiplyByVector(w,v,v),s=r.subtract(v,t,J),s=r.normalize(s,s),a||(s=r.negate(s,s)),p=o.scaleToGeodeticSurface(v,nr),n=I(p,s,i,n,o,m,1,E);else s=r.subtract(v,t,J),s=r.normalize(s,s),a||(s=r.negate(s,s)),p=o.scaleToGeodeticSurface(v,nr),n=I(p,s,i,n,o,m,1,1),l=r.clone(l,pr),s=r.subtract(l,t,J),s=r.normalize(s,s),a||(s=r.negate(s,s)),p=o.scaleToGeodeticSurface(l,nr),n=I(p,s,i,n,o,m,1,1);return n}K.removeDuplicatesFromShape=function(t){for(var v=t.length,l=[],e=v-1,a=0;a<v;e=a++){var o=t[e],n=t[a];fr.equals(o,n)||l.push(n)}return l};K.angleIsGreaterThanPi=function(t,v,l,e){var a=new ur(l,e),o=a.projectPointOntoPlane(r.add(l,t,vr),vr),n=a.projectPointOntoPlane(r.add(l,v,lr),lr);return n.x*o.y-n.y*o.x>=0};var br=new r,qr=new r;K.computePositions=function(t,v,l,e,a){var o=e._ellipsoid,n=Dr(t,o),i=e._granularity,m=e._cornerType,c=a?_r(v,l):cr(v,l),y=a?cr(v,l):void 0,B=l.height/2,w=l.width/2,s=t.length,p=[],E=a?[]:void 0,S=Sr,U=Br,f=Er,T=xr,g=Tr,x=zr,C=Ar,h=Cr,A=Nr,u=t[0],N=t[1];T=o.geodeticSurfaceNormal(u,T),S=r.subtract(N,u,S),S=r.normalize(S,S),h=r.cross(T,S,h),h=r.normalize(h,h);var Q=n[0],D=n[1];a&&(E=I(u,h,y,E,o,Q+B,1,1)),A=r.clone(u,A),u=N,U=r.negate(S,U);for(var z,M,_=1;_<s-1;_++){var V=a?2:1;N=t[_+1],S=r.subtract(N,u,S),S=r.normalize(S,S),f=r.add(S,U,f),f=r.normalize(f,f),T=o.geodeticSurfaceNormal(u,T);var O=r.multiplyByScalar(T,r.dot(S,T),br);r.subtract(S,O,O),r.normalize(O,O);var G=r.multiplyByScalar(T,r.dot(U,T),qr);r.subtract(U,G,G),r.normalize(G,G);var R=!W.equalsEpsilon(Math.abs(r.dot(O,G)),1,W.EPSILON7);if(R){f=r.cross(f,T,f),f=r.cross(T,f,f),f=r.normalize(f,f);var Z=1/Math.max(.25,r.magnitude(r.cross(f,U,J))),H=K.angleIsGreaterThanPi(S,U,u,o);H?(g=r.add(u,r.multiplyByScalar(f,Z*w,f),g),x=r.add(g,r.multiplyByScalar(h,w,x),x),d[0]=r.clone(A,d[0]),d[1]=r.clone(x,d[1]),z=k(d,Q+B,D+B,i),M=X.generateArc({positions:d,granularity:i,ellipsoid:o}),p=rr(M,h,c,p,o,z,1),h=r.cross(T,S,h),h=r.normalize(h,h),C=r.add(g,r.multiplyByScalar(h,w,C),C),m===q.ROUNDED||m===q.BEVELED?ir(g,x,C,m,H,o,p,c,D+B,a):(f=r.negate(f,f),p=I(u,f,c,p,o,D+B,Z,V)),A=r.clone(C,A)):(g=r.add(u,r.multiplyByScalar(f,Z*w,f),g),x=r.add(g,r.multiplyByScalar(h,-w,x),x),d[0]=r.clone(A,d[0]),d[1]=r.clone(x,d[1]),z=k(d,Q+B,D+B,i),M=X.generateArc({positions:d,granularity:i,ellipsoid:o}),p=rr(M,h,c,p,o,z,1),h=r.cross(T,S,h),h=r.normalize(h,h),C=r.add(g,r.multiplyByScalar(h,-w,C),C),m===q.ROUNDED||m===q.BEVELED?ir(g,x,C,m,H,o,p,c,D+B,a):p=I(u,f,c,p,o,D+B,Z,V),A=r.clone(C,A)),U=r.negate(S,U)}else p=I(A,h,c,p,o,Q+B,1,1),A=u;Q=D,D=n[_+1],u=N}d[0]=r.clone(A,d[0]),d[1]=r.clone(u,d[1]),z=k(d,Q+B,D+B,i),M=X.generateArc({positions:d,granularity:i,ellipsoid:o}),p=rr(M,h,c,p,o,z,1),a&&(E=I(u,h,y,E,o,D+B,1,1)),s=p.length;var Y=a?s+E.length:s,j=new Float64Array(Y);return j.set(p),a&&j.set(E,s),j};K.computeLocalPositions=function(t,v,l,e,a,o){var n=e._ellipsoid,i=Dr(t,n),m=e._granularity,c=e._cornerType,y=a?_r(v,l):cr(v,l),B=a?cr(v,l):void 0,w=0,s=l.width/2,p=t.length,E=[],S=a?[]:void 0,U=[],f=Sr,T=Br,g=Er,x=xr,C=Tr,h=zr,A=Ar,u=Cr,N=Nr,Q=tr.eastNorthUpToFixedFrame(o,n,new F),D=F.inverse(Q,new F),z=t[0],M=t[1];x=n.geodeticSurfaceNormal(z,x),f=r.subtract(M,z,f),f=r.normalize(f,f),u=r.cross(x,f,u),u=r.normalize(u,u);var _=i[0],V=i[1];a&&(S=$(z,u,B,S,n,_+w,1,1,D)),N=r.clone(z,N),z=M,T=r.negate(f,T);for(var O,G,R=1;R<p-1;R++){var Z=a?2:1;M=t[R+1],f=r.subtract(M,z,f),f=r.normalize(f,f),g=r.add(f,T,g),g=r.normalize(g,g),x=n.geodeticSurfaceNormal(z,x);var H=r.multiplyByScalar(x,r.dot(f,x),br);r.subtract(f,H,H),r.normalize(H,H);var Y=r.multiplyByScalar(x,r.dot(T,x),qr);r.subtract(T,Y,Y),r.normalize(Y,Y);var j=!W.equalsEpsilon(Math.abs(r.dot(H,Y)),1,W.EPSILON7);if(j){g=r.cross(g,x,g),g=r.cross(x,g,g),g=r.normalize(g,g);var ar=1/Math.max(.25,r.magnitude(r.cross(g,T,J))),mr=K.angleIsGreaterThanPi(f,T,z,n);mr?(C=r.add(z,r.multiplyByScalar(g,ar*s,g),C),h=r.add(C,r.multiplyByScalar(u,s,h),h),d[0]=r.clone(N,d[0]),d[1]=r.clone(h,d[1]),O=k(d,_+w,V+w,m),G=X.generateArc({positions:d,granularity:m,ellipsoid:n}),E=rr(G,u,y,E,n,O,1,fromEnu,U),u=r.cross(x,f,u),u=r.normalize(u,u),A=r.add(C,r.multiplyByScalar(u,s,A),A),c===q.ROUNDED||c===q.BEVELED?ir(C,h,A,c,mr,n,E,y,V+w,a):(g=r.negate(g,g),E=$(z,g,y,E,n,V+w,ar,Z,D)),N=r.clone(A,N)):(C=r.add(z,r.multiplyByScalar(g,ar*s,g),C),h=r.add(C,r.multiplyByScalar(u,-s,h),h),d[0]=r.clone(N,d[0]),d[1]=r.clone(h,d[1]),O=k(d,_+w,V+w,m),G=X.generateArc({positions:d,granularity:m,ellipsoid:n}),E=rr(G,u,y,E,n,O,1),u=r.cross(x,f,u),u=r.normalize(u,u),A=r.add(C,r.multiplyByScalar(u,-s,A),A),c===q.ROUNDED||c===q.BEVELED?ir(C,h,A,c,mr,n,E,y,V+w,a):E=$(z,g,y,E,n,V+w,ar,Z,D),N=r.clone(A,N)),T=r.negate(f,T)}else E=$(N,u,y,E,n,_+w,1,1,D),N=z;_=V,V=i[R+1],z=M}d[0]=r.clone(N,d[0]),d[1]=r.clone(z,d[1]),O=k(d,_+w,V+w,m),G=X.generateArc({positions:d,granularity:m,ellipsoid:n}),E=Qr(G,u,y,E,n,O,1,D),a&&(S=$(z,u,B,S,n,V+w,1,1,D)),p=E.length;var Hr=a?p+S.length:p,sr=new Float64Array(Hr);return sr.set(E),a&&sr.set(S,p),sr};var ea=K;export{q as a,ea as b};
