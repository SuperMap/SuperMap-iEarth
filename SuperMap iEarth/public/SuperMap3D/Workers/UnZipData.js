import{a as M}from"./chunk-AYI5HKFB.js";import{a as U}from"./chunk-36VVQUSW.js";import{a as A}from"./chunk-6ZA5VAZ6.js";import{b as T}from"./chunk-S7TKXIWS.js";import{a as C}from"./chunk-77JEGE4I.js";import{a as N}from"./chunk-AMRCVYIA.js";import{a as l}from"./chunk-6S43R6PL.js";import"./chunk-EHDXVZQM.js";import{a as h}from"./chunk-UBHQMGET.js";import{a as u}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";var R={cCRNFmtInvalid:-1,cCRNFmtDXT1:0,cCRNFmtDXT3:1,cCRNFmtDXT5:2},y={};y[R.cCRNFmtDXT1]=T.RGB_DXT1;y[R.cCRNFmtDXT3]=T.RGBA_DXT3;y[R.cCRNFmtDXT5]=T.RGBA_DXT5;var w,d,D=0,E;function B(n,a,r,i){var t,o=r/4,e=i%4,_=new Uint32Array(n.buffer,0,(i-e)/4),v=new Uint32Array(a.buffer);for(t=0;t<_.length;t++)v[o+t]=_[t];for(t=i-e;t<i;t++)a[r+t]=n[t]}function F(n){var a=n.data,r=a.byteLength,i=new Uint8Array(a,n.offset),t=E._malloc(r);B(i,E.HEAPU8,t,r);var o=E._crn_get_dxt_format(t,r),e=y[o];if(!u(e))throw new l("Unsupported compressed format.");var _=E._crn_get_levels(t,r),v=E._crn_get_width(t,r),s=E._crn_get_height(t,r),f=0,m;for(m=0;m<_;++m)f+=T.compressedTextureSizeInBytes(e,v>>m,s>>m);D<f&&(u(w)&&E._free(w),w=E._malloc(f),d=new Uint8Array(E.HEAPU8.buffer,w,f),D=f),E._crn_decompress(t,r,w,f,0,_),E._free(t);var c=h(n.bMipMap,!1);if(c){var S=d.slice(0,f);return new A(e,v,s,S)}else{var p=T.compressedTextureSizeInBytes(e,v,s),L=d.subarray(0,p),g=new Uint8Array(p);return g.set(L,0),new A(e,v,s,g)}}function P(n){var a=new DataView(n),r=0,i=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var t=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var o=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var e=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var _=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var v=n.slice(r,r+_),s=F({data:v}).bufferView,f=new ArrayBuffer(r+s.byteLength),m=new Uint8Array(f),c=new Uint32Array(f);return r=0,c[0]=i,r+=Uint32Array.BYTES_PER_ELEMENT,c[1]=t,r+=Uint32Array.BYTES_PER_ELEMENT,c[2]=o,r+=Uint32Array.BYTES_PER_ELEMENT,c[3]=e,r+=Uint32Array.BYTES_PER_ELEMENT,c[4]=s.byteLength,r+=Uint32Array.BYTES_PER_ELEMENT,m.set(s,r),f}function X(n,a){for(var r=n.data,i=[],t=0;t<r.length;t++){var o=r[t],e;try{var _=new Uint8Array(o.zipBuffer);e=C.inflate(_).buffer;var v=new DataView(e),s=v.getUint32(0,!0);s===M.CRN_DXT5&&(e=P(e)),a.push(e),i.push({unzipBuffer:e,name:o.name})}catch{o.unzipLength===o.zippedLength&&(e=o.zipBuffer.buffer,n.isCRN&&(e=P(e)),a.push(e),i.push({unzipBuffer:e,name:o.name}));continue}}return{data:i}}async function Y(n){let a=n.webAssemblyConfig;return u(a)&&u(a.wasmBinary)?(await U.init(a.wasmBinary),E=U,!0):!1}async function x(n,a){return n.webAssemblyConfig?Y(n,a):X(n,a)}var q=N(x);export{q as default};
