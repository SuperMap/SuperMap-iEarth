import{a as ir,b as ar}from"./chunk-K7EPBLTH.js";import{a as Ue}from"./chunk-VZ2V43FJ.js";import{a as Pe}from"./chunk-AMRCVYIA.js";import{a as rr}from"./chunk-I6IKQZ7N.js";import{a as er}from"./chunk-HOZ5IOFP.js";import"./chunk-ZMHH4UFY.js";import"./chunk-6X6ULKRC.js";import"./chunk-MQMYX2JZ.js";import"./chunk-REXJO6A6.js";import"./chunk-EUSYH4JF.js";import{d as Ke,j as $e}from"./chunk-CJHFPVIB.js";import"./chunk-NPAFDOYL.js";import{a as Ie}from"./chunk-SSYG2MIY.js";import"./chunk-SRPTWKHW.js";import{a as Ne}from"./chunk-6S43R6PL.js";import"./chunk-Z4SOZDEW.js";import"./chunk-MX7ZM7WW.js";import"./chunk-EHDXVZQM.js";import{a as me}from"./chunk-NLYLRNUA.js";import{a as Je,b as pe}from"./chunk-7TOCOFC3.js";import"./chunk-ZVKIUA3Y.js";import"./chunk-3HZNWEV7.js";import{a as ee}from"./chunk-LBR6REQR.js";import{a as ve}from"./chunk-GXFCHGTA.js";import{a as z}from"./chunk-UBHQMGET.js";import"./chunk-EDZQSM3T.js";import{a as ue}from"./chunk-PJGSCWXZ.js";import{a as W}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";var pr={NONE:0,LERC:1},nr=Object.freeze(pr);var j={};j.DEFAULT_STRUCTURE=Object.freeze({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});var Re=new ee,Ir=new Ie,Ur=new ee,xr=new ee;j.computeVertices=function(A){if(!W(A)||!W(A.heightmap))throw new ue("options.heightmap is required.");if(!W(A.width)||!W(A.height))throw new ue("options.width and options.height are required.");if(!W(A.nativeRectangle))throw new ue("options.nativeRectangle is required.");if(!W(A.skirtHeight))throw new ue("options.skirtHeight is required.");var ae=Math.cos,X=Math.sin,fe=Math.sqrt,D=Math.atan,V=Math.exp,C=ve.PI_OVER_TWO,_=ve.toRadians,n=A.heightmap,e=A.width,r=A.height,t=A.skirtHeight,a=z(A.isGeographic,!0),i=z(A.ellipsoid,pe.WGS84),s=1/i.maximumRadius,f=A.nativeRectangle,v,m,o,l,h=A.rectangle;W(h)?(v=h.west,m=h.south,o=h.east,l=h.north):a?(v=_(f.west),m=_(f.south),o=_(f.east),l=_(f.north)):(v=f.west*s,m=C-2*D(V(-f.south*s)),o=f.east*s,l=C-2*D(V(-f.north*s)));var u=A.relativeToCenter,c=W(u);u=c?u:ee.ZERO;var g=z(A.exaggeration,1),k=z(A.includeWebMercatorT,!1),y=z(A.structure,j.DEFAULT_STRUCTURE),M=z(y.heightScale,j.DEFAULT_STRUCTURE.heightScale),I=z(y.heightOffset,j.DEFAULT_STRUCTURE.heightOffset),x=z(y.elementsPerHeight,j.DEFAULT_STRUCTURE.elementsPerHeight),p=z(y.stride,j.DEFAULT_STRUCTURE.stride),w=z(y.elementMultiplier,j.DEFAULT_STRUCTURE.elementMultiplier),U=z(y.isBigEndian,j.DEFAULT_STRUCTURE.isBigEndian),T=me.computeWidth(f),L=me.computeHeight(f),d=T/(e-1),S=L/(r-1);a||(T*=s,L*=s);var F=i.radiiSquared,B=F.x,N=F.y,b=F.z,E=65536,H=-65536,he=$e.eastNorthUpToFixedFrame(u,i),xe=Ie.inverseTransformation(he,Ir),re,ie;k&&(re=Ue.geodeticLatitudeToMercatorAngle(m),ie=1/(Ue.geodeticLatitudeToMercatorAngle(l)-re));var G=Ur;G.x=Number.POSITIVE_INFINITY,G.y=Number.POSITIVE_INFINITY,G.z=Number.POSITIVE_INFINITY;var Y=xr;Y.x=Number.NEGATIVE_INFINITY,Y.y=Number.NEGATIVE_INFINITY,Y.z=Number.NEGATIVE_INFINITY;var q=Number.POSITIVE_INFINITY,O=e*r,lr=t>0?e*2+r*2:0,ne=O+lr,ce=new Array(ne),He=new Array(ne),Oe=new Array(ne),_e=k?new Array(ne):[],Te=0,ke=r,ye=0,Me=e;t>0&&(--Te,++ke,--ye,++Me);for(var ge=1e-5,se=Te;se<ke;++se){var Q=se;Q<0&&(Q=0),Q>=r&&(Q=r-1);var Z=f.north-S*Q;a?Z=_(Z):Z=C-2*D(V(-Z*s));var Ve=(Z-m)/(l-m);Ve=ve.clamp(Ve,0,1);var we=se===Te,de=se===ke-1;t>0&&(we?Z+=ge*L:de&&(Z-=ge*L));var Ye=ae(Z),De=X(Z),ze=b*De,Xe;k&&(Xe=(Ue.geodeticLatitudeToMercatorAngle(Z)-re)*ie);for(var le=ye;le<Me;++le){var J=le;J<0&&(J=0),J>=e&&(J=e-1);var Ae=Q*(e*p)+J*p,R;if(x===1)R=n[Ae];else{R=0;var $;if(U)for($=0;$<x;++$)R=R*w+n[Ae+$];else for($=x-1;$>=0;--$)R=R*w+n[Ae+$]}R=(R*M+I)*g,H=Math.max(H,R),E=Math.min(E,R);var K=f.west+d*J;a?K=_(K):K=K*s;var Se=(K-v)/(o-v);Se=ve.clamp(Se,0,1);var P=Q*e+J;if(t>0){var Le=le===ye,Be=le===Me-1,or=we||de||Le||Be,ur=(we||de)&&(Le||Be);if(ur)continue;or&&(R-=t,Le?(P=O+(r-Q-1),K-=ge*T):de?P=O+r+(e-J-1):Be?(P=O+r+e+Q,K+=ge*T):we&&(P=O+r+e+r+J))}var Fe=Ye*ae(K),be=Ye*X(K),qe=B*Fe,Ze=N*be,vr=fe(qe*Fe+Ze*be+ze*De),Ee=1/vr,mr=qe*Ee,hr=Ze*Ee,cr=ze*Ee,oe=new ee;oe.x=mr+Fe*R,oe.y=hr+be*R,oe.z=cr+De*R,ce[P]=oe,He[P]=R,Oe[P]=new Je(Se,Ve),k&&(_e[P]=Xe),Ie.multiplyByPoint(xe,oe,Re),ee.minimumByComponent(Re,G,G),ee.maximumByComponent(Re,Y,Y),q=Math.min(q,R)}}var gr=Ke.fromPoints(ce),We;W(h)&&(We=rr.fromRectangle(h,E,H,i));var je;if(c){var wr=new ir(i);je=wr.computeHorizonCullingPointPossiblyUnderEllipsoid(u,ce,E)}for(var dr=new er(G,Y,u),Ce=new ar(dr,q,H,he,!1,k),Ge=new Float32Array(ne*Ce.getStride()),Qe=0,te=0;te<ne;++te)Qe=Ce.encode(Ge,Qe,ce[te],Oe[te],He[te],void 0,_e[te]);return{vertices:Ge,maximumHeight:H,minimumHeight:E,encoding:Ce,boundingSphere3D:gr,orientedBoundingBox:We,occludeePointInScaledSpace:je}};var tr=j;/* Copyright 2015-2018 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at @preserve */var fr={};(function(){var A=function(){var D={};D.defaultNoDataValue=-34027999387901484e22,D.decode=function(r,t){t=t||{};var a=t.encodedMaskData||t.encodedMaskData===null,i=n(r,t.inputOffset||0,a),s=t.noDataValue!==null?t.noDataValue:D.defaultNoDataValue,f=V(i,t.pixelType||Float32Array,t.encodedMaskData,s,t.returnMask),v={width:i.width,height:i.height,pixelData:f.resultPixels,minValue:f.minValue,maxValue:i.pixels.maxValue,noDataValue:s};return f.resultMask&&(v.maskData=f.resultMask),t.returnEncodedMask&&i.mask&&(v.encodedMaskData=i.mask.bitset?i.mask.bitset:null),t.returnFileInfo&&(v.fileInfo=C(i),t.computeUsedBitDepths&&(v.fileInfo.bitDepths=_(i))),v};var V=function(r,t,a,i,s){var f=0,v=r.pixels.numBlocksX,m=r.pixels.numBlocksY,o=Math.floor(r.width/v),l=Math.floor(r.height/m),h=2*r.maxZError,u=Number.MAX_VALUE,c;a=a||(r.mask?r.mask.bitset:null);var g,k;g=new t(r.width*r.height),s&&a&&(k=new Uint8Array(r.width*r.height));for(var y=new Float32Array(o*l),M,I,x=0;x<=m;x++){var p=x!==m?l:r.height%m;if(p!==0)for(var w=0;w<=v;w++){var U=w!==v?o:r.width%v;if(U!==0){var T=x*r.width*l+w*o,L=r.width-U,d=r.pixels.blocks[f],S,F,B;d.encoding<2?(d.encoding===0?S=d.rawData:(e(d.stuffedData,d.bitsPerPixel,d.numValidPixels,d.offset,h,y,r.pixels.maxValue),S=y),F=0):d.encoding===2?B=0:B=d.offset;var N;if(a)for(I=0;I<p;I++){for(T&7&&(N=a[T>>3],N<<=T&7),M=0;M<U;M++)T&7||(N=a[T>>3]),N&128?(k&&(k[T]=1),c=d.encoding<2?S[F++]:B,u=u>c?c:u,g[T++]=c):(k&&(k[T]=0),g[T++]=i),N<<=1;T+=L}else if(d.encoding<2)for(I=0;I<p;I++){for(M=0;M<U;M++)c=S[F++],u=u>c?c:u,g[T++]=c;T+=L}else for(u=u>B?B:u,I=0;I<p;I++){for(M=0;M<U;M++)g[T++]=B;T+=L}if(d.encoding===1&&F!==d.numValidPixels)throw"Block and Mask do not match";f++}}}return{resultPixels:g,resultMask:k,minValue:u}},C=function(r){return{fileIdentifierString:r.fileIdentifierString,fileVersion:r.fileVersion,imageType:r.imageType,height:r.height,width:r.width,maxZError:r.maxZError,eofOffset:r.eofOffset,mask:r.mask?{numBlocksX:r.mask.numBlocksX,numBlocksY:r.mask.numBlocksY,numBytes:r.mask.numBytes,maxValue:r.mask.maxValue}:null,pixels:{numBlocksX:r.pixels.numBlocksX,numBlocksY:r.pixels.numBlocksY,numBytes:r.pixels.numBytes,maxValue:r.pixels.maxValue,noDataValue:r.noDataValue}}},_=function(r){for(var t=r.pixels.numBlocksX*r.pixels.numBlocksY,a={},i=0;i<t;i++){var s=r.pixels.blocks[i];s.encoding===0?a.float32=!0:s.encoding===1?a[s.bitsPerPixel]=!0:a[0]=!0}return Object.keys(a)},n=function(r,t,a){var i={},s=new Uint8Array(r,t,10);if(i.fileIdentifierString=String.fromCharCode.apply(null,s),i.fileIdentifierString.trim()!=="CntZImage")throw"Unexpected file identifier string: "+i.fileIdentifierString;t+=10;var f=new DataView(r,t,24);if(i.fileVersion=f.getInt32(0,!0),i.imageType=f.getInt32(4,!0),i.height=f.getUint32(8,!0),i.width=f.getUint32(12,!0),i.maxZError=f.getFloat64(16,!0),t+=24,!a)if(f=new DataView(r,t,16),i.mask={},i.mask.numBlocksY=f.getUint32(0,!0),i.mask.numBlocksX=f.getUint32(4,!0),i.mask.numBytes=f.getUint32(8,!0),i.mask.maxValue=f.getFloat32(12,!0),t+=16,i.mask.numBytes>0){var v=new Uint8Array(Math.ceil(i.width*i.height/8));f=new DataView(r,t,i.mask.numBytes);var m=f.getInt16(0,!0),o=2,l=0;do{if(m>0)for(;m--;)v[l++]=f.getUint8(o++);else{var h=f.getUint8(o++);for(m=-m;m--;)v[l++]=h}m=f.getInt16(o,!0),o+=2}while(o<i.mask.numBytes);if(m!==-32768||l<v.length)throw"Unexpected end of mask RLE encoding";i.mask.bitset=v,t+=i.mask.numBytes}else(i.mask.numBytes|i.mask.numBlocksY|i.mask.maxValue)===0&&(i.mask.bitset=new Uint8Array(Math.ceil(i.width*i.height/8)));f=new DataView(r,t,16),i.pixels={},i.pixels.numBlocksY=f.getUint32(0,!0),i.pixels.numBlocksX=f.getUint32(4,!0),i.pixels.numBytes=f.getUint32(8,!0),i.pixels.maxValue=f.getFloat32(12,!0),t+=16;var u=i.pixels.numBlocksX,c=i.pixels.numBlocksY,g=u+(i.width%u>0?1:0),k=c+(i.height%c>0?1:0);i.pixels.blocks=new Array(g*k);for(var y=0,M=0;M<k;M++)for(var I=0;I<g;I++){var x=0,p=r.byteLength-t;f=new DataView(r,t,Math.min(10,p));var w={};i.pixels.blocks[y++]=w;var U=f.getUint8(0);if(x++,w.encoding=U&63,w.encoding>3)throw"Invalid block encoding ("+w.encoding+")";if(w.encoding===2){t++;continue}if(U!==0&&U!==2){if(U>>=6,w.offsetType=U,U===2)w.offset=f.getInt8(1),x++;else if(U===1)w.offset=f.getInt16(1,!0),x+=2;else if(U===0)w.offset=f.getFloat32(1,!0),x+=4;else throw"Invalid block offset type";if(w.encoding===1)if(U=f.getUint8(x),x++,w.bitsPerPixel=U&63,U>>=6,w.numValidPixelsType=U,U===2)w.numValidPixels=f.getUint8(x),x++;else if(U===1)w.numValidPixels=f.getUint16(x,!0),x+=2;else if(U===0)w.numValidPixels=f.getUint32(x,!0),x+=4;else throw"Invalid valid pixel count type"}if(t+=x,w.encoding!==3){var T,L;if(w.encoding===0){var d=(i.pixels.numBytes-1)/4;if(d!==Math.floor(d))throw"uncompressed block has invalid length";T=new ArrayBuffer(d*4),L=new Uint8Array(T),L.set(new Uint8Array(r,t,d*4));var S=new Float32Array(T);w.rawData=S,t+=d*4}else if(w.encoding===1){var F=Math.ceil(w.numValidPixels*w.bitsPerPixel/8),B=Math.ceil(F/4);T=new ArrayBuffer(B*4),L=new Uint8Array(T),L.set(new Uint8Array(r,t,F)),w.stuffedData=new Uint32Array(T),t+=F}}}return i.eofOffset=t,i},e=function(r,t,a,i,s,f,v){var m=(1<<t)-1,o=0,l,h=0,u,c,g=Math.ceil((v-i)/s),k=r.length*4-Math.ceil(t*a/8);for(r[r.length-1]<<=8*k,l=0;l<a;l++){if(h===0&&(c=r[o++],h=32),h>=t)u=c>>>h-t&m,h-=t;else{var y=t-h;u=(c&m)<<y&m,c=r[o++],h=32-y,u+=c>>>h}f[l]=u<g?i+u*s:v}return f};return D}(),ae=function(){"use strict";var D={unstuff:function(n,e,r,t,a,i,s,f){var v=(1<<r)-1,m=0,o,l=0,h,u,c,g,k=n.length*4-Math.ceil(r*t/8);if(n[n.length-1]<<=8*k,a)for(o=0;o<t;o++)l===0&&(u=n[m++],l=32),l>=r?(h=u>>>l-r&v,l-=r):(c=r-l,h=(u&v)<<c&v,u=n[m++],l=32-c,h+=u>>>l),e[o]=a[h];else for(g=Math.ceil((f-i)/s),o=0;o<t;o++)l===0&&(u=n[m++],l=32),l>=r?(h=u>>>l-r&v,l-=r):(c=r-l,h=(u&v)<<c&v,u=n[m++],l=32-c,h+=u>>>l),e[o]=h<g?i+h*s:f},unstuffLUT:function(n,e,r,t,a,i){var s=(1<<e)-1,f=0,v=0,m=0,o=0,l=0,h,u=[],c=n.length*4-Math.ceil(e*r/8);n[n.length-1]<<=8*c;var g=Math.ceil((i-t)/a);for(v=0;v<r;v++)o===0&&(h=n[f++],o=32),o>=e?(l=h>>>o-e&s,o-=e):(m=e-o,l=(h&s)<<m&s,h=n[f++],o=32-m,l+=h>>>o),u[v]=l<g?t+l*a:i;return u.unshift(t),u},unstuff2:function(n,e,r,t,a,i,s,f){var v=(1<<r)-1,m=0,o,l=0,h=0,u,c,g;if(a)for(o=0;o<t;o++)l===0&&(c=n[m++],l=32,h=0),l>=r?(u=c>>>h&v,l-=r,h+=r):(g=r-l,u=c>>>h&v,c=n[m++],l=32-g,u|=(c&(1<<g)-1)<<r-g,h=g),e[o]=a[u];else{var k=Math.ceil((f-i)/s);for(o=0;o<t;o++)l===0&&(c=n[m++],l=32,h=0),l>=r?(u=c>>>h&v,l-=r,h+=r):(g=r-l,u=c>>>h&v,c=n[m++],l=32-g,u|=(c&(1<<g)-1)<<r-g,h=g),e[o]=u<k?i+u*s:f}return e},unstuffLUT2:function(n,e,r,t,a,i){var s=(1<<e)-1,f=0,v=0,m=0,o=0,l=0,h=0,u,c=[],g=Math.ceil((i-t)/a);for(v=0;v<r;v++)o===0&&(u=n[f++],o=32,h=0),o>=e?(l=u>>>h&s,o-=e,h+=e):(m=e-o,l=u>>>h&s,u=n[f++],o=32-m,l|=(u&(1<<m)-1)<<e-m,h=m),c[v]=l<g?t+l*a:i;return c.unshift(t),c},originalUnstuff:function(n,e,r,t){var a=(1<<r)-1,i=0,s,f=0,v,m,o,l=n.length*4-Math.ceil(r*t/8);for(n[n.length-1]<<=8*l,s=0;s<t;s++)f===0&&(m=n[i++],f=32),f>=r?(v=m>>>f-r&a,f-=r):(o=r-f,v=(m&a)<<o&a,m=n[i++],f=32-o,v+=m>>>f),e[s]=v;return e},originalUnstuff2:function(n,e,r,t){var a=(1<<r)-1,i=0,s,f=0,v=0,m,o,l;for(s=0;s<t;s++)f===0&&(o=n[i++],f=32,v=0),f>=r?(m=o>>>v&a,f-=r,v+=r):(l=r-f,m=o>>>v&a,o=n[i++],f=32-l,m|=(o&(1<<l)-1)<<r-l,v=l),e[s]=m;return e}},V={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(n){for(var e=65535,r=65535,t=n.length,a=Math.floor(t/2),i=0;a;){var s=a>=359?359:a;a-=s;do e+=n[i++]<<8,r+=e+=n[i++];while(--s);e=(e&65535)+(e>>>16),r=(r&65535)+(r>>>16)}return t&1&&(r+=e+=n[i]<<8),e=(e&65535)+(e>>>16),r=(r&65535)+(r>>>16),(r<<16|e)>>>0},readHeaderInfo:function(n,e){var r=e.ptr,t=new Uint8Array(n,r,6),a={};if(a.fileIdentifierString=String.fromCharCode.apply(null,t),a.fileIdentifierString.lastIndexOf("Lerc2",0)!==0)throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;r+=6;var i=new DataView(n,r,8),s=i.getInt32(0,!0);a.fileVersion=s,r+=4,s>=3&&(a.checksum=i.getUint32(4,!0),r+=4),i=new DataView(n,r,12),a.height=i.getUint32(0,!0),a.width=i.getUint32(4,!0),r+=8,s>=4?(a.numDims=i.getUint32(8,!0),r+=4):a.numDims=1,i=new DataView(n,r,40),a.numValidPixel=i.getUint32(0,!0),a.microBlockSize=i.getInt32(4,!0),a.blobSize=i.getInt32(8,!0),a.imageType=i.getInt32(12,!0),a.maxZError=i.getFloat64(16,!0),a.zMin=i.getFloat64(24,!0),a.zMax=i.getFloat64(32,!0),r+=40,e.headerInfo=a,e.ptr=r;var f,v;if(s>=3&&(v=s>=4?52:48,f=this.computeChecksumFletcher32(new Uint8Array(n,r-v,a.blobSize-14)),f!==a.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(n,e){var r=e.headerInfo,t=this.getDataTypeArray(r.imageType),a=r.numDims*this.getDataTypeSize(r.imageType),i=this.readSubArray(n,e.ptr,t,a),s=this.readSubArray(n,e.ptr+a,t,a);e.ptr+=2*a;var f,v=!0;for(f=0;f<r.numDims;f++)if(i[f]!==s[f]){v=!1;break}return r.minValues=i,r.maxValues=s,v},readSubArray:function(n,e,r,t){var a;if(r===Uint8Array)a=new Uint8Array(n,e,t);else{var i=new ArrayBuffer(t),s=new Uint8Array(i);s.set(new Uint8Array(n,e,t)),a=new r(i)}return a},readMask:function(n,e){var r=e.ptr,t=e.headerInfo,a=t.width*t.height,i=t.numValidPixel,s=new DataView(n,r,4),f={};if(f.numBytes=s.getUint32(0,!0),r+=4,(i===0||a===i)&&f.numBytes!==0)throw"invalid mask";var v,m;if(i===0)v=new Uint8Array(Math.ceil(a/8)),f.bitset=v,m=new Uint8Array(a),e.pixels.resultMask=m,r+=f.numBytes;else if(f.numBytes>0){v=new Uint8Array(Math.ceil(a/8)),s=new DataView(n,r,f.numBytes);var o=s.getInt16(0,!0),l=2,h=0,u=0;do{if(o>0)for(;o--;)v[h++]=s.getUint8(l++);else for(u=s.getUint8(l++),o=-o;o--;)v[h++]=u;o=s.getInt16(l,!0),l+=2}while(l<f.numBytes);if(o!==-32768||h<v.length)throw"Unexpected end of mask RLE encoding";m=new Uint8Array(a);var c=0,g=0;for(g=0;g<a;g++)g&7?(c=v[g>>3],c<<=g&7):c=v[g>>3],c&128&&(m[g]=1);e.pixels.resultMask=m,f.bitset=v,r+=f.numBytes}return e.ptr=r,e.mask=f,!0},readDataOneSweep:function(n,e,r){var t=e.ptr,a=e.headerInfo,i=a.numDims,s=a.width*a.height,f=a.imageType,v=a.numValidPixel*V.getDataTypeSize(f)*i,m,o=e.pixels.resultMask;if(r===Uint8Array)m=new Uint8Array(n,t,v);else{var l=new ArrayBuffer(v),h=new Uint8Array(l);h.set(new Uint8Array(n,t,v)),m=new r(l)}if(m.length===s*i)e.pixels.resultPixels=m;else{e.pixels.resultPixels=new r(s*i);var u=0,c=0,g=0,k=0;if(i>1)for(g=0;g<i;g++)for(k=g*s,c=0;c<s;c++)o[c]&&(e.pixels.resultPixels[k+c]=m[u++]);else for(c=0;c<s;c++)o[c]&&(e.pixels.resultPixels[c]=m[u++])}return t+=v,e.ptr=t,!0},readHuffmanTree:function(n,e){var r=this.HUFFMAN_LUT_BITS_MAX,t=new DataView(n,e.ptr,16);e.ptr+=16;var a=t.getInt32(0,!0);if(a<2)throw"unsupported Huffman version";var i=t.getInt32(4,!0),s=t.getInt32(8,!0),f=t.getInt32(12,!0);if(s>=f)return!1;var v=new Uint32Array(f-s);V.decodeBits(n,e,v);var m=[],o,l,h,u;for(o=s;o<f;o++)l=o-(o<i?0:i),m[l]={first:v[o-s],second:null};var c=n.byteLength-e.ptr,g=Math.ceil(c/4),k=new ArrayBuffer(g*4),y=new Uint8Array(k);y.set(new Uint8Array(n,e.ptr,c));var M=new Uint32Array(k),I=0,x,p=0;for(x=M[0],o=s;o<f;o++)l=o-(o<i?0:i),u=m[l].first,u>0&&(m[l].second=x<<I>>>32-u,32-I>=u?(I+=u,I===32&&(I=0,p++,x=M[p])):(I+=u-32,p++,x=M[p],m[l].second|=x>>>32-I));var w=0,U=0,T=new C;for(o=0;o<m.length;o++)m[o]!==void 0&&(w=Math.max(w,m[o].first));w>=r?U=r:U=w,w>=30&&console.log("WARning, large NUM LUT BITS IS "+w);var L=[],d,S,F,B,N,b;for(o=s;o<f;o++)if(l=o-(o<i?0:i),u=m[l].first,u>0)if(d=[u,l],u<=U)for(S=m[l].second<<U-u,F=1<<U-u,h=0;h<F;h++)L[S|h]=d;else for(S=m[l].second,b=T,B=u-1;B>=0;B--)N=S>>>B&1,N?(b.right||(b.right=new C),b=b.right):(b.left||(b.left=new C),b=b.left),B===0&&!b.val&&(b.val=d[1]);return{decodeLut:L,numBitsLUTQick:U,numBitsLUT:w,tree:T,stuffedData:M,srcPtr:p,bitPos:I}},readHuffman:function(n,e,r){var t=e.headerInfo,a=t.numDims,i=e.headerInfo.height,s=e.headerInfo.width,f=s*i,v=this.readHuffmanTree(n,e),m=v.decodeLut,o=v.tree,l=v.stuffedData,h=v.srcPtr,u=v.bitPos,c=v.numBitsLUTQick,g=v.numBitsLUT,k=e.headerInfo.imageType===0?128:0,y,M,I,x=e.pixels.resultMask,p,w,U,T,L,d,S,F=0;u>0&&(h++,u=0);var B=l[h],N=e.encodeMode===1,b=new r(f*a),E=b,H;for(H=0;H<t.numDims;H++){if(a>1&&(E=new r(b.buffer,f*H,f),F=0),e.headerInfo.numValidPixel===s*i)for(d=0,T=0;T<i;T++)for(L=0;L<s;L++,d++){if(M=0,p=B<<u>>>32-c,w=p,32-u<c&&(p|=l[h+1]>>>64-u-c,w=p),m[w])M=m[w][1],u+=m[w][0];else for(p=B<<u>>>32-g,w=p,32-u<g&&(p|=l[h+1]>>>64-u-g,w=p),y=o,S=0;S<g;S++)if(U=p>>>g-S-1&1,y=U?y.right:y.left,!(y.left||y.right)){M=y.val,u=u+S+1;break}u>=32&&(u-=32,h++,B=l[h]),I=M-k,N?(L>0?I+=F:T>0?I+=E[d-s]:I+=F,I&=255,E[d]=I,F=I):E[d]=I}else for(d=0,T=0;T<i;T++)for(L=0;L<s;L++,d++)if(x[d]){if(M=0,p=B<<u>>>32-c,w=p,32-u<c&&(p|=l[h+1]>>>64-u-c,w=p),m[w])M=m[w][1],u+=m[w][0];else for(p=B<<u>>>32-g,w=p,32-u<g&&(p|=l[h+1]>>>64-u-g,w=p),y=o,S=0;S<g;S++)if(U=p>>>g-S-1&1,y=U?y.right:y.left,!(y.left||y.right)){M=y.val,u=u+S+1;break}u>=32&&(u-=32,h++,B=l[h]),I=M-k,N?(L>0&&x[d-1]?I+=F:T>0&&x[d-s]?I+=E[d-s]:I+=F,I&=255,E[d]=I,F=I):E[d]=I}e.ptr=e.ptr+(h+1)*4+(u>0?4:0)}e.pixels.resultPixels=b},decodeBits:function(n,e,r,t,a){{var i=e.headerInfo,s=i.fileVersion,f=0,v=n.byteLength-e.ptr>=5?5:n.byteLength-e.ptr,m=new DataView(n,e.ptr,v),o=m.getUint8(0);f++;var l=o>>6,h=l===0?4:3-l,u=(o&32)>0,c=o&31,g=0;if(h===1)g=m.getUint8(f),f++;else if(h===2)g=m.getUint16(f,!0),f+=2;else if(h===4)g=m.getUint32(f,!0),f+=4;else throw"Invalid valid pixel count type";var k=2*i.maxZError,y,M,I,x,p,w,U,T,L,d,S=i.numDims>1?i.maxValues[a]:i.zMax;if(u){for(e.counter.lut++,T=m.getUint8(f),L=c,f++,x=Math.ceil((T-1)*c/8),p=Math.ceil(x/4),M=new ArrayBuffer(p*4),I=new Uint8Array(M),e.ptr+=f,I.set(new Uint8Array(n,e.ptr,x)),U=new Uint32Array(M),e.ptr+=x,d=0;T-1>>>d;)d++;x=Math.ceil(g*d/8),p=Math.ceil(x/4),M=new ArrayBuffer(p*4),I=new Uint8Array(M),I.set(new Uint8Array(n,e.ptr,x)),y=new Uint32Array(M),e.ptr+=x,s>=3?w=D.unstuffLUT2(U,c,T-1,t,k,S):w=D.unstuffLUT(U,c,T-1,t,k,S),s>=3?D.unstuff2(y,r,d,g,w):D.unstuff(y,r,d,g,w)}else e.counter.bitstuffer++,d=c,e.ptr+=f,d>0&&(x=Math.ceil(g*d/8),p=Math.ceil(x/4),M=new ArrayBuffer(p*4),I=new Uint8Array(M),I.set(new Uint8Array(n,e.ptr,x)),y=new Uint32Array(M),e.ptr+=x,s>=3?t===null?D.originalUnstuff2(y,r,d,g):D.unstuff2(y,r,d,g,!1,t,k,S):t===null?D.originalUnstuff(y,r,d,g):D.unstuff(y,r,d,g,!1,t,k,S))}},readTiles:function(n,e,r){var t=e.headerInfo,a=t.width,i=t.height,s=t.microBlockSize,f=t.imageType,v=V.getDataTypeSize(f),m=Math.ceil(a/s),o=Math.ceil(i/s);e.pixels.numBlocksY=o,e.pixels.numBlocksX=m,e.pixels.ptr=0;var l=0,h=0,u=0,c=0,g=0,k=0,y=0,M=0,I=0,x=0,p=0,w=0,U=0,T=0,L=0,d=0,S,F,B,N,b,E,H=new r(s*s),he=i%s||s,xe=a%s||s,re,ie,G=t.numDims,Y,q=e.pixels.resultMask,O=e.pixels.resultPixels;for(u=0;u<o;u++)for(g=u!==o-1?s:he,c=0;c<m;c++)for(k=c!==m-1?s:xe,p=u*a*s+c*s,w=a-k,Y=0;Y<G;Y++){if(G>1&&(O=new r(e.pixels.resultPixels.buffer,a*i*Y*v,a*i)),y=n.byteLength-e.ptr,S=new DataView(n,e.ptr,Math.min(10,y)),F={},d=0,M=S.getUint8(0),d++,I=M>>6&255,x=M>>2&15,x!==(c*s>>3&15))throw"integrity issue";if(E=M&3,E>3)throw e.ptr+=d,"Invalid block encoding ("+E+")";if(E===2){e.counter.constant++,e.ptr+=d;continue}else if(E===0){if(e.counter.uncompressed++,e.ptr+=d,U=g*k*v,T=n.byteLength-e.ptr,U=U<T?U:T,B=new ArrayBuffer(U%v===0?U:U+v-U%v),N=new Uint8Array(B),N.set(new Uint8Array(n,e.ptr,U)),b=new r(B),L=0,q)for(l=0;l<g;l++){for(h=0;h<k;h++)q[p]&&(O[p]=b[L++]),p++;p+=w}else for(l=0;l<g;l++){for(h=0;h<k;h++)O[p++]=b[L++];p+=w}e.ptr+=L*v}else if(re=V.getDataTypeUsed(f,I),ie=V.getOnePixel(F,d,re,S),d+=V.getDataTypeSize(re),E===3)if(e.ptr+=d,e.counter.constantoffset++,q)for(l=0;l<g;l++){for(h=0;h<k;h++)q[p]&&(O[p]=ie),p++;p+=w}else for(l=0;l<g;l++){for(h=0;h<k;h++)O[p++]=ie;p+=w}else if(e.ptr+=d,V.decodeBits(n,e,H,ie,Y),d=0,q)for(l=0;l<g;l++){for(h=0;h<k;h++)q[p]&&(O[p]=H[d++]),p++;p+=w}else for(l=0;l<g;l++){for(h=0;h<k;h++)O[p++]=H[d++];p+=w}}},formatFileInfo:function(n){return{fileIdentifierString:n.headerInfo.fileIdentifierString,fileVersion:n.headerInfo.fileVersion,imageType:n.headerInfo.imageType,height:n.headerInfo.height,width:n.headerInfo.width,numValidPixel:n.headerInfo.numValidPixel,microBlockSize:n.headerInfo.microBlockSize,blobSize:n.headerInfo.blobSize,maxZError:n.headerInfo.maxZError,pixelType:V.getPixelType(n.headerInfo.imageType),eofOffset:n.eofOffset,mask:n.mask?{numBytes:n.mask.numBytes}:null,pixels:{numBlocksX:n.pixels.numBlocksX,numBlocksY:n.pixels.numBlocksY,maxValue:n.headerInfo.zMax,minValue:n.headerInfo.zMin,noDataValue:n.noDataValue}}},constructConstantSurface:function(n){var e=n.headerInfo.zMax,r=n.headerInfo.numDims,t=n.headerInfo.height*n.headerInfo.width,a=t*r,i=0,s=0,f=0,v=n.pixels.resultMask;if(v)if(r>1)for(i=0;i<r;i++)for(f=i*t,s=0;s<t;s++)v[s]&&(n.pixels.resultPixels[f+s]=e);else for(s=0;s<t;s++)v[s]&&(n.pixels.resultPixels[s]=e);else if(n.pixels.resultPixels.fill)n.pixels.resultPixels.fill(e);else for(s=0;s<a;s++)n.pixels.resultPixels[s]=e},getDataTypeArray:function(n){var e;switch(n){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:e=Float32Array;break;case 7:e=Float64Array;break;default:e=Float32Array}return e},getPixelType:function(n){var e;switch(n){case 0:e="S8";break;case 1:e="U8";break;case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:e="F32";break;case 7:e="F64";break;default:e="F32"}return e},isValidPixelValue:function(n,e){if(e===null)return!1;var r;switch(n){case 0:r=e>=-128&&e<=127;break;case 1:r=e>=0&&e<=255;break;case 2:r=e>=-32768&&e<=32767;break;case 3:r=e>=0&&e<=65536;break;case 4:r=e>=-2147483648&&e<=2147483647;break;case 5:r=e>=0&&e<=4294967296;break;case 6:r=e>=-34027999387901484e22&&e<=34027999387901484e22;break;case 7:r=e>=5e-324&&e<=17976931348623157e292;break;default:r=!1}return r},getDataTypeSize:function(n){var e=0;switch(n){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=n}return e},getDataTypeUsed:function(n,e){var r=n;switch(n){case 2:case 4:r=n-e;break;case 3:case 5:r=n-2*e;break;case 6:e===0?r=n:e===1?r=2:r=1;break;case 7:e===0?r=n:r=n-2*e+1;break;default:r=n;break}return r},getOnePixel:function(n,e,r,t){var a=0;switch(r){case 0:a=t.getInt8(e);break;case 1:a=t.getUint8(e);break;case 2:a=t.getInt16(e,!0);break;case 3:a=t.getUint16(e,!0);break;case 4:a=t.getInt32(e,!0);break;case 5:a=t.getUInt32(e,!0);break;case 6:a=t.getFloat32(e,!0);break;case 7:a=t.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type"}return a}},C=function(n,e,r){this.val=n,this.left=e,this.right=r},_={decode:function(n,e){e=e||{};var r=e.noDataValue,t=0,a={};if(a.ptr=e.inputOffset||0,a.pixels={},!!V.readHeaderInfo(n,a)){var i=a.headerInfo,s=i.fileVersion,f=V.getDataTypeArray(i.imageType);V.readMask(n,a),i.numValidPixel!==i.width*i.height&&!a.pixels.resultMask&&(a.pixels.resultMask=e.maskData);var v=i.width*i.height;if(a.pixels.resultPixels=new f(v*i.numDims),a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},i.numValidPixel!==0)if(i.zMax===i.zMin)V.constructConstantSurface(a);else if(s>=4&&V.checkMinMaxRanges(n,a))V.constructConstantSurface(a);else{var m=new DataView(n,a.ptr,2),o=m.getUint8(0);if(a.ptr++,o)V.readDataOneSweep(n,a,f);else if(s>1&&i.imageType<=1&&Math.abs(i.maxZError-.5)<1e-5){var l=m.getUint8(1);if(a.ptr++,a.encodeMode=l,l>2||s<4&&l>1)throw"Invalid Huffman flag "+l;l?V.readHuffman(n,a,f):V.readTiles(n,a,f)}else V.readTiles(n,a,f)}a.eofOffset=a.ptr;var h;e.inputOffset?(h=a.headerInfo.blobSize+e.inputOffset-a.ptr,Math.abs(h)>=1&&(a.eofOffset=e.inputOffset+a.headerInfo.blobSize)):(h=a.headerInfo.blobSize-a.ptr,Math.abs(h)>=1&&(a.eofOffset=a.headerInfo.blobSize));var u={width:i.width,height:i.height,pixelData:a.pixels.resultPixels,minValue:i.zMin,maxValue:i.zMax,validPixelCount:i.numValidPixel,dimCount:i.numDims,dimStats:{minValues:i.minValues,maxValues:i.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&V.isValidPixelValue(i.imageType,r)){var c=a.pixels.resultMask;for(t=0;t<v;t++)c[t]||(u.pixelData[t]=r);u.noDataValue=r}return a.noDataValue=r,e.returnFileInfo&&(u.fileInfo=V.formatFileInfo(a)),u}},getBandCount:function(n){var e=0,r=0,t={};for(t.ptr=0,t.pixels={};r<n.byteLength-58;)V.readHeaderInfo(n,t),r+=t.headerInfo.blobSize,e++,t.ptr=r;return e}};return _}(),X=function(){var D=new ArrayBuffer(4),V=new Uint8Array(D),C=new Uint32Array(D);return C[0]=1,V[0]===1}(),fe={decode:function(D,V){if(!X)throw"Big endian system is not supported.";V=V||{};var C=V.inputOffset||0,_=new Uint8Array(D,C,10),n=String.fromCharCode.apply(null,_),e,r;if(n.trim()==="CntZImage")e=A,r=1;else if(n.substring(0,5)==="Lerc2")e=ae,r=2;else throw"Unexpected file identifier string: "+n;for(var t=0,a=D.byteLength-10,i,s=[],f,v,m={width:0,height:0,pixels:[],pixelType:V.pixelType,mask:null,statistics:[]};C<a;){var o=e.decode(D,{inputOffset:C,encodedMaskData:i,maskData:v,returnMask:t===0,returnEncodedMask:t===0,returnFileInfo:!0,pixelType:V.pixelType||null,noDataValue:V.noDataValue||null});C=o.fileInfo.eofOffset,t===0&&(i=o.encodedMaskData,v=o.maskData,m.width=o.width,m.height=o.height,m.dimCount=o.dimCount||1,m.pixelType=o.pixelType||o.fileInfo.pixelType,m.mask=o.maskData),r>1&&o.fileInfo.mask&&o.fileInfo.mask.numBytes>0&&s.push(o.maskData),t++,m.pixels.push(o.pixelData),m.statistics.push({minValue:o.minValue,maxValue:o.maxValue,noDataValue:o.noDataValue,dimStats:o.dimStats})}var l,h,u;if(r>1&&s.length>1){for(u=m.width*m.height,m.bandMasks=s,v=new Uint8Array(u),v.set(s[0]),l=1;l<s.length;l++)for(f=s[l],h=0;h<u;h++)v[h]=v[h]&f[h];m.maskData=v}return m}};fr.Lerc=fe})();var sr=fr.Lerc;function Tr(A,ae){if(A.encoding===nr.LERC){var X;try{X=sr.decode(A.heightmap)}catch(C){throw new Ne(C)}var fe=X.statistics[0];if(fe.minValue===Number.MAX_VALUE)throw new Ne("Invalid tile data");A.heightmap=X.pixels[0],A.width=X.width,A.height=X.height}A.ellipsoid=pe.clone(A.ellipsoid),A.rectangle=me.clone(A.rectangle);var D=tr.computeVertices(A),V=D.vertices;return ae.push(V.buffer),{vertices:V.buffer,numberOfAttributes:D.encoding.getStride(),minimumHeight:D.minimumHeight,maximumHeight:D.maximumHeight,gridWidth:A.width,gridHeight:A.height,boundingSphere3D:D.boundingSphere3D,orientedBoundingBox:D.orientedBoundingBox,occludeePointInScaledSpace:D.occludeePointInScaledSpace,encoding:D.encoding,westIndicesSouthToNorth:D.westIndicesSouthToNorth,southIndicesEastToWest:D.southIndicesEastToWest,eastIndicesNorthToSouth:D.eastIndicesNorthToSouth,northIndicesWestToEast:D.northIndicesWestToEast}}var Qr=Pe(Tr);export{Qr as default};
