import{a as M}from"./chunk-77JEGE4I.js";import{a as m}from"./chunk-AMRCVYIA.js";import{a as B}from"./chunk-NLYLRNUA.js";import"./chunk-7TOCOFC3.js";import{a as k}from"./chunk-ZVKIUA3Y.js";import"./chunk-3HZNWEV7.js";import{a as O}from"./chunk-LBR6REQR.js";import"./chunk-GXFCHGTA.js";import"./chunk-UBHQMGET.js";import"./chunk-EDZQSM3T.js";import"./chunk-PJGSCWXZ.js";import"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";var N=function(){var a=!![];return function(o,h){var i=a?function(){if(h){var r=h.apply(o,arguments);return h=null,r}}:function(){};return a=![],i}}(),R=N(void 0,function(){return R.toString().search("(((.+)+)+)+$").toString().constructor(R).search("(((.+)+)+)+$")});R();var v={UNLOAD:0,LOADING:1,LOADED:2,VOLLOADED:3,PARSING:4,PARSED:5,TRANSFORMING:6,TRANSFORMED:7,LOST:8,LOADVOL:9,FAILED:10,VOLFAILED:11},b=Object.freeze(v);function G(a){for(var o=1;o<a;)o<<=1;return o}function j(a){var o=new O(1,255,65025);o=O.multiplyByScalar(o,a,o),o.x=o.x-Math.floor(o.x),o.y=o.y-Math.floor(o.y),o.z=o.z-Math.floor(o.z);var h=new O,i=new O(1/255,1/255,0);return h.x=o.y*i.x,h.y=o.z*i.y,h.z=o.z*i.z,o=O.subtract(o,h,o),o}function U(a,o,h,i){for(var r=4,A=a._nLength*a._nLength*r,s=new Array(A),S=h-o,w=o,f=-9999,_=0;_<a.cellDepth;_++)for(var d=parseInt(_/a._nSideBlockCount)*a._nBlockLength,n=_%a._nSideBlockCount*a._nBlockLength,g=-1;g<a._nBlockLength-1;g++)for(var l=-1;l<a._nBlockLength-1;l++){var c=Math.min(l,a.validWidth-1),D=Math.min(g,a.validHeight-1);c=Math.max(0,c),D=Math.max(0,D);var W=0;a.ySpan>0&&(W=a.validHeight-a.cellHeight);var t,p;if(c<a.cellWidth&&D>=W?(p=0,t=_*a.cellHeight*a.cellWidth+(a.validHeight-1-D)*a.cellWidth+c):c<a.cellWidth?(a.xSpan==0?p=1:p=2,t=_*a.cellHeight*a.cellWidth+(a.validHeight-a.cellHeight-1-D)*a.cellWidth+c):D>=W?(p=1,t=_*a.cellHeight*a.cellWidth+(a.validHeight-1-D)*a.cellWidth+c-a.cellWidth):(p=3,t=_*a.cellHeight*a.cellWidth+(a.validHeight-a.cellHeight-1-D)*a.cellWidth+c-a.cellWidth),!(t<0)){var H=i[p][t],y=new k(0,0,0,0);if(H!=f){H<o||H>h?H=w:w=H,H=(H-o)/S;var z=j(H);y.x=z.x,y.y=z.y,y.z=z.z,y.w=1}var E=y.x*255,F=y.y*255,C=y.z*255,I=y.w*255;t=(d+g)*a._nLength+n+l,s[4*t]=parseInt(E),s[4*t+1]=parseInt(F),s[4*t+2]=parseInt(C),s[4*t+3]=parseInt(I)}}return new Uint8Array(s,0,A)}function $(a,o,h,i,r,A,s){for(var S=a.length,w=[],f=0;f<S;f++)w.push(a[f]._arrayBuffer.slice(36,a[f]._arrayBuffer.byteLength));var _=4*o.cellWidth*o.cellHeight*o.cellDepth,d=a[0],n=a[S-1],g=o.cellWidth,l=o.cellHeight;s.EndCol-1==n._x&&(g=s.Width-n._x*g),s.EndRow-1==n._y&&(l=s.Height-n._y*l),o.startCol=d._x,o.startRow=d._y,o.endCol=n._x,o.endRow=n._y,o.ySpan=n._y-d._y,o.xSpan=n._x-d._x,o.ySpan>0&&(l=l+o.cellHeight),o.xSpan>0&&(g=g+o.cellWidth),o._nSideBlockCount=Math.ceil(Math.sqrt(o.cellDepth)),o._nBlockLength=Math.max(l,g)+2,o._nLength=G(o._nBlockLength*o._nSideBlockCount-2),o.validWidth=g,o.validHeight=l,o.bounds=new B(d._dataBounds.west,n._dataBounds.south,n._dataBounds.east,d._dataBounds.north);var c=new B(i.west,i.south,i.east,i.north);o.multiResolutionTranslation=new k((d._dataBounds.west-c.west)/c.width,(n._dataBounds.south-c.south)/c.height,c.width/o.bounds.width,c.height/o.bounds.height);for(var D=[],W=0;W<h;W++){for(var t=[],f=0;f<w.length;f++){var p=new Float32Array(w[f].slice(W*_,(W+1)*_));t.push(p)}D.push(U(o,r,A,t))}return D}function q(a,o){for(var h=a.arrayWork,i=[],r=0;r<h.length;r++)if(h[r]._s3mLoadState===b.LOADED){var A=h[r]._arrayBuffer.slice(16,h[r]._arrayBuffer.byteLength),s=M.inflate(A).buffer;h[r]._arrayBuffer=s,h[r]._s3mLoadState=b.TRANSFORMED,i.push({index:r,buffer:s})}var S=a.textureLevel,w=a._availableNode,f=a._time,_=a._layerBounds,d=a._minFiltration,n=a._maxFiltration;S.cellWidth=a._cellWidth,S.cellHeight=a._cellHeight,S.cellDepth=a._cellDepth;var g=$(h,S,f,_,d,n,w);return{textureLevel:S,imageDatas:g,unzipTile:i}}var u=m(q);export{u as default};
