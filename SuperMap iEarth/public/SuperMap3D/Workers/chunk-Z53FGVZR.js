import{a as T}from"./chunk-SP6GVFX5.js";import{a as V,b as L}from"./chunk-ZMHH4UFY.js";import{a as M}from"./chunk-D45ASFTR.js";import{a as z}from"./chunk-6X6ULKRC.js";import{a as U}from"./chunk-VI4IWVT4.js";import{a as R}from"./chunk-44AFRGCG.js";import{a as X}from"./chunk-UIA2BV6O.js";import{g as H,k,l as D}from"./chunk-CJHFPVIB.js";import{b as O}from"./chunk-SSYG2MIY.js";import{a as q}from"./chunk-SRPTWKHW.js";import{a as B}from"./chunk-Z4SOZDEW.js";import{a as Q,b as K}from"./chunk-7TOCOFC3.js";import{b as N}from"./chunk-3HZNWEV7.js";import{a as m}from"./chunk-LBR6REQR.js";import{a as S}from"./chunk-GXFCHGTA.js";import{a as Y}from"./chunk-UBHQMGET.js";import{a as d}from"./chunk-NUC3LT2W.js";function x(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(x.prototype,{length:{get:function(){return this._length}}});x.prototype.enqueue=function(t){this._array.push(t),this._length++};x.prototype.dequeue=function(){if(this._length!==0){var t=this._array,v=this._offset,h=t[v];return t[v]=void 0,v++,v>10&&v*2>t.length&&(this._array=t.slice(v),v=0),this._offset=v,this._length--,h}};x.prototype.peek=function(){if(this._length!==0)return this._array[this._offset]};x.prototype.contains=function(t){return this._array.indexOf(t)!==-1};x.prototype.clear=function(){this._array.length=this._offset=this._length=0};x.prototype.sort=function(t){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(t)};var F=x;var g={};g.computeHierarchyPackedLength=function(t){for(var v=0,h=[t];h.length>0;){var o=h.pop();if(!!d(o)){v+=2;var f=o.positions,r=o.holes;if(d(f)&&(v+=f.length*m.packedLength),d(r))for(var e=r.length,a=0;a<e;++a)h.push(r[a])}}return v};g.packPolygonHierarchy=function(t,v,h){for(var o=[t];o.length>0;){var f=o.pop();if(!!d(f)){var r=f.positions,e=f.holes;if(v[h++]=d(r)?r.length:0,v[h++]=d(e)?e.length:0,d(r))for(var a=r.length,i=0;i<a;++i,h+=3)m.pack(r[i],v,h);if(d(e))for(var c=e.length,u=0;u<c;++u)o.push(e[u])}}return h};g.unpackPolygonHierarchy=function(t,v){for(var h=t[v++],o=t[v++],f=new Array(h),r=o>0?new Array(o):void 0,e=0;e<h;++e,v+=m.packedLength)f[e]=m.unpack(t,v);for(var a=0;a<o;++a)r[a]=g.unpackPolygonHierarchy(t,v),v=r[a].startingIndex,delete r[a].startingIndex;return{positions:f,holes:r,startingIndex:v}};var G=new m;function P(t,v,h,o){return m.subtract(v,t,G),m.multiplyByScalar(G,h/o,G),m.add(t,G,G),[G.x,G.y,G.z]}g.subdivideLineCount=function(t,v,h){var o=m.distance(t,v),f=o/h,r=Math.max(0,Math.ceil(S.log2(f)));return Math.pow(2,r)};var Z=new N,$=new N,j=new N,rr=new m;g.subdivideRhumbLineCount=function(t,v,h,o){var f=t.cartesianToCartographic(v,Z),r=t.cartesianToCartographic(h,$),e=new z(f,r,t),a=e.surfaceDistance/o,i=Math.max(0,Math.ceil(S.log2(a)));return Math.pow(2,i)};g.subdivideLine=function(t,v,h,o){var f=g.subdivideLineCount(t,v,h),r=m.distance(t,v),e=r/f;d(o)||(o=[]);var a=o;a.length=f*3;for(var i=0,c=0;c<f;c++){var u=P(t,v,c*e,r);a[i++]=u[0],a[i++]=u[1],a[i++]=u[2]}return a};g.subdivideRhumbLine=function(t,v,h,o,f){var r=t.cartesianToCartographic(v,Z),e=t.cartesianToCartographic(h,$),a=new z(r,e,t),i=a.surfaceDistance/o,c=Math.max(0,Math.ceil(S.log2(i))),u=Math.pow(2,c),n=a.surfaceDistance/u;d(f)||(f=[]);var p=f;p.length=u*3;for(var l=0,y=0;y<u;y++){var I=a.interpolateUsingSurfaceDistance(y*n,j),b=t.cartographicToCartesian(I,rr);p[l++]=b.x,p[l++]=b.y,p[l++]=b.z}return p};var er=new m,ar=new m,tr=new m,nr=new m;g.scaleToGeodeticHeightExtruded=function(t,v,h,o,f){o=Y(o,K.WGS84);var r=er,e=ar,a=tr,i=nr;if(d(t)&&d(t.attributes)&&d(t.attributes.position))for(var c=t.attributes.position.values,u=c.length/2,n=0;n<u;n+=3)m.fromArray(c,n,a),o.geodeticSurfaceNormal(a,r),i=o.scaleToGeodeticSurface(a,i),e=m.multiplyByScalar(r,h,e),e=m.add(i,e,e),c[n+u]=e.x,c[n+1+u]=e.y,c[n+2+u]=e.z,f&&(i=m.clone(a,i)),e=m.multiplyByScalar(r,v,e),e=m.add(i,e,e),c[n]=e.x,c[n+1]=e.y,c[n+2]=e.z;return t};g.polygonOutlinesFromHierarchy=function(t,v,h){var o=[],f=new F;f.enqueue(t);for(var r,e,a;f.length!==0;){var i=f.dequeue(),c=i.positions;if(v)for(a=c.length,r=0;r<a;r++)h.scaleToGeodeticSurface(c[r],c[r]);if(c=M(c,m.equalsEpsilon,!0),!(c.length<3)){var u=i.holes?i.holes.length:0;for(r=0;r<u;r++){var n=i.holes[r],p=n.positions;if(v)for(a=p.length,e=0;e<a;++e)h.scaleToGeodeticSurface(p[e],p[e]);if(p=M(p,m.equalsEpsilon,!0),!(p.length<3)){o.push(p);var l=0;for(d(n.holes)&&(l=n.holes.length),e=0;e<l;e++)f.enqueue(n.holes[e])}}o.push(c)}}return o};g.polygonsFromHierarchy=function(t,v,h,o){var f=[],r=[],e=new F;for(e.enqueue(t);e.length!==0;){var a=e.dequeue(),i=a.positions,c=a.holes,u,n,p=i.slice();if(h)for(n=i.length,u=0;u<n;u++)o.scaleToGeodeticSurface(i[u],p[u]);if(i=M(p,m.equalsEpsilon,!0),!(i.length<3)){var l=v(i);if(!!d(l)){var y=[],I=L.computeWindingOrder2D(l);I===V.CLOCKWISE&&(l.reverse(),i=i.slice().reverse());var b=i.slice(),C=d(c)?c.length:0,_=[],w;for(u=0;u<C;u++){var E=c[u],s=E.positions;if(h)for(n=s.length,w=0;w<n;++w)o.scaleToGeodeticSurface(s[w],s[w]);if(s=M(s,m.equalsEpsilon,!0,S.EPSILON7),!(s.length<3)){var A=v(s);if(!!d(A)){I=L.computeWindingOrder2D(A),I===V.CLOCKWISE&&(A.reverse(),s=s.slice().reverse()),_.push(s),y.push(b.length),b=b.concat(s),l=l.concat(A);var W=0;for(d(E.holes)&&(W=E.holes.length),w=0;w<W;w++)e.enqueue(E.holes[w])}}}f.push({outerRing:i,holes:_}),r.push({positions:b,positions2D:l,holes:y})}}}return{hierarchy:f,polygons:r}};var vr=new Q,cr=new m,ur=new H,ir=new B;g.computeBoundingRectangle=function(t,v,h,o,f){for(var r=H.fromAxisAngle(t,o,ur),e=B.fromQuaternion(r,ir),a=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,n=h.length,p=0;p<n;++p){var l=m.clone(h[p],cr);B.multiplyByVector(e,l,l);var y=v(l,vr);d(y)&&(a=Math.min(a,y.x),i=Math.max(i,y.x),c=Math.min(c,y.y),u=Math.max(u,y.y))}return f.x=a,f.y=c,f.width=i-a,f.height=u-c,f};g.createGeometryFromPositions=function(t,v,h,o,f,r){var e=L.triangulate(v.positions2D,v.holes);e.length<3&&(e=[0,1,2]);var a=v.positions;if(o){for(var i=a.length,c=new Array(i*3),u=0,n=0;n<i;n++){var p=a[n];c[u++]=p.x,c[u++]=p.y,c[u++]=p.z}var l=new k({attributes:{position:new D({componentDatatype:q.DOUBLE,componentsPerAttribute:3,values:c})},indices:e,primitiveType:O.TRIANGLES});return f.normal?U.computeNormal(l):l}if(r===T.GEODESIC)return L.computeSubdivision(t,a,e,h);if(r===T.RHUMB)return L.computeRhumbLineSubdivision(t,a,e,h)};var J=[],fr=new m,or=new m;g.computeWallGeometry=function(t,v,h,o,f){var r,e,a,i,c,u=t.length,n=0;if(o)for(e=u*3*2,r=new Array(e*2),a=0;a<u;a++)i=t[a],c=t[(a+1)%u],r[n]=r[n+e]=i.x,++n,r[n]=r[n+e]=i.y,++n,r[n]=r[n+e]=i.z,++n,r[n]=r[n+e]=c.x,++n,r[n]=r[n+e]=c.y,++n,r[n]=r[n+e]=c.z,++n;else{var p=S.chordLength(h,v.maximumRadius),l=0;if(f===T.GEODESIC)for(a=0;a<u;a++)l+=g.subdivideLineCount(t[a],t[(a+1)%u],p);else if(f===T.RHUMB)for(a=0;a<u;a++)l+=g.subdivideRhumbLineCount(v,t[a],t[(a+1)%u],p);for(e=(l+u)*3,r=new Array(e*2),a=0;a<u;a++){i=t[a],c=t[(a+1)%u];var y;f===T.GEODESIC?y=g.subdivideLine(i,c,p,J):f===T.RHUMB&&(y=g.subdivideRhumbLine(v,i,c,p,J));for(var I=y.length,b=0;b<I;++b,++n)r[n]=y[b],r[n+e]=y[b];r[n]=c.x,r[n+e]=c.x,++n,r[n]=c.y,r[n+e]=c.y,++n,r[n]=c.z,r[n+e]=c.z,++n}}u=r.length;var C=R.createTypedArray(u/3,u-t.length*6),_=0;for(u/=6,a=0;a<u;a++){var w=a,E=w+1,s=w+u,A=s+1;i=m.fromArray(r,w*3,fr),c=m.fromArray(r,E*3,or),!m.equalsEpsilon(i,c,S.EPSILON10,S.EPSILON10)&&(C[_++]=w,C[_++]=s,C[_++]=E,C[_++]=E,C[_++]=s,C[_++]=A)}return new k({attributes:new X({position:new D({componentDatatype:q.DOUBLE,componentsPerAttribute:3,values:r})}),indices:C,primitiveType:O.TRIANGLES})};var qr=g;export{qr as a};
