define(["exports","./Ellipsoid-ca2b8eb1","./Cartesian3-c1138337","./Cartesian4-5c264813","./Cartographic-630e5de6","./EllipsoidTangentPlane-6f479ced","./Math-cd1437d9","./FeatureDetection-e7fb956a","./PrimitiveType-d9ba7368","./PolylinePipeline-92dcfbc3","./GeometryAttribute-b12ab6bd"],(function(o,e,r,a,n,t,l,i,c,s,u){"use strict";var y=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),m=[new r.o,new r.o],d=new r.o,p=new r.o,f=new r.o,g=new r.o,v=new r.o,h=new r.o,w=new r.o,E=new r.o,B=new r.o,z=new r.o,S=new r.o,b={},P=new n.a;function T(o,e){for(var r=new Array(o.length),a=0;a<o.length;a++){var n=o[a];P=e.cartesianToCartographic(n,P),r[a]=P.height,o[a]=e.scaleToGeodeticSurface(n,n)}return r}function A(o,e,a,n){var t,l=o[0],i=o[1],c=r.o.angleBetween(l,i),s=Math.ceil(c/n),u=new Array(s);if(e===a){for(t=0;t<s;t++)u[t]=e;return u.push(a),u}var y=(a-e)/s;for(t=1;t<s;t++){var m=e+t*y;u[t]=m}return u[0]=e,u.push(a),u}var D=new r.o,x=new r.o;function N(o,a,n,l){var i=new t.f(n,l),c=i.projectPointOntoPlane(r.o.add(n,o,D),D),s=i.projectPointOntoPlane(r.o.add(n,a,x),x),u=e.o.angleBetween(c,s);return s.x*c.y-s.y*c.x>=0?-u:u}var O=new r.o(-1,0,0),R=c.y.clone(c.y.IDENTITY),V=new c.y,F=new i.p,I=i.p.IDENTITY.clone(),L=new r.o,G=new a.e,M=new r.o;function U(o,e,a,n,t,l,s,y){var m=L,d=G;R=u.m.eastNorthUpToFixedFrame(o,t,R),m=c.y.multiplyByPointAsVector(R,O,m);var p=N(m=r.o.normalize(m,m),e,o,t);F=i.p.fromRotationZ(p,F),M.z=l,R=c.y.multiplyTransformation(R,c.y.fromRotationTranslation(F,M,V),R);var f=I;f[0]=s;for(var g=0;g<y;g++)for(var v=0;v<a.length;v+=3)d=r.o.fromArray(a,v,d),d=i.p.multiplyByVector(f,d,d),d=c.y.multiplyByPoint(R,d,d),n.push(d.x,d.y,d.z);return n}function _(o,e,a,n,t,l,s,y,m){var d=L,p=G;R=u.m.eastNorthUpToFixedFrame(o,t,R),d=c.y.multiplyByPointAsVector(R,O,d);var f=N(d=r.o.normalize(d,d),e,o,t);F=i.p.fromRotationZ(f,F),M.z=l,R=c.y.multiplyTransformation(R,c.y.fromRotationTranslation(F,M,V),R);var g=I;g[0]=s;for(var v=0;v<y;v++)for(var h=0;h<a.length;h+=3)p=r.o.fromArray(a,h,p),p=i.p.multiplyByVector(g,p,p),p=c.y.multiplyByPoint(R,p,p),p=c.y.multiplyByPoint(m,p,p),n.push(p.x,p.y,p.z);return n}var j=new r.o;function C(o,e,a,n,t,l,i){for(var c=0;c<o.length;c+=3){n=U(r.o.fromArray(o,c,j),e,a,n,t,l[c/3],i,1)}return n}function q(o,e){var r=o.length,a=new Array(6*r),n=0,t=e.x+e.width/2,l=e.y+e.height/2,i=o[0];a[n++]=i.x-t,a[n++]=0,a[n++]=i.y-l;for(var c=1;c<r;c++){var s=(i=o[c]).x-t,u=i.y-l;a[n++]=s,a[n++]=0,a[n++]=u,a[n++]=s,a[n++]=0,a[n++]=u}return i=o[0],a[n++]=i.x-t,a[n++]=0,a[n++]=i.y-l,a}function Q(o,e){for(var r=o.length,a=new Array(3*r),n=0,t=e.x+e.width/2,l=e.y+e.height/2,i=0;i<r;i++)a[n++]=o[i].x-t,a[n++]=0,a[n++]=o[i].y-l;return a}var Y=new u.n,Z=new r.o,J=new i.p;function k(o,e,a,n,t,c,s,m,d,p){var f,g,v=r.o.angleBetween(r.o.subtract(e,o,z),r.o.subtract(a,o,S)),h=n===y.BEVELED?0:Math.ceil(v/l.e.toRadians(5));if(f=t?i.p.fromQuaternion(u.n.fromAxisAngle(r.o.negate(o,z),v/(h+1),Y),J):i.p.fromQuaternion(u.n.fromAxisAngle(o,v/(h+1),Y),J),e=r.o.clone(e,Z),h>0)for(var w=p?2:1,E=0;E<h;E++)e=i.p.multiplyByVector(f,e,e),g=r.o.subtract(e,o,z),g=r.o.normalize(g,g),t||(g=r.o.negate(g,g)),s=U(c.scaleToGeodeticSurface(e,S),g,m,s,c,d,1,w);else g=r.o.subtract(e,o,z),g=r.o.normalize(g,g),t||(g=r.o.negate(g,g)),s=U(c.scaleToGeodeticSurface(e,S),g,m,s,c,d,1,1),a=r.o.clone(a,Z),g=r.o.subtract(a,o,z),g=r.o.normalize(g,g),t||(g=r.o.negate(g,g)),s=U(c.scaleToGeodeticSurface(a,S),g,m,s,c,d,1,1);return s}b.removeDuplicatesFromShape=function(o){for(var r=o.length,a=[],n=r-1,t=0;t<r;n=t++){var l=o[n],i=o[t];e.o.equals(l,i)||a.push(i)}return a},b.angleIsGreaterThanPi=function(o,e,a,n){var l=new t.f(a,n),i=l.projectPointOntoPlane(r.o.add(a,o,D),D),c=l.projectPointOntoPlane(r.o.add(a,e,x),x);return c.x*i.y-c.y*i.x>=0};var H=new r.o,K=new r.o;b.computePositions=function(o,e,a,n,t){var i=n._ellipsoid,c=T(o,i),u=n._granularity,S=n._cornerType,P=t?q(e,a):Q(e,a),D=t?Q(e,a):void 0,x=a.height/2,N=a.width/2,O=o.length,R=[],V=t?[]:void 0,F=d,I=p,L=f,G=g,M=v,_=h,j=w,Y=E,Z=B,J=o[0],W=o[1];G=i.geodeticSurfaceNormal(J,G),F=r.o.subtract(W,J,F),F=r.o.normalize(F,F),Y=r.o.cross(G,F,Y),Y=r.o.normalize(Y,Y);var X=c[0],$=c[1];t&&(V=U(J,Y,D,V,i,X+x,1,1)),Z=r.o.clone(J,Z),J=W,I=r.o.negate(F,I);for(var oo,eo=1;eo<O-1;eo++){var ro=t?2:1;W=o[eo+1],F=r.o.subtract(W,J,F),F=r.o.normalize(F,F),L=r.o.add(F,I,L),L=r.o.normalize(L,L),G=i.geodeticSurfaceNormal(J,G);var ao=r.o.multiplyByScalar(G,r.o.dot(F,G),H);r.o.subtract(F,ao,ao),r.o.normalize(ao,ao);var no=r.o.multiplyByScalar(G,r.o.dot(I,G),K);if(r.o.subtract(I,no,no),r.o.normalize(no,no),!l.e.equalsEpsilon(Math.abs(r.o.dot(ao,no)),1,l.e.EPSILON7)){L=r.o.cross(L,G,L),L=r.o.cross(G,L,L),L=r.o.normalize(L,L);var to=1/Math.max(.25,r.o.magnitude(r.o.cross(L,I,z))),lo=b.angleIsGreaterThanPi(F,I,J,i);lo?(M=r.o.add(J,r.o.multiplyByScalar(L,to*N,L),M),_=r.o.add(M,r.o.multiplyByScalar(Y,N,_),_),m[0]=r.o.clone(Z,m[0]),m[1]=r.o.clone(_,m[1]),oo=A(m,X+x,$+x,u),R=C(s.m.generateArc({positions:m,granularity:u,ellipsoid:i}),Y,P,R,i,oo,1),Y=r.o.cross(G,F,Y),Y=r.o.normalize(Y,Y),j=r.o.add(M,r.o.multiplyByScalar(Y,N,j),j),S===y.ROUNDED||S===y.BEVELED?k(M,_,j,S,lo,i,R,P,$+x,t):R=U(J,L=r.o.negate(L,L),P,R,i,$+x,to,ro),Z=r.o.clone(j,Z)):(M=r.o.add(J,r.o.multiplyByScalar(L,to*N,L),M),_=r.o.add(M,r.o.multiplyByScalar(Y,-N,_),_),m[0]=r.o.clone(Z,m[0]),m[1]=r.o.clone(_,m[1]),oo=A(m,X+x,$+x,u),R=C(s.m.generateArc({positions:m,granularity:u,ellipsoid:i}),Y,P,R,i,oo,1),Y=r.o.cross(G,F,Y),Y=r.o.normalize(Y,Y),j=r.o.add(M,r.o.multiplyByScalar(Y,-N,j),j),S===y.ROUNDED||S===y.BEVELED?k(M,_,j,S,lo,i,R,P,$+x,t):R=U(J,L,P,R,i,$+x,to,ro),Z=r.o.clone(j,Z)),I=r.o.negate(F,I)}else R=U(Z,Y,P,R,i,X+x,1,1),Z=J;X=$,$=c[eo+1],J=W}m[0]=r.o.clone(Z,m[0]),m[1]=r.o.clone(J,m[1]),oo=A(m,X+x,$+x,u),R=C(s.m.generateArc({positions:m,granularity:u,ellipsoid:i}),Y,P,R,i,oo,1),t&&(V=U(J,Y,D,V,i,$+x,1,1)),O=R.length;var io=t?O+V.length:O,co=new Float64Array(io);return co.set(R),t&&co.set(V,O),co},b.computeLocalPositions=function(o,e,a,n,t,i){var S=n._ellipsoid,P=T(o,S),D=n._granularity,x=n._cornerType,N=t?q(e,a):Q(e,a),O=t?Q(e,a):void 0,R=a.width/2,V=o.length,F=[],I=t?[]:void 0,L=d,G=p,M=f,U=g,Y=v,Z=h,J=w,W=E,X=B,$=u.m.eastNorthUpToFixedFrame(i,S,new c.y),oo=c.y.inverse($,new c.y),eo=o[0],ro=o[1];U=S.geodeticSurfaceNormal(eo,U),L=r.o.subtract(ro,eo,L),L=r.o.normalize(L,L),W=r.o.cross(U,L,W),W=r.o.normalize(W,W);var ao=P[0],no=P[1];t&&(I=_(eo,W,O,I,S,ao+0,1,1,oo)),X=r.o.clone(eo,X),eo=ro,G=r.o.negate(L,G);for(var to,lo=1;lo<V-1;lo++){var io=t?2:1;ro=o[lo+1],L=r.o.subtract(ro,eo,L),L=r.o.normalize(L,L),M=r.o.add(L,G,M),M=r.o.normalize(M,M),U=S.geodeticSurfaceNormal(eo,U);var co=r.o.multiplyByScalar(U,r.o.dot(L,U),H);r.o.subtract(L,co,co),r.o.normalize(co,co);var so=r.o.multiplyByScalar(U,r.o.dot(G,U),K);if(r.o.subtract(G,so,so),r.o.normalize(so,so),!l.e.equalsEpsilon(Math.abs(r.o.dot(co,so)),1,l.e.EPSILON7)){M=r.o.cross(M,U,M),M=r.o.cross(U,M,M),M=r.o.normalize(M,M);var uo=1/Math.max(.25,r.o.magnitude(r.o.cross(M,G,z))),yo=b.angleIsGreaterThanPi(L,G,eo,S);yo?(Y=r.o.add(eo,r.o.multiplyByScalar(M,uo*R,M),Y),Z=r.o.add(Y,r.o.multiplyByScalar(W,R,Z),Z),m[0]=r.o.clone(X,m[0]),m[1]=r.o.clone(Z,m[1]),to=A(m,ao+0,no+0,D),F=C(s.m.generateArc({positions:m,granularity:D,ellipsoid:S}),W,N,F,S,to,1,fromEnu),W=r.o.cross(U,L,W),W=r.o.normalize(W,W),J=r.o.add(Y,r.o.multiplyByScalar(W,R,J),J),x===y.ROUNDED||x===y.BEVELED?k(Y,Z,J,x,yo,S,F,N,no+0,t):F=_(eo,M=r.o.negate(M,M),N,F,S,no+0,uo,io,oo),X=r.o.clone(J,X)):(Y=r.o.add(eo,r.o.multiplyByScalar(M,uo*R,M),Y),Z=r.o.add(Y,r.o.multiplyByScalar(W,-R,Z),Z),m[0]=r.o.clone(X,m[0]),m[1]=r.o.clone(Z,m[1]),to=A(m,ao+0,no+0,D),F=C(s.m.generateArc({positions:m,granularity:D,ellipsoid:S}),W,N,F,S,to,1),W=r.o.cross(U,L,W),W=r.o.normalize(W,W),J=r.o.add(Y,r.o.multiplyByScalar(W,-R,J),J),x===y.ROUNDED||x===y.BEVELED?k(Y,Z,J,x,yo,S,F,N,no+0,t):F=_(eo,M,N,F,S,no+0,uo,io,oo),X=r.o.clone(J,X)),G=r.o.negate(L,G)}else F=_(X,W,N,F,S,ao+0,1,1,oo),X=eo;ao=no,no=P[lo+1],eo=ro}m[0]=r.o.clone(X,m[0]),m[1]=r.o.clone(eo,m[1]),to=A(m,ao+0,no+0,D),F=function(o,e,a,n,t,l,i,c){for(var s=0;s<o.length;s+=3)n=_(r.o.fromArray(o,s,j),e,a,n,t,l[s/3],i,1,c);return n}(s.m.generateArc({positions:m,granularity:D,ellipsoid:S}),W,N,F,S,to,1,oo),t&&(I=_(eo,W,O,I,S,no+0,1,1,oo)),V=F.length;var mo=t?V+I.length:V,po=new Float64Array(mo);return po.set(F),t&&po.set(I,V),po},o.J=b,o.S=y}));
