define(["exports","./Cartesian2-b72655a5","./Cartesian3-3a8bdb0b","./Cartographic-a2c313d7","./Check-52a7d806","./ComponentDatatype-98414d16","./when-92c6cf3c","./EllipsoidRhumbLine-b1a766ae","./GeometryAttribute-f47bd1cb","./Math-ecf82623","./FeatureDetection-cec0163f","./WebGLConstants-42651efd"],(function(e,n,t,r,i,a,o,x,u,p,h,y){"use strict";function f(e,n,t){t=t||2;var r,i,a,o,x,u,p,h=n&&n.length,y=h?n[0]*t:e.length,f=s(e,0,y,t,!0),c=[];if(!f||f.next===f.prev)return c;if(h&&(f=function(e,n,t,r){var i,a,o,x,u,p=[];for(i=0,a=n.length;i<a;i++)o=n[i]*r,x=i<a-1?n[i+1]*r:e.length,(u=s(e,o,x,r,!1))===u.next&&(u.steiner=!0),p.push(O(u));for(p.sort(b),i=0;i<p.length;i++)w(p[i],t),t=l(t,t.next);return t}(e,n,f,t)),e.length>80*t){r=a=e[0],i=o=e[1];for(var d=t;d<y;d+=t)(x=e[d])<r&&(r=x),(u=e[d+1])<i&&(i=u),x>a&&(a=x),u>o&&(o=u);p=0!==(p=Math.max(a-r,o-i))?1/p:0}return v(f,c,t,r,i,p),c}function s(e,n,t,r,i){var a,o;if(i===P(e,n,t,r)>0)for(a=n;a<t;a+=r)o=I(a,e[a],e[a+1],o);else for(a=t-r;a>=n;a-=r)o=I(a,e[a],e[a+1],o);return o&&z(o,o.next)&&(N(o),o=o.next),o}function l(e,n){if(!e)return e;n||(n=e);var t,r=e;do{if(t=!1,r.steiner||!z(r,r.next)&&0!==S(r.prev,r,r.next))r=r.next;else{if(N(r),(r=n=r.prev)===r.next)break;t=!0}}while(t||r!==n);return n}function v(e,n,t,r,i,a,o){if(e){!o&&a&&function(e,n,t,r){var i=e;do{null===i.z&&(i.z=C(i.x,i.y,n,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var n,t,r,i,a,o,x,u,p=1;do{for(t=e,e=null,a=null,o=0;t;){for(o++,r=t,x=0,n=0;n<p&&(x++,r=r.nextZ);n++);for(u=p;x>0||u>0&&r;)0!==x&&(0===u||!r||t.z<=r.z)?(i=t,t=t.nextZ,x--):(i=r,r=r.nextZ,u--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;t=r}a.nextZ=null,p*=2}while(o>1)}(i)}(e,r,i,a);for(var x,u,p=e;e.prev!==e.next;)if(x=e.prev,u=e.next,a?d(e,r,i,a):c(e))n.push(x.i/t),n.push(e.i/t),n.push(u.i/t),N(e),e=u.next,p=u.next;else if((e=u)===p){o?1===o?v(e=m(l(e),n,t),n,t,r,i,a,2):2===o&&g(e,n,t,r,i,a):v(l(e),n,t,r,i,a,1);break}}}function c(e){var n=e.prev,t=e,r=e.next;if(S(n,t,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Z(n.x,n.y,t.x,t.y,r.x,r.y,i.x,i.y)&&S(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function d(e,n,t,r){var i=e.prev,a=e,o=e.next;if(S(i,a,o)>=0)return!1;for(var x=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,u=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,p=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,h=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,y=C(x,u,n,t,r),f=C(p,h,n,t,r),s=e.prevZ,l=e.nextZ;s&&s.z>=y&&l&&l.z<=f;){if(s!==e.prev&&s!==e.next&&Z(i.x,i.y,a.x,a.y,o.x,o.y,s.x,s.y)&&S(s.prev,s,s.next)>=0||(s=s.prevZ,l!==e.prev&&l!==e.next&&Z(i.x,i.y,a.x,a.y,o.x,o.y,l.x,l.y)&&S(l.prev,l,l.next)>=0))return!1;l=l.nextZ}for(;s&&s.z>=y;){if(s!==e.prev&&s!==e.next&&Z(i.x,i.y,a.x,a.y,o.x,o.y,s.x,s.y)&&S(s.prev,s,s.next)>=0)return!1;s=s.prevZ}for(;l&&l.z<=f;){if(l!==e.prev&&l!==e.next&&Z(i.x,i.y,a.x,a.y,o.x,o.y,l.x,l.y)&&S(l.prev,l,l.next)>=0)return!1;l=l.nextZ}return!0}function m(e,n,t){var r=e;do{var i=r.prev,a=r.next.next;!z(i,a)&&A(i,r,r.next,a)&&T(i,a)&&T(a,i)&&(n.push(i.i/t),n.push(r.i/t),n.push(a.i/t),N(r),N(r.next),r=e=a),r=r.next}while(r!==e);return l(r)}function g(e,n,t,r,i,a){var o=e;do{for(var x=o.next.next;x!==o.prev;){if(o.i!==x.i&&M(o,x)){var u=L(o,x);return o=l(o,o.next),u=l(u,u.next),v(o,n,t,r,i,a),void v(u,n,t,r,i,a)}x=x.next}o=o.next}while(o!==e)}function b(e,n){return e.x-n.x}function w(e,n){if(n=function(e,n){var t,r=n,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var x=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(x<=i&&x>o){if(o=x,x===i){if(a===r.y)return r;if(a===r.next.y)return r.next}t=r.x<r.next.x?r:r.next}}r=r.next}while(r!==n);if(!t)return null;if(i===o)return t;var u,p=t,h=t.x,y=t.y,f=1/0;r=t;do{i>=r.x&&r.x>=h&&i!==r.x&&Z(a<y?i:o,a,h,y,a<y?o:i,a,r.x,r.y)&&(u=Math.abs(a-r.y)/(i-r.x),T(r,e)&&(u<f||u===f&&(r.x>t.x||r.x===t.x&&E(t,r)))&&(t=r,f=u)),r=r.next}while(r!==p);return t}(e,n),n){var t=L(n,e);l(t,t.next)}}function E(e,n){return S(e.prev,e,n.prev)<0&&S(n.next,e,e.next)<0}function C(e,n,t,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-t)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-r)*i)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function O(e){var n=e,t=e;do{(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next}while(n!==e);return t}function Z(e,n,t,r,i,a,o,x){return(i-o)*(n-x)-(e-o)*(a-x)>=0&&(e-o)*(r-x)-(t-o)*(n-x)>=0&&(t-o)*(a-x)-(i-o)*(r-x)>=0}function M(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!function(e,n){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==n.i&&t.next.i!==n.i&&A(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}(e,n)&&(T(e,n)&&T(n,e)&&function(e,n){var t=e,r=!1,i=(e.x+n.x)/2,a=(e.y+n.y)/2;do{t.y>a!=t.next.y>a&&t.next.y!==t.y&&i<(t.next.x-t.x)*(a-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next}while(t!==e);return r}(e,n)&&(S(e.prev,e,n.prev)||S(e,n.prev,n))||z(e,n)&&S(e.prev,e,e.next)>0&&S(n.prev,n,n.next)>0)}function S(e,n,t){return(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function z(e,n){return e.x===n.x&&e.y===n.y}function A(e,n,t,r){var i=R(S(e,n,t)),a=R(S(e,n,r)),o=R(S(t,r,e)),x=R(S(t,r,n));return!!(i!==a&&o!==x||0===i&&D(e,t,n)||0===a&&D(e,r,n)||0===o&&D(t,e,r)||0===x&&D(t,n,r))}function D(e,n,t){return n.x<=Math.max(e.x,t.x)&&n.x>=Math.min(e.x,t.x)&&n.y<=Math.max(e.y,t.y)&&n.y>=Math.min(e.y,t.y)}function R(e){return e>0?1:e<0?-1:0}function T(e,n){return S(e.prev,e,e.next)<0?S(e,n,e.next)>=0&&S(e,e.prev,n)>=0:S(e,n,e.prev)<0||S(e,e.next,n)<0}function L(e,n){var t=new W(e.i,e.x,e.y),r=new W(n.i,n.x,n.y),i=e.next,a=n.prev;return e.next=n,n.prev=e,t.next=i,i.prev=t,r.next=t,t.prev=r,a.next=r,r.prev=a,r}function I(e,n,t,r){var i=new W(e,n,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function N(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function W(e,n,t){this.i=e,this.x=n,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function P(e,n,t,r){for(var i=0,a=n,o=t-r;a<t;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}f.deviation=function(e,n,t,r){var i=n&&n.length,a=i?n[0]*t:e.length,o=Math.abs(P(e,0,a,t));if(i)for(var x=0,u=n.length;x<u;x++){var p=n[x]*t,h=x<u-1?n[x+1]*t:e.length;o-=Math.abs(P(e,p,h,t))}var y=0;for(x=0;x<r.length;x+=3){var f=r[x]*t,s=r[x+1]*t,l=r[x+2]*t;y+=Math.abs((e[f]-e[l])*(e[s+1]-e[f+1])-(e[f]-e[s])*(e[l+1]-e[f+1]))}return 0===o&&0===y?0:Math.abs((y-o)/o)},f.flatten=function(e){for(var n=e[0][0].length,t={vertices:[],holes:[],dimensions:n},r=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<n;o++)t.vertices.push(e[i][a][o]);i>0&&(r+=e[i-1].length,t.holes.push(r))}return t};var B={CLOCKWISE:y.d.CW,COUNTER_CLOCKWISE:y.d.CCW,NONE:y.d.NONE,validate:function(e){return e===B.CLOCKWISE||e===B.COUNTER_CLOCKWISE}},G=Object.freeze(B),_=new t.o,q=new t.o,U={computeArea2D:function(e){i.o.defined("positions",e),i.o.typeOf.number.greaterThanOrEquals("positions.length",e.length,3);for(var n=e.length,t=0,r=n-1,a=0;a<n;r=a++){var o=e[r],x=e[a];t+=o.x*x.y-x.x*o.y}return.5*t},computeWindingOrder2D:function(e){return U.computeArea2D(e)>0?G.COUNTER_CLOCKWISE:G.CLOCKWISE},triangulate:function(e,t){return i.o.defined("positions",e),f(n.o.packArray(e),t,2)}},K=new t.o,k=new t.o,F=new t.o,j=new t.o,H=new t.o,J=new t.o,Q=new t.o;U.computeSubdivision=function(e,n,r,x,y){y=o.u(y,!1),x=o.u(x,p.e.RADIANS_PER_DEGREE),i.o.typeOf.object("ellipsoid",e),i.o.defined("positions",n),i.o.defined("indices",r),i.o.typeOf.number.greaterThanOrEquals("indices.length",r.length,3),i.o.typeOf.number.equals("indices.length % 3","0",r.length%3,0),i.o.typeOf.number.greaterThan("granularity",x,0);var f,s=r.slice(0),l=n.length,v=new Array(3*l),c=0;for(f=0;f<l;f++){var d=n[f];v[c++]=d.x,v[c++]=d.y,v[c++]=d.z}for(var m=[],g={},b=e.maximumRadius,w=p.e.chordLength(x,b),E=w*w;s.length>0;){var C,O,Z=s.pop(),M=s.pop(),S=s.pop(),z=t.o.fromArray(v,3*S,K),A=t.o.fromArray(v,3*M,k),D=t.o.fromArray(v,3*Z,F),R=y?z:t.o.multiplyByScalar(t.o.normalize(z,j),b,j),T=y?A:t.o.multiplyByScalar(t.o.normalize(A,H),b,H),L=y?D:t.o.multiplyByScalar(t.o.normalize(D,J),b,J),I=t.o.magnitudeSquared(t.o.subtract(R,T,Q)),N=t.o.magnitudeSquared(t.o.subtract(T,L,Q)),W=t.o.magnitudeSquared(t.o.subtract(L,R,Q)),P=Math.max(I,N,W);P>E?I===P?(f=g[C=Math.min(S,M)+" "+Math.max(S,M)],o.e(f)||(O=t.o.add(z,A,Q),t.o.multiplyByScalar(O,.5,O),v.push(O.x,O.y,O.z),f=v.length/3-1,g[C]=f),s.push(S,f,Z),s.push(f,M,Z)):N===P?(f=g[C=Math.min(M,Z)+" "+Math.max(M,Z)],o.e(f)||(O=t.o.add(A,D,Q),t.o.multiplyByScalar(O,.5,O),v.push(O.x,O.y,O.z),f=v.length/3-1,g[C]=f),s.push(M,f,S),s.push(f,Z,S)):W===P&&(f=g[C=Math.min(Z,S)+" "+Math.max(Z,S)],o.e(f)||(O=t.o.add(D,z,Q),t.o.multiplyByScalar(O,.5,O),v.push(O.x,O.y,O.z),f=v.length/3-1,g[C]=f),s.push(Z,f,M),s.push(f,S,M)):(m.push(S),m.push(M),m.push(Z))}return new u.I({attributes:{position:new u.o({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:v})},indices:m,primitiveType:h._0x4b6a27.TRIANGLES})};var V=new r.a,X=new r.a,Y=new r.a,$=new r.a;U.computeRhumbLineSubdivision=function(e,n,r,y){y=o.u(y,p.e.RADIANS_PER_DEGREE),i.o.typeOf.object("ellipsoid",e),i.o.defined("positions",n),i.o.defined("indices",r),i.o.typeOf.number.greaterThanOrEquals("indices.length",r.length,3),i.o.typeOf.number.equals("indices.length % 3","0",r.length%3,0),i.o.typeOf.number.greaterThan("granularity",y,0);var f,s=r.slice(0),l=n.length,v=new Array(3*l),c=0;for(f=0;f<l;f++){var d=n[f];v[c++]=d.x,v[c++]=d.y,v[c++]=d.z}for(var m=[],g={},b=e.maximumRadius,w=p.e.chordLength(y,b),E=new x.P(void 0,void 0,e),C=new x.P(void 0,void 0,e),O=new x.P(void 0,void 0,e);s.length>0;){var Z=s.pop(),M=s.pop(),S=s.pop(),z=t.o.fromArray(v,3*S,K),A=t.o.fromArray(v,3*M,k),D=t.o.fromArray(v,3*Z,F),R=e.cartesianToCartographic(z,V),T=e.cartesianToCartographic(A,X),L=e.cartesianToCartographic(D,Y);E.setEndPoints(R,T);var I=E.surfaceDistance;C.setEndPoints(T,L);var N=C.surfaceDistance;O.setEndPoints(L,R);var W,P,B,G,_=O.surfaceDistance,q=Math.max(I,N,_);q>w?I===q?(f=g[W=Math.min(S,M)+" "+Math.max(S,M)],o.e(f)||(P=E.interpolateUsingFraction(.5,$),B=.5*(R.height+T.height),G=t.o.fromRadians(P.longitude,P.latitude,B,e,Q),v.push(G.x,G.y,G.z),f=v.length/3-1,g[W]=f),s.push(S,f,Z),s.push(f,M,Z)):N===q?(f=g[W=Math.min(M,Z)+" "+Math.max(M,Z)],o.e(f)||(P=C.interpolateUsingFraction(.5,$),B=.5*(T.height+L.height),G=t.o.fromRadians(P.longitude,P.latitude,B,e,Q),v.push(G.x,G.y,G.z),f=v.length/3-1,g[W]=f),s.push(M,f,S),s.push(f,Z,S)):_===q&&(f=g[W=Math.min(Z,S)+" "+Math.max(Z,S)],o.e(f)||(P=O.interpolateUsingFraction(.5,$),B=.5*(L.height+R.height),G=t.o.fromRadians(P.longitude,P.latitude,B,e,Q),v.push(G.x,G.y,G.z),f=v.length/3-1,g[W]=f),s.push(Z,f,M),s.push(f,S,M)):(m.push(S),m.push(M),m.push(Z))}return new u.I({attributes:{position:new u.o({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:v})},indices:m,primitiveType:h._0x4b6a27.TRIANGLES})},U.scaleToGeodeticHeight=function(e,r,i,a){i=o.u(i,n.t.WGS84);var x=_,u=q;if(r=o.u(r,0),a=o.u(a,!0),o.e(e))for(var p=e.length,h=0;h<p;h+=3)t.o.fromArray(e,h,u),a&&(u=i.scaleToGeodeticSurface(u,u)),0!==r&&(x=i.geodeticSurfaceNormal(u,x),t.o.multiplyByScalar(x,r,x),t.o.add(u,x,u)),e[h]=u.x,e[h+1]=u.y,e[h+2]=u.z;return e},e.A=U,e.W=G}));
