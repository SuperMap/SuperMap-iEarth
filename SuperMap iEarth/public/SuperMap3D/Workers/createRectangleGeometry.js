define(["./when-39df26e1","./Cartesian2-59a54ee7","./arrayFill-9b55d6b2","./buildModuleUrl-1b968a9d","./Cartographic-81e9e8b2","./Check-ff445961","./ComponentDatatype-7d28dd1c","./GeometryAttribute-9b3921a3","./GeometryAttributes-11421d3c","./GeometryInstance-67860833","./GeometryOffsetAttribute-b4d599f5","./GeometryPipeline-91e3b4f0","./IndexDatatype-be421fbf","./Math-5e067eb3","./FeatureDetection-2d4141ff","./PolygonPipeline-ae195f4e","./RectangleGeometryLibrary-c641a2c8","./VertexFormat-79ab0d67","./Event-e109b23e","./RuntimeError-251a1d8d","./WebGLConstants-42651efd","./Cartesian4-a56bd360","./AttributeCompression-4cf880dc","./EncodedCartesian3-003b996c","./IntersectionTests-036daea1","./Plane-775a5120","./EllipsoidRhumbLine-61b02483"],(function(t,e,a,o,n,r,i,s,u,l,c,p,d,g,h,m,f,v,y,b,_,w,A,x,E,D,F){"use strict";var P=new n.o,R=new n.o,L=new n.o,T=new n.o,C=new e.h,O=new e.o,N=new o.i,I=new o.i;function k(t,e){var a=new s.I({attributes:new u.a,primitiveType:h._0x2355b9.TRIANGLES});return a.attributes.position=new s.o({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(a.attributes.normal=new s.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(a.attributes.tangent=new s.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(a.attributes.bitangent=new s.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.bitangents})),a}var S=new n.o,z=new n.o;function G(t,e){var a=t._vertexFormat,o=t._ellipsoid,r=e.height,u=e.width,l=e.northCap,c=e.southCap,p=0,g=r,m=r,v=0;l&&(p=1,m-=1,v+=1),c&&(g-=1,m-=1,v+=1),v+=u*m;for(var y=a.position?new Float64Array(3*v):void 0,b=a.st?new Float32Array(2*v):void 0,_=0,w=0,A=P,x=O,E=Number.MAX_VALUE,D=Number.MAX_VALUE,F=-Number.MAX_VALUE,C=-Number.MAX_VALUE,N=p;N<g;++N)for(var I=0;I<u;++I)f.j.computePosition(e,o,a.st,N,I,A,x),y[_++]=A.x,y[_++]=A.y,y[_++]=A.z,a.st&&(b[w++]=x.x,b[w++]=x.y,E=Math.min(E,x.x),D=Math.min(D,x.y),F=Math.max(F,x.x),C=Math.max(C,x.y));if(l&&(f.j.computePosition(e,o,a.st,0,0,A,x),y[_++]=A.x,y[_++]=A.y,y[_++]=A.z,a.st&&(b[w++]=x.x,b[w++]=x.y,E=x.x,D=x.y,F=x.x,C=x.y)),c&&(f.j.computePosition(e,o,a.st,r-1,0,A,x),y[_++]=A.x,y[_++]=A.y,y[_]=A.z,a.st&&(b[w++]=x.x,b[w]=x.y,E=Math.min(E,x.x),D=Math.min(D,x.y),F=Math.max(F,x.x),C=Math.max(C,x.y))),a.st&&(E<0||D<0||F>1||C>1))for(var S=0;S<b.length;S+=2)b[S]=(b[S]-E)/(F-E),b[S+1]=(b[S+1]-D)/(C-D);var z=function(t,e,a,o){var r=t.length,i=e.normal?new Float32Array(r):void 0,s=e.tangent?new Float32Array(r):void 0,u=e.bitangent?new Float32Array(r):void 0,l=0,c=T,p=L,d=R;if(e.normal||e.tangent||e.bitangent)for(var g=0;g<r;g+=3){var m=n.o.fromArray(t,g,P),f=l+1,v=l+2;d=a.geodeticSurfaceNormal(m,d),(e.tangent||e.bitangent)&&(n.o.cross(n.o.UNIT_Z,d,p),h.p$1.multiplyByVector(o,p,p),n.o.normalize(p,p),e.bitangent&&n.o.normalize(n.o.cross(d,p,c),c)),e.normal&&(i[l]=d.x,i[f]=d.y,i[v]=d.z),e.tangent&&(s[l]=p.x,s[f]=p.y,s[v]=p.z),e.bitangent&&(u[l]=c.x,u[f]=c.y,u[v]=c.z),l+=3}return k(e,{positions:t,normals:i,tangents:s,bitangents:u})}(y,a,o,e.tangentRotationMatrix),G=6*(u-1)*(m-1);l&&(G+=3*(u-1)),c&&(G+=3*(u-1));var M,H=d.IndexDatatype.createTypedArray(v,G),V=0,U=0;for(M=0;M<m-1;++M){for(var j=0;j<u-1;++j){var B=V,q=B+u,Y=q+1,$=B+1;H[U++]=B,H[U++]=q,H[U++]=$,H[U++]=$,H[U++]=q,H[U++]=Y,++V}++V}if(l||c){var X,W,J=v-1,Q=v-1;if(l&&c&&(J=v-2),V=0,l)for(M=0;M<u-1;M++)W=(X=V)+1,H[U++]=J,H[U++]=X,H[U++]=W,++V;if(c)for(V=(m-1)*u,M=0;M<u-1;M++)W=(X=V)+1,H[U++]=X,H[U++]=Q,H[U++]=W,++V}return z.indices=H,a.st&&(z.attributes.st=new s.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:b})),z}function M(t,e,a,o,n){return t[e++]=o[a],t[e++]=o[a+1],t[e++]=o[a+2],t[e++]=n[a],t[e++]=n[a+1],t[e]=n[a+2],t}function H(t,e,a,o){return t[e++]=o[a],t[e++]=o[a+1],t[e++]=o[a],t[e]=o[a+1],t}var V=new v.n;function U(e,o){var r,u=e._shadowVolume,h=e._offsetAttribute,f=e._vertexFormat,y=e._extrudedHeight,b=e._surfaceHeight,_=e._ellipsoid,w=o.height,A=o.width;if(u){var x=v.n.clone(f,V);x.normal=!0,e._vertexFormat=x}var E=G(e,o);u&&(e._vertexFormat=f);var D=m.A.scaleToGeodeticHeight(E.attributes.position.values,b,_,!1),F=(D=new Float64Array(D)).length,C=2*F,O=new Float64Array(C);O.set(D);var N=m.A.scaleToGeodeticHeight(E.attributes.position.values,y,_);O.set(N,F),E.attributes.position.values=O;var I,U,j=f.normal?new Float32Array(C):void 0,B=f.tangent?new Float32Array(C):void 0,q=f.bitangent?new Float32Array(C):void 0,Y=f.st?new Float32Array(C/3*2):void 0;if(f.normal){for(U=E.attributes.normal.values,j.set(U),r=0;r<F;r++)U[r]=-U[r];j.set(U,F),E.attributes.normal.values=j}if(u){U=E.attributes.normal.values,f.normal||(E.attributes.normal=void 0);var $=new Float32Array(C);for(r=0;r<F;r++)U[r]=-U[r];$.set(U,F),E.attributes.extrudeDirection=new s.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:$})}var X,W=t.e(h);if(W){var J=F/3*2,Q=new Uint8Array(J);h===c.z.TOP?Q=a.d(Q,1,0,J/2):(X=h===c.z.NONE?0:1,Q=a.d(Q,X)),E.attributes.applyOffset=new s.o({componentDatatype:i.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:Q})}if(f.tangent){var Z=E.attributes.tangent.values;for(B.set(Z),r=0;r<F;r++)Z[r]=-Z[r];B.set(Z,F),E.attributes.tangent.values=B}if(f.bitangent){var K=E.attributes.bitangent.values;q.set(K),q.set(K,F),E.attributes.bitangent.values=q}f.st&&(I=E.attributes.st.values,Y.set(I),Y.set(I,F/3*2),E.attributes.st.values=Y);var tt=E.indices,et=tt.length,at=F/3,ot=d.IndexDatatype.createTypedArray(C/3,2*et);for(ot.set(tt),r=0;r<et;r+=3)ot[r+et]=tt[r+2]+at,ot[r+1+et]=tt[r+1]+at,ot[r+2+et]=tt[r]+at;E.indices=ot;var nt=o.northCap,rt=o.southCap,it=w,st=2,ut=0,lt=4,ct=4;nt&&(st-=1,it-=1,ut+=1,lt-=2,ct-=1),rt&&(st-=1,it-=1,ut+=1,lt-=2,ct-=1);var pt=2*((ut+=st*A+2*it-lt)+ct),dt=new Float64Array(3*pt),gt=u?new Float32Array(3*pt):void 0,ht=W?new Uint8Array(pt):void 0,mt=f.st?new Float32Array(2*pt):void 0,ft=h===c.z.TOP;W&&!ft&&(X=h===c.z.ALL?1:0,ht=a.d(ht,X));var vt,yt=0,bt=0,_t=0,wt=0,At=A*it;for(r=0;r<At;r+=A)dt=M(dt,yt,vt=3*r,D,N),yt+=6,f.st&&(mt=H(mt,bt,2*r,I),bt+=4),u&&(_t+=3,gt[_t++]=U[vt],gt[_t++]=U[vt+1],gt[_t++]=U[vt+2]),ft&&(ht[wt++]=1,wt+=1);if(rt){var xt=nt?At+1:At;for(vt=3*xt,r=0;r<2;r++)dt=M(dt,yt,vt,D,N),yt+=6,f.st&&(mt=H(mt,bt,2*xt,I),bt+=4),u&&(_t+=3,gt[_t++]=U[vt],gt[_t++]=U[vt+1],gt[_t++]=U[vt+2]),ft&&(ht[wt++]=1,wt+=1)}else for(r=At-A;r<At;r++)dt=M(dt,yt,vt=3*r,D,N),yt+=6,f.st&&(mt=H(mt,bt,2*r,I),bt+=4),u&&(_t+=3,gt[_t++]=U[vt],gt[_t++]=U[vt+1],gt[_t++]=U[vt+2]),ft&&(ht[wt++]=1,wt+=1);for(r=At-1;r>0;r-=A)dt=M(dt,yt,vt=3*r,D,N),yt+=6,f.st&&(mt=H(mt,bt,2*r,I),bt+=4),u&&(_t+=3,gt[_t++]=U[vt],gt[_t++]=U[vt+1],gt[_t++]=U[vt+2]),ft&&(ht[wt++]=1,wt+=1);if(nt){var Et=At;for(vt=3*Et,r=0;r<2;r++)dt=M(dt,yt,vt,D,N),yt+=6,f.st&&(mt=H(mt,bt,2*Et,I),bt+=4),u&&(_t+=3,gt[_t++]=U[vt],gt[_t++]=U[vt+1],gt[_t++]=U[vt+2]),ft&&(ht[wt++]=1,wt+=1)}else for(r=A-1;r>=0;r--)dt=M(dt,yt,vt=3*r,D,N),yt+=6,f.st&&(mt=H(mt,bt,2*r,I),bt+=4),u&&(_t+=3,gt[_t++]=U[vt],gt[_t++]=U[vt+1],gt[_t++]=U[vt+2]),ft&&(ht[wt++]=1,wt+=1);var Dt=function(t,e,a){var o=t.length,r=e.normal?new Float32Array(o):void 0,i=e.tangent?new Float32Array(o):void 0,s=e.bitangent?new Float32Array(o):void 0,u=0,l=0,c=0,p=!0,d=T,h=L,m=R;if(e.normal||e.tangent||e.bitangent)for(var f=0;f<o;f+=6){var v=n.o.fromArray(t,f,P),y=n.o.fromArray(t,(f+6)%o,S);if(p){var b=n.o.fromArray(t,(f+3)%o,z);n.o.subtract(y,v,y),n.o.subtract(b,v,b),m=n.o.normalize(n.o.cross(b,y,m),m),p=!1}n.o.equalsEpsilon(y,v,g.e.EPSILON10)&&(p=!0),(e.tangent||e.bitangent)&&(d=a.geodeticSurfaceNormal(v,d),e.tangent&&(h=n.o.normalize(n.o.cross(d,m,h),h))),e.normal&&(r[u++]=m.x,r[u++]=m.y,r[u++]=m.z,r[u++]=m.x,r[u++]=m.y,r[u++]=m.z),e.tangent&&(i[l++]=h.x,i[l++]=h.y,i[l++]=h.z,i[l++]=h.x,i[l++]=h.y,i[l++]=h.z),e.bitangent&&(s[c++]=d.x,s[c++]=d.y,s[c++]=d.z,s[c++]=d.x,s[c++]=d.y,s[c++]=d.z)}return k(e,{positions:t,normals:r,tangents:i,bitangents:s})}(dt,f,_);f.st&&(Dt.attributes.st=new s.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:mt})),u&&(Dt.attributes.extrudeDirection=new s.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:gt})),W&&(Dt.attributes.applyOffset=new s.o({componentDatatype:i.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:ht}));var Ft,Pt,Rt,Lt,Tt=d.IndexDatatype.createTypedArray(pt,6*ut);F=dt.length/3;var Ct=0;for(r=0;r<F-1;r+=2){Lt=((Ft=r)+2)%F;var Ot=n.o.fromArray(dt,3*Ft,S),Nt=n.o.fromArray(dt,3*Lt,z);n.o.equalsEpsilon(Ot,Nt,g.e.EPSILON10)||(Rt=((Pt=(Ft+1)%F)+2)%F,Tt[Ct++]=Ft,Tt[Ct++]=Pt,Tt[Ct++]=Lt,Tt[Ct++]=Lt,Tt[Ct++]=Pt,Tt[Ct++]=Rt)}return Dt.indices=Tt,(Dt=p.k.combineInstances([new l.d({geometry:E}),new l.d({geometry:Dt})]))[0]}var j=[new n.o,new n.o,new n.o,new n.o],B=new n.a,q=new n.a;function Y(t,a,o,n,r){if(0===o)return e.h.clone(t,r);var i=f.j.computeOptions(t,a,o,0,C,B),s=i.height,u=i.width,l=j;return f.j.computePosition(i,n,!1,0,0,l[0]),f.j.computePosition(i,n,!1,0,u-1,l[1]),f.j.computePosition(i,n,!1,s-1,0,l[2]),f.j.computePosition(i,n,!1,s-1,u-1,l[3]),e.h.fromCartesianArray(l,n,r)}function $(a){var o=(a=t.u(a,t.u.EMPTY_OBJECT)).rectangle;if(r.o.typeOf.object("rectangle",o),e.h.validate(o),o.north<o.south)throw new r.t("options.rectangle.north must be greater than or equal to options.rectangle.south");var n=t.u(a.height,0),i=t.u(a.extrudedHeight,n);this._rectangle=e.h.clone(o),this._granularity=t.u(a.granularity,g.e.RADIANS_PER_DEGREE),this._ellipsoid=e.t.clone(t.u(a.ellipsoid,e.t.WGS84)),this._surfaceHeight=Math.max(n,i),this._rotation=t.u(a.rotation,0),this._stRotation=t.u(a.stRotation,0),this._vertexFormat=v.n.clone(t.u(a.vertexFormat,v.n.DEFAULT)),this._extrudedHeight=Math.min(n,i),this._shadowVolume=t.u(a.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=a.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}$.packedLength=e.h.packedLength+e.t.packedLength+v.n.packedLength+7,$.pack=function(a,o,n){return r.o.typeOf.object("value",a),r.o.defined("array",o),n=t.u(n,0),e.h.pack(a._rectangle,o,n),n+=e.h.packedLength,e.t.pack(a._ellipsoid,o,n),n+=e.t.packedLength,v.n.pack(a._vertexFormat,o,n),n+=v.n.packedLength,o[n++]=a._granularity,o[n++]=a._surfaceHeight,o[n++]=a._rotation,o[n++]=a._stRotation,o[n++]=a._extrudedHeight,o[n++]=a._shadowVolume?1:0,o[n]=t.u(a._offsetAttribute,-1),o};var X=new e.h,W=e.t.clone(e.t.UNIT_SPHERE),J={rectangle:X,ellipsoid:W,vertexFormat:V,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};$.unpack=function(a,o,n){r.o.defined("array",a),o=t.u(o,0);var i=e.h.unpack(a,o,X);o+=e.h.packedLength;var s=e.t.unpack(a,o,W);o+=e.t.packedLength;var u=v.n.unpack(a,o,V);o+=v.n.packedLength;var l=a[o++],c=a[o++],p=a[o++],d=a[o++],g=a[o++],h=1===a[o++],m=a[o];return t.e(n)?(n._rectangle=e.h.clone(i,n._rectangle),n._ellipsoid=e.t.clone(s,n._ellipsoid),n._vertexFormat=v.n.clone(u,n._vertexFormat),n._granularity=l,n._surfaceHeight=c,n._rotation=p,n._stRotation=d,n._extrudedHeight=g,n._shadowVolume=h,n._offsetAttribute=-1===m?void 0:m,n):(J.granularity=l,J.height=c,J.rotation=p,J.stRotation=d,J.extrudedHeight=g,J.shadowVolume=h,J.offsetAttribute=-1===m?void 0:m,new $(J))},$.computeRectangle=function(a,o){var n=(a=t.u(a,t.u.EMPTY_OBJECT)).rectangle;if(r.o.typeOf.object("rectangle",n),e.h.validate(n),n.north<n.south)throw new r.t("options.rectangle.north must be greater than or equal to options.rectangle.south");var i=t.u(a.granularity,g.e.RADIANS_PER_DEGREE),s=t.u(a.ellipsoid,e.t.WGS84);return Y(n,i,t.u(a.rotation,0),s,o)};var Q=new h.p$1,Z=new s.n,K=new n.a;$.createGeometry=function(n){if(!g.e.equalsEpsilon(n._rectangle.north,n._rectangle.south,g.e.EPSILON10)&&!g.e.equalsEpsilon(n._rectangle.east,n._rectangle.west,g.e.EPSILON10)){var r=n._rectangle,u=n._ellipsoid,l=n._rotation,p=n._stRotation,d=n._vertexFormat,v=f.j.computeOptions(r,n._granularity,l,p,C,B,q),y=Q;if(0!==p||0!==l){var b=e.h.center(r,K),_=u.geodeticSurfaceNormalCartographic(b,S);s.n.fromAxisAngle(_,-p,Z),h.p$1.fromQuaternion(Z,y)}else h.p$1.clone(h.p$1.IDENTITY,y);var w,A,x=n._surfaceHeight,E=n._extrudedHeight,D=!g.e.equalsEpsilon(x,E,0,g.e.EPSILON2);if(v.lonScalar=1/n._rectangle.width,v.latScalar=1/n._rectangle.height,v.tangentRotationMatrix=y,r=n._rectangle,D){w=U(n,v);var F=o.i.fromRectangle3D(r,u,x,I),P=o.i.fromRectangle3D(r,u,E,N);A=o.i.union(F,P)}else{if((w=G(n,v)).attributes.position.values=m.A.scaleToGeodeticHeight(w.attributes.position.values,x,u,!1),t.e(n._offsetAttribute)){var R=w.attributes.position.values.length,L=new Uint8Array(R/3),T=n._offsetAttribute===c.z.NONE?0:1;a.d(L,T),w.attributes.applyOffset=new s.o({componentDatatype:i.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:L})}A=o.i.fromRectangle3D(r,u,x)}return d.position||delete w.attributes.position,new s.I({attributes:w.attributes,indices:w.indices,primitiveType:w.primitiveType,boundingSphere:A,offsetAttribute:n._offsetAttribute})}},$.createShadowVolume=function(t,e,a){var o=t._granularity,n=t._ellipsoid,r=e(o,n),i=a(o,n);return new $({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:n,stRotation:t._stRotation,granularity:o,extrudedHeight:i,height:r,vertexFormat:v.n.POSITION_ONLY,shadowVolume:!0})};var tt=new e.h,et=[new e.o,new e.o,new e.o],at=new s.f,ot=new n.a;return Object.defineProperties($.prototype,{rectangle:{get:function(){return t.e(this._rotatedRectangle)||(this._rotatedRectangle=Y(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return t.e(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){if(0===t._stRotation)return[0,0,0,1,1,0];var a=e.h.clone(t._rectangle,tt),o=t._granularity,n=t._ellipsoid,r=Y(a,o,t._rotation-t._stRotation,n,tt),i=et;i[0].x=r.west,i[0].y=r.south,i[1].x=r.west,i[1].y=r.north,i[2].x=r.east,i[2].y=r.south;for(var u=t.rectangle,l=s.f.fromRotation(t._stRotation,at),c=e.h.center(u,ot),p=0;p<3;++p){var d=i[p];d.x-=c.longitude,d.y-=c.latitude,s.f.multiplyByVector(l,d,d),d.x+=c.longitude,d.y+=c.latitude,d.x=(d.x-u.west)/u.width,d.y=(d.y-u.south)/u.height}var g=i[0],h=i[1],m=i[2],f=new Array(6);return e.o.pack(g,f),e.o.pack(h,f,2),e.o.pack(m,f,4),f}(this)),this._textureCoordinateRotationPoints}}}),function(a,o){return t.e(o)&&(a=$.unpack(a,o)),a._ellipsoid=e.t.clone(a._ellipsoid),a._rectangle=e.h.clone(a._rectangle),$.createGeometry(a)}}));
