import{a as j}from"./chunk-IZAS6KUJ.js";import{a as yt,b as mt}from"./chunk-MPSLJKIO.js";import{a as U}from"./chunk-RYEDLSXB.js";import{b as xt}from"./chunk-ZMHH4UFY.js";import"./chunk-6X6ULKRC.js";import{a as Ot}from"./chunk-ONAS2LTV.js";import{a as Xt}from"./chunk-VI4IWVT4.js";import"./chunk-MQMYX2JZ.js";import"./chunk-KW5QJXXE.js";import"./chunk-REXJO6A6.js";import"./chunk-EUSYH4JF.js";import{a as Pt}from"./chunk-44AFRGCG.js";import{a as qt}from"./chunk-UIA2BV6O.js";import{d as ft,f as St,g as Tt,k as Ht,l as z}from"./chunk-CJHFPVIB.js";import"./chunk-NPAFDOYL.js";import{b as Yt}from"./chunk-SSYG2MIY.js";import{a as F}from"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import{a as dt}from"./chunk-Z4SOZDEW.js";import"./chunk-MX7ZM7WW.js";import"./chunk-EHDXVZQM.js";import{a as y}from"./chunk-NLYLRNUA.js";import{a as et,b as T}from"./chunk-7TOCOFC3.js";import"./chunk-ZVKIUA3Y.js";import{b as At}from"./chunk-3HZNWEV7.js";import{a as b}from"./chunk-LBR6REQR.js";import{a as q}from"./chunk-GXFCHGTA.js";import{a as E}from"./chunk-UBHQMGET.js";import{a as ht}from"./chunk-EDZQSM3T.js";import{a as Lt}from"./chunk-PJGSCWXZ.js";import{a as tt}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";var Dt=new b,Jt=new b,Qt=new b,Zt=new b,Kt=new y,ie=new et,oe=new ft,ue=new ft;function $t(t,e){var a=new Ht({attributes:new qt,primitiveType:Yt.TRIANGLES});return a.attributes.position=new z({componentDatatype:F.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(a.attributes.normal=new z({componentDatatype:F.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(a.attributes.tangent=new z({componentDatatype:F.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(a.attributes.bitangent=new z({componentDatatype:F.FLOAT,componentsPerAttribute:3,values:e.bitangents})),a}function se(t,e,a,o){var n=t.length,s=e.normal?new Float32Array(n):void 0,l=e.tangent?new Float32Array(n):void 0,c=e.bitangent?new Float32Array(n):void 0,m=0,d=Zt,r=Qt,f=Jt;if(e.normal||e.tangent||e.bitangent)for(var i=0;i<n;i+=3){var u=b.fromArray(t,i,Dt),v=m+1,p=m+2;f=a.geodeticSurfaceNormal(u,f),(e.tangent||e.bitangent)&&(b.cross(b.UNIT_Z,f,r),dt.multiplyByVector(o,r,r),b.normalize(r,r),e.bitangent&&b.normalize(b.cross(f,r,d),d)),e.normal&&(s[m]=f.x,s[v]=f.y,s[p]=f.z),e.tangent&&(l[m]=r.x,l[v]=r.y,l[p]=r.z),e.bitangent&&(c[m]=d.x,c[v]=d.y,c[p]=d.z),m+=3}return $t(e,{positions:t,normals:s,tangents:l,bitangents:c})}var Mt=new b,It=new b;function fe(t,e,a){var o=t.length,n=e.normal?new Float32Array(o):void 0,s=e.tangent?new Float32Array(o):void 0,l=e.bitangent?new Float32Array(o):void 0,c=0,m=0,d=0,r=!0,f=Zt,i=Qt,u=Jt;if(e.normal||e.tangent||e.bitangent)for(var v=0;v<o;v+=6){var p=b.fromArray(t,v,Dt),A=b.fromArray(t,(v+6)%o,Mt);if(r){var h=b.fromArray(t,(v+3)%o,It);b.subtract(A,p,A),b.subtract(h,p,h),u=b.normalize(b.cross(h,A,u),u),r=!1}b.equalsEpsilon(A,p,q.EPSILON10)&&(r=!0),(e.tangent||e.bitangent)&&(f=a.geodeticSurfaceNormal(p,f),e.tangent&&(i=b.normalize(b.cross(f,u,i),i))),e.normal&&(n[c++]=u.x,n[c++]=u.y,n[c++]=u.z,n[c++]=u.x,n[c++]=u.y,n[c++]=u.z),e.tangent&&(s[m++]=i.x,s[m++]=i.y,s[m++]=i.z,s[m++]=i.x,s[m++]=i.y,s[m++]=i.z),e.bitangent&&(l[d++]=f.x,l[d++]=f.y,l[d++]=f.z,l[d++]=f.x,l[d++]=f.y,l[d++]=f.z)}return $t(e,{positions:t,normals:n,tangents:s,bitangents:l})}function Gt(t,e){var a=t._vertexFormat,o=t._ellipsoid,n=e.height,s=e.width,l=e.northCap,c=e.southCap,m=0,d=n,r=n,f=0;l&&(m=1,r-=1,f+=1),c&&(d-=1,r-=1,f+=1),f+=s*r;for(var i=a.position?new Float64Array(f*3):void 0,u=a.st?new Float32Array(f*2):void 0,v=0,p=0,A=Dt,h=ie,N=Number.MAX_VALUE,L=Number.MAX_VALUE,B=-Number.MAX_VALUE,Y=-Number.MAX_VALUE,H=m;H<d;++H)for(var g=0;g<s;++g)j.computePosition(e,o,a.st,H,g,A,h),i[v++]=A.x,i[v++]=A.y,i[v++]=A.z,a.st&&(u[p++]=h.x,u[p++]=h.y,N=Math.min(N,h.x),L=Math.min(L,h.y),B=Math.max(B,h.x),Y=Math.max(Y,h.y));if(l&&(j.computePosition(e,o,a.st,0,0,A,h),i[v++]=A.x,i[v++]=A.y,i[v++]=A.z,a.st&&(u[p++]=h.x,u[p++]=h.y,N=h.x,L=h.y,B=h.x,Y=h.y)),c&&(j.computePosition(e,o,a.st,n-1,0,A,h),i[v++]=A.x,i[v++]=A.y,i[v]=A.z,a.st&&(u[p++]=h.x,u[p]=h.y,N=Math.min(N,h.x),L=Math.min(L,h.y),B=Math.max(B,h.x),Y=Math.max(Y,h.y))),a.st&&(N<0||L<0||B>1||Y>1))for(var Q=0;Q<u.length;Q+=2)u[Q]=(u[Q]-N)/(B-N),u[Q+1]=(u[Q+1]-L)/(Y-L);var $=se(i,a,o,e.tangentRotationMatrix),I=6*(s-1)*(r-1);l&&(I+=3*(s-1)),c&&(I+=3*(s-1));var P=Pt.createTypedArray(f,I),C=0,S=0,D;for(D=0;D<r-1;++D){for(var G=0;G<s-1;++G){var Z=C,rt=Z+s,nt=rt+1,lt=Z+1;P[S++]=Z,P[S++]=rt,P[S++]=lt,P[S++]=lt,P[S++]=rt,P[S++]=nt,++C}++C}if(l||c){var _t=f-1,vt=f-1;l&&c&&(_t=f-2);var X,W;if(C=0,l)for(D=0;D<s-1;D++)X=C,W=X+1,P[S++]=_t,P[S++]=X,P[S++]=W,++C;if(c)for(C=(r-1)*s,D=0;D<s-1;D++)X=C,W=X+1,P[S++]=X,P[S++]=vt,P[S++]=W,++C}return $.indices=P,a.st&&($.attributes.st=new z({componentDatatype:F.FLOAT,componentsPerAttribute:2,values:u})),$}function gt(t,e,a,o,n){return t[e++]=o[a],t[e++]=o[a+1],t[e++]=o[a+2],t[e++]=n[a],t[e++]=n[a+1],t[e]=n[a+2],t}function pt(t,e,a,o){return t[e++]=o[a],t[e++]=o[a+1],t[e++]=o[a],t[e]=o[a+1],t}var Vt=new U;function le(t,e){var a=t._shadowVolume,o=t._offsetAttribute,n=t._vertexFormat,s=t._extrudedHeight,l=t._surfaceHeight,c=t._ellipsoid,m=e.height,d=e.width,r;if(a){var f=U.clone(n,Vt);f.normal=!0,t._vertexFormat=f}var i=Gt(t,e);a&&(t._vertexFormat=n);var u=xt.scaleToGeodeticHeight(i.attributes.position.values,l,c,!1);u=new Float64Array(u);var v=u.length,p=v*2,A=new Float64Array(p);A.set(u);var h=xt.scaleToGeodeticHeight(i.attributes.position.values,s,c);A.set(h,v),i.attributes.position.values=A;var N=n.normal?new Float32Array(p):void 0,L=n.tangent?new Float32Array(p):void 0,B=n.bitangent?new Float32Array(p):void 0,Y=n.st?new Float32Array(p/3*2):void 0,H,g;if(n.normal){for(g=i.attributes.normal.values,N.set(g),r=0;r<v;r++)g[r]=-g[r];N.set(g,v),i.attributes.normal.values=N}if(a){g=i.attributes.normal.values,n.normal||(i.attributes.normal=void 0);var Q=new Float32Array(p);for(r=0;r<v;r++)g[r]=-g[r];Q.set(g,v),i.attributes.extrudeDirection=new z({componentDatatype:F.FLOAT,componentsPerAttribute:3,values:Q})}var $,I=tt(o);if(I){var P=v/3*2,C=new Uint8Array(P);o===mt.TOP?C=yt(C,1,0,P/2):($=o===mt.NONE?0:1,C=yt(C,$)),i.attributes.applyOffset=new z({componentDatatype:F.UNSIGNED_BYTE,componentsPerAttribute:1,values:C})}if(n.tangent){var S=i.attributes.tangent.values;for(L.set(S),r=0;r<v;r++)S[r]=-S[r];L.set(S,v),i.attributes.tangent.values=L}if(n.bitangent){var D=i.attributes.bitangent.values;B.set(D),B.set(D,v),i.attributes.bitangent.values=B}n.st&&(H=i.attributes.st.values,Y.set(H),Y.set(H,v/3*2),i.attributes.st.values=Y);var G=i.indices,Z=G.length,rt=v/3,nt=Pt.createTypedArray(p/3,Z*2);for(nt.set(G),r=0;r<Z;r+=3)nt[r+Z]=G[r+2]+rt,nt[r+1+Z]=G[r+1]+rt,nt[r+2+Z]=G[r]+rt;i.indices=nt;var lt=e.northCap,_t=e.southCap,vt=m,X=2,W=0,Nt=4,Ct=4;lt&&(X-=1,vt-=1,W+=1,Nt-=2,Ct-=1),_t&&(X-=1,vt-=1,W+=1,Nt-=2,Ct-=1),W+=X*d+2*vt-Nt;var bt=(W+Ct)*2,x=new Float64Array(bt*3),R=a?new Float32Array(bt*3):void 0,K=I?new Uint8Array(bt):void 0,O=n.st?new Float32Array(bt*2):void 0,it=o===mt.TOP;I&&!it&&($=o===mt.ALL?1:0,K=yt(K,$));var M=0,V=0,w=0,k=0,ot=d*vt,_;for(r=0;r<ot;r+=d)_=r*3,x=gt(x,M,_,u,h),M+=6,n.st&&(O=pt(O,V,r*2,H),V+=4),a&&(w+=3,R[w++]=g[_],R[w++]=g[_+1],R[w++]=g[_+2]),it&&(K[k++]=1,k+=1);if(_t){var zt=lt?ot+1:ot;for(_=zt*3,r=0;r<2;r++)x=gt(x,M,_,u,h),M+=6,n.st&&(O=pt(O,V,zt*2,H),V+=4),a&&(w+=3,R[w++]=g[_],R[w++]=g[_+1],R[w++]=g[_+2]),it&&(K[k++]=1,k+=1)}else for(r=ot-d;r<ot;r++)_=r*3,x=gt(x,M,_,u,h),M+=6,n.st&&(O=pt(O,V,r*2,H),V+=4),a&&(w+=3,R[w++]=g[_],R[w++]=g[_+1],R[w++]=g[_+2]),it&&(K[k++]=1,k+=1);for(r=ot-1;r>0;r-=d)_=r*3,x=gt(x,M,_,u,h),M+=6,n.st&&(O=pt(O,V,r*2,H),V+=4),a&&(w+=3,R[w++]=g[_],R[w++]=g[_+1],R[w++]=g[_+2]),it&&(K[k++]=1,k+=1);if(lt){var Ut=ot;for(_=Ut*3,r=0;r<2;r++)x=gt(x,M,_,u,h),M+=6,n.st&&(O=pt(O,V,Ut*2,H),V+=4),a&&(w+=3,R[w++]=g[_],R[w++]=g[_+1],R[w++]=g[_+2]),it&&(K[k++]=1,k+=1)}else for(r=d-1;r>=0;r--)_=r*3,x=gt(x,M,_,u,h),M+=6,n.st&&(O=pt(O,V,r*2,H),V+=4),a&&(w+=3,R[w++]=g[_],R[w++]=g[_+1],R[w++]=g[_+2]),it&&(K[k++]=1,k+=1);var ut=fe(x,n,c);n.st&&(ut.attributes.st=new z({componentDatatype:F.FLOAT,componentsPerAttribute:2,values:O})),a&&(ut.attributes.extrudeDirection=new z({componentDatatype:F.FLOAT,componentsPerAttribute:3,values:R})),I&&(ut.attributes.applyOffset=new z({componentDatatype:F.UNSIGNED_BYTE,componentsPerAttribute:1,values:K}));var st=Pt.createTypedArray(bt,W*6),wt,Rt,Bt,Et;v=x.length/3;var ct=0;for(r=0;r<v-1;r+=2){wt=r,Et=(wt+2)%v;var re=b.fromArray(x,wt*3,Mt),ne=b.fromArray(x,Et*3,It);b.equalsEpsilon(re,ne,q.EPSILON10)||(Rt=(wt+1)%v,Bt=(Rt+2)%v,st[ct++]=wt,st[ct++]=Rt,st[ct++]=Et,st[ct++]=Et,st[ct++]=Rt,st[ct++]=Bt)}return ut.indices=st,ut=Xt.combineInstances([new Ot({geometry:i}),new Ot({geometry:ut})]),ut[0]}var ve=[new b,new b,new b,new b],te=new At,ce=new At;function kt(t,e,a,o,n){if(a===0)return y.clone(t,n);var s=j.computeOptions(t,e,a,0,Kt,te),l=s.height,c=s.width,m=ve;return j.computePosition(s,o,!1,0,0,m[0]),j.computePosition(s,o,!1,0,c-1,m[1]),j.computePosition(s,o,!1,l-1,0,m[2]),j.computePosition(s,o,!1,l-1,c-1,m[3]),y.fromCartesianArray(m,o,n)}function J(t){t=E(t,E.EMPTY_OBJECT);var e=t.rectangle;if(ht.typeOf.object("rectangle",e),y.validate(e),e.north<e.south)throw new Lt("options.rectangle.north must be greater than or equal to options.rectangle.south");var a=E(t.height,0),o=E(t.extrudedHeight,a);this._rectangle=y.clone(e),this._granularity=E(t.granularity,q.RADIANS_PER_DEGREE),this._ellipsoid=T.clone(E(t.ellipsoid,T.WGS84)),this._surfaceHeight=Math.max(a,o),this._rotation=E(t.rotation,0),this._stRotation=E(t.stRotation,0),this._vertexFormat=U.clone(E(t.vertexFormat,U.DEFAULT)),this._extrudedHeight=Math.min(a,o),this._shadowVolume=E(t.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=t.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}J.packedLength=y.packedLength+T.packedLength+U.packedLength+7;J.pack=function(t,e,a){return ht.typeOf.object("value",t),ht.defined("array",e),a=E(a,0),y.pack(t._rectangle,e,a),a+=y.packedLength,T.pack(t._ellipsoid,e,a),a+=T.packedLength,U.pack(t._vertexFormat,e,a),a+=U.packedLength,e[a++]=t._granularity,e[a++]=t._surfaceHeight,e[a++]=t._rotation,e[a++]=t._stRotation,e[a++]=t._extrudedHeight,e[a++]=t._shadowVolume?1:0,e[a]=E(t._offsetAttribute,-1),e};var ee=new y,ae=T.clone(T.UNIT_SPHERE),at={rectangle:ee,ellipsoid:ae,vertexFormat:Vt,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};J.unpack=function(t,e,a){ht.defined("array",t),e=E(e,0);var o=y.unpack(t,e,ee);e+=y.packedLength;var n=T.unpack(t,e,ae);e+=T.packedLength;var s=U.unpack(t,e,Vt);e+=U.packedLength;var l=t[e++],c=t[e++],m=t[e++],d=t[e++],r=t[e++],f=t[e++]===1,i=t[e];return tt(a)?(a._rectangle=y.clone(o,a._rectangle),a._ellipsoid=T.clone(n,a._ellipsoid),a._vertexFormat=U.clone(s,a._vertexFormat),a._granularity=l,a._surfaceHeight=c,a._rotation=m,a._stRotation=d,a._extrudedHeight=r,a._shadowVolume=f,a._offsetAttribute=i===-1?void 0:i,a):(at.granularity=l,at.height=c,at.rotation=m,at.stRotation=d,at.extrudedHeight=r,at.shadowVolume=f,at.offsetAttribute=i===-1?void 0:i,new J(at))};J.computeRectangle=function(t,e){t=E(t,E.EMPTY_OBJECT);var a=t.rectangle;if(ht.typeOf.object("rectangle",a),y.validate(a),a.north<a.south)throw new Lt("options.rectangle.north must be greater than or equal to options.rectangle.south");var o=E(t.granularity,q.RADIANS_PER_DEGREE),n=E(t.ellipsoid,T.WGS84),s=E(t.rotation,0);return kt(a,o,s,n,e)};var he=new dt,Wt=new Tt,de=new At;J.createGeometry=function(t){if(!(q.equalsEpsilon(t._rectangle.north,t._rectangle.south,q.EPSILON10)||q.equalsEpsilon(t._rectangle.east,t._rectangle.west,q.EPSILON10))){var e=t._rectangle,a=t._ellipsoid,o=t._rotation,n=t._stRotation,s=t._vertexFormat,l=j.computeOptions(e,t._granularity,o,n,Kt,te,ce),c=he;if(n!==0||o!==0){var m=y.center(e,de),d=a.geodeticSurfaceNormalCartographic(m,Mt);Tt.fromAxisAngle(d,-n,Wt),dt.fromQuaternion(Wt,c)}else dt.clone(dt.IDENTITY,c);var r=t._surfaceHeight,f=t._extrudedHeight,i=!q.equalsEpsilon(r,f,0,q.EPSILON2);l.lonScalar=1/t._rectangle.width,l.latScalar=1/t._rectangle.height,l.tangentRotationMatrix=c;var u,v;if(e=t._rectangle,i){u=le(t,l);var p=ft.fromRectangle3D(e,a,r,ue),A=ft.fromRectangle3D(e,a,f,oe);v=ft.union(p,A)}else{if(u=Gt(t,l),u.attributes.position.values=xt.scaleToGeodeticHeight(u.attributes.position.values,r,a,!1),tt(t._offsetAttribute)){var h=u.attributes.position.values.length,N=new Uint8Array(h/3),L=t._offsetAttribute===mt.NONE?0:1;yt(N,L),u.attributes.applyOffset=new z({componentDatatype:F.UNSIGNED_BYTE,componentsPerAttribute:1,values:N})}v=ft.fromRectangle3D(e,a,r)}return s.position||delete u.attributes.position,new Ht({attributes:u.attributes,indices:u.indices,primitiveType:u.primitiveType,boundingSphere:v,offsetAttribute:t._offsetAttribute})}};J.createShadowVolume=function(t,e,a){var o=t._granularity,n=t._ellipsoid,s=e(o,n),l=a(o,n);return new J({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:n,stRotation:t._stRotation,granularity:o,extrudedHeight:l,height:s,vertexFormat:U.POSITION_ONLY,shadowVolume:!0})};var jt=new y,me=[new et,new et,new et],ge=new St,pe=new At;function _e(t){if(t._stRotation===0)return[0,0,0,1,1,0];var e=y.clone(t._rectangle,jt),a=t._granularity,o=t._ellipsoid,n=t._rotation-t._stRotation,s=kt(e,a,n,o,jt),l=me;l[0].x=s.west,l[0].y=s.south,l[1].x=s.west,l[1].y=s.north,l[2].x=s.east,l[2].y=s.south;for(var c=t.rectangle,m=St.fromRotation(t._stRotation,ge),d=y.center(c,pe),r=0;r<3;++r){var f=l[r];f.x-=d.longitude,f.y-=d.latitude,St.multiplyByVector(m,f,f),f.x+=d.longitude,f.y+=d.latitude,f.x=(f.x-c.west)/c.width,f.y=(f.y-c.south)/c.height}var i=l[0],u=l[1],v=l[2],p=new Array(6);return et.pack(i,p),et.pack(u,p,2),et.pack(v,p,4),p}Object.defineProperties(J.prototype,{rectangle:{get:function(){return tt(this._rotatedRectangle)||(this._rotatedRectangle=kt(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return tt(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=_e(this)),this._textureCoordinateRotationPoints}}});var Ft=J;function be(t,e){return tt(e)&&(t=Ft.unpack(t,e)),t._ellipsoid=T.clone(t._ellipsoid),t._rectangle=y.clone(t._rectangle),Ft.createGeometry(t)}var Ie=be;export{Ie as default};
