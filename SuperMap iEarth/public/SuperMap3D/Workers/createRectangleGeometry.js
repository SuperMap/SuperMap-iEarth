define(["./defaultValue-2110bb17","./Ellipsoid-ca2b8eb1","./Rectangle-52f780a9","./arrayFill-c1a6b724","./buildModuleUrl-36ce0ebc","./Cartesian3-c1138337","./Cartographic-630e5de6","./Check-92c551fb","./ComponentDatatype-3cfb1146","./GeometryAttribute-b12ab6bd","./GeometryAttributes-3cad3ff9","./GeometryInstance-8a74a36b","./GeometryOffsetAttribute-da5a1d35","./GeometryPipeline-7f49beb8","./IndexDatatype-d833345d","./Math-cd1437d9","./FeatureDetection-e7fb956a","./PolygonPipeline-478e7e0d","./PrimitiveType-d9ba7368","./RectangleGeometryLibrary-7ac5a02e","./VertexFormat-295b1d1f","./defer-a21481c0","./Event-589349b0","./RuntimeError-6daf0e01","./WebGLConstants-92042d9e","./Cartesian4-5c264813","./AttributeCompression-79e23de9","./EncodedCartesian3-4c81d2ea","./IntersectionTests-88230423","./Plane-8f19018a","./EllipsoidRhumbLine-89d13f20"],(function(t,e,a,o,n,r,i,s,u,l,c,p,d,g,h,m,f,v,y,b,_,w,A,x,E,D,P,F,R,L,T){"use strict";var C=new r.o,O=new r.o,N=new r.o,I=new r.o,k=new a.h,S=new e.o,z=new n.i,G=new n.i;function M(t,e){var a=new l.I({attributes:new c.a,primitiveType:y._0xa706e5.TRIANGLES});return a.attributes.position=new l.o({componentDatatype:u.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(a.attributes.normal=new l.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(a.attributes.tangent=new l.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(a.attributes.bitangent=new l.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.bitangents})),a}var H=new r.o,V=new r.o;function U(t,e){var a=t._vertexFormat,o=t._ellipsoid,n=e.height,i=e.width,s=e.northCap,c=e.southCap,p=0,d=n,g=n,m=0;s&&(p=1,g-=1,m+=1),c&&(d-=1,g-=1,m+=1),m+=i*g;for(var v=a.position?new Float64Array(3*m):void 0,y=a.st?new Float32Array(2*m):void 0,_=0,w=0,A=C,x=S,E=Number.MAX_VALUE,D=Number.MAX_VALUE,P=-Number.MAX_VALUE,F=-Number.MAX_VALUE,R=p;R<d;++R)for(var L=0;L<i;++L)b.j.computePosition(e,o,a.st,R,L,A,x),v[_++]=A.x,v[_++]=A.y,v[_++]=A.z,a.st&&(y[w++]=x.x,y[w++]=x.y,E=Math.min(E,x.x),D=Math.min(D,x.y),P=Math.max(P,x.x),F=Math.max(F,x.y));if(s&&(b.j.computePosition(e,o,a.st,0,0,A,x),v[_++]=A.x,v[_++]=A.y,v[_++]=A.z,a.st&&(y[w++]=x.x,y[w++]=x.y,E=x.x,D=x.y,P=x.x,F=x.y)),c&&(b.j.computePosition(e,o,a.st,n-1,0,A,x),v[_++]=A.x,v[_++]=A.y,v[_]=A.z,a.st&&(y[w++]=x.x,y[w]=x.y,E=Math.min(E,x.x),D=Math.min(D,x.y),P=Math.max(P,x.x),F=Math.max(F,x.y))),a.st&&(E<0||D<0||P>1||F>1))for(var T=0;T<y.length;T+=2)y[T]=(y[T]-E)/(P-E),y[T+1]=(y[T+1]-D)/(F-D);var k=function(t,e,a,o){var n=t.length,i=e.normal?new Float32Array(n):void 0,s=e.tangent?new Float32Array(n):void 0,u=e.bitangent?new Float32Array(n):void 0,l=0,c=I,p=N,d=O;if(e.normal||e.tangent||e.bitangent)for(var g=0;g<n;g+=3){var h=r.o.fromArray(t,g,C),m=l+1,v=l+2;d=a.geodeticSurfaceNormal(h,d),(e.tangent||e.bitangent)&&(r.o.cross(r.o.UNIT_Z,d,p),f.p.multiplyByVector(o,p,p),r.o.normalize(p,p),e.bitangent&&r.o.normalize(r.o.cross(d,p,c),c)),e.normal&&(i[l]=d.x,i[m]=d.y,i[v]=d.z),e.tangent&&(s[l]=p.x,s[m]=p.y,s[v]=p.z),e.bitangent&&(u[l]=c.x,u[m]=c.y,u[v]=c.z),l+=3}return M(e,{positions:t,normals:i,tangents:s,bitangents:u})}(v,a,o,e.tangentRotationMatrix),z=6*(i-1)*(g-1);s&&(z+=3*(i-1)),c&&(z+=3*(i-1));var G,H=h.IndexDatatype.createTypedArray(m,z),V=0,U=0;for(G=0;G<g-1;++G){for(var j=0;j<i-1;++j){var B=V,q=B+i,Y=q+1,X=B+1;H[U++]=B,H[U++]=q,H[U++]=X,H[U++]=X,H[U++]=q,H[U++]=Y,++V}++V}if(s||c){var W,J,Q=m-1,Z=m-1;if(s&&c&&(Q=m-2),V=0,s)for(G=0;G<i-1;G++)J=(W=V)+1,H[U++]=Q,H[U++]=W,H[U++]=J,++V;if(c)for(V=(g-1)*i,G=0;G<i-1;G++)J=(W=V)+1,H[U++]=W,H[U++]=Z,H[U++]=J,++V}return k.indices=H,a.st&&(k.attributes.st=new l.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:y})),k}function j(t,e,a,o,n){return t[e++]=o[a],t[e++]=o[a+1],t[e++]=o[a+2],t[e++]=n[a],t[e++]=n[a+1],t[e]=n[a+2],t}function B(t,e,a,o){return t[e++]=o[a],t[e++]=o[a+1],t[e++]=o[a],t[e]=o[a+1],t}var q=new _.n;function Y(e,a){var n,i=e._shadowVolume,s=e._offsetAttribute,c=e._vertexFormat,f=e._extrudedHeight,y=e._surfaceHeight,b=e._ellipsoid,w=a.height,A=a.width;if(i){var x=_.n.clone(c,q);x.normal=!0,e._vertexFormat=x}var E=U(e,a);i&&(e._vertexFormat=c);var D=v.A.scaleToGeodeticHeight(E.attributes.position.values,y,b,!1),P=(D=new Float64Array(D)).length,F=2*P,R=new Float64Array(F);R.set(D);var L=v.A.scaleToGeodeticHeight(E.attributes.position.values,f,b);R.set(L,P),E.attributes.position.values=R;var T,k,S=c.normal?new Float32Array(F):void 0,z=c.tangent?new Float32Array(F):void 0,G=c.bitangent?new Float32Array(F):void 0,Y=c.st?new Float32Array(F/3*2):void 0;if(c.normal){for(k=E.attributes.normal.values,S.set(k),n=0;n<P;n++)k[n]=-k[n];S.set(k,P),E.attributes.normal.values=S}if(i){k=E.attributes.normal.values,c.normal||(E.attributes.normal=void 0);var X=new Float32Array(F);for(n=0;n<P;n++)k[n]=-k[n];X.set(k,P),E.attributes.extrudeDirection=new l.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:X})}var W,J=t.e(s);if(J){var Q=P/3*2,Z=new Uint8Array(Q);s===d.z.TOP?Z=o.d(Z,1,0,Q/2):(W=s===d.z.NONE?0:1,Z=o.d(Z,W)),E.attributes.applyOffset=new l.o({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:Z})}if(c.tangent){var K=E.attributes.tangent.values;for(z.set(K),n=0;n<P;n++)K[n]=-K[n];z.set(K,P),E.attributes.tangent.values=z}if(c.bitangent){var $=E.attributes.bitangent.values;G.set($),G.set($,P),E.attributes.bitangent.values=G}c.st&&(T=E.attributes.st.values,Y.set(T),Y.set(T,P/3*2),E.attributes.st.values=Y);var tt=E.indices,et=tt.length,at=P/3,ot=h.IndexDatatype.createTypedArray(F/3,2*et);for(ot.set(tt),n=0;n<et;n+=3)ot[n+et]=tt[n+2]+at,ot[n+1+et]=tt[n+1]+at,ot[n+2+et]=tt[n]+at;E.indices=ot;var nt=a.northCap,rt=a.southCap,it=w,st=2,ut=0,lt=4,ct=4;nt&&(st-=1,it-=1,ut+=1,lt-=2,ct-=1),rt&&(st-=1,it-=1,ut+=1,lt-=2,ct-=1);var pt=2*((ut+=st*A+2*it-lt)+ct),dt=new Float64Array(3*pt),gt=i?new Float32Array(3*pt):void 0,ht=J?new Uint8Array(pt):void 0,mt=c.st?new Float32Array(2*pt):void 0,ft=s===d.z.TOP;J&&!ft&&(W=s===d.z.ALL?1:0,ht=o.d(ht,W));var vt,yt=0,bt=0,_t=0,wt=0,At=A*it;for(n=0;n<At;n+=A)dt=j(dt,yt,vt=3*n,D,L),yt+=6,c.st&&(mt=B(mt,bt,2*n,T),bt+=4),i&&(_t+=3,gt[_t++]=k[vt],gt[_t++]=k[vt+1],gt[_t++]=k[vt+2]),ft&&(ht[wt++]=1,wt+=1);if(rt){var xt=nt?At+1:At;for(vt=3*xt,n=0;n<2;n++)dt=j(dt,yt,vt,D,L),yt+=6,c.st&&(mt=B(mt,bt,2*xt,T),bt+=4),i&&(_t+=3,gt[_t++]=k[vt],gt[_t++]=k[vt+1],gt[_t++]=k[vt+2]),ft&&(ht[wt++]=1,wt+=1)}else for(n=At-A;n<At;n++)dt=j(dt,yt,vt=3*n,D,L),yt+=6,c.st&&(mt=B(mt,bt,2*n,T),bt+=4),i&&(_t+=3,gt[_t++]=k[vt],gt[_t++]=k[vt+1],gt[_t++]=k[vt+2]),ft&&(ht[wt++]=1,wt+=1);for(n=At-1;n>0;n-=A)dt=j(dt,yt,vt=3*n,D,L),yt+=6,c.st&&(mt=B(mt,bt,2*n,T),bt+=4),i&&(_t+=3,gt[_t++]=k[vt],gt[_t++]=k[vt+1],gt[_t++]=k[vt+2]),ft&&(ht[wt++]=1,wt+=1);if(nt){var Et=At;for(vt=3*Et,n=0;n<2;n++)dt=j(dt,yt,vt,D,L),yt+=6,c.st&&(mt=B(mt,bt,2*Et,T),bt+=4),i&&(_t+=3,gt[_t++]=k[vt],gt[_t++]=k[vt+1],gt[_t++]=k[vt+2]),ft&&(ht[wt++]=1,wt+=1)}else for(n=A-1;n>=0;n--)dt=j(dt,yt,vt=3*n,D,L),yt+=6,c.st&&(mt=B(mt,bt,2*n,T),bt+=4),i&&(_t+=3,gt[_t++]=k[vt],gt[_t++]=k[vt+1],gt[_t++]=k[vt+2]),ft&&(ht[wt++]=1,wt+=1);var Dt=function(t,e,a){var o=t.length,n=e.normal?new Float32Array(o):void 0,i=e.tangent?new Float32Array(o):void 0,s=e.bitangent?new Float32Array(o):void 0,u=0,l=0,c=0,p=!0,d=I,g=N,h=O;if(e.normal||e.tangent||e.bitangent)for(var f=0;f<o;f+=6){var v=r.o.fromArray(t,f,C),y=r.o.fromArray(t,(f+6)%o,H);if(p){var b=r.o.fromArray(t,(f+3)%o,V);r.o.subtract(y,v,y),r.o.subtract(b,v,b),h=r.o.normalize(r.o.cross(b,y,h),h),p=!1}r.o.equalsEpsilon(y,v,m.e.EPSILON10)&&(p=!0),(e.tangent||e.bitangent)&&(d=a.geodeticSurfaceNormal(v,d),e.tangent&&(g=r.o.normalize(r.o.cross(d,h,g),g))),e.normal&&(n[u++]=h.x,n[u++]=h.y,n[u++]=h.z,n[u++]=h.x,n[u++]=h.y,n[u++]=h.z),e.tangent&&(i[l++]=g.x,i[l++]=g.y,i[l++]=g.z,i[l++]=g.x,i[l++]=g.y,i[l++]=g.z),e.bitangent&&(s[c++]=d.x,s[c++]=d.y,s[c++]=d.z,s[c++]=d.x,s[c++]=d.y,s[c++]=d.z)}return M(e,{positions:t,normals:n,tangents:i,bitangents:s})}(dt,c,b);c.st&&(Dt.attributes.st=new l.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:mt})),i&&(Dt.attributes.extrudeDirection=new l.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:gt})),J&&(Dt.attributes.applyOffset=new l.o({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:ht}));var Pt,Ft,Rt,Lt,Tt=h.IndexDatatype.createTypedArray(pt,6*ut);P=dt.length/3;var Ct=0;for(n=0;n<P-1;n+=2){Lt=((Pt=n)+2)%P;var Ot=r.o.fromArray(dt,3*Pt,H),Nt=r.o.fromArray(dt,3*Lt,V);r.o.equalsEpsilon(Ot,Nt,m.e.EPSILON10)||(Rt=((Ft=(Pt+1)%P)+2)%P,Tt[Ct++]=Pt,Tt[Ct++]=Ft,Tt[Ct++]=Lt,Tt[Ct++]=Lt,Tt[Ct++]=Ft,Tt[Ct++]=Rt)}return Dt.indices=Tt,(Dt=g.k.combineInstances([new p.d({geometry:E}),new p.d({geometry:Dt})]))[0]}var X=[new r.o,new r.o,new r.o,new r.o],W=new i.a,J=new i.a;function Q(t,e,o,n,r){if(0===o)return a.h.clone(t,r);var i=b.j.computeOptions(t,e,o,0,k,W),s=i.height,u=i.width,l=X;return b.j.computePosition(i,n,!1,0,0,l[0]),b.j.computePosition(i,n,!1,0,u-1,l[1]),b.j.computePosition(i,n,!1,s-1,0,l[2]),b.j.computePosition(i,n,!1,s-1,u-1,l[3]),a.h.fromCartesianArray(l,n,r)}function Z(o){var n=(o=t.u(o,t.u.EMPTY_OBJECT)).rectangle;if(s.o.typeOf.object("rectangle",n),a.h.validate(n),n.north<n.south)throw new s.t("options.rectangle.north must be greater than or equal to options.rectangle.south");var r=t.u(o.height,0),i=t.u(o.extrudedHeight,r);this._rectangle=a.h.clone(n),this._granularity=t.u(o.granularity,m.e.RADIANS_PER_DEGREE),this._ellipsoid=e.t.clone(t.u(o.ellipsoid,e.t.WGS84)),this._surfaceHeight=Math.max(r,i),this._rotation=t.u(o.rotation,0),this._stRotation=t.u(o.stRotation,0),this._vertexFormat=_.n.clone(t.u(o.vertexFormat,_.n.DEFAULT)),this._extrudedHeight=Math.min(r,i),this._shadowVolume=t.u(o.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=o.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}Z.packedLength=a.h.packedLength+e.t.packedLength+_.n.packedLength+7,Z.pack=function(o,n,r){return s.o.typeOf.object("value",o),s.o.defined("array",n),r=t.u(r,0),a.h.pack(o._rectangle,n,r),r+=a.h.packedLength,e.t.pack(o._ellipsoid,n,r),r+=e.t.packedLength,_.n.pack(o._vertexFormat,n,r),r+=_.n.packedLength,n[r++]=o._granularity,n[r++]=o._surfaceHeight,n[r++]=o._rotation,n[r++]=o._stRotation,n[r++]=o._extrudedHeight,n[r++]=o._shadowVolume?1:0,n[r]=t.u(o._offsetAttribute,-1),n};var K=new a.h,$=e.t.clone(e.t.UNIT_SPHERE),tt={rectangle:K,ellipsoid:$,vertexFormat:q,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};Z.unpack=function(o,n,r){s.o.defined("array",o),n=t.u(n,0);var i=a.h.unpack(o,n,K);n+=a.h.packedLength;var u=e.t.unpack(o,n,$);n+=e.t.packedLength;var l=_.n.unpack(o,n,q);n+=_.n.packedLength;var c=o[n++],p=o[n++],d=o[n++],g=o[n++],h=o[n++],m=1===o[n++],f=o[n];return t.e(r)?(r._rectangle=a.h.clone(i,r._rectangle),r._ellipsoid=e.t.clone(u,r._ellipsoid),r._vertexFormat=_.n.clone(l,r._vertexFormat),r._granularity=c,r._surfaceHeight=p,r._rotation=d,r._stRotation=g,r._extrudedHeight=h,r._shadowVolume=m,r._offsetAttribute=-1===f?void 0:f,r):(tt.granularity=c,tt.height=p,tt.rotation=d,tt.stRotation=g,tt.extrudedHeight=h,tt.shadowVolume=m,tt.offsetAttribute=-1===f?void 0:f,new Z(tt))},Z.computeRectangle=function(o,n){var r=(o=t.u(o,t.u.EMPTY_OBJECT)).rectangle;if(s.o.typeOf.object("rectangle",r),a.h.validate(r),r.north<r.south)throw new s.t("options.rectangle.north must be greater than or equal to options.rectangle.south");var i=t.u(o.granularity,m.e.RADIANS_PER_DEGREE),u=t.u(o.ellipsoid,e.t.WGS84);return Q(r,i,t.u(o.rotation,0),u,n)};var et=new f.p,at=new l.n,ot=new i.a;Z.createGeometry=function(e){if(!m.e.equalsEpsilon(e._rectangle.north,e._rectangle.south,m.e.EPSILON10)&&!m.e.equalsEpsilon(e._rectangle.east,e._rectangle.west,m.e.EPSILON10)){var r=e._rectangle,i=e._ellipsoid,s=e._rotation,c=e._stRotation,p=e._vertexFormat,g=b.j.computeOptions(r,e._granularity,s,c,k,W,J),h=et;if(0!==c||0!==s){var y=a.h.center(r,ot),_=i.geodeticSurfaceNormalCartographic(y,H);l.n.fromAxisAngle(_,-c,at),f.p.fromQuaternion(at,h)}else f.p.clone(f.p.IDENTITY,h);var w,A,x=e._surfaceHeight,E=e._extrudedHeight,D=!m.e.equalsEpsilon(x,E,0,m.e.EPSILON2);if(g.lonScalar=1/e._rectangle.width,g.latScalar=1/e._rectangle.height,g.tangentRotationMatrix=h,r=e._rectangle,D){w=Y(e,g);var P=n.i.fromRectangle3D(r,i,x,G),F=n.i.fromRectangle3D(r,i,E,z);A=n.i.union(P,F)}else{if((w=U(e,g)).attributes.position.values=v.A.scaleToGeodeticHeight(w.attributes.position.values,x,i,!1),t.e(e._offsetAttribute)){var R=w.attributes.position.values.length,L=new Uint8Array(R/3),T=e._offsetAttribute===d.z.NONE?0:1;o.d(L,T),w.attributes.applyOffset=new l.o({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:L})}A=n.i.fromRectangle3D(r,i,x)}return p.position||delete w.attributes.position,new l.I({attributes:w.attributes,indices:w.indices,primitiveType:w.primitiveType,boundingSphere:A,offsetAttribute:e._offsetAttribute})}},Z.createShadowVolume=function(t,e,a){var o=t._granularity,n=t._ellipsoid,r=e(o,n),i=a(o,n);return new Z({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:n,stRotation:t._stRotation,granularity:o,extrudedHeight:i,height:r,vertexFormat:_.n.POSITION_ONLY,shadowVolume:!0})};var nt=new a.h,rt=[new e.o,new e.o,new e.o],it=new l.f,st=new i.a;return Object.defineProperties(Z.prototype,{rectangle:{get:function(){return t.e(this._rotatedRectangle)||(this._rotatedRectangle=Q(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return t.e(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){if(0===t._stRotation)return[0,0,0,1,1,0];var o=a.h.clone(t._rectangle,nt),n=t._granularity,r=t._ellipsoid,i=Q(o,n,t._rotation-t._stRotation,r,nt),s=rt;s[0].x=i.west,s[0].y=i.south,s[1].x=i.west,s[1].y=i.north,s[2].x=i.east,s[2].y=i.south;for(var u=t.rectangle,c=l.f.fromRotation(t._stRotation,it),p=a.h.center(u,st),d=0;d<3;++d){var g=s[d];g.x-=p.longitude,g.y-=p.latitude,l.f.multiplyByVector(c,g,g),g.x+=p.longitude,g.y+=p.latitude,g.x=(g.x-u.west)/u.width,g.y=(g.y-u.south)/u.height}var h=s[0],m=s[1],f=s[2],v=new Array(6);return e.o.pack(h,v),e.o.pack(m,v,2),e.o.pack(f,v,4),v}(this)),this._textureCoordinateRotationPoints}}}),function(o,n){return t.e(n)&&(o=Z.unpack(o,n)),o._ellipsoid=e.t.clone(o._ellipsoid),o._rectangle=a.h.clone(o._rectangle),Z.createGeometry(o)}}));
