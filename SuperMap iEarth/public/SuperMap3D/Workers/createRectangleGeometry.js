define(["./when-92c6cf3c","./Cartesian2-b72655a5","./arrayFill-0358accf","./buildModuleUrl-9eef8841","./Cartesian3-3a8bdb0b","./Cartographic-a2c313d7","./Check-52a7d806","./ComponentDatatype-98414d16","./GeometryAttribute-f47bd1cb","./GeometryAttributes-7f66ea53","./GeometryInstance-3190c1b4","./GeometryOffsetAttribute-b4d599f5","./GeometryPipeline-7ffd3f60","./IndexDatatype-86677ec4","./Math-ecf82623","./FeatureDetection-cec0163f","./PolygonPipeline-425528b3","./RectangleGeometryLibrary-4696cd68","./VertexFormat-f496a3f1","./Event-3390cd7d","./RuntimeError-c6a62a80","./WebGLConstants-42651efd","./Cartesian4-72b88c9e","./AttributeCompression-b5a80a71","./EncodedCartesian3-4f120b1b","./IntersectionTests-6e80d61c","./Plane-33393da8","./EllipsoidRhumbLine-b1a766ae"],(function(t,e,a,o,n,r,i,s,u,l,c,p,d,g,h,m,f,v,y,b,_,w,A,x,E,D,F,P){"use strict";var R=new n.o,L=new n.o,C=new n.o,T=new n.o,O=new e.h,N=new e.o,I=new o.i,k=new o.i;function S(t,e){var a=new u.I({attributes:new l.a,primitiveType:m._0x4b6a27.TRIANGLES});return a.attributes.position=new u.o({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(a.attributes.normal=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(a.attributes.tangent=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(a.attributes.bitangent=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.bitangents})),a}var z=new n.o,G=new n.o;function M(t,e){var a=t._vertexFormat,o=t._ellipsoid,r=e.height,i=e.width,l=e.northCap,c=e.southCap,p=0,d=r,h=r,f=0;l&&(p=1,h-=1,f+=1),c&&(d-=1,h-=1,f+=1),f+=i*h;for(var y=a.position?new Float64Array(3*f):void 0,b=a.st?new Float32Array(2*f):void 0,_=0,w=0,A=R,x=N,E=Number.MAX_VALUE,D=Number.MAX_VALUE,F=-Number.MAX_VALUE,P=-Number.MAX_VALUE,O=p;O<d;++O)for(var I=0;I<i;++I)v.j.computePosition(e,o,a.st,O,I,A,x),y[_++]=A.x,y[_++]=A.y,y[_++]=A.z,a.st&&(b[w++]=x.x,b[w++]=x.y,E=Math.min(E,x.x),D=Math.min(D,x.y),F=Math.max(F,x.x),P=Math.max(P,x.y));if(l&&(v.j.computePosition(e,o,a.st,0,0,A,x),y[_++]=A.x,y[_++]=A.y,y[_++]=A.z,a.st&&(b[w++]=x.x,b[w++]=x.y,E=x.x,D=x.y,F=x.x,P=x.y)),c&&(v.j.computePosition(e,o,a.st,r-1,0,A,x),y[_++]=A.x,y[_++]=A.y,y[_]=A.z,a.st&&(b[w++]=x.x,b[w]=x.y,E=Math.min(E,x.x),D=Math.min(D,x.y),F=Math.max(F,x.x),P=Math.max(P,x.y))),a.st&&(E<0||D<0||F>1||P>1))for(var k=0;k<b.length;k+=2)b[k]=(b[k]-E)/(F-E),b[k+1]=(b[k+1]-D)/(P-D);var z=function(t,e,a,o){var r=t.length,i=e.normal?new Float32Array(r):void 0,s=e.tangent?new Float32Array(r):void 0,u=e.bitangent?new Float32Array(r):void 0,l=0,c=T,p=C,d=L;if(e.normal||e.tangent||e.bitangent)for(var g=0;g<r;g+=3){var h=n.o.fromArray(t,g,R),f=l+1,v=l+2;d=a.geodeticSurfaceNormal(h,d),(e.tangent||e.bitangent)&&(n.o.cross(n.o.UNIT_Z,d,p),m.p$1.multiplyByVector(o,p,p),n.o.normalize(p,p),e.bitangent&&n.o.normalize(n.o.cross(d,p,c),c)),e.normal&&(i[l]=d.x,i[f]=d.y,i[v]=d.z),e.tangent&&(s[l]=p.x,s[f]=p.y,s[v]=p.z),e.bitangent&&(u[l]=c.x,u[f]=c.y,u[v]=c.z),l+=3}return S(e,{positions:t,normals:i,tangents:s,bitangents:u})}(y,a,o,e.tangentRotationMatrix),G=6*(i-1)*(h-1);l&&(G+=3*(i-1)),c&&(G+=3*(i-1));var M,H=g.IndexDatatype.createTypedArray(f,G),V=0,U=0;for(M=0;M<h-1;++M){for(var j=0;j<i-1;++j){var B=V,q=B+i,Y=q+1,$=B+1;H[U++]=B,H[U++]=q,H[U++]=$,H[U++]=$,H[U++]=q,H[U++]=Y,++V}++V}if(l||c){var X,W,J=f-1,Q=f-1;if(l&&c&&(J=f-2),V=0,l)for(M=0;M<i-1;M++)W=(X=V)+1,H[U++]=J,H[U++]=X,H[U++]=W,++V;if(c)for(V=(h-1)*i,M=0;M<i-1;M++)W=(X=V)+1,H[U++]=X,H[U++]=Q,H[U++]=W,++V}return z.indices=H,a.st&&(z.attributes.st=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:b})),z}function H(t,e,a,o,n){return t[e++]=o[a],t[e++]=o[a+1],t[e++]=o[a+2],t[e++]=n[a],t[e++]=n[a+1],t[e]=n[a+2],t}function V(t,e,a,o){return t[e++]=o[a],t[e++]=o[a+1],t[e++]=o[a],t[e]=o[a+1],t}var U=new y.n;function j(e,o){var r,i=e._shadowVolume,l=e._offsetAttribute,m=e._vertexFormat,v=e._extrudedHeight,b=e._surfaceHeight,_=e._ellipsoid,w=o.height,A=o.width;if(i){var x=y.n.clone(m,U);x.normal=!0,e._vertexFormat=x}var E=M(e,o);i&&(e._vertexFormat=m);var D=f.A.scaleToGeodeticHeight(E.attributes.position.values,b,_,!1),F=(D=new Float64Array(D)).length,P=2*F,O=new Float64Array(P);O.set(D);var N=f.A.scaleToGeodeticHeight(E.attributes.position.values,v,_);O.set(N,F),E.attributes.position.values=O;var I,k,j=m.normal?new Float32Array(P):void 0,B=m.tangent?new Float32Array(P):void 0,q=m.bitangent?new Float32Array(P):void 0,Y=m.st?new Float32Array(P/3*2):void 0;if(m.normal){for(k=E.attributes.normal.values,j.set(k),r=0;r<F;r++)k[r]=-k[r];j.set(k,F),E.attributes.normal.values=j}if(i){k=E.attributes.normal.values,m.normal||(E.attributes.normal=void 0);var $=new Float32Array(P);for(r=0;r<F;r++)k[r]=-k[r];$.set(k,F),E.attributes.extrudeDirection=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:$})}var X,W=t.e(l);if(W){var J=F/3*2,Q=new Uint8Array(J);l===p.z.TOP?Q=a.d(Q,1,0,J/2):(X=l===p.z.NONE?0:1,Q=a.d(Q,X)),E.attributes.applyOffset=new u.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:Q})}if(m.tangent){var Z=E.attributes.tangent.values;for(B.set(Z),r=0;r<F;r++)Z[r]=-Z[r];B.set(Z,F),E.attributes.tangent.values=B}if(m.bitangent){var K=E.attributes.bitangent.values;q.set(K),q.set(K,F),E.attributes.bitangent.values=q}m.st&&(I=E.attributes.st.values,Y.set(I),Y.set(I,F/3*2),E.attributes.st.values=Y);var tt=E.indices,et=tt.length,at=F/3,ot=g.IndexDatatype.createTypedArray(P/3,2*et);for(ot.set(tt),r=0;r<et;r+=3)ot[r+et]=tt[r+2]+at,ot[r+1+et]=tt[r+1]+at,ot[r+2+et]=tt[r]+at;E.indices=ot;var nt=o.northCap,rt=o.southCap,it=w,st=2,ut=0,lt=4,ct=4;nt&&(st-=1,it-=1,ut+=1,lt-=2,ct-=1),rt&&(st-=1,it-=1,ut+=1,lt-=2,ct-=1);var pt=2*((ut+=st*A+2*it-lt)+ct),dt=new Float64Array(3*pt),gt=i?new Float32Array(3*pt):void 0,ht=W?new Uint8Array(pt):void 0,mt=m.st?new Float32Array(2*pt):void 0,ft=l===p.z.TOP;W&&!ft&&(X=l===p.z.ALL?1:0,ht=a.d(ht,X));var vt,yt=0,bt=0,_t=0,wt=0,At=A*it;for(r=0;r<At;r+=A)dt=H(dt,yt,vt=3*r,D,N),yt+=6,m.st&&(mt=V(mt,bt,2*r,I),bt+=4),i&&(_t+=3,gt[_t++]=k[vt],gt[_t++]=k[vt+1],gt[_t++]=k[vt+2]),ft&&(ht[wt++]=1,wt+=1);if(rt){var xt=nt?At+1:At;for(vt=3*xt,r=0;r<2;r++)dt=H(dt,yt,vt,D,N),yt+=6,m.st&&(mt=V(mt,bt,2*xt,I),bt+=4),i&&(_t+=3,gt[_t++]=k[vt],gt[_t++]=k[vt+1],gt[_t++]=k[vt+2]),ft&&(ht[wt++]=1,wt+=1)}else for(r=At-A;r<At;r++)dt=H(dt,yt,vt=3*r,D,N),yt+=6,m.st&&(mt=V(mt,bt,2*r,I),bt+=4),i&&(_t+=3,gt[_t++]=k[vt],gt[_t++]=k[vt+1],gt[_t++]=k[vt+2]),ft&&(ht[wt++]=1,wt+=1);for(r=At-1;r>0;r-=A)dt=H(dt,yt,vt=3*r,D,N),yt+=6,m.st&&(mt=V(mt,bt,2*r,I),bt+=4),i&&(_t+=3,gt[_t++]=k[vt],gt[_t++]=k[vt+1],gt[_t++]=k[vt+2]),ft&&(ht[wt++]=1,wt+=1);if(nt){var Et=At;for(vt=3*Et,r=0;r<2;r++)dt=H(dt,yt,vt,D,N),yt+=6,m.st&&(mt=V(mt,bt,2*Et,I),bt+=4),i&&(_t+=3,gt[_t++]=k[vt],gt[_t++]=k[vt+1],gt[_t++]=k[vt+2]),ft&&(ht[wt++]=1,wt+=1)}else for(r=A-1;r>=0;r--)dt=H(dt,yt,vt=3*r,D,N),yt+=6,m.st&&(mt=V(mt,bt,2*r,I),bt+=4),i&&(_t+=3,gt[_t++]=k[vt],gt[_t++]=k[vt+1],gt[_t++]=k[vt+2]),ft&&(ht[wt++]=1,wt+=1);var Dt=function(t,e,a){var o=t.length,r=e.normal?new Float32Array(o):void 0,i=e.tangent?new Float32Array(o):void 0,s=e.bitangent?new Float32Array(o):void 0,u=0,l=0,c=0,p=!0,d=T,g=C,m=L;if(e.normal||e.tangent||e.bitangent)for(var f=0;f<o;f+=6){var v=n.o.fromArray(t,f,R),y=n.o.fromArray(t,(f+6)%o,z);if(p){var b=n.o.fromArray(t,(f+3)%o,G);n.o.subtract(y,v,y),n.o.subtract(b,v,b),m=n.o.normalize(n.o.cross(b,y,m),m),p=!1}n.o.equalsEpsilon(y,v,h.e.EPSILON10)&&(p=!0),(e.tangent||e.bitangent)&&(d=a.geodeticSurfaceNormal(v,d),e.tangent&&(g=n.o.normalize(n.o.cross(d,m,g),g))),e.normal&&(r[u++]=m.x,r[u++]=m.y,r[u++]=m.z,r[u++]=m.x,r[u++]=m.y,r[u++]=m.z),e.tangent&&(i[l++]=g.x,i[l++]=g.y,i[l++]=g.z,i[l++]=g.x,i[l++]=g.y,i[l++]=g.z),e.bitangent&&(s[c++]=d.x,s[c++]=d.y,s[c++]=d.z,s[c++]=d.x,s[c++]=d.y,s[c++]=d.z)}return S(e,{positions:t,normals:r,tangents:i,bitangents:s})}(dt,m,_);m.st&&(Dt.attributes.st=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:mt})),i&&(Dt.attributes.extrudeDirection=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:gt})),W&&(Dt.attributes.applyOffset=new u.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:ht}));var Ft,Pt,Rt,Lt,Ct=g.IndexDatatype.createTypedArray(pt,6*ut);F=dt.length/3;var Tt=0;for(r=0;r<F-1;r+=2){Lt=((Ft=r)+2)%F;var Ot=n.o.fromArray(dt,3*Ft,z),Nt=n.o.fromArray(dt,3*Lt,G);n.o.equalsEpsilon(Ot,Nt,h.e.EPSILON10)||(Rt=((Pt=(Ft+1)%F)+2)%F,Ct[Tt++]=Ft,Ct[Tt++]=Pt,Ct[Tt++]=Lt,Ct[Tt++]=Lt,Ct[Tt++]=Pt,Ct[Tt++]=Rt)}return Dt.indices=Ct,(Dt=d.k.combineInstances([new c.d({geometry:E}),new c.d({geometry:Dt})]))[0]}var B=[new n.o,new n.o,new n.o,new n.o],q=new r.a,Y=new r.a;function $(t,a,o,n,r){if(0===o)return e.h.clone(t,r);var i=v.j.computeOptions(t,a,o,0,O,q),s=i.height,u=i.width,l=B;return v.j.computePosition(i,n,!1,0,0,l[0]),v.j.computePosition(i,n,!1,0,u-1,l[1]),v.j.computePosition(i,n,!1,s-1,0,l[2]),v.j.computePosition(i,n,!1,s-1,u-1,l[3]),e.h.fromCartesianArray(l,n,r)}function X(a){var o=(a=t.u(a,t.u.EMPTY_OBJECT)).rectangle;if(i.o.typeOf.object("rectangle",o),e.h.validate(o),o.north<o.south)throw new i.t("options.rectangle.north must be greater than or equal to options.rectangle.south");var n=t.u(a.height,0),r=t.u(a.extrudedHeight,n);this._rectangle=e.h.clone(o),this._granularity=t.u(a.granularity,h.e.RADIANS_PER_DEGREE),this._ellipsoid=e.t.clone(t.u(a.ellipsoid,e.t.WGS84)),this._surfaceHeight=Math.max(n,r),this._rotation=t.u(a.rotation,0),this._stRotation=t.u(a.stRotation,0),this._vertexFormat=y.n.clone(t.u(a.vertexFormat,y.n.DEFAULT)),this._extrudedHeight=Math.min(n,r),this._shadowVolume=t.u(a.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=a.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}X.packedLength=e.h.packedLength+e.t.packedLength+y.n.packedLength+7,X.pack=function(a,o,n){return i.o.typeOf.object("value",a),i.o.defined("array",o),n=t.u(n,0),e.h.pack(a._rectangle,o,n),n+=e.h.packedLength,e.t.pack(a._ellipsoid,o,n),n+=e.t.packedLength,y.n.pack(a._vertexFormat,o,n),n+=y.n.packedLength,o[n++]=a._granularity,o[n++]=a._surfaceHeight,o[n++]=a._rotation,o[n++]=a._stRotation,o[n++]=a._extrudedHeight,o[n++]=a._shadowVolume?1:0,o[n]=t.u(a._offsetAttribute,-1),o};var W=new e.h,J=e.t.clone(e.t.UNIT_SPHERE),Q={rectangle:W,ellipsoid:J,vertexFormat:U,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};X.unpack=function(a,o,n){i.o.defined("array",a),o=t.u(o,0);var r=e.h.unpack(a,o,W);o+=e.h.packedLength;var s=e.t.unpack(a,o,J);o+=e.t.packedLength;var u=y.n.unpack(a,o,U);o+=y.n.packedLength;var l=a[o++],c=a[o++],p=a[o++],d=a[o++],g=a[o++],h=1===a[o++],m=a[o];return t.e(n)?(n._rectangle=e.h.clone(r,n._rectangle),n._ellipsoid=e.t.clone(s,n._ellipsoid),n._vertexFormat=y.n.clone(u,n._vertexFormat),n._granularity=l,n._surfaceHeight=c,n._rotation=p,n._stRotation=d,n._extrudedHeight=g,n._shadowVolume=h,n._offsetAttribute=-1===m?void 0:m,n):(Q.granularity=l,Q.height=c,Q.rotation=p,Q.stRotation=d,Q.extrudedHeight=g,Q.shadowVolume=h,Q.offsetAttribute=-1===m?void 0:m,new X(Q))},X.computeRectangle=function(a,o){var n=(a=t.u(a,t.u.EMPTY_OBJECT)).rectangle;if(i.o.typeOf.object("rectangle",n),e.h.validate(n),n.north<n.south)throw new i.t("options.rectangle.north must be greater than or equal to options.rectangle.south");var r=t.u(a.granularity,h.e.RADIANS_PER_DEGREE),s=t.u(a.ellipsoid,e.t.WGS84);return $(n,r,t.u(a.rotation,0),s,o)};var Z=new m.p$1,K=new u.n,tt=new r.a;X.createGeometry=function(n){if(!h.e.equalsEpsilon(n._rectangle.north,n._rectangle.south,h.e.EPSILON10)&&!h.e.equalsEpsilon(n._rectangle.east,n._rectangle.west,h.e.EPSILON10)){var r=n._rectangle,i=n._ellipsoid,l=n._rotation,c=n._stRotation,d=n._vertexFormat,g=v.j.computeOptions(r,n._granularity,l,c,O,q,Y),y=Z;if(0!==c||0!==l){var b=e.h.center(r,tt),_=i.geodeticSurfaceNormalCartographic(b,z);u.n.fromAxisAngle(_,-c,K),m.p$1.fromQuaternion(K,y)}else m.p$1.clone(m.p$1.IDENTITY,y);var w,A,x=n._surfaceHeight,E=n._extrudedHeight,D=!h.e.equalsEpsilon(x,E,0,h.e.EPSILON2);if(g.lonScalar=1/n._rectangle.width,g.latScalar=1/n._rectangle.height,g.tangentRotationMatrix=y,r=n._rectangle,D){w=j(n,g);var F=o.i.fromRectangle3D(r,i,x,k),P=o.i.fromRectangle3D(r,i,E,I);A=o.i.union(F,P)}else{if((w=M(n,g)).attributes.position.values=f.A.scaleToGeodeticHeight(w.attributes.position.values,x,i,!1),t.e(n._offsetAttribute)){var R=w.attributes.position.values.length,L=new Uint8Array(R/3),C=n._offsetAttribute===p.z.NONE?0:1;a.d(L,C),w.attributes.applyOffset=new u.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:L})}A=o.i.fromRectangle3D(r,i,x)}return d.position||delete w.attributes.position,new u.I({attributes:w.attributes,indices:w.indices,primitiveType:w.primitiveType,boundingSphere:A,offsetAttribute:n._offsetAttribute})}},X.createShadowVolume=function(t,e,a){var o=t._granularity,n=t._ellipsoid,r=e(o,n),i=a(o,n);return new X({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:n,stRotation:t._stRotation,granularity:o,extrudedHeight:i,height:r,vertexFormat:y.n.POSITION_ONLY,shadowVolume:!0})};var et=new e.h,at=[new e.o,new e.o,new e.o],ot=new u.f,nt=new r.a;return Object.defineProperties(X.prototype,{rectangle:{get:function(){return t.e(this._rotatedRectangle)||(this._rotatedRectangle=$(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return t.e(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){if(0===t._stRotation)return[0,0,0,1,1,0];var a=e.h.clone(t._rectangle,et),o=t._granularity,n=t._ellipsoid,r=$(a,o,t._rotation-t._stRotation,n,et),i=at;i[0].x=r.west,i[0].y=r.south,i[1].x=r.west,i[1].y=r.north,i[2].x=r.east,i[2].y=r.south;for(var s=t.rectangle,l=u.f.fromRotation(t._stRotation,ot),c=e.h.center(s,nt),p=0;p<3;++p){var d=i[p];d.x-=c.longitude,d.y-=c.latitude,u.f.multiplyByVector(l,d,d),d.x+=c.longitude,d.y+=c.latitude,d.x=(d.x-s.west)/s.width,d.y=(d.y-s.south)/s.height}var g=i[0],h=i[1],m=i[2],f=new Array(6);return e.o.pack(g,f),e.o.pack(h,f,2),e.o.pack(m,f,4),f}(this)),this._textureCoordinateRotationPoints}}}),function(a,o){return t.e(o)&&(a=X.unpack(a,o)),a._ellipsoid=e.t.clone(a._ellipsoid),a._rectangle=e.h.clone(a._rectangle),X.createGeometry(a)}}));
