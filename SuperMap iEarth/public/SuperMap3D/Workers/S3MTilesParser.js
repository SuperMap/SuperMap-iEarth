define(["./createTaskProcessorWorker","./ComponentDatatype-3cfb1146","./Color-75231487","./getStringFromTypedArray-1f235117","./S3MEdgeProcessor-6837ee3b","./Cartesian3-c1138337","./Cartographic-630e5de6","./PrimitiveType-d9ba7368","./S3MPixelFormat-6885e30a","./pako_inflate-e5e032ee","./defaultValue-2110bb17","./Check-92c551fb","./WebGLConstants-92042d9e","./FeatureDetection-e7fb956a","./Math-cd1437d9","./defer-a21481c0","./RuntimeError-6daf0e01","./IndexDatatype-d833345d","./Cartesian4-5c264813"],(function(t,e,r,n,a,i,o,E,s,y,p,u,T,l,v,d,A,_,c){"use strict";function f(t,e,r,n,a,i){this.left=t,this.bottom=e,this.right=r,this.top=n,this.minHeight=a,this.maxHeight=i,this.width=r-t,this.length=n-e,this.height=i-a}function m(t,r,n,s,y,p,u,T){var l=p.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var v=0,d={},A=d.vertexAttributes=[],_=d.attrLocation={};d.instanceCount=0,d.instanceMode=0;var c=0;p.getUint32(u,!0),u+=Uint32Array.BYTES_PER_ELEMENT;var f=p.getUint16(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var m=f;f>4&&(m=f>>8,f&=15);var B=p.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var g=void 0,P=void 0;if(B>0){var U=p.getUint16(u,!0);U=f*Float32Array.BYTES_PER_ELEMENT,u+=Uint32Array.BYTES_PER_ELEMENT,v=B*U;var L=y.subarray(u,u+v);if(s||n){var h=new i.o,M=new i.o,S=new Float32Array(L.buffer,L.byteOffset,L.byteLength/4),N=new o.a;g=new o.a,P=new o.a;for(var R=new Float32Array(2*B),D=new Float64Array(2*B),Y=0;Y<B;Y++)E.y.multiplyByPoint(r,i.o.fromElements(S[4*Y],S[4*Y+1],S[4*Y+2],h),M),N=o.a.fromCartesian(M),D[2*Y]=N.longitude,D[2*Y+1]=N.latitude,0===Y?(g.longitude=N.longitude,g.latitude=N.latitude,P.longitude=N.longitude,P.latitude=N.latitude):(g.longitude=Math.max(N.longitude,g.longitude),g.latitude=Math.max(N.latitude,g.latitude),P.longitude=Math.min(N.longitude,P.longitude),P.latitude=Math.min(N.latitude,P.latitude));var b=n?g.longitude-P.longitude:1,I=n?g.latitude-P.latitude:1;for(Y=0;Y<B;Y++)R[2*Y]=(D[2*Y]-P.longitude)/b,R[2*Y+1]=(D[2*Y+1]-P.latitude)/I;_.aRelativeGeoCoord=c,A.push({index:_.aRelativeGeoCoord,typedArray:R,componentsPerAttribute:2,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:2*Float32Array.BYTES_PER_ELEMENT,normalize:!1}),c++}_.aPosition=c,A.push({index:_.aPosition,typedArray:L,componentsPerAttribute:f,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:U,normalize:!1}),c++,u+=v}var x=p.getUint32(u,!0);if(u+=Uint32Array.BYTES_PER_ELEMENT,x>0){var F=p.getUint16(u,!0);F=m*Float32Array.BYTES_PER_ELEMENT,u+=Uint32Array.BYTES_PER_ELEMENT,v=x*F;let r=new Float32Array(y.buffer,u,3),n=0===r[0]&&0===r[1]&&0===r[2];t.ignoreNormal||n||(_.aNormal=c,A.push({index:_.aNormal,typedArray:y.subarray(u,u+v),componentsPerAttribute:m,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:F,normalize:!1}),c++),u+=v}var C=p.getUint32(u,!0);if(u+=Uint32Array.BYTES_PER_ELEMENT,C>0){var w=new Uint8Array(4*C);T.push(w.buffer);var O=p.getUint32(u,!0);O=4*Float32Array.BYTES_PER_ELEMENT,u+=Uint32Array.BYTES_PER_ELEMENT,v=C*O;for(var k=new Float32Array(y.buffer,u,4*B),z=0;z<B;z++)w[4*z]=255*k[4*z],w[4*z+1]=255*k[4*z+1],w[4*z+2]=255*k[4*z+2],w[4*z+3]=255*k[4*z+3];u+=v,_.aColor=c,A.push({index:_.aColor,typedArray:w,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.UNSIGNED_BYTE,offsetInBytes:0,strideInBytes:4,normalize:!0}),c++}var G=p.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT,G>0&&(u+=v=16*G);var H=p.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;for(var V,W,X=-1,j=0;j<H;j++){V=p.getUint32(u,!0),u+=Uint32Array.BYTES_PER_ELEMENT,W=p.getUint16(u,!0),u+=Uint16Array.BYTES_PER_ELEMENT,p.getUint16(u,!0),u+=Uint16Array.BYTES_PER_ELEMENT,v=V*W*Float32Array.BYTES_PER_ELEMENT;var q,J=y.subarray(u,u+v);if(-1!=X||20!=W&&35!=W)if(-1!==X)d.instanceBounds=new Float32Array(y.buffer,u,V*W);else{var K="aTexCoord"+j;_[K]=c++,A.push({index:_[K],typedArray:J,componentsPerAttribute:W,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:W*Float32Array.BYTES_PER_ELEMENT,normalize:!1})}else X=j,d.instanceCount=V,d.instanceMode=W,d.instanceBuffer=J,20===W?(q=20*Float32Array.BYTES_PER_ELEMENT,_.uv2=c++,A.push({index:_.uv2,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:q,instanceDivisor:1}),_.uv3=c++,A.push({index:_.uv3,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),_.uv4=c++,A.push({index:_.uv4,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),_.secondary_colour=c++,A.push({index:_.secondary_colour,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),_.uv6=c++,A.push({index:_.uv6,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1})):35===W&&(q=35*Float32Array.BYTES_PER_ELEMENT,_.uv1=c++,A.push({index:_.uv1,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:q,instanceDivisor:1,byteLength:v}),_.uv2=c++,A.push({index:_.uv2,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),_.uv3=c++,A.push({index:_.uv3,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),_.uv4=c++,A.push({index:_.uv4,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),_.uv5=c++,A.push({index:_.uv5,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),_.uv6=c++,A.push({index:_.uv6,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:20*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),_.uv7=c++,A.push({index:_.uv7,componentsPerAttribute:3,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:24*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),_.secondary_colour=c++,A.push({index:_.secondary_colour,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:27*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),_.uv9=c++,A.push({index:_.uv9,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:31*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}));u+=v}d.verticesCount=B,d.instanceIndex=X;var Q=p.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var Z,$=[];for(j=0;j<Q;j++){var tt={},et=p.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var rt=p.getUint8(u,!0);u+=Uint8Array.BYTES_PER_ELEMENT,p.getUint8(u,!0),u+=Uint8Array.BYTES_PER_ELEMENT;var nt=p.getUint8(u,!0);u+=Uint8Array.BYTES_PER_ELEMENT,u+=1,tt.indicesCount=et,tt.indexType=rt,tt.primitiveType=nt;var at=u;et>0&&(0==rt?(u+=v=et*Uint16Array.BYTES_PER_ELEMENT,et%2==1&&(u+=2)):u+=v=4*et),tt.indicesTypedArray=y.subarray(at,at+v);var it=p.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;var ot=p.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT*it,tt.materialCode=ot,$.push(tt)}let Et;return 2===$.length&&13===$[1].primitiveType&&$[1].indicesCount>=3&&(Z=a._0x581ba9.createEdgeDataByIndices(d,$[1],T)),void 0!==g&&void 0!==P&&(Et={max:g,min:P}),t[l]={vertexPackage:d,arrIndexPackage:$,edgeGeometry:Z,cartographicBounds:Et},u}function B(t,r,n){var a=t.vertexAttributes,i=t.attrLocation,o=a.length;i[1===n?"instanceId":"batchId"]=o,a.push({index:o,typedArray:r,componentsPerAttribute:1,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:0,instanceDivisor:n})}return new r.e,t((function(t,e){var r=t.buffer,i=t.supportCompressType,o=t.bVolume,E=null,u=null,T=null,l=t.isCoverImageryLayer,v=t.coveredMap,d=t.modelMatrix;if(o&&t.volbuffer.byteLength<8&&(o=!1),o){var A=t.volbuffer,_=new Uint8Array(A,8),c=y.pako.inflate(_).buffer,g=new Float64Array(c,0,1),P=new Uint32Array(c,48,1);if(0===g[0]||3200===P[0]||3201===P[0]){var U=0;0===g[0]&&(U=8),e.push(c);var L=new Float64Array(c,U,6),h=L[0],M=L[1],S=L[2],N=L[3],R=L[4]<L[5]?L[4]:L[5],D=L[4]>L[5]?L[4]:L[5];u={left:h,top:M,right:S,bottom:N,minHeight:R,maxHeight:D,width:(E=new f(h,N,S,M,R,D)).width,length:E.length,height:E.height};var Y=new Uint32Array(c,48+U,7),b=Y[0],I=Y[1],x=Y[2],F=Y[3];T={nFormat:b,nSideBlockCount:I,nBlockLength:x,nLength:F,nWidth:Y[4],nHeight:Y[5],nDepth:Y[6],imageArray:new Uint8Array(c,76+U,F*F*4)}}}var C=0,w=new Uint8Array(r,0,4);if(115!==w[0]||51!==w[1]||109!==w[2])return{result:!1};var O=w[3],k=(_=new Uint8Array(r,4),y.pako.inflate(_).buffer),z=new Uint8Array(k);e.push(z.buffer);var G=new DataView(k),H=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var V=new Uint8Array(k,C,H),W=H%4;W&&(W=4-W),C+=H+W;var X=n.a(V,void 0,void 0,"gbk");X=(X=X.replace(new RegExp("\r\n","gm"),"")).replace(new RegExp(":","gm"),""),G.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT;var j=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var q={};q.ignoreNormal=t.ignoreNormal;for(var J=0;J<j;J++)C=m(q,d,v,l,z,G,C,e);G.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT;var K=G.getUint32(C,!0);for(C+=Uint32Array.BYTES_PER_ELEMENT,J=0;J<K;J++){var Q=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var Z=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var $={},tt=q[Q].vertexPackage.instanceIndex,et=q[Q].edgeGeometry;if(-1==tt){for(var rt=new Float32Array(q[Q].vertexPackage.verticesCount),nt=0;nt<Z;nt++){var at=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var it=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var ot=0,Et=0;$[at]={batchId:nt};for(var st=0;st<it;st++)if(Et=G.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT,ot=G.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT,rt.fill)rt.fill(nt,Et,Et+ot);else for(var yt=Et+Et,pt=Et;pt<yt;pt++)rt[pt]=nt;$[at].vertexColorOffset=Et,$[at].vertexColorCount=ot}B(q[Q].vertexPackage,rt,void 0)}else{var ut=q[Q].vertexPackage.instanceCount;q[Q].vertexPackage.instanceBuffer,q[Q].vertexPackage.instanceMode;var Tt=new Float32Array(ut),lt=0;for(nt=0;nt<Z;nt++){at=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;it=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;for(st=0;st<it;st++){var vt=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT,Tt[lt]=lt,void 0===$[at]&&($[at]={vertexColorCount:1,instanceIds:[],vertexColorOffset:lt}),$[at].instanceIds.push(vt),lt++}}B(q[Q].vertexPackage,Tt,1)}q[Q].pickInfo=$;et=q[Q].edgeGeometry;if(p.e(et)){var dt,At,_t=et.regular.instancesData,ct=a._0x581ba9.RegularInstanceStride;if(p.e(_t))for(At=_t.length,dt=0;dt<At;dt+=ct){var ft=_t[dt+9];_t[dt+9]=rt[ft]}var mt=et.silhouette.instancesData;if(ct=a._0x581ba9.SilhouetteInstanceStride,p.e(mt))for(At=mt.length,dt=0;dt<At;dt+=ct){ft=mt[dt+12];mt[dt+12]=rt[ft]}}}G.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT;var Bt=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var gt={};for(J=0;J<Bt;J++){var Pt=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var Ut=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var Lt=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var ht=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;it=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var Mt=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var St=null;if(ht===a.S3MCompressType.enrS3TCDXTN&&1!==i){var Nt=null;Mt>s.S3MPixelFormat.BGR||Mt===s.S3MPixelFormat.LUMINANCE_ALPHA?(Nt=new Uint8Array(k,C,Ut*Lt),St=new Uint8Array(Ut*Lt*4)):(Nt=new Uint16Array(k,C,it/2),St=new Uint16Array(Ut*Lt)),a.L.decode(St,Ut,Lt,Nt,Mt),e.push(St.buffer),ht=0}else St=new Uint8Array(k,C,it);gt[Pt]={id:Pt,width:Ut,height:Lt,compressType:ht,nFormat:Mt,imageBuffer:St},C+=it}return{result:!0,version:O,xmlDoc:X,geoPackage:q,texturePackage:gt,volImageBuffer:T,volBounds:u}}))}));
