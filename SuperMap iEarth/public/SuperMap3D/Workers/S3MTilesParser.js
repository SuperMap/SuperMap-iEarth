define(["./createTaskProcessorWorker","./ComponentDatatype-98414d16","./Color-a181fc03","./getStringFromTypedArray-1e6dda18","./S3MEdgeProcessor-3a6c872b","./Cartesian3-3a8bdb0b","./Cartographic-a2c313d7","./FeatureDetection-6dd694bf","./S3MPixelFormat-e8b26b19","./pako_inflate-f73548c4","./when-92c6cf3c","./Check-52a7d806","./WebGLConstants-42651efd","./Math-ecf82623","./RuntimeError-c6a62a80","./IndexDatatype-86677ec4","./Cartesian4-72b88c9e"],(function(t,e,n,r,a,i,o,E,s,y,p,T,u,l,A,v,_){"use strict";function c(t,e,n,r,a,i){this.left=t,this.bottom=e,this.right=n,this.top=r,this.minHeight=a,this.maxHeight=i,this.width=n-t,this.length=r-e,this.height=i-a}function d(t,n,r,s,y,p,T){var u=y.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var l=0,A={},v=A.vertexAttributes=[],_=A.attrLocation={};A.instanceCount=0,A.instanceMode=0;var c=0;y.getUint32(p,!0),p+=Uint32Array.BYTES_PER_ELEMENT;var d=y.getUint16(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var f=d;d>4&&(f=d>>8,d&=15);var m=y.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var B=void 0,g=void 0;if(m>0){var P=y.getUint16(p,!0);P=d*Float32Array.BYTES_PER_ELEMENT,p+=Uint32Array.BYTES_PER_ELEMENT,l=m*P;var U=s.subarray(p,p+l);if(r){var L=new i.o,h=new i.o,M=new Float32Array(U.buffer,U.byteOffset,U.byteLength/4),S=new o.a;B=new o.a,g=new o.a;for(var N=new Float32Array(2*m),R=new Float64Array(2*m),D=0;D<m;D++)E.p.multiplyByPoint(n,i.o.fromElements(M[3*D],M[3*D+1],M[3*D+2],L),h),S=o.a.fromCartesian(h),R[2*D]=S.longitude,R[2*D+1]=S.latitude,0===D?(B.longitude=S.longitude,B.latitude=S.latitude,g.longitude=S.longitude,g.latitude=S.latitude):(B.longitude=Math.max(S.longitude,B.longitude),B.latitude=Math.max(S.latitude,B.latitude),g.longitude=Math.min(S.longitude,g.longitude),g.latitude=Math.min(S.latitude,g.latitude));for(D=0;D<m;D++)N[2*D]=R[2*D]-g.longitude,N[2*D+1]=R[2*D+1]-g.latitude;_.img=c,v.push({index:_.img,typedArray:N,componentsPerAttribute:2,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:2*Float32Array.BYTES_PER_ELEMENT,normalize:!1}),c++}_.aPosition=c,v.push({index:_.aPosition,typedArray:U,componentsPerAttribute:d,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:P,normalize:!1}),c++,p+=l}var Y=y.getUint32(p,!0);if(p+=Uint32Array.BYTES_PER_ELEMENT,Y>0){var I=y.getUint16(p,!0);I=f*Float32Array.BYTES_PER_ELEMENT,p+=Uint32Array.BYTES_PER_ELEMENT,l=Y*I,t.ignoreNormal||(_.aNormal=c,v.push({index:_.aNormal,typedArray:s.subarray(p,p+l),componentsPerAttribute:f,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:I,normalize:!1}),c++),p+=l}var b=y.getUint32(p,!0);if(p+=Uint32Array.BYTES_PER_ELEMENT,b>0){var x=new Uint8Array(4*b);T.push(x.buffer);var F=y.getUint32(p,!0);F=4*Float32Array.BYTES_PER_ELEMENT,p+=Uint32Array.BYTES_PER_ELEMENT,l=b*F;for(var C=new Float32Array(s.buffer,p,4*m),w=0;w<m;w++)x[4*w]=255*C[4*w],x[4*w+1]=255*C[4*w+1],x[4*w+2]=255*C[4*w+2],x[4*w+3]=255*C[4*w+3];p+=l,_.aColor=c,v.push({index:_.aColor,typedArray:x,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.UNSIGNED_BYTE,offsetInBytes:0,strideInBytes:4,normalize:!0}),c++}var O=y.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT,O>0&&(p+=l=16*O);var k=y.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;for(var z,G,H=-1,W=0;W<k;W++){z=y.getUint32(p,!0),p+=Uint32Array.BYTES_PER_ELEMENT,G=y.getUint16(p,!0),p+=Uint16Array.BYTES_PER_ELEMENT,y.getUint16(p,!0),p+=Uint16Array.BYTES_PER_ELEMENT,l=z*G*Float32Array.BYTES_PER_ELEMENT;var V,X=s.subarray(p,p+l);if(-1!=H||20!=G&&35!=G)if(-1!==H)A.instanceBounds=new Float32Array(s.buffer,p,z*G);else{var j="aTexCoord"+W;_[j]=c++,v.push({index:_[j],typedArray:X,componentsPerAttribute:G,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:G*Float32Array.BYTES_PER_ELEMENT,normalize:!1})}else H=W,A.instanceCount=z,A.instanceMode=G,A.instanceBuffer=X,20===G?(V=20*Float32Array.BYTES_PER_ELEMENT,_.uv2=c++,v.push({index:_.uv2,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:V,instanceDivisor:1}),_.uv3=c++,v.push({index:_.uv3,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:V,instanceDivisor:1}),_.uv4=c++,v.push({index:_.uv4,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:V,instanceDivisor:1}),_.secondary_colour=c++,v.push({index:_.secondary_colour,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:V,instanceDivisor:1}),_.uv6=c++,v.push({index:_.uv6,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:V,instanceDivisor:1})):35===G&&(V=35*Float32Array.BYTES_PER_ELEMENT,_.uv1=c++,v.push({index:_.uv1,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:V,instanceDivisor:1,byteLength:l}),_.uv2=c++,v.push({index:_.uv2,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:V,instanceDivisor:1}),_.uv3=c++,v.push({index:_.uv3,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:V,instanceDivisor:1}),_.uv4=c++,v.push({index:_.uv4,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:V,instanceDivisor:1}),_.uv5=c++,v.push({index:_.uv5,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:V,instanceDivisor:1}),_.uv6=c++,v.push({index:_.uv6,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:20*Float32Array.BYTES_PER_ELEMENT,strideInBytes:V,instanceDivisor:1}),_.uv7=c++,v.push({index:_.uv7,componentsPerAttribute:3,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:24*Float32Array.BYTES_PER_ELEMENT,strideInBytes:V,instanceDivisor:1}),_.secondary_colour=c++,v.push({index:_.secondary_colour,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:27*Float32Array.BYTES_PER_ELEMENT,strideInBytes:V,instanceDivisor:1}),_.uv9=c++,v.push({index:_.uv9,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:31*Float32Array.BYTES_PER_ELEMENT,strideInBytes:V,instanceDivisor:1}));p+=l}A.verticesCount=m,A.instanceIndex=H;var q=y.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var J,K=[];for(W=0;W<q;W++){var Q={},Z=y.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var $=y.getUint8(p,!0);p+=Uint8Array.BYTES_PER_ELEMENT,y.getUint8(p,!0),p+=Uint8Array.BYTES_PER_ELEMENT;var tt=y.getUint8(p,!0);p+=Uint8Array.BYTES_PER_ELEMENT,p+=1,Q.indicesCount=Z,Q.indexType=$,Q.primitiveType=tt;var et=p;Z>0&&(0==$?(p+=l=Z*Uint16Array.BYTES_PER_ELEMENT,Z%2==1&&(p+=2)):p+=l=4*Z),Q.indicesTypedArray=s.subarray(et,et+l);var nt=y.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var rt=y.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT*nt,Q.materialCode=rt,K.push(Q)}return 2===K.length&&13===K[1].primitiveType&&K[1].indicesCount>=3&&(J=a._0x3a833e.createEdgeDataByIndices(A,K[1],T)),t[u]={vertexPackage:A,arrIndexPackage:K,edgeGeometry:J,cartographicBounds:{max:B,min:g}},p}function f(t,n,r){var a=t.vertexAttributes,i=t.attrLocation,o=a.length;i[1===r?"instanceId":"batchId"]=o,a.push({index:o,typedArray:n,componentsPerAttribute:1,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:0,instanceDivisor:r})}return new n.e,t((function(t,e){var n=t.buffer,i=t.supportCompressType,o=t.bVolume,E=null,T=null,u=null,l=t.isCoverImageryLayer,A=t.modelMatrix;if(o&&t.volbuffer.byteLength<8&&(o=!1),o){var v=t.volbuffer,_=new Uint8Array(v,8),m=y.pako.inflate(_).buffer,B=new Float64Array(m,0,1),g=new Uint32Array(m,48,1);if(0===B[0]||3200===g[0]||3201===g[0]){var P=0;0===B[0]&&(P=8),e.push(m);var U=new Float64Array(m,P,6),L=U[0],h=U[1],M=U[2],S=U[3],N=U[4]<U[5]?U[4]:U[5],R=U[4]>U[5]?U[4]:U[5];T={left:L,top:h,right:M,bottom:S,minHeight:N,maxHeight:R,width:(E=new c(L,S,M,h,N,R)).width,length:E.length,height:E.height};var D=new Uint32Array(m,48+P,7),Y=D[0],I=D[1],b=D[2],x=D[3];u={nFormat:Y,nSideBlockCount:I,nBlockLength:b,nLength:x,nWidth:D[4],nHeight:D[5],nDepth:D[6],imageArray:new Uint8Array(m,76+P,x*x*4)}}}var F=0,C=new Uint8Array(n,0,4);if(115!==C[0]||51!==C[1]||109!==C[2])return{result:!1};var w=C[3],O=(_=new Uint8Array(n,4),y.pako.inflate(_).buffer),k=new Uint8Array(O);e.push(k.buffer);var z=new DataView(O),G=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;var H=new Uint8Array(O,F,G),W=G%4;W&&(W=4-W),F+=G+W;var V=r.a(H,void 0,void 0,"gbk");V=(V=V.replace(new RegExp("\r\n","gm"),"")).replace(new RegExp(":","gm"),""),z.getUint32(F,!0),F+=Uint32Array.BYTES_PER_ELEMENT;var X=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;var j={};j.ignoreNormal=t.ignoreNormal;for(var q=0;q<X;q++)F=d(j,A,l,k,z,F,e);z.getUint32(F,!0),F+=Uint32Array.BYTES_PER_ELEMENT;var J=z.getUint32(F,!0);for(F+=Uint32Array.BYTES_PER_ELEMENT,q=0;q<J;q++){var K=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;var Q=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;var Z={},$=j[K].vertexPackage.instanceIndex,tt=j[K].edgeGeometry;if(-1==$){for(var et=new Float32Array(j[K].vertexPackage.verticesCount),nt=0;nt<Q;nt++){var rt=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;var at=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;var it=0,ot=0;Z[rt]={batchId:nt};for(var Et=0;Et<at;Et++)if(ot=z.getUint32(F,!0),F+=Uint32Array.BYTES_PER_ELEMENT,it=z.getUint32(F,!0),F+=Uint32Array.BYTES_PER_ELEMENT,et.fill)et.fill(nt,ot,ot+it);else for(var st=ot+ot,yt=ot;yt<st;yt++)et[yt]=nt;Z[rt].vertexColorOffset=ot,Z[rt].vertexColorCount=it}f(j[K].vertexPackage,et,void 0)}else{var pt=j[K].vertexPackage.instanceCount;j[K].vertexPackage.instanceBuffer,j[K].vertexPackage.instanceMode;var Tt=new Float32Array(pt),ut=0;for(nt=0;nt<Q;nt++){rt=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;at=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;for(Et=0;Et<at;Et++){var lt=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT,Tt[ut]=ut,void 0===Z[rt]&&(Z[rt]={vertexColorCount:1,instanceIds:[],vertexColorOffset:ut}),Z[rt].instanceIds.push(lt),ut++}}f(j[K].vertexPackage,Tt,1)}j[K].pickInfo=Z;tt=j[K].edgeGeometry;if(p.e(tt)){var At,vt,_t=tt.regular.instancesData,ct=a._0x3a833e.RegularInstanceStride;if(p.e(_t))for(vt=_t.length,At=0;At<vt;At+=ct){var dt=_t[At+9];_t[At+9]=et[dt]}var ft=tt.silhouette.instancesData;if(ct=a._0x3a833e.SilhouetteInstanceStride,p.e(ft))for(vt=ft.length,At=0;At<vt;At+=ct){dt=ft[At+12];ft[At+12]=et[dt]}}}z.getUint32(F,!0),F+=Uint32Array.BYTES_PER_ELEMENT;var mt=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;var Bt={};for(q=0;q<mt;q++){var gt=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;var Pt=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;var Ut=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;var Lt=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;at=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;var ht=z.getUint32(F,!0);F+=Uint32Array.BYTES_PER_ELEMENT;var Mt=null;if(Lt===a.S3MCompressType.enrS3TCDXTN&&1!==i){var St=null;ht>s.S3MPixelFormat.BGR||ht===s.S3MPixelFormat.LUMINANCE_ALPHA?(St=new Uint8Array(O,F,Pt*Ut),Mt=new Uint8Array(Pt*Ut*4)):(St=new Uint16Array(O,F,at/2),Mt=new Uint16Array(Pt*Ut)),a.L.decode(Mt,Pt,Ut,St,ht),e.push(Mt.buffer),Lt=0}else Mt=new Uint8Array(O,F,at);Bt[gt]={id:gt,width:Pt,height:Ut,compressType:Lt,nFormat:ht,imageBuffer:Mt},F+=at}return{result:!0,version:w,xmlDoc:V,geoPackage:j,texturePackage:Bt,volImageBuffer:u,volBounds:T}}))}));
