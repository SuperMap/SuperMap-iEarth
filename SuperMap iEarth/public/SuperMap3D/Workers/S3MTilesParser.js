import{a as Bt}from"./chunk-H6N4J6TN.js";import{a as Oe}from"./chunk-AYI5HKFB.js";import{a as At}from"./chunk-77JEGE4I.js";import{a as Ut}from"./chunk-MMOQDUXZ.js";import{a as mt}from"./chunk-AMRCVYIA.js";import{a as _e}from"./chunk-44AFRGCG.js";import{a as Lt}from"./chunk-SSYG2MIY.js";import{a as d}from"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import"./chunk-Z4SOZDEW.js";import"./chunk-MX7ZM7WW.js";import{a as C}from"./chunk-EHDXVZQM.js";import"./chunk-ZVKIUA3Y.js";import{b as He}from"./chunk-3HZNWEV7.js";import{a as p}from"./chunk-LBR6REQR.js";import"./chunk-GXFCHGTA.js";import{a as b}from"./chunk-UBHQMGET.js";import{a as K}from"./chunk-EDZQSM3T.js";import{a as P}from"./chunk-PJGSCWXZ.js";import{a as S}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";//! Use DXT1 compression.
var tt=1<<0;//! Use DXT3 compression.
var gt=1<<1;//! Use DXT5 compression.
var xt=1<<2;//! Use a very slow but very high quality colour compressor.
var Xr=1<<8;//! Use a slow but high quality colour compressor (the default).
var Hr=1<<3;//! Use a fast but low quality colour compressor.
var Vr=1<<4;//! Weight the colour by alpha during cluster fit (disabled by default).
var br=1<<7,Pt=1<<5;function Dt(e,n,r,i){var a=e|n<<8,s=a>>11&31,t=a>>5&63,E=a&31;return r[i+0]=s<<3|s>>2,r[i+1]=t<<2|t>>4,r[i+2]=E<<3|E>>2,r[i+3]=255,a}function er(e,n,r,i){for(var a=new Uint8Array(16),s=Dt(n[r+0],n[r+1],a,0),t=Dt(n[r+2],n[r+3],a,4),E=0;E<3;E++){var x=a[E],u=a[4+E];i&&s<=t?(a[8+E]=(x+u)/2,a[12+E]=0):(a[8+E]=(2*x+u)/3,a[12+E]=(x+2*u)/3)}a[8+3]=255,a[12+3]=i&&s<=t?0:255;for(var T=new Uint8Array(16),E=0;E<4;++E){var f=n[r+4+E];T[4*E+0]=f&3,T[4*E+1]=f>>2&3,T[4*E+2]=f>>4&3,T[4*E+3]=f>>6&3}for(var E=0;E<16;++E)for(var A=4*T[E],y=0;y<4;++y)e[4*E+y]=a[A+y]}function tr(e,n,r){for(var i=0;i<8;++i){var a=bytes[r+i],s=a&15,t=a&240;e[8*i+3]=s|s<<4,e[8*i+7]=t|t>>4}}function rr(e,n,x){var i=n[x+0],a=n[x+1],s=new Uint8Array(8);if(s[0]=i,s[1]=a,i<=a){for(var t=1;t<5;++t)s[1+t]=((5-t)*i+t*a)/5;s[6]=0,s[7]=255}else for(var t=1;t<7;++t)s[1+t]=((7-t)*i+t*a)/7;for(var E=new Uint8Array(16),x=x+2,u=0,t=0;t<2;++t){for(var T=0,f=0;f<3;++f){var A=n[x++];T|=A<<8*f}for(var f=0;f<8;++f){var y=T>>3*f&7;E[u++]=y}}for(var t=0;t<16;++t)e[4*t+3]=s[E[t]]}function nr(e,n,r,i){var a=0;(i&(gt|xt))!=0&&(a=8),er(e,n,r+a,(i&tt)!=0),(i&gt)!=0?tr(e,n,r):(i&xt)!=0&&rr(e,n,r)}function ir(e,n,r,i){for(var a=new Uint16Array(4),s=e,t=0,E=0,x=0,u=0,T=0,f=0,A=0,y=0,R=0,l=n/4,v=r/4,I=0;I<v;I++)for(var h=0;h<l;h++)x=4*((v-I)*l+h),a[0]=i[x],a[1]=i[x+1],u=a[0]&31,T=a[0]&2016,f=a[0]&63488,A=a[1]&31,y=a[1]&2016,R=a[1]&63488,a[2]=5*u+3*A>>3|5*T+3*y>>3&2016|5*f+3*R>>3&63488,a[3]=5*A+3*u>>3|5*y+3*T>>3&2016|5*R+3*f>>3&63488,t=i[x+2],E=I*4*n+h*4,s[E]=a[t&3],s[E+1]=a[t>>2&3],s[E+2]=a[t>>4&3],s[E+3]=a[t>>6&3],E+=n,s[E]=a[t>>8&3],s[E+1]=a[t>>10&3],s[E+2]=a[t>>12&3],s[E+3]=a[t>>14],t=i[x+3],E+=n,s[E]=a[t&3],s[E+1]=a[t>>2&3],s[E+2]=a[t>>4&3],s[E+3]=a[t>>6&3],E+=n,s[E]=a[t>>8&3],s[E+1]=a[t>>10&3],s[E+2]=a[t>>12&3],s[E+3]=a[t>>14];return s}/*! @brief Decompresses an image in memory.

 @param rgba		Storage for the decompressed pixels.
 @param width	The width of the source image.
 @param height	The height of the source image.
 @param blocks	The compressed DXT blocks.
 @param flags	Compression flags.

 The decompressed pixels will be written as a contiguous array of width*height
 16 rgba values, with each component as 1 byte each. In memory this is:

 { r1, g1, b1, a1, .... , rn, gn, bn, an } for n = width*height

 The flags parameter should specify either kDxt1, kDxt3 or kDxt5 compression,
 however, DXT1 will be used by default if none is specified. All other flags
 are ignored.

 Internally this function calls squish::Decompress for each block.
 */function ar(e,n,r,i,a){for(var s=(a&tt)!=0?8:16,t=0,E=0;E<r;E+=4)for(var x=0;x<n;x+=4){var u=new Uint8Array(64);nr(u,i,t,a);for(var T=0,f=0;f<4;++f)for(var A=0;A<4;++A){var y=x+A,R=E+f;if(y<n&&R<r)for(var l=4*(n*(r-R)+y),v=0;v<4;++v)e[l++]=u[T++];else T+=4}t+=s}}function Ot(e){}Ot.decode=function(e,n,r,i,a){if(!(e==null||i==null||r==0||n==0)){var s=0;a>Oe.BGR||a===Oe.LUMINANCE_ALPHA?s=xt:s=tt|Pt,s&tt&&s&Pt?ir(e,n,r,i):ar(e,n,r,i,s)}};var Mt=Ot;var or=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),yt=or(void 0,function(){return yt.toString().search("(((.+)+)+)+$").toString().constructor(yt).search("(((.+)+)+)+$")});yt();var sr={encNONE:0,enrS3TCDXTN:14,enrPVRTPF_PVRTC2:19,enrPVRTPF_PVRTC:20,enrPVRTPF_PVRTC_4bpp:21,enrPVRTPF_ETC1:22},Ct=Object.freeze(sr);function Er(){return!0}function ur(e,n){n=b(n,"This object was destroyed, i.e., destroy() was called.");function r(){throw new P(n)}for(var i in e)typeof e[i]=="function"&&(e[i]=r);e.isDestroyed=Er}var le=ur;var rt={STREAM_DRAW:C.STREAM_DRAW,STATIC_DRAW:C.STATIC_DRAW,DYNAMIC_DRAW:C.DYNAMIC_DRAW,validate:function(e){return e===rt.STREAM_DRAW||e===rt.STATIC_DRAW||e===rt.DYNAMIC_DRAW}},te=rt;var Me={Texture:0,Geometry:1};function Ve(){this._memoryByType={}}Ve.prototype.allocateGPUMemory=function(e,n){let r=this._memoryByType[e];r||(r=this._memoryByType[e]=0),r+=n,this._memoryByType[e]=r};Ve.prototype.releaseGPUMemory=function(e,n){let r=this._memoryByType[e];r==null&&(r=this._memoryByType[e]=0),r-=n,r<0&&(console.log("memory cant less than 0."),r=0),this._memoryByType[e]=r};Ve.prototype.reset=function(){this._memoryByType={}};function be(){this._owners={},this.show=!1}be.prototype.allocateGPUMemory=function(e,n,r){if(!this.show)return;let i=this._owners[n];i||(i=this._owners[n]=new Ve),i.allocateGPUMemory(e,r)};be.prototype.releaseGPUMemory=function(e,n,r){if(!this.show)return;let i=this._owners[n];i||(i=this._owners[n]=new Ve),i.releaseGPUMemory(e,r)};be.prototype.reset=function(){this._owners={}};be.prototype.isDestroyed=function(){return!1};be.prototype.destroy=function(){return le(this)};function he(e){if(e=b(e,b.EMPTY_OBJECT),K.defined("options.context",e.context),!S(e.typedArray)&&!S(e.sizeInBytes))throw new P("Either options.sizeInBytes or options.typedArray is required.");if(S(e.typedArray)&&S(e.sizeInBytes))throw new P("Cannot pass in both options.sizeInBytes and options.typedArray.");if(S(e.typedArray)&&(K.typeOf.object("options.typedArray",e.typedArray),K.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),!te.validate(e.usage))throw new P("usage is invalid.");var n=e.context._gl,r=e.bufferTarget,i=e.typedArray,a=e.sizeInBytes,s=e.usage,t=S(i);t&&(a=i.byteLength),K.typeOf.number.greaterThan("sizeInBytes",a,0);var E=n.createBuffer();n.bindBuffer(r,E),n.bufferData(r,t?i:a,s),n.bindBuffer(r,null),this._gl=n,this._webgl2=e.context._webgl2,this._bufferTarget=r,this._sizeInBytes=a,this._usage=s,this._buffer=E,this.context=e.context,e.context.memorySize+=a,this._ownerName=e.owner,this.context.memoryAnalyzer.allocateGPUMemory(Me.Geometry,e.owner,a)}Object.defineProperties(he.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}});he.prototype._getBuffer=function(){return this._buffer};he.prototype.copyFromArrayView=function(e,n){n=b(n,0),K.defined("arrayView",e),K.typeOf.number.lessThanOrEquals("offsetInBytes + arrayView.byteLength",n+e.byteLength,this._sizeInBytes);var r=this._gl,i=this._bufferTarget;r.bindBuffer(i,this._buffer),r.bufferSubData(i,n,e),r.bindBuffer(i,null)};he.prototype.copyFromBuffer=function(e,n,r,i){if(!this._webgl2)throw new P("A WebGL 2 context is required.");if(!S(e))throw new P("readBuffer must be defined.");if(!S(i)||i<=0)throw new P("sizeInBytes must be defined and be greater than zero.");if(!S(n)||n<0||n+i>e.sizeInBytes)throw new P("readOffset must be greater than or equal to zero and readOffset + sizeInBytes must be less than of equal to readBuffer.sizeInBytes.");if(!S(r)||r<0||r+i>this._sizeInBytes)throw new P("writeOffset must be greater than or equal to zero and writeOffset + sizeInBytes must be less than of equal to this.sizeInBytes.");if(this._buffer===e.buffer&&(r>=n&&r<n+i||n>r&&n<r+i))throw new P("When readBuffer is equal to this, the ranges [readOffset + sizeInBytes) and [writeOffset, writeOffset + sizeInBytes) must not overlap.");if(this._bufferTarget===C.ELEMENT_ARRAY_BUFFER&&e.bufferTarget!==C.ELEMENT_ARRAY_BUFFER||this._bufferTarget!==C.ELEMENT_ARRAY_BUFFER&&e.bufferTarget===C.ELEMENT_ARRAY_BUFFER)throw new P("Can not copy an index buffer into another buffer type.");var a=C.COPY_READ_BUFFER,s=C.COPY_WRITE_BUFFER,t=this._gl;t.bindBuffer(s,this._buffer),t.bindBuffer(a,e.buffer),t.copyBufferSubData(a,s,n,r,i),t.bindBuffer(s,null),t.bindBuffer(a,null)};he.prototype.getBufferData=function(e,n,r,i){if(n=b(n,0),r=b(r,0),!this._webgl2)throw new P("A WebGL 2 context is required.");if(!S(e))throw new P("arrayView is required.");var a,s,t=e.byteLength;if(S(i)?(a=i,S(t)?s=1:(t=e.length,s=e.BYTES_PER_ELEMENT)):S(t)?(a=t-r,s=1):(t=e.length,a=t-r,s=e.BYTES_PER_ELEMENT),r<0||r>t)throw new P("destinationOffset must be greater than zero and less than the arrayView length.");if(r+a>t)throw new P("destinationOffset + length must be less than or equal to the arrayViewLength.");if(n<0||n>this._sizeInBytes)throw new P("sourceOffset must be greater than zero and less than the buffers size.");if(n+a*s>this._sizeInBytes)throw new P("sourceOffset + length must be less than the buffers size.");var E=this._gl,x=C.COPY_READ_BUFFER;E.bindBuffer(x,this._buffer),E.getBufferSubData(x,n,e,r,i),E.bindBuffer(x,null)};he.prototype.isDestroyed=function(){return!1};he.prototype.destroy=function(){return!this.context._contextWasLost&&this._gl.deleteBuffer(this._buffer),this.context.memorySize-=this.sizeInBytes,this.context.memoryAnalyzer.releaseGPUMemory(Me.Geometry,this._ownerName,this.sizeInBytes),le(this)};var Ft=he;var fr=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),_t=fr(void 0,function(){return _t.toString().search("(((.+)+)+)+$").toString().constructor(_t).search("(((.+)+)+)+$")});_t();function o(){}o.ALPHA_DISABLE=0,o.ALPHA_ADD=1,o.ALPHA_COMBINE=2,o.ALPHA_SUBTRACT=3,o.ALPHA_MULTIPLY=4,o.ALPHA_MAXIMIZED=5,o.ALPHA_ONEONE=6,o.ALPHA_PREMULTIPLIED=7,o.ALPHA_PREMULTIPLIED_PORTERDUFF=8,o.ALPHA_INTERPOLATE=9,o.ALPHA_SCREENMODE=10,o.ALPHA_ONEONE_ONEONE=11,o.ALPHA_ALPHATOCOLOR=12,o.ALPHA_REVERSEONEMINUS=13,o.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,o.ALPHA_ONEONE_ONEZERO=15,o.ALPHA_EXCLUSION=16,o.ALPHA_LAYER_ACCUMULATE=17,o.ALPHA_EQUATION_ADD=0,o.ALPHA_EQUATION_SUBSTRACT=1,o.ALPHA_EQUATION_REVERSE_SUBTRACT=2,o.ALPHA_EQUATION_MAX=3,o.ALPHA_EQUATION_MIN=4,o.ALPHA_EQUATION_DARKEN=5,o.DELAYLOADSTATE_NONE=0,o.DELAYLOADSTATE_LOADED=1,o.DELAYLOADSTATE_LOADING=2,o.DELAYLOADSTATE_NOTLOADED=4,o.NEVER=512,o.ALWAYS=519,o.LESS=513,o.EQUAL=514,o.LEQUAL=515,o.GREATER=516,o.GEQUAL=518,o.NOTEQUAL=517,o.KEEP=7680,o.ZERO=0,o.REPLACE=7681,o.INCR=7682,o.DECR=7683,o.INVERT=5386,o.INCR_WRAP=34055,o.DECR_WRAP=34056,o.FRONT=0,o.BACK=1,o.TEXTURE_CLAMP_ADDRESSMODE=0,o.TEXTURE_WRAP_ADDRESSMODE=1,o.TEXTURE_MIRROR_ADDRESSMODE=2,o.TEXTURE_CREATIONFLAG_STORAGE=1,o.TEXTUREFORMAT_ALPHA=0,o.TEXTUREFORMAT_LUMINANCE=1,o.TEXTUREFORMAT_LUMINANCE_ALPHA=2,o.TEXTUREFORMAT_RGB=4,o.TEXTUREFORMAT_RGBA=5,o.TEXTUREFORMAT_RED=6,o.TEXTUREFORMAT_R=6,o.TEXTUREFORMAT_RG=7,o.TEXTUREFORMAT_RED_INTEGER=8,o.TEXTUREFORMAT_R_INTEGER=8,o.TEXTUREFORMAT_RG_INTEGER=9,o.TEXTUREFORMAT_RGB_INTEGER=10,o.TEXTUREFORMAT_RGBA_INTEGER=11,o.TEXTUREFORMAT_BGRA=12,o.TEXTUREFORMAT_DEPTH24_STENCIL8=13,o.TEXTUREFORMAT_DEPTH32_FLOAT=14,o.TEXTUREFORMAT_DEPTH16=15,o.TEXTUREFORMAT_DEPTH24=16,o.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,o.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,o.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,o.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,o.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,o.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,o.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,o.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,o.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,o.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,o.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,o.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,o.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,o.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,o.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,o.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,o.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,o.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,o.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,o.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,o.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,o.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,o.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,o.TEXTURETYPE_UNSIGNED_BYTE=0,o.TEXTURETYPE_UNSIGNED_INT=0,o.TEXTURETYPE_FLOAT=1,o.TEXTURETYPE_HALF_FLOAT=2,o.TEXTURETYPE_BYTE=3,o.TEXTURETYPE_SHORT=4,o.TEXTURETYPE_UNSIGNED_SHORT=5,o.TEXTURETYPE_INT=6,o.TEXTURETYPE_UNSIGNED_INTEGER=7,o.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,o.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,o.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,o.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,o.TEXTURETYPE_UNSIGNED_INT_24_8=12,o.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,o.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,o.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,o.TEXTURETYPE_UNDEFINED=16,o.TEXTURE_NEAREST_SAMPLINGMODE=1,o.TEXTURE_NEAREST_NEAREST=1,o.TEXTURE_BILINEAR_SAMPLINGMODE=2,o.TEXTURE_LINEAR_LINEAR=2,o.TEXTURE_TRILINEAR_SAMPLINGMODE=3,o.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,o.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,o.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,o.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,o.TEXTURE_NEAREST_LINEAR=7,o.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,o.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,o.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,o.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,o.TEXTURE_LINEAR_NEAREST=12,o.TEXTURE_EXPLICIT_MODE=0,o.TEXTURE_SPHERICAL_MODE=1,o.TEXTURE_PLANAR_MODE=2,o.TEXTURE_CUBIC_MODE=3,o.TEXTURE_PROJECTION_MODE=4,o.TEXTURE_SKYBOX_MODE=5,o.TEXTURE_INVCUBIC_MODE=6,o.TEXTURE_EQUIRECTANGULAR_MODE=7,o.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,o.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,o.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,o.TEXTURE_FILTERING_QUALITY_HIGH=64,o.TEXTURE_FILTERING_QUALITY_MEDIUM=16,o.TEXTURE_FILTERING_QUALITY_LOW=8,o.SCALEMODE_FLOOR=1,o.SCALEMODE_NEAREST=2,o.SCALEMODE_CEILING=3,o.MATERIAL_TextureDirtyFlag=1,o.MATERIAL_LightDirtyFlag=2,o.MATERIAL_FresnelDirtyFlag=4,o.MATERIAL_AttributesDirtyFlag=8,o.MATERIAL_MiscDirtyFlag=16,o.MATERIAL_PrePassDirtyFlag=32,o.MATERIAL_AllDirtyFlag=63,o.MATERIAL_TriangleFillMode=0,o.MATERIAL_WireFrameFillMode=1,o.MATERIAL_PointFillMode=2,o.MATERIAL_PointListDrawMode=3,o.MATERIAL_LineListDrawMode=4,o.MATERIAL_LineLoopDrawMode=5,o.MATERIAL_LineStripDrawMode=6,o.MATERIAL_TriangleStripDrawMode=7,o.MATERIAL_TriangleFanDrawMode=8,o.MATERIAL_ClockWiseSideOrientation=0,o.MATERIAL_CounterClockWiseSideOrientation=1,o.ACTION_NothingTrigger=0,o.ACTION_OnPickTrigger=1,o.ACTION_OnLeftPickTrigger=2,o.ACTION_OnRightPickTrigger=3,o.ACTION_OnCenterPickTrigger=4,o.ACTION_OnPickDownTrigger=5,o.ACTION_OnDoublePickTrigger=6,o.ACTION_OnPickUpTrigger=7,o.ACTION_OnPickOutTrigger=16,o.ACTION_OnLongPressTrigger=8,o.ACTION_OnPointerOverTrigger=9,o.ACTION_OnPointerOutTrigger=10,o.ACTION_OnEveryFrameTrigger=11,o.ACTION_OnIntersectionEnterTrigger=12,o.ACTION_OnIntersectionExitTrigger=13,o.ACTION_OnKeyDownTrigger=14,o.ACTION_OnKeyUpTrigger=15,o.PARTICLES_BILLBOARDMODE_Y=2,o.PARTICLES_BILLBOARDMODE_ALL=7,o.PARTICLES_BILLBOARDMODE_STRETCHED=8,o.MESHES_CULLINGSTRATEGY_STANDARD=0,o.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,o.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,o.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,o.SCENELOADER_NO_LOGGING=0,o.SCENELOADER_MINIMAL_LOGGING=1,o.SCENELOADER_SUMMARY_LOGGING=2,o.SCENELOADER_DETAILED_LOGGING=3,o.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,o.PREPASS_POSITION_TEXTURE_TYPE=1,o.PREPASS_VELOCITY_TEXTURE_TYPE=2,o.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,o.PREPASS_COLOR_TEXTURE_TYPE=4,o.PREPASS_DEPTH_TEXTURE_TYPE=5,o.PREPASS_NORMAL_TEXTURE_TYPE=6,o.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,o.BUFFER_CREATIONFLAG_READ=1,o.BUFFER_CREATIONFLAG_WRITE=2,o.BUFFER_CREATIONFLAG_READWRITE=3,o.BUFFER_CREATIONFLAG_UNIFORM=4,o.BUFFER_CREATIONFLAG_VERTEX=8,o.BUFFER_CREATIONFLAG_INDEX=16,o.BUFFER_CREATIONFLAG_STORAGE=32,o.RENDERPASS_MAIN=0,o.INPUT_ALT_KEY=18,o.INPUT_CTRL_KEY=17,o.INPUT_META_KEY1=91,o.INPUT_META_KEY2=92,o.INPUT_META_KEY3=93,o.INPUT_SHIFT_KEY=16,o.SNAPSHOTRENDERING_STANDARD=0,o.SNAPSHOTRENDERING_FAST=1,o.PERSPECTIVE_CAMERA=0,o.ORTHOGRAPHIC_CAMERA=1,o.FOVMODE_VERTICAL_FIXED=0,o.FOVMODE_HORIZONTAL_FIXED=1,o.RIG_MODE_NONE=0,o.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,o.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,o.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,o.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,o.RIG_MODE_STEREOSCOPIC_INTERLACED=14,o.RIG_MODE_VR=20,o.RIG_MODE_WEBVR=21,o.RIG_MODE_CUSTOM=22,o.MAX_SUPPORTED_UV_SETS=6,o.GL_ALPHA_EQUATION_ADD=32774,o.GL_ALPHA_EQUATION_MIN=32775,o.GL_ALPHA_EQUATION_MAX=32776,o.GL_ALPHA_EQUATION_SUBTRACT=32778,o.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,o.GL_ALPHA_FUNCTION_SRC=768,o.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,o.GL_ALPHA_FUNCTION_SRC_ALPHA=770,o.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,o.GL_ALPHA_FUNCTION_DST_ALPHA=772,o.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,o.GL_ALPHA_FUNCTION_DST_COLOR=774,o.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,o.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,o.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,o.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,o.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,o.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,o.SnippetUrl="";var Le=o;var Tr=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),ct=Tr(void 0,function(){return ct.toString().search("(((.+)+)+)+$").toString().constructor(ct).search("(((.+)+)+)+$")});ct();function nt(){this.references=0,this.capacity=0,this.is32Bits=![],this.uniqueId=nt._Counter++}Object.defineProperty(nt.prototype,"underlyingResource",{get:function(){return null},enumerable:![],configurable:!![]}),nt._Counter=0;var Gt=nt;var Ar=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),Rt=Ar(void 0,function(){return Rt.toString().search("(((.+)+)+)+$").toString().constructor(Rt).search("(((.+)+)+)+$")});Rt();function X(e,n,r,i,a,s,t,E){i===void 0&&(i=0),a===void 0&&(a=![]),s===void 0&&(s=![]),t===void 0&&(t=![]),this._isAlreadyOwned=![],e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=r,this._instanced=s,this._divisor=E||1,n instanceof Gt?(this._data=null,this._buffer=n):(this._data=n,this._buffer=null),this.byteStride=t?i:i*Float32Array.BYTES_PER_ELEMENT,!a&&this.create()}X.prototype.createVertexBuffer=function(e,n,r,i,a,s,t){s===void 0&&(s=![]);var E=s?n:n*Float32Array.BYTES_PER_ELEMENT,x=i?s?i:i*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new _(this._engine,this,e,this._updatable,!![],x,a===void 0?this._instanced:a,E,r,void 0,void 0,!![],this._divisor||t)},X.prototype.isUpdatable=function(){return this._updatable},X.prototype.getData=function(){return this._data},X.prototype.getBuffer=function(){return this._buffer},X.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},X.prototype.create=function(e){e===void 0&&(e=null),!(!e&&this._buffer)&&(e=e||this._data,e&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e)))},X.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},X.prototype.update=function(e){this.create(e)},X.prototype.updateDirectly=function(e,n,r,i){i===void 0&&(i=![]),!!this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,i?n:n*Float32Array.BYTES_PER_ELEMENT,r?r*this.byteStride:void 0),n===0&&r===void 0?this._data=e:this._data=null)},X.prototype._increaseReferences=function(){if(!!this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!![];return}this._buffer.references++}},X.prototype.dispose=function(){!this._buffer||this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)};function _(e,n,r,i,a,s,t,E,x,u,T,f,A,y){if(T===void 0&&(T=![]),f===void 0&&(f=![]),A===void 0&&(A=1),y===void 0&&(y=![]),n instanceof X?(this._buffer=n,this._ownsBuffer=y):(this._buffer=new X(e,n,i,s,a,t,f),this._ownsBuffer=!![]),this.uniqueId=_._Counter++,this._kind=r,u==null){var R=this.getData();this.type=_.FLOAT,R instanceof Int8Array?this.type=_.BYTE:R instanceof Uint8Array?this.type=_.UNSIGNED_BYTE:R instanceof Int16Array?this.type=_.SHORT:R instanceof Uint16Array?this.type=_.UNSIGNED_SHORT:R instanceof Int32Array?this.type=_.INT:R instanceof Uint32Array&&(this.type=_.UNSIGNED_INT)}else this.type=u;var l=_.GetTypeByteLength(this.type);f?(this._size=x||(s?s/l:_.DeduceStride(r)),this.byteStride=s||this._buffer.byteStride||this._size*l,this.byteOffset=E||0):(this._size=x||s||_.DeduceStride(r),this.byteStride=s?s*l:this._buffer.byteStride||this._size*l,this.byteOffset=(E||0)*l),this.normalized=T,this._instanced=t!==void 0?t:![],this._instanceDivisor=t?A:0,this._computeHashCode()}Object.defineProperty(_.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,e==0?this._instanced=![]:this._instanced=!![],this._computeHashCode()},enumerable:![],configurable:!![]}),_.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},_.prototype._rebuild=function(){!this._buffer||this._buffer._rebuild()},_.prototype.getKind=function(){return this._kind},_.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},_.prototype.getData=function(){return this._buffer.getData()},_.prototype.getFloatData=function(e,n){var r=this.getData();if(!r)return null;var i=this.getSize()*_.GetTypeByteLength(this.type),a=e*this.getSize();if(this.type!==_.FLOAT||this.byteStride!==i){var s=new Float32Array(a);return this.forEach(a,function(T,f){return s[f]=T}),s}if(!(r instanceof Array||r instanceof Float32Array)||this.byteOffset!==0||r.length!==a)if(r instanceof Array){var t=this.byteOffset/4;return r.slice(t,t+a)}else{if(r instanceof ArrayBuffer)return new Float32Array(r,this.byteOffset,a);var t=r.byteOffset+this.byteOffset;if(n){var E=new Float32Array(a),x=new Float32Array(r.buffer,t,a);return E.set(x),E}var u=t%4;return u&&(t=Math.max(0,t-u)),new Float32Array(r.buffer,t,a)}return n?r.slice():r},_.prototype.getBuffer=function(){return this._buffer.getBuffer()},_.prototype.getStrideSize=function(){return this.byteStride/_.GetTypeByteLength(this.type)},_.prototype.getOffset=function(){return this.byteOffset/_.GetTypeByteLength(this.type)},_.prototype.getSize=function(e){return e===void 0&&(e=![]),e?this._size*_.GetTypeByteLength(this.type):this._size},_.prototype.getIsInstanced=function(){return this._instanced},_.prototype.getInstanceDivisor=function(){return this._instanceDivisor},_.prototype.create=function(e){this._buffer.create(e)},_.prototype.update=function(e){this._buffer.update(e)},_.prototype.updateDirectly=function(e,n,r){r===void 0&&(r=![]),this._buffer.updateDirectly(e,n,void 0,r)},_.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},_.prototype.forEach=function(e,n){_.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,n)},_.DeduceStride=function(e){switch(e){case _.UVKind:case _.UV2Kind:case _.UV3Kind:case _.UV4Kind:case _.UV5Kind:case _.UV6Kind:return 2;case _.NormalKind:case _.PositionKind:return 3;case _.ColorKind:case _.MatricesIndicesKind:case _.MatricesIndicesExtraKind:case _.MatricesWeightsKind:case _.MatricesWeightsExtraKind:case _.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}},_.GetTypeByteLength=function(e){switch(e){case _.BYTE:case _.UNSIGNED_BYTE:return 1;case _.SHORT:case _.UNSIGNED_SHORT:return 2;case _.INT:case _.UNSIGNED_INT:case _.FLOAT:return 4;default:throw new Error("Invalid type '".concat(e,"'"))}},_.ForEach=function(e,n,r,i,a,s,t,E){if(e instanceof Array)for(var x=n/4,u=r/4,T=0;T<s;T+=i){for(var f=0;f<i;f++)E(e[x+f],T+f);x+=u}else for(var A=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),y=_.GetTypeByteLength(a),T=0;T<s;T+=i){for(var R=n,f=0;f<i;f++){var l=_._GetFloatValue(A,a,R,t);E(l,T+f),R+=y}n+=r}},_._GetFloatValue=function(e,n,r,i){switch(n){case _.BYTE:{var a=e.getInt8(r);return i&&(a=Math.max(a/127,-1)),a}case _.UNSIGNED_BYTE:{var a=e.getUint8(r);return i&&(a=a/255),a}case _.SHORT:{var a=e.getInt16(r,!![]);return i&&(a=Math.max(a/32767,-1)),a}case _.UNSIGNED_SHORT:{var a=e.getUint16(r,!![]);return i&&(a=a/65535),a}case _.INT:return e.getInt32(r,!![]);case _.UNSIGNED_INT:return e.getUint32(r,!![]);case _.FLOAT:return e.getFloat32(r,!![]);default:throw new Error("Invalid component type ".concat(n))}},_._Counter=0,_.BYTE=5120,_.UNSIGNED_BYTE=5121,_.SHORT=5122,_.UNSIGNED_SHORT=5123,_.INT=5124,_.UNSIGNED_INT=5125,_.FLOAT=5126,_.PositionKind="position",_.NormalKind="normal",_.TangentKind="tangent",_.UVKind="uv",_.UV2Kind="uv2",_.UV3Kind="uv3",_.UV4Kind="uv4",_.UV5Kind="uv5",_.UV6Kind="uv6",_.ColorKind="color",_.ColorInstanceKind="instanceColor",_.MatricesIndicesKind="matricesIndices",_.MatricesWeightsKind="matricesWeights",_.MatricesIndicesExtraKind="matricesIndicesExtra",_.MatricesWeightsExtraKind="matricesWeightsExtra";var xr=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),pt=xr(void 0,function(){return pt.toString().search("(((.+)+)+)+$").toString().constructor(pt).search("(((.+)+)+)+$")});pt();function me(e,n,r){r===void 0&&(r=Le.BUFFER_CREATIONFLAG_READWRITE),this._engine=e,this._engine._storageBuffers.push(this),this._create(n,r)}me.prototype._create=function(e,n){this._bufferSize=e,this._creationFlags=n,this._buffer=this._engine.createStorageBuffer(e,n)},me.prototype._rebuild=function(){this._create(this._bufferSize,this._creationFlags)},me.prototype.getBuffer=function(){return this._buffer},me.prototype.update=function(e,n,r){!this._buffer||this._engine.updateStorageBuffer(this._buffer,e,n,r)},me.prototype.read=function(e,n,r){return this._engine.readFromStorageBuffer(this._buffer,e,n,r)},me.prototype.dispose=function(){var e=this._engine._storageBuffers,n=e.indexOf(this);n!==-1&&(e[n]=e[e.length-1],e.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null};var wt=me;function ve(e){e=b(e,b.EMPTY_OBJECT);var n=e.context,r=e.bufferTarget,i=e.typedArray,a=e.sizeInBytes,s=e.usage,t=S(i);t?a=i.byteLength:i=new Uint8Array(a);var E=Le.BUFFER_CREATIONFLAG_STORAGE;S(s)&&(s==te.STREAM_DRAW?E|=Le.BUFFER_CREATIONFLAG_WRITE:s==te.STATIC_DRAW?E|=Le.BUFFER_CREATIONFLAG_WRITE:s==te.DYNAMIC_DRAW&&(E|=Le.BUFFER_CREATIONFLAG_READWRITE)),S(r)?r==C.ELEMENT_ARRAY_BUFFER?(i instanceof Uint8Array&&(e.indexDatatype==_e.UNSIGNED_INT?i=new Uint32Array(i.buffer,i.byteOffset,i.byteLength/4):e.indexDatatype==_e.UNSIGNED_SHORT&&(i=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2))),this._dataBuffer=n.engine.createIndexBuffer(i)):r==C.ARRAY_BUFFER?(this._dataBuffer=new X(n.engine,i,!0),this._dataBuffer._data=null):console.log("BufferGPU not supported bufferTarget"):(this._dataBuffer=new wt(n.engine,a,E),t&&this._dataBuffer.update(i,0,a)),this._bufferTarget=r,this._sizeInBytes=a,this._usage=s,this.context=e.context,e.context.memorySize+=a,this._ownerName=e.owner,this.context.memoryAnalyzer.allocateGPUMemory(Me.Geometry,e.owner,a)}Object.defineProperties(ve.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}},dataBuffer:{get:function(){return this._dataBuffer}}});ve.prototype._getBuffer=function(){return console.log("BufferGPU.prototype._getBuffer"),this._dataBuffer};ve.prototype.copyFromArrayView=function(e,n){this._bufferTarget===C.ELEMENT_ARRAY_BUFFER?this.context.engine.updateDynamicIndexBuffer(this._dataBuffer,e):this._dataBuffer.updateDirectly(e,n,null,!0)};ve.prototype.copyFromBuffer=function(e,n,r,i){console.log("BufferGPU.prototype.copyFromBuffer")};ve.prototype.getBufferData=function(e,n,r,i){console.log("BufferGPU.prototype.getBufferData")};ve.prototype.isDestroyed=function(){return!1};ve.prototype.destroy=function(){return this._bufferTarget!==C.ELEMENT_ARRAY_BUFFER?this._dataBuffer.dispose():this.context._engine._releaseBuffer(this._dataBuffer),this.context.memorySize-=this.sizeInBytes,this.context.memoryAnalyzer.releaseGPUMemory(Me.Geometry,this._ownerName,this.sizeInBytes),le(this)};var zt=ve;function yr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Math.random()*16|0,r=e==="x"?n:n&3|8;return r.toString(16)})}var Yt=yr;function J(e){if(e=b(e,b.EMPTY_OBJECT),K.defined("options.context",e.context),!S(e.typedArray)&&!S(e.sizeInBytes))throw new P("Either options.sizeInBytes or options.typedArray is required.");if(S(e.typedArray)&&S(e.sizeInBytes))throw new P("Cannot pass in both options.sizeInBytes and options.typedArray.");S(e.typedArray)&&(K.typeOf.object("options.typedArray",e.typedArray),K.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),this._id=Yt(),e.context.webgpu?this._inner=new zt(e):this._inner=new Ft(e),this.vertexArrayDestroyable=!0}J.createVertexBuffer=function(e){return K.defined("options.context",e.context),new J({context:e.context,bufferTarget:C.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage,owner:e.owner})};J.createIndexBuffer=function(e){if(K.defined("options.context",e.context),!_e.validate(e.indexDatatype))throw new P("Invalid indexDatatype.");if(e.indexDatatype===_e.UNSIGNED_INT&&!e.context.elementIndexUint)throw new P("IndexDatatype.UNSIGNED_INT requires OES_element_index_uint, which is not supported on this system.  Check context.elementIndexUint.");var n=e.context,r=e.indexDatatype,i=_e.getSizeInBytes(r),a=new J({context:n,bufferTarget:C.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage,indexDatatype:r,owner:e.owner}),s=a.sizeInBytes/i;return Object.defineProperties(a,{indexDatatype:{get:function(){return r}},bytesPerIndex:{get:function(){return i}},numberOfIndices:{get:function(){return s}}}),a};Object.defineProperties(J.prototype,{sizeInBytes:{get:function(){return this._inner.sizeInBytes}},usage:{get:function(){return this._inner.usage}},bufferTarget:{get:function(){return this._inner._bufferTarget}},buffer:{get:function(){return this._inner._buffer}}});J.prototype._getBuffer=function(){return this._inner._getBuffer()};J.prototype.copyFromArrayView=function(e,n){this._inner.copyFromArrayView(e,n)};J.prototype.copyFromBuffer=function(e,n,r,i){this._inner.copyFromBuffer(e,n,r,i)};J.prototype.getBufferData=function(e,n,r,i){this._inner.getBufferData(e,n,r,i)};J.prototype.isDestroyed=function(){return!1};J.prototype.destroy=function(){return this._inner.destroy(),le(this)};var We=J;var _r=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),lt=_r(void 0,function(){return lt.toString().search("(((.+)+)+)+$").toString().constructor(lt).search("(((.+)+)+)+$")});lt();function ht(){}ht.computeNeighbors=function(e,n){for(var r=e.length/3,i=new Uint32Array(n+1),a=new Uint32Array(n+1),s=function(I,h){I<h?i[I+1]++:a[h+1]++},t=0;t<r;t++){var E=e[3*t],x=e[3*t+1],u=e[3*t+2];s(E,x),s(x,u),s(u,E)}for(t=x=E=0;t<n;t++)u=i[t+1],s=a[t+1],i[t+1]=E,a[t+1]=x,E+=u,x+=s;for(var T=new Uint32Array(6*r),f=i[n],s=function(N,m,U){if(N<m){var L=i[N+1]++;T[2*L]=m,T[2*L+1]=U}else L=a[m+1]++,T[2*f+2*L]=N,T[2*f+2*L+1]=U},t=0;t<r;t++)E=e[3*t],x=e[3*t+1],u=e[3*t+2],s(E,x,t),s(x,u,t),s(u,E,t);for(E=function(I,h){var N=2*I;for(I=h-I,h=1;h<I;h++){var m=T[N+2*h],U=T[N+2*h+1],L=h-1;for(L;0<=L&&T[N+2*L]>m;L--)T[N+2*L+2]=T[N+2*L],T[N+2*L+3]=T[N+2*L+1];T[N+2*L+2]=m,T[N+2*L+3]=U}},t=0;t<n;t++)E(i[t],i[t+1]),E(f+a[t],f+a[t+1]);for(var A=new Int32Array(3*r),y=function(m,U){return m===e[3*U]?0:m===e[3*U+1]?1:m===e[3*U+2]?2:-1},r=function(m,U){m=y(m,U),A[3*U+m]=-1},E=function(m,U,L,D){m=y(m,U),A[3*U+m]=D,L=y(L,D),A[3*D+L]=U},t=0;t<n;t++){for(var x=i[t],u=i[t+1],s=a[t],R=a[t+1];x<u&&s<R;){var l=T[2*x],v=T[2*f+2*s];l===v?(E(t,T[2*x+1],v,T[2*f+2*s+1]),x++,s++):l<v?(r(t,T[2*x+1]),x++):(r(v,T[2*f+2*s+1]),s++)}for(;x<u;)r(t,T[2*x+1]),x++;for(;s<R;)v=T[2*f+2*s],r(v,T[2*f+2*s+1]),s++}return A};function cr(e){--e;for(var n=1;32>n;n<<=1)e|=e>>n;return e+1}var ce=null;ht.deduplicate=function(e,n,r,i,a){r===void 0&&(r=0),i===void 0&&(i=0),a===void 0&&(a=e.byteLength/(4*n)),e=new Uint32Array(e,i,a*n),i=new Uint32Array(a);var s=Math.floor(1.1*a)+1;(ce==null||ce.length<2*s)&&(ce=new Uint32Array(cr(2*s)));for(var t=0;t<2*s;t++)ce[t]=0;for(var E=0,x=r!==0?Math.ceil(7.84*1.96/(r*r)*r*(1-r)):a,t=0;t<a;t++){if(t===x){var u=1-E/t;if(u+1.96*Math.sqrt(u*(1-u)/t)<r)return null;x*=2}for(var u=t*n,T,f=T=0;f<n;f++)T=e[u+f]+T|0,T=T+(T<<11)+(T>>>2)|0;T>>>=0;for(var f=T%s,A=E;ce[2*f+1]!==0;){if(ce[2*f]===T){var y=ce[2*f+1]-1,R=y*n;e:{for(var l=0;l<n;l++)if(e[u+l]!==e[R+l]){R=!1;break e}R=!0}if(R){A=i[y];break}}f++,f>=s&&(f-=s)}A===E&&(ce[2*f]=T,ce[2*f+1]=t+1,E++),i[t]=A}if(r!==0&&1-E/a<r)return null;for(r=new Uint32Array(n*E),t=E=0;t<a;t++)if(i[t]===E){for(s=e,x=t*n,u=r,T=E*n,f=n,A=0;A<f;A++)u[T+A]=s[x+A];E++}return{buffer:r.buffer,indices:i,uniqueCount:E}};var it=ht;function Vt(){}function Rr(e){return Math.acos(1<e?1:-1>e?-1:e)}function bt(e){var n=function(){var i=!![];return function(a,s){var t=i?function(){if(s){var E=s.apply(a,arguments);return s=null,E}}:function(){};return i=![],t}}(),r=n(this,function(){return r.toString().search("(((.+)+)+)+$").toString().constructor(r).search("(((.+)+)+)+$")});return r(),e*Math.PI/180}var pr=4,lr=35,Wt=bt(pr),hr=bt(lr),vr=Math.cos(hr),dr=Math.cos(Wt);function Ir(e,n,r){var i=r.x-n.x,a=r.y-n.y;return n=r.z-n.z,r=i*i+a*a+n*n,r?(r=1/Math.sqrt(r),e.x=i*r,e.y=a*r,e.z=n*r,e):(e.x=0,e.y=0,e.z=0,e)}var Sr={position0:new p,position1:new p,faceNormal0:new p,faceNormal1:new p,cosAngle:0},Xt=new p,Ht=new p;function Nr(e,n){var r=Rr(e.cosAngle);Ir(Ht,e.position1,e.position0),p.cross(e.faceNormal0,e.faceNormal1,Xt);var i=0<p.dot(Xt,Ht)?-1:1;return r*i>n}function Lr(e){var n=e.faces.length/3,r=e.faces,i=e.neighbors,a=0,s=0;for(s=0;s<n;s++){var t=i[3*s+0],E=i[3*s+1],x=i[3*s+2],u=r[3*s+0],T=r[3*s+1],f=r[3*s+2];a=a+(t===-1||u<T?1:0),a=a+(E===-1||T<f?1:0),a=a+(x===-1||f<u?1:0)}var A=new Int32Array(4*a),y=0;for(s=0;s<n;s++){var t=i[3*s+0],E=i[3*s+1],x=i[3*s+2],u=r[3*s+0],T=r[3*s+1],f=r[3*s+2];(t===-1||u<T)&&(A[y++]=u,A[y++]=T,A[y++]=s,A[y++]=t),(E===-1||T<f)&&(A[y++]=T,A[y++]=f,A[y++]=s,A[y++]=E),(x===-1||f<u)&&(A[y++]=f,A[y++]=u,A[y++]=s,A[y++]=x)}return A}var se=new p,Ce=new p,Fe=new p;function mr(e){var n=e.x*e.x+e.y*e.y+e.z*e.z;n>0&&(n=1/Math.sqrt(n),e.x*=n,e.y*=n,e.z*=n)}function Ur(e){for(var n=e.faces.length/3,r=e.vertices,i=e.dim,a=e.faces,s=new Float32Array(3*n),t=0;t<n;t++){var E=a[3*t+0],x=a[3*t+1],u=a[3*t+2];se.x=r[i*E],se.y=r[i*E+1],se.z=r[i*E+2],Ce.x=r[i*x],Ce.y=r[i*x+1],Ce.z=r[i*x+2],Fe.x=r[i*u],Fe.y=r[i*u+1],Fe.z=r[i*u+2],p.subtract(Ce,se,Ce),p.subtract(Fe,se,Fe),p.cross(Ce,Fe,se),mr(se),s[3*t+0]=se.x,s[3*t+1]=se.y,s[3*t+2]=se.z}return s}function Br(e,n){n===0&&(n=e,e=0);for(var r=Array(n-e),i=e;i<n;i++)r[i-e]=i;return r}Vt.extractEdges=function(e){var n=e.vertices,r=e.dim,i=Sr,a=i.position0,s=i.position1,t=i.faceNormal0,E=i.faceNormal1,x=Ur(e),u=Lr(e),T=u.length/4,f=new Float32Array(9*T),A=0,y=new Float32Array(12*T),R=0,l=0,v=0,I=Br(0,T),h=new Float32Array(T);h.forEach(function(de,c,re){var Q=u[4*c+0],ne=u[4*c+1];a.x=n[Q*r],a.y=n[Q*r+1],a.z=n[Q*r+2],s.x=n[ne*r],s.y=n[ne*r+1],s.z=n[ne*r+2],re[c]=p.distance(a,s)}),I.sort(function(de,c){return h[c]-h[de]});for(var N=[],m=[],U=0;U<T;U++){var L=I[U],D=h[L],k=u[4*L+0],M=u[4*L+1],q=u[4*L+2],H=u[4*L+3],j=H===-1;if(a.x=n[k*r],a.y=n[k*r+1],a.z=n[k*r+2],s.x=n[M*r],s.y=n[M*r+1],s.z=n[M*r+2],j)t.x=x[3*q],t.y=x[3*q+1],t.z=x[3*q+2],E.x=t.x,E.y=t.y,E.z=t.z,i.cosAngle=p.dot(t,E);else if(t.x=x[3*q],t.y=x[3*q+1],t.z=x[3*q+2],E.x=x[3*H],E.y=x[3*H+1],E.z=x[3*H+2],i.cosAngle=p.dot(t,E),i.cosAngle>dr)continue;l+=D,v++,j||i.cosAngle<vr?(f[A++]=i.position0.x,f[A++]=i.position0.y,f[A++]=i.position0.z,f[A++]=i.position1.x,f[A++]=i.position1.y,f[A++]=i.position1.z,f[A++]=i.faceNormal0.x,f[A++]=i.faceNormal0.y,f[A++]=i.faceNormal0.z,N.push(D)):Nr(i,Wt)&&(y[R++]=i.position0.x,y[R++]=i.position0.y,y[R++]=i.position0.z,y[R++]=i.position1.x,y[R++]=i.position1.y,y[R++]=i.position1.z,y[R++]=i.faceNormal0.x,y[R++]=i.faceNormal0.y,y[R++]=i.faceNormal0.z,y[R++]=i.faceNormal1.x,y[R++]=i.faceNormal1.y,y[R++]=i.faceNormal1.z,m.push(D))}f=f.slice(0,A),y=y.slice(0,R);var g=l/v,Be=N.length,ge=m.length;return{regular:{instancesData:f,instanceCount:Be,edgeLength:Be*g},silhouette:{instancesData:y,instanceCount:ge,edgeLength:ge*g},averageEdgeLength:g}};var Kt=Vt;var gr=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),vt=gr(void 0,function(){return vt.toString().search("(((.+)+)+)+$").toString().constructor(vt).search("(((.+)+)+)+$")});vt();var Pr={SVC_Vertex:1,SVC_Normal:2,SVC_VertexColor:4,SVC_SecondColor:8,SVC_TexutreCoord:16,SVC_TexutreCoordIsW:32},Ke=Object.freeze(Pr);var Dr=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),dt=Dr(void 0,function(){return dt.toString().search("(((.+)+)+)+$").toString().constructor(dt).search("(((.+)+)+)+$")});dt();function Y(e){}Y.RegularInstanceStride=12,Y.SilhouetteInstanceStride=15,Y.createEdgeData=function(e,n,r){if(n.length==0)return null;var i=n[0],a;i.indexType===0?a=new Uint16Array(i.indicesTypedArray.buffer,i.indicesTypedArray.byteOffset,i.indicesTypedArray.byteLength/2):a=new Uint32Array(i.indicesTypedArray.buffer,i.indicesTypedArray.byteOffset,i.indicesTypedArray.byteLength/4);var s=![],t=Y.extractEdgeInformation(e,s,a),E=Kt.extractEdges(t);return S(r)&&(S(E.regular.instancesData)&&r.push(E.regular.instancesData.buffer),S(E.silhouette.instancesData)&&r.push(E.silhouette.instancesData.buffer)),E};function kt(e,n){if(S(e.cachedSidenessVertexBuffer))return e.cachedSidenessVertexBuffer;var r=new Float32Array(8),i=0;return r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=1,r[i++]=1,r[i++]=1,r[i++]=1,r[i++]=0,e.cachedSidenessVertexBuffer=We.createVertexBuffer({context:e,typedArray:r,usage:te.STATIC_DRAW,owner:n}),e.cachedSidenessVertexBuffer.vertexArrayDestroyable=![],e.cachedSidenessVertexBuffer}function Or(){var e=new Uint16Array(6),n=0;return e[n++]=2,e[n++]=1,e[n++]=0,e[n++]=3,e[n++]=2,e[n++]=0,e}Y.createIndexBuffer=function(e,n){return S(e.cachedSidenessIndexBuffer)||(e.cachedSidenessIndexBuffer=We.createIndexBuffer({context:e,typedArray:Or(),usage:te.STATIC_DRAW,indexDatatype:_e.UNSIGNED_SHORT,owner:n}),e.cachedSidenessIndexBuffer.vertexArrayDestroyable=![]),e.cachedSidenessIndexBuffer},Y.createRegularEdgeAttributes=function(e,n,r,i){if(!(!S(n.instancesData)||n.instancesData.length==0)){var a={},s=[];n.attributeLocations=a,n.attributes=s;var t=We.createVertexBuffer({context:e,typedArray:n.instancesData,usage:te.STATIC_DRAW,owner:i});n.instancesData=null;var E=d.getSizeInBytes(d.FLOAT),x=kt(e,i),u=0;a.aSideness=u++,s.push({name:"aSideness",index:a.aSideness,vertexBuffer:x,componentsPerAttribute:2,componentDatatype:d.FLOAT,offsetInBytes:0,strideInBytes:d.getSizeInBytes(d.FLOAT)*2,normalize:![]});var T=r||Y.RegularInstanceStride,f=0;a.aPosition0=u++,s.push({name:"aPosition0",index:a.aPosition0,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:d.FLOAT,normalize:![],offsetInBytes:E*f,strideInBytes:E*T,instanceDivisor:1}),f+=3,a.aPosition1=u++,s.push({name:"aPosition1",index:a.aPosition1,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:d.FLOAT,normalize:![],offsetInBytes:E*f,strideInBytes:E*T,instanceDivisor:1}),f+=3,a.aNormal=u++,s.push({name:"aNormal",index:a.aNormal,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:d.FLOAT,normalize:!![],offsetInBytes:E*f,strideInBytes:E*T,instanceDivisor:1}),f+=3,a.batchId=u++,s.push({name:"batchId",index:a.batchId,vertexBuffer:t,componentsPerAttribute:1,componentDatatype:d.FLOAT,normalize:!![],offsetInBytes:E*f,strideInBytes:E*T,instanceDivisor:1}),f+=1,a.aVariantStroke=u++,s.push({name:"aVariantStroke",index:a.aVariantStroke,vertexBuffer:t,componentsPerAttribute:1,componentDatatype:d.FLOAT,normalize:!![],offsetInBytes:E*f,strideInBytes:E*T,instanceDivisor:1}),f+=1,a.aVariantExtension=u++,s.push({name:"aVariantExtension",index:a.aVariantExtension,vertexBuffer:t,componentsPerAttribute:1,componentDatatype:d.FLOAT,normalize:!![],offsetInBytes:E*f,strideInBytes:E*T,instanceDivisor:1}),f+=1}},Y.createSilhouetteEdgeAttributes=function(e,n,r){if(!(!S(n.instancesData)||n.instancesData.length==0)){var i={},a=[];n.attributeLocations=i,n.attributes=a;var s=We.createVertexBuffer({context:e,typedArray:n.instancesData,usage:te.STATIC_DRAW,owner:r});n.instancesData=null;var t=d.getSizeInBytes(d.FLOAT),E=0;i.aSideness=E++,a.push({name:"aSideness",index:i.aSideness,vertexBuffer:kt(e,r),componentsPerAttribute:2,componentDatatype:d.FLOAT,offsetInBytes:0,strideInBytes:t*2,normalize:![]});var x=Y.SilhouetteInstanceStride,u=0;i.aPosition0=E++,a.push({name:"aPosition0",index:i.aPosition0,vertexBuffer:s,componentsPerAttribute:3,componentDatatype:d.FLOAT,normalize:![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=3,i.aPosition1=E++,a.push({name:"aPosition1",index:i.aPosition1,vertexBuffer:s,componentsPerAttribute:3,componentDatatype:d.FLOAT,normalize:![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=3,i.aNormalA=E++,a.push({name:"aNormalA",index:i.aNormalA,vertexBuffer:s,componentsPerAttribute:3,componentDatatype:d.FLOAT,normalize:!![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=3,i.aNormalB=E++,a.push({name:"aNormalB",index:i.aNormalB,vertexBuffer:s,componentsPerAttribute:3,componentDatatype:d.FLOAT,normalize:!![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=3,i.batchId=E++,a.push({name:"batchId",index:i.batchId,vertexBuffer:s,componentsPerAttribute:1,componentDatatype:d.FLOAT,normalize:!![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=1,i.aVariantStroke=E++,a.push({name:"aVariantStroke",index:i.aVariantStroke,vertexBuffer:s,componentsPerAttribute:1,componentDatatype:d.FLOAT,normalize:!![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=1,i.aVariantExtension=E++,a.push({name:"aVariantExtension",index:i.aVariantExtension,vertexBuffer:s,componentsPerAttribute:1,componentDatatype:d.FLOAT,normalize:!![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=1}};function $t(e,n){for(var r=n.componentsPerAttribute,i=e.vertCompressConstant,a=new p(e.minVerticesValue.x,e.minVerticesValue.y,e.minVerticesValue.z),s=new Uint16Array(n.typedArray.buffer,n.typedArray.byteOffset,n.typedArray.byteLength/2),t=new Float32Array(e.verticesCount*3),E,x,u,T=0;T<e.verticesCount;T++)E=s[r*T]*i+a.x,x=s[r*T+1]*i+a.y,u=s[r*T+2]*i+a.z,t[3*T]=E,t[3*T+1]=x,t[3*T+2]=u;return t}Y.extractEdgeInformation=function(e,n,r){var i=e.attrLocation.aPosition,a=e.vertexAttributes[i],s=S(e.nCompressOptions)&&(e.nCompressOptions&Ke.SVC_Vertex)===Ke.SVC_Vertex,t=a.componentsPerAttribute,E;s?(t=3,E=$t(e,a)):E=new Float32Array(a.typedArray.buffer,a.typedArray.byteOffset,a.typedArray.byteLength/4);var x=E.length/t;if(n&&r){var u=it.computeNeighbors(r,x);return{faces:r,neighbors:u,vertices:E,dim:t}}var T=a.typedArray.buffer,f;s?f=E.buffer:f=T.slice(a.typedArray.byteOffset,a.typedArray.byteOffset+a.typedArray.byteLength);var A=it.deduplicate(f,t),y=Y.selectIndexData(A.indices,r),R=it.computeNeighbors(y,A.uniqueCount),l=new Float32Array(A.buffer);return{faces:y,neighbors:R,vertices:l,dim:t}},Y.selectIndexData=function(e,n){if(n){n=n.slice();for(var r=0;r<n.length;r++)n[r]=e[n[r]];return n}return e};var O=new p,F=new p,Ue=new p,Ge=new p,G=new p,at=new p,Re=new p,qt=new p;Y.createEdgeDataByIndices=function(e,n){var r=e.attrLocation.aPosition,i=e.vertexAttributes[r],a=S(e.nCompressOptions)&&(e.nCompressOptions&Ke.SVC_Vertex)===Ke.SVC_Vertex,s=i.componentsPerAttribute,t;a?(s=3,t=$t(e,i)):t=new Float32Array(i.typedArray.buffer,i.typedArray.byteOffset,i.typedArray.byteLength/4);var E;n.indexType===0?E=new Uint16Array(n.indicesTypedArray.buffer,n.indicesTypedArray.byteOffset,n.indicesTypedArray.byteLength/2):E=new Uint32Array(n.indicesTypedArray.buffer,n.indicesTypedArray.byteOffset,n.indicesTypedArray.byteLength/4);for(var x=[],u=[],T=E.length,f=0,A=0,y=Math.floor(T/4)*4;A<y;A+=4){var R=E[A],l=E[A+1],v=E[A+2],I=E[A+3];if(O.x=t[s*R],O.y=t[s*R+1],O.z=t[s*R+2],F.x=t[s*l],F.y=t[s*l+1],F.z=t[s*l+2],Ue.x=t[s*v],Ue.y=t[s*v+1],Ue.z=t[s*v+2],Ge.x=t[s*I],Ge.y=t[s*I+1],Ge.z=t[s*I+2],!(p.equals(F,Ue)||p.equals(F,Ge)||p.equals(F,O)||p.equals(Ue,O)||p.equals(Ge,O))){if(v===I){if(p.subtract(F,O,G),p.subtract(Ue,O,at),p.cross(G,at,G),p.equals(G,p.ZERO))continue;p.normalize(G,G),x.push(O.x),x.push(O.y),x.push(O.z),x.push(F.x),x.push(F.y),x.push(F.z),x.push(G.x),x.push(G.y),x.push(G.z),x.push(R);var h=Qt(O,F),N=h.variantStroke,m=h.variantExtension;x.push(N),x.push(m)}else{if(p.subtract(F,O,G),p.subtract(Ue,O,at),p.cross(G,at,G),p.equals(G,p.ZERO)||(p.normalize(G,G),p.subtract(F,O,Re),p.subtract(Ge,O,qt),p.cross(qt,Re,Re),p.equals(Re,p.ZERO)))continue;p.normalize(Re,Re),u.push(O.x),u.push(O.y),u.push(O.z),u.push(F.x),u.push(F.y),u.push(F.z),u.push(G.x),u.push(G.y),u.push(G.z),u.push(Re.x),u.push(Re.y),u.push(Re.z),u.push(R);var h=Qt(O,F),N=h.variantStroke,m=h.variantExtension;u.push(N),u.push(m)}var U=p.distance(O,F);f+=U}}var L=T/4,D=f/L,k=x.length/Y.RegularInstanceStride,M=u.length/Y.SilhouetteInstanceStride;return{regular:{instancesData:new Float32Array(x),instanceCount:k,edgeLength:k*D},silhouette:{instancesData:new Float32Array(u),instanceCount:M,edgeLength:M},averageEdgeLength:D}};function Qt(e,n){function r(y,R){var l=new Float32Array(6),v=new Uint32Array(l.buffer),I=new Uint32Array(1);l[0]=y.x,l[1]=y.y,l[2]=y.z,l[3]=R.x,l[4]=R.y,l[5]=R.z,I[0]=5381;for(var h=0;h<v.length;h++)I[0]=31*I[0]+v[h];return I[0]}function i(y,R,l){l-=R;var v=48217*y%2147483647,I=v/2147483647,h=R+I*l;return{seed:v,result:Math.round(h)}}function a(y){var R=48217*y%2147483647,l=R/(2147483647-1);return{seed:R,result:l}}var s=r(e,n);!S(s)&&(s=Math.random()*2147483647);var t=i(s,0,255);s=t.seed;var E=t.result;t=i(s,0,5),s=t.seed;var x=t.result;t=a(s),s=t.seed;var u=t.result;u=-(1-Math.min(u/.7,1))+Math.max(0,u-.7)/(1-.7),u=255*(Math.abs(u)**1.2*(0>u?-1:1)*.5+.5);var T=E,f=x,A=u;return{variantStroke:f,variantExtension:A}}var ot=Y;function Mr(e,n,r,i,a,s){this.left=e,this.bottom=n,this.right=r,this.top=i,this.minHeight=a,this.maxHeight=s,this.width=r-e,this.length=i-n,this.height=s-a}var mi=new Ut;function Cr(e,n,r,i,a,s,t,E){var x=s.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var u=0,T={},f=T.vertexAttributes=[],A=T.attrLocation={};T.instanceCount=0,T.instanceMode=0;var y=0,R=s.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var l=s.getUint16(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var v=l;l>4&&(v=l>>8,l=l&15);var I=s.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var h=void 0,N=void 0;if(I>0){var m=s.getUint16(t,!0);m=l*Float32Array.BYTES_PER_ELEMENT,t+=Uint32Array.BYTES_PER_ELEMENT,u=I*m;var U=a.subarray(t,t+u);if(i||r){var L=new p,D=new p,k=new Float32Array(U.buffer,U.byteOffset,U.byteLength/4),M=new He;h=new He,N=new He;for(var q=4,H=new Float32Array(I*q),j=new Float64Array(I*2),g=0;g<I;g++)Lt.multiplyByPoint(n,p.fromElements(k[4*g],k[4*g+1],k[4*g+2],L),D),M=He.fromCartesian(D),j[2*g]=M.longitude,j[2*g+1]=M.latitude,g===0?(h.longitude=M.longitude,h.latitude=M.latitude,N.longitude=M.longitude,N.latitude=M.latitude):(h.longitude=Math.max(M.longitude,h.longitude),h.latitude=Math.max(M.latitude,h.latitude),N.longitude=Math.min(M.longitude,N.longitude),N.latitude=Math.min(M.latitude,N.latitude));for(var Be=r?h.longitude-N.longitude:1,ge=r?h.latitude-N.latitude:1,g=0;g<I;g++)H[4*g]=j[2*g]-N.longitude,H[4*g+1]=j[2*g+1]-N.latitude,H[4*g+2]=(j[2*g]-N.longitude)/Be,H[4*g+3]=(j[2*g+1]-N.latitude)/ge;A.aRelativeGeoCoord=y,f.push({index:A.aRelativeGeoCoord,typedArray:H,componentsPerAttribute:q,componentDatatype:d.FLOAT,offsetInBytes:0,strideInBytes:q*Float32Array.BYTES_PER_ELEMENT,normalize:!1}),y++}A.aPosition=y,f.push({index:A.aPosition,typedArray:U,componentsPerAttribute:l,componentDatatype:d.FLOAT,offsetInBytes:0,strideInBytes:m,normalize:!1}),y++,t+=u}var de=s.getUint32(t,!0);if(t+=Uint32Array.BYTES_PER_ELEMENT,de>0){var c=s.getUint16(t,!0);c=v*Float32Array.BYTES_PER_ELEMENT,t+=Uint32Array.BYTES_PER_ELEMENT,u=de*c;let Ne=new Float32Array(a.buffer,t,3),st=Ne[0]===0&&Ne[1]===0&&Ne[2]===0;!e.ignoreNormal&&!st&&(A.aNormal=y,f.push({index:A.aNormal,typedArray:a.subarray(t,t+u),componentsPerAttribute:v,componentDatatype:d.FLOAT,offsetInBytes:0,strideInBytes:c,normalize:!1}),y++),t+=u}var re=s.getUint32(t,!0);if(t+=Uint32Array.BYTES_PER_ELEMENT,re>0){var Q=new Uint8Array(4*re);E.push(Q.buffer);var ne=s.getUint32(t,!0);ne=4*Float32Array.BYTES_PER_ELEMENT,t+=Uint32Array.BYTES_PER_ELEMENT,u=re*ne;for(var ee=new Float32Array(a.buffer,t,I*4),W=0;W<I;W++)Q[4*W]=ee[4*W]*255,Q[4*W+1]=ee[4*W+1]*255,Q[4*W+2]=ee[4*W+2]*255,Q[4*W+3]=ee[4*W+3]*255;t+=u,A.aColor=y,f.push({index:A.aColor,typedArray:Q,componentsPerAttribute:4,componentDatatype:d.UNSIGNED_BYTE,offsetInBytes:0,strideInBytes:4,normalize:!0}),y++}var B=s.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT,B>0&&(u=B*16,t+=u);var we=s.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;for(var Pe=-1,ie,Ie,$,Ee=0;Ee<we;Ee++){ie=s.getUint32(t,!0),t+=Uint32Array.BYTES_PER_ELEMENT,$=s.getUint16(t,!0),t+=Uint16Array.BYTES_PER_ELEMENT,Ie=s.getUint16(t,!0),t+=Uint16Array.BYTES_PER_ELEMENT,u=ie*$*Float32Array.BYTES_PER_ELEMENT;var z=a.subarray(t,t+u);if(Pe==-1&&($==20||$==35)){Pe=Ee,T.instanceCount=ie,T.instanceMode=$,T.instanceBuffer=z;var ue=$*ie,w;$===20?(w=Float32Array.BYTES_PER_ELEMENT*20,A.uv2=y++,f.push({index:A.uv2,componentsPerAttribute:4,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:w,instanceDivisor:1}),A.uv3=y++,f.push({index:A.uv3,componentsPerAttribute:4,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv4=y++,f.push({index:A.uv4,componentsPerAttribute:4,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.secondary_colour=y++,f.push({index:A.secondary_colour,componentsPerAttribute:4,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv6=y++,f.push({index:A.uv6,componentsPerAttribute:4,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1})):$===35&&(w=Float32Array.BYTES_PER_ELEMENT*35,A.uv1=y++,f.push({index:A.uv1,componentsPerAttribute:4,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:w,instanceDivisor:1,byteLength:u}),A.uv2=y++,f.push({index:A.uv2,componentsPerAttribute:4,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv3=y++,f.push({index:A.uv3,componentsPerAttribute:4,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv4=y++,f.push({index:A.uv4,componentsPerAttribute:4,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv5=y++,f.push({index:A.uv5,componentsPerAttribute:4,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv6=y++,f.push({index:A.uv6,componentsPerAttribute:4,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:20*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv7=y++,f.push({index:A.uv7,componentsPerAttribute:3,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:24*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.secondary_colour=y++,f.push({index:A.secondary_colour,componentsPerAttribute:4,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:27*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv9=y++,f.push({index:A.uv9,componentsPerAttribute:4,componentDatatype:d.FLOAT,normalize:!1,offsetInBytes:31*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}))}else if(Pe!==-1)T.instanceBounds=new Float32Array(a.buffer,t,ie*$);else{var ke="aTexCoord"+Ee;A[ke]=y++,f.push({index:A[ke],typedArray:z,componentsPerAttribute:$,componentDatatype:d.FLOAT,offsetInBytes:0,strideInBytes:$*Float32Array.BYTES_PER_ELEMENT,normalize:!1})}t+=u}T.verticesCount=I,T.instanceIndex=Pe;var Z=s.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;for(var fe=[],Ee=0;Ee<Z;Ee++){var V={},Se=s.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var Te=s.getUint8(t,!0);t+=Uint8Array.BYTES_PER_ELEMENT;var Ae=s.getUint8(t,!0);t+=Uint8Array.BYTES_PER_ELEMENT;var xe=s.getUint8(t,!0);t+=Uint8Array.BYTES_PER_ELEMENT,t+=1,V.indicesCount=Se,V.indexType=Te,V.primitiveType=xe;var ae=t;Se>0&&(Te==0?(u=Se*Uint16Array.BYTES_PER_ELEMENT,t+=u,Se%2==1&&(t+=2)):(u=Se*4,t+=u)),V.indicesTypedArray=a.subarray(ae,ae+u);var ze=s.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var ye=s.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT*ze,V.materialCode=ye,fe.push(V)}var pe;fe.length===2&&fe[1].primitiveType===13&&fe[1].indicesCount>=3&&(pe=ot.createEdgeDataByIndices(T,fe[1],E));let qe;return h!==void 0&&N!==void 0&&(qe={max:h,min:N}),e[x]={vertexPackage:T,arrIndexPackage:fe,edgeGeometry:pe,cartographicBounds:qe},t}function Zt(e,n,r){var i=e.vertexAttributes,a=e.attrLocation,s=i.length,t=r===1?"instanceId":"batchId";a[t]=s,i.push({index:s,typedArray:n,componentsPerAttribute:1,componentDatatype:d.FLOAT,offsetInBytes:0,strideInBytes:0,instanceDivisor:r})}function Fr(e,n){var r=e.buffer,i=e.supportCompressType,a=e.bVolume,s=null,t=null,E=null,x=e.isCoverImageryLayer,u=e.coveredMap,T=e.modelMatrix;if(a&&e.volbuffer.byteLength<8&&(a=!1),a){var f=e.volbuffer,ne=new Uint8Array(f,8),A=At.inflate(ne).buffer,y=new Float64Array(A,0,1),R=new Uint32Array(A,48,1);if(y[0]===0||R[0]===3200||R[0]===3201){var l=0;y[0]===0&&(l=8),n.push(A);var v=new Float64Array(A,l,6),I=v[0],h=v[1],N=v[2],m=v[3],U=v[4]<v[5]?v[4]:v[5],L=v[4]>v[5]?v[4]:v[5];s=new Mr(I,m,N,h,U,L),t={left:I,top:h,right:N,bottom:m,minHeight:U,maxHeight:L,width:s.width,length:s.length,height:s.height};var D=new Uint32Array(A,48+l,7),k=D[0],M=D[1],q=D[2],H=D[3],j=D[4],g=D[5],Be=D[6],ge=H*H*4,de=new Uint8Array(A,76+l,ge);E={nFormat:k,nSideBlockCount:M,nBlockLength:q,nLength:H,nWidth:j,nHeight:g,nDepth:Be,imageArray:de}}}var c=0,re=new Uint8Array(r,0,4);if(re[0]!==115||re[1]!==51||re[2]!==109)return{result:!1};var Q=re[3],ne=new Uint8Array(r,4),ee=At.inflate(ne).buffer,W=new Uint8Array(ee);n.push(W.buffer);var B=new DataView(ee),we=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var Pe=new Uint8Array(ee,c,we),ie=we%4;ie&&(ie=4-ie),c+=we+ie;var Ie=Bt(Pe,void 0,void 0,"gbk");Ie=Ie.replace(new RegExp(`\r
`,"gm"),""),Ie=Ie.replace(new RegExp(":","gm"),"");var $=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var Ee=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var z={};z.ignoreNormal=e.ignoreNormal;for(var ue=0;ue<Ee;ue++)c=Cr(z,T,u,x,W,B,c,n);var w=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var ke=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;for(var ue=0;ue<ke;ue++){var Z=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var fe=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var V={},Se=z[Z].vertexPackage.instanceIndex,$e=z[Z].edgeGeometry;if(Se==-1){for(var Te=new Float32Array(z[Z].vertexPackage.verticesCount),Ae=0;Ae<fe;Ae++){var xe=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var ae=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var ze=0,ye=0;V[xe]={batchId:Ae};for(var pe=0;pe<ae;pe++)if(ye=B.getUint32(c,!0),c+=Uint32Array.BYTES_PER_ELEMENT,ze=B.getUint32(c,!0),c+=Uint32Array.BYTES_PER_ELEMENT,Te.fill)Te.fill(Ae,ye,ye+ze);else for(var qe=ye+ye,Ne=ye;Ne<qe;Ne++)Te[Ne]=Ae;V[xe].vertexColorOffset=ye,V[xe].vertexColorCount=ze}Zt(z[Z].vertexPackage,Te,void 0)}else{for(var st=z[Z].vertexPackage.instanceCount,Gr=z[Z].vertexPackage.instanceBuffer,wr=z[Z].vertexPackage.instanceMode,It=new Float32Array(st),Qe=0,Ae=0;Ae<fe;Ae++){var xe=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var ae=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;for(var pe=0;pe<ae;pe++){var Jt=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT,It[Qe]=Qe,V[xe]===void 0&&(V[xe]={vertexColorCount:1,instanceIds:[],vertexColorOffset:Qe}),V[xe].instanceIds.push(Jt),Qe++}}Zt(z[Z].vertexPackage,It,1)}z[Z].pickInfo=V;var $e=z[Z].edgeGeometry;if(S($e)){var Ze=$e.regular.instancesData,Et=ot.RegularInstanceStride,oe,Je;if(S(Ze))for(Je=Ze.length,oe=0;oe<Je;oe+=Et){var ut=Ze[oe+9];Ze[oe+9]=Te[ut]}var je=$e.silhouette.instancesData;if(Et=ot.SilhouetteInstanceStride,S(je))for(Je=je.length,oe=0;oe<Je;oe+=Et){var ut=je[oe+12];je[oe+12]=Te[ut]}}}var zr=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var jt=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;for(var St={},ue=0;ue<jt;ue++){var Nt=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var Ye=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var Xe=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var ft=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var ae=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var et=B.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var De=null;if(ft===Ct.enrS3TCDXTN&&i!==1){var Tt=null;et>Oe.BGR||et===Oe.LUMINANCE_ALPHA?(Tt=new Uint8Array(ee,c,Ye*Xe),De=new Uint8Array(Ye*Xe*4)):(Tt=new Uint16Array(ee,c,ae/2),De=new Uint16Array(Ye*Xe)),Mt.decode(De,Ye,Xe,Tt,et),n.push(De.buffer),ft=0}else De=new Uint8Array(ee,c,ae);St[Nt]={id:Nt,width:Ye,height:Xe,compressType:ft,nFormat:et,imageBuffer:De},c+=ae}return{result:!0,version:Q,xmlDoc:Ie,geoPackage:z,texturePackage:St,volImageBuffer:E,volBounds:t}}var Ui=mt(Fr);export{Ui as default};
