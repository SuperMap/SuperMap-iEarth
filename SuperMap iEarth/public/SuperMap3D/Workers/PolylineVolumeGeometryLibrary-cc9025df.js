define(["exports","./Cartesian2-59a54ee7","./Cartographic-81e9e8b2","./Cartesian4-a56bd360","./EllipsoidTangentPlane-ee91c10e","./Math-5e067eb3","./FeatureDetection-2d4141ff","./PolylinePipeline-0d72c6c0","./GeometryAttribute-9b3921a3"],(function(o,e,r,a,n,t,l,i,c){"use strict";var s=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),u=[new r.o,new r.o],p=new r.o,m=new r.o,y=new r.o,d=new r.o,f=new r.o,g=new r.o,v=new r.o,h=new r.o,w=new r.o,B=new r.o,E=new r.o,z={},S=new r.a;function A(o,e){for(var r=new Array(o.length),a=0;a<o.length;a++){var n=o[a];S=e.cartesianToCartographic(n,S),r[a]=S.height,o[a]=e.scaleToGeodeticSurface(n,n)}return r}function P(o,e,a,n){var t,l=o[0],i=o[1],c=r.o.angleBetween(l,i),s=Math.ceil(c/n),u=new Array(s);if(e===a){for(t=0;t<s;t++)u[t]=e;return u.push(a),u}var p=(a-e)/s;for(t=1;t<s;t++){var m=e+t*p;u[t]=m}return u[0]=e,u.push(a),u}var T=new r.o,b=new r.o;function D(o,a,t,l){var i=new n.f(t,l),c=i.projectPointOntoPlane(r.o.add(t,o,T),T),s=i.projectPointOntoPlane(r.o.add(t,a,b),b),u=e.o.angleBetween(c,s);return s.x*c.y-s.y*c.x>=0?-u:u}var x=new r.o(-1,0,0),N=l.p.clone(l.p.IDENTITY),O=new l.p,R=new l.p$1,V=l.p$1.IDENTITY.clone(),F=new r.o,I=new a.e,$=new r.o;function L(o,e,a,n,t,i,s,u){var p=F,m=I;N=c.m.eastNorthUpToFixedFrame(o,t,N),p=l.p.multiplyByPointAsVector(N,x,p);var y=D(p=r.o.normalize(p,p),e,o,t);R=l.p$1.fromRotationZ(y,R),$.z=i,N=l.p.multiplyTransformation(N,l.p.fromRotationTranslation(R,$,O),N);var d=V;d[0]=s;for(var f=0;f<u;f++)for(var g=0;g<a.length;g+=3)m=r.o.fromArray(a,g,m),m=l.p$1.multiplyByVector(d,m,m),m=l.p.multiplyByPoint(N,m,m),n.push(m.x,m.y,m.z);return n}function G(o,e,a,n,t,i,s,u,p){var m=F,y=I;N=c.m.eastNorthUpToFixedFrame(o,t,N),m=l.p.multiplyByPointAsVector(N,x,m);var d=D(m=r.o.normalize(m,m),e,o,t);R=l.p$1.fromRotationZ(d,R),$.z=i,N=l.p.multiplyTransformation(N,l.p.fromRotationTranslation(R,$,O),N);var f=V;f[0]=s;for(var g=0;g<u;g++)for(var v=0;v<a.length;v+=3)y=r.o.fromArray(a,v,y),y=l.p$1.multiplyByVector(f,y,y),y=l.p.multiplyByPoint(N,y,y),y=l.p.multiplyByPoint(p,y,y),n.push(y.x,y.y,y.z);return n}var M=new r.o;function U(o,e,a,n,t,l,i){for(var c=0;c<o.length;c+=3){n=L(r.o.fromArray(o,c,M),e,a,n,t,l[c/3],i,1)}return n}function _(o,e){var r=o.length,a=new Array(6*r),n=0,t=e.x+e.width/2,l=e.y+e.height/2,i=o[0];a[n++]=i.x-t,a[n++]=0,a[n++]=i.y-l;for(var c=1;c<r;c++){var s=(i=o[c]).x-t,u=i.y-l;a[n++]=s,a[n++]=0,a[n++]=u,a[n++]=s,a[n++]=0,a[n++]=u}return i=o[0],a[n++]=i.x-t,a[n++]=0,a[n++]=i.y-l,a}function j(o,e){for(var r=o.length,a=new Array(3*r),n=0,t=e.x+e.width/2,l=e.y+e.height/2,i=0;i<r;i++)a[n++]=o[i].x-t,a[n++]=0,a[n++]=o[i].y-l;return a}var C=new c.n,q=new r.o,Q=new l.p$1;function Y(o,e,a,n,i,u,p,m,y,d){var f,g,v=r.o.angleBetween(r.o.subtract(e,o,B),r.o.subtract(a,o,E)),h=n===s.BEVELED?0:Math.ceil(v/t.e.toRadians(5));if(f=i?l.p$1.fromQuaternion(c.n.fromAxisAngle(r.o.negate(o,B),v/(h+1),C),Q):l.p$1.fromQuaternion(c.n.fromAxisAngle(o,v/(h+1),C),Q),e=r.o.clone(e,q),h>0)for(var w=d?2:1,z=0;z<h;z++)e=l.p$1.multiplyByVector(f,e,e),g=r.o.subtract(e,o,B),g=r.o.normalize(g,g),i||(g=r.o.negate(g,g)),p=L(u.scaleToGeodeticSurface(e,E),g,m,p,u,y,1,w);else g=r.o.subtract(e,o,B),g=r.o.normalize(g,g),i||(g=r.o.negate(g,g)),p=L(u.scaleToGeodeticSurface(e,E),g,m,p,u,y,1,1),a=r.o.clone(a,q),g=r.o.subtract(a,o,B),g=r.o.normalize(g,g),i||(g=r.o.negate(g,g)),p=L(u.scaleToGeodeticSurface(a,E),g,m,p,u,y,1,1);return p}z.removeDuplicatesFromShape=function(o){for(var r=o.length,a=[],n=r-1,t=0;t<r;n=t++){var l=o[n],i=o[t];e.o.equals(l,i)||a.push(i)}return a},z.angleIsGreaterThanPi=function(o,e,a,t){var l=new n.f(a,t),i=l.projectPointOntoPlane(r.o.add(a,o,T),T),c=l.projectPointOntoPlane(r.o.add(a,e,b),b);return c.x*i.y-c.y*i.x>=0};var Z=new r.o,J=new r.o;z.computePositions=function(o,e,a,n,l){var c=n._ellipsoid,E=A(o,c),S=n._granularity,T=n._cornerType,b=l?_(e,a):j(e,a),D=l?j(e,a):void 0,x=a.height/2,N=a.width/2,O=o.length,R=[],V=l?[]:void 0,F=p,I=m,$=y,G=d,M=f,C=g,q=v,Q=h,k=w,H=o[0],K=o[1];G=c.geodeticSurfaceNormal(H,G),F=r.o.subtract(K,H,F),F=r.o.normalize(F,F),Q=r.o.cross(G,F,Q),Q=r.o.normalize(Q,Q);var W=E[0],X=E[1];l&&(V=L(H,Q,D,V,c,W+x,1,1)),k=r.o.clone(H,k),H=K,I=r.o.negate(F,I);for(var oo,eo=1;eo<O-1;eo++){var ro=l?2:1;K=o[eo+1],F=r.o.subtract(K,H,F),F=r.o.normalize(F,F),$=r.o.add(F,I,$),$=r.o.normalize($,$),G=c.geodeticSurfaceNormal(H,G);var ao=r.o.multiplyByScalar(G,r.o.dot(F,G),Z);r.o.subtract(F,ao,ao),r.o.normalize(ao,ao);var no=r.o.multiplyByScalar(G,r.o.dot(I,G),J);if(r.o.subtract(I,no,no),r.o.normalize(no,no),!t.e.equalsEpsilon(Math.abs(r.o.dot(ao,no)),1,t.e.EPSILON7)){$=r.o.cross($,G,$),$=r.o.cross(G,$,$),$=r.o.normalize($,$);var to=1/Math.max(.25,r.o.magnitude(r.o.cross($,I,B))),lo=z.angleIsGreaterThanPi(F,I,H,c);lo?(M=r.o.add(H,r.o.multiplyByScalar($,to*N,$),M),C=r.o.add(M,r.o.multiplyByScalar(Q,N,C),C),u[0]=r.o.clone(k,u[0]),u[1]=r.o.clone(C,u[1]),oo=P(u,W+x,X+x,S),R=U(i.m.generateArc({positions:u,granularity:S,ellipsoid:c}),Q,b,R,c,oo,1),Q=r.o.cross(G,F,Q),Q=r.o.normalize(Q,Q),q=r.o.add(M,r.o.multiplyByScalar(Q,N,q),q),T===s.ROUNDED||T===s.BEVELED?Y(M,C,q,T,lo,c,R,b,X+x,l):R=L(H,$=r.o.negate($,$),b,R,c,X+x,to,ro),k=r.o.clone(q,k)):(M=r.o.add(H,r.o.multiplyByScalar($,to*N,$),M),C=r.o.add(M,r.o.multiplyByScalar(Q,-N,C),C),u[0]=r.o.clone(k,u[0]),u[1]=r.o.clone(C,u[1]),oo=P(u,W+x,X+x,S),R=U(i.m.generateArc({positions:u,granularity:S,ellipsoid:c}),Q,b,R,c,oo,1),Q=r.o.cross(G,F,Q),Q=r.o.normalize(Q,Q),q=r.o.add(M,r.o.multiplyByScalar(Q,-N,q),q),T===s.ROUNDED||T===s.BEVELED?Y(M,C,q,T,lo,c,R,b,X+x,l):R=L(H,$,b,R,c,X+x,to,ro),k=r.o.clone(q,k)),I=r.o.negate(F,I)}else R=L(k,Q,b,R,c,W+x,1,1),k=H;W=X,X=E[eo+1],H=K}u[0]=r.o.clone(k,u[0]),u[1]=r.o.clone(H,u[1]),oo=P(u,W+x,X+x,S),R=U(i.m.generateArc({positions:u,granularity:S,ellipsoid:c}),Q,b,R,c,oo,1),l&&(V=L(H,Q,D,V,c,X+x,1,1)),O=R.length;var io=l?O+V.length:O,co=new Float64Array(io);return co.set(R),l&&co.set(V,O),co},z.computeLocalPositions=function(o,e,a,n,E,S){var T=n._ellipsoid,b=A(o,T),D=n._granularity,x=n._cornerType,N=E?_(e,a):j(e,a),O=E?j(e,a):void 0,R=a.width/2,V=o.length,F=[],I=E?[]:void 0,$=p,L=m,C=y,q=d,Q=f,k=g,H=v,K=h,W=w,X=c.m.eastNorthUpToFixedFrame(S,T,new l.p),oo=l.p.inverse(X,new l.p),eo=o[0],ro=o[1];q=T.geodeticSurfaceNormal(eo,q),$=r.o.subtract(ro,eo,$),$=r.o.normalize($,$),K=r.o.cross(q,$,K),K=r.o.normalize(K,K);var ao=b[0],no=b[1];E&&(I=G(eo,K,O,I,T,ao+0,1,1,oo)),W=r.o.clone(eo,W),eo=ro,L=r.o.negate($,L);for(var to,lo=1;lo<V-1;lo++){var io=E?2:1;ro=o[lo+1],$=r.o.subtract(ro,eo,$),$=r.o.normalize($,$),C=r.o.add($,L,C),C=r.o.normalize(C,C),q=T.geodeticSurfaceNormal(eo,q);var co=r.o.multiplyByScalar(q,r.o.dot($,q),Z);r.o.subtract($,co,co),r.o.normalize(co,co);var so=r.o.multiplyByScalar(q,r.o.dot(L,q),J);if(r.o.subtract(L,so,so),r.o.normalize(so,so),!t.e.equalsEpsilon(Math.abs(r.o.dot(co,so)),1,t.e.EPSILON7)){C=r.o.cross(C,q,C),C=r.o.cross(q,C,C),C=r.o.normalize(C,C);var uo=1/Math.max(.25,r.o.magnitude(r.o.cross(C,L,B))),po=z.angleIsGreaterThanPi($,L,eo,T);po?(Q=r.o.add(eo,r.o.multiplyByScalar(C,uo*R,C),Q),k=r.o.add(Q,r.o.multiplyByScalar(K,R,k),k),u[0]=r.o.clone(W,u[0]),u[1]=r.o.clone(k,u[1]),to=P(u,ao+0,no+0,D),F=U(i.m.generateArc({positions:u,granularity:D,ellipsoid:T}),K,N,F,T,to,1,fromEnu),K=r.o.cross(q,$,K),K=r.o.normalize(K,K),H=r.o.add(Q,r.o.multiplyByScalar(K,R,H),H),x===s.ROUNDED||x===s.BEVELED?Y(Q,k,H,x,po,T,F,N,no+0,E):F=G(eo,C=r.o.negate(C,C),N,F,T,no+0,uo,io,oo),W=r.o.clone(H,W)):(Q=r.o.add(eo,r.o.multiplyByScalar(C,uo*R,C),Q),k=r.o.add(Q,r.o.multiplyByScalar(K,-R,k),k),u[0]=r.o.clone(W,u[0]),u[1]=r.o.clone(k,u[1]),to=P(u,ao+0,no+0,D),F=U(i.m.generateArc({positions:u,granularity:D,ellipsoid:T}),K,N,F,T,to,1),K=r.o.cross(q,$,K),K=r.o.normalize(K,K),H=r.o.add(Q,r.o.multiplyByScalar(K,-R,H),H),x===s.ROUNDED||x===s.BEVELED?Y(Q,k,H,x,po,T,F,N,no+0,E):F=G(eo,C,N,F,T,no+0,uo,io,oo),W=r.o.clone(H,W)),L=r.o.negate($,L)}else F=G(W,K,N,F,T,ao+0,1,1,oo),W=eo;ao=no,no=b[lo+1],eo=ro}u[0]=r.o.clone(W,u[0]),u[1]=r.o.clone(eo,u[1]),to=P(u,ao+0,no+0,D),F=function(o,e,a,n,t,l,i,c){for(var s=0;s<o.length;s+=3)n=G(r.o.fromArray(o,s,M),e,a,n,t,l[s/3],i,1,c);return n}(i.m.generateArc({positions:u,granularity:D,ellipsoid:T}),K,N,F,T,to,1,oo),E&&(I=G(eo,K,O,I,T,no+0,1,1,oo)),V=F.length;var mo=E?V+I.length:V,yo=new Float64Array(mo);return yo.set(F),E&&yo.set(I,V),yo},o.J=z,o.S=s}));
