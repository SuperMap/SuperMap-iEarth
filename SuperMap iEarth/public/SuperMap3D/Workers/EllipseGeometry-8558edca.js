define(["exports","./arrayFill-c1a6b724","./buildModuleUrl-36ce0ebc","./Ellipsoid-ca2b8eb1","./Cartesian3-c1138337","./Cartographic-630e5de6","./Check-92c551fb","./ComponentDatatype-3cfb1146","./defaultValue-2110bb17","./EllipseGeometryLibrary-4d09d930","./GeometryAttribute-b12ab6bd","./GeometryAttributes-3cad3ff9","./GeometryInstance-8a74a36b","./GeometryOffsetAttribute-da5a1d35","./GeometryPipeline-7f49beb8","./IndexDatatype-d833345d","./Math-cd1437d9","./FeatureDetection-e7fb956a","./PrimitiveType-d9ba7368","./Rectangle-52f780a9","./VertexFormat-295b1d1f"],(function(e,t,o,r,n,i,a,s,u,m,l,p,c,d,y,f,h,A,x,g,_){"use strict";var v=new n.o,b=new n.o,w=new n.o,I=new n.o,T=new r.o,N=new A.p,M=new A.p,E=new l.n,P=new n.o,D=new n.o,F=new n.o,O=new i.a,S=new n.o,C=new r.o,R=new r.o;function L(e,i,a){var c=i.vertexFormat,y=i.center,f=i.semiMajorAxis,h=i.semiMinorAxis,x=i.ellipsoid,g=i.stRotation,_=a?e.length/3*2:e.length/3,I=i.shadowVolume,L=c.st?new Float32Array(2*_):void 0,j=c.normal?new Float32Array(3*_):void 0,z=c.tangent?new Float32Array(3*_):void 0,V=c.bitangent?new Float32Array(3*_):void 0,G=I?new Float32Array(3*_):void 0,k=0,Y=P,B=D,H=F,U=new o.n(x),W=U.project(x.cartesianToCartographic(y,O),S),q=x.scaleToGeodeticSurface(y,v);x.geodeticSurfaceNormal(q,q);var Q=N,J=M;if(0!==g){var Z=l.n.fromAxisAngle(q,g,E);Q=A.p.fromQuaternion(Z,Q),Z=l.n.fromAxisAngle(q,-g,E),J=A.p.fromQuaternion(Z,J)}else Q=A.p.clone(A.p.IDENTITY,Q),J=A.p.clone(A.p.IDENTITY,J);for(var K=r.o.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,C),X=r.o.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,R),$=e.length,ee=a?$:0,te=ee/3*2,oe=0;oe<$;oe+=3){var re=oe+1,ne=oe+2,ie=n.o.fromArray(e,oe,v);if(c.st){var ae=A.p.multiplyByVector(Q,ie,b),se=U.project(x.cartesianToCartographic(ae,O),w);n.o.subtract(se,W,se),T.x=(se.x+f)/(2*f),T.y=(se.y+h)/(2*h),K.x=Math.min(T.x,K.x),K.y=Math.min(T.y,K.y),X.x=Math.max(T.x,X.x),X.y=Math.max(T.y,X.y),a&&(L[k+te]=T.x,L[k+1+te]=T.y),L[k++]=T.x,L[k++]=T.y}(c.normal||c.tangent||c.bitangent||I)&&(Y=x.geodeticSurfaceNormal(ie,Y),I&&(G[oe+ee]=-Y.x,G[re+ee]=-Y.y,G[ne+ee]=-Y.z),(c.normal||c.tangent||c.bitangent)&&((c.tangent||c.bitangent)&&(B=n.o.normalize(n.o.cross(n.o.UNIT_Z,Y,B),B),A.p.multiplyByVector(J,B,B)),c.normal&&(j[oe]=Y.x,j[re]=Y.y,j[ne]=Y.z,a&&(j[oe+ee]=-Y.x,j[re+ee]=-Y.y,j[ne+ee]=-Y.z)),c.tangent&&(z[oe]=B.x,z[re]=B.y,z[ne]=B.z,a&&(z[oe+ee]=-B.x,z[re+ee]=-B.y,z[ne+ee]=-B.z)),c.bitangent&&(H=n.o.normalize(n.o.cross(Y,B,H),H),V[oe]=H.x,V[re]=H.y,V[ne]=H.z,a&&(V[oe+ee]=H.x,V[re+ee]=H.y,V[ne+ee]=H.z))))}if(c.st){$=L.length;for(var ue=0;ue<$;ue+=2)L[ue]=(L[ue]-K.x)/(X.x-K.x),L[ue+1]=(L[ue+1]-K.y)/(X.y-K.y)}var me=new p.a;if(c.position){var le=m.C.raisePositionsToHeight(e,i,a);me.position=new l.o({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:le})}if(c.st&&(me.st=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:L})),c.normal&&(me.normal=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j})),c.tangent&&(me.tangent=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z})),c.bitangent&&(me.bitangent=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:V})),I&&(me.extrudeDirection=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),a&&u.e(i.offsetAttribute)){var pe=new Uint8Array(_);if(i.offsetAttribute===d.z.TOP)pe=t.d(pe,1,0,_/2);else{var ce=i.offsetAttribute===d.z.NONE?0:1;pe=t.d(pe,ce)}me.applyOffset=new l.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:pe})}return me}function j(e){var t,o,r,n,i,a=new Array(e*(e+1)*12-6),s=0;for(t=0,r=1,n=0;n<3;n++)a[s++]=r++,a[s++]=t,a[s++]=r;for(n=2;n<e+1;++n){for(r=n*(n+1)-1,t=(n-1)*n-1,a[s++]=r++,a[s++]=t,a[s++]=r,o=2*n,i=0;i<o-1;++i)a[s++]=r,a[s++]=t++,a[s++]=t,a[s++]=r++,a[s++]=t,a[s++]=r;a[s++]=r++,a[s++]=t,a[s++]=r}for(o=2*e,++r,++t,n=0;n<o-1;++n)a[s++]=r,a[s++]=t++,a[s++]=t,a[s++]=r++,a[s++]=t,a[s++]=r;for(a[s++]=r,a[s++]=t++,a[s++]=t,a[s++]=r++,a[s++]=t++,a[s++]=t,++t,n=e-1;n>1;--n){for(a[s++]=t++,a[s++]=t,a[s++]=r,o=2*n,i=0;i<o-1;++i)a[s++]=r,a[s++]=t++,a[s++]=t,a[s++]=r++,a[s++]=t,a[s++]=r;a[s++]=t++,a[s++]=t++,a[s++]=r++}for(n=0;n<3;n++)a[s++]=t++,a[s++]=t,a[s++]=r;return a}var z=new n.o;var V=new o.i,G=new o.i;function k(e){var i=e.center,a=e.ellipsoid,h=e.semiMajorAxis,g=n.o.multiplyByScalar(a.geodeticSurfaceNormal(i,v),e.height,v);V.center=n.o.add(i,g,V.center),V.radius=h,g=n.o.multiplyByScalar(a.geodeticSurfaceNormal(i,g),e.extrudedHeight,g),G.center=n.o.add(i,g,G.center),G.radius=h;var _=m.C.computeEllipsePositions(e,!0,!0),M=_.positions,z=_.numPts,k=_.outerPositions,Y=o.i.union(V,G),B=L(M,e,!0),H=j(z),U=H.length;H.length=2*U;for(var W=M.length/3,q=0;q<U;q+=3)H[q+U]=H[q+2]+W,H[q+1+U]=H[q+1]+W,H[q+2+U]=H[q]+W;var Q=f.IndexDatatype.createTypedArray(2*W/3,H),J=new l.I({attributes:B,indices:Q,primitiveType:x._0xa706e5.TRIANGLES}),Z=function(e,i){var a=i.vertexFormat,m=i.center,c=i.semiMajorAxis,y=i.semiMinorAxis,f=i.ellipsoid,h=i.height,x=i.extrudedHeight,g=i.stRotation,_=e.length/3*2,M=new Float64Array(3*_),L=a.st?new Float32Array(2*_):void 0,j=a.normal?new Float32Array(3*_):void 0,z=a.tangent?new Float32Array(3*_):void 0,V=a.bitangent?new Float32Array(3*_):void 0,G=i.shadowVolume,k=G?new Float32Array(3*_):void 0,Y=0,B=P,H=D,U=F,W=new o.n(f),q=W.project(f.cartesianToCartographic(m,O),S),Q=f.scaleToGeodeticSurface(m,v);f.geodeticSurfaceNormal(Q,Q);for(var J=l.n.fromAxisAngle(Q,g,E),Z=A.p.fromQuaternion(J,N),K=r.o.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,C),X=r.o.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,R),$=e.length,ee=$/3*2,te=0;te<$;te+=3){var oe,re=te+1,ne=te+2,ie=n.o.fromArray(e,te,v);if(a.st){var ae=A.p.multiplyByVector(Z,ie,b),se=W.project(f.cartesianToCartographic(ae,O),w);n.o.subtract(se,q,se),T.x=(se.x+c)/(2*c),T.y=(se.y+y)/(2*y),K.x=Math.min(T.x,K.x),K.y=Math.min(T.y,K.y),X.x=Math.max(T.x,X.x),X.y=Math.max(T.y,X.y),L[Y+ee]=T.x,L[Y+1+ee]=T.y,L[Y++]=T.x,L[Y++]=T.y}ie=f.scaleToGeodeticSurface(ie,ie),oe=n.o.clone(ie,b),B=f.geodeticSurfaceNormal(ie,B),G&&(k[te+$]=-B.x,k[re+$]=-B.y,k[ne+$]=-B.z);var ue=n.o.multiplyByScalar(B,h,I);if(ie=n.o.add(ie,ue,ie),ue=n.o.multiplyByScalar(B,x,ue),oe=n.o.add(oe,ue,oe),a.position&&(M[te+$]=oe.x,M[re+$]=oe.y,M[ne+$]=oe.z,M[te]=ie.x,M[re]=ie.y,M[ne]=ie.z),a.normal||a.tangent||a.bitangent){U=n.o.clone(B,U);var me=n.o.fromArray(e,(te+3)%$,I);n.o.subtract(me,ie,me);var le=n.o.subtract(oe,ie,w);B=n.o.normalize(n.o.cross(le,me,B),B),a.normal&&(j[te]=B.x,j[re]=B.y,j[ne]=B.z,j[te+$]=B.x,j[re+$]=B.y,j[ne+$]=B.z),a.tangent&&(H=n.o.normalize(n.o.cross(U,B,H),H),z[te]=H.x,z[re]=H.y,z[ne]=H.z,z[te+$]=H.x,z[te+1+$]=H.y,z[te+2+$]=H.z),a.bitangent&&(V[te]=U.x,V[re]=U.y,V[ne]=U.z,V[te+$]=U.x,V[re+$]=U.y,V[ne+$]=U.z)}}if(a.st){$=L.length;for(var pe=0;pe<$;pe+=2)L[pe]=(L[pe]-K.x)/(X.x-K.x),L[pe+1]=(L[pe+1]-K.y)/(X.y-K.y)}var ce=new p.a;if(a.position&&(ce.position=new l.o({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:M})),a.st&&(ce.st=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:L})),a.normal&&(ce.normal=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j})),a.tangent&&(ce.tangent=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z})),a.bitangent&&(ce.bitangent=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:V})),G&&(ce.extrudeDirection=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:k})),u.e(i.offsetAttribute)){var de=new Uint8Array(_);if(i.offsetAttribute===d.z.TOP)de=t.d(de,1,0,_/2);else{var ye=i.offsetAttribute===d.z.NONE?0:1;de=t.d(de,ye)}ce.applyOffset=new l.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:de})}return ce}(k,e);H=function(e){for(var t=e.length/3,o=f.IndexDatatype.createTypedArray(t,6*t),r=0,n=0;n<t;n++){var i=n,a=n+t,s=(i+1)%t,u=s+t;o[r++]=i,o[r++]=a,o[r++]=s,o[r++]=s,o[r++]=a,o[r++]=u}return o}(k);var K=f.IndexDatatype.createTypedArray(2*k.length/3,H),X=new l.I({attributes:Z,indices:K,primitiveType:x._0xa706e5.TRIANGLES}),$=y.k.combineInstances([new c.d({geometry:J}),new c.d({geometry:X})]);return{boundingSphere:Y,attributes:$[0].attributes,indices:$[0].indices}}function Y(e,t,o,r,i,a,s){for(var u=m.C.computeEllipsePositions({center:e,semiMajorAxis:t,semiMinorAxis:o,rotation:r,granularity:i},!1,!0).outerPositions,l=u.length/3,p=new Array(l),c=0;c<l;++c)p[c]=n.o.fromArray(u,3*c);var d=g.h.fromCartesianArray(p,a,s);return d.width>h.e.PI&&(d.north=d.north>0?h.e.PI_OVER_TWO-h.e.EPSILON7:d.north,d.south=d.south<0?h.e.EPSILON7-h.e.PI_OVER_TWO:d.south,d.east=h.e.PI,d.west=-h.e.PI),d}function B(e){var t=(e=u.u(e,u.u.EMPTY_OBJECT)).center,o=u.u(e.ellipsoid,r.t.WGS84),i=e.semiMajorAxis,s=e.semiMinorAxis,m=u.u(e.granularity,h.e.RADIANS_PER_DEGREE),l=u.u(e.vertexFormat,_.n.DEFAULT);if(a.o.defined("options.center",t),a.o.typeOf.number("options.semiMajorAxis",i),a.o.typeOf.number("options.semiMinorAxis",s),i<s)throw new a.t("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(m<=0)throw new a.t("granularity must be greater than zero.");var p=u.u(e.height,0),c=u.u(e.extrudedHeight,p);this._center=n.o.clone(t),this._semiMajorAxis=i,this._semiMinorAxis=s,this._ellipsoid=r.t.clone(o),this._rotation=u.u(e.rotation,0),this._stRotation=u.u(e.stRotation,0),this._height=Math.max(c,p),this._granularity=m,this._vertexFormat=_.n.clone(l),this._extrudedHeight=Math.min(c,p),this._shadowVolume=u.u(e.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}B.packedLength=n.o.packedLength+r.t.packedLength+_.n.packedLength+9,B.pack=function(e,t,o){return a.o.defined("value",e),a.o.defined("array",t),o=u.u(o,0),n.o.pack(e._center,t,o),o+=n.o.packedLength,r.t.pack(e._ellipsoid,t,o),o+=r.t.packedLength,_.n.pack(e._vertexFormat,t,o),o+=_.n.packedLength,t[o++]=e._semiMajorAxis,t[o++]=e._semiMinorAxis,t[o++]=e._rotation,t[o++]=e._stRotation,t[o++]=e._height,t[o++]=e._granularity,t[o++]=e._extrudedHeight,t[o++]=e._shadowVolume?1:0,t[o]=u.u(e._offsetAttribute,-1),t};var H=new n.o,U=new r.t,W=new _.n,q={center:H,ellipsoid:U,vertexFormat:W,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};B.unpack=function(e,t,o){a.o.defined("array",e),t=u.u(t,0);var i=n.o.unpack(e,t,H);t+=n.o.packedLength;var s=r.t.unpack(e,t,U);t+=r.t.packedLength;var m=_.n.unpack(e,t,W);t+=_.n.packedLength;var l=e[t++],p=e[t++],c=e[t++],d=e[t++],y=e[t++],f=e[t++],h=e[t++],A=1===e[t++],x=e[t];return u.e(o)?(o._center=n.o.clone(i,o._center),o._ellipsoid=r.t.clone(s,o._ellipsoid),o._vertexFormat=_.n.clone(m,o._vertexFormat),o._semiMajorAxis=l,o._semiMinorAxis=p,o._rotation=c,o._stRotation=d,o._height=y,o._granularity=f,o._extrudedHeight=h,o._shadowVolume=A,o._offsetAttribute=-1===x?void 0:x,o):(q.height=y,q.extrudedHeight=h,q.granularity=f,q.stRotation=d,q.rotation=c,q.semiMajorAxis=l,q.semiMinorAxis=p,q.shadowVolume=A,q.offsetAttribute=-1===x?void 0:x,new B(q))},B.computeRectangle=function(e,t){var o=(e=u.u(e,u.u.EMPTY_OBJECT)).center,n=u.u(e.ellipsoid,r.t.WGS84),i=e.semiMajorAxis,s=e.semiMinorAxis,m=u.u(e.granularity,h.e.RADIANS_PER_DEGREE),l=u.u(e.rotation,0);if(a.o.defined("options.center",o),a.o.typeOf.number("options.semiMajorAxis",i),a.o.typeOf.number("options.semiMinorAxis",s),i<s)throw new a.t("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(m<=0)throw new a.t("granularity must be greater than zero.");return Y(o,i,s,l,m,n,t)},B.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var r=e._height,i=e._extrudedHeight,a=!h.e.equalsEpsilon(r,i,0,h.e.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var p,c={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:r,granularity:e._granularity,vertexFormat:e._vertexFormat,stRotation:e._stRotation};if(a)c.extrudedHeight=i,c.shadowVolume=e._shadowVolume,c.offsetAttribute=e._offsetAttribute,p=k(c);else if(p=function(e){var t=e.center;z=n.o.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,z),e.height,z),z=n.o.add(t,z,z);var r=new o.i(z,e.semiMajorAxis),i=m.C.computeEllipsePositions(e,!0,!1),a=i.positions,s=i.numPts,u=L(a,e,!1),l=j(s);return{boundingSphere:r,attributes:u,indices:l=f.IndexDatatype.createTypedArray(a.length/3,l)}}(c),u.e(e._offsetAttribute)){var y=p.attributes.position.values.length,A=new Uint8Array(y/3),g=e._offsetAttribute===d.z.NONE?0:1;t.d(A,g),p.attributes.applyOffset=new l.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:A})}return new l.I({attributes:p.attributes,indices:p.indices,primitiveType:x._0xa706e5.TRIANGLES,boundingSphere:p.boundingSphere,offsetAttribute:e._offsetAttribute})}},B.createShadowVolume=function(e,t,o){var r=e._granularity,n=e._ellipsoid,i=t(r,n),a=o(r,n);return new B({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:n,rotation:e._rotation,stRotation:e._stRotation,granularity:r,extrudedHeight:i,height:a,vertexFormat:_.n.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(B.prototype,{rectangle:{get:function(){return u.e(this._rectangle)||(this._rectangle=Y(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return u.e(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];for(var o=m.C.computeEllipsePositions({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,rotation:e._rotation,granularity:e._granularity},!1,!0).outerPositions,r=o.length/3,i=new Array(r),a=0;a<r;++a)i[a]=n.o.fromArray(o,3*a);var s=e._ellipsoid,u=e.rectangle;return l.I._textureCoordinateRotationPoints(i,t,s,u)}(this)),this._textureCoordinateRotationPoints}}}),e.Y=B}));
