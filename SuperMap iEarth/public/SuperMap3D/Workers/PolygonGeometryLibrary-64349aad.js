define(["exports","./ArcType-198c1070","./arrayRemoveDuplicates-5016d6bb","./Ellipsoid-ca2b8eb1","./Cartesian3-c1138337","./Cartographic-630e5de6","./ComponentDatatype-3cfb1146","./defaultValue-2110bb17","./EllipsoidRhumbLine-89d13f20","./GeometryAttribute-b12ab6bd","./GeometryAttributes-3cad3ff9","./GeometryPipeline-7f49beb8","./IndexDatatype-d833345d","./Math-cd1437d9","./FeatureDetection-e7fb956a","./PolygonPipeline-478e7e0d","./PrimitiveType-d9ba7368"],(function(e,t,r,o,n,i,a,s,u,h,l,c,f,p,v,d,g){"use strict";function y(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(y.prototype,{length:{get:function(){return this._length}}}),y.prototype.enqueue=function(e){this._array.push(e),this._length++},y.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,r=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,r}},y.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},y.prototype.contains=function(e){return-1!==this._array.indexOf(e)},y.prototype.clear=function(){this._array.length=this._offset=this._length=0},y.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var m={computeHierarchyPackedLength:function(e){for(var t=0,r=[e];r.length>0;){var o=r.pop();if(s.e(o)){t+=2;var i=o.positions,a=o.holes;if(s.e(i)&&(t+=i.length*n.o.packedLength),s.e(a))for(var u=a.length,h=0;h<u;++h)r.push(a[h])}}return t},packPolygonHierarchy:function(e,t,r){for(var o=[e];o.length>0;){var i=o.pop();if(s.e(i)){var a=i.positions,u=i.holes;if(t[r++]=s.e(a)?a.length:0,t[r++]=s.e(u)?u.length:0,s.e(a))for(var h=a.length,l=0;l<h;++l,r+=3)n.o.pack(a[l],t,r);if(s.e(u))for(var c=u.length,f=0;f<c;++f)o.push(u[f])}}return r},unpackPolygonHierarchy:function(e,t){for(var r=e[t++],o=e[t++],i=new Array(r),a=o>0?new Array(o):void 0,s=0;s<r;++s,t+=n.o.packedLength)i[s]=n.o.unpack(e,t);for(var u=0;u<o;++u)a[u]=m.unpackPolygonHierarchy(e,t),t=a[u].startingIndex,delete a[u].startingIndex;return{positions:i,holes:a,startingIndex:t}}},b=new n.o;function I(e,t,r,o){return n.o.subtract(t,e,b),n.o.multiplyByScalar(b,r/o,b),n.o.add(e,b,b),[b.x,b.y,b.z]}m.subdivideLineCount=function(e,t,r){var o=n.o.distance(e,t)/r,i=Math.max(0,Math.ceil(p.e.log2(o)));return Math.pow(2,i)};var w=new i.a,_=new i.a,L=new i.a,x=new n.o;m.subdivideRhumbLineCount=function(e,t,r,o){var n=e.cartesianToCartographic(t,w),i=e.cartesianToCartographic(r,_),a=new u.P(n,i,e).surfaceDistance/o,s=Math.max(0,Math.ceil(p.e.log2(a)));return Math.pow(2,s)},m.subdivideLine=function(e,t,r,o){var i=m.subdivideLineCount(e,t,r),a=n.o.distance(e,t),u=a/i;s.e(o)||(o=[]);var h=o;h.length=3*i;for(var l=0,c=0;c<i;c++){var f=I(e,t,c*u,a);h[l++]=f[0],h[l++]=f[1],h[l++]=f[2]}return h},m.subdivideRhumbLine=function(e,t,r,o,n){var i=e.cartesianToCartographic(t,w),a=e.cartesianToCartographic(r,_),h=new u.P(i,a,e),l=h.surfaceDistance/o,c=Math.max(0,Math.ceil(p.e.log2(l))),f=Math.pow(2,c),v=h.surfaceDistance/f;s.e(n)||(n=[]);var d=n;d.length=3*f;for(var g=0,y=0;y<f;y++){var m=h.interpolateUsingSurfaceDistance(y*v,L),b=e.cartographicToCartesian(m,x);d[g++]=b.x,d[g++]=b.y,d[g++]=b.z}return d};var E=new n.o,D=new n.o,T=new n.o,A=new n.o;m.scaleToGeodeticHeightExtruded=function(e,t,r,i,a){i=s.u(i,o.t.WGS84);var u=E,h=D,l=T,c=A;if(s.e(e)&&s.e(e.attributes)&&s.e(e.attributes.position))for(var f=e.attributes.position.values,p=f.length/2,v=0;v<p;v+=3)n.o.fromArray(f,v,l),i.geodeticSurfaceNormal(l,u),c=i.scaleToGeodeticSurface(l,c),h=n.o.multiplyByScalar(u,r,h),h=n.o.add(c,h,h),f[v+p]=h.x,f[v+1+p]=h.y,f[v+2+p]=h.z,a&&(c=n.o.clone(l,c)),h=n.o.multiplyByScalar(u,t,h),h=n.o.add(c,h,h),f[v]=h.x,f[v+1]=h.y,f[v+2]=h.z;return e},m.polygonOutlinesFromHierarchy=function(e,t,o){var i,a,u,h=[],l=new y;for(l.enqueue(e);0!==l.length;){var c=l.dequeue(),f=c.positions;if(t)for(u=f.length,i=0;i<u;i++)o.scaleToGeodeticSurface(f[i],f[i]);if(!((f=r.D(f,n.o.equalsEpsilon,!0)).length<3)){var p=c.holes?c.holes.length:0;for(i=0;i<p;i++){var v=c.holes[i],d=v.positions;if(t)for(u=d.length,a=0;a<u;++a)o.scaleToGeodeticSurface(d[a],d[a]);if(!((d=r.D(d,n.o.equalsEpsilon,!0)).length<3)){h.push(d);var g=0;for(s.e(v.holes)&&(g=v.holes.length),a=0;a<g;a++)l.enqueue(v.holes[a])}}h.push(f)}}return h},m.polygonsFromHierarchy=function(e,t,o,i){var a=[],u=[],h=new y;for(h.enqueue(e);0!==h.length;){var l,c,f=h.dequeue(),v=f.positions,g=f.holes,m=v.slice();if(o)for(c=v.length,l=0;l<c;l++)i.scaleToGeodeticSurface(v[l],m[l]);if(!((v=r.D(m,n.o.equalsEpsilon,!0)).length<3)){var b=t(v);if(s.e(b)){var I=[],w=d.A.computeWindingOrder2D(b);w===d.W.CLOCKWISE&&(b.reverse(),v=v.slice().reverse());var _,L=v.slice(),x=s.e(g)?g.length:0,E=[];for(l=0;l<x;l++){var D=g[l],T=D.positions;if(o)for(c=T.length,_=0;_<c;++_)i.scaleToGeodeticSurface(T[_],T[_]);if(!((T=r.D(T,n.o.equalsEpsilon,!0,p.e.EPSILON7)).length<3)){var A=t(T);if(s.e(A)){(w=d.A.computeWindingOrder2D(A))===d.W.CLOCKWISE&&(A.reverse(),T=T.slice().reverse()),E.push(T),I.push(L.length),L=L.concat(T),b=b.concat(A);var S=0;for(s.e(D.holes)&&(S=D.holes.length),_=0;_<S;_++)h.enqueue(D.holes[_])}}}a.push({outerRing:v,holes:E}),u.push({positions:L,positions2D:b,holes:I})}}}return{hierarchy:a,polygons:u}};var S=new o.o,C=new n.o,N=new h.n,G=new v.p;m.computeBoundingRectangle=function(e,t,r,o,i){for(var a=h.n.fromAxisAngle(e,o,N),u=v.p.fromQuaternion(a,G),l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,d=r.length,g=0;g<d;++g){var y=n.o.clone(r[g],C);v.p.multiplyByVector(u,y,y);var m=t(y,S);s.e(m)&&(l=Math.min(l,m.x),c=Math.max(c,m.x),f=Math.min(f,m.y),p=Math.max(p,m.y))}return i.x=l,i.y=f,i.width=c-l,i.height=p-f,i},m.createGeometryFromPositions=function(e,r,o,n,i,s){var u=d.A.triangulate(r.positions2D,r.holes);u.length<3&&(u=[0,1,2]);var l=r.positions;if(n){for(var f=l.length,p=new Array(3*f),v=0,y=0;y<f;y++){var m=l[y];p[v++]=m.x,p[v++]=m.y,p[v++]=m.z}var b=new h.I({attributes:{position:new h.o({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:p})},indices:u,primitiveType:g._0xa706e5.TRIANGLES});return i.normal?c.k.computeNormal(b):b}return s===t.L.GEODESIC?d.A.computeSubdivision(e,l,u,o):s===t.L.RHUMB?d.A.computeRhumbLineSubdivision(e,l,u,o):void 0};var P=[],M=new n.o,O=new n.o;m.computeWallGeometry=function(e,r,o,i,s){var u,c,v,d,y,b=e.length,I=0;if(i)for(c=3*b*2,u=new Array(2*c),v=0;v<b;v++)d=e[v],y=e[(v+1)%b],u[I]=u[I+c]=d.x,u[++I]=u[I+c]=d.y,u[++I]=u[I+c]=d.z,u[++I]=u[I+c]=y.x,u[++I]=u[I+c]=y.y,u[++I]=u[I+c]=y.z,++I;else{var w=p.e.chordLength(o,r.maximumRadius),_=0;if(s===t.L.GEODESIC)for(v=0;v<b;v++)_+=m.subdivideLineCount(e[v],e[(v+1)%b],w);else if(s===t.L.RHUMB)for(v=0;v<b;v++)_+=m.subdivideRhumbLineCount(r,e[v],e[(v+1)%b],w);for(c=3*(_+b),u=new Array(2*c),v=0;v<b;v++){var L;d=e[v],y=e[(v+1)%b],s===t.L.GEODESIC?L=m.subdivideLine(d,y,w,P):s===t.L.RHUMB&&(L=m.subdivideRhumbLine(r,d,y,w,P));for(var x=L.length,E=0;E<x;++E,++I)u[I]=L[E],u[I+c]=L[E];u[I]=y.x,u[I+c]=y.x,u[++I]=y.y,u[I+c]=y.y,u[++I]=y.z,u[I+c]=y.z,++I}}b=u.length;var D=f.IndexDatatype.createTypedArray(b/3,b-6*e.length),T=0;for(b/=6,v=0;v<b;v++){var A=v,S=A+1,C=A+b,N=C+1;d=n.o.fromArray(u,3*A,M),y=n.o.fromArray(u,3*S,O),!n.o.equalsEpsilon(d,y,p.e.EPSILON10,p.e.EPSILON10)&&(D[T++]=A,D[T++]=C,D[T++]=S,D[T++]=S,D[T++]=C,D[T++]=N)}return new h.I({attributes:new l.a({position:new h.o({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:u})}),indices:D,primitiveType:g._0xa706e5.TRIANGLES})},e.l=m}));
