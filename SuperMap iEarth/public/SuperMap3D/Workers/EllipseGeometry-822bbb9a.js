define(["exports","./arrayFill-9b55d6b2","./buildModuleUrl-1b968a9d","./Cartesian2-59a54ee7","./Cartographic-81e9e8b2","./Check-ff445961","./ComponentDatatype-7d28dd1c","./when-39df26e1","./EllipseGeometryLibrary-b199e40b","./GeometryAttribute-9b3921a3","./GeometryAttributes-11421d3c","./GeometryInstance-67860833","./GeometryOffsetAttribute-b4d599f5","./GeometryPipeline-91e3b4f0","./IndexDatatype-be421fbf","./Math-5e067eb3","./FeatureDetection-2d4141ff","./VertexFormat-79ab0d67"],(function(e,t,o,r,n,i,a,s,u,m,l,p,c,d,y,f,h,A){"use strict";var x=new n.o,g=new n.o,_=new n.o,v=new n.o,b=new r.o,w=new h.p$1,I=new h.p$1,T=new m.n,N=new n.o,M=new n.o,E=new n.o,P=new n.a,D=new n.o,F=new r.o,O=new r.o;function S(e,i,p){var d=i.vertexFormat,y=i.center,f=i.semiMajorAxis,A=i.semiMinorAxis,v=i.ellipsoid,S=i.stRotation,C=p?e.length/3*2:e.length/3,L=i.shadowVolume,R=d.st?new Float32Array(2*C):void 0,j=d.normal?new Float32Array(3*C):void 0,z=d.tangent?new Float32Array(3*C):void 0,G=d.bitangent?new Float32Array(3*C):void 0,V=L?new Float32Array(3*C):void 0,k=0,Y=N,B=M,H=E,$=new o.n(v),U=$.project(v.cartesianToCartographic(y,P),D),W=v.scaleToGeodeticSurface(y,x);v.geodeticSurfaceNormal(W,W);var q=w,Q=I;if(0!==S){var J=m.n.fromAxisAngle(W,S,T);q=h.p$1.fromQuaternion(J,q),J=m.n.fromAxisAngle(W,-S,T),Q=h.p$1.fromQuaternion(J,Q)}else q=h.p$1.clone(h.p$1.IDENTITY,q),Q=h.p$1.clone(h.p$1.IDENTITY,Q);for(var Z=r.o.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,F),K=r.o.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,O),X=e.length,ee=p?X:0,te=ee/3*2,oe=0;oe<X;oe+=3){var re=oe+1,ne=oe+2,ie=n.o.fromArray(e,oe,x);if(d.st){var ae=h.p$1.multiplyByVector(q,ie,g),se=$.project(v.cartesianToCartographic(ae,P),_);n.o.subtract(se,U,se),b.x=(se.x+f)/(2*f),b.y=(se.y+A)/(2*A),Z.x=Math.min(b.x,Z.x),Z.y=Math.min(b.y,Z.y),K.x=Math.max(b.x,K.x),K.y=Math.max(b.y,K.y),p&&(R[k+te]=b.x,R[k+1+te]=b.y),R[k++]=b.x,R[k++]=b.y}(d.normal||d.tangent||d.bitangent||L)&&(Y=v.geodeticSurfaceNormal(ie,Y),L&&(V[oe+ee]=-Y.x,V[re+ee]=-Y.y,V[ne+ee]=-Y.z),(d.normal||d.tangent||d.bitangent)&&((d.tangent||d.bitangent)&&(B=n.o.normalize(n.o.cross(n.o.UNIT_Z,Y,B),B),h.p$1.multiplyByVector(Q,B,B)),d.normal&&(j[oe]=Y.x,j[re]=Y.y,j[ne]=Y.z,p&&(j[oe+ee]=-Y.x,j[re+ee]=-Y.y,j[ne+ee]=-Y.z)),d.tangent&&(z[oe]=B.x,z[re]=B.y,z[ne]=B.z,p&&(z[oe+ee]=-B.x,z[re+ee]=-B.y,z[ne+ee]=-B.z)),d.bitangent&&(H=n.o.normalize(n.o.cross(Y,B,H),H),G[oe]=H.x,G[re]=H.y,G[ne]=H.z,p&&(G[oe+ee]=H.x,G[re+ee]=H.y,G[ne+ee]=H.z))))}if(d.st){X=R.length;for(var ue=0;ue<X;ue+=2)R[ue]=(R[ue]-Z.x)/(K.x-Z.x),R[ue+1]=(R[ue+1]-Z.y)/(K.y-Z.y)}var me=new l.a;if(d.position){var le=u.C.raisePositionsToHeight(e,i,p);me.position=new m.o({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:le})}if(d.st&&(me.st=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:R})),d.normal&&(me.normal=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j})),d.tangent&&(me.tangent=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z})),d.bitangent&&(me.bitangent=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),L&&(me.extrudeDirection=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:V})),p&&s.e(i.offsetAttribute)){var pe=new Uint8Array(C);if(i.offsetAttribute===c.z.TOP)pe=t.d(pe,1,0,C/2);else{var ce=i.offsetAttribute===c.z.NONE?0:1;pe=t.d(pe,ce)}me.applyOffset=new m.o({componentDatatype:a.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:pe})}return me}function C(e){var t,o,r,n,i,a=new Array(e*(e+1)*12-6),s=0;for(t=0,r=1,n=0;n<3;n++)a[s++]=r++,a[s++]=t,a[s++]=r;for(n=2;n<e+1;++n){for(r=n*(n+1)-1,t=(n-1)*n-1,a[s++]=r++,a[s++]=t,a[s++]=r,o=2*n,i=0;i<o-1;++i)a[s++]=r,a[s++]=t++,a[s++]=t,a[s++]=r++,a[s++]=t,a[s++]=r;a[s++]=r++,a[s++]=t,a[s++]=r}for(o=2*e,++r,++t,n=0;n<o-1;++n)a[s++]=r,a[s++]=t++,a[s++]=t,a[s++]=r++,a[s++]=t,a[s++]=r;for(a[s++]=r,a[s++]=t++,a[s++]=t,a[s++]=r++,a[s++]=t++,a[s++]=t,++t,n=e-1;n>1;--n){for(a[s++]=t++,a[s++]=t,a[s++]=r,o=2*n,i=0;i<o-1;++i)a[s++]=r,a[s++]=t++,a[s++]=t,a[s++]=r++,a[s++]=t,a[s++]=r;a[s++]=t++,a[s++]=t++,a[s++]=r++}for(n=0;n<3;n++)a[s++]=t++,a[s++]=t,a[s++]=r;return a}var L=new n.o;var R=new o.i,j=new o.i;function z(e){var i=e.center,f=e.ellipsoid,A=e.semiMajorAxis,I=n.o.multiplyByScalar(f.geodeticSurfaceNormal(i,x),e.height,x);R.center=n.o.add(i,I,R.center),R.radius=A,I=n.o.multiplyByScalar(f.geodeticSurfaceNormal(i,I),e.extrudedHeight,I),j.center=n.o.add(i,I,j.center),j.radius=A;var L=u.C.computeEllipsePositions(e,!0,!0),z=L.positions,G=L.numPts,V=L.outerPositions,k=o.i.union(R,j),Y=S(z,e,!0),B=C(G),H=B.length;B.length=2*H;for(var $=z.length/3,U=0;U<H;U+=3)B[U+H]=B[U+2]+$,B[U+1+H]=B[U+1]+$,B[U+2+H]=B[U]+$;var W=y.IndexDatatype.createTypedArray(2*$/3,B),q=new m.I({attributes:Y,indices:W,primitiveType:h._0x2355b9.TRIANGLES}),Q=function(e,i){var u=i.vertexFormat,p=i.center,d=i.semiMajorAxis,y=i.semiMinorAxis,f=i.ellipsoid,A=i.height,I=i.extrudedHeight,S=i.stRotation,C=e.length/3*2,L=new Float64Array(3*C),R=u.st?new Float32Array(2*C):void 0,j=u.normal?new Float32Array(3*C):void 0,z=u.tangent?new Float32Array(3*C):void 0,G=u.bitangent?new Float32Array(3*C):void 0,V=i.shadowVolume,k=V?new Float32Array(3*C):void 0,Y=0,B=N,H=M,$=E,U=new o.n(f),W=U.project(f.cartesianToCartographic(p,P),D),q=f.scaleToGeodeticSurface(p,x);f.geodeticSurfaceNormal(q,q);for(var Q=m.n.fromAxisAngle(q,S,T),J=h.p$1.fromQuaternion(Q,w),Z=r.o.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,F),K=r.o.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,O),X=e.length,ee=X/3*2,te=0;te<X;te+=3){var oe,re=te+1,ne=te+2,ie=n.o.fromArray(e,te,x);if(u.st){var ae=h.p$1.multiplyByVector(J,ie,g),se=U.project(f.cartesianToCartographic(ae,P),_);n.o.subtract(se,W,se),b.x=(se.x+d)/(2*d),b.y=(se.y+y)/(2*y),Z.x=Math.min(b.x,Z.x),Z.y=Math.min(b.y,Z.y),K.x=Math.max(b.x,K.x),K.y=Math.max(b.y,K.y),R[Y+ee]=b.x,R[Y+1+ee]=b.y,R[Y++]=b.x,R[Y++]=b.y}ie=f.scaleToGeodeticSurface(ie,ie),oe=n.o.clone(ie,g),B=f.geodeticSurfaceNormal(ie,B),V&&(k[te+X]=-B.x,k[re+X]=-B.y,k[ne+X]=-B.z);var ue=n.o.multiplyByScalar(B,A,v);if(ie=n.o.add(ie,ue,ie),ue=n.o.multiplyByScalar(B,I,ue),oe=n.o.add(oe,ue,oe),u.position&&(L[te+X]=oe.x,L[re+X]=oe.y,L[ne+X]=oe.z,L[te]=ie.x,L[re]=ie.y,L[ne]=ie.z),u.normal||u.tangent||u.bitangent){$=n.o.clone(B,$);var me=n.o.fromArray(e,(te+3)%X,v);n.o.subtract(me,ie,me);var le=n.o.subtract(oe,ie,_);B=n.o.normalize(n.o.cross(le,me,B),B),u.normal&&(j[te]=B.x,j[re]=B.y,j[ne]=B.z,j[te+X]=B.x,j[re+X]=B.y,j[ne+X]=B.z),u.tangent&&(H=n.o.normalize(n.o.cross($,B,H),H),z[te]=H.x,z[re]=H.y,z[ne]=H.z,z[te+X]=H.x,z[te+1+X]=H.y,z[te+2+X]=H.z),u.bitangent&&(G[te]=$.x,G[re]=$.y,G[ne]=$.z,G[te+X]=$.x,G[re+X]=$.y,G[ne+X]=$.z)}}if(u.st){X=R.length;for(var pe=0;pe<X;pe+=2)R[pe]=(R[pe]-Z.x)/(K.x-Z.x),R[pe+1]=(R[pe+1]-Z.y)/(K.y-Z.y)}var ce=new l.a;if(u.position&&(ce.position=new m.o({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:L})),u.st&&(ce.st=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:R})),u.normal&&(ce.normal=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j})),u.tangent&&(ce.tangent=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z})),u.bitangent&&(ce.bitangent=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),V&&(ce.extrudeDirection=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:k})),s.e(i.offsetAttribute)){var de=new Uint8Array(C);if(i.offsetAttribute===c.z.TOP)de=t.d(de,1,0,C/2);else{var ye=i.offsetAttribute===c.z.NONE?0:1;de=t.d(de,ye)}ce.applyOffset=new m.o({componentDatatype:a.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:de})}return ce}(V,e);B=function(e){for(var t=e.length/3,o=y.IndexDatatype.createTypedArray(t,6*t),r=0,n=0;n<t;n++){var i=n,a=n+t,s=(i+1)%t,u=s+t;o[r++]=i,o[r++]=a,o[r++]=s,o[r++]=s,o[r++]=a,o[r++]=u}return o}(V);var J=y.IndexDatatype.createTypedArray(2*V.length/3,B),Z=new m.I({attributes:Q,indices:J,primitiveType:h._0x2355b9.TRIANGLES}),K=d.k.combineInstances([new p.d({geometry:q}),new p.d({geometry:Z})]);return{boundingSphere:k,attributes:K[0].attributes,indices:K[0].indices}}function G(e,t,o,i,a,s,m){for(var l=u.C.computeEllipsePositions({center:e,semiMajorAxis:t,semiMinorAxis:o,rotation:i,granularity:a},!1,!0).outerPositions,p=l.length/3,c=new Array(p),d=0;d<p;++d)c[d]=n.o.fromArray(l,3*d);var y=r.h.fromCartesianArray(c,s,m);return y.width>f.e.PI&&(y.north=y.north>0?f.e.PI_OVER_TWO-f.e.EPSILON7:y.north,y.south=y.south<0?f.e.EPSILON7-f.e.PI_OVER_TWO:y.south,y.east=f.e.PI,y.west=-f.e.PI),y}function V(e){var t=(e=s.u(e,s.u.EMPTY_OBJECT)).center,o=s.u(e.ellipsoid,r.t.WGS84),a=e.semiMajorAxis,u=e.semiMinorAxis,m=s.u(e.granularity,f.e.RADIANS_PER_DEGREE),l=s.u(e.vertexFormat,A.n.DEFAULT);if(i.o.defined("options.center",t),i.o.typeOf.number("options.semiMajorAxis",a),i.o.typeOf.number("options.semiMinorAxis",u),a<u)throw new i.t("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(m<=0)throw new i.t("granularity must be greater than zero.");var p=s.u(e.height,0),c=s.u(e.extrudedHeight,p);this._center=n.o.clone(t),this._semiMajorAxis=a,this._semiMinorAxis=u,this._ellipsoid=r.t.clone(o),this._rotation=s.u(e.rotation,0),this._stRotation=s.u(e.stRotation,0),this._height=Math.max(c,p),this._granularity=m,this._vertexFormat=A.n.clone(l),this._extrudedHeight=Math.min(c,p),this._shadowVolume=s.u(e.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}V.packedLength=n.o.packedLength+r.t.packedLength+A.n.packedLength+9,V.pack=function(e,t,o){return i.o.defined("value",e),i.o.defined("array",t),o=s.u(o,0),n.o.pack(e._center,t,o),o+=n.o.packedLength,r.t.pack(e._ellipsoid,t,o),o+=r.t.packedLength,A.n.pack(e._vertexFormat,t,o),o+=A.n.packedLength,t[o++]=e._semiMajorAxis,t[o++]=e._semiMinorAxis,t[o++]=e._rotation,t[o++]=e._stRotation,t[o++]=e._height,t[o++]=e._granularity,t[o++]=e._extrudedHeight,t[o++]=e._shadowVolume?1:0,t[o]=s.u(e._offsetAttribute,-1),t};var k=new n.o,Y=new r.t,B=new A.n,H={center:k,ellipsoid:Y,vertexFormat:B,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};V.unpack=function(e,t,o){i.o.defined("array",e),t=s.u(t,0);var a=n.o.unpack(e,t,k);t+=n.o.packedLength;var u=r.t.unpack(e,t,Y);t+=r.t.packedLength;var m=A.n.unpack(e,t,B);t+=A.n.packedLength;var l=e[t++],p=e[t++],c=e[t++],d=e[t++],y=e[t++],f=e[t++],h=e[t++],x=1===e[t++],g=e[t];return s.e(o)?(o._center=n.o.clone(a,o._center),o._ellipsoid=r.t.clone(u,o._ellipsoid),o._vertexFormat=A.n.clone(m,o._vertexFormat),o._semiMajorAxis=l,o._semiMinorAxis=p,o._rotation=c,o._stRotation=d,o._height=y,o._granularity=f,o._extrudedHeight=h,o._shadowVolume=x,o._offsetAttribute=-1===g?void 0:g,o):(H.height=y,H.extrudedHeight=h,H.granularity=f,H.stRotation=d,H.rotation=c,H.semiMajorAxis=l,H.semiMinorAxis=p,H.shadowVolume=x,H.offsetAttribute=-1===g?void 0:g,new V(H))},V.computeRectangle=function(e,t){var o=(e=s.u(e,s.u.EMPTY_OBJECT)).center,n=s.u(e.ellipsoid,r.t.WGS84),a=e.semiMajorAxis,u=e.semiMinorAxis,m=s.u(e.granularity,f.e.RADIANS_PER_DEGREE),l=s.u(e.rotation,0);if(i.o.defined("options.center",o),i.o.typeOf.number("options.semiMajorAxis",a),i.o.typeOf.number("options.semiMinorAxis",u),a<u)throw new i.t("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(m<=0)throw new i.t("granularity must be greater than zero.");return G(o,a,u,l,m,n,t)},V.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var r=e._height,i=e._extrudedHeight,l=!f.e.equalsEpsilon(r,i,0,f.e.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var p,d={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:r,granularity:e._granularity,vertexFormat:e._vertexFormat,stRotation:e._stRotation};if(l)d.extrudedHeight=i,d.shadowVolume=e._shadowVolume,d.offsetAttribute=e._offsetAttribute,p=z(d);else if(p=function(e){var t=e.center;L=n.o.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,L),e.height,L),L=n.o.add(t,L,L);var r=new o.i(L,e.semiMajorAxis),i=u.C.computeEllipsePositions(e,!0,!1),a=i.positions,s=i.numPts,m=S(a,e,!1),l=C(s);return{boundingSphere:r,attributes:m,indices:l=y.IndexDatatype.createTypedArray(a.length/3,l)}}(d),s.e(e._offsetAttribute)){var A=p.attributes.position.values.length,x=new Uint8Array(A/3),g=e._offsetAttribute===c.z.NONE?0:1;t.d(x,g),p.attributes.applyOffset=new m.o({componentDatatype:a.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:x})}return new m.I({attributes:p.attributes,indices:p.indices,primitiveType:h._0x2355b9.TRIANGLES,boundingSphere:p.boundingSphere,offsetAttribute:e._offsetAttribute})}},V.createShadowVolume=function(e,t,o){var r=e._granularity,n=e._ellipsoid,i=t(r,n),a=o(r,n);return new V({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:n,rotation:e._rotation,stRotation:e._stRotation,granularity:r,extrudedHeight:i,height:a,vertexFormat:A.n.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(V.prototype,{rectangle:{get:function(){return s.e(this._rectangle)||(this._rectangle=G(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return s.e(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];for(var o=u.C.computeEllipsePositions({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,rotation:e._rotation,granularity:e._granularity},!1,!0).outerPositions,r=o.length/3,i=new Array(r),a=0;a<r;++a)i[a]=n.o.fromArray(o,3*a);var s=e._ellipsoid,l=e.rectangle;return m.I._textureCoordinateRotationPoints(i,t,s,l)}(this)),this._textureCoordinateRotationPoints}}}),e.Y=V}));
