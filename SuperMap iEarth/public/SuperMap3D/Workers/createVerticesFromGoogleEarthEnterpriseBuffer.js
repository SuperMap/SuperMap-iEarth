define(["./EllipsoidTangentPlane-6f479ced","./buildModuleUrl-36ce0ebc","./Ellipsoid-ca2b8eb1","./Cartesian3-c1138337","./Cartographic-630e5de6","./defaultValue-2110bb17","./TerrainEncoding-258e5b72","./Math-cd1437d9","./PrimitiveType-d9ba7368","./OrientedBoundingBox-e518fab9","./Rectangle-52f780a9","./RuntimeError-6daf0e01","./GeometryAttribute-b12ab6bd","./WebMercatorProjection-c3d13a47","./createTaskProcessorWorker","./Check-92c551fb","./Cartesian4-5c264813","./IntersectionTests-88230423","./FeatureDetection-e7fb956a","./defer-a21481c0","./Plane-8f19018a","./Event-589349b0","./AttributeCompression-79e23de9","./ComponentDatatype-3cfb1146","./WebGLConstants-92042d9e","./PolygonPipeline-478e7e0d","./EllipsoidRhumbLine-89d13f20"],(function(e,t,n,i,r,a,o,u,s,d,c,h,l,g,m,p,v,I,E,f,T,b,N,x,S,y,P){"use strict";var w=Uint16Array.BYTES_PER_ELEMENT,R=Int32Array.BYTES_PER_ELEMENT,A=Uint32Array.BYTES_PER_ELEMENT,M=Float32Array.BYTES_PER_ELEMENT,B=Float64Array.BYTES_PER_ELEMENT;function _(e,t,n){n=a.u(n,u.e);for(var i=e.length,r=0;r<i;++r)if(n.equalsEpsilon(e[r],t,u.e.EPSILON12))return r;return-1}var C=new r.a,F=new i.o,W=new i.o,U=new i.o,Y=new s.y;function k(e,t,o,d,c,h,l,g,m,p){for(var v=l.length,I=0;I<v;++I){var E=l[I],f=E.cartographic,T=E.index,b=e.length,N=f.longitude,x=f.latitude;x=u.e.clamp(x,-u.e.PI_OVER_TWO,u.e.PI_OVER_TWO);var S=f.height-h.skirtHeight;h.hMin=Math.min(h.hMin,S),r.a.fromRadians(N,x,S,C),m&&(C.longitude+=g),m?I===v-1?C.latitude+=p:0===I&&(C.latitude-=p):C.latitude+=g;var y=h.ellipsoid.cartographicToCartesian(C);e.push(y),t.push(S),o.push(n.o.clone(o[T])),d.length>0&&d.push(d[T]),s.y.multiplyByPoint(h.toENU,y,F);var P=h.minimum,w=h.maximum;i.o.minimumByComponent(F,P,P),i.o.maximumByComponent(F,w,w);var R=h.lastBorderPoint;if(a.e(R)){var A=R.index;c.push(A,b-1,b,b,T,A)}h.lastBorderPoint=E}}return m((function(m,p){m.ellipsoid=n.t.clone(m.ellipsoid),m.rectangle=c.h.clone(m.rectangle);var v=function(c,m,p,v,I,E,f,T,b,N){var x,S,y,P,V,L;a.e(v)?(x=v.west,S=v.south,y=v.east,P=v.north,V=v.width,L=v.height):(x=u.e.toRadians(I.west),S=u.e.toRadians(I.south),y=u.e.toRadians(I.east),P=u.e.toRadians(I.north),V=u.e.toRadians(v.width),L=u.e.toRadians(v.height));var O,H,D=[S,P],G=[x,y],z=l.m.eastNorthUpToFixedFrame(m,p),j=s.y.inverseTransformation(z,Y);T&&(O=g.t.geodeticLatitudeToMercatorAngle(S),H=1/(g.t.geodeticLatitudeToMercatorAngle(P)-O));var q=new DataView(c),J=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY,Q=W;Q.x=Number.POSITIVE_INFINITY,Q.y=Number.POSITIVE_INFINITY,Q.z=Number.POSITIVE_INFINITY;var X=U;X.x=Number.NEGATIVE_INFINITY,X.y=Number.NEGATIVE_INFINITY,X.z=Number.NEGATIVE_INFINITY;var Z,$,ee=0,te=0,ne=0;for($=0;$<4;++$){var ie=ee;Z=q.getUint32(ie,!0),ie+=A;var re=u.e.toRadians(180*q.getFloat64(ie,!0));ie+=B,-1===_(G,re)&&G.push(re);var ae=u.e.toRadians(180*q.getFloat64(ie,!0));ie+=B,-1===_(D,ae)&&D.push(ae),ie+=2*B;var oe=q.getInt32(ie,!0);ie+=R,te+=oe,ne+=3*(oe=q.getInt32(ie,!0)),ee+=Z+A}var ue=[],se=[],de=new Array(te),ce=new Array(te),he=new Array(te),le=T?new Array(te):[],ge=new Array(ne),me=[],pe=[],ve=[],Ie=[],Ee=0,fe=0;for(ee=0,$=0;$<4;++$){Z=q.getUint32(ee,!0);var Te=ee+=A,be=u.e.toRadians(180*q.getFloat64(ee,!0));ee+=B;var Ne=u.e.toRadians(180*q.getFloat64(ee,!0));ee+=B;var xe=u.e.toRadians(180*q.getFloat64(ee,!0)),Se=.5*xe;ee+=B;var ye=u.e.toRadians(180*q.getFloat64(ee,!0)),Pe=.5*ye;ee+=B;var we=q.getInt32(ee,!0);ee+=R;var Re=q.getInt32(ee,!0);ee+=R,ee+=R;for(var Ae=new Array(we),Me=0;Me<we;++Me){var Be=be+q.getUint8(ee++)*xe;C.longitude=Be;var _e=Ne+q.getUint8(ee++)*ye;C.latitude=_e;var Ce=q.getFloat32(ee,!0);if(ee+=M,0!==Ce&&Ce<N&&(Ce*=-Math.pow(2,b)),Ce*=6371010*E,C.height=Ce,-1!==_(G,Be)||-1!==_(D,_e)){var Fe=_(ue,C,r.a);if(-1!==Fe){Ae[Me]=se[Fe];continue}ue.push(r.a.clone(C)),se.push(Ee)}Ae[Me]=Ee,Math.abs(Be-x)<Se?me.push({index:Ee,cartographic:r.a.clone(C)}):Math.abs(Be-y)<Se?ve.push({index:Ee,cartographic:r.a.clone(C)}):Math.abs(_e-S)<Pe?pe.push({index:Ee,cartographic:r.a.clone(C)}):Math.abs(_e-P)<Pe&&Ie.push({index:Ee,cartographic:r.a.clone(C)}),J=Math.min(Ce,J),K=Math.max(Ce,K),he[Ee]=Ce;var We=p.cartographicToCartesian(C);de[Ee]=We,T&&(le[Ee]=(g.t.geodeticLatitudeToMercatorAngle(_e)-O)*H),s.y.multiplyByPoint(j,We,F),i.o.minimumByComponent(F,Q,Q),i.o.maximumByComponent(F,X,X);var Ue=(Be-x)/(y-x);Ue=u.e.clamp(Ue,0,1);var Ye=(_e-S)/(P-S);Ye=u.e.clamp(Ye,0,1),ce[Ee]=new n.o(Ue,Ye),++Ee}for(var ke=3*Re,Ve=0;Ve<ke;++Ve,++fe)ge[fe]=Ae[q.getUint16(ee,!0)],ee+=w;if(Z!==ee-Te)throw new h.t("Invalid terrain tile.")}de.length=Ee,ce.length=Ee,he.length=Ee,T&&(le.length=Ee);var Le=Ee,Oe=fe,He={hMin:J,lastBorderPoint:void 0,skirtHeight:f,toENU:j,ellipsoid:p,minimum:Q,maximum:X};me.sort((function(e,t){return t.cartographic.latitude-e.cartographic.latitude})),pe.sort((function(e,t){return e.cartographic.longitude-t.cartographic.longitude})),ve.sort((function(e,t){return e.cartographic.latitude-t.cartographic.latitude})),Ie.sort((function(e,t){return t.cartographic.longitude-e.cartographic.longitude}));var De=1e-5;if(k(de,he,ce,le,ge,He,me,-De*V,!0,-De*L),k(de,he,ce,le,ge,He,pe,-De*L,!1),k(de,he,ce,le,ge,He,ve,De*V,!0,De*L),k(de,he,ce,le,ge,He,Ie,De*L,!1),me.length>0&&Ie.length>0){var Ge=me[0].index,ze=Le,je=Ie[Ie.length-1].index,qe=de.length-1;ge.push(je,qe,ze,ze,Ge,je)}te=de.length;var Je,Ke=t.i.fromPoints(de);a.e(v)&&(Je=d.p.fromRectangle(v,J,K,p));for(var Qe=new o.s(p).computeHorizonCullingPointPossiblyUnderEllipsoid(m,de,J),Xe=new e.e(Q,X,m),Ze=new o.h(Xe,He.hMin,K,z,!1,T),$e=new Float32Array(te*Ze.getStride()),et=0,tt=0;tt<te;++tt)et=Ze.encode($e,et,de[tt],ce[tt],he[tt],void 0,le[tt]);var nt=me.map((function(e){return e.index})).reverse(),it=pe.map((function(e){return e.index})).reverse(),rt=ve.map((function(e){return e.index})).reverse(),at=Ie.map((function(e){return e.index})).reverse();return it.unshift(rt[rt.length-1]),it.push(nt[0]),at.unshift(nt[nt.length-1]),at.push(rt[0]),{vertices:$e,indices:new Uint16Array(ge),maximumHeight:K,minimumHeight:J,encoding:Ze,boundingSphere3D:Ke,orientedBoundingBox:Je,occludeePointInScaledSpace:Qe,vertexCountWithoutSkirts:Le,indexCountWithoutSkirts:Oe,westIndicesSouthToNorth:nt,southIndicesEastToWest:it,eastIndicesNorthToSouth:rt,northIndicesWestToEast:at}}(m.buffer,m.relativeToCenter,m.ellipsoid,m.rectangle,m.nativeRectangle,m.exaggeration,m.skirtHeight,m.includeWebMercatorT,m.negativeAltitudeExponentBias,m.negativeElevationThreshold),I=v.vertices;p.push(I.buffer);var E=v.indices;return p.push(E.buffer),{vertices:I.buffer,indices:E.buffer,numberOfAttributes:v.encoding.getStride(),minimumHeight:v.minimumHeight,maximumHeight:v.maximumHeight,boundingSphere3D:v.boundingSphere3D,orientedBoundingBox:v.orientedBoundingBox,occludeePointInScaledSpace:v.occludeePointInScaledSpace,encoding:v.encoding,vertexCountWithoutSkirts:v.vertexCountWithoutSkirts,indexCountWithoutSkirts:v.indexCountWithoutSkirts,westIndicesSouthToNorth:v.westIndicesSouthToNorth,southIndicesEastToWest:v.southIndicesEastToWest,eastIndicesNorthToSouth:v.eastIndicesNorthToSouth,northIndicesWestToEast:v.northIndicesWestToEast}}))}));
