define(["./EllipsoidTangentPlane-ee91c10e","./buildModuleUrl-1b968a9d","./Cartesian2-59a54ee7","./Cartographic-81e9e8b2","./when-39df26e1","./TerrainEncoding-6f3d720e","./Math-5e067eb3","./FeatureDetection-2d4141ff","./OrientedBoundingBox-7144be8f","./RuntimeError-251a1d8d","./GeometryAttribute-9b3921a3","./WebMercatorProjection-9bf14d38","./createTaskProcessorWorker","./Check-ff445961","./Cartesian4-a56bd360","./IntersectionTests-036daea1","./Plane-775a5120","./Event-e109b23e","./AttributeCompression-4cf880dc","./ComponentDatatype-7d28dd1c","./WebGLConstants-42651efd","./PolygonPipeline-ae195f4e","./EllipsoidRhumbLine-61b02483"],(function(e,t,n,i,r,a,o,u,s,d,h,c,l,g,m,p,v,I,E,f,T,N,b){"use strict";var x=Uint16Array.BYTES_PER_ELEMENT,S=Int32Array.BYTES_PER_ELEMENT,w=Uint32Array.BYTES_PER_ELEMENT,P=Float32Array.BYTES_PER_ELEMENT,y=Float64Array.BYTES_PER_ELEMENT;function A(e,t,n){n=r.u(n,o.e);for(var i=e.length,a=0;a<i;++a)if(n.equalsEpsilon(e[a],t,o.e.EPSILON12))return a;return-1}var M=new i.a,R=new i.o,B=new i.o,_=new i.o,C=new u.p;function F(e,t,a,s,d,h,c,l,g,m){for(var p=c.length,v=0;v<p;++v){var I=c[v],E=I.cartographic,f=I.index,T=e.length,N=E.longitude,b=E.latitude;b=o.e.clamp(b,-o.e.PI_OVER_TWO,o.e.PI_OVER_TWO);var x=E.height-h.skirtHeight;h.hMin=Math.min(h.hMin,x),i.a.fromRadians(N,b,x,M),g&&(M.longitude+=l),g?v===p-1?M.latitude+=m:0===v&&(M.latitude-=m):M.latitude+=l;var S=h.ellipsoid.cartographicToCartesian(M);e.push(S),t.push(x),a.push(n.o.clone(a[f])),s.length>0&&s.push(s[f]),u.p.multiplyByPoint(h.toENU,S,R);var w=h.minimum,P=h.maximum;i.o.minimumByComponent(R,w,w),i.o.maximumByComponent(R,P,P);var y=h.lastBorderPoint;if(r.e(y)){var A=y.index;d.push(A,T-1,T,T,f,A)}h.lastBorderPoint=I}}return l((function(l,g){l.ellipsoid=n.t.clone(l.ellipsoid),l.rectangle=n.h.clone(l.rectangle);var m=function(l,g,m,p,v,I,E,f,T,N){var b,W,U,Y,k,L;r.e(p)?(b=p.west,W=p.south,U=p.east,Y=p.north,k=p.width,L=p.height):(b=o.e.toRadians(v.west),W=o.e.toRadians(v.south),U=o.e.toRadians(v.east),Y=o.e.toRadians(v.north),k=o.e.toRadians(p.width),L=o.e.toRadians(p.height));var O,V,H=[W,Y],D=[b,U],G=h.m.eastNorthUpToFixedFrame(g,m),z=u.p.inverseTransformation(G,C);f&&(O=c.t.geodeticLatitudeToMercatorAngle(W),V=1/(c.t.geodeticLatitudeToMercatorAngle(Y)-O));var j=new DataView(l),q=Number.POSITIVE_INFINITY,J=Number.NEGATIVE_INFINITY,K=B;K.x=Number.POSITIVE_INFINITY,K.y=Number.POSITIVE_INFINITY,K.z=Number.POSITIVE_INFINITY;var Q=_;Q.x=Number.NEGATIVE_INFINITY,Q.y=Number.NEGATIVE_INFINITY,Q.z=Number.NEGATIVE_INFINITY;var X,Z,$=0,ee=0,te=0;for(Z=0;Z<4;++Z){var ne=$;X=j.getUint32(ne,!0),ne+=w;var ie=o.e.toRadians(180*j.getFloat64(ne,!0));ne+=y,-1===A(D,ie)&&D.push(ie);var re=o.e.toRadians(180*j.getFloat64(ne,!0));ne+=y,-1===A(H,re)&&H.push(re),ne+=2*y;var ae=j.getInt32(ne,!0);ne+=S,ee+=ae,te+=3*(ae=j.getInt32(ne,!0)),$+=X+w}var oe=[],ue=[],se=new Array(ee),de=new Array(ee),he=new Array(ee),ce=f?new Array(ee):[],le=new Array(te),ge=[],me=[],pe=[],ve=[],Ie=0,Ee=0;for($=0,Z=0;Z<4;++Z){X=j.getUint32($,!0);var fe=$+=w,Te=o.e.toRadians(180*j.getFloat64($,!0));$+=y;var Ne=o.e.toRadians(180*j.getFloat64($,!0));$+=y;var be=o.e.toRadians(180*j.getFloat64($,!0)),xe=.5*be;$+=y;var Se=o.e.toRadians(180*j.getFloat64($,!0)),we=.5*Se;$+=y;var Pe=j.getInt32($,!0);$+=S;var ye=j.getInt32($,!0);$+=S,$+=S;for(var Ae=new Array(Pe),Me=0;Me<Pe;++Me){var Re=Te+j.getUint8($++)*be;M.longitude=Re;var Be=Ne+j.getUint8($++)*Se;M.latitude=Be;var _e=j.getFloat32($,!0);if($+=P,0!==_e&&_e<N&&(_e*=-Math.pow(2,T)),_e*=6371010*I,M.height=_e,-1!==A(D,Re)||-1!==A(H,Be)){var Ce=A(oe,M,i.a);if(-1!==Ce){Ae[Me]=ue[Ce];continue}oe.push(i.a.clone(M)),ue.push(Ie)}Ae[Me]=Ie,Math.abs(Re-b)<xe?ge.push({index:Ie,cartographic:i.a.clone(M)}):Math.abs(Re-U)<xe?pe.push({index:Ie,cartographic:i.a.clone(M)}):Math.abs(Be-W)<we?me.push({index:Ie,cartographic:i.a.clone(M)}):Math.abs(Be-Y)<we&&ve.push({index:Ie,cartographic:i.a.clone(M)}),q=Math.min(_e,q),J=Math.max(_e,J),he[Ie]=_e;var Fe=m.cartographicToCartesian(M);se[Ie]=Fe,f&&(ce[Ie]=(c.t.geodeticLatitudeToMercatorAngle(Be)-O)*V),u.p.multiplyByPoint(z,Fe,R),i.o.minimumByComponent(R,K,K),i.o.maximumByComponent(R,Q,Q);var We=(Re-b)/(U-b);We=o.e.clamp(We,0,1);var Ue=(Be-W)/(Y-W);Ue=o.e.clamp(Ue,0,1),de[Ie]=new n.o(We,Ue),++Ie}for(var Ye=3*ye,ke=0;ke<Ye;++ke,++Ee)le[Ee]=Ae[j.getUint16($,!0)],$+=x;if(X!==$-fe)throw new d.t("Invalid terrain tile.")}se.length=Ie,de.length=Ie,he.length=Ie,f&&(ce.length=Ie);var Le=Ie,Oe=Ee,Ve={hMin:q,lastBorderPoint:void 0,skirtHeight:E,toENU:z,ellipsoid:m,minimum:K,maximum:Q};ge.sort((function(e,t){return t.cartographic.latitude-e.cartographic.latitude})),me.sort((function(e,t){return e.cartographic.longitude-t.cartographic.longitude})),pe.sort((function(e,t){return e.cartographic.latitude-t.cartographic.latitude})),ve.sort((function(e,t){return t.cartographic.longitude-e.cartographic.longitude}));var He=1e-5;if(F(se,he,de,ce,le,Ve,ge,-He*k,!0,-He*L),F(se,he,de,ce,le,Ve,me,-He*L,!1),F(se,he,de,ce,le,Ve,pe,He*k,!0,He*L),F(se,he,de,ce,le,Ve,ve,He*L,!1),ge.length>0&&ve.length>0){var De=ge[0].index,Ge=Le,ze=ve[ve.length-1].index,je=se.length-1;le.push(ze,je,Ge,Ge,De,ze)}ee=se.length;var qe,Je=t.i.fromPoints(se);r.e(p)&&(qe=s.y.fromRectangle(p,q,J,m));for(var Ke=new a.s(m).computeHorizonCullingPointPossiblyUnderEllipsoid(g,se,q),Qe=new e.e(K,Q,g),Xe=new a.h(Qe,Ve.hMin,J,G,!1,f),Ze=new Float32Array(ee*Xe.getStride()),$e=0,et=0;et<ee;++et)$e=Xe.encode(Ze,$e,se[et],de[et],he[et],void 0,ce[et]);var tt=ge.map((function(e){return e.index})).reverse(),nt=me.map((function(e){return e.index})).reverse(),it=pe.map((function(e){return e.index})).reverse(),rt=ve.map((function(e){return e.index})).reverse();return nt.unshift(it[it.length-1]),nt.push(tt[0]),rt.unshift(tt[tt.length-1]),rt.push(it[0]),{vertices:Ze,indices:new Uint16Array(le),maximumHeight:J,minimumHeight:q,encoding:Xe,boundingSphere3D:Je,orientedBoundingBox:qe,occludeePointInScaledSpace:Ke,vertexCountWithoutSkirts:Le,indexCountWithoutSkirts:Oe,westIndicesSouthToNorth:tt,southIndicesEastToWest:nt,eastIndicesNorthToSouth:it,northIndicesWestToEast:rt}}(l.buffer,l.relativeToCenter,l.ellipsoid,l.rectangle,l.nativeRectangle,l.exaggeration,l.skirtHeight,l.includeWebMercatorT,l.negativeAltitudeExponentBias,l.negativeElevationThreshold),p=m.vertices;g.push(p.buffer);var v=m.indices;return g.push(v.buffer),{vertices:p.buffer,indices:v.buffer,numberOfAttributes:m.encoding.getStride(),minimumHeight:m.minimumHeight,maximumHeight:m.maximumHeight,boundingSphere3D:m.boundingSphere3D,orientedBoundingBox:m.orientedBoundingBox,occludeePointInScaledSpace:m.occludeePointInScaledSpace,encoding:m.encoding,vertexCountWithoutSkirts:m.vertexCountWithoutSkirts,indexCountWithoutSkirts:m.indexCountWithoutSkirts,westIndicesSouthToNorth:m.westIndicesSouthToNorth,southIndicesEastToWest:m.southIndicesEastToWest,eastIndicesNorthToSouth:m.eastIndicesNorthToSouth,northIndicesWestToEast:m.northIndicesWestToEast}}))}));
