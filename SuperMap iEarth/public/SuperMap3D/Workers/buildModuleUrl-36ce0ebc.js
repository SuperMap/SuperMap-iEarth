define(["exports","./Cartesian3-c1138337","./Cartographic-630e5de6","./Check-92c551fb","./defaultValue-2110bb17","./Ellipsoid-ca2b8eb1","./Math-cd1437d9","./FeatureDetection-e7fb956a","./PrimitiveType-d9ba7368","./Rectangle-52f780a9","./defer-a21481c0","./Event-589349b0","./RuntimeError-6daf0e01"],(function(e,t,r,n,o,i,a,s,u,c,p,f,l){"use strict";function h(e){this._ellipsoid=o.u(e,i.t.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}Object.defineProperties(h.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),h.prototype.project=function(e,r){var n=this._semimajorAxis,i=e.longitude*n,a=e.latitude*n,s=e.height;return o.e(r)?(r.x=i,r.y=a,r.z=s,r):new t.o(i,a,s)},h.prototype.unproject=function(e,t){if(!o.e(e))throw new n.t("cartesian is required");var i=this._oneOverSemimajorAxis,a=e.x*i,s=e.y*i,u=e.z;return o.e(t)?(t.longitude=a,t.latitude=s,t.height=u,t):new r.a(a,s,u)};var d=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1});function m(e,t){this.start=o.u(e,0),this.stop=o.u(t,0)}function y(e,r){this.center=t.o.clone(o.u(e,t.o.ZERO)),this.radius=o.u(r,0)}var v=new t.o,g=new t.o,q=new t.o,b=new t.o,w=new t.o,O=new t.o,R=new t.o,A=new t.o,x=new t.o,S=new t.o,_=new t.o,E=new t.o,C=4/3*a.e.PI;y.fromPoints=function(e,r){if(o.e(r)||(r=new y),!o.e(e)||0===e.length)return r.center=t.o.clone(t.o.ZERO,r.center),r.radius=0,r;var n,i=t.o.clone(e[0],R),a=t.o.clone(i,v),s=t.o.clone(i,g),u=t.o.clone(i,q),c=t.o.clone(i,b),p=t.o.clone(i,w),f=t.o.clone(i,O),l=e.length;for(n=1;n<l;n++){t.o.clone(e[n],i);var h=i.x,d=i.y,m=i.z;h<a.x&&t.o.clone(i,a),h>c.x&&t.o.clone(i,c),d<s.y&&t.o.clone(i,s),d>p.y&&t.o.clone(i,p),m<u.z&&t.o.clone(i,u),m>f.z&&t.o.clone(i,f)}var C=t.o.magnitudeSquared(t.o.subtract(c,a,A)),I=t.o.magnitudeSquared(t.o.subtract(p,s,A)),T=t.o.magnitudeSquared(t.o.subtract(f,u,A)),P=a,j=c,U=C;I>U&&(U=I,P=s,j=p),T>U&&(U=T,P=u,j=f);var B=x;B.x=.5*(P.x+j.x),B.y=.5*(P.y+j.y),B.z=.5*(P.z+j.z);var k=t.o.magnitudeSquared(t.o.subtract(j,B,A)),D=Math.sqrt(k),z=S;z.x=a.x,z.y=s.y,z.z=u.z;var L=_;L.x=c.x,L.y=p.y,L.z=f.z;var K=t.o.midpoint(z,L,E),M=0;for(n=0;n<l;n++){t.o.clone(e[n],i);var F=t.o.magnitude(t.o.subtract(i,K,A));F>M&&(M=F);var N=t.o.magnitudeSquared(t.o.subtract(i,B,A));if(N>k){var H=Math.sqrt(N);k=(D=.5*(D+H))*D;var V=H-D;B.x=(D*B.x+V*i.x)/H,B.y=(D*B.y+V*i.y)/H,B.z=(D*B.z+V*i.z)/H}}return D<M?(t.o.clone(B,r.center),r.radius=D):(t.o.clone(K,r.center),r.radius=M),r};var I=new h,T=new t.o,P=new t.o,j=new r.a,U=new r.a;y.fromRectangle2D=function(e,t,r){return y.fromRectangleWithHeights2D(e,t,0,0,r)},y.fromRectangleWithHeights2D=function(e,r,n,i,a){if(o.e(a)||(a=new y),!o.e(e))return a.center=t.o.clone(t.o.ZERO,a.center),a.radius=0,a;r=o.u(r,I),c.h.southwest(e,j),j.height=n,c.h.northeast(e,U),U.height=i;var s=r.project(j,T),u=r.project(U,P),p=u.x-s.x,f=u.y-s.y,l=u.z-s.z;a.radius=.5*Math.sqrt(p*p+f*f+l*l);var h=a.center;return h.x=s.x+.5*p,h.y=s.y+.5*f,h.z=s.z+.5*l,a};var B=[];y.fromRectangle3D=function(e,r,n,a){if(r=o.u(r,i.t.WGS84),n=o.u(n,0),o.e(a)||(a=new y),!o.e(e))return a.center=t.o.clone(t.o.ZERO,a.center),a.radius=0,a;var s=c.h.subsample(e,r,n,B);return y.fromPoints(s,a)},y.fromVertices=function(e,r,i,a){if(o.e(a)||(a=new y),!o.e(e)||0===e.length)return a.center=t.o.clone(t.o.ZERO,a.center),a.radius=0,a;r=o.u(r,t.o.ZERO),i=o.u(i,3),n.o.typeOf.number.greaterThanOrEquals("stride",i,3);var s=R;s.x=e[0]+r.x,s.y=e[1]+r.y,s.z=e[2]+r.z;var u,c=t.o.clone(s,v),p=t.o.clone(s,g),f=t.o.clone(s,q),l=t.o.clone(s,b),h=t.o.clone(s,w),d=t.o.clone(s,O),m=e.length;for(u=0;u<m;u+=i){var C=e[u]+r.x,I=e[u+1]+r.y,T=e[u+2]+r.z;s.x=C,s.y=I,s.z=T,C<c.x&&t.o.clone(s,c),C>l.x&&t.o.clone(s,l),I<p.y&&t.o.clone(s,p),I>h.y&&t.o.clone(s,h),T<f.z&&t.o.clone(s,f),T>d.z&&t.o.clone(s,d)}var P=t.o.magnitudeSquared(t.o.subtract(l,c,A)),j=t.o.magnitudeSquared(t.o.subtract(h,p,A)),U=t.o.magnitudeSquared(t.o.subtract(d,f,A)),B=c,k=l,D=P;j>D&&(D=j,B=p,k=h),U>D&&(D=U,B=f,k=d);var z=x;z.x=.5*(B.x+k.x),z.y=.5*(B.y+k.y),z.z=.5*(B.z+k.z);var L=t.o.magnitudeSquared(t.o.subtract(k,z,A)),K=Math.sqrt(L),M=S;M.x=c.x,M.y=p.y,M.z=f.z;var F=_;F.x=l.x,F.y=h.y,F.z=d.z;var N=t.o.midpoint(M,F,E),H=0;for(u=0;u<m;u+=i){s.x=e[u]+r.x,s.y=e[u+1]+r.y,s.z=e[u+2]+r.z;var V=t.o.magnitude(t.o.subtract(s,N,A));V>H&&(H=V);var Y=t.o.magnitudeSquared(t.o.subtract(s,z,A));if(Y>L){var J=Math.sqrt(Y);L=(K=.5*(K+J))*K;var X=J-K;z.x=(K*z.x+X*s.x)/J,z.y=(K*z.y+X*s.y)/J,z.z=(K*z.z+X*s.z)/J}}return K<H?(t.o.clone(z,a.center),a.radius=K):(t.o.clone(N,a.center),a.radius=H),a},y.fromEncodedCartesianVertices=function(e,r,n){if(o.e(n)||(n=new y),!o.e(e)||!o.e(r)||e.length!==r.length||0===e.length)return n.center=t.o.clone(t.o.ZERO,n.center),n.radius=0,n;var i=R;i.x=e[0]+r[0],i.y=e[1]+r[1],i.z=e[2]+r[2];var a,s=t.o.clone(i,v),u=t.o.clone(i,g),c=t.o.clone(i,q),p=t.o.clone(i,b),f=t.o.clone(i,w),l=t.o.clone(i,O),h=e.length;for(a=0;a<h;a+=3){var d=e[a]+r[a],m=e[a+1]+r[a+1],C=e[a+2]+r[a+2];i.x=d,i.y=m,i.z=C,d<s.x&&t.o.clone(i,s),d>p.x&&t.o.clone(i,p),m<u.y&&t.o.clone(i,u),m>f.y&&t.o.clone(i,f),C<c.z&&t.o.clone(i,c),C>l.z&&t.o.clone(i,l)}var I=t.o.magnitudeSquared(t.o.subtract(p,s,A)),T=t.o.magnitudeSquared(t.o.subtract(f,u,A)),P=t.o.magnitudeSquared(t.o.subtract(l,c,A)),j=s,U=p,B=I;T>B&&(B=T,j=u,U=f),P>B&&(B=P,j=c,U=l);var k=x;k.x=.5*(j.x+U.x),k.y=.5*(j.y+U.y),k.z=.5*(j.z+U.z);var D=t.o.magnitudeSquared(t.o.subtract(U,k,A)),z=Math.sqrt(D),L=S;L.x=s.x,L.y=u.y,L.z=c.z;var K=_;K.x=p.x,K.y=f.y,K.z=l.z;var M=t.o.midpoint(L,K,E),F=0;for(a=0;a<h;a+=3){i.x=e[a]+r[a],i.y=e[a+1]+r[a+1],i.z=e[a+2]+r[a+2];var N=t.o.magnitude(t.o.subtract(i,M,A));N>F&&(F=N);var H=t.o.magnitudeSquared(t.o.subtract(i,k,A));if(H>D){var V=Math.sqrt(H);D=(z=.5*(z+V))*z;var Y=V-z;k.x=(z*k.x+Y*i.x)/V,k.y=(z*k.y+Y*i.y)/V,k.z=(z*k.z+Y*i.z)/V}}return z<F?(t.o.clone(k,n.center),n.radius=z):(t.o.clone(M,n.center),n.radius=F),n},y.fromCornerPoints=function(e,r,i){n.o.typeOf.object("corner",e),n.o.typeOf.object("oppositeCorner",r),o.e(i)||(i=new y);var a=t.o.midpoint(e,r,i.center);return i.radius=t.o.distance(a,r),i},y.fromEllipsoid=function(e,r){return n.o.typeOf.object("ellipsoid",e),o.e(r)||(r=new y),t.o.clone(t.o.ZERO,r.center),r.radius=e.maximumRadius,r};var k=new t.o;y.fromBoundingSpheres=function(e,r){if(o.e(r)||(r=new y),!o.e(e)||0===e.length)return r.center=t.o.clone(t.o.ZERO,r.center),r.radius=0,r;var n=e.length;if(1===n)return y.clone(e[0],r);if(2===n)return y.union(e[0],e[1],r);var i,a=[];for(i=0;i<n;i++)a.push(e[i].center);var s=(r=y.fromPoints(a,r)).center,u=r.radius;for(i=0;i<n;i++){var c=e[i];u=Math.max(u,t.o.distance(s,c.center,k)+c.radius)}return r.radius=u,r};var D=new t.o,z=new t.o,L=new t.o;y.fromOrientedBoundingBox=function(e,r){n.o.defined("orientedBoundingBox",e),o.e(r)||(r=new y);var i=e.halfAxes,a=s.p.getColumn(i,0,D),u=s.p.getColumn(i,1,z),c=s.p.getColumn(i,2,L);return t.o.add(a,u,a),t.o.add(a,c,a),r.center=t.o.clone(e.center,r.center),r.radius=t.o.magnitude(a),r},y.clone=function(e,r){if(o.e(e))return o.e(r)?(r.center=t.o.clone(e.center,r.center),r.radius=e.radius,r):new y(e.center,e.radius)},y.packedLength=4,y.pack=function(e,t,r){n.o.typeOf.object("value",e),n.o.defined("array",t),r=o.u(r,0);var i=e.center;return t[r++]=i.x,t[r++]=i.y,t[r++]=i.z,t[r]=e.radius,t},y.unpack=function(e,t,r){n.o.defined("array",e),t=o.u(t,0),o.e(r)||(r=new y);var i=r.center;return i.x=e[t++],i.y=e[t++],i.z=e[t++],r.radius=e[t],r};var K=new t.o,M=new t.o;y.union=function(e,r,i){n.o.typeOf.object("left",e),n.o.typeOf.object("right",r),o.e(i)||(i=new y);var a=e.center,s=e.radius,u=r.center,c=r.radius,p=t.o.subtract(u,a,K),f=t.o.magnitude(p);if(s>=f+c)return e.clone(i),i;if(c>=f+s)return r.clone(i),i;var l=.5*(s+f+c),h=t.o.multiplyByScalar(p,(-s+l)/f,M);return t.o.add(h,a,h),t.o.clone(h,i.center),i.radius=l,i};var F=new t.o;y.expand=function(e,r,o){n.o.typeOf.object("sphere",e),n.o.typeOf.object("point",r),o=y.clone(e,o);var i=t.o.magnitude(t.o.subtract(r,o.center,F));return i>o.radius&&(o.radius=i),o},y.intersectPlane=function(e,r){n.o.typeOf.object("sphere",e),n.o.typeOf.object("plane",r);var o=e.center,i=e.radius,a=r.normal,s=t.o.dot(a,o)+r.distance;return s<-i?d.OUTSIDE:s<i?d.INTERSECTING:d.INSIDE},y.transform=function(e,t,r){return n.o.typeOf.object("sphere",e),n.o.typeOf.object("transform",t),o.e(r)||(r=new y),r.center=u.y.multiplyByPoint(t,e.center,r.center),r.radius=u.y.getMaximumScale(t)*e.radius,r};var N=new t.o;y.distanceSquaredTo=function(e,r){n.o.typeOf.object("sphere",e),n.o.typeOf.object("cartesian",r);var o=t.o.subtract(e.center,r,N);return t.o.magnitudeSquared(o)-e.radius*e.radius},y.transformWithoutScale=function(e,t,r){return n.o.typeOf.object("sphere",e),n.o.typeOf.object("transform",t),o.e(r)||(r=new y),r.center=u.y.multiplyByPoint(t,e.center,r.center),r.radius=e.radius,r};var H=new t.o;y.computePlaneDistances=function(e,r,i,a){n.o.typeOf.object("sphere",e),n.o.typeOf.object("position",r),n.o.typeOf.object("direction",i),o.e(a)||(a=new m);var s=t.o.subtract(e.center,r,H),u=t.o.dot(i,s);return a.start=u-e.radius,a.stop=u+e.radius,a};for(var V=new t.o,Y=new t.o,J=new t.o,X=new t.o,G=new t.o,Q=new r.a,Z=new Array(8),W=0;W<8;++W)Z[W]=new t.o;var $=new h;function ee(e){if(e instanceof ee)this.scheme=e.scheme,this.authority=e.authority,this.path=e.path,this.query=e.query,this.fragment=e.fragment;else if(e){var t=te.exec(e);this.scheme=t[1],this.authority=t[2],this.path=t[3],this.query=t[4],this.fragment=t[5]}}y.projectTo2D=function(e,r,i){n.o.typeOf.object("sphere",e);var a,s=(r=o.u(r,$)).ellipsoid,u=e.center,c=e.radius;a=t.o.equals(u,t.o.ZERO)?t.o.clone(t.o.UNIT_X,V):s.geodeticSurfaceNormal(u,V);var p=t.o.cross(t.o.UNIT_Z,a,Y);t.o.normalize(p,p);var f=t.o.cross(a,p,J);t.o.normalize(f,f),t.o.multiplyByScalar(a,c,a),t.o.multiplyByScalar(f,c,f),t.o.multiplyByScalar(p,c,p);var l=t.o.negate(f,G),h=t.o.negate(p,X),d=Z,m=d[0];t.o.add(a,f,m),t.o.add(m,p,m),m=d[1],t.o.add(a,f,m),t.o.add(m,h,m),m=d[2],t.o.add(a,l,m),t.o.add(m,h,m),m=d[3],t.o.add(a,l,m),t.o.add(m,p,m),t.o.negate(a,a),m=d[4],t.o.add(a,f,m),t.o.add(m,p,m),m=d[5],t.o.add(a,f,m),t.o.add(m,h,m),m=d[6],t.o.add(a,l,m),t.o.add(m,h,m),m=d[7],t.o.add(a,l,m),t.o.add(m,p,m);for(var v=d.length,g=0;g<v;++g){var q=d[g];t.o.add(u,q,q);var b=s.cartesianToCartographic(q,Q);r.project(b,q)}var w=(u=(i=y.fromPoints(d,i)).center).x,O=u.y,R=u.z;return u.x=R,u.y=w,u.z=O,i},y.isOccluded=function(e,t){return n.o.typeOf.object("sphere",e),n.o.typeOf.object("occluder",t),!t.isBoundingSphereVisible(e)},y.equals=function(e,r){return e===r||o.e(e)&&o.e(r)&&t.o.equals(e.center,r.center)&&e.radius===r.radius},y.prototype.intersectPlane=function(e){return y.intersectPlane(this,e)},y.prototype.distanceSquaredTo=function(e){return y.distanceSquaredTo(this,e)},y.prototype.computePlaneDistances=function(e,t,r){return y.computePlaneDistances(this,e,t,r)},y.prototype.isOccluded=function(e){return y.isOccluded(this,e)},y.prototype.equals=function(e){return y.equals(this,e)},y.prototype.clone=function(e){return y.clone(this,e)},y.prototype.volume=function(){var e=this.radius;return C*e*e*e},ee.prototype.scheme=null,ee.prototype.authority=null,ee.prototype.path="",ee.prototype.query=null,ee.prototype.fragment=null;var te=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$");ee.prototype.getScheme=function(){return this.scheme},ee.prototype.getAuthority=function(){return this.authority},ee.prototype.getPath=function(){return this.path},ee.prototype.getQuery=function(){return this.query},ee.prototype.getFragment=function(){return this.fragment},ee.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment},ee.prototype.isSameDocumentAs=function(e){return e.scheme==this.scheme&&e.authority==this.authority&&e.path==this.path&&e.query==this.query},ee.prototype.equals=function(e){return this.isSameDocumentAs(e)&&e.fragment==this.fragment},ee.prototype.normalize=function(){this.removeDotSegments(),this.scheme&&(this.scheme=this.scheme.toLowerCase()),this.authority&&(this.authority=this.authority.replace(oe,ae).replace(re,ie)),this.path&&(this.path=this.path.replace(re,ie)),this.query&&(this.query=this.query.replace(re,ie)),this.fragment&&(this.fragment=this.fragment.replace(re,ie))};var re=/%[0-9a-z]{2}/gi,ne=/[a-zA-Z0-9\-\._~]/,oe=/(.*@)?([^@:]*)(:.*)?/;function ie(e){var t=unescape(e);return ne.test(t)?t:e.toUpperCase()}function ae(e,t,r,n){return(t||"")+r.toLowerCase()+(n||"")}function se(e,t){if(null===e||"object"!=typeof e)return e;t=o.u(t,!1);var r=new e.constructor;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];t&&(i=se(i,t)),r[n]=i}return r}function ue(e,t,r){r=o.u(r,!1);var n,i,a,s={},u=o.e(e),c=o.e(t);if(u)for(n in e)e.hasOwnProperty(n)&&(i=e[n],c&&r&&"object"==typeof i&&t.hasOwnProperty(n)?(a=t[n],s[n]="object"==typeof a?ue(i,a,r):i):s[n]=i);if(c)for(n in t)t.hasOwnProperty(n)&&!s.hasOwnProperty(n)&&(a=t[n],s[n]=a);return s}function ce(e,t){var r;return typeof document<"u"&&(r=document),ce._implementation(e,t,r)}ee.prototype.resolve=function(e){var t=new ee;return this.scheme?(t.scheme=this.scheme,t.authority=this.authority,t.path=this.path,t.query=this.query):(t.scheme=e.scheme,this.authority?(t.authority=this.authority,t.path=this.path,t.query=this.query):(t.authority=e.authority,""==this.path?(t.path=e.path,t.query=this.query||e.query):("/"==this.path.charAt(0)?(t.path=this.path,t.removeDotSegments()):(e.authority&&""==e.path?t.path="/"+this.path:t.path=e.path.substring(0,e.path.lastIndexOf("/")+1)+this.path,t.removeDotSegments()),t.query=this.query))),t.fragment=this.fragment,t},ee.prototype.removeDotSegments=function(){var e,t=this.path.split("/"),r=[],n=""==t[0];n&&t.shift();for(""==t[0]&&t.shift();t.length;)".."==(e=t.shift())?r.pop():"."!=e&&r.push(e);("."==e||".."==e)&&r.push(""),n&&r.unshift(""),this.path=r.join("/")},ee.prototype.toString=function(){var e="";return this.scheme&&(e+=this.scheme+":"),this.authority&&(e+="//"+this.authority),e+=this.path,this.query&&(e+="?"+this.query),this.fragment&&(e+="#"+this.fragment),e},ce._implementation=function(e,t,r){if(!o.e(e))throw new n.t("relative uri is required.");if(!o.e(t)){if(typeof r>"u")return e;t=o.u(r.baseURI,r.location.href)}var i=new ee(t);return new ee(e).resolve(i).toString()};var pe,fe=/^blob:/i;function le(e){return n.o.typeOf.string("uri",e),fe.test(e)}var he=/^data:/i;function de(e){return n.o.typeOf.string("uri",e),he.test(e)}var me=Object.freeze({UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5}),ye=Object.freeze({TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3,PACK:4,BLOCK:5,BLOCKPACK:6});function ve(e){e=o.u(e,o.u.EMPTY_OBJECT);var t=o.u(e.throttleByServer,!1),r=o.u(e.throttle,!1);this.url=e.url,this.requestFunction=e.requestFunction,this.cancelFunction=e.cancelFunction,this.priorityFunction=e.priorityFunction,this.priority=o.u(e.priority,0),this.throttle=r,this.throttleByServer=t,this.type=o.u(e.type,ye.OTHER),this.serverKey=void 0,this.state=me.UNISSUED,this.deferred=void 0,this.cancelled=!1}function ge(e,t,r){this.statusCode=e,this.response=t,this.responseHeaders=r,"string"==typeof this.responseHeaders&&(this.responseHeaders=function(e){var t={};if(!e)return t;for(var r=e.split("\r\n"),n=0;n<r.length;++n){var o=r[n],i=o.indexOf(": ");if(i>0){var a=o.substring(0,i),s=o.substring(i+2);t[a]=s}}return t}(this.responseHeaders))}function qe(e){n.o.typeOf.object("options",e),n.o.defined("options.comparator",e.comparator),this._comparator=e.comparator,this._array=[],this._length=0,this._maximumLength=void 0}function be(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}ve.prototype.cancel=function(){this.cancelled=!0},ve.prototype.clone=function(e){return o.e(e)?(e.url=this.url,e.requestFunction=this.requestFunction,e.cancelFunction=this.cancelFunction,e.priorityFunction=this.priorityFunction,e.priority=this.priority,e.throttle=this.throttle,e.throttleByServer=this.throttleByServer,e.type=this.type,e.serverKey=this.serverKey,e.state=this.RequestState.UNISSUED,e.deferred=void 0,e.cancelled=!1,e):new ve(this)},ge.prototype.toString=function(){var e="Request has failed.";return o.e(this.statusCode)&&(e+=" Status Code: "+this.statusCode),e},Object.defineProperties(qe.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(e){this._maximumLength=e,this._length>e&&e>0&&(this._length=e,this._array.length=e)}},comparator:{get:function(){return this._comparator}}}),qe.prototype.reserve=function(e){e=o.u(e,this._length),this._array.length=e},qe.prototype.heapify=function(e){e=o.u(e,0);for(var t=this._length,r=this._comparator,n=this._array,i=-1,a=!0;a;){var s=2*(e+1),u=s-1;i=u<t&&r(n[u],n[e])<0?u:e,s<t&&r(n[s],n[i])<0&&(i=s),i!==e?(be(n,i,e),e=i):a=!1}},qe.prototype.resort=function(){for(var e=this._length,t=Math.ceil(e/2);t>=0;--t)this.heapify(t)},qe.prototype.insert=function(e){n.o.defined("element",e);var t,r=this._array,i=this._comparator,a=this._maximumLength,s=this._length++;for(s<r.length?r[s]=e:r.push(e);0!==s;){var u=Math.floor((s-1)/2);if(!(i(r[s],r[u])<0))break;be(r,s,u),s=u}return o.e(a)&&this._length>a&&(t=r[a],r.pop(),this._length=a),t},qe.prototype.pop=function(e){if(e=o.u(e,0),0!==this._length){n.o.typeOf.number.lessThan("index",e,this._length);var t=this._array,r=t[e];return be(t,e,--this._length),t[this._length]=void 0,this.heapify(e),r}};var we=typeof performance<"u"&&"function"==typeof performance.now&&isFinite(performance.now())?function(){return performance.now()}:function(){return Date.now()};function Oe(e,t){return e.priority-t.priority}var Re={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0,totalRequestTime:0},Ae=20,xe=new qe({comparator:Oe});xe.maximumLength=Ae,xe.reserve(Ae);var Se=[],_e={},Ee=typeof document<"u"?new ee(document.location.href):new ee,Ce=new f.o;function Ie(){}function Te(e){o.e(e.priorityFunction)&&(e.priority=e.priorityFunction())}function Pe(e){return o.e(e.packKey)||(e.packKey=e.serverKey+"_"+e.providerName),e.packKey}function je(e){return o.e(e.blockKey)||(e.blockKey=e.serverKey+"_"+e.providerName+"_"+e.quadKey+e.url.substring(e.url.indexOf("dataVersion"))),e.blockKey}function Ue(e){var t=Pe(e);return o.e(Ie.packRequestGroup[t])||(Ie.packRequestGroup[t]=[]),o.e(Ie.packRequestQuadKey[t])||(Ie.packRequestQuadKey[t]=""),o.e(Ie.packRequestPromise[t])||(Ie.packRequestPromise[t]=p.s()),o.e(Ie.quadKeyIndex[t])||(Ie.quadKeyIndex[t]=0),e.quadKeyIndex=Ie.quadKeyIndex[t]++,e.deferred=Ie.packRequestPromise[t],e.state=me.ISSUED,Ie.packRequestGroup[t].push(e),e.deferred.promise}function Be(e){for(var t=0,r=e.length;t<r;t++){e[t].state=me.CANCELLED}}function ke(e){for(var t=[],r={},n=0,o=e.length;n<o;n++){var i=e[n];if(!i.cancelled){var a=i.quadKey;r[a]||(r[a]=!0,t.push(a))}}return t}function De(){var e=Ie.packRequestGroup;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];if(r.length<1)continue;var n=r[0].clone(),i=-1!==n.url.indexOf("rest/maps");n.serverKey=r[0].serverKey,n.state=r[0].state;var a=n.url,s=ke(r);if(s.length<1)continue;Ie.packRequestQuadKey[t]=i?s.join(","):s.join(";");var u=Ie.packRequestQuadKey[t];if(n.throttleByServer&&!Ie.serverHasOpenSlots(n.serverKey)){Be(r),Ie.packRequestPromise[t].reject();continue}n.deferred=Ie.packRequestPromise[t];var c=new ee(a);c.query=i?o.e(c.query)?c.query+"&tiles="+u:"tiles="+u:o.e(c.query)?c.query+"&extratiles="+u:"extratiles="+u,n.url=c.toString(),Ke(n,n.url)}Ie.packRequestGroup={},Ie.packRequestPromise={},Ie.packRequestQuadKey={},Ie.quadKeyIndex={}}function ze(){var e=Ie.blockRequest;for(var t in e)if(e.hasOwnProperty(t)){Ke(e[t])}Ie.blockRequest={}}function Le(e){if(e.state===me.UNISSUED)if(e.state=me.ISSUED,e.type===ye.PACK||e.type===ye.BLOCKPACK){var t=Pe(e);o.e(Ie.packRequestPromise[t])||(Ie.packRequestPromise[t]=p.s()),e.deferred=Ie.packRequestPromise[t]}else e.deferred=p.s();return e.deferred.promise}function Ke(e,t){var r=Le(e);return e.state=me.ACTIVE,Se.push(e),++Re.numberOfActiveRequests,++Re.numberOfActiveRequestsEver,++_e[e.serverKey],e.startTime=we(),e.requestFunction(t).then(function(e){return function(t){if(e.state!==me.CANCELLED&&(--Re.numberOfActiveRequests,--_e[e.serverKey],Ce.raiseEvent(),e.state=me.RECEIVED,e.deferred.resolve(t),e.endTime=we(),(Ie.statisticRequestTime>0||e.type!==ye.OTHER)&&(Re.totalRequestTime+=e.endTime-e.startTime),e.type===ye.BLOCK||e.type===ye.BLOCKPACK)){var r=je(e);o.e(Ie.blockDefer[r])&&(Ie.blockDefer[r]=void 0,delete Ie.blockDefer[r])}}}(e)).catch(function(e){return function(t){e.state!==me.CANCELLED&&(++Re.numberOfFailedRequests,--Re.numberOfActiveRequests,--_e[e.serverKey],Ce.raiseEvent(t),e.state=me.FAILED,e.deferred.reject(t))}}(e)),r}function Me(e){var t=e.state===me.ACTIVE;e.state=me.CANCELLED,++Re.numberOfCancelledRequests,e.deferred.reject(),t&&(--Re.numberOfActiveRequests,--_e[e.serverKey],++Re.numberOfCancelledActiveRequests),o.e(e.cancelFunction)&&e.cancelFunction()}Ie.TIMEOUT=5e3,Ie.CANCLE_COUNT=3,Ie.statisticRequestTime=-1,Ie.maximumRequests=50,Ie.maximumRequestsPerServer=6,Ie.perPacketCount=20,Ie.requestsByServer={},Ie.throttleRequests=!0,Ie.debugShowStatistics=!1,Ie.requestCompletedEvent=Ce,Object.defineProperties(Ie,{activeRequestLength:{get:function(){return Se.length}},statistics:{get:function(){return Re}},priorityHeapLength:{get:function(){return Ae},set:function(e){if(e<Ae)for(;xe.length>e;){Me(xe.pop())}Ae=e,xe.maximumLength=e,xe.reserve(e)}}}),Ie.serverHasOpenSlots=function(e,t){t=o.u(t,1);const r=o.u(Ie.requestsByServer[e],Ie.maximumRequestsPerServer);return _e[e]+t<=r},Ie.heapHasOpenSlots=function(e){return xe.length+e<=Ae},Ie.packRequestGroup={},Ie.packRequestPromise={},Ie.packRequestQuadKey={},Ie.quadKeyIndex={},Ie.packRequestHeap={},Ie.blockDefer={},Ie.blockRequest={},Ie.update=function(){var e,t,r=0,n=Se.length;for(e=0;e<n;++e)(t=Se[e]).cancelled&&Me(t),t.state===me.ACTIVE?r>0&&(Se[e-r]=t):++r;Se.length-=r;var o=xe.internalArray,i=xe.length;for(e=0;e<i;++e)Te(o[e]);xe.resort(),function(){for(var e in Ie.packRequestHeap)if(Ie.packRequestHeap.hasOwnProperty(e)){for(var t=Ie.packRequestHeap[e],r=t.internalArray,n=t.length,o=0;o<n;++o)Te(r[o]);t.resort()}}(),ze(),function(){for(var e in Ie.packRequestHeap)if(Ie.packRequestHeap.hasOwnProperty(e))for(var t=Ie.packRequestHeap[e];t.length>0;){var r=t.pop();r.cancelled?Me(r):Ue(r)}De()}();for(var a=Math.max(Ie.maximumRequests-Se.length,0),s=0;s<a&&xe.length>0;)(t=xe.pop()).cancelled?Me(t):!t.throttleByServer||Ie.serverHasOpenSlots(t.serverKey)?(Ke(t),++s):Me(t);!Ie.debugShowStatistics||(0===Re.numberOfActiveRequests&&Re.lastNumberOfActiveRequests>0&&(Re.numberOfAttemptedRequests>0&&(console.log("Number of attempted requests: "+Re.numberOfAttemptedRequests),Re.numberOfAttemptedRequests=0),Re.numberOfCancelledRequests>0&&(console.log("Number of cancelled requests: "+Re.numberOfCancelledRequests),Re.numberOfCancelledRequests=0),Re.numberOfCancelledActiveRequests>0&&(console.log("Number of cancelled active requests: "+Re.numberOfCancelledActiveRequests),Re.numberOfCancelledActiveRequests=0),Re.numberOfFailedRequests>0&&(console.log("Number of failed requests: "+Re.numberOfFailedRequests),Re.numberOfFailedRequests=0)),Re.lastNumberOfActiveRequests=Re.numberOfActiveRequests)},Ie.getServerKey=function(e){n.o.typeOf.string("url",e);var t=new ee(e).resolve(Ee);t.normalize();var r=t.authority;/:/.test(r)||(r=r+":"+("https"===t.scheme?"443":"80"));var i=_e[r];return o.e(i)||(_e[r]=0),r},Ie.request=function(e){if(n.o.typeOf.object("request",e),n.o.typeOf.string("request.url",e.url),n.o.typeOf.func("request.requestFunction",e.requestFunction),de(e.url)||le(e.url))return Ce.raiseEvent(),e.state=me.RECEIVED,e.requestFunction();if(++Re.numberOfAttemptedRequests,o.e(e.serverKey)||(e.serverKey=Ie.getServerKey(e.url)),e.type===ye.BLOCK)return function(e){var t=je(e),r=Ie.blockDefer[t];return o.e(r)||(r=Ie.blockDefer[t]=p.s(),Ie.blockRequest[t]=e),e.deferred=r,e.state=me.ISSUED,e.deferred.promise}(e);if(!e.throttleByServer||Ie.serverHasOpenSlots(e.serverKey)){if(!Ie.throttleRequests||!e.throttle)return Ke(e);if(!(Se.length>=Ie.maximumRequests)){var t;if(Te(e),e.type===ye.PACK||e.type===ye.BLOCKPACK){var r=function(e){var t=Pe(e),r=Ie.packRequestHeap[t];return o.e(r)||((r=Ie.packRequestHeap[t]=new qe({comparator:Oe})).maximumLength=Ie.perPacketCount,r.reserve(Ae)),r}(e),i=!0;if(e.type===ye.BLOCKPACK)for(var a=0;a<r.length;a++)if(r._array[a].quadKey===e.quadKey){e.blockRequest=r._array[a],i=!1;break}i&&(t=r.insert(e))}else t=xe.insert(e);if(o.e(t)){if(t===e)return;Me(t)}return Le(e)}}},Ie.clearForSpecs=function(){for(;xe.length>0;){Me(xe.pop())}for(var e=Se.length,t=0;t<e;++t)Me(Se[t]);Se.length=0,_e={},Re.numberOfAttemptedRequests=0,Re.numberOfActiveRequests=0,Re.numberOfCancelledRequests=0,Re.numberOfCancelledActiveRequests=0,Re.numberOfFailedRequests=0,Re.numberOfActiveRequestsEver=0,Re.lastNumberOfActiveRequests=0,Re.totalRequestTime=0},Ie.numberOfActiveRequestsByServer=function(e){return _e[e]},Ie.requestHeap=xe;var Fe={},Ne={};Fe.add=function(e,t){if(!o.e(e))throw new n.t("host is required.");if(!o.e(t)||t<=0)throw new n.t("port is required to be greater than 0.");var r=e.toLowerCase()+":"+t;o.e(Ne[r])||(Ne[r]=!0)},Fe.remove=function(e,t){if(!o.e(e))throw new n.t("host is required.");if(!o.e(t)||t<=0)throw new n.t("port is required to be greater than 0.");var r=e.toLowerCase()+":"+t;o.e(Ne[r])&&delete Ne[r]},Fe.contains=function(e){if(!o.e(e))throw new n.t("url is required.");var t=function(e){var t=new ee(e);t.normalize();var r=t.getAuthority();if(o.e(r)){if(-1!==r.indexOf("@")){var n=r.split("@");r=n[1]}if(-1===r.indexOf(":")){var i=t.getScheme();if(o.e(i)||(i=(i=window.location.protocol).substring(0,i.length-1)),"http"===i)r+=":80";else{if("https"!==i)return;r+=":443"}}return r}}(e);return!(!o.e(t)||!o.e(Ne[t]))},Fe.clear=function(){Ne={}};var He,Ve=function(){try{var e=new XMLHttpRequest;return e.open("GET","#",!0),e.responseType="blob","blob"===e.responseType}catch{return!1}}();function Ye(e,t,r,i){var a,s=e.query;if(!o.e(s)||0===s.length)return{};if(-1===s.indexOf("=")){var u={};u[s]=void 0,a=u}else a=function(e){if(!o.e(e))throw new n.t("queryString is required.");var t={};if(""===e)return t;for(var r=e.replace(/\+/g,"%20").split(/[&;]/),i=0,a=r.length;i<a;++i){var s=r[i].split("=");if(s.length>2){var u=r[i].indexOf("=");s=[r[i].substring(0,u),r[i].substring(u+1,r[i].length)]}var c=decodeURIComponent(s[0]),p=s[1];p=o.e(p)?decodeURIComponent(p):"";var f=t[c];"string"==typeof f?t[c]=[f,p]:Array.isArray(f)?f.push(p):t[c]=p}return t}(s);t._queryParameters=r?Qe(a,t._queryParameters,i):a,e.query=void 0}function Je(e,t){var r=t._queryParameters,i=Object.keys(r);1!==i.length||o.e(r[i[0]])?e.query=function(e,t){if(!o.e(e))throw new n.t("obj is required.");var r="";for(var i in e)if(e.hasOwnProperty(i)){var a=e[i],s=encodeURIComponent(i)+"=";if(Array.isArray(a))for(var u=0,c=a.length;u<c;++u)r+=!0===t?s+encodeURI(a[u])+"&":s+encodeURIComponent(a[u])+"&";else r+=!0===t?s+encodeURI(a)+"&":s+encodeURIComponent(a)+"&"}return r.slice(0,-1)}(r):e.query=i[0]}function Xe(e,t){return o.e(e)?o.e(e.clone)?e.clone():se(e):t}function Ge(e){if(e.state===me.ISSUED||e.state===me.ACTIVE)throw new l.t("The Resource is already being fetched.");e.state=me.UNISSUED,e.deferred=void 0}function Qe(e,t,r){if(!r)return ue(e,t);var n=se(e,!0);for(var i in t)if(t.hasOwnProperty(i)){var a=n[i],s=t[i];o.e(a)?(Array.isArray(a)||(a=n[i]=[a]),n[i]=a.concat(s)):n[i]=Array.isArray(s)?s.slice():s}return n}function Ze(e){"string"==typeof(e=o.u(e,o.u.EMPTY_OBJECT))&&(e={url:e}),n.o.typeOf.string("options.url",e.url),this._url=void 0,this._templateValues=Xe(e.templateValues,{}),this._queryParameters=Xe(e.queryParameters,{}),this.headers=Xe(e.headers,{}),this.request=o.u(e.request,new ve),this.proxy=e.proxy,this.retryCallback=e.retryCallback,this.retryAttempts=o.u(e.retryAttempts,0),this._retryCount=0;var t=new ee(e.url);Ye(t,this,!0,!0),t.fragment=void 0,this._url=t.toString()}function We(e){var t=e.resource,r=e.flipY,n=e.preferImageBitmap,i=t.request;i.url=t.url,i.requestFunction=function(){var e=!1;!t.isDataUri&&!t.isBlobUri&&(e=t.isCrossOriginUrl);var o=p.s();return Ze._Implementations.createImage(i,e,o,r,n),o.promise};var a=Ie.request(i);if(o.e(a))return a.catch((function(e){return i.state!==me.FAILED?Promise.reject(e):t.retryOnError(e).then((function(o){return o?(i.state=me.UNISSUED,i.deferred=void 0,We({resource:t,flipY:r,preferImageBitmap:n})):Promise.reject(e)}))}))}function $e(e,t,r){var n={};n[t]=r,e.setQueryParameters(n);var i=e.request;i.url=e.url,i.requestFunction=function(){var t=p.s();return window[r]=function(e){t.resolve(e);try{delete window[r]}catch{window[r]=void 0}},Ze._Implementations.loadAndExecuteScript(e.url,r,t),t.promise};var a=Ie.request(i);if(o.e(a))return a.catch((function(n){return i.state!==me.FAILED?Promise.reject(n):e.retryOnError(n).then((function(o){return o?(i.state=me.UNISSUED,i.deferred=void 0,$e(e,t,r)):Promise.reject(n)}))}))}Ze.createIfNeeded=function(e){return e instanceof Ze?e.getDerivedResource({request:e.request}):"string"!=typeof e?e:new Ze({url:e})},Ze.supportsImageBitmapOptions=function(){if(o.e(He))return He;if("function"!=typeof createImageBitmap)return He=Promise.resolve(!1);return He=Ze.fetchBlob({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWP4////fwAJ+wP9CNHoHgAAAABJRU5ErkJggg=="}).then((function(e){return createImageBitmap(e,{imageOrientation:"flipY",premultiplyAlpha:"none"})})).then((function(e){return!0})).catch((function(){return!1})),He},Object.defineProperties(Ze,{isBlobSupported:{get:function(){return Ve}}}),Object.defineProperties(Ze.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(e){var t=new ee(e);Ye(t,this,!1),t.fragment=void 0,this._url=t.toString()}},extension:{get:function(){return function(e){if(!o.e(e))throw new n.t("uri is required.");var t=new ee(e);t.normalize();var r=t.path,i=r.lastIndexOf("/");return-1!==i&&(r=r.substr(i+1)),i=r.lastIndexOf("."),-1===i?"":r.substr(i+1)}(this._url)}},isDataUri:{get:function(){return de(this._url)}},isBlobUri:{get:function(){return le(this._url)}},isCrossOriginUrl:{get:function(){return function(e){o.e(pe)||(pe=document.createElement("a")),pe.href=window.location.href;var t=pe.host,r=pe.protocol;return pe.href=e,pe.href=pe.href,r!==pe.protocol||t!==pe.host}(this._url)}},hasHeaders:{get:function(){return Object.keys(this.headers).length>0}}}),Ze.prototype.getUrlComponent=function(e,t){if(this.isDataUri)return this._url;var r=new ee(this._url);e&&Je(r,this);var n=r.toString().replace(/%7B/g,"{").replace(/%7D/g,"}"),i=this._templateValues;return n=n.replace(/{(.*?)}/g,(function(e,t){var r=i[t];return o.e(r)&&"s"==t?encodeURI(r):o.e(r)?encodeURIComponent(r):e})),t&&o.e(this.proxy)&&(n=this.proxy.getURL(n)),n},Ze.prototype.setQueryParameters=function(e,t){this._queryParameters=t?Qe(this._queryParameters,e,!1):Qe(e,this._queryParameters,!1)},Ze.prototype.appendQueryParameters=function(e){this._queryParameters=Qe(e,this._queryParameters,!0)},Ze.prototype.setTemplateValues=function(e,t){this._templateValues=t?ue(this._templateValues,e):ue(e,this._templateValues)},Ze.prototype.getDerivedResource=function(e){var t=this.clone();if(t._retryCount=0,o.e(e.url)){var r=new ee(e.url);Ye(r,t,!0,o.u(e.preserveQueryParameters,!1)),r.fragment=void 0,t._url=r.resolve(new ee(ce(this._url))).toString()}return o.e(e.queryParameters)&&(t._queryParameters=ue(e.queryParameters,t._queryParameters)),o.e(e.templateValues)&&(t._templateValues=ue(e.templateValues,t.templateValues)),o.e(e.headers)&&(t.headers=ue(e.headers,t.headers)),o.e(e.proxy)&&(t.proxy=e.proxy),o.e(e.request)&&(t.request=e.request),o.e(e.retryCallback)&&(t.retryCallback=e.retryCallback),o.e(e.retryAttempts)&&(t.retryAttempts=e.retryAttempts),t},Ze.prototype.retryOnError=function(e){var t=this.retryCallback;if("function"!=typeof t||this._retryCount>=this.retryAttempts)return Promise.resolve(!1);var r=this;return Promise.resolve(t(this,e)).then((function(e){return++r._retryCount,e}))},Ze.prototype.clone=function(e){return o.e(e)||(e=new Ze({url:this._url})),e._url=this._url,e._queryParameters=se(this._queryParameters),e._templateValues=se(this._templateValues),e.headers=se(this.headers),e.proxy=this.proxy,e.retryCallback=this.retryCallback,e.retryAttempts=this.retryAttempts,e._retryCount=0,e.request=this.request.clone(),e},Ze.prototype.getBaseUri=function(e){return function(e,t){if(!o.e(e))throw new n.t("uri is required.");var r="",i=e.lastIndexOf("/");return-1!==i&&(r=e.substring(0,i+1)),t&&(e=new ee(e),o.e(e.query)&&(r+="?"+e.query),o.e(e.fragment)&&(r+="#"+e.fragment)),r}(this.getUrlComponent(e),e)},Ze.prototype.appendForwardSlash=function(){this._url=function(e){return(0===e.length||"/"!==e[e.length-1])&&(e+="/"),e}(this._url)},Ze.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})},Ze.fetchArrayBuffer=function(e){return new Ze(e).fetchArrayBuffer()},Ze.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})},Ze.fetchBlob=function(e){return new Ze(e).fetchBlob()},Ze.prototype.fetchImage=function(e){e=o.u(e,o.u.EMPTY_OBJECT);var t=o.u(e.preferImageBitmap,!1),r=o.u(e.preferBlob,!1),n=o.u(e.flipY,!1);if(Ge(this.request),!Ve||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!r)return We({resource:this,flipY:n,preferImageBitmap:t});var i,a,s,u=this.fetchBlob();return o.e(u)?Ze.supportsImageBitmapOptions().then((function(e){return i=e&&t,u})).then((function(e){if(o.e(e)){if(s=e,i)return Ze.createImageBitmapFromBlob(e,{flipY:n,premultiplyAlpha:!1});var t=window.URL.createObjectURL(e);return We({resource:a=new Ze({url:t}),flipY:n,preferImageBitmap:!1})}})).then((function(e){if(o.e(e))return e.blob=s,i||window.URL.revokeObjectURL(a.url),e})).catch((function(e){return o.e(a)&&window.URL.revokeObjectURL(a.url),e.blob=s,Promise.reject(e)})):void 0},Ze.fetchImage=function(e){return new Ze(e).fetchImage({flipY:e.flipY,preferBlob:e.preferBlob,preferImageBitmap:e.preferImageBitmap})},Ze.prototype.fetchText=function(){return this.fetch({responseType:"text"})},Ze.fetchText=function(e){return new Ze(e).fetchText()},Ze.prototype.fetchJson=function(){var e=this.fetch({responseType:"text",headers:{Accept:"application/json,*/*;q=0.01"}});if(o.e(e))return e.then((function(e){if(o.e(e))return JSON.parse(e)}))},Ze.fetchJson=function(e){return new Ze(e).fetchJson()},Ze.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})},Ze.fetchXML=function(e){return new Ze(e).fetchXML()},Ze.prototype.fetchJsonp=function(e){var t;e=o.u(e,"callback"),Ge(this.request);do{t="loadJsonp"+Math.random().toString().substring(2,8)}while(o.e(window[t]));return $e(this,e,t)},Ze.fetchJsonp=function(e){return new Ze(e).fetchJsonp(e.callbackParameterName)},Ze.prototype._makeRequest=function(e){var t=this;Ge(t.request);var r=t.request;r.url=t.url,r.requestFunction=function(n){var i=e.responseType,a=ue(e.headers,t.headers),s=e.overrideMimeType,u=e.method,c=e.data,f=p.s(),l=o.e(n)?n:t.url,h=Ze._Implementations.loadWithXhr(l,i,u,c,a,f,s);return o.e(h)&&o.e(h.abort)&&(r.cancelFunction=function(){h.abort()}),f.promise};var n=Ie.request(r);if(o.e(n))return n.then((function(e){return e})).catch((function(n){return r.state!==me.FAILED?Promise.reject(n):t.retryOnError(n).then((function(o){return o?(r.state=me.UNISSUED,r.deferred=void 0,t.fetch(e)):Promise.reject(n)}))}))};var et=/^data:(.*?)(;base64)?,(.*)$/;function tt(e,t){var r=decodeURIComponent(t);return e?atob(r):r}function rt(e,t){for(var r=tt(e,t),n=new ArrayBuffer(r.length),o=new Uint8Array(n),i=0;i<r.length;i++)o[i]=r.charCodeAt(i);return n}function nt(e,t){switch(t){case"text":return e.toString("utf8");case"json":return JSON.parse(e.toString("utf8"));default:return new Uint8Array(e).buffer}}Ze.prototype.fetch=function(e){return(e=Xe(e,{})).method="GET",this._makeRequest(e)},Ze.fetch=function(e){return new Ze(e).fetch({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Ze.prototype.delete=function(e){return(e=Xe(e,{})).method="DELETE",this._makeRequest(e)},Ze.delete=function(e){return new Ze(e).delete({responseType:e.responseType,overrideMimeType:e.overrideMimeType,data:e.data})},Ze.prototype.head=function(e){return(e=Xe(e,{})).method="HEAD",this._makeRequest(e)},Ze.head=function(e){return new Ze(e).head({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Ze.prototype.options=function(e){return(e=Xe(e,{})).method="OPTIONS",this._makeRequest(e)},Ze.options=function(e){return new Ze(e).options({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Ze.prototype.post=function(e,t){return n.o.defined("data",e),(t=Xe(t,{})).method="POST",t.data=e,this._makeRequest(t)},Ze.post=function(e){return new Ze(e).post(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Ze.prototype.put=function(e,t){return n.o.defined("data",e),(t=Xe(t,{})).method="PUT",t.data=e,this._makeRequest(t)},Ze.put=function(e){return new Ze(e).put(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Ze.prototype.patch=function(e,t){return n.o.defined("data",e),(t=Xe(t,{})).method="PATCH",t.data=e,this._makeRequest(t)},Ze.patch=function(e){return new Ze(e).patch(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Ze._Implementations={},Ze._Implementations.createImage=function(e,t,r,n,i){var a=e.url;Ze.supportsImageBitmapOptions().then((function(s){if(s&&i){var u=p.s(),c=Ze._Implementations.loadWithXhr(a,"blob","GET",void 0,void 0,u,void 0,void 0,void 0);return o.e(c)&&o.e(c.abort)&&(e.cancelFunction=function(){c.abort()}),u.promise.then((function(e){if(o.e(e))return Ze.createImageBitmapFromBlob(e,{flipY:n,premultiplyAlpha:!1});r.reject(new l.t("Successfully retrieved "+a+" but it contained no content."))})).then((function(e){r.resolve(e)}))}!function(e,t,r){var n=new Image;n.onload=function(){r.resolve(n)},n.onerror=function(e){r.reject(e)},t&&(Fe.contains(e)?n.crossOrigin="use-credentials":n.crossOrigin=""),n.src=e}(a,t,r)})).catch((function(e){r.reject(e)}))},Ze.createImageBitmapFromBlob=function(e,t){return n.o.defined("options",t),n.o.typeOf.bool("options.flipY",t.flipY),n.o.typeOf.bool("options.premultiplyAlpha",t.premultiplyAlpha),createImageBitmap(e,{imageOrientation:t.flipY?"flipY":"none",premultiplyAlpha:t.premultiplyAlpha?"premultiply":"none"})};var ot=typeof XMLHttpRequest>"u";Ze._Implementations.loadWithXhr=function(e,t,r,i,a,s,u){var c=et.exec(e);if(null===c){if(!ot){var p=new XMLHttpRequest;if(Fe.contains(e)&&(p.withCredentials=!0),e=e.replace(/{/g,"%7B").replace(/}/g,"%7D"),p.open(r,e,!0),o.e(u)&&o.e(p.overrideMimeType)&&p.overrideMimeType(u),o.e(a))for(var f in a)a.hasOwnProperty(f)&&p.setRequestHeader(f,a[f]);o.e(t)&&(p.responseType=t);var h=!1;return"string"==typeof e&&(h=0===e.indexOf("file://")||typeof window<"u"&&"file://"===window.location.origin),p.onload=function(){if(!(p.status<200||p.status>=300)||h&&0===p.status){var e=p.response,n=p.responseType;if("HEAD"===r||"OPTIONS"===r){var i=p.getAllResponseHeaders().trim().split(/[\r\n]+/),a={};return i.forEach((function(e){var t=e.split(": "),r=t.shift();a[r]=t.join(": ")})),void s.resolve(a)}if(204===p.status)s.resolve();else if(!o.e(e)||o.e(t)&&n!==t)if("json"===t&&"string"==typeof e)try{s.resolve(JSON.parse(e))}catch(e){s.reject(e)}else(""===n||"document"===n)&&o.e(p.responseXML)&&p.responseXML.hasChildNodes()?s.resolve(p.responseXML):""!==n&&"text"!==n||!o.e(p.responseText)?s.reject(new l.t("Invalid XMLHttpRequest response type.")):s.resolve(p.responseText);else s.resolve(e)}else s.reject(new ge(p.status,p.response,p.getAllResponseHeaders()))},p.onerror=function(e){s.reject(new ge)},p.send(i),p}!function(e,t,r,n,o,i,a){var s=require("url").parse(e),u="https:"===s.protocol?require("https"):require("http"),c=require("zlib"),p={protocol:s.protocol,hostname:s.hostname,port:s.port,path:s.path,query:s.query,method:r,headers:o};u.request(p).on("response",(function(e){if(e.statusCode<200||e.statusCode>=300)i.reject(new ge(e.statusCode,e,e.headers));else{var r=[];e.on("data",(function(e){r.push(e)})),e.on("end",(function(){var n=Buffer.concat(r);"gzip"===e.headers["content-encoding"]?c.gunzip(n,(function(e,r){e?i.reject(new l.t("Error decompressing response.")):i.resolve(nt(r,t))})):i.resolve(nt(n,t))}))}})).on("error",(function(e){i.reject(new ge)})).end()}(e,t,r,0,a,s)}else s.resolve(function(e,t){t=o.u(t,"");var r=e[1],i=!!e[2],a=e[3];switch(t){case"":case"text":return tt(i,a);case"arraybuffer":return rt(i,a);case"blob":var s=rt(i,a);return new Blob([s],{type:r});case"document":return(new DOMParser).parseFromString(tt(i,a),r);case"json":return JSON.parse(tt(i,a));default:throw new n.t("Unhandled responseType: "+t)}}(c,t))},Ze._Implementations.loadAndExecuteScript=function(e,t,r){return function(e){var t=p.s(),r=document.createElement("script");r.async=!0,r.src=e;var n=document.getElementsByTagName("head")[0];return r.onload=function(){r.onload=void 0,n.removeChild(r),t.resolve()},r.onerror=function(e){t.reject(e)},n.appendChild(r),t.promise}(e).catch((function(e){r.reject(e)}))},Ze._DefaultImplementations={},Ze._DefaultImplementations.createImage=Ze._Implementations.createImage,Ze._DefaultImplementations.loadWithXhr=Ze._Implementations.loadWithXhr,Ze._DefaultImplementations.loadAndExecuteScript=Ze._Implementations.loadAndExecuteScript,Ze.DEFAULT=Object.freeze(new Ze({url:typeof document>"u"?"":document.location.href.split("?")[0]}));var it,at,st,ut=/((?:.*\/)|^)SuperMap3D\.js$/;function ct(e){return typeof document>"u"?e:(o.e(it)||(it=document.createElement("a")),it.href=e,it.href=it.href,it.href)}function pt(){if(o.e(at))return at;var e;if(e=typeof BASE_URL<"u"?BASE_URL:"object"==typeof define&&o.e(define.amd)&&!define.amd.toUrlUndefined&&o.e(require.toUrl)?ce("..",ht("Core/buildModuleUrl.js")):function(){for(var e=document.getElementsByTagName("script"),t=0,r=e.length;t<r;++t){var n=e[t].getAttribute("src"),o=ut.exec(n);if(null!==o)return o[1]}}(),!o.e(e))throw new n.t("Unable to determine SuperMap3D base URL automatically, try defining a global variable called BASE_URL.");return(at=new Ze({url:ct(e)})).appendForwardSlash(),at}function ft(e){return ct(require.toUrl("../"+e))}function lt(e){return pt().getDerivedResource({url:e}).url}function ht(e){return o.e(st)||(st="object"==typeof define&&o.e(define.amd)&&!define.amd.toUrlUndefined&&o.e(require.toUrl)?ft:lt),st(e)}ht._cesiumScriptRegex=ut,ht._buildModuleUrlFromBaseUrl=lt,ht._clearBaseResource=function(){at=void 0},ht.setBaseUrl=function(e){at=Ze.DEFAULT.getDerivedResource({url:e})},ht.getCesiumBaseUrl=pt,e.S=d,e.i=y,e.n=h,e.n$1=ht,e.o=m,e.t=Ze}));
