define(["./AttributeCompression-4cf880dc","./buildModuleUrl-1b968a9d","./Cartesian2-59a54ee7","./Cartographic-81e9e8b2","./when-39df26e1","./TerrainEncoding-6f3d720e","./IndexDatatype-be421fbf","./Check-ff445961","./Math-5e067eb3","./OrientedBoundingBox-7144be8f","./createTaskProcessorWorker","./FeatureDetection-2d4141ff","./Cartesian4-a56bd360","./RuntimeError-251a1d8d","./WebGLConstants-42651efd","./Event-e109b23e","./ComponentDatatype-7d28dd1c","./EllipsoidTangentPlane-ee91c10e","./IntersectionTests-036daea1","./Plane-775a5120","./GeometryAttribute-9b3921a3","./PolygonPipeline-ae195f4e","./EllipsoidRhumbLine-61b02483"],(function(e,t,i,n,r,s,h,u,o,p,d,a,f,l,g,c,m,w,x,v,y,b,B){"use strict";var I={clipTriangleAtAxisAlignedThreshold:function(e,t,i,n,s,h){if(!r.e(e))throw new u.t("threshold is required.");if(!r.e(t))throw new u.t("keepAbove is required.");if(!r.e(i))throw new u.t("u0 is required.");if(!r.e(n))throw new u.t("u1 is required.");if(!r.e(s))throw new u.t("u2 is required.");var o,p,d;r.e(h)?h.length=0:h=[],t?(o=i<e,p=n<e,d=s<e):(o=i>e,p=n>e,d=s>e);var a,f,l,g,c,m,w=o+p+d;return 1===w?o?(a=(e-i)/(n-i),f=(e-i)/(s-i),h.push(1),h.push(2),1!==f&&(h.push(-1),h.push(0),h.push(2),h.push(f)),1!==a&&(h.push(-1),h.push(0),h.push(1),h.push(a))):p?(l=(e-n)/(s-n),g=(e-n)/(i-n),h.push(2),h.push(0),1!==g&&(h.push(-1),h.push(1),h.push(0),h.push(g)),1!==l&&(h.push(-1),h.push(1),h.push(2),h.push(l))):d&&(c=(e-s)/(i-s),m=(e-s)/(n-s),h.push(0),h.push(1),1!==m&&(h.push(-1),h.push(2),h.push(1),h.push(m)),1!==c&&(h.push(-1),h.push(2),h.push(0),h.push(c))):2===w?o||i===e?p||n===e?!d&&s!==e&&(f=(e-i)/(s-i),l=(e-n)/(s-n),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(f),h.push(-1),h.push(1),h.push(2),h.push(l)):(m=(e-s)/(n-s),a=(e-i)/(n-i),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(m),h.push(-1),h.push(0),h.push(1),h.push(a)):(g=(e-n)/(i-n),c=(e-s)/(i-s),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(g),h.push(-1),h.push(2),h.push(0),h.push(c)):3!==w&&(h.push(0),h.push(1),h.push(2)),h},computeBarycentricCoordinates:function(e,t,i,s,h,o,p,d,a){if(!r.e(e))throw new u.t("x is required.");if(!r.e(t))throw new u.t("y is required.");if(!r.e(i))throw new u.t("x1 is required.");if(!r.e(s))throw new u.t("y1 is required.");if(!r.e(h))throw new u.t("x2 is required.");if(!r.e(o))throw new u.t("y2 is required.");if(!r.e(p))throw new u.t("x3 is required.");if(!r.e(d))throw new u.t("y3 is required.");var f=i-p,l=p-h,g=o-d,c=s-d,m=1/(g*f+l*c),w=t-d,x=e-p,v=(g*x+l*w)*m,y=(-c*x+f*w)*m,b=1-v-y;return r.e(a)?(a.x=v,a.y=y,a.z=b,a):new n.o(v,y,b)},computeLineSegmentLineSegmentIntersection:function(e,t,n,s,h,o,p,d,a){u.o.typeOf.number("x00",e),u.o.typeOf.number("y00",t),u.o.typeOf.number("x01",n),u.o.typeOf.number("y01",s),u.o.typeOf.number("x10",h),u.o.typeOf.number("y10",o),u.o.typeOf.number("x11",p),u.o.typeOf.number("y11",d);var f=(d-o)*(n-e)-(p-h)*(s-t);if(0!==f){var l=((p-h)*(t-o)-(d-o)*(e-h))/f,g=((n-e)*(t-o)-(s-t)*(e-h))/f;if(l>=0&&l<=1&&g>=0&&g<=1)return r.e(a)||(a=new i.o),a.x=e+l*(n-e),a.y=t+l*(s-t),a}}},A=32767,C=16383,H=[],T=[],z=[],N=new n.a,O=new n.o,V=[],q=[],E=[],M=[],R=[],U=new n.o,P=new t.i,F=new p.y,k=new i.o,D=new n.o;function L(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}L.prototype.clone=function(e){return r.e(e)||(e=new L),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},L.prototype.initializeIndexed=function(e,t,i,n,r){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=r,this.first=void 0,this.second=void 0,this.ratio=void 0},L.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},L.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},L.prototype.isIndexed=function(){return r.e(this.index)},L.prototype.getH=function(e,t){if(r.e(this.index))return this.heightBuffer[this.index];var i=this.first.getH(e,t),n=this.second.getH(e,t);return 0===t+i/A*e||0===t+n/A*e?0:o.e.lerp(this.first.getH(),this.second.getH(),this.ratio)},L.prototype.getU=function(){return r.e(this.index)?this.uBuffer[this.index]:o.e.lerp(this.first.getU(),this.second.getU(),this.ratio)},L.prototype.getV=function(){return r.e(this.index)?this.vBuffer[this.index]:o.e.lerp(this.first.getV(),this.second.getV(),this.ratio)};var S=new i.o,X=-1,W=[new n.o,new n.o],K=[new n.o,new n.o];function Y(t,i){++X;var r=W[X],s=K[X];return r=e.t.octDecode(t.first.getNormalX(),t.first.getNormalY(),r),s=e.t.octDecode(t.second.getNormalX(),t.second.getNormalY(),s),O=n.o.lerp(r,s,t.ratio,O),n.o.normalize(O,O),e.t.octEncode(O,i),--X,i}L.prototype.getNormalX=function(){return r.e(this.index)?this.normalBuffer[2*this.index]:(S=Y(this,S)).x},L.prototype.getNormalY=function(){return r.e(this.index)?this.normalBuffer[2*this.index+1]:(S=Y(this,S)).y};var _=[];function G(e,t,i,n,s,h,u,o,p,d,a){if(0!==u.length){for(var f=0,l=0;l<u.length;)l=_[f++].initializeFromClipResult(u,l,o);for(var g=0;g<f;++g){var c=_[g];if(c.isIndexed())c.newIndex=h[c.index],c.uBuffer=e,c.vBuffer=t,c.heightBuffer=i,p&&(c.normalBuffer=n);else{var m=c.getKey();if(r.e(h[m]))c.newIndex=h[m];else{var w=e.length;e.push(c.getU()),t.push(c.getV()),i.push(c.getH(d,a)),p&&(n.push(c.getNormalX()),n.push(c.getNormalY())),c.newIndex=w,h[m]=w}}}3===f?(s.push(_[0].newIndex),s.push(_[1].newIndex),s.push(_[2].newIndex)):4===f&&(s.push(_[0].newIndex),s.push(_[1].newIndex),s.push(_[2].newIndex),s.push(_[0].newIndex),s.push(_[2].newIndex),s.push(_[3].newIndex))}}return _.push(new L),_.push(new L),_.push(new L),_.push(new L),d((function(e,u){var d=e.isEastChild,a=e.isNorthChild,f=d?C:0,l=d?A:C,g=a?C:0,c=a?A:C,m=V,w=q,x=E,v=R;m.length=0,w.length=0,x.length=0,v.length=0;var y=M;y.length=0;var b={},B=e.vertices,S=e.indices;S=S.subarray(0,e.indexCountWithoutSkirts);var X,W,K,Y,_,J=s.h.clone(e.encoding),Z=J.hasVertexNormals,j=e.exaggeration,Q=0,$=e.vertexCountWithoutSkirts,ee=e.minimumHeight,te=e.maximumHeight,ie=r.e(e.validMinimumHeight)?e.validMinimumHeight:e.minimumHeight,ne=r.e(e.validMaximumHeight)?e.validMaximumHeight:e.maximumHeight,re=new Array($),se=new Array($),he=new Array($),ue=Z?new Array(2*$):void 0;for(W=0,K=0;W<$;++W,K+=2){var oe=J.decodeTextureCoordinates(B,W,k);if(X=J.decodeHeight(B,W)/j,Y=o.e.clamp(oe.x*A|0,0,A),_=o.e.clamp(oe.y*A|0,0,A),he[W]=o.e.clamp((X-ee)/(te-ee)*A|0,0,A),Y<20&&(Y=0),_<20&&(_=0),A-Y<20&&(Y=A),A-_<20&&(_=A),re[W]=Y,se[W]=_,Z){var pe=J.getOctEncodedNormal(B,W,D);ue[K]=pe.x,ue[K+1]=pe.y}(d&&Y>=C||!d&&Y<=C)&&(a&&_>=C||!a&&_<=C)&&(b[W]=Q,m.push(Y),w.push(_),x.push(he[W]),Z&&(v.push(ue[K]),v.push(ue[K+1])),++Q)}var de=[];de.push(new L),de.push(new L),de.push(new L);var ae,fe=[];for(fe.push(new L),fe.push(new L),fe.push(new L),W=0;W<S.length;W+=3){var le=S[W],ge=S[W+1],ce=S[W+2],me=re[le],we=re[ge],xe=re[ce];de[0].initializeIndexed(re,se,he,ue,le),de[1].initializeIndexed(re,se,he,ue,ge),de[2].initializeIndexed(re,se,he,ue,ce);var ve=I.clipTriangleAtAxisAlignedThreshold(C,d,me,we,xe,H);(ae=0)>=ve.length||((ae=fe[0].initializeFromClipResult(ve,ae,de))>=ve.length||(ae=fe[1].initializeFromClipResult(ve,ae,de))>=ve.length||(ae=fe[2].initializeFromClipResult(ve,ae,de),G(m,w,x,v,y,b,I.clipTriangleAtAxisAlignedThreshold(C,a,fe[0].getV(),fe[1].getV(),fe[2].getV(),T),fe,Z,te,ee),ae<ve.length&&(fe[2].clone(fe[1]),fe[2].initializeFromClipResult(ve,ae,de),G(m,w,x,v,y,b,I.clipTriangleAtAxisAlignedThreshold(C,a,fe[0].getV(),fe[1].getV(),fe[2].getV(),T),fe,Z,te,ee))))}var ye=d?-32767:0,be=a?-32767:0,Be=[],Ie=[],Ae=[],Ce=[],He=Number.MAX_VALUE,Te=-He,ze=Number.MAX_VALUE,Ne=-He,Oe=z;Oe.length=0;var Ve=i.t.clone(e.ellipsoid),qe=i.h.clone(e.childRectangle),Ee=qe.north,Me=qe.south,Re=qe.east,Ue=qe.west;for(Re<Ue&&(Re+=o.e.TWO_PI),W=0;W<m.length;++W){(Y=Math.round(m[W]))<=f?(Be.push(W),Y=0):Y>=l?(Ae.push(W),Y=A):Y=2*Y+ye,m[W]=Y,(_=Math.round(w[W]))<=g?(Ie.push(W),_=0):_>=c?(Ce.push(W),_=A):_=2*_+be,w[W]=_,(X=o.e.lerp(ee,te,x[W]/A))<He&&(He=X),X>Te&&(Te=X);var Pe=X;(Pe=o.e.clamp(Pe,ie,ne))<ze&&(ze=Pe),Pe>Ne&&(Ne=Pe),x[W]=X,N.longitude=o.e.lerp(Ue,Re,Y/A),N.latitude=o.e.lerp(Me,Ee,_/A),N.height=X,Ve.cartographicToCartesian(N,O),Oe.push(O.x),Oe.push(O.y),Oe.push(O.z)}var Fe=t.i.fromVertices(Oe,n.o.ZERO,3,P),ke=p.y.fromRectangle(qe,He,Te,Ve,F),De=p.y.fromRectangle(qe,ze,Ne,Ve,F),Le=new s.s(Ve).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Fe.center,Oe,3,Fe.center,He,U),Se=Te-He,Xe=new Uint16Array(m.length+w.length+x.length);for(W=0;W<m.length;++W)Xe[W]=m[W];var We=m.length;for(W=0;W<w.length;++W)Xe[We+W]=w[W];for(We+=w.length,W=0;W<x.length;++W)Xe[We+W]=A*(x[W]-He)/Se;var Ke,Ye=h.IndexDatatype.createTypedArray(m.length,y);if(Z){var _e=new Uint8Array(v);u.push(Xe.buffer,Ye.buffer,_e.buffer),Ke=_e.buffer}else u.push(Xe.buffer,Ye.buffer);return{vertices:Xe.buffer,encodedNormals:Ke,indices:Ye.buffer,minimumHeight:He,maximumHeight:Te,westIndices:Be,southIndices:Ie,eastIndices:Ae,northIndices:Ce,boundingSphere:Fe,orientedBoundingBox:ke,horizonOcclusionPoint:Le,validMinimumHeight:ze,validMaximumHeight:Ne,validOrientedBoundingBox:De}}))}));
