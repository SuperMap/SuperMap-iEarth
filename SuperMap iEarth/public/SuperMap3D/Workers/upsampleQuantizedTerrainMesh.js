import{a as Ei,b as Ri}from"./chunk-K7EPBLTH.js";import{a as qi}from"./chunk-AMRCVYIA.js";import{a as ai}from"./chunk-I6IKQZ7N.js";import"./chunk-HOZ5IOFP.js";import"./chunk-ZMHH4UFY.js";import"./chunk-6X6ULKRC.js";import{a as ti}from"./chunk-MQMYX2JZ.js";import"./chunk-REXJO6A6.js";import"./chunk-EUSYH4JF.js";import{a as Ti}from"./chunk-44AFRGCG.js";import{d as vi}from"./chunk-CJHFPVIB.js";import"./chunk-NPAFDOYL.js";import"./chunk-SSYG2MIY.js";import"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import"./chunk-Z4SOZDEW.js";import"./chunk-MX7ZM7WW.js";import"./chunk-EHDXVZQM.js";import{a as Ni}from"./chunk-NLYLRNUA.js";import{a as Q,b as zi}from"./chunk-7TOCOFC3.js";import"./chunk-ZVKIUA3Y.js";import{b as Oi}from"./chunk-3HZNWEV7.js";import{a as b}from"./chunk-LBR6REQR.js";import{a as y}from"./chunk-GXFCHGTA.js";import"./chunk-UBHQMGET.js";import{a as R}from"./chunk-EDZQSM3T.js";import{a as A}from"./chunk-PJGSCWXZ.js";import{a as s}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";var hi={};hi.clipTriangleAtAxisAlignedThreshold=function(i,h,r,n,a,e){if(!s(i))throw new A("threshold is required.");if(!s(h))throw new A("keepAbove is required.");if(!s(r))throw new A("u0 is required.");if(!s(n))throw new A("u1 is required.");if(!s(a))throw new A("u2 is required.");s(e)?e.length=0:e=[];var g,l,o;h?(g=r<i,l=n<i,o=a<i):(g=r>i,l=n>i,o=a>i);var v=g+l+o,p,d,c,w,f,x;return v===1?g?(p=(i-r)/(n-r),d=(i-r)/(a-r),e.push(1),e.push(2),d!==1&&(e.push(-1),e.push(0),e.push(2),e.push(d)),p!==1&&(e.push(-1),e.push(0),e.push(1),e.push(p))):l?(c=(i-n)/(a-n),w=(i-n)/(r-n),e.push(2),e.push(0),w!==1&&(e.push(-1),e.push(1),e.push(0),e.push(w)),c!==1&&(e.push(-1),e.push(1),e.push(2),e.push(c))):o&&(f=(i-a)/(r-a),x=(i-a)/(n-a),e.push(0),e.push(1),x!==1&&(e.push(-1),e.push(2),e.push(1),e.push(x)),f!==1&&(e.push(-1),e.push(2),e.push(0),e.push(f))):v===2?!g&&r!==i?(w=(i-n)/(r-n),f=(i-a)/(r-a),e.push(0),e.push(-1),e.push(1),e.push(0),e.push(w),e.push(-1),e.push(2),e.push(0),e.push(f)):!l&&n!==i?(x=(i-a)/(n-a),p=(i-r)/(n-r),e.push(1),e.push(-1),e.push(2),e.push(1),e.push(x),e.push(-1),e.push(0),e.push(1),e.push(p)):!o&&a!==i&&(d=(i-r)/(a-r),c=(i-n)/(a-n),e.push(2),e.push(-1),e.push(0),e.push(2),e.push(d),e.push(-1),e.push(1),e.push(2),e.push(c)):v!==3&&(e.push(0),e.push(1),e.push(2)),e};hi.computeBarycentricCoordinates=function(i,h,r,n,a,e,g,l,o){if(!s(i))throw new A("x is required.");if(!s(h))throw new A("y is required.");if(!s(r))throw new A("x1 is required.");if(!s(n))throw new A("y1 is required.");if(!s(a))throw new A("x2 is required.");if(!s(e))throw new A("y2 is required.");if(!s(g))throw new A("x3 is required.");if(!s(l))throw new A("y3 is required.");var v=r-g,p=g-a,d=e-l,c=n-l,w=1/(d*v+p*c),f=h-l,x=i-g,O=(d*x+p*f)*w,N=(-c*x+v*f)*w,Z=1-O-N;return s(o)?(o.x=O,o.y=N,o.z=Z,o):new b(O,N,Z)};hi.computeLineSegmentLineSegmentIntersection=function(i,h,r,n,a,e,g,l,o){R.typeOf.number("x00",i),R.typeOf.number("y00",h),R.typeOf.number("x01",r),R.typeOf.number("y01",n),R.typeOf.number("x10",a),R.typeOf.number("y10",e),R.typeOf.number("x11",g),R.typeOf.number("y11",l);var v=(g-a)*(h-e)-(l-e)*(i-a),p=(r-i)*(h-e)-(n-h)*(i-a),d=(l-e)*(r-i)-(g-a)*(n-h);if(d!==0){var c=v/d,w=p/d;if(c>=0&&c<=1&&w>=0&&w<=1)return s(o)||(o=new Q),o.x=i+c*(r-i),o.y=h+c*(n-h),o}};var oi=hi;var u=32767,z=u/2|0,ji=[],Vi=[],ie=[],fi=new Oi,V=new b,ee=[],ne=[],re=[],te=[],ae=[],he=new b,oe=new vi,Ui=new ai,fe=new Q,se=new b;function de(i,h){var r=i.isEastChild,n=i.isNorthChild,a=r?z:0,e=r?u:z,g=n?z:0,l=n?u:z,o=ee,v=ne,p=re,d=ae;o.length=0,v.length=0,p.length=0,d.length=0;var c=te;c.length=0;var w={},f=i.vertices,x=i.indices;x=x.subarray(0,i.indexCountWithoutSkirts);var O=Ri.clone(i.encoding),N=O.hasVertexNormals,Z=i.exaggeration,mi=0,Y=i.vertexCountWithoutSkirts,k=i.minimumHeight,G=i.maximumHeight,Pi=s(i.validMinimumHeight)?i.validMinimumHeight:i.minimumHeight,Di=s(i.validMaximumHeight)?i.validMaximumHeight:i.maximumHeight,M=new Array(Y),$=new Array(Y),_=new Array(Y),F=N?new Array(Y*2):void 0,j=20,T,t,P,B,I;for(t=0,P=0;t<Y;++t,P+=2){var gi=O.decodeTextureCoordinates(f,t,fe);if(T=O.decodeHeight(f,t)/Z,B=y.clamp(gi.x*u|0,0,u),I=y.clamp(gi.y*u|0,0,u),_[t]=y.clamp((T-k)/(G-k)*u|0,0,u),B<j&&(B=0),I<j&&(I=0),u-B<j&&(B=u),u-I<j&&(I=u),M[t]=B,$[t]=I,N){var wi=O.getOctEncodedNormal(f,t,se);F[P]=wi.x,F[P+1]=wi.y}(r&&B>=z||!r&&B<=z)&&(n&&I>=z||!n&&I<=z)&&(w[t]=mi,o.push(B),v.push(I),p.push(_[t]),N&&(d.push(F[P]),d.push(F[P+1])),++mi)}var q=[];q.push(new m),q.push(new m),q.push(new m);var S=[];S.push(new m),S.push(new m),S.push(new m);var H,ii;for(t=0;t<x.length;t+=3){var xi=x[t],li=x[t+1],Bi=x[t+2],Xi=M[xi],Ki=M[li],Li=M[Bi];q[0].initializeIndexed(M,$,_,F,xi),q[1].initializeIndexed(M,$,_,F,li),q[2].initializeIndexed(M,$,_,F,Bi);var U=oi.clipTriangleAtAxisAlignedThreshold(z,r,Xi,Ki,Li,ji);H=0,!(H>=U.length)&&(H=S[0].initializeFromClipResult(U,H,q),!(H>=U.length)&&(H=S[1].initializeFromClipResult(U,H,q),!(H>=U.length)&&(H=S[2].initializeFromClipResult(U,H,q),ii=oi.clipTriangleAtAxisAlignedThreshold(z,n,S[0].getV(),S[1].getV(),S[2].getV(),Vi),Mi(o,v,p,d,c,w,ii,S,N,G,k),H<U.length&&(S[2].clone(S[1]),S[2].initializeFromClipResult(U,H,q),ii=oi.clipTriangleAtAxisAlignedThreshold(z,n,S[0].getV(),S[1].getV(),S[2].getV(),Vi),Mi(o,v,p,d,c,w,ii,S,N,G,k)))))}var Wi=r?-u:0,Yi=n?-u:0,Ii=[],Si=[],Ci=[],Ai=[],E=Number.MAX_VALUE,J=-E,ei=Number.MAX_VALUE,ni=-E,D=ie;D.length=0;var ri=zi.clone(i.ellipsoid),X=Ni.clone(i.childRectangle),ki=X.north,_i=X.south,di=X.east,bi=X.west;for(di<bi&&(di+=y.TWO_PI),t=0;t<o.length;++t){B=Math.round(o[t]),B<=a?(Ii.push(t),B=0):B>=e?(Ci.push(t),B=u):B=B*2+Wi,o[t]=B,I=Math.round(v[t]),I<=g?(Si.push(t),I=0):I>=l?(Ai.push(t),I=u):I=I*2+Yi,v[t]=I,T=y.lerp(k,G,p[t]/u),T<E&&(E=T),T>J&&(J=T);var K=T;K=y.clamp(K,Pi,Di),K<ei&&(ei=K),K>ni&&(ni=K),p[t]=T,fi.longitude=y.lerp(bi,di,B/u),fi.latitude=y.lerp(_i,ki,I/u),fi.height=T,ri.cartographicToCartesian(fi,V),D.push(V.x),D.push(V.y),D.push(V.z)}var ui=vi.fromVertices(D,b.ZERO,3,oe),Ji=ai.fromRectangle(X,E,J,ri,Ui),Qi=ai.fromRectangle(X,ei,ni,ri,Ui),Zi=new Ei(ri),Gi=Zi.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(ui.center,D,3,ui.center,E,he),$i=J-E,L=new Uint16Array(o.length+v.length+p.length);for(t=0;t<o.length;++t)L[t]=o[t];var pi=o.length;for(t=0;t<v.length;++t)L[pi+t]=v[t];for(pi+=v.length,t=0;t<p.length;++t)L[pi+t]=u*(p[t]-E)/$i;var ci=Ti.createTypedArray(o.length,c),Hi;if(N){var yi=new Uint8Array(d);h.push(L.buffer,ci.buffer,yi.buffer),Hi=yi.buffer}else h.push(L.buffer,ci.buffer);return{vertices:L.buffer,encodedNormals:Hi,indices:ci.buffer,minimumHeight:E,maximumHeight:J,westIndices:Ii,southIndices:Si,eastIndices:Ci,northIndices:Ai,boundingSphere:ui,orientedBoundingBox:Ji,horizonOcclusionPoint:Gi,validMinimumHeight:ei,validMaximumHeight:ni,validOrientedBoundingBox:Qi}}function m(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}m.prototype.clone=function(i){return s(i)||(i=new m),i.uBuffer=this.uBuffer,i.vBuffer=this.vBuffer,i.heightBuffer=this.heightBuffer,i.normalBuffer=this.normalBuffer,i.index=this.index,i.first=this.first,i.second=this.second,i.ratio=this.ratio,i};m.prototype.initializeIndexed=function(i,h,r,n,a){this.uBuffer=i,this.vBuffer=h,this.heightBuffer=r,this.normalBuffer=n,this.index=a,this.first=void 0,this.second=void 0,this.ratio=void 0};m.prototype.initializeFromClipResult=function(i,h,r){var n=h+1;return i[h]!==-1?r[i[h]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=r[i[n]],++n,this.second=r[i[n]],++n,this.ratio=i[n],++n),n};m.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})};m.prototype.isIndexed=function(){return s(this.index)};m.prototype.getH=function(i,h){if(s(this.index))return this.heightBuffer[this.index];var r=this.first.getH(i,h),n=this.second.getH(i,h),a=h+r/u*i,e=h+n/u*i;return a===0||e===0?0:y.lerp(this.first.getH(),this.second.getH(),this.ratio)};m.prototype.getU=function(){return s(this.index)?this.uBuffer[this.index]:y.lerp(this.first.getU(),this.second.getU(),this.ratio)};m.prototype.getV=function(){return s(this.index)?this.vBuffer[this.index]:y.lerp(this.first.getV(),this.second.getV(),this.ratio)};var W=new Q,si=-1,ue=[new b,new b],pe=[new b,new b];function Fi(i,h){++si;var r=ue[si],n=pe[si];return r=ti.octDecode(i.first.getNormalX(),i.first.getNormalY(),r),n=ti.octDecode(i.second.getNormalX(),i.second.getNormalY(),n),V=b.lerp(r,n,i.ratio,V),b.normalize(V,V),ti.octEncode(V,h),--si,h}m.prototype.getNormalX=function(){return s(this.index)?this.normalBuffer[this.index*2]:(W=Fi(this,W),W.x)};m.prototype.getNormalY=function(){return s(this.index)?this.normalBuffer[this.index*2+1]:(W=Fi(this,W),W.y)};var C=[];C.push(new m);C.push(new m);C.push(new m);C.push(new m);function Mi(i,h,r,n,a,e,g,l,o,v,p){if(g.length!==0){for(var d=0,c=0;c<g.length;)c=C[d++].initializeFromClipResult(g,c,l);for(var w=0;w<d;++w){var f=C[w];if(f.isIndexed())f.newIndex=e[f.index],f.uBuffer=i,f.vBuffer=h,f.heightBuffer=r,o&&(f.normalBuffer=n);else{var x=f.getKey();if(s(e[x]))f.newIndex=e[x];else{var O=i.length;i.push(f.getU()),h.push(f.getV()),r.push(f.getH(v,p)),o&&(n.push(f.getNormalX()),n.push(f.getNormalY())),f.newIndex=O,e[x]=O}}}d===3?(a.push(C[0].newIndex),a.push(C[1].newIndex),a.push(C[2].newIndex)):d===4&&(a.push(C[0].newIndex),a.push(C[1].newIndex),a.push(C[2].newIndex),a.push(C[0].newIndex),a.push(C[2].newIndex),a.push(C[3].newIndex))}}var Re=qi(de);export{Re as default};
