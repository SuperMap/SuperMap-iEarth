define(["./AttributeCompression-79e23de9","./buildModuleUrl-36ce0ebc","./Ellipsoid-ca2b8eb1","./Cartesian3-c1138337","./Cartographic-630e5de6","./defaultValue-2110bb17","./TerrainEncoding-258e5b72","./IndexDatatype-d833345d","./Check-92c551fb","./Math-cd1437d9","./OrientedBoundingBox-e518fab9","./Rectangle-52f780a9","./createTaskProcessorWorker","./FeatureDetection-e7fb956a","./defer-a21481c0","./PrimitiveType-d9ba7368","./Cartesian4-5c264813","./RuntimeError-6daf0e01","./WebGLConstants-92042d9e","./Event-589349b0","./ComponentDatatype-3cfb1146","./EllipsoidTangentPlane-6f479ced","./IntersectionTests-88230423","./Plane-8f19018a","./GeometryAttribute-b12ab6bd","./PolygonPipeline-478e7e0d","./EllipsoidRhumbLine-89d13f20"],(function(e,i,t,n,r,s,h,u,o,p,d,a,f,l,g,c,m,x,w,v,y,b,B,I,A,C,H){"use strict";var T={clipTriangleAtAxisAlignedThreshold:function(e,i,t,n,r,h){if(!s.e(e))throw new o.t("threshold is required.");if(!s.e(i))throw new o.t("keepAbove is required.");if(!s.e(t))throw new o.t("u0 is required.");if(!s.e(n))throw new o.t("u1 is required.");if(!s.e(r))throw new o.t("u2 is required.");var u,p,d;s.e(h)?h.length=0:h=[],i?(u=t<e,p=n<e,d=r<e):(u=t>e,p=n>e,d=r>e);var a,f,l,g,c,m,x=u+p+d;return 1===x?u?(a=(e-t)/(n-t),f=(e-t)/(r-t),h.push(1),h.push(2),1!==f&&(h.push(-1),h.push(0),h.push(2),h.push(f)),1!==a&&(h.push(-1),h.push(0),h.push(1),h.push(a))):p?(l=(e-n)/(r-n),g=(e-n)/(t-n),h.push(2),h.push(0),1!==g&&(h.push(-1),h.push(1),h.push(0),h.push(g)),1!==l&&(h.push(-1),h.push(1),h.push(2),h.push(l))):d&&(c=(e-r)/(t-r),m=(e-r)/(n-r),h.push(0),h.push(1),1!==m&&(h.push(-1),h.push(2),h.push(1),h.push(m)),1!==c&&(h.push(-1),h.push(2),h.push(0),h.push(c))):2===x?u||t===e?p||n===e?!d&&r!==e&&(f=(e-t)/(r-t),l=(e-n)/(r-n),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(f),h.push(-1),h.push(1),h.push(2),h.push(l)):(m=(e-r)/(n-r),a=(e-t)/(n-t),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(m),h.push(-1),h.push(0),h.push(1),h.push(a)):(g=(e-n)/(t-n),c=(e-r)/(t-r),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(g),h.push(-1),h.push(2),h.push(0),h.push(c)):3!==x&&(h.push(0),h.push(1),h.push(2)),h},computeBarycentricCoordinates:function(e,i,t,r,h,u,p,d,a){if(!s.e(e))throw new o.t("x is required.");if(!s.e(i))throw new o.t("y is required.");if(!s.e(t))throw new o.t("x1 is required.");if(!s.e(r))throw new o.t("y1 is required.");if(!s.e(h))throw new o.t("x2 is required.");if(!s.e(u))throw new o.t("y2 is required.");if(!s.e(p))throw new o.t("x3 is required.");if(!s.e(d))throw new o.t("y3 is required.");var f=t-p,l=p-h,g=u-d,c=r-d,m=1/(g*f+l*c),x=i-d,w=e-p,v=(g*w+l*x)*m,y=(-c*w+f*x)*m,b=1-v-y;return s.e(a)?(a.x=v,a.y=y,a.z=b,a):new n.o(v,y,b)},computeLineSegmentLineSegmentIntersection:function(e,i,n,r,h,u,p,d,a){o.o.typeOf.number("x00",e),o.o.typeOf.number("y00",i),o.o.typeOf.number("x01",n),o.o.typeOf.number("y01",r),o.o.typeOf.number("x10",h),o.o.typeOf.number("y10",u),o.o.typeOf.number("x11",p),o.o.typeOf.number("y11",d);var f=(d-u)*(n-e)-(p-h)*(r-i);if(0!==f){var l=((p-h)*(i-u)-(d-u)*(e-h))/f,g=((n-e)*(i-u)-(r-i)*(e-h))/f;if(l>=0&&l<=1&&g>=0&&g<=1)return s.e(a)||(a=new t.o),a.x=e+l*(n-e),a.y=i+l*(r-i),a}}},V=32767,z=16383,N=[],O=[],q=[],E=new r.a,R=new n.o,M=[],P=[],U=[],F=[],k=[],D=new n.o,L=new i.i,S=new d.p,X=new t.o,W=new n.o;function K(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}K.prototype.clone=function(e){return s.e(e)||(e=new K),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},K.prototype.initializeIndexed=function(e,i,t,n,r){this.uBuffer=e,this.vBuffer=i,this.heightBuffer=t,this.normalBuffer=n,this.index=r,this.first=void 0,this.second=void 0,this.ratio=void 0},K.prototype.initializeFromClipResult=function(e,i,t){var n=i+1;return-1!==e[i]?t[e[i]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=t[e[n]],++n,this.second=t[e[n]],++n,this.ratio=e[n],++n),n},K.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},K.prototype.isIndexed=function(){return s.e(this.index)},K.prototype.getH=function(e,i){if(s.e(this.index))return this.heightBuffer[this.index];var t=this.first.getH(e,i),n=this.second.getH(e,i);return 0===i+t/V*e||0===i+n/V*e?0:p.e.lerp(this.first.getH(),this.second.getH(),this.ratio)},K.prototype.getU=function(){return s.e(this.index)?this.uBuffer[this.index]:p.e.lerp(this.first.getU(),this.second.getU(),this.ratio)},K.prototype.getV=function(){return s.e(this.index)?this.vBuffer[this.index]:p.e.lerp(this.first.getV(),this.second.getV(),this.ratio)};var Y=new t.o,_=-1,G=[new n.o,new n.o],J=[new n.o,new n.o];function Z(i,t){++_;var r=G[_],s=J[_];return r=e.t.octDecode(i.first.getNormalX(),i.first.getNormalY(),r),s=e.t.octDecode(i.second.getNormalX(),i.second.getNormalY(),s),R=n.o.lerp(r,s,i.ratio,R),n.o.normalize(R,R),e.t.octEncode(R,t),--_,t}K.prototype.getNormalX=function(){return s.e(this.index)?this.normalBuffer[2*this.index]:(Y=Z(this,Y)).x},K.prototype.getNormalY=function(){return s.e(this.index)?this.normalBuffer[2*this.index+1]:(Y=Z(this,Y)).y};var j=[];function Q(e,i,t,n,r,h,u,o,p,d,a){if(0!==u.length){for(var f=0,l=0;l<u.length;)l=j[f++].initializeFromClipResult(u,l,o);for(var g=0;g<f;++g){var c=j[g];if(c.isIndexed())c.newIndex=h[c.index],c.uBuffer=e,c.vBuffer=i,c.heightBuffer=t,p&&(c.normalBuffer=n);else{var m=c.getKey();if(s.e(h[m]))c.newIndex=h[m];else{var x=e.length;e.push(c.getU()),i.push(c.getV()),t.push(c.getH(d,a)),p&&(n.push(c.getNormalX()),n.push(c.getNormalY())),c.newIndex=x,h[m]=x}}}3===f?(r.push(j[0].newIndex),r.push(j[1].newIndex),r.push(j[2].newIndex)):4===f&&(r.push(j[0].newIndex),r.push(j[1].newIndex),r.push(j[2].newIndex),r.push(j[0].newIndex),r.push(j[2].newIndex),r.push(j[3].newIndex))}}return j.push(new K),j.push(new K),j.push(new K),j.push(new K),f((function(e,r){var o=e.isEastChild,f=e.isNorthChild,l=o?z:0,g=o?V:z,c=f?z:0,m=f?V:z,x=M,w=P,v=U,y=k;x.length=0,w.length=0,v.length=0,y.length=0;var b=F;b.length=0;var B={},I=e.vertices,A=e.indices;A=A.subarray(0,e.indexCountWithoutSkirts);var C,H,Y,_,G,J=h.h.clone(e.encoding),Z=J.hasVertexNormals,j=e.exaggeration,$=0,ee=e.vertexCountWithoutSkirts,ie=e.minimumHeight,te=e.maximumHeight,ne=s.e(e.validMinimumHeight)?e.validMinimumHeight:e.minimumHeight,re=s.e(e.validMaximumHeight)?e.validMaximumHeight:e.maximumHeight,se=new Array(ee),he=new Array(ee),ue=new Array(ee),oe=Z?new Array(2*ee):void 0;for(H=0,Y=0;H<ee;++H,Y+=2){var pe=J.decodeTextureCoordinates(I,H,X);if(C=J.decodeHeight(I,H)/j,_=p.e.clamp(pe.x*V|0,0,V),G=p.e.clamp(pe.y*V|0,0,V),ue[H]=p.e.clamp((C-ie)/(te-ie)*V|0,0,V),_<20&&(_=0),G<20&&(G=0),V-_<20&&(_=V),V-G<20&&(G=V),se[H]=_,he[H]=G,Z){var de=J.getOctEncodedNormal(I,H,W);oe[Y]=de.x,oe[Y+1]=de.y}(o&&_>=z||!o&&_<=z)&&(f&&G>=z||!f&&G<=z)&&(B[H]=$,x.push(_),w.push(G),v.push(ue[H]),Z&&(y.push(oe[Y]),y.push(oe[Y+1])),++$)}var ae=[];ae.push(new K),ae.push(new K),ae.push(new K);var fe,le=[];for(le.push(new K),le.push(new K),le.push(new K),H=0;H<A.length;H+=3){var ge=A[H],ce=A[H+1],me=A[H+2],xe=se[ge],we=se[ce],ve=se[me];ae[0].initializeIndexed(se,he,ue,oe,ge),ae[1].initializeIndexed(se,he,ue,oe,ce),ae[2].initializeIndexed(se,he,ue,oe,me);var ye=T.clipTriangleAtAxisAlignedThreshold(z,o,xe,we,ve,N);(fe=0)>=ye.length||((fe=le[0].initializeFromClipResult(ye,fe,ae))>=ye.length||(fe=le[1].initializeFromClipResult(ye,fe,ae))>=ye.length||(fe=le[2].initializeFromClipResult(ye,fe,ae),Q(x,w,v,y,b,B,T.clipTriangleAtAxisAlignedThreshold(z,f,le[0].getV(),le[1].getV(),le[2].getV(),O),le,Z,te,ie),fe<ye.length&&(le[2].clone(le[1]),le[2].initializeFromClipResult(ye,fe,ae),Q(x,w,v,y,b,B,T.clipTriangleAtAxisAlignedThreshold(z,f,le[0].getV(),le[1].getV(),le[2].getV(),O),le,Z,te,ie))))}var be=o?-32767:0,Be=f?-32767:0,Ie=[],Ae=[],Ce=[],He=[],Te=Number.MAX_VALUE,Ve=-Te,ze=Number.MAX_VALUE,Ne=-Te,Oe=q;Oe.length=0;var qe=t.t.clone(e.ellipsoid),Ee=a.h.clone(e.childRectangle),Re=Ee.north,Me=Ee.south,Pe=Ee.east,Ue=Ee.west;for(Pe<Ue&&(Pe+=p.e.TWO_PI),H=0;H<x.length;++H){(_=Math.round(x[H]))<=l?(Ie.push(H),_=0):_>=g?(Ce.push(H),_=V):_=2*_+be,x[H]=_,(G=Math.round(w[H]))<=c?(Ae.push(H),G=0):G>=m?(He.push(H),G=V):G=2*G+Be,w[H]=G,(C=p.e.lerp(ie,te,v[H]/V))<Te&&(Te=C),C>Ve&&(Ve=C);var Fe=C;(Fe=p.e.clamp(Fe,ne,re))<ze&&(ze=Fe),Fe>Ne&&(Ne=Fe),v[H]=C,E.longitude=p.e.lerp(Ue,Pe,_/V),E.latitude=p.e.lerp(Me,Re,G/V),E.height=C,qe.cartographicToCartesian(E,R),Oe.push(R.x),Oe.push(R.y),Oe.push(R.z)}var ke=i.i.fromVertices(Oe,n.o.ZERO,3,L),De=d.p.fromRectangle(Ee,Te,Ve,qe,S),Le=d.p.fromRectangle(Ee,ze,Ne,qe,S),Se=new h.s(qe).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(ke.center,Oe,3,ke.center,Te,D),Xe=Ve-Te,We=new Uint16Array(x.length+w.length+v.length);for(H=0;H<x.length;++H)We[H]=x[H];var Ke=x.length;for(H=0;H<w.length;++H)We[Ke+H]=w[H];for(Ke+=w.length,H=0;H<v.length;++H)We[Ke+H]=V*(v[H]-Te)/Xe;var Ye,_e=u.IndexDatatype.createTypedArray(x.length,b);if(Z){var Ge=new Uint8Array(y);r.push(We.buffer,_e.buffer,Ge.buffer),Ye=Ge.buffer}else r.push(We.buffer,_e.buffer);return{vertices:We.buffer,encodedNormals:Ye,indices:_e.buffer,minimumHeight:Te,maximumHeight:Ve,westIndices:Ie,southIndices:Ae,eastIndices:Ce,northIndices:He,boundingSphere:ke,orientedBoundingBox:De,horizonOcclusionPoint:Se,validMinimumHeight:ze,validMaximumHeight:Ne,validOrientedBoundingBox:Le}}))}));
