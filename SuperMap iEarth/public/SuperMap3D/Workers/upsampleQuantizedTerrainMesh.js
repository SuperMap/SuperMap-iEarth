define(["./AttributeCompression-b5a80a71","./buildModuleUrl-9eef8841","./Cartesian2-b72655a5","./Cartesian3-3a8bdb0b","./Cartographic-a2c313d7","./when-92c6cf3c","./TerrainEncoding-fd44afa8","./IndexDatatype-86677ec4","./Check-52a7d806","./Math-ecf82623","./OrientedBoundingBox-d2eb0b92","./createTaskProcessorWorker","./FeatureDetection-cec0163f","./Cartesian4-72b88c9e","./RuntimeError-c6a62a80","./WebGLConstants-42651efd","./Event-3390cd7d","./ComponentDatatype-98414d16","./EllipsoidTangentPlane-d6b88a1f","./IntersectionTests-6e80d61c","./Plane-33393da8","./GeometryAttribute-f47bd1cb","./PolygonPipeline-425528b3","./EllipsoidRhumbLine-b1a766ae"],(function(e,t,i,n,r,s,h,u,o,p,a,d,f,l,c,g,m,w,x,v,y,b,B,I){"use strict";var A={clipTriangleAtAxisAlignedThreshold:function(e,t,i,n,r,h){if(!s.e(e))throw new o.t("threshold is required.");if(!s.e(t))throw new o.t("keepAbove is required.");if(!s.e(i))throw new o.t("u0 is required.");if(!s.e(n))throw new o.t("u1 is required.");if(!s.e(r))throw new o.t("u2 is required.");var u,p,a;s.e(h)?h.length=0:h=[],t?(u=i<e,p=n<e,a=r<e):(u=i>e,p=n>e,a=r>e);var d,f,l,c,g,m,w=u+p+a;return 1===w?u?(d=(e-i)/(n-i),f=(e-i)/(r-i),h.push(1),h.push(2),1!==f&&(h.push(-1),h.push(0),h.push(2),h.push(f)),1!==d&&(h.push(-1),h.push(0),h.push(1),h.push(d))):p?(l=(e-n)/(r-n),c=(e-n)/(i-n),h.push(2),h.push(0),1!==c&&(h.push(-1),h.push(1),h.push(0),h.push(c)),1!==l&&(h.push(-1),h.push(1),h.push(2),h.push(l))):a&&(g=(e-r)/(i-r),m=(e-r)/(n-r),h.push(0),h.push(1),1!==m&&(h.push(-1),h.push(2),h.push(1),h.push(m)),1!==g&&(h.push(-1),h.push(2),h.push(0),h.push(g))):2===w?u||i===e?p||n===e?!a&&r!==e&&(f=(e-i)/(r-i),l=(e-n)/(r-n),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(f),h.push(-1),h.push(1),h.push(2),h.push(l)):(m=(e-r)/(n-r),d=(e-i)/(n-i),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(m),h.push(-1),h.push(0),h.push(1),h.push(d)):(c=(e-n)/(i-n),g=(e-r)/(i-r),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(c),h.push(-1),h.push(2),h.push(0),h.push(g)):3!==w&&(h.push(0),h.push(1),h.push(2)),h},computeBarycentricCoordinates:function(e,t,i,r,h,u,p,a,d){if(!s.e(e))throw new o.t("x is required.");if(!s.e(t))throw new o.t("y is required.");if(!s.e(i))throw new o.t("x1 is required.");if(!s.e(r))throw new o.t("y1 is required.");if(!s.e(h))throw new o.t("x2 is required.");if(!s.e(u))throw new o.t("y2 is required.");if(!s.e(p))throw new o.t("x3 is required.");if(!s.e(a))throw new o.t("y3 is required.");var f=i-p,l=p-h,c=u-a,g=r-a,m=1/(c*f+l*g),w=t-a,x=e-p,v=(c*x+l*w)*m,y=(-g*x+f*w)*m,b=1-v-y;return s.e(d)?(d.x=v,d.y=y,d.z=b,d):new n.o(v,y,b)},computeLineSegmentLineSegmentIntersection:function(e,t,n,r,h,u,p,a,d){o.o.typeOf.number("x00",e),o.o.typeOf.number("y00",t),o.o.typeOf.number("x01",n),o.o.typeOf.number("y01",r),o.o.typeOf.number("x10",h),o.o.typeOf.number("y10",u),o.o.typeOf.number("x11",p),o.o.typeOf.number("y11",a);var f=(a-u)*(n-e)-(p-h)*(r-t);if(0!==f){var l=((p-h)*(t-u)-(a-u)*(e-h))/f,c=((n-e)*(t-u)-(r-t)*(e-h))/f;if(l>=0&&l<=1&&c>=0&&c<=1)return s.e(d)||(d=new i.o),d.x=e+l*(n-e),d.y=t+l*(r-t),d}}},C=32767,H=16383,T=[],z=[],N=[],O=new r.a,V=new n.o,q=[],E=[],M=[],R=[],U=[],P=new n.o,F=new t.i,k=new a.y,D=new i.o,L=new n.o;function S(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}S.prototype.clone=function(e){return s.e(e)||(e=new S),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},S.prototype.initializeIndexed=function(e,t,i,n,r){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=r,this.first=void 0,this.second=void 0,this.ratio=void 0},S.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},S.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},S.prototype.isIndexed=function(){return s.e(this.index)},S.prototype.getH=function(e,t){if(s.e(this.index))return this.heightBuffer[this.index];var i=this.first.getH(e,t),n=this.second.getH(e,t);return 0===t+i/C*e||0===t+n/C*e?0:p.e.lerp(this.first.getH(),this.second.getH(),this.ratio)},S.prototype.getU=function(){return s.e(this.index)?this.uBuffer[this.index]:p.e.lerp(this.first.getU(),this.second.getU(),this.ratio)},S.prototype.getV=function(){return s.e(this.index)?this.vBuffer[this.index]:p.e.lerp(this.first.getV(),this.second.getV(),this.ratio)};var X=new i.o,W=-1,K=[new n.o,new n.o],Y=[new n.o,new n.o];function _(t,i){++W;var r=K[W],s=Y[W];return r=e.t.octDecode(t.first.getNormalX(),t.first.getNormalY(),r),s=e.t.octDecode(t.second.getNormalX(),t.second.getNormalY(),s),V=n.o.lerp(r,s,t.ratio,V),n.o.normalize(V,V),e.t.octEncode(V,i),--W,i}S.prototype.getNormalX=function(){return s.e(this.index)?this.normalBuffer[2*this.index]:(X=_(this,X)).x},S.prototype.getNormalY=function(){return s.e(this.index)?this.normalBuffer[2*this.index+1]:(X=_(this,X)).y};var G=[];function J(e,t,i,n,r,h,u,o,p,a,d){if(0!==u.length){for(var f=0,l=0;l<u.length;)l=G[f++].initializeFromClipResult(u,l,o);for(var c=0;c<f;++c){var g=G[c];if(g.isIndexed())g.newIndex=h[g.index],g.uBuffer=e,g.vBuffer=t,g.heightBuffer=i,p&&(g.normalBuffer=n);else{var m=g.getKey();if(s.e(h[m]))g.newIndex=h[m];else{var w=e.length;e.push(g.getU()),t.push(g.getV()),i.push(g.getH(a,d)),p&&(n.push(g.getNormalX()),n.push(g.getNormalY())),g.newIndex=w,h[m]=w}}}3===f?(r.push(G[0].newIndex),r.push(G[1].newIndex),r.push(G[2].newIndex)):4===f&&(r.push(G[0].newIndex),r.push(G[1].newIndex),r.push(G[2].newIndex),r.push(G[0].newIndex),r.push(G[2].newIndex),r.push(G[3].newIndex))}}return G.push(new S),G.push(new S),G.push(new S),G.push(new S),d((function(e,r){var o=e.isEastChild,d=e.isNorthChild,f=o?H:0,l=o?C:H,c=d?H:0,g=d?C:H,m=q,w=E,x=M,v=U;m.length=0,w.length=0,x.length=0,v.length=0;var y=R;y.length=0;var b={},B=e.vertices,I=e.indices;I=I.subarray(0,e.indexCountWithoutSkirts);var X,W,K,Y,_,G=h.h.clone(e.encoding),Z=G.hasVertexNormals,j=e.exaggeration,Q=0,$=e.vertexCountWithoutSkirts,ee=e.minimumHeight,te=e.maximumHeight,ie=s.e(e.validMinimumHeight)?e.validMinimumHeight:e.minimumHeight,ne=s.e(e.validMaximumHeight)?e.validMaximumHeight:e.maximumHeight,re=new Array($),se=new Array($),he=new Array($),ue=Z?new Array(2*$):void 0;for(W=0,K=0;W<$;++W,K+=2){var oe=G.decodeTextureCoordinates(B,W,D);if(X=G.decodeHeight(B,W)/j,Y=p.e.clamp(oe.x*C|0,0,C),_=p.e.clamp(oe.y*C|0,0,C),he[W]=p.e.clamp((X-ee)/(te-ee)*C|0,0,C),Y<20&&(Y=0),_<20&&(_=0),C-Y<20&&(Y=C),C-_<20&&(_=C),re[W]=Y,se[W]=_,Z){var pe=G.getOctEncodedNormal(B,W,L);ue[K]=pe.x,ue[K+1]=pe.y}(o&&Y>=H||!o&&Y<=H)&&(d&&_>=H||!d&&_<=H)&&(b[W]=Q,m.push(Y),w.push(_),x.push(he[W]),Z&&(v.push(ue[K]),v.push(ue[K+1])),++Q)}var ae=[];ae.push(new S),ae.push(new S),ae.push(new S);var de,fe=[];for(fe.push(new S),fe.push(new S),fe.push(new S),W=0;W<I.length;W+=3){var le=I[W],ce=I[W+1],ge=I[W+2],me=re[le],we=re[ce],xe=re[ge];ae[0].initializeIndexed(re,se,he,ue,le),ae[1].initializeIndexed(re,se,he,ue,ce),ae[2].initializeIndexed(re,se,he,ue,ge);var ve=A.clipTriangleAtAxisAlignedThreshold(H,o,me,we,xe,T);(de=0)>=ve.length||((de=fe[0].initializeFromClipResult(ve,de,ae))>=ve.length||(de=fe[1].initializeFromClipResult(ve,de,ae))>=ve.length||(de=fe[2].initializeFromClipResult(ve,de,ae),J(m,w,x,v,y,b,A.clipTriangleAtAxisAlignedThreshold(H,d,fe[0].getV(),fe[1].getV(),fe[2].getV(),z),fe,Z,te,ee),de<ve.length&&(fe[2].clone(fe[1]),fe[2].initializeFromClipResult(ve,de,ae),J(m,w,x,v,y,b,A.clipTriangleAtAxisAlignedThreshold(H,d,fe[0].getV(),fe[1].getV(),fe[2].getV(),z),fe,Z,te,ee))))}var ye=o?-32767:0,be=d?-32767:0,Be=[],Ie=[],Ae=[],Ce=[],He=Number.MAX_VALUE,Te=-He,ze=Number.MAX_VALUE,Ne=-He,Oe=N;Oe.length=0;var Ve=i.t.clone(e.ellipsoid),qe=i.h.clone(e.childRectangle),Ee=qe.north,Me=qe.south,Re=qe.east,Ue=qe.west;for(Re<Ue&&(Re+=p.e.TWO_PI),W=0;W<m.length;++W){(Y=Math.round(m[W]))<=f?(Be.push(W),Y=0):Y>=l?(Ae.push(W),Y=C):Y=2*Y+ye,m[W]=Y,(_=Math.round(w[W]))<=c?(Ie.push(W),_=0):_>=g?(Ce.push(W),_=C):_=2*_+be,w[W]=_,(X=p.e.lerp(ee,te,x[W]/C))<He&&(He=X),X>Te&&(Te=X);var Pe=X;(Pe=p.e.clamp(Pe,ie,ne))<ze&&(ze=Pe),Pe>Ne&&(Ne=Pe),x[W]=X,O.longitude=p.e.lerp(Ue,Re,Y/C),O.latitude=p.e.lerp(Me,Ee,_/C),O.height=X,Ve.cartographicToCartesian(O,V),Oe.push(V.x),Oe.push(V.y),Oe.push(V.z)}var Fe=t.i.fromVertices(Oe,n.o.ZERO,3,F),ke=a.y.fromRectangle(qe,He,Te,Ve,k),De=a.y.fromRectangle(qe,ze,Ne,Ve,k),Le=new h.s(Ve).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Fe.center,Oe,3,Fe.center,He,P),Se=Te-He,Xe=new Uint16Array(m.length+w.length+x.length);for(W=0;W<m.length;++W)Xe[W]=m[W];var We=m.length;for(W=0;W<w.length;++W)Xe[We+W]=w[W];for(We+=w.length,W=0;W<x.length;++W)Xe[We+W]=C*(x[W]-He)/Se;var Ke,Ye=u.IndexDatatype.createTypedArray(m.length,y);if(Z){var _e=new Uint8Array(v);r.push(Xe.buffer,Ye.buffer,_e.buffer),Ke=_e.buffer}else r.push(Xe.buffer,Ye.buffer);return{vertices:Xe.buffer,encodedNormals:Ke,indices:Ye.buffer,minimumHeight:He,maximumHeight:Te,westIndices:Be,southIndices:Ie,eastIndices:Ae,northIndices:Ce,boundingSphere:Fe,orientedBoundingBox:ke,horizonOcclusionPoint:Le,validMinimumHeight:ze,validMaximumHeight:Ne,validOrientedBoundingBox:De}}))}));
