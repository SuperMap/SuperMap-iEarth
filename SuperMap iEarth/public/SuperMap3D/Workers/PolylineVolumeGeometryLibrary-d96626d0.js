define(["exports","./Cartesian2-b72655a5","./Cartesian3-3a8bdb0b","./Cartesian4-72b88c9e","./Cartographic-a2c313d7","./EllipsoidTangentPlane-d6b88a1f","./Math-ecf82623","./FeatureDetection-cec0163f","./PolylinePipeline-f0970409","./GeometryAttribute-f47bd1cb"],(function(o,e,r,a,n,t,l,i,c,s){"use strict";var u=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),p=[new r.o,new r.o],m=new r.o,y=new r.o,d=new r.o,f=new r.o,g=new r.o,v=new r.o,h=new r.o,w=new r.o,B=new r.o,E=new r.o,z=new r.o,S={},b=new n.a;function A(o,e){for(var r=new Array(o.length),a=0;a<o.length;a++){var n=o[a];b=e.cartesianToCartographic(n,b),r[a]=b.height,o[a]=e.scaleToGeodeticSurface(n,n)}return r}function P(o,e,a,n){var t,l=o[0],i=o[1],c=r.o.angleBetween(l,i),s=Math.ceil(c/n),u=new Array(s);if(e===a){for(t=0;t<s;t++)u[t]=e;return u.push(a),u}var p=(a-e)/s;for(t=1;t<s;t++){var m=e+t*p;u[t]=m}return u[0]=e,u.push(a),u}var T=new r.o,D=new r.o;function x(o,a,n,l){var i=new t.f(n,l),c=i.projectPointOntoPlane(r.o.add(n,o,T),T),s=i.projectPointOntoPlane(r.o.add(n,a,D),D),u=e.o.angleBetween(c,s);return s.x*c.y-s.y*c.x>=0?-u:u}var N=new r.o(-1,0,0),O=i.p.clone(i.p.IDENTITY),R=new i.p,V=new i.p$1,F=i.p$1.IDENTITY.clone(),I=new r.o,$=new a.e,L=new r.o;function G(o,e,a,n,t,l,c,u){var p=I,m=$;O=s.m.eastNorthUpToFixedFrame(o,t,O),p=i.p.multiplyByPointAsVector(O,N,p);var y=x(p=r.o.normalize(p,p),e,o,t);V=i.p$1.fromRotationZ(y,V),L.z=l,O=i.p.multiplyTransformation(O,i.p.fromRotationTranslation(V,L,R),O);var d=F;d[0]=c;for(var f=0;f<u;f++)for(var g=0;g<a.length;g+=3)m=r.o.fromArray(a,g,m),m=i.p$1.multiplyByVector(d,m,m),m=i.p.multiplyByPoint(O,m,m),n.push(m.x,m.y,m.z);return n}function M(o,e,a,n,t,l,c,u,p){var m=I,y=$;O=s.m.eastNorthUpToFixedFrame(o,t,O),m=i.p.multiplyByPointAsVector(O,N,m);var d=x(m=r.o.normalize(m,m),e,o,t);V=i.p$1.fromRotationZ(d,V),L.z=l,O=i.p.multiplyTransformation(O,i.p.fromRotationTranslation(V,L,R),O);var f=F;f[0]=c;for(var g=0;g<u;g++)for(var v=0;v<a.length;v+=3)y=r.o.fromArray(a,v,y),y=i.p$1.multiplyByVector(f,y,y),y=i.p.multiplyByPoint(O,y,y),y=i.p.multiplyByPoint(p,y,y),n.push(y.x,y.y,y.z);return n}var U=new r.o;function _(o,e,a,n,t,l,i){for(var c=0;c<o.length;c+=3){n=G(r.o.fromArray(o,c,U),e,a,n,t,l[c/3],i,1)}return n}function j(o,e){var r=o.length,a=new Array(6*r),n=0,t=e.x+e.width/2,l=e.y+e.height/2,i=o[0];a[n++]=i.x-t,a[n++]=0,a[n++]=i.y-l;for(var c=1;c<r;c++){var s=(i=o[c]).x-t,u=i.y-l;a[n++]=s,a[n++]=0,a[n++]=u,a[n++]=s,a[n++]=0,a[n++]=u}return i=o[0],a[n++]=i.x-t,a[n++]=0,a[n++]=i.y-l,a}function C(o,e){for(var r=o.length,a=new Array(3*r),n=0,t=e.x+e.width/2,l=e.y+e.height/2,i=0;i<r;i++)a[n++]=o[i].x-t,a[n++]=0,a[n++]=o[i].y-l;return a}var q=new s.n,Q=new r.o,Y=new i.p$1;function Z(o,e,a,n,t,c,p,m,y,d){var f,g,v=r.o.angleBetween(r.o.subtract(e,o,E),r.o.subtract(a,o,z)),h=n===u.BEVELED?0:Math.ceil(v/l.e.toRadians(5));if(f=t?i.p$1.fromQuaternion(s.n.fromAxisAngle(r.o.negate(o,E),v/(h+1),q),Y):i.p$1.fromQuaternion(s.n.fromAxisAngle(o,v/(h+1),q),Y),e=r.o.clone(e,Q),h>0)for(var w=d?2:1,B=0;B<h;B++)e=i.p$1.multiplyByVector(f,e,e),g=r.o.subtract(e,o,E),g=r.o.normalize(g,g),t||(g=r.o.negate(g,g)),p=G(c.scaleToGeodeticSurface(e,z),g,m,p,c,y,1,w);else g=r.o.subtract(e,o,E),g=r.o.normalize(g,g),t||(g=r.o.negate(g,g)),p=G(c.scaleToGeodeticSurface(e,z),g,m,p,c,y,1,1),a=r.o.clone(a,Q),g=r.o.subtract(a,o,E),g=r.o.normalize(g,g),t||(g=r.o.negate(g,g)),p=G(c.scaleToGeodeticSurface(a,z),g,m,p,c,y,1,1);return p}S.removeDuplicatesFromShape=function(o){for(var r=o.length,a=[],n=r-1,t=0;t<r;n=t++){var l=o[n],i=o[t];e.o.equals(l,i)||a.push(i)}return a},S.angleIsGreaterThanPi=function(o,e,a,n){var l=new t.f(a,n),i=l.projectPointOntoPlane(r.o.add(a,o,T),T),c=l.projectPointOntoPlane(r.o.add(a,e,D),D);return c.x*i.y-c.y*i.x>=0};var J=new r.o,k=new r.o;S.computePositions=function(o,e,a,n,t){var i=n._ellipsoid,s=A(o,i),z=n._granularity,b=n._cornerType,T=t?j(e,a):C(e,a),D=t?C(e,a):void 0,x=a.height/2,N=a.width/2,O=o.length,R=[],V=t?[]:void 0,F=m,I=y,$=d,L=f,M=g,U=v,q=h,Q=w,Y=B,H=o[0],K=o[1];L=i.geodeticSurfaceNormal(H,L),F=r.o.subtract(K,H,F),F=r.o.normalize(F,F),Q=r.o.cross(L,F,Q),Q=r.o.normalize(Q,Q);var W=s[0],X=s[1];t&&(V=G(H,Q,D,V,i,W+x,1,1)),Y=r.o.clone(H,Y),H=K,I=r.o.negate(F,I);for(var oo,eo=1;eo<O-1;eo++){var ro=t?2:1;K=o[eo+1],F=r.o.subtract(K,H,F),F=r.o.normalize(F,F),$=r.o.add(F,I,$),$=r.o.normalize($,$),L=i.geodeticSurfaceNormal(H,L);var ao=r.o.multiplyByScalar(L,r.o.dot(F,L),J);r.o.subtract(F,ao,ao),r.o.normalize(ao,ao);var no=r.o.multiplyByScalar(L,r.o.dot(I,L),k);if(r.o.subtract(I,no,no),r.o.normalize(no,no),!l.e.equalsEpsilon(Math.abs(r.o.dot(ao,no)),1,l.e.EPSILON7)){$=r.o.cross($,L,$),$=r.o.cross(L,$,$),$=r.o.normalize($,$);var to=1/Math.max(.25,r.o.magnitude(r.o.cross($,I,E))),lo=S.angleIsGreaterThanPi(F,I,H,i);lo?(M=r.o.add(H,r.o.multiplyByScalar($,to*N,$),M),U=r.o.add(M,r.o.multiplyByScalar(Q,N,U),U),p[0]=r.o.clone(Y,p[0]),p[1]=r.o.clone(U,p[1]),oo=P(p,W+x,X+x,z),R=_(c.m.generateArc({positions:p,granularity:z,ellipsoid:i}),Q,T,R,i,oo,1),Q=r.o.cross(L,F,Q),Q=r.o.normalize(Q,Q),q=r.o.add(M,r.o.multiplyByScalar(Q,N,q),q),b===u.ROUNDED||b===u.BEVELED?Z(M,U,q,b,lo,i,R,T,X+x,t):R=G(H,$=r.o.negate($,$),T,R,i,X+x,to,ro),Y=r.o.clone(q,Y)):(M=r.o.add(H,r.o.multiplyByScalar($,to*N,$),M),U=r.o.add(M,r.o.multiplyByScalar(Q,-N,U),U),p[0]=r.o.clone(Y,p[0]),p[1]=r.o.clone(U,p[1]),oo=P(p,W+x,X+x,z),R=_(c.m.generateArc({positions:p,granularity:z,ellipsoid:i}),Q,T,R,i,oo,1),Q=r.o.cross(L,F,Q),Q=r.o.normalize(Q,Q),q=r.o.add(M,r.o.multiplyByScalar(Q,-N,q),q),b===u.ROUNDED||b===u.BEVELED?Z(M,U,q,b,lo,i,R,T,X+x,t):R=G(H,$,T,R,i,X+x,to,ro),Y=r.o.clone(q,Y)),I=r.o.negate(F,I)}else R=G(Y,Q,T,R,i,W+x,1,1),Y=H;W=X,X=s[eo+1],H=K}p[0]=r.o.clone(Y,p[0]),p[1]=r.o.clone(H,p[1]),oo=P(p,W+x,X+x,z),R=_(c.m.generateArc({positions:p,granularity:z,ellipsoid:i}),Q,T,R,i,oo,1),t&&(V=G(H,Q,D,V,i,X+x,1,1)),O=R.length;var io=t?O+V.length:O,co=new Float64Array(io);return co.set(R),t&&co.set(V,O),co},S.computeLocalPositions=function(o,e,a,n,t,z){var b=n._ellipsoid,T=A(o,b),D=n._granularity,x=n._cornerType,N=t?j(e,a):C(e,a),O=t?C(e,a):void 0,R=a.width/2,V=o.length,F=[],I=t?[]:void 0,$=m,L=y,G=d,q=f,Q=g,Y=v,H=h,K=w,W=B,X=s.m.eastNorthUpToFixedFrame(z,b,new i.p),oo=i.p.inverse(X,new i.p),eo=o[0],ro=o[1];q=b.geodeticSurfaceNormal(eo,q),$=r.o.subtract(ro,eo,$),$=r.o.normalize($,$),K=r.o.cross(q,$,K),K=r.o.normalize(K,K);var ao=T[0],no=T[1];t&&(I=M(eo,K,O,I,b,ao+0,1,1,oo)),W=r.o.clone(eo,W),eo=ro,L=r.o.negate($,L);for(var to,lo=1;lo<V-1;lo++){var io=t?2:1;ro=o[lo+1],$=r.o.subtract(ro,eo,$),$=r.o.normalize($,$),G=r.o.add($,L,G),G=r.o.normalize(G,G),q=b.geodeticSurfaceNormal(eo,q);var co=r.o.multiplyByScalar(q,r.o.dot($,q),J);r.o.subtract($,co,co),r.o.normalize(co,co);var so=r.o.multiplyByScalar(q,r.o.dot(L,q),k);if(r.o.subtract(L,so,so),r.o.normalize(so,so),!l.e.equalsEpsilon(Math.abs(r.o.dot(co,so)),1,l.e.EPSILON7)){G=r.o.cross(G,q,G),G=r.o.cross(q,G,G),G=r.o.normalize(G,G);var uo=1/Math.max(.25,r.o.magnitude(r.o.cross(G,L,E))),po=S.angleIsGreaterThanPi($,L,eo,b);po?(Q=r.o.add(eo,r.o.multiplyByScalar(G,uo*R,G),Q),Y=r.o.add(Q,r.o.multiplyByScalar(K,R,Y),Y),p[0]=r.o.clone(W,p[0]),p[1]=r.o.clone(Y,p[1]),to=P(p,ao+0,no+0,D),F=_(c.m.generateArc({positions:p,granularity:D,ellipsoid:b}),K,N,F,b,to,1,fromEnu),K=r.o.cross(q,$,K),K=r.o.normalize(K,K),H=r.o.add(Q,r.o.multiplyByScalar(K,R,H),H),x===u.ROUNDED||x===u.BEVELED?Z(Q,Y,H,x,po,b,F,N,no+0,t):F=M(eo,G=r.o.negate(G,G),N,F,b,no+0,uo,io,oo),W=r.o.clone(H,W)):(Q=r.o.add(eo,r.o.multiplyByScalar(G,uo*R,G),Q),Y=r.o.add(Q,r.o.multiplyByScalar(K,-R,Y),Y),p[0]=r.o.clone(W,p[0]),p[1]=r.o.clone(Y,p[1]),to=P(p,ao+0,no+0,D),F=_(c.m.generateArc({positions:p,granularity:D,ellipsoid:b}),K,N,F,b,to,1),K=r.o.cross(q,$,K),K=r.o.normalize(K,K),H=r.o.add(Q,r.o.multiplyByScalar(K,-R,H),H),x===u.ROUNDED||x===u.BEVELED?Z(Q,Y,H,x,po,b,F,N,no+0,t):F=M(eo,G,N,F,b,no+0,uo,io,oo),W=r.o.clone(H,W)),L=r.o.negate($,L)}else F=M(W,K,N,F,b,ao+0,1,1,oo),W=eo;ao=no,no=T[lo+1],eo=ro}p[0]=r.o.clone(W,p[0]),p[1]=r.o.clone(eo,p[1]),to=P(p,ao+0,no+0,D),F=function(o,e,a,n,t,l,i,c){for(var s=0;s<o.length;s+=3)n=M(r.o.fromArray(o,s,U),e,a,n,t,l[s/3],i,1,c);return n}(c.m.generateArc({positions:p,granularity:D,ellipsoid:b}),K,N,F,b,to,1,oo),t&&(I=M(eo,K,O,I,b,no+0,1,1,oo)),V=F.length;var mo=t?V+I.length:V,yo=new Float64Array(mo);return yo.set(F),t&&yo.set(I,V),yo},o.J=S,o.S=u}));
