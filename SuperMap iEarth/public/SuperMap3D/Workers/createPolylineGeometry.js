import{a as Pe}from"./chunk-4BBYSOVM.js";import{a as d}from"./chunk-MMOQDUXZ.js";import{a as B}from"./chunk-J67OD5PY.js";import"./chunk-XYWAVEQ2.js";import{a as P}from"./chunk-RYEDLSXB.js";import{a as D}from"./chunk-SP6GVFX5.js";import{a as we}from"./chunk-D45ASFTR.js";import"./chunk-6X6ULKRC.js";import"./chunk-REXJO6A6.js";import"./chunk-EUSYH4JF.js";import{a as _e}from"./chunk-44AFRGCG.js";import{a as ue}from"./chunk-UIA2BV6O.js";import{d as he,e as de,k as me,l as V}from"./chunk-CJHFPVIB.js";import"./chunk-NPAFDOYL.js";import{b as se}from"./chunk-SSYG2MIY.js";import{a as F}from"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import"./chunk-Z4SOZDEW.js";import"./chunk-MX7ZM7WW.js";import"./chunk-EHDXVZQM.js";import"./chunk-NLYLRNUA.js";import{b as u}from"./chunk-7TOCOFC3.js";import"./chunk-ZVKIUA3Y.js";import"./chunk-3HZNWEV7.js";import{a as f}from"./chunk-LBR6REQR.js";import{a as $}from"./chunk-GXFCHGTA.js";import{a as m}from"./chunk-UBHQMGET.js";import"./chunk-EDZQSM3T.js";import{a as k}from"./chunk-PJGSCWXZ.js";import{a as l}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";function Be(e,r){if(!l(e)||!l(r))throw new k("identifier and message are required.");Pe(e,r)}var Ae=Be;var ye=[];function Ce(e,r,t,o,i){var c=ye;c.length=i;var n,x=t.red,E=t.green,w=t.blue,y=t.alpha,h=o.red,a=o.green,_=o.blue,p=o.alpha;if(d.equals(t,o)){for(n=0;n<i;n++)c[n]=d.clone(t);return c}var v=(h-x)/i,L=(a-E)/i,O=(_-w)/i,U=(p-y)/i;for(n=0;n<i;n++)c[n]=new d(x+n*v,E+n*L,w+n*O,y+n*U);return c}function R(e){e=m(e,m.EMPTY_OBJECT);var r=e.positions,t=e.colors,o=m(e.width,1),i=m(e.hMax,-1),c=m(e.colorsPerVertex,!1);if(!l(r)||r.length<2)throw new k("At least two positions are required.");if(typeof o!="number")throw new k("width must be a number");if(l(t)&&(c&&t.length<r.length||!c&&t.length<r.length-1))throw new k("colors has an invalid length.");this._positions=r,this._colors=t,this._width=o,this._hMax=i,this._colorsPerVertex=c,this._dist=e.dist,this._period=e.period,this._vertexFormat=P.clone(m(e.vertexFormat,P.DEFAULT)),this._followSurface=m(e.followSurface,!0),l(e.followSurface)&&(Ae("PolylineGeometry.followSurface","PolylineGeometry.followSurface is deprecated and will be removed in SuperMap3D. Use PolylineGeometry.arcType instead."),e.arcType=e.followSurface?D.GEODESIC:D.NONE),this._arcType=m(e.arcType,D.GEODESIC),this._followSurface=this._arcType!==D.NONE,this._granularity=m(e.granularity,$.RADIANS_PER_DEGREE),this._ellipsoid=u.clone(m(e.ellipsoid,u.WGS84)),this._workerName="createPolylineGeometry";var n=1+r.length*f.packedLength;n+=l(t)?1+t.length*d.packedLength:1,this.packedLength=n+u.packedLength+P.packedLength+4+2}R.pack=function(e,r,t){if(!l(e))throw new k("value is required");if(!l(r))throw new k("array is required");t=m(t,0);var o,i=e._positions,c=i.length;for(r[t++]=c,o=0;o<c;++o,t+=f.packedLength)f.pack(i[o],r,t);var n=e._colors;for(c=l(n)?n.length:0,r[t++]=c,o=0;o<c;++o,t+=d.packedLength)d.pack(n[o],r,t);return u.pack(e._ellipsoid,r,t),t+=u.packedLength,P.pack(e._vertexFormat,r,t),t+=P.packedLength,r[t++]=e._width,r[t++]=e._colorsPerVertex?1:0,r[t++]=e._arcType,r[t++]=e._granularity,r[t++]=e._hMax,r[t++]=e._dist,r[t]=e._period,r};var Le=u.clone(u.UNIT_SPHERE),ge=new P,A={positions:void 0,colors:void 0,ellipsoid:Le,vertexFormat:ge,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};R.unpack=function(e,r,t){if(!l(e))throw new k("array is required");r=m(r,0);var o,i=e[r++],c=new Array(i);for(o=0;o<i;++o,r+=f.packedLength)c[o]=f.unpack(e,r);i=e[r++];var n=i>0?new Array(i):void 0;for(o=0;o<i;++o,r+=d.packedLength)n[o]=d.unpack(e,r);var x=u.unpack(e,r,Le);r+=u.packedLength;var E=P.unpack(e,r,ge);r+=P.packedLength;var w=e[r++],y=e[r++]===1,h=e[r++],a=e[r++],_=e[r++],p=e[r++]==1,v=e[r];return l(t)?(t._positions=c,t._colors=n,t._ellipsoid=u.clone(x,t._ellipsoid),t._vertexFormat=P.clone(E,t._vertexFormat),t._width=w,t._colorsPerVertex=y,t._arcType=h,t._granularity=a,t._hMax=_,t._dist=p,t._period=v,t):(A.positions=c,A.colors=n,A.width=w,A.colorsPerVertex=y,A.arcType=h,A.granularity=a,A.hMax=_,A.dist=p,A.period=v,new R(A))};var Ee=new f,Te=new f,ke=new f,De=new f;R.createGeometry=function(e){var r=e._width,t=e._hMax,o=e._vertexFormat,i=e._colors,c=e._colorsPerVertex,n=e._arcType,x=e._granularity,E=e._ellipsoid,w=e._dist,y=e._period,h,a,_,p=we(e._positions,f.equalsEpsilon),v=p.length;if(!(v<2||r<=0)){if(n===D.GEODESIC||n===D.RHUMB){var L,O;n===D.GEODESIC?(L=$.chordLength(x,E.maximumRadius),O=B.numberOfPoints):(L=x,O=B.numberOfPointsRhumbLine);var U=B.extractHeights(p,E);if(l(i)){var J=1;for(h=0;h<v-1;++h)J+=O(p[h],p[h+1],L);var G=new Array(J),K=0;for(h=0;h<v-1;++h){var I=p[h],ee=p[h+1],re=i[h],te=O(I,ee,L);if(c&&h<J){var be=i[h+1],ae=Ce(I,ee,re,be,te),Fe=ae.length;for(a=0;a<Fe;++a)G[K++]=ae[a]}else for(a=0;a<te;++a)G[K++]=d.clone(re)}G[K]=d.clone(i[i.length-1]),i=G,ye.length=0}n===D.GEODESIC?p=B.generateCartesianArc({positions:p,minDistance:L,ellipsoid:E,height:U,hMax:t}):p=B.generateCartesianRhumbArc({positions:p,granularity:L,ellipsoid:E,height:U})}v=p.length;var T=v*4-4,oe=new Float64Array(T*3),ie=new Float64Array(T*3),ne=new Float64Array(T*3),C=new Float32Array(T*2),Q=o.st?new Float32Array(T*2):void 0,g=l(i)?new Uint8Array(T*4):void 0,q=w?new Float32Array(T*3):void 0,W=0,H=0,pe=0,Y=0,ce=0,s,X=0;for(a=0;a<v;++a){a===0?(s=Ee,f.subtract(p[0],p[1],s),f.add(p[0],s,s)):s=p[a-1],f.clone(s,ke),f.clone(p[a],Te),a===v-1?(s=Ee,f.subtract(p[v-1],p[v-2],s),f.add(p[v-1],s,s)):s=p[a+1],f.clone(s,De);var Z,fe;l(g)&&(a!==0&&!c?Z=i[a-1]:Z=i[a],a!==v-1&&(fe=i[a]));var Ve=a===0?2:0,xe=a===v-1?2:4;for(_=Ve;_<xe;++_){f.pack(Te,oe,W),f.pack(ke,ie,W),f.pack(De,ne,W),W+=3;var Me=_-2<0?-1:1,ve=2*(_%2)-1,Se=ve*a/v;if(t>0?C[H++]=Se:C[H++]=ve,C[H++]=Me*r,o.st&&(Q[pe++]=a/(v-1),Q[pe++]=Math.max(C[H-2],0)),l(g)){var j=_<2?Z:fe;g[Y++]=d.floatToByte(j.red),g[Y++]=d.floatToByte(j.green),g[Y++]=d.floatToByte(j.blue),g[Y++]=d.floatToByte(j.alpha)}w&&(q[ce*3]=X,ce++)}X+=f.distance(s,p[a])}if(w){var le=X,Oe=Math.random()*(y>0?y:le);for(a=0;a<T;a++)q[a*3+1]=le,q[a*3+2]=Oe}var b=new ue;b.position=new V({componentDatatype:F.DOUBLE,componentsPerAttribute:3,values:oe}),b.prevPosition=new V({componentDatatype:F.DOUBLE,componentsPerAttribute:3,values:ie}),b.nextPosition=new V({componentDatatype:F.DOUBLE,componentsPerAttribute:3,values:ne}),b.expandAndWidth=new V({componentDatatype:F.FLOAT,componentsPerAttribute:2,values:C}),o.st&&(b.st=new V({componentDatatype:F.FLOAT,componentsPerAttribute:2,values:Q})),l(g)&&(b.color=new V({componentDatatype:F.UNSIGNED_BYTE,componentsPerAttribute:4,values:g,normalize:!0})),w&&(b.dist=new V({componentDatatype:F.FLOAT,componentsPerAttribute:3,values:q}));var M=_e.createTypedArray(T,v*6-6),S=0,N=0,Ne=v-1;for(a=0;a<Ne;++a)M[N++]=S,M[N++]=S+2,M[N++]=S+1,M[N++]=S+1,M[N++]=S+2,M[N++]=S+3,S+=4;return new me({attributes:b,indices:M,primitiveType:se.TRIANGLES,boundingSphere:he.fromPoints(p),geometryType:de.POLYLINES})}};var z=R;function Re(e,r){return l(r)&&(e=z.unpack(e,r)),e._ellipsoid=u.clone(e._ellipsoid),z.createGeometry(e)}var dr=Re;export{dr as default};
