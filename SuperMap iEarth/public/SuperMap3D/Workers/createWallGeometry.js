import{a as ve}from"./chunk-CSRO25PT.js";import"./chunk-PHVMFTD2.js";import"./chunk-XYWAVEQ2.js";import{a as _}from"./chunk-RYEDLSXB.js";import"./chunk-D45ASFTR.js";import"./chunk-6X6ULKRC.js";import"./chunk-5YCA7L25.js";import"./chunk-4J7EQ5UP.js";import{a as ue}from"./chunk-44AFRGCG.js";import{a as pe}from"./chunk-UIA2BV6O.js";import{d as oe,j as me,k as se,l as N}from"./chunk-CWROUHP4.js";import"./chunk-NPAFDOYL.js";import{a as ne,b as ae}from"./chunk-F5UB2CPM.js";import{a as E}from"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import"./chunk-KJYJTW2V.js";import"./chunk-6NA2GRXE.js";import"./chunk-EHDXVZQM.js";import"./chunk-NLYLRNUA.js";import{b as f}from"./chunk-7TOCOFC3.js";import"./chunk-ZVKIUA3Y.js";import"./chunk-3HZNWEV7.js";import{a as t}from"./chunk-LBR6REQR.js";import{a as U}from"./chunk-GXFCHGTA.js";import{a as d}from"./chunk-UBHQMGET.js";import"./chunk-EDZQSM3T.js";import{a as y}from"./chunk-PJGSCWXZ.js";import{a}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";var $=new t,Z=new t,fe=new t,be=new t,he=new t,Fe=new t,Ce=new t,ke=new t;function x(e){e=d(e,d.EMPTY_OBJECT);var i=e.positions,r=e.maximumHeights,o=e.minimumHeights;if(!a(i))throw new y("options.positions is required.");if(a(r)&&r.length!==i.length)throw new y("options.positions and options.maximumHeights must have the same length.");if(a(o)&&o.length!==i.length)throw new y("options.positions and options.minimumHeights must have the same length.");var n=d(e.vertexFormat,_.DEFAULT),s=d(e.granularity,U.RADIANS_PER_DEGREE),p=d(e.ellipsoid,f.WGS84);this._positions=i,this._minimumHeights=o,this._maximumHeights=r,this._vertexFormat=_.clone(n),this._granularity=s,this._ellipsoid=f.clone(p),this._enuCenter=e.enuCenter,this._workerName="createWallGeometry";var m=1+i.length*t.packedLength+2;a(o)&&(m+=o.length),a(r)&&(m+=r.length),this.packedLength=m+f.packedLength+_.packedLength+1,this.packedLength+=t.packedLength}x.pack=function(e,i,r){if(!a(e))throw new y("value is required");if(!a(i))throw new y("array is required");r=d(r,0);var o,n=e._positions,s=n.length;for(i[r++]=s,o=0;o<s;++o,r+=t.packedLength)t.pack(n[o],i,r);var p=e._minimumHeights;if(s=a(p)?p.length:0,i[r++]=s,a(p))for(o=0;o<s;++o)i[r++]=p[o];var m=e._maximumHeights;if(s=a(m)?m.length:0,i[r++]=s,a(m))for(o=0;o<s;++o)i[r++]=m[o];return f.pack(e._ellipsoid,i,r),r+=f.packedLength,_.pack(e._vertexFormat,i,r),r+=_.packedLength,i[r++]=e._granularity,a(e._enuCenter)?t.pack(e._enuCenter,i,r):t.pack(t.ZERO,i,r),i};var ce=f.clone(f.UNIT_SPHERE),le=new _,q={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:ce,vertexFormat:le,granularity:void 0,enuCenter:void 0};x.unpack=function(e,i,r){if(!a(e))throw new y("array is required");i=d(i,0);var o,n=e[i++],s=new Array(n);for(o=0;o<n;++o,i+=t.packedLength)s[o]=t.unpack(e,i);n=e[i++];var p;if(n>0)for(p=new Array(n),o=0;o<n;++o)p[o]=e[i++];n=e[i++];var m;if(n>0)for(m=new Array(n),o=0;o<n;++o)m[o]=e[i++];var v=f.unpack(e,i,ce);i+=f.packedLength;var w=_.unpack(e,i,le);i+=_.packedLength;var P=e[i++],c=t.unpack(e,i);return t.equals(c,t.ZERO)&&(c=void 0),a(r)?(r._positions=s,r._minimumHeights=p,r._maximumHeights=m,r._ellipsoid=f.clone(v,r._ellipsoid),r._vertexFormat=_.clone(w,r._vertexFormat),r._granularity=P,r._enuCenter=c,r):(q.positions=s,q.minimumHeights=p,q.maximumHeights=m,q.granularity=P,q.enuCenter=c,new x(q))};x.fromConstantHeights=function(e){e=d(e,d.EMPTY_OBJECT);var i=e.positions;if(!a(i))throw new y("options.positions is required.");var r,o,n=e.minimumHeight,s=e.maximumHeight,p=a(n),m=a(s);if(p||m){var v=i.length;r=p?new Array(v):void 0,o=m?new Array(v):void 0;for(var w=0;w<v;++w)p&&(r[w]=n),m&&(o[w]=s)}var P={positions:i,maximumHeights:o,minimumHeights:r,ellipsoid:e.ellipsoid,vertexFormat:e.vertexFormat};return new x(P)};x.createGeometry=function(e){var i=e._positions,r=e._minimumHeights,o=e._maximumHeights,n=e._vertexFormat,s=e._granularity,p=e._ellipsoid,m=e._enuCenter,v=ve.computePositions(p,i,o,r,s,!0,m);if(!!(a(v)&&a(v.pos))){var w;a(m)&&(w=me.eastNorthUpToFixedFrame(m));var P=v.pos.bottomPositions,c=v.pos.topPositions,ge=v.pos.numCorners,B=c.length,H=B*2,l=n.position?new Float64Array(H):void 0,b=n.normal?new Float32Array(H):void 0,F=n.tangent?new Float32Array(H):void 0,C=n.bitangent?new Float32Array(H):void 0,M=n.st?new Float32Array(H/3*2):void 0,T=0,L=0,O=0,z=0,G=0,u=ke,g=Ce,A=Fe,J=!0;B/=3;var h,Y=0,de=1/(B-i.length+1);for(h=0;h<B;++h){var R=h*3,W=t.fromArray(c,R,$),j=t.fromArray(P,R,Z);if(n.position&&(l[T++]=j.x,l[T++]=j.y,l[T++]=j.z,l[T++]=W.x,l[T++]=W.y,l[T++]=W.z),n.st&&(M[G++]=Y,M[G++]=0,M[G++]=Y,M[G++]=1),n.normal||n.tangent||n.bitangent){var K,ee=t.clone(t.ZERO,he),Q=p.scaleToGeodeticSurface(t.fromArray(c,R,Z),Z);if(h+1<B&&(K=p.scaleToGeodeticSurface(t.fromArray(c,R+3,fe),fe),ee=t.fromArray(c,R+3,he)),J){var _e=t.subtract(ee,W,be),we=t.subtract(Q,W,$);u=t.normalize(t.cross(we,_e,u),u),J=!1}t.equalsEpsilon(K,Q,U.EPSILON10)?J=!0:(Y+=de,n.tangent&&(g=t.normalize(t.subtract(K,Q,g),g)),n.bitangent&&(A=t.normalize(t.cross(u,g,A),A))),n.normal&&(a(m)&&(ne.multiplyByPoint(w,u,u),t.normalize(u,u)),b[L++]=u.x,b[L++]=u.y,b[L++]=u.z,b[L++]=u.x,b[L++]=u.y,b[L++]=u.z),n.tangent&&(F[z++]=g.x,F[z++]=g.y,F[z++]=g.z,F[z++]=g.x,F[z++]=g.y,F[z++]=g.z),n.bitangent&&(C[O++]=A.x,C[O++]=A.y,C[O++]=A.z,C[O++]=A.x,C[O++]=A.y,C[O++]=A.z)}}var D=new pe;n.position&&(D.position=new N({componentDatatype:E.DOUBLE,componentsPerAttribute:3,values:l})),n.normal&&(D.normal=new N({componentDatatype:E.FLOAT,componentsPerAttribute:3,values:b})),n.tangent&&(D.tangent=new N({componentDatatype:E.FLOAT,componentsPerAttribute:3,values:F})),n.bitangent&&(D.bitangent=new N({componentDatatype:E.FLOAT,componentsPerAttribute:3,values:C})),n.st&&(D.st=new N({componentDatatype:E.FLOAT,componentsPerAttribute:2,values:M}));var ie=H/3;H-=6*(ge+1);var k=ue.createTypedArray(ie,H),S=0;for(h=0;h<ie-2;h+=2){var X=h,te=h+2,Ae=t.fromArray(l,X*3,$),He=t.fromArray(l,te*3,Z);if(!t.equalsEpsilon(Ae,He,U.EPSILON10)){var ye=h+1,re=h+3;k[S++]=ye,k[S++]=X,k[S++]=re,k[S++]=re,k[S++]=X,k[S++]=te}}var V=new se({attributes:D,indices:k,primitiveType:ae.TRIANGLES,boundingSphere:new oe.fromVertices(l)});return a(e._enuCenter)&&(V.attributes.position.values.set(v.localPos.topPositions,0),V.attributes.position.values.set(v.localPos.bottomPositions,V.attributes.position.values.length/2),V.attributes.position.componentDatatype=E.FLOAT),V}};var I=x;function Ee(e,i){return a(i)&&(e=I.unpack(e,i)),e._ellipsoid=f.clone(e._ellipsoid),I.createGeometry(e)}var Ke=Ee;export{Ke as default};
