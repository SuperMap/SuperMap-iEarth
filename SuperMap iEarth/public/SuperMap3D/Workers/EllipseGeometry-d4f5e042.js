define(["exports","./arrayFill-0358accf","./buildModuleUrl-9eef8841","./Cartesian2-b72655a5","./Cartesian3-3a8bdb0b","./Cartographic-a2c313d7","./Check-52a7d806","./ComponentDatatype-98414d16","./when-92c6cf3c","./EllipseGeometryLibrary-30d7e702","./GeometryAttribute-f47bd1cb","./GeometryAttributes-7f66ea53","./GeometryInstance-3190c1b4","./GeometryOffsetAttribute-b4d599f5","./GeometryPipeline-7ffd3f60","./IndexDatatype-86677ec4","./Math-ecf82623","./FeatureDetection-cec0163f","./VertexFormat-f496a3f1"],(function(t,e,o,r,n,i,a,s,u,m,l,c,p,y,d,f,h,A,x){"use strict";var g=new n.o,_=new n.o,v=new n.o,b=new n.o,w=new r.o,I=new A.p$1,T=new A.p$1,N=new l.n,M=new n.o,E=new n.o,P=new n.o,D=new i.a,F=new n.o,O=new r.o,S=new r.o;function C(t,i,a){var p=i.vertexFormat,d=i.center,f=i.semiMajorAxis,h=i.semiMinorAxis,x=i.ellipsoid,b=i.stRotation,C=a?t.length/3*2:t.length/3,L=i.shadowVolume,R=p.st?new Float32Array(2*C):void 0,j=p.normal?new Float32Array(3*C):void 0,z=p.tangent?new Float32Array(3*C):void 0,G=p.bitangent?new Float32Array(3*C):void 0,V=L?new Float32Array(3*C):void 0,k=0,Y=M,B=E,H=P,$=new o.n(x),U=$.project(x.cartesianToCartographic(d,D),F),W=x.scaleToGeodeticSurface(d,g);x.geodeticSurfaceNormal(W,W);var q=I,Q=T;if(0!==b){var J=l.n.fromAxisAngle(W,b,N);q=A.p$1.fromQuaternion(J,q),J=l.n.fromAxisAngle(W,-b,N),Q=A.p$1.fromQuaternion(J,Q)}else q=A.p$1.clone(A.p$1.IDENTITY,q),Q=A.p$1.clone(A.p$1.IDENTITY,Q);for(var Z=r.o.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,O),K=r.o.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,S),X=t.length,tt=a?X:0,et=tt/3*2,ot=0;ot<X;ot+=3){var rt=ot+1,nt=ot+2,it=n.o.fromArray(t,ot,g);if(p.st){var at=A.p$1.multiplyByVector(q,it,_),st=$.project(x.cartesianToCartographic(at,D),v);n.o.subtract(st,U,st),w.x=(st.x+f)/(2*f),w.y=(st.y+h)/(2*h),Z.x=Math.min(w.x,Z.x),Z.y=Math.min(w.y,Z.y),K.x=Math.max(w.x,K.x),K.y=Math.max(w.y,K.y),a&&(R[k+et]=w.x,R[k+1+et]=w.y),R[k++]=w.x,R[k++]=w.y}(p.normal||p.tangent||p.bitangent||L)&&(Y=x.geodeticSurfaceNormal(it,Y),L&&(V[ot+tt]=-Y.x,V[rt+tt]=-Y.y,V[nt+tt]=-Y.z),(p.normal||p.tangent||p.bitangent)&&((p.tangent||p.bitangent)&&(B=n.o.normalize(n.o.cross(n.o.UNIT_Z,Y,B),B),A.p$1.multiplyByVector(Q,B,B)),p.normal&&(j[ot]=Y.x,j[rt]=Y.y,j[nt]=Y.z,a&&(j[ot+tt]=-Y.x,j[rt+tt]=-Y.y,j[nt+tt]=-Y.z)),p.tangent&&(z[ot]=B.x,z[rt]=B.y,z[nt]=B.z,a&&(z[ot+tt]=-B.x,z[rt+tt]=-B.y,z[nt+tt]=-B.z)),p.bitangent&&(H=n.o.normalize(n.o.cross(Y,B,H),H),G[ot]=H.x,G[rt]=H.y,G[nt]=H.z,a&&(G[ot+tt]=H.x,G[rt+tt]=H.y,G[nt+tt]=H.z))))}if(p.st){X=R.length;for(var ut=0;ut<X;ut+=2)R[ut]=(R[ut]-Z.x)/(K.x-Z.x),R[ut+1]=(R[ut+1]-Z.y)/(K.y-Z.y)}var mt=new c.a;if(p.position){var lt=m.C.raisePositionsToHeight(t,i,a);mt.position=new l.o({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:lt})}if(p.st&&(mt.st=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:R})),p.normal&&(mt.normal=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j})),p.tangent&&(mt.tangent=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z})),p.bitangent&&(mt.bitangent=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),L&&(mt.extrudeDirection=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:V})),a&&u.e(i.offsetAttribute)){var ct=new Uint8Array(C);if(i.offsetAttribute===y.z.TOP)ct=e.d(ct,1,0,C/2);else{var pt=i.offsetAttribute===y.z.NONE?0:1;ct=e.d(ct,pt)}mt.applyOffset=new l.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:ct})}return mt}function L(t){var e,o,r,n,i,a=new Array(t*(t+1)*12-6),s=0;for(e=0,r=1,n=0;n<3;n++)a[s++]=r++,a[s++]=e,a[s++]=r;for(n=2;n<t+1;++n){for(r=n*(n+1)-1,e=(n-1)*n-1,a[s++]=r++,a[s++]=e,a[s++]=r,o=2*n,i=0;i<o-1;++i)a[s++]=r,a[s++]=e++,a[s++]=e,a[s++]=r++,a[s++]=e,a[s++]=r;a[s++]=r++,a[s++]=e,a[s++]=r}for(o=2*t,++r,++e,n=0;n<o-1;++n)a[s++]=r,a[s++]=e++,a[s++]=e,a[s++]=r++,a[s++]=e,a[s++]=r;for(a[s++]=r,a[s++]=e++,a[s++]=e,a[s++]=r++,a[s++]=e++,a[s++]=e,++e,n=t-1;n>1;--n){for(a[s++]=e++,a[s++]=e,a[s++]=r,o=2*n,i=0;i<o-1;++i)a[s++]=r,a[s++]=e++,a[s++]=e,a[s++]=r++,a[s++]=e,a[s++]=r;a[s++]=e++,a[s++]=e++,a[s++]=r++}for(n=0;n<3;n++)a[s++]=e++,a[s++]=e,a[s++]=r;return a}var R=new n.o;var j=new o.i,z=new o.i;function G(t){var i=t.center,a=t.ellipsoid,h=t.semiMajorAxis,x=n.o.multiplyByScalar(a.geodeticSurfaceNormal(i,g),t.height,g);j.center=n.o.add(i,x,j.center),j.radius=h,x=n.o.multiplyByScalar(a.geodeticSurfaceNormal(i,x),t.extrudedHeight,x),z.center=n.o.add(i,x,z.center),z.radius=h;var T=m.C.computeEllipsePositions(t,!0,!0),R=T.positions,G=T.numPts,V=T.outerPositions,k=o.i.union(j,z),Y=C(R,t,!0),B=L(G),H=B.length;B.length=2*H;for(var $=R.length/3,U=0;U<H;U+=3)B[U+H]=B[U+2]+$,B[U+1+H]=B[U+1]+$,B[U+2+H]=B[U]+$;var W=f.IndexDatatype.createTypedArray(2*$/3,B),q=new l.I({attributes:Y,indices:W,primitiveType:A._0x4b6a27.TRIANGLES}),Q=function(t,i){var a=i.vertexFormat,m=i.center,p=i.semiMajorAxis,d=i.semiMinorAxis,f=i.ellipsoid,h=i.height,x=i.extrudedHeight,T=i.stRotation,C=t.length/3*2,L=new Float64Array(3*C),R=a.st?new Float32Array(2*C):void 0,j=a.normal?new Float32Array(3*C):void 0,z=a.tangent?new Float32Array(3*C):void 0,G=a.bitangent?new Float32Array(3*C):void 0,V=i.shadowVolume,k=V?new Float32Array(3*C):void 0,Y=0,B=M,H=E,$=P,U=new o.n(f),W=U.project(f.cartesianToCartographic(m,D),F),q=f.scaleToGeodeticSurface(m,g);f.geodeticSurfaceNormal(q,q);for(var Q=l.n.fromAxisAngle(q,T,N),J=A.p$1.fromQuaternion(Q,I),Z=r.o.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,O),K=r.o.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,S),X=t.length,tt=X/3*2,et=0;et<X;et+=3){var ot,rt=et+1,nt=et+2,it=n.o.fromArray(t,et,g);if(a.st){var at=A.p$1.multiplyByVector(J,it,_),st=U.project(f.cartesianToCartographic(at,D),v);n.o.subtract(st,W,st),w.x=(st.x+p)/(2*p),w.y=(st.y+d)/(2*d),Z.x=Math.min(w.x,Z.x),Z.y=Math.min(w.y,Z.y),K.x=Math.max(w.x,K.x),K.y=Math.max(w.y,K.y),R[Y+tt]=w.x,R[Y+1+tt]=w.y,R[Y++]=w.x,R[Y++]=w.y}it=f.scaleToGeodeticSurface(it,it),ot=n.o.clone(it,_),B=f.geodeticSurfaceNormal(it,B),V&&(k[et+X]=-B.x,k[rt+X]=-B.y,k[nt+X]=-B.z);var ut=n.o.multiplyByScalar(B,h,b);if(it=n.o.add(it,ut,it),ut=n.o.multiplyByScalar(B,x,ut),ot=n.o.add(ot,ut,ot),a.position&&(L[et+X]=ot.x,L[rt+X]=ot.y,L[nt+X]=ot.z,L[et]=it.x,L[rt]=it.y,L[nt]=it.z),a.normal||a.tangent||a.bitangent){$=n.o.clone(B,$);var mt=n.o.fromArray(t,(et+3)%X,b);n.o.subtract(mt,it,mt);var lt=n.o.subtract(ot,it,v);B=n.o.normalize(n.o.cross(lt,mt,B),B),a.normal&&(j[et]=B.x,j[rt]=B.y,j[nt]=B.z,j[et+X]=B.x,j[rt+X]=B.y,j[nt+X]=B.z),a.tangent&&(H=n.o.normalize(n.o.cross($,B,H),H),z[et]=H.x,z[rt]=H.y,z[nt]=H.z,z[et+X]=H.x,z[et+1+X]=H.y,z[et+2+X]=H.z),a.bitangent&&(G[et]=$.x,G[rt]=$.y,G[nt]=$.z,G[et+X]=$.x,G[rt+X]=$.y,G[nt+X]=$.z)}}if(a.st){X=R.length;for(var ct=0;ct<X;ct+=2)R[ct]=(R[ct]-Z.x)/(K.x-Z.x),R[ct+1]=(R[ct+1]-Z.y)/(K.y-Z.y)}var pt=new c.a;if(a.position&&(pt.position=new l.o({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:L})),a.st&&(pt.st=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:R})),a.normal&&(pt.normal=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j})),a.tangent&&(pt.tangent=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z})),a.bitangent&&(pt.bitangent=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),V&&(pt.extrudeDirection=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:k})),u.e(i.offsetAttribute)){var yt=new Uint8Array(C);if(i.offsetAttribute===y.z.TOP)yt=e.d(yt,1,0,C/2);else{var dt=i.offsetAttribute===y.z.NONE?0:1;yt=e.d(yt,dt)}pt.applyOffset=new l.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:yt})}return pt}(V,t);B=function(t){for(var e=t.length/3,o=f.IndexDatatype.createTypedArray(e,6*e),r=0,n=0;n<e;n++){var i=n,a=n+e,s=(i+1)%e,u=s+e;o[r++]=i,o[r++]=a,o[r++]=s,o[r++]=s,o[r++]=a,o[r++]=u}return o}(V);var J=f.IndexDatatype.createTypedArray(2*V.length/3,B),Z=new l.I({attributes:Q,indices:J,primitiveType:A._0x4b6a27.TRIANGLES}),K=d.k.combineInstances([new p.d({geometry:q}),new p.d({geometry:Z})]);return{boundingSphere:k,attributes:K[0].attributes,indices:K[0].indices}}function V(t,e,o,i,a,s,u){for(var l=m.C.computeEllipsePositions({center:t,semiMajorAxis:e,semiMinorAxis:o,rotation:i,granularity:a},!1,!0).outerPositions,c=l.length/3,p=new Array(c),y=0;y<c;++y)p[y]=n.o.fromArray(l,3*y);var d=r.h.fromCartesianArray(p,s,u);return d.width>h.e.PI&&(d.north=d.north>0?h.e.PI_OVER_TWO-h.e.EPSILON7:d.north,d.south=d.south<0?h.e.EPSILON7-h.e.PI_OVER_TWO:d.south,d.east=h.e.PI,d.west=-h.e.PI),d}function k(t){var e=(t=u.u(t,u.u.EMPTY_OBJECT)).center,o=u.u(t.ellipsoid,r.t.WGS84),i=t.semiMajorAxis,s=t.semiMinorAxis,m=u.u(t.granularity,h.e.RADIANS_PER_DEGREE),l=u.u(t.vertexFormat,x.n.DEFAULT);if(a.o.defined("options.center",e),a.o.typeOf.number("options.semiMajorAxis",i),a.o.typeOf.number("options.semiMinorAxis",s),i<s)throw new a.t("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(m<=0)throw new a.t("granularity must be greater than zero.");var c=u.u(t.height,0),p=u.u(t.extrudedHeight,c);this._center=n.o.clone(e),this._semiMajorAxis=i,this._semiMinorAxis=s,this._ellipsoid=r.t.clone(o),this._rotation=u.u(t.rotation,0),this._stRotation=u.u(t.stRotation,0),this._height=Math.max(p,c),this._granularity=m,this._vertexFormat=x.n.clone(l),this._extrudedHeight=Math.min(p,c),this._shadowVolume=u.u(t.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=t.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}k.packedLength=n.o.packedLength+r.t.packedLength+x.n.packedLength+9,k.pack=function(t,e,o){return a.o.defined("value",t),a.o.defined("array",e),o=u.u(o,0),n.o.pack(t._center,e,o),o+=n.o.packedLength,r.t.pack(t._ellipsoid,e,o),o+=r.t.packedLength,x.n.pack(t._vertexFormat,e,o),o+=x.n.packedLength,e[o++]=t._semiMajorAxis,e[o++]=t._semiMinorAxis,e[o++]=t._rotation,e[o++]=t._stRotation,e[o++]=t._height,e[o++]=t._granularity,e[o++]=t._extrudedHeight,e[o++]=t._shadowVolume?1:0,e[o]=u.u(t._offsetAttribute,-1),e};var Y=new n.o,B=new r.t,H=new x.n,$={center:Y,ellipsoid:B,vertexFormat:H,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};k.unpack=function(t,e,o){a.o.defined("array",t),e=u.u(e,0);var i=n.o.unpack(t,e,Y);e+=n.o.packedLength;var s=r.t.unpack(t,e,B);e+=r.t.packedLength;var m=x.n.unpack(t,e,H);e+=x.n.packedLength;var l=t[e++],c=t[e++],p=t[e++],y=t[e++],d=t[e++],f=t[e++],h=t[e++],A=1===t[e++],g=t[e];return u.e(o)?(o._center=n.o.clone(i,o._center),o._ellipsoid=r.t.clone(s,o._ellipsoid),o._vertexFormat=x.n.clone(m,o._vertexFormat),o._semiMajorAxis=l,o._semiMinorAxis=c,o._rotation=p,o._stRotation=y,o._height=d,o._granularity=f,o._extrudedHeight=h,o._shadowVolume=A,o._offsetAttribute=-1===g?void 0:g,o):($.height=d,$.extrudedHeight=h,$.granularity=f,$.stRotation=y,$.rotation=p,$.semiMajorAxis=l,$.semiMinorAxis=c,$.shadowVolume=A,$.offsetAttribute=-1===g?void 0:g,new k($))},k.computeRectangle=function(t,e){var o=(t=u.u(t,u.u.EMPTY_OBJECT)).center,n=u.u(t.ellipsoid,r.t.WGS84),i=t.semiMajorAxis,s=t.semiMinorAxis,m=u.u(t.granularity,h.e.RADIANS_PER_DEGREE),l=u.u(t.rotation,0);if(a.o.defined("options.center",o),a.o.typeOf.number("options.semiMajorAxis",i),a.o.typeOf.number("options.semiMinorAxis",s),i<s)throw new a.t("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(m<=0)throw new a.t("granularity must be greater than zero.");return V(o,i,s,l,m,n,e)},k.createGeometry=function(t){if(!(t._semiMajorAxis<=0||t._semiMinorAxis<=0)){var r=t._height,i=t._extrudedHeight,a=!h.e.equalsEpsilon(r,i,0,h.e.EPSILON2);t._center=t._ellipsoid.scaleToGeodeticSurface(t._center,t._center);var c,p={center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:t._ellipsoid,rotation:t._rotation,height:r,granularity:t._granularity,vertexFormat:t._vertexFormat,stRotation:t._stRotation};if(a)p.extrudedHeight=i,p.shadowVolume=t._shadowVolume,p.offsetAttribute=t._offsetAttribute,c=G(p);else if(c=function(t){var e=t.center;R=n.o.multiplyByScalar(t.ellipsoid.geodeticSurfaceNormal(e,R),t.height,R),R=n.o.add(e,R,R);var r=new o.i(R,t.semiMajorAxis),i=m.C.computeEllipsePositions(t,!0,!1),a=i.positions,s=i.numPts,u=C(a,t,!1),l=L(s);return{boundingSphere:r,attributes:u,indices:l=f.IndexDatatype.createTypedArray(a.length/3,l)}}(p),u.e(t._offsetAttribute)){var d=c.attributes.position.values.length,x=new Uint8Array(d/3),g=t._offsetAttribute===y.z.NONE?0:1;e.d(x,g),c.attributes.applyOffset=new l.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:x})}return new l.I({attributes:c.attributes,indices:c.indices,primitiveType:A._0x4b6a27.TRIANGLES,boundingSphere:c.boundingSphere,offsetAttribute:t._offsetAttribute})}},k.createShadowVolume=function(t,e,o){var r=t._granularity,n=t._ellipsoid,i=e(r,n),a=o(r,n);return new k({center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:n,rotation:t._rotation,stRotation:t._stRotation,granularity:r,extrudedHeight:i,height:a,vertexFormat:x.n.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(k.prototype,{rectangle:{get:function(){return u.e(this._rectangle)||(this._rectangle=V(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return u.e(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){var e=-t._stRotation;if(0===e)return[0,0,0,1,1,0];for(var o=m.C.computeEllipsePositions({center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,rotation:t._rotation,granularity:t._granularity},!1,!0).outerPositions,r=o.length/3,i=new Array(r),a=0;a<r;++a)i[a]=n.o.fromArray(o,3*a);var s=t._ellipsoid,u=t.rectangle;return l.I._textureCoordinateRotationPoints(i,e,s,u)}(this)),this._textureCoordinateRotationPoints}}}),t.Y=k}));
