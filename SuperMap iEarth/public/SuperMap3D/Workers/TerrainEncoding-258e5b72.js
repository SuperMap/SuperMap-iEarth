define(["exports","./buildModuleUrl-36ce0ebc","./Cartesian3-c1138337","./Check-92c551fb","./defaultValue-2110bb17","./Ellipsoid-ca2b8eb1","./Rectangle-52f780a9","./AttributeCompression-79e23de9","./ComponentDatatype-3cfb1146","./Math-cd1437d9","./PrimitiveType-d9ba7368"],(function(e,t,o,i,r,n,a,s,c,m,u){"use strict";function d(e,t){i.o.typeOf.object("ellipsoid",e),this._ellipsoid=e,this._cameraPosition=new o.o,this._cameraPositionInScaledSpace=new o.o,this._distanceToLimbInScaledSpaceSquared=0,r.e(t)&&(this.cameraPosition=t)}Object.defineProperties(d.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},cameraPosition:{get:function(){return this._cameraPosition},set:function(e){var t=this._ellipsoid.transformPositionToScaledSpace(e,this._cameraPositionInScaledSpace),i=o.o.magnitudeSquared(t)-1;o.o.clone(e,this._cameraPosition),this._cameraPositionInScaledSpace=t,this._distanceToLimbInScaledSpaceSquared=i}}});var l=new o.o;d.prototype.isPointVisible=function(e){return T(this._ellipsoid.transformPositionToScaledSpace(e,l),this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)},d.prototype.isScaledSpacePointVisible=function(e){return T(e,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};var p=new o.o;d.prototype.isScaledSpacePointVisiblePossiblyUnderEllipsoid=function(e,t){var o,i,n=this._ellipsoid;return r.e(t)&&t<0&&n.minimumRadius>-t?((i=p).x=this._cameraPosition.x/(n.radii.x+t),i.y=this._cameraPosition.y/(n.radii.y+t),i.z=this._cameraPosition.z/(n.radii.z+t),o=i.x*i.x+i.y*i.y+i.z*i.z-1):(i=this._cameraPositionInScaledSpace,o=this._distanceToLimbInScaledSpaceSquared),T(e,i,o)},d.prototype.computeHorizonCullingPoint=function(e,t,o){return x(this._ellipsoid,e,t,o)};var h=n.t.clone(n.t.UNIT_SPHERE);d.prototype.computeHorizonCullingPointPossiblyUnderEllipsoid=function(e,t,o,i){return x(S(this._ellipsoid,o,h),e,t,i)},d.prototype.computeHorizonCullingPointFromVertices=function(e,t,o,i,r){return v(this._ellipsoid,e,t,o,i,r)},d.prototype.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid=function(e,t,o,i,r,n){return v(S(this._ellipsoid,r,h),e,t,o,i,n)};var f=[];d.prototype.computeHorizonCullingPointFromRectangle=function(e,r,n){i.o.typeOf.object("rectangle",e);var s=a.h.subsample(e,r,0,f),c=t.i.fromPoints(s);if(!(o.o.magnitude(c.center)<.1*r.minimumRadius))return this.computeHorizonCullingPoint(c.center,s,n)};var y=new o.o;function S(e,t,i){if(r.e(t)&&t<0&&e.minimumRadius>-t){var a=o.o.fromElements(e.radii.x+t,e.radii.y+t,e.radii.z+t,y);e=n.t.fromCartesian3(a,i)}return e}function x(e,t,n,a){i.o.typeOf.object("directionToPoint",t),i.o.defined("positions",n),r.e(a)||(a=new o.o);for(var s=I(e,t),c=0,m=0,u=n.length;m<u;++m){var d=z(e,n[m],s);if(d<0)return;c=Math.max(c,d)}return E(s,c,a)}var b=new o.o;function v(e,t,n,a,s,c){i.o.typeOf.object("directionToPoint",t),i.o.defined("vertices",n),i.o.typeOf.number("stride",a),r.e(c)||(c=new o.o),a=r.u(a,3),s=r.u(s,o.o.ZERO);for(var m=I(e,t),u=0,d=0,l=n.length;d<l;d+=a){b.x=n[d]+s.x,b.y=n[d+1]+s.y,b.z=n[d+2]+s.z;var p=z(e,b,m);if(p<0)return;u=Math.max(u,p)}return E(m,u,c)}function T(e,t,i){var r=t,n=i,a=o.o.subtract(e,r,l),s=-o.o.dot(a,r);return!(n<0?s>0:s>n&&s*s/o.o.magnitudeSquared(a)>n)}var g=new o.o,P=new o.o;function z(e,t,i){var r=e.transformPositionToScaledSpace(t,g),n=o.o.magnitudeSquared(r),a=Math.sqrt(n),s=o.o.divideByScalar(r,a,P);n=Math.max(1,n);var c=1/(a=Math.max(1,a));return 1/(o.o.dot(s,i)*c-o.o.magnitude(o.o.cross(s,i,s))*(Math.sqrt(n-1)*c))}function E(e,t,i){if(!(t<=0||t===1/0||t!=t))return o.o.multiplyByScalar(e,t,i)}var N=new o.o;function I(e,t){return o.o.equals(t,o.o.ZERO)?t:(e.transformPositionToScaledSpace(t,N),o.o.normalize(N,N))}var C=Object.freeze({NONE:0,BITS12:1}),_=new o.o,B=new o.o,H=new n.o,q=new u.y,w=new u.y,M=Math.pow(2,12);function O(e,t,i,n,a,s){var c,m,d,l=C.NONE;if(r.e(e)&&r.e(t)&&r.e(i)&&r.e(n)){var p=e.minimum,h=e.maximum,f=o.o.subtract(h,p,B),y=i-t;l=Math.max(o.o.maximumComponent(f),y)<M-1?C.BITS12:C.NONE,l=C.NONE,c=e.center,m=u.y.inverseTransformation(n,new u.y);var S=o.o.negate(p,_);u.y.multiply(u.y.fromTranslation(S,q),m,m);var x=_;x.x=1/f.x,x.y=1/f.y,x.z=1/f.z,u.y.multiply(u.y.fromScale(x,q),m,m),d=u.y.clone(n),u.y.setTranslation(d,o.o.ZERO,d),n=u.y.clone(n,new u.y);var b=u.y.fromTranslation(p,q),v=u.y.fromScale(f,w),T=u.y.multiply(b,v,q);u.y.multiply(n,T,n),u.y.multiply(d,T,d)}this.quantization=l,this.minimumHeight=t,this.maximumHeight=i,this.center=c,this.toScaledENU=m,this.fromScaledENU=n,this.matrix=d,this.hasVertexNormals=a,this.hasWebMercatorT=r.u(s,!1)}O.prototype.encode=function(e,t,i,r,a,c,d){var l=r.x,p=r.y;if(this.quantization===C.BITS12){(i=u.y.multiplyByPoint(this.toScaledENU,i,_)).x=m.e.clamp(i.x,0,1),i.y=m.e.clamp(i.y,0,1),i.z=m.e.clamp(i.z,0,1);var h=this.maximumHeight-this.minimumHeight,f=m.e.clamp((a-this.minimumHeight)/h,0,1);n.o.fromElements(i.x,i.y,H);var y=s.t.compressTextureCoordinates(H);n.o.fromElements(i.z,f,H);var S=s.t.compressTextureCoordinates(H);n.o.fromElements(l,p,H);var x=s.t.compressTextureCoordinates(H);if(e[t++]=y,e[t++]=S,e[t++]=x,this.hasWebMercatorT){n.o.fromElements(d,0,H);var b=s.t.compressTextureCoordinates(H);e[t++]=b}}else o.o.subtract(i,this.center,_),e[t++]=_.x,e[t++]=_.y,e[t++]=_.z,e[t++]=a,e[t++]=l,e[t++]=p,this.hasWebMercatorT&&(e[t++]=d);return this.hasVertexNormals&&(e[t++]=s.t.octPackFloat(c)),t},O.prototype.decodePosition=function(e,t,i){if(r.e(i)||(i=new o.o),t*=this.getStride(),this.quantization===C.BITS12){var n=s.t.decompressTextureCoordinates(e[t],H);i.x=n.x,i.y=n.y;var a=s.t.decompressTextureCoordinates(e[t+1],H);return i.z=a.x,u.y.multiplyByPoint(this.fromScaledENU,i,i)}return i.x=e[t],i.y=e[t+1],i.z=e[t+2],o.o.add(i,this.center,i)},O.prototype.decodeTextureCoordinates=function(e,t,o){return r.e(o)||(o=new n.o),t*=this.getStride(),this.quantization===C.BITS12?s.t.decompressTextureCoordinates(e[t+2],o):n.o.fromElements(e[t+4],e[t+5],o)},O.prototype.decodeHeight=function(e,t){return t*=this.getStride(),this.quantization===C.BITS12?s.t.decompressTextureCoordinates(e[t+1],H).y*(this.maximumHeight-this.minimumHeight)+this.minimumHeight:e[t+3]},O.prototype.decodeWebMercatorT=function(e,t){return t*=this.getStride(),this.quantization===C.BITS12?s.t.decompressTextureCoordinates(e[t+3],H).x:e[t+6]},O.prototype.getOctEncodedNormal=function(e,t,o){var i=e[t=(t+1)*this.getStride()-1]/256,r=Math.floor(i),a=256*(i-r);return n.o.fromElements(r,a,o)},O.prototype.getStride=function(){var e;if(this.quantization===C.BITS12)e=3;else e=6;return this.hasWebMercatorT&&++e,this.hasVertexNormals&&++e,e};var A={position3DAndHeight:0,textureCoordAndEncodedNormals:1},V={compressed0:0,compressed1:1};O.prototype.getAttributes=function(e){var t,o=c.ComponentDatatype.FLOAT,i=c.ComponentDatatype.getSizeInBytes(o);if(this.quantization===C.NONE){var r=2;this.hasWebMercatorT&&++r,this.hasVertexNormals&&++r;var n=[{index:A.position3DAndHeight,name:"position3DAndHeight",vertexBuffer:e,componentDatatype:o,componentsPerAttribute:4,offsetInBytes:0,strideInBytes:t=(4+r)*i},{index:A.textureCoordAndEncodedNormals,name:"textureCoordAndEncodedNormals",vertexBuffer:e,componentDatatype:o,componentsPerAttribute:r,offsetInBytes:4*i,strideInBytes:t}];return n}var a=3,s=0;return(this.hasWebMercatorT||this.hasVertexNormals)&&++a,this.hasWebMercatorT&&this.hasVertexNormals?(t=(a+ ++s)*i,[{index:n.compressed0,name:"compressed0",vertexBuffer:e,componentDatatype:o,componentsPerAttribute:a,offsetInBytes:0,strideInBytes:t},{index:n.compressed1,name:"compressed1",vertexBuffer:e,componentDatatype:o,componentsPerAttribute:s,offsetInBytes:a*i,strideInBytes:t}]):[{index:n.compressed0,name:"compressed0",vertexBuffer:e,componentDatatype:o,componentsPerAttribute:a}]},O.prototype.getAttributeLocations=function(){return this.quantization===C.NONE?A:V},O.clone=function(e,t){return r.e(t)||(t=new O),t.quantization=e.quantization,t.minimumHeight=e.minimumHeight,t.maximumHeight=e.maximumHeight,t.center=o.o.clone(e.center),t.toScaledENU=u.y.clone(e.toScaledENU),t.fromScaledENU=u.y.clone(e.fromScaledENU),t.matrix=u.y.clone(e.matrix),t.hasVertexNormals=e.hasVertexNormals,t.hasWebMercatorT=e.hasWebMercatorT,t},e.h=O,e.s=d}));
