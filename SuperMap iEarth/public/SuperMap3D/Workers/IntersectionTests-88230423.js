define(["exports","./Cartesian3-c1138337","./Cartographic-630e5de6","./defaultValue-2110bb17","./Check-92c551fb","./buildModuleUrl-36ce0ebc","./Math-cd1437d9","./FeatureDetection-e7fb956a","./PrimitiveType-d9ba7368"],(function(e,r,t,n,i,o,a,u,s){"use strict";var f={};function c(e,r,t){var n=e+r;return a.e.sign(e)!==a.e.sign(r)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(r)))<t?0:n}f.computeDiscriminant=function(e,r,t){if("number"!=typeof e)throw new i.t("a is a required number.");if("number"!=typeof r)throw new i.t("b is a required number.");if("number"!=typeof t)throw new i.t("c is a required number.");return r*r-4*e*t},f.computeRealRoots=function(e,r,t){if("number"!=typeof e)throw new i.t("a is a required number.");if("number"!=typeof r)throw new i.t("b is a required number.");if("number"!=typeof t)throw new i.t("c is a required number.");var n;if(0===e)return 0===r?[]:[-t/r];if(0===r){if(0===t)return[0,0];var o=Math.abs(t),u=Math.abs(e);if(o<u&&o/u<a.e.EPSILON14)return[0,0];if(o>u&&u/o<a.e.EPSILON14)return[];if((n=-t/e)<0)return[];var s=Math.sqrt(n);return[-s,s]}if(0===t)return(n=-r/e)<0?[n,0]:[0,n];var f=c(r*r,-(4*e*t),a.e.EPSILON14);if(f<0)return[];var l=-.5*c(r,a.e.sign(r)*Math.sqrt(f),a.e.EPSILON14);return r>0?[l/e,t/l]:[t/l,l/e]};var l={};function w(e,r,t,n){var i,o,a=e,u=r/3,s=t/3,f=n,c=a*s,l=u*f,w=u*u,p=s*s,h=a*s-w,d=a*f-u*s,m=u*f-p,b=4*h*m-d*d;if(b<0){var g,v,y;w*l>=c*p?(g=a,v=h,y=-2*u*h+a*d):(g=f,v=m,y=-f*d+2*s*m);var q=-(y<0?-1:1)*Math.abs(g)*Math.sqrt(-b),M=(o=-y+q)/2,O=M<0?-Math.pow(-M,1/3):Math.pow(M,1/3),R=o===q?-O:-v/O;return i=v<=0?O+R:-y/(O*O+R*R+v),w*l>=c*p?[(i-u)/a]:[-f/(i+s)]}var S=h,P=-2*u*h+a*d,N=m,L=-f*d+2*s*m,E=Math.sqrt(b),I=Math.sqrt(3)/2,C=Math.abs(Math.atan2(a*E,-P)/3);i=2*Math.sqrt(-S);var x=Math.cos(C);o=i*x;var z=i*(-x/2-I*Math.sin(C)),T=o+z>2*u?o-u:z-u,U=a,B=T/U;C=Math.abs(Math.atan2(f*E,-L)/3);var W=-f,V=(o=(i=2*Math.sqrt(-N))*(x=Math.cos(C)))+(z=i*(-x/2-I*Math.sin(C)))<2*s?o+s:z+s,Z=W/V,j=-T*V-U*W,A=(s*j-u*(T*W))/(-u*j+s*(U*V));return B<=A?B<=Z?A<=Z?[B,A,Z]:[B,Z,A]:[Z,B,A]:B<=Z?[A,B,Z]:A<=Z?[A,Z,B]:[Z,A,B]}l.computeDiscriminant=function(e,r,t,n){if("number"!=typeof e)throw new i.t("a is a required number.");if("number"!=typeof r)throw new i.t("b is a required number.");if("number"!=typeof t)throw new i.t("c is a required number.");if("number"!=typeof n)throw new i.t("d is a required number.");var o=r*r,a=t*t;return 18*e*r*t*n+o*a-27*(e*e)*(n*n)-4*(e*a*t+o*r*n)},l.computeRealRoots=function(e,r,t,n){if("number"!=typeof e)throw new i.t("a is a required number.");if("number"!=typeof r)throw new i.t("b is a required number.");if("number"!=typeof t)throw new i.t("c is a required number.");if("number"!=typeof n)throw new i.t("d is a required number.");var o,a;if(0===e)return f.computeRealRoots(r,t,n);if(0===r){if(0===t){if(0===n)return[0,0,0];var u=(a=-n/e)<0?-Math.pow(-a,1/3):Math.pow(a,1/3);return[u,u,u]}return 0===n?0===(o=f.computeRealRoots(e,0,t)).Length?[0]:[o[0],0,o[1]]:w(e,0,t,n)}return 0===t?0===n?(a=-r/e)<0?[a,0,0]:[0,0,a]:w(e,r,0,n):0===n?0===(o=f.computeRealRoots(e,r,t)).length?[0]:o[1]<=0?[o[0],o[1],0]:o[0]>=0?[0,o[0],o[1]]:[o[0],0,o[1]]:w(e,r,t,n)};var p={};function h(e,r,t,n){var i=e*e,o=r-3*i/8,u=t-r*e/2+i*e/8,s=n-t*e/4+r*i/16-3*i*i/256,c=l.computeRealRoots(1,2*o,o*o-4*s,-u*u);if(c.length>0){var w=-e/4,p=c[c.length-1];if(Math.abs(p)<a.e.EPSILON14){var h=f.computeRealRoots(1,o,s);if(2===h.length){var d,m=h[0],b=h[1];if(m>=0&&b>=0){var g=Math.sqrt(m),v=Math.sqrt(b);return[w-v,w-g,w+g,w+v]}if(m>=0&&b<0)return[w-(d=Math.sqrt(m)),w+d];if(m<0&&b>=0)return[w-(d=Math.sqrt(b)),w+d]}return[]}if(p>0){var y=Math.sqrt(p),q=(o+p-u/y)/2,M=(o+p+u/y)/2,O=f.computeRealRoots(1,y,q),R=f.computeRealRoots(1,-y,M);return 0!==O.length?(O[0]+=w,O[1]+=w,0!==R.length?(R[0]+=w,R[1]+=w,O[1]<=R[0]?[O[0],O[1],R[0],R[1]]:R[1]<=O[0]?[R[0],R[1],O[0],O[1]]:O[0]>=R[0]&&O[1]<=R[1]?[R[0],O[0],O[1],R[1]]:R[0]>=O[0]&&R[1]<=O[1]?[O[0],R[0],R[1],O[1]]:O[0]>R[0]&&O[0]<R[1]?[R[0],O[0],R[1],O[1]]:[O[0],R[0],O[1],R[1]]):O):0!==R.length?(R[0]+=w,R[1]+=w,R):[]}}return[]}function d(e,r,t,n){var i=e*e,o=-2*r,u=t*e+r*r-4*n,s=i*n-t*r*e+t*t,c=l.computeRealRoots(1,o,u,s);if(c.length>0){var w,p,h,d,m,b,g=c[0],v=r-g,y=v*v,q=e/2,M=v/2,O=y-4*n,R=y+4*Math.abs(n),S=i-4*g,P=i+4*Math.abs(g);if(g<0||O*P<S*R){var N=Math.sqrt(S);w=N/2,p=0===N?0:(e*M-t)/N}else{var L=Math.sqrt(O);w=0===L?0:(e*M-t)/L,p=L/2}0===q&&0===w?(h=0,d=0):a.e.sign(q)===a.e.sign(w)?d=g/(h=q+w):h=g/(d=q-w),0===M&&0===p?(m=0,b=0):a.e.sign(M)===a.e.sign(p)?b=n/(m=M+p):m=n/(b=M-p);var E=f.computeRealRoots(1,h,m),I=f.computeRealRoots(1,d,b);if(0!==E.length)return 0!==I.length?E[1]<=I[0]?[E[0],E[1],I[0],I[1]]:I[1]<=E[0]?[I[0],I[1],E[0],E[1]]:E[0]>=I[0]&&E[1]<=I[1]?[I[0],E[0],E[1],I[1]]:I[0]>=E[0]&&I[1]<=E[1]?[E[0],I[0],I[1],E[1]]:E[0]>I[0]&&E[0]<I[1]?[I[0],E[0],I[1],E[1]]:[E[0],I[0],E[1],I[1]]:E;if(0!==I.length)return I}return[]}function m(e,t){t=r.o.clone(n.u(t,r.o.ZERO)),r.o.equals(t,r.o.ZERO)||r.o.normalize(t,t),this.origin=r.o.clone(n.u(e,r.o.ZERO)),this.direction=t}p.computeDiscriminant=function(e,r,t,n,o){if("number"!=typeof e)throw new i.t("a is a required number.");if("number"!=typeof r)throw new i.t("b is a required number.");if("number"!=typeof t)throw new i.t("c is a required number.");if("number"!=typeof n)throw new i.t("d is a required number.");if("number"!=typeof o)throw new i.t("e is a required number.");var a=e*e,u=r*r,s=u*r,f=t*t,c=f*t,l=n*n,w=l*n,p=o*o;return u*f*l-4*s*w-4*e*c*l+18*e*r*t*w-27*a*l*l+256*(a*e)*(p*o)+o*(18*s*t*n-4*u*c+16*e*f*f-80*e*r*f*n-6*e*u*l+144*a*t*l)+p*(144*e*u*t-27*u*u-128*a*f-192*a*r*n)},p.computeRealRoots=function(e,r,t,n,o){if("number"!=typeof e)throw new i.t("a is a required number.");if("number"!=typeof r)throw new i.t("b is a required number.");if("number"!=typeof t)throw new i.t("c is a required number.");if("number"!=typeof n)throw new i.t("d is a required number.");if("number"!=typeof o)throw new i.t("e is a required number.");if(Math.abs(e)<a.e.EPSILON15)return l.computeRealRoots(r,t,n,o);var u=r/e,s=t/e,f=n/e,c=o/e,w=u<0?1:0;switch(w+=s<0?w+1:w,w+=f<0?w+1:w,w+=c<0?w+1:w){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return h(u,s,f,c);case 1:case 2:case 5:case 8:case 11:return d(u,s,f,c);default:return}},m.clone=function(e,t){if(n.e(e))return n.e(t)?(t.origin=r.o.clone(e.origin),t.direction=r.o.clone(e.direction),t):new m(e.origin,e.direction)},m.getPoint=function(e,t,o){return i.o.typeOf.object("ray",e),i.o.typeOf.number("t",t),n.e(o)||(o=new r.o),o=r.o.multiplyByScalar(e.direction,t,o),r.o.add(e.origin,o,o)},m.transform=function(e,r,t){return i.o.typeOf.object("ray",e),i.o.typeOf.object("matrix",r),i.o.typeOf.object("result",t),s.y.multiplyByPoint(r,e.origin,t.origin),s.y.multiplyByPointAsVector(r,e.direction,t.direction),t};var b={rayPlane:function(e,t,o){if(!n.e(e))throw new i.t("ray is required.");if(!n.e(t))throw new i.t("plane is required.");n.e(o)||(o=new r.o);var u=e.origin,s=e.direction,f=t.normal,c=r.o.dot(f,s);if(!(Math.abs(c)<a.e.EPSILON15)){var l=(-t.distance-r.o.dot(f,u))/c;if(!(l<0))return o=r.o.multiplyByScalar(s,l,o),r.o.add(u,o,o)}}},g=new r.o,v=new r.o,y=new r.o,q=new r.o,M=new r.o;b.rayTriangleParametric=function(e,t,o,u,s){if(!n.e(e))throw new i.t("ray is required.");if(!n.e(t))throw new i.t("p0 is required.");if(!n.e(o))throw new i.t("p1 is required.");if(!n.e(u))throw new i.t("p2 is required.");s=n.u(s,!1);var f,c,l,w,p,h=e.origin,d=e.direction,m=r.o.subtract(o,t,g),b=r.o.subtract(u,t,v),O=r.o.cross(d,b,y),R=r.o.dot(m,O);if(s){if(R<a.e.EPSILON6||(f=r.o.subtract(h,t,q),(l=r.o.dot(f,O))<0||l>R)||(c=r.o.cross(f,m,M),(w=r.o.dot(d,c))<0||l+w>R))return;p=r.o.dot(b,c)/R}else{if(Math.abs(R)<a.e.EPSILON6)return;var S=1/R;if(f=r.o.subtract(h,t,q),(l=r.o.dot(f,O)*S)<0||l>1||(c=r.o.cross(f,m,M),(w=r.o.dot(d,c)*S)<0||l+w>1))return;p=r.o.dot(b,c)*S}return p},b.rayTriangle=function(e,t,i,o,a,u){var s=b.rayTriangleParametric(e,t,i,o,a);if(n.e(s)&&!(s<0))return n.e(u)||(u=new r.o),r.o.multiplyByScalar(e.direction,s,u),r.o.add(e.origin,u,u)};var O=new m;b.lineSegmentTriangle=function(e,t,o,a,u,s,f){if(!n.e(e))throw new i.t("v0 is required.");if(!n.e(t))throw new i.t("v1 is required.");if(!n.e(o))throw new i.t("p0 is required.");if(!n.e(a))throw new i.t("p1 is required.");if(!n.e(u))throw new i.t("p2 is required.");var c=O;r.o.clone(e,c.origin),r.o.subtract(t,e,c.direction),r.o.normalize(c.direction,c.direction);var l=b.rayTriangleParametric(c,o,a,u,s);if(!(!n.e(l)||l<0||l>r.o.distance(e,t)))return n.e(f)||(f=new r.o),r.o.multiplyByScalar(c.direction,l,f),r.o.add(c.origin,f,f)};var R={root0:0,root1:0};function S(e,t,i){n.e(i)||(i=new o.o);var a=e.origin,u=e.direction,s=t.center,f=t.radius*t.radius,c=r.o.subtract(a,s,y),l=function(e,r,t,n){var i=r*r-4*e*t;if(!(i<0)){if(i>0){var o=1/(2*e),a=Math.sqrt(i),u=(-r+a)*o,s=(-r-a)*o;return u<s?(n.root0=u,n.root1=s):(n.root0=s,n.root1=u),n}var f=-r/(2*e);if(0!==f)return n.root0=n.root1=f,n}}(r.o.dot(u,u),2*r.o.dot(u,c),r.o.magnitudeSquared(c)-f,R);if(n.e(l))return i.start=l.root0,i.stop=l.root1,i}b.raySphere=function(e,r,t){if(!n.e(e))throw new i.t("ray is required.");if(!n.e(r))throw new i.t("sphere is required.");if(t=S(e,r,t),n.e(t)&&!(t.stop<0))return t.start=Math.max(t.start,0),t};var P=new m;b.lineSegmentSphere=function(e,t,o,a){if(!n.e(e))throw new i.t("p0 is required.");if(!n.e(t))throw new i.t("p1 is required.");if(!n.e(o))throw new i.t("sphere is required.");var u=P;r.o.clone(e,u.origin);var s=r.o.subtract(t,e,u.direction),f=r.o.magnitude(s);if(r.o.normalize(s,s),a=S(u,o,a),!(!n.e(a)||a.stop<0||a.start>f))return a.start=Math.max(a.start,0),a.stop=Math.min(a.stop,f),a};var N=new r.o,L=new r.o;function E(e,r,t){var n=e+r;return a.e.sign(e)!==a.e.sign(r)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(r)))<t?0:n}function I(e,t,n,i,o){var s,c=i*i,l=o*o,w=(e[u.p.COLUMN1ROW1]-e[u.p.COLUMN2ROW2])*l,h=o*(i*E(e[u.p.COLUMN1ROW0],e[u.p.COLUMN0ROW1],a.e.EPSILON15)+t.y),d=e[u.p.COLUMN0ROW0]*c+e[u.p.COLUMN2ROW2]*l+i*t.x+n,m=l*E(e[u.p.COLUMN2ROW1],e[u.p.COLUMN1ROW2],a.e.EPSILON15),b=o*(i*E(e[u.p.COLUMN2ROW0],e[u.p.COLUMN0ROW2])+t.z),g=[];if(0===b&&0===m){if(0===(s=f.computeRealRoots(w,h,d)).length)return g;var v=s[0],y=Math.sqrt(Math.max(1-v*v,0));if(g.push(new r.o(i,o*v,o*-y)),g.push(new r.o(i,o*v,o*y)),2===s.length){var q=s[1],M=Math.sqrt(Math.max(1-q*q,0));g.push(new r.o(i,o*q,o*-M)),g.push(new r.o(i,o*q,o*M))}return g}var O=b*b,R=m*m,S=b*m,P=w*w+R,N=2*(h*w+S),L=2*d*w+h*h-R+O,I=2*(d*h-S),C=d*d-O;if(0===P&&0===N&&0===L&&0===I)return g;var x=(s=p.computeRealRoots(P,N,L,I,C)).length;if(0===x)return g;for(var z=0;z<x;++z){var T=s[z],U=T*T,B=Math.max(1-U,0),W=Math.sqrt(B),V=(a.e.sign(w)===a.e.sign(d)?E(w*U+d,h*T,a.e.EPSILON12):a.e.sign(d)===a.e.sign(h*T)?E(w*U,h*T+d,a.e.EPSILON12):E(w*U+h*T,d,a.e.EPSILON12))*E(m*T,b,a.e.EPSILON15);V<0?g.push(new r.o(i,o*T,o*W)):V>0?g.push(new r.o(i,o*T,o*-W)):0!==W?(g.push(new r.o(i,o*T,o*-W)),g.push(new r.o(i,o*T,o*W)),++z):g.push(new r.o(i,o*T,o*W))}return g}b.rayEllipsoid=function(e,t){if(!n.e(e))throw new i.t("ray is required.");if(!n.e(t))throw new i.t("ellipsoid is required.");var a,u,s,f,c,l=t.oneOverRadii,w=r.o.multiplyComponents(l,e.origin,N),p=r.o.multiplyComponents(l,e.direction,L),h=r.o.magnitudeSquared(w),d=r.o.dot(w,p);if(h>1){if(d>=0)return;var m=d*d;if(a=h-1,m<(s=(u=r.o.magnitudeSquared(p))*a))return;if(m>s){f=d*d-s;var b=(c=-d+Math.sqrt(f))/u,g=a/c;return b<g?new o.o(b,g):{start:g,stop:b}}var v=Math.sqrt(a/u);return new o.o(v,v)}return h<1?(a=h-1,f=d*d-(s=(u=r.o.magnitudeSquared(p))*a),c=-d+Math.sqrt(f),new o.o(0,c/u)):d<0?(u=r.o.magnitudeSquared(p),new o.o(0,-d/u)):void 0};var C=new r.o,x=new r.o,z=new r.o,T=new r.o,U=new r.o,B=new u.p,W=new u.p,V=new u.p,Z=new u.p,j=new u.p,A=new u.p,D=new u.p,F=new r.o,k=new r.o,G=new t.a;b.grazingAltitudeLocation=function(e,t){if(!n.e(e))throw new i.t("ray is required.");if(!n.e(t))throw new i.t("ellipsoid is required.");var o=e.origin,s=e.direction;if(!r.o.equals(o,r.o.ZERO)){var f=t.geodeticSurfaceNormal(o,C);if(r.o.dot(s,f)>=0)return o}var c=n.e(this.rayEllipsoid(e,t)),l=t.transformPositionToScaledSpace(s,C),w=r.o.normalize(l,l),p=r.o.mostOrthogonalAxis(l,T),h=r.o.normalize(r.o.cross(p,w,x),x),d=r.o.normalize(r.o.cross(w,h,z),z),m=B;m[0]=w.x,m[1]=w.y,m[2]=w.z,m[3]=h.x,m[4]=h.y,m[5]=h.z,m[6]=d.x,m[7]=d.y,m[8]=d.z;var b=u.p.transpose(m,W),g=u.p.fromScale(t.radii,V),v=u.p.fromScale(t.oneOverRadii,Z),y=j;y[0]=0,y[1]=-s.z,y[2]=s.y,y[3]=s.z,y[4]=0,y[5]=-s.x,y[6]=-s.y,y[7]=s.x,y[8]=0;var q,M,O=u.p.multiply(u.p.multiply(b,v,A),y,A),R=u.p.multiply(u.p.multiply(O,g,D),m,D),S=u.p.multiplyByVector(O,o,U),P=I(R,r.o.negate(S,C),0,0,1),N=P.length;if(N>0){for(var L=r.o.clone(r.o.ZERO,k),E=Number.NEGATIVE_INFINITY,Y=0;Y<N;++Y){q=u.p.multiplyByVector(g,u.p.multiplyByVector(m,P[Y],F),F);var _=r.o.normalize(r.o.subtract(q,o,T),T),H=r.o.dot(_,s);H>E&&(E=H,L=r.o.clone(q,L))}var J=t.cartesianToCartographic(L,G);return E=a.e.clamp(E,0,1),M=r.o.magnitude(r.o.subtract(L,o,T))*Math.sqrt(1-E*E),M=c?-M:M,J.height=M,t.cartographicToCartesian(J,new r.o)}};var Y=new r.o;b.lineSegmentPlane=function(e,t,o,u){if(!n.e(e))throw new i.t("endPoint0 is required.");if(!n.e(t))throw new i.t("endPoint1 is required.");if(!n.e(o))throw new i.t("plane is required.");n.e(u)||(u=new r.o);var s=r.o.subtract(t,e,Y),f=o.normal,c=r.o.dot(f,s);if(!(Math.abs(c)<a.e.EPSILON6)){var l=r.o.dot(f,e),w=-(o.distance+l)/c;if(!(w<0||w>1))return r.o.multiplyByScalar(s,w,u),r.o.add(e,u,u),u}},b.trianglePlaneIntersection=function(e,t,o,a){if(!(n.e(e)&&n.e(t)&&n.e(o)&&n.e(a)))throw new i.t("p0, p1, p2, and plane are required.");var u,s,f=a.normal,c=a.distance,l=r.o.dot(f,e)+c<0,w=r.o.dot(f,t)+c<0,p=r.o.dot(f,o)+c<0,h=0;if(h+=l?1:0,h+=w?1:0,(1===(h+=p?1:0)||2===h)&&(u=new r.o,s=new r.o),1===h){if(l)return b.lineSegmentPlane(e,t,a,u),b.lineSegmentPlane(e,o,a,s),{positions:[e,t,o,u,s],indices:[0,3,4,1,2,4,1,4,3]};if(w)return b.lineSegmentPlane(t,o,a,u),b.lineSegmentPlane(t,e,a,s),{positions:[e,t,o,u,s],indices:[1,3,4,2,0,4,2,4,3]};if(p)return b.lineSegmentPlane(o,e,a,u),b.lineSegmentPlane(o,t,a,s),{positions:[e,t,o,u,s],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===h){if(!l)return b.lineSegmentPlane(t,e,a,u),b.lineSegmentPlane(o,e,a,s),{positions:[e,t,o,u,s],indices:[1,2,4,1,4,3,0,3,4]};if(!w)return b.lineSegmentPlane(o,t,a,u),b.lineSegmentPlane(e,t,a,s),{positions:[e,t,o,u,s],indices:[2,0,4,2,4,3,1,3,4]};if(!p)return b.lineSegmentPlane(e,o,a,u),b.lineSegmentPlane(t,o,a,s),{positions:[e,t,o,u,s],indices:[0,1,4,0,4,3,2,3,4]}}},e.f=m,e.g=b}));
