import{a as v}from"./chunk-MQMYX2JZ.js";import{d as H}from"./chunk-CJHFPVIB.js";import{a as m}from"./chunk-SSYG2MIY.js";import{a as O}from"./chunk-SRPTWKHW.js";import{a as D}from"./chunk-NLYLRNUA.js";import{a as P,b as q}from"./chunk-7TOCOFC3.js";import{a as o}from"./chunk-LBR6REQR.js";import{a as C}from"./chunk-GXFCHGTA.js";import{a as _}from"./chunk-UBHQMGET.js";import{a as T}from"./chunk-EDZQSM3T.js";import{a as l}from"./chunk-NUC3LT2W.js";function f(a,t){T.typeOf.object("ellipsoid",a),this._ellipsoid=a,this._cameraPosition=new o,this._cameraPositionInScaledSpace=new o,this._distanceToLimbInScaledSpaceSquared=0,l(t)&&(this.cameraPosition=t)}Object.defineProperties(f.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},cameraPosition:{get:function(){return this._cameraPosition},set:function(a){var t=this._ellipsoid,e=t.transformPositionToScaledSpace(a,this._cameraPositionInScaledSpace),r=o.magnitudeSquared(e)-1;o.clone(a,this._cameraPosition),this._cameraPositionInScaledSpace=e,this._distanceToLimbInScaledSpaceSquared=r}}});var R=new o;f.prototype.isPointVisible=function(a){var t=this._ellipsoid,e=t.transformPositionToScaledSpace(a,R);return V(e,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};f.prototype.isScaledSpacePointVisible=function(a){return V(a,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};var K=new o;f.prototype.isScaledSpacePointVisiblePossiblyUnderEllipsoid=function(a,t){var e=this._ellipsoid,r,i;return l(t)&&t<0&&e.minimumRadius>-t?(i=K,i.x=this._cameraPosition.x/(e.radii.x+t),i.y=this._cameraPosition.y/(e.radii.y+t),i.z=this._cameraPosition.z/(e.radii.z+t),r=i.x*i.x+i.y*i.y+i.z*i.z-1):(i=this._cameraPositionInScaledSpace,r=this._distanceToLimbInScaledSpaceSquared),V(a,i,r)};f.prototype.computeHorizonCullingPoint=function(a,t,e){return F(this._ellipsoid,a,t,e)};var W=q.clone(q.UNIT_SPHERE);f.prototype.computeHorizonCullingPointPossiblyUnderEllipsoid=function(a,t,e,r){var i=k(this._ellipsoid,e,W);return F(i,a,t,r)};f.prototype.computeHorizonCullingPointFromVertices=function(a,t,e,r,i){return j(this._ellipsoid,a,t,e,r,i)};f.prototype.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid=function(a,t,e,r,i,s){var n=k(this._ellipsoid,i,W);return j(n,a,t,e,r,s)};var X=[];f.prototype.computeHorizonCullingPointFromRectangle=function(a,t,e){T.typeOf.object("rectangle",a);var r=D.subsample(a,t,0,X),i=H.fromPoints(r);if(!(o.magnitude(i.center)<.1*t.minimumRadius))return this.computeHorizonCullingPoint(i.center,r,e)};var Y=new o;function k(a,t,e){if(l(t)&&t<0&&a.minimumRadius>-t){var r=o.fromElements(a.radii.x+t,a.radii.y+t,a.radii.z+t,Y);a=q.fromCartesian3(r,e)}return a}function F(a,t,e,r){T.typeOf.object("directionToPoint",t),T.defined("positions",e),l(r)||(r=new o);for(var i=Z(a,t),s=0,n=0,p=e.length;n<p;++n){var c=e[n],d=L(a,c,i);if(d<0)return;s=Math.max(s,d)}return U(i,s,r)}var x=new o;function j(a,t,e,r,i,s){T.typeOf.object("directionToPoint",t),T.defined("vertices",e),T.typeOf.number("stride",r),l(s)||(s=new o),r=_(r,3),i=_(i,o.ZERO);for(var n=Z(a,t),p=0,c=0,d=e.length;c<d;c+=r){x.x=e[c]+i.x,x.y=e[c+1]+i.y,x.z=e[c+2]+i.z;var y=L(a,x,n);if(y<0)return;p=Math.max(p,y)}return U(n,p,s)}function V(a,t,e){var r=t,i=e,s=o.subtract(a,r,R),n=-o.dot(s,r),p=i<0?n>0:n>i&&n*n/o.magnitudeSquared(s)>i;return!p}var $=new o,tt=new o;function L(a,t,e){var r=a.transformPositionToScaledSpace(t,$),i=o.magnitudeSquared(r),s=Math.sqrt(i),n=o.divideByScalar(r,s,tt);i=Math.max(1,i),s=Math.max(1,s);var p=o.dot(n,e),c=o.magnitude(o.cross(n,e,n)),d=1/s,y=Math.sqrt(i-1)*d;return 1/(p*d-c*y)}function U(a,t,e){if(!(t<=0||t===1/0||t!==t))return o.multiplyByScalar(a,t,e)}var g=new o;function Z(a,t){return o.equals(t,o.ZERO)?t:(a.transformPositionToScaledSpace(t,g),o.normalize(g,g))}var ht=f;var at={NONE:0,BITS12:1},h=Object.freeze(at);var E=new o,et=new o,u=new P,w=new m,rt=new m,it=Math.pow(2,12);function S(a,t,e,r,i,s){var n=h.NONE,p,c,d;if(l(a)&&l(t)&&l(e)&&l(r)){var y=a.minimum,b=a.maximum,z=o.subtract(b,y,et),I=e-t,M=Math.max(o.maximumComponent(z),I);M<it-1?n=h.BITS12:n=h.NONE,n=h.NONE,p=a.center,c=m.inverseTransformation(r,new m);var Q=o.negate(y,E);m.multiply(m.fromTranslation(Q,w),c,c);var N=E;N.x=1/z.x,N.y=1/z.y,N.z=1/z.z,m.multiply(m.fromScale(N,w),c,c),d=m.clone(r),m.setTranslation(d,o.ZERO,d),r=m.clone(r,new m);var G=m.fromTranslation(y,w),J=m.fromScale(z,rt),A=m.multiply(G,J,w);m.multiply(r,A,r),m.multiply(d,A,d)}this.quantization=n,this.minimumHeight=t,this.maximumHeight=e,this.center=p,this.toScaledENU=c,this.fromScaledENU=r,this.matrix=d,this.hasVertexNormals=i,this.hasWebMercatorT=_(s,!1)}S.prototype.encode=function(a,t,e,r,i,s,n){var p=r.x,c=r.y;if(this.quantization===h.BITS12){e=m.multiplyByPoint(this.toScaledENU,e,E),e.x=C.clamp(e.x,0,1),e.y=C.clamp(e.y,0,1),e.z=C.clamp(e.z,0,1);var d=this.maximumHeight-this.minimumHeight,y=C.clamp((i-this.minimumHeight)/d,0,1);P.fromElements(e.x,e.y,u);var b=v.compressTextureCoordinates(u);P.fromElements(e.z,y,u);var z=v.compressTextureCoordinates(u);P.fromElements(p,c,u);var I=v.compressTextureCoordinates(u);if(a[t++]=b,a[t++]=z,a[t++]=I,this.hasWebMercatorT){P.fromElements(n,0,u);var M=v.compressTextureCoordinates(u);a[t++]=M}}else o.subtract(e,this.center,E),a[t++]=E.x,a[t++]=E.y,a[t++]=E.z,a[t++]=i,a[t++]=p,a[t++]=c,this.hasWebMercatorT&&(a[t++]=n);return this.hasVertexNormals&&(a[t++]=v.octPackFloat(s)),t};S.prototype.decodePosition=function(a,t,e){if(l(e)||(e=new o),t*=this.getStride(),this.quantization===h.BITS12){var r=v.decompressTextureCoordinates(a[t],u);e.x=r.x,e.y=r.y;var i=v.decompressTextureCoordinates(a[t+1],u);return e.z=i.x,m.multiplyByPoint(this.fromScaledENU,e,e)}return e.x=a[t],e.y=a[t+1],e.z=a[t+2],o.add(e,this.center,e)};S.prototype.decodeTextureCoordinates=function(a,t,e){return l(e)||(e=new P),t*=this.getStride(),this.quantization===h.BITS12?v.decompressTextureCoordinates(a[t+2],e):P.fromElements(a[t+4],a[t+5],e)};S.prototype.decodeHeight=function(a,t){if(t*=this.getStride(),this.quantization===h.BITS12){var e=v.decompressTextureCoordinates(a[t+1],u);return e.y*(this.maximumHeight-this.minimumHeight)+this.minimumHeight}return a[t+3]};S.prototype.decodeWebMercatorT=function(a,t){return t*=this.getStride(),this.quantization===h.BITS12?v.decompressTextureCoordinates(a[t+3],u).x:a[t+6]};S.prototype.getOctEncodedNormal=function(a,t,e){var r=this.getStride();t=(t+1)*r-1;var i=a[t]/256,s=Math.floor(i),n=(i-s)*256;return P.fromElements(s,n,e)};S.prototype.getStride=function(){var a;switch(this.quantization){case h.BITS12:a=3;break;default:a=6}return this.hasWebMercatorT&&++a,this.hasVertexNormals&&++a,a};var B={position3DAndHeight:0,textureCoordAndEncodedNormals:1},ot={compressed0:0,compressed1:1};S.prototype.getAttributes=function(a){var t=O.FLOAT,e=O.getSizeInBytes(t),r;if(this.quantization===h.NONE){var i=4,s=2;this.hasWebMercatorT&&++s,this.hasVertexNormals&&++s,r=(i+s)*e;var n=[{index:B.position3DAndHeight,name:"position3DAndHeight",vertexBuffer:a,componentDatatype:t,componentsPerAttribute:i,offsetInBytes:0,strideInBytes:r},{index:B.textureCoordAndEncodedNormals,name:"textureCoordAndEncodedNormals",vertexBuffer:a,componentDatatype:t,componentsPerAttribute:s,offsetInBytes:i*e,strideInBytes:r}];return n}var p=3,c=0;return(this.hasWebMercatorT||this.hasVertexNormals)&&++p,this.hasWebMercatorT&&this.hasVertexNormals?(++c,r=(p+c)*e,[{index:n.compressed0,name:"compressed0",vertexBuffer:a,componentDatatype:t,componentsPerAttribute:p,offsetInBytes:0,strideInBytes:r},{index:n.compressed1,name:"compressed1",vertexBuffer:a,componentDatatype:t,componentsPerAttribute:c,offsetInBytes:p*e,strideInBytes:r}]):[{index:n.compressed0,name:"compressed0",vertexBuffer:a,componentDatatype:t,componentsPerAttribute:p}]};S.prototype.getAttributeLocations=function(){return this.quantization===h.NONE?B:ot};S.clone=function(a,t){return l(t)||(t=new S),t.quantization=a.quantization,t.minimumHeight=a.minimumHeight,t.maximumHeight=a.maximumHeight,t.center=o.clone(a.center),t.toScaledENU=m.clone(a.toScaledENU),t.fromScaledENU=m.clone(a.fromScaledENU),t.matrix=m.clone(a.matrix),t.hasVertexNormals=a.hasVertexNormals,t.hasWebMercatorT=a.hasWebMercatorT,t};var Nt=S;export{ht as a,Nt as b};
