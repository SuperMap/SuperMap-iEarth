define(["./buildModuleUrl-d80eb436","./Cartesian2-21b2f76f","./Cartesian3-fecb63f1","./Cartographic-d606c511","./Check-52a7d806","./when-92c6cf3c","./GeographicTilingScheme-4962a259","./ArcType-31298545","./arrayRemoveDuplicates-a6924649","./ComponentDatatype-98414d16","./EllipsoidGeodesic-8e4b8fdd","./EllipsoidRhumbLine-79383554","./EncodedCartesian3-cea7f70b","./GeometryAttribute-60174428","./IntersectionTests-d75410df","./Math-ecf82623","./FeatureDetection-7479e310","./Plane-11c91fbf","./WebMercatorProjection-c4d8fc77","./Event-3390cd7d","./RuntimeError-c6a62a80","./WebGLConstants-42651efd","./Cartesian4-72b88c9e"],(function(e,o,a,n,t,r,i,s,l,c,u,p,d,h,f,g,w,m,v,y,E,T,_){"use strict";var I=new a.o,O=new a.o,k=new n.a,P=new a.o,S=new a.o,L=new e.i,b=new i.g,x=[new n.a,new n.a,new n.a,new n.a],C=new o.o,A={};function N(e){n.a.fromRadians(e.east,e.north,0,x[0]),n.a.fromRadians(e.west,e.north,0,x[1]),n.a.fromRadians(e.east,e.south,0,x[2]),n.a.fromRadians(e.west,e.south,0,x[3]);var o,a=0,t=0,r=0,i=0,s=A._terrainHeightsMaxLevel;for(o=0;o<=s;++o){for(var l=!1,c=0;c<4;++c){var u=x[c];if(b.positionToTileXY(u,o,C),0===c)r=C.x,i=C.y;else if(r!==C.x||i!==C.y){l=!0;break}}if(l)break;a=r,t=i}if(0!==o)return{x:a,y:t,level:o>s?s:o-1}}A.initialize=function(){var o=A._initPromise;return r.e(o)||(o=e.t.fetchJson(e.n$1("Assets/approximateTerrainHeights.json")).then((function(e){A._terrainHeights=e})),A._initPromise=o),o},A.getMinimumMaximumHeights=function(e,n){if(t.o.defined("rectangle",e),!r.e(A._terrainHeights))throw new t.t("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");n=r.u(n,o.t.WGS84);var i=N(e),s=A._defaultMinTerrainHeight,l=A._defaultMaxTerrainHeight;if(r.e(i)){var c=i.level+"-"+i.x+"-"+i.y,u=A._terrainHeights[c];r.e(u)&&(s=u[0],l=u[1]),n.cartographicToCartesian(o.h.northeast(e,k),I),n.cartographicToCartesian(o.h.southwest(e,k),O),a.o.midpoint(O,I,P);var p=n.scaleToGeodeticSurface(P,S);if(r.e(p)){var d=a.o.distance(P,p);s=Math.min(s,-d)}else s=A._defaultMinTerrainHeight}return{minimumTerrainHeight:s=Math.max(A._defaultMinTerrainHeight,s),maximumTerrainHeight:l}},A.getBoundingSphere=function(a,n){if(t.o.defined("rectangle",a),!r.e(A._terrainHeights))throw new t.t("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");n=r.u(n,o.t.WGS84);var i=N(a),s=A._defaultMaxTerrainHeight;if(r.e(i)){var l=i.level+"-"+i.x+"-"+i.y,c=A._terrainHeights[l];r.e(c)&&(s=c[1])}var u=e.i.fromRectangle3D(a,n,0);return e.i.fromRectangle3D(a,n,s,L),e.i.union(u,L,u)},A._terrainHeightsMaxLevel=6,A._defaultMaxTerrainHeight=9e3,A._defaultMinTerrainHeight=-1e5,A._terrainHeights=void 0,A._initPromise=void 0,Object.defineProperties(A,{initialized:{get:function(){return r.e(A._terrainHeights)}}});var D=[e.n,v.t],H=D.length,M=Math.cos(g.e.toRadians(30)),z=Math.cos(g.e.toRadians(150));function R(e){var a=(e=r.u(e,r.u.EMPTY_OBJECT)).positions;if(!r.e(a)||a.length<2)throw new t.t("At least two positions are required.");if(r.e(e.arcType)&&e.arcType!==s.L.GEODESIC&&e.arcType!==s.L.RHUMB)throw new t.t("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=r.u(e.width,1),this._positions=a,this.granularity=r.u(e.granularity,9999),this.loop=r.u(e.loop,!1),this.arcType=r.u(e.arcType,s.L.GEODESIC),this._ellipsoid=r.u(e.ellipsoid,o.t.WGS84),this._projectionIndex=0,this._workerName="createGroundPolylineGeometry",this._scene3DOnly=!1}Object.defineProperties(R.prototype,{packedLength:{get:function(){return 1+3*this._positions.length+1+1+1+o.t.packedLength+1+1}}}),R.setProjectionAndEllipsoid=function(e,o){for(var a=0,n=0;n<H;n++)if(o instanceof D[n]){a=n;break}e._projectionIndex=a,e._ellipsoid=o.ellipsoid};var j=new a.o,F=new a.o,G=new a.o;function B(e,o,n,t,r){var i=$(t,e,0,j),s=$(t,e,n,F),l=$(t,o,0,G),c=X(s,i,F),u=X(l,i,G);return a.o.cross(u,c,r),a.o.normalize(r,r)}var q=new n.a,U=new a.o,W=new a.o,Y=new a.o;function V(e,o,n,t,r,i,l,c,d,h,f){if(0!==r){var g;i===s.L.GEODESIC?g=new u.E(e,o,l):i===s.L.RHUMB&&(g=new p.P(e,o,l));var w=g.surfaceDistance;if(!(w<r))for(var m=B(e,o,t,l,Y),v=Math.ceil(w/r),y=w/v,E=y,T=v-1,_=c.length,I=0;I<T;I++){var O=g.interpolateUsingSurfaceDistance(E,q),k=$(l,O,n,U),P=$(l,O,t,W);a.o.pack(m,c,_),a.o.pack(k,d,_),a.o.pack(P,h,_),f.push(O.latitude),f.push(O.longitude),_+=3,E+=y}}}var Z=new n.a;function $(e,o,a,t){return n.a.clone(o,Z),Z.height=a,n.a.toCartesian(Z,e,t)}function X(e,o,n){return a.o.subtract(e,o,n),a.o.normalize(n,n),n}function J(e,o,n,t){return t=X(e,o,t),t=a.o.cross(t,n,t),t=a.o.normalize(t,t),t=a.o.cross(n,t,t)}R.pack=function(e,n,i){t.o.typeOf.object("value",e),t.o.defined("array",n);var s=r.u(i,0),l=e._positions,c=l.length;n[s++]=c;for(var u=0;u<c;++u){var p=l[u];a.o.pack(p,n,s),s+=3}return n[s++]=e.granularity,n[s++]=e.loop?1:0,n[s++]=e.arcType,o.t.pack(e._ellipsoid,n,s),s+=o.t.packedLength,n[s++]=e._projectionIndex,n[s++]=e._scene3DOnly?1:0,n},R.unpack=function(e,n,i){t.o.defined("array",e);for(var s=r.u(n,0),l=e[s++],c=new Array(l),u=0;u<l;u++)c[u]=a.o.unpack(e,s),s+=3;var p=e[s++],d=1===e[s++],h=e[s++],f=o.t.unpack(e,s);s+=o.t.packedLength;var g=e[s++],w=1===e[s++];if(!r.e(i)){var m=new R({positions:c,granularity:p,loop:d,arcType:h,ellipsoid:f});return m._projectionIndex=g,m._scene3DOnly=w,m}return i._positions=c,i.granularity=p,i.loop=d,i.arcType=h,i._ellipsoid=f,i._projectionIndex=g,i._scene3DOnly=w,i};var Q=new a.o,K=new a.o,ee=new a.o,oe=new a.o;function ae(e,o,n,t,r){var i=X(n,o,oe),s=J(e,o,i,Q),l=J(t,o,i,K);if(g.e.equalsEpsilon(a.o.dot(s,l),-1,g.e.EPSILON5))return r=a.o.cross(i,s,r),r=a.o.normalize(r,r);r=a.o.add(l,s,r),r=a.o.normalize(r,r);var c=a.o.cross(i,r,ee);return a.o.dot(l,c)<0&&(r=a.o.negate(r,r)),r}var ne=m.o.fromPointNormal(a.o.ZERO,a.o.UNIT_Y),te=new a.o,re=new a.o,ie=new a.o,se=new a.o,le=new a.o,ce=new a.o,ue=new n.a,pe=new n.a,de=new n.a;R.createGeometry=function(e){var o,t,i=!e._scene3DOnly,c=e.loop,u=e._ellipsoid,d=e.granularity,h=e.arcType,w=new D[e._projectionIndex](u),m=1e3,v=e._positions,y=v.length;2===y&&(c=!1);var E,T,_,I,O,k,P,S=new p.P(void 0,void 0,u),L=[v[0]];for(t=0;t<y-1;t++)E=v[t],T=v[t+1],O=f.g.lineSegmentPlane(E,T,ne,ce),r.e(O)&&!a.o.equalsEpsilon(O,E,g.e.EPSILON7)&&!a.o.equalsEpsilon(O,T,g.e.EPSILON7)&&(e.arcType===s.L.GEODESIC?L.push(a.o.clone(O)):e.arcType===s.L.RHUMB&&(P=u.cartesianToCartographic(O,ue).longitude,_=u.cartesianToCartographic(E,ue),I=u.cartesianToCartographic(T,pe),S.setEndPoints(_,I),k=S.findIntersectionWithLongitude(P,de),O=u.cartographicToCartesian(k,ce),r.e(O)&&!a.o.equalsEpsilon(O,E,g.e.EPSILON7)&&!a.o.equalsEpsilon(O,T,g.e.EPSILON7)&&L.push(a.o.clone(O)))),L.push(T);c&&(E=v[y-1],T=v[0],O=f.g.lineSegmentPlane(E,T,ne,ce),r.e(O)&&!a.o.equalsEpsilon(O,E,g.e.EPSILON7)&&!a.o.equalsEpsilon(O,T,g.e.EPSILON7)&&(e.arcType===s.L.GEODESIC?L.push(a.o.clone(O)):e.arcType===s.L.RHUMB&&(P=u.cartesianToCartographic(O,ue).longitude,_=u.cartesianToCartographic(E,ue),I=u.cartesianToCartographic(T,pe),S.setEndPoints(_,I),k=S.findIntersectionWithLongitude(P,de),O=u.cartographicToCartesian(k,ce),r.e(O)&&!a.o.equalsEpsilon(O,E,g.e.EPSILON7)&&!a.o.equalsEpsilon(O,T,g.e.EPSILON7)&&L.push(a.o.clone(O)))));var b=L.length,x=new Array(b);for(t=0;t<b;t++){var C=n.a.fromCartesian(L[t],u);C.height=0,x[t]=C}if(!((b=(x=l.D(x,n.a.equalsEpsilon)).length)<2)){var A=[],N=[],H=[],M=[],z=te,R=re,j=ie,F=se,G=le,q=x[0],U=x[1];for(z=$(u,x[b-1],0,z),F=$(u,U,0,F),R=$(u,q,0,R),j=$(u,q,m,j),G=c?ae(z,R,j,F,G):B(q,U,m,u,G),a.o.pack(G,N,0),a.o.pack(R,H,0),a.o.pack(j,M,0),A.push(q.latitude),A.push(q.longitude),V(q,U,0,m,d,h,u,N,H,M,A),t=1;t<b-1;++t){z=a.o.clone(R,z),R=a.o.clone(F,R);var W=x[t];$(u,W,m,j),$(u,x[t+1],0,F),ae(z,R,j,F,G),o=N.length,a.o.pack(G,N,o),a.o.pack(R,H,o),a.o.pack(j,M,o),A.push(W.latitude),A.push(W.longitude),V(x[t],x[t+1],0,m,d,h,u,N,H,M,A)}var Y=x[b-1],Z=x[b-2];if(R=$(u,Y,0,R),j=$(u,Y,m,j),c){var X=x[0];G=ae(z=$(u,Z,0,z),R,j,F=$(u,X,0,F),G)}else G=B(Z,Y,m,u,G);if(o=N.length,a.o.pack(G,N,o),a.o.pack(R,H,o),a.o.pack(j,M,o),A.push(Y.latitude),A.push(Y.longitude),c){for(V(Y,q,0,m,d,h,u,N,H,M,A),o=N.length,t=0;t<3;++t)N[o+t]=N[t],H[o+t]=H[t],M[o+t]=M[t];A.push(q.latitude),A.push(q.longitude)}return ro(c,w,H,M,N,A,i)}};var he=new a.o,fe=new w.p$1,ge=new h.n;function we(e,o,n,t){var r=X(n,o,he),i=a.o.dot(r,e);if(i>M||i<z){var s=X(t,n,oe),l=i<z?g.e.PI_OVER_TWO:-g.e.PI_OVER_TWO,c=h.n.fromAxisAngle(s,l,ge),u=w.p$1.fromQuaternion(c,fe);return w.p$1.multiplyByVector(u,e,e),!0}return!1}var me=new n.a,ve=new a.o,ye=new a.o;function Ee(e,o,t,r,i){var s=n.a.toCartesian(o,e._ellipsoid,ve),l=a.o.add(s,t,ye),c=!1,u=e._ellipsoid,p=u.cartesianToCartographic(l,me);Math.abs(o.longitude-p.longitude)>g.e.PI_OVER_TWO&&(c=!0,l=a.o.subtract(s,t,ye),p=u.cartesianToCartographic(l,me)),p.height=0;var d=e.project(p,i);return(i=a.o.subtract(d,r,i)).z=0,i=a.o.normalize(i,i),c&&a.o.negate(i,i),i}var Te=new a.o,_e=new a.o;function Ie(e,o,n,t,r,i){var s=a.o.subtract(o,e,Te);a.o.normalize(s,s);var l=n-0,c=a.o.multiplyByScalar(s,l,_e);a.o.add(e,c,r);var u=t-1e3;c=a.o.multiplyByScalar(s,u,_e),a.o.add(o,c,i)}var Oe=new a.o;function ke(e,o){var n=m.o.getPointDistance(ne,e),t=m.o.getPointDistance(ne,o),r=Oe;g.e.equalsEpsilon(n,0,g.e.EPSILON2)?(r=X(o,e,r),a.o.multiplyByScalar(r,g.e.EPSILON2,r),a.o.add(e,r,e)):g.e.equalsEpsilon(t,0,g.e.EPSILON2)&&(r=X(e,o,r),a.o.multiplyByScalar(r,g.e.EPSILON2,r),a.o.add(o,r,o))}function Pe(e,o){var a=Math.abs(e.longitude),n=Math.abs(o.longitude);if(g.e.equalsEpsilon(a,g.e.PI,g.e.EPSILON11)){var t=g.e.sign(o.longitude);return e.longitude=t*(a-g.e.EPSILON11),1}if(g.e.equalsEpsilon(n,g.e.PI,g.e.EPSILON11)){var r=g.e.sign(e.longitude);return o.longitude=r*(n-g.e.EPSILON11),2}return 0}var Se=new n.a,Le=new n.a,be=new a.o,xe=new a.o,Ce=new a.o,Ae=new a.o,Ne=new a.o,De=new a.o,He=[Se,Le],Me=new o.h,ze=new a.o,Re=new a.o,je=new a.o,Fe=new a.o,Ge=new a.o,Be=new a.o,qe=new a.o,Ue=new a.o,We=new a.o,Ye=new a.o,Ve=new a.o,Ze=new a.o,$e=new a.o,Xe=new a.o,Je=new d.i,Qe=new d.i,Ke=new a.o,eo=new a.o,oo=new a.o,ao=[new e.i,new e.i],no=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],to=no.length;function ro(n,t,r,i,s,l,u){var p,f,w,m,v,y,E=t._ellipsoid,T=r.length/3-1,_=8*T,I=4*_,O=36*T,k=_>65535?new Uint32Array(O):new Uint16Array(O),P=new Float64Array(3*_),S=new Float32Array(I),L=new Float32Array(I),b=new Float32Array(I),x=new Float32Array(I),C=new Float32Array(I);u&&(w=new Float32Array(I),m=new Float32Array(I),v=new Float32Array(I),y=new Float32Array(2*_));var N=l.length/2,D=0,H=Se;H.height=0;var z=Le;z.height=0;var R=be,j=xe;if(u)for(f=0,p=1;p<N;p++)H.latitude=l[f],H.longitude=l[f+1],z.latitude=l[f+2],z.longitude=l[f+3],R=t.project(H,R),j=t.project(z,j),D+=a.o.distance(R,j),f+=2;var F=i.length/3;j=a.o.unpack(i,0,j);var G,B=0;for(f=3,p=1;p<F;p++)R=a.o.clone(j,R),j=a.o.unpack(i,f,j),B+=a.o.distance(R,j),f+=3;f=3;var q=0,U=0,W=0,Y=0,V=!1,Z=a.o.unpack(r,0,Ae),$=a.o.unpack(i,0,xe),J=a.o.unpack(s,0,De);n&&(we(J,a.o.unpack(r,r.length-6,Ce),Z,$)&&(J=a.o.negate(J,J)));var Q=0,K=0,ee=0;for(p=0;p<T;p++){var oe,ae,ne,te,re=a.o.clone(Z,Ce),ie=a.o.clone($,be),se=a.o.clone(J,Ne);if(V&&(se=a.o.negate(se,se)),Z=a.o.unpack(r,f,Ae),$=a.o.unpack(i,f,xe),V=we(J=a.o.unpack(s,f,De),re,Z,$),H.latitude=l[q],H.longitude=l[q+1],z.latitude=l[q+2],z.longitude=l[q+3],u){var le=Pe(H,z);oe=t.project(H,Ge);var ce=X(ae=t.project(z,Be),oe,Ke);ce.y=Math.abs(ce.y),ne=qe,te=Ue,0===le||a.o.dot(ce,a.o.UNIT_Y)>M?(ne=Ee(t,H,se,oe,qe),te=Ee(t,z,J,ae,Ue)):1===le?(te=Ee(t,z,J,ae,Ue),ne.x=0,ne.y=g.e.sign(H.longitude-Math.abs(z.longitude)),ne.z=0):(ne=Ee(t,H,se,oe,qe),te.x=0,te.y=g.e.sign(H.longitude-z.longitude),te.z=0)}var ue=a.o.distance(ie,$),pe=d.i.fromCartesian(re,Je),de=a.o.subtract(Z,re,We),he=a.o.normalize(de,Ze),fe=a.o.subtract(ie,re,Ye);fe=a.o.normalize(fe,fe);var ge=a.o.cross(he,fe,Ze);ge=a.o.normalize(ge,ge);var me=a.o.cross(fe,se,$e);me=a.o.normalize(me,me);var ve=a.o.subtract($,Z,Ve);ve=a.o.normalize(ve,ve);var ye=a.o.cross(J,ve,Xe);ye=a.o.normalize(ye,ye);var Te,_e,Oe,ro=ue/B,so=Q/B,lo=0,co=0,uo=0;if(u){lo=a.o.distance(oe,ae),Te=d.i.fromCartesian(oe,Qe),_e=a.o.subtract(ae,oe,Ke);var po=(Oe=a.o.normalize(_e,eo)).x;Oe.x=Oe.y,Oe.y=-po,co=lo/D,uo=K/D}for(G=0;G<8;G++){var ho=Y+4*G,fo=U+2*G,go=ho+3,wo=G<4?1:-1,mo=2===G||3===G||6===G||7===G?1:-1;a.o.pack(pe.high,S,ho),S[go]=de.x,a.o.pack(pe.low,L,ho),L[go]=de.y,a.o.pack(me,b,ho),b[go]=de.z,a.o.pack(ye,x,ho),x[go]=ro*wo,a.o.pack(ge,C,ho);var vo=so*mo;0===vo&&mo<0&&(vo=Number.POSITIVE_INFINITY),C[go]=vo,u&&(w[ho]=Te.high.x,w[ho+1]=Te.high.y,w[ho+2]=Te.low.x,w[ho+3]=Te.low.y,v[ho]=-ne.y,v[ho+1]=ne.x,v[ho+2]=te.y,v[ho+3]=-te.x,m[ho]=_e.x,m[ho+1]=_e.y,m[ho+2]=Oe.x,m[ho+3]=Oe.y,y[fo]=co*wo,0===(vo=uo*mo)&&mo<0&&(vo=Number.POSITIVE_INFINITY),y[fo+1]=vo)}var yo=je,Eo=Fe,To=ze,_o=Re,Io=o.h.fromCartographicArray(He,Me),Oo=A.getMinimumMaximumHeights(Io,E),ko=Oo.minimumTerrainHeight,Po=Oo.maximumTerrainHeight;ee+=ko,ee+=Po,Ie(re,ie,ko,Po,yo,To),Ie(Z,$,ko,Po,Eo,_o);var So=a.o.multiplyByScalar(ge,g.e.EPSILON5,oo);a.o.add(yo,So,yo),a.o.add(Eo,So,Eo),a.o.add(To,So,To),a.o.add(_o,So,_o),ke(yo,Eo),ke(To,_o),a.o.pack(yo,P,W),a.o.pack(Eo,P,W+3),a.o.pack(_o,P,W+6),a.o.pack(To,P,W+9),So=a.o.multiplyByScalar(ge,-2*g.e.EPSILON5,oo),a.o.add(yo,So,yo),a.o.add(Eo,So,Eo),a.o.add(To,So,To),a.o.add(_o,So,_o),ke(yo,Eo),ke(To,_o),a.o.pack(yo,P,W+12),a.o.pack(Eo,P,W+15),a.o.pack(_o,P,W+18),a.o.pack(To,P,W+21),q+=2,f+=3,U+=16,W+=24,Y+=32,Q+=ue,K+=lo}f=0;var Lo=0;for(p=0;p<T;p++){for(G=0;G<to;G++)k[f+G]=no[G]+Lo;Lo+=8,f+=to}var bo=ao;e.i.fromVertices(r,a.o.ZERO,3,bo[0]),e.i.fromVertices(i,a.o.ZERO,3,bo[1]);var xo=e.i.fromBoundingSpheres(bo);xo.radius+=ee/(2*T);var Co={position:new h.o({componentDatatype:c.ComponentDatatype.DOUBLE,componentsPerAttribute:3,normalize:!1,values:P}),startHiAndForwardOffsetX:io(S),startLoAndForwardOffsetY:io(L),startNormalAndForwardOffsetZ:io(b),endNormalAndTextureCoordinateNormalizationX:io(x),rightNormalAndTextureCoordinateNormalizationY:io(C)};return u&&(Co.startHiLo2D=io(w),Co.offsetAndRight2D=io(m),Co.startEndNormals2D=io(v),Co.texcoordNormalization2D=new h.o({componentDatatype:c.ComponentDatatype.FLOAT,componentsPerAttribute:2,normalize:!1,values:y})),new h.I({attributes:Co,indices:k,boundingSphere:xo})}function io(e){return new h.o({componentDatatype:c.ComponentDatatype.FLOAT,componentsPerAttribute:4,normalize:!1,values:e})}return R._projectNormal=Ee,function(e,o){return A.initialize().then((function(){return r.e(o)&&(e=R.unpack(e,o)),R.createGeometry(e)}))}}));
