import{a as O}from"./chunk-77JEGE4I.js";import{a as M}from"./chunk-AMRCVYIA.js";import{a as f}from"./chunk-6S43R6PL.js";import{a as b}from"./chunk-EDZQSM3T.js";import"./chunk-PJGSCWXZ.js";import{a as R}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";var J=1953029805,X=2917034100;function V(r,a){if(V.passThroughDataForTesting)return a;b.typeOf.object("key",r),b.typeOf.object("data",a);var i=r.byteLength;if(i===0||i%4!==0)throw new f("The length of key must be greater than 0 and a multiple of 4.");var t=new DataView(a),e=t.getUint32(0,!0);if(e===J||e===X)return a;for(var o=new DataView(r),n=0,u=a.byteLength,c=u-u%8,d=i,s,g=8;n<c;)for(g=(g+8)%24,s=g;n<c&&s<d;)t.setUint32(n,t.getUint32(n,!0)^o.getUint32(s,!0),!0),t.setUint32(n+4,t.getUint32(n+4,!0)^o.getUint32(s+4,!0),!0),n+=8,s+=24;if(n<u)for(s>=d&&(g=(g+8)%24,s=g);n<u;)t.setUint8(n,t.getUint8(n)^o.getUint8(s)),n++,s++}V.passThroughDataForTesting=!1;var z=V;function Z(r,a){return(r&a)!==0}var m=Z;var $=[1,2,4,8],L=15,K=16,ee=64,re=128;function v(r,a,i,t,e,o){this._bits=r,this.cnodeVersion=a,this.imageryVersion=i,this.terrainVersion=t,this.imageryProvider=e,this.terrainProvider=o,this.ancestorHasTerrain=!1,this.terrainState=void 0}v.clone=function(r,a){return R(a)?(a._bits=r._bits,a.cnodeVersion=r.cnodeVersion,a.imageryVersion=r.imageryVersion,a.terrainVersion=r.terrainVersion,a.imageryProvider=r.imageryProvider,a.terrainProvider=r.terrainProvider):a=new v(r._bits,r.cnodeVersion,r.imageryVersion,r.terrainVersion,r.imageryProvider,r.terrainProvider),a.ancestorHasTerrain=r.ancestorHasTerrain,a.terrainState=r.terrainState,a};v.prototype.setParent=function(r){this.ancestorHasTerrain=r.ancestorHasTerrain||this.hasTerrain()};v.prototype.hasSubtree=function(){return m(this._bits,K)};v.prototype.hasImagery=function(){return m(this._bits,ee)};v.prototype.hasTerrain=function(){return m(this._bits,re)};v.prototype.hasChildren=function(){return m(this._bits,L)};v.prototype.hasChild=function(r){return m(this._bits,$[r])};v.prototype.getChildBitmask=function(){return this._bits&L};var C=v;var T=Uint16Array.BYTES_PER_ELEMENT,p=Int32Array.BYTES_PER_ELEMENT,l=Uint32Array.BYTES_PER_ELEMENT,h={METADATA:0,TERRAIN:1,DBROOT:2};h.fromString=function(r){if(r==="Metadata")return h.METADATA;if(r==="Terrain")return h.TERRAIN;if(r==="DbRoot")return h.DBROOT};function te(r,a){var i=h.fromString(r.type),t=r.buffer;z(r.key,t);var e=se(t);t=e.buffer;var o=e.length;switch(i){case h.METADATA:return ie(t,o,r.quadKey);case h.TERRAIN:return ne(t,o,a);case h.DBROOT:return a.push(t),{buffer:t}}}var ae=32301;function ie(r,a,i){var t=new DataView(r),e=0,o=t.getUint32(e,!0);if(e+=l,o!==ae)throw new f("Invalid magic");var n=t.getUint32(e,!0);if(e+=l,n!==1)throw new f("Invalid data type. Must be 1 for QuadTreePacket");var u=t.getUint32(e,!0);if(e+=l,u!==2)throw new f("Invalid QuadTreePacket version. Only version 2 is supported.");var c=t.getInt32(e,!0);e+=p;var d=t.getInt32(e,!0);if(e+=p,d!==32)throw new f("Invalid instance size.");var s=t.getInt32(e,!0);e+=p;var g=t.getInt32(e,!0);e+=p;var G=t.getInt32(e,!0);if(e+=p,s!==c*d+e)throw new f("Invalid dataBufferOffset");if(s+g+G!==a)throw new f("Invalid packet offsets");for(var U=[],P=0;P<c;++P){var H=t.getUint8(e);++e,++e;var F=t.getUint16(e,!0);e+=T;var Y=t.getUint16(e,!0);e+=T;var Q=t.getUint16(e,!0);e+=T,e+=T,e+=T,e+=p,e+=p,e+=8;var j=t.getUint8(e++),W=t.getUint8(e++);e+=T,U.push(new C(H,F,Y,Q,j,W))}var w=[],I=0;function S(q,A,k){var D=!1;if(k===4){if(A.hasSubtree())return;D=!0}for(var E=0;E<4;++E){var y=q+E.toString();if(D)w[y]=null;else if(k<4)if(!A.hasChild(E))w[y]=null;else{if(I===c){console.log("Incorrect number of instances");return}var _=U[I++];w[y]=_,S(y,_,k+1)}}}var B=0,x=U[I++];return i===""?++B:w[i]=x,S(i,x,B),w}function ne(r,a,i){for(var t=new DataView(r),e=0,o=[];e<a;){for(var n=e,u=0;u<4;++u){var c=t.getUint32(e,!0);e+=l,e+=c}var d=r.slice(n,e);i.push(d),o.push(d)}return o}var N=1953029805,oe=2917034100;function se(r){var a=new DataView(r),i=0,t=a.getUint32(i,!0);if(i+=l,t!==N&&t!==oe)throw new f("Invalid magic");var e=a.getUint32(i,t===N);i+=l;var o=new Uint8Array(r,i),n=O.inflate(o);if(n.length!==e)throw new f("Size of packet doesn't match header");return n}var Ee=M(te);export{Ee as default};
