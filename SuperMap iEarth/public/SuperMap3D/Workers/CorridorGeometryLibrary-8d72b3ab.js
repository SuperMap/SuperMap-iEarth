define(["exports","./Cartesian3-c1138337","./PolylineVolumeGeometryLibrary-8564ed0e","./defaultValue-2110bb17","./Math-cd1437d9","./FeatureDetection-e7fb956a","./PolylinePipeline-92dcfbc3","./GeometryAttribute-b12ab6bd"],(function(o,e,a,r,n,t,l,i){"use strict";var s={},u=new e.o,c=new e.o,y=new e.o,d=new e.o,m=[new e.o,new e.o],p=new e.o,g=new e.o,f=new e.o,h=new e.o,w=new e.o,z=new e.o,S=new e.o,v=new e.o,b=new e.o,x=new e.o,A=new i.n,B=new t.p;function E(o,r,l,s,y){var d,m=e.o.angleBetween(e.o.subtract(r,o,u),e.o.subtract(l,o,c)),p=s===a.S.BEVELED?1:Math.ceil(m/n.e.toRadians(5))+1,g=3*p,f=new Array(g);f[g-3]=l.x,f[g-2]=l.y,f[g-1]=l.z,d=y?t.p.fromQuaternion(i.n.fromAxisAngle(e.o.negate(o,u),m/p,A),B):t.p.fromQuaternion(i.n.fromAxisAngle(o,m/p,A),B);var h=0;r=e.o.clone(r,u);for(var w=0;w<p;w++)r=t.p.multiplyByVector(d,r,r),f[h++]=r.x,f[h++]=r.y,f[h++]=r.z;return f}function D(o,a,r,n){var t=u;return n||(a=e.o.negate(a,a)),[(t=e.o.add(o,a,t)).x,t.y,t.z,r.x,r.y,r.z]}function P(o,a,r,n){for(var t=new Array(o.length),l=new Array(o.length),i=e.o.multiplyByScalar(a,r,u),s=e.o.negate(i,c),m=0,p=o.length-1,g=0;g<o.length;g+=3){var f=e.o.fromArray(o,g,y),h=e.o.add(f,s,d);t[m++]=h.x,t[m++]=h.y,t[m++]=h.z;var w=e.o.add(f,i,d);l[p--]=w.z,l[p--]=w.y,l[p--]=w.x}return n.push(t,l),n}s.addAttribute=function(o,e,a,n){var t=e.x,l=e.y,i=e.z;r.e(a)&&(o[a]=t,o[a+1]=l,o[a+2]=i),r.e(n)&&(o[n]=i,o[n-1]=l,o[n-2]=t)};var N=new e.o,O=new e.o;s.computePositions=function(o){var r=o.granularity,t=o.positions,i=o.ellipsoid,s=o.width/2,c=o.cornerType,y=o.saveAttributes,d=p,A=g,B=f,R=h,V=w,L=z,U=S,M=v,G=b,I=x,Q=[],T=y?[]:void 0,q=y?[]:void 0,C=t[0],F=t[1];A=e.o.normalize(e.o.subtract(F,C,A),A),d=i.geodeticSurfaceNormal(C,d),R=e.o.normalize(e.o.cross(d,A,R),R),y&&(T.push(R.x,R.y,R.z),q.push(d.x,d.y,d.z)),U=e.o.clone(C,U),C=F,B=e.o.negate(A,B);var J,j,k=[],H=t.length;for(J=1;J<H-1;J++){d=i.geodeticSurfaceNormal(C,d),F=t[J+1],A=e.o.normalize(e.o.subtract(F,C,A),A),V=e.o.normalize(e.o.add(A,B,V),V);var K=e.o.multiplyByScalar(d,e.o.dot(A,d),N);e.o.subtract(A,K,K),e.o.normalize(K,K);var W=e.o.multiplyByScalar(d,e.o.dot(B,d),O);if(e.o.subtract(B,W,W),e.o.normalize(W,W),!n.e.equalsEpsilon(Math.abs(e.o.dot(K,W)),1,n.e.EPSILON7)){V=e.o.cross(V,d,V),V=e.o.cross(d,V,V),V=e.o.normalize(V,V);var X=s/Math.max(.25,e.o.magnitude(e.o.cross(V,B,u))),Y=a.J.angleIsGreaterThanPi(A,B,C,i);V=e.o.multiplyByScalar(V,X,V),Y?(M=e.o.add(C,V,M),I=e.o.add(M,e.o.multiplyByScalar(R,s,I),I),G=e.o.add(M,e.o.multiplyByScalar(R,2*s,G),G),m[0]=e.o.clone(U,m[0]),m[1]=e.o.clone(I,m[1]),Q=P(l.m.generateArc({positions:m,granularity:r,ellipsoid:i}),R,s,Q),y&&(T.push(R.x,R.y,R.z),q.push(d.x,d.y,d.z)),L=e.o.clone(G,L),R=e.o.normalize(e.o.cross(d,A,R),R),G=e.o.add(M,e.o.multiplyByScalar(R,2*s,G),G),U=e.o.add(M,e.o.multiplyByScalar(R,s,U),U),c===a.S.ROUNDED||c===a.S.BEVELED?k.push({leftPositions:E(M,L,G,c,Y)}):k.push({leftPositions:D(C,e.o.negate(V,V),G,Y)})):(G=e.o.add(C,V,G),I=e.o.add(G,e.o.negate(e.o.multiplyByScalar(R,s,I),I),I),M=e.o.add(G,e.o.negate(e.o.multiplyByScalar(R,2*s,M),M),M),m[0]=e.o.clone(U,m[0]),m[1]=e.o.clone(I,m[1]),Q=P(l.m.generateArc({positions:m,granularity:r,ellipsoid:i}),R,s,Q),y&&(T.push(R.x,R.y,R.z),q.push(d.x,d.y,d.z)),L=e.o.clone(M,L),R=e.o.normalize(e.o.cross(d,A,R),R),M=e.o.add(G,e.o.negate(e.o.multiplyByScalar(R,2*s,M),M),M),U=e.o.add(G,e.o.negate(e.o.multiplyByScalar(R,s,U),U),U),c===a.S.ROUNDED||c===a.S.BEVELED?k.push({rightPositions:E(G,L,M,c,Y)}):k.push({rightPositions:D(C,V,M,Y)})),B=e.o.negate(A,B)}C=F}return d=i.geodeticSurfaceNormal(C,d),m[0]=e.o.clone(U,m[0]),m[1]=e.o.clone(C,m[1]),Q=P(l.m.generateArc({positions:m,granularity:r,ellipsoid:i}),R,s,Q),y&&(T.push(R.x,R.y,R.z),q.push(d.x,d.y,d.z)),c===a.S.ROUNDED&&(j=function(o){var r=p,n=g,t=f,l=o[1];n=e.o.fromArray(o[1],l.length-3,n),t=e.o.fromArray(o[0],0,t);var i=E(r=e.o.midpoint(n,t,r),n,t,a.S.ROUNDED,!1),s=o.length-1,u=o[s-1];return l=o[s],n=e.o.fromArray(u,u.length-3,n),t=e.o.fromArray(l,0,t),[i,E(r=e.o.midpoint(n,t,r),n,t,a.S.ROUNDED,!1)]}(Q)),{positions:Q,corners:k,lefts:T,normals:q,endPositions:j}},o.b=s}));
