!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(e,t,r){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var i=new Int32Array(this.arrayBuffer);e=i[0],t=i[1],r=i[2],this.d=t+2*r;for(var o=0;o<this.d*this.d;o++){var s=i[3+o],a=i[3+o+1];n.push(s===a?null:i.subarray(s,a))}var u=i[3+n.length],c=i[3+n.length+1];this.keys=i.subarray(u,c),this.bboxes=i.subarray(c),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var l=0;l<this.d*this.d;l++)n.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var h=r/t*e;this.min=-h,this.max=e+h}e.prototype.insert=function(e,t,r,n,i){this._forEachCell(t,r,n,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(e,t,r,n,i,o){this.cells[i].push(o)},e.prototype.query=function(e,t,r,n,i){var o=this.min,s=this.max;if(e<=o&&t<=o&&s<=r&&s<=n&&!i)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,r,n,this._queryCell,a,{},i),a},e.prototype._queryCell=function(e,t,r,n,i,o,s,a){var u=this.cells[i];if(null!==u)for(var c=this.keys,l=this.bboxes,h=0;h<u.length;h++){var p=u[h];if(void 0===s[p]){var d=4*p;(a?a(l[d+0],l[d+1],l[d+2],l[d+3]):e<=l[d+2]&&t<=l[d+3]&&r>=l[d+0]&&n>=l[d+1])?(s[p]=!0,o.push(c[p])):s[p]=!1}}},e.prototype._forEachCell=function(e,t,r,n,i,o,s,a){for(var u=this._convertToCellCoord(e),c=this._convertToCellCoord(t),l=this._convertToCellCoord(r),h=this._convertToCellCoord(n),p=u;p<=l;p++)for(var d=c;d<=h;d++){var f=this.d*d+p;if((!a||a(this._convertFromCellCoord(p),this._convertFromCellCoord(d),this._convertFromCellCoord(p+1),this._convertFromCellCoord(d+1)))&&i.call(this,e,t,r,n,f,o,s,a))return}},e.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},e.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(t+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=t,s=0;s<e.length;s++){var a=e[s];i[3+s]=o,i.set(a,o),o+=a.length}return i[3+e.length]=o,i.set(this.keys,o),o+=this.keys.length,i[3+e.length+1]=o,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function n(e){return e<0?0:e>1?1:e}function i(e){return"%"===e[e.length-1]?r(parseFloat(e)/100*255):r(parseInt(e))}function o(e){return"%"===e[e.length-1]?n(parseFloat(e)/100):n(parseFloat(e))}function s(e,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}class a{constructor(e,t,r,n=1){this.r=e,this.g=t,this.b=r,this.a=n}static parse(e){if(!e)return;if(e instanceof a)return e;if("string"!=typeof e)return;const n=function(e){var n,a=e.replace(/ /g,"").toLowerCase();if(a in t)return t[a].slice();if("#"===a[0])return 4===a.length?(n=parseInt(a.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:7===a.length&&(n=parseInt(a.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var u=a.indexOf("("),c=a.indexOf(")");if(-1!==u&&c+1===a.length){var l=a.substr(0,u),h=a.substr(u+1,c-(u+1)).split(","),p=1;switch(l){case"rgba":if(4!==h.length)return null;p=o(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),p];case"hsla":if(4!==h.length)return null;p=o(h.pop());case"hsl":if(3!==h.length)return null;var d=(parseFloat(h[0])%360+360)%360/360,f=o(h[1]),A=o(h[2]),g=A<=.5?A*(f+1):A+f-A*f,_=2*A-g;return[r(255*s(_,g,d+1/3)),r(255*s(_,g,d)),r(255*s(_,g,d-1/3)),p];default:return null}}return null}(e);return n?new a(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,t,r,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(r)},${n})`}toArray(){const{r:e,g:t,b:r,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*r/n,n]}}function l(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}a.black=new a(0,0,0,1),a.white=new a(1,1,1,1),a.transparent=new a(0,0,0,0),a.red=new a(1,0,0,1);var h=function(e){function t(t,r){e.call(this,r),this.message=r,this.key=t}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error);class p{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,r]of t)this.bindings[e]=r}concat(e){return new p(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const d={kind:"null"},A={kind:"number"},_={kind:"string"},m={kind:"boolean"},y={kind:"color"},E={kind:"object"},x={kind:"value"},b={kind:"collator"},I={kind:"formatted"},T={kind:"resolvedImage"};function v(e,t){return{kind:"array",itemType:e,N:t}}function R(e){if("array"===e.kind){const t=R(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const M=[d,A,_,m,y,I,E,v(x),T];function w(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!w(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of M)if(!w(e,t))return null}return`Expected ${R(e)} but found ${R(t)} instead.`}function S(e,t){return t.some((t=>t.kind===e.kind))}function B(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}var O=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};O.prototype.compare=function(e,t){return this.collator.compare(e,t)},O.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};class F{constructor(e,t,r,n,i){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=r,this.fontStack=n,this.textColor=i}}class P{constructor(e){this.sections=e}static fromString(e){return new P([new F(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof P?e:P.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const r={};t.fontStack&&(r["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(r["font-scale"]=t.scale),t.textColor&&(r["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(r)}return e}}class N{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new N({name:e,available:!1}):null}serialize(){return["image",this.name]}}function L(e,t,r,n){if(!("number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255)){return`Invalid rgba value [${("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}return void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,t,r,n].join(", ")}]: 'a' must be between 0 and 1.`}function U(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof a)return!0;if(e instanceof O)return!0;if(e instanceof P)return!0;if(e instanceof N)return!0;if(Array.isArray(e)){for(const t of e)if(!U(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!U(e[t]))return!1;return!0}return!1}function G(e){if(null===e)return d;if("string"==typeof e)return _;if("boolean"==typeof e)return m;if("number"==typeof e)return A;if(e instanceof a)return y;if(e instanceof O)return b;if(e instanceof P)return I;if(e instanceof N)return T;if(Array.isArray(e)){const t=e.length;let r;for(const t of e){const e=G(t);if(r){if(r===e)continue;r=x;break}r=e}return v(r||x,t)}return E}function Q(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof a||e instanceof P||e instanceof N?e.toString():JSON.stringify(e)}class k{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!U(e[1]))return t.error("invalid value");const r=e[1];let n=G(r);const i=t.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new k(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof a?["rgba"].concat(this.value.toArray()):this.value instanceof P?this.value.serialize():this.value}}var z=function(e){this.name="ExpressionEvaluationError",this.message=e};z.prototype.toJSON=function(){return this.message};const j={string:_,number:A,boolean:m,object:E};class q{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r,n=1;const i=e[0];if("array"===i){let i,o;if(e.length>2){const r=e[1];if("string"!=typeof r||!(r in j)||"object"===r)return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=j[r],n++}else i=x;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],n++}r=v(i,o)}else r=j[i];const o=[];for(;n<e.length;n++){const r=t.parse(e[n],n,x);if(!r)return null;o.push(r)}return new q(r,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(!w(this.type,G(r)))return r;if(t===this.args.length-1)throw new z(`Expected value to be of type ${R(this.type)}, but found ${R(G(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){t.push(r.kind);const n=e.N;("number"==typeof n||this.args.length>1)&&t.push(n)}}return t.concat(this.args.map((e=>e.serialize())))}}class V{constructor(e){this.type=I,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return t.error("First argument must be an image or text section.");const n=[];let i=!1;for(let r=1;r<=e.length-1;++r){const o=e[r];if(i&&"object"==typeof o&&!Array.isArray(o)){i=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,A),!e))return null;let r=null;if(o["text-font"]&&(r=t.parse(o["text-font"],1,v(_)),!r))return null;let s=null;if(o["text-color"]&&(s=t.parse(o["text-color"],1,y),!s))return null;const a=n[n.length-1];a.scale=e,a.font=r,a.textColor=s}else{const o=t.parse(e[r],1,x);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:o,scale:null,font:null,textColor:null})}}return new V(n)}evaluate(e){return new P(this.sections.map((t=>{const r=t.content.evaluate(e);return G(r)===T?new F("",r,null,null,null):new F(Q(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const r={};t.scale&&(r["font-scale"]=t.scale.serialize()),t.font&&(r["text-font"]=t.font.serialize()),t.textColor&&(r["text-color"]=t.textColor.serialize()),e.push(r)}return e}}class Y{constructor(e){this.type=T,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,_);return r?new Y(r):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),r=N.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const X={"to-boolean":m,"to-color":y,"to-number":A,"to-string":_};class W{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0];if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return t.error("Expected one argument.");const n=X[r],i=[];for(let r=1;r<e.length;r++){const n=t.parse(e[r],r,x);if(!n)return null;i.push(n)}return new W(n,i)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,r;for(const n of this.args){if(t=n.evaluate(e),r=null,t instanceof a)return t;if("string"==typeof t){const r=e.parseColor(t);if(r)return r}else if(Array.isArray(t)&&(r=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:L(t[0],t[1],t[2],t[3]),!r))return new a(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new z(r||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const r of this.args){if(t=r.evaluate(e),null===t)return 0;const n=Number(t);if(!isNaN(n))return n}throw new z(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?P.fromString(Q(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?N.fromString(Q(this.args[0].evaluate(e))):Q(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new V([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Y(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}const K=["Unknown","Point","LineString","Polygon"];class J{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?K[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord,i=r*t-e[0],o=n*t-e[1];return this.featureDistanceData.bearing[0]*i+this.featureDistanceData.bearing[1]*o}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=a.parse(e)),t}}let Z={};class ${constructor(e,t,r,n){this.name=e,this.type=t,this._evaluate=r,this.args=n}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const r=e[0],n=Z[r];if(!n)return t.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[n,o]of s){a=new Ie(t.registry,t.path,null,t.scope);const s=[];let u=!1;for(let t=1;t<e.length;t++){const r=e[t],i=Array.isArray(n)?n[t-1]:n.type,o=a.parse(r,1+s.length,i);if(!o){u=!0;break}s.push(o)}if(!u)if(Array.isArray(n)&&n.length!==s.length)a.error(`Expected ${n.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const t=Array.isArray(n)?n[e]:n.type,r=s[e];a.concat(e+1).checkSubtype(t,r.type)}if(0===a.errors.length)return new $(r,i,o,s)}}if(1===s.length)t.errors.push(...a.errors);else{const r=(s.length?s:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(R).join(", ")})`:`(${R(t.type)}...)`;var t})).join(" | "),n=[];for(let r=1;r<e.length;r++){const i=t.parse(e[r],1+n.length);if(!i)return null;n.push(R(i.type))}t.error(`Expected arguments of type ${r}, but found (${n.join(", ")}) instead.`)}return null}static register(e,t){Z=t;for(const r in t)e[r]=$}}class ee{constructor(e,t,r){this.type=b,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return t.error("Collator options argument must be an object.");const n=t.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,m);if(!n)return null;const i=t.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,m);if(!i)return null;let o=null;return r.locale&&(o=t.parse(r.locale,1,_),!o)?null:new ee(n,i,o)}evaluate(e){return new O(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const te=8192;function re(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function ne(e,t){return!(e[0]<=t[0])&&(!(e[2]>=t[2])&&(!(e[1]<=t[1])&&!(e[3]>=t[3])))}function ie(e,t){const r=(180+e[0])/360;const n=(i=e[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360);var i;const o=Math.pow(2,t.z);return[Math.round(r*o*te),Math.round(n*o*te)]}function oe(e,t,r){const n=e[0]-t[0],i=e[1]-t[1],o=e[0]-r[0],s=e[1]-r[1];return n*s-o*i==0&&n*o<=0&&i*s<=0}function se(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function ae(e,t){let r=!1;for(let n=0,i=t.length;n<i;n++){const i=t[n];for(let t=0,n=i.length;t<n-1;t++){if(oe(e,i[t],i[t+1]))return!1;se(e,i[t],i[t+1])&&(r=!r)}}return r}function ue(e,t){for(let r=0;r<t.length;r++)if(ae(e,t[r]))return!0;return!1}function ce(e,t,r,n){const i=e[0]-r[0],o=e[1]-r[1],s=t[0]-r[0],a=t[1]-r[1],u=n[0]-r[0],c=n[1]-r[1],l=i*c-u*o,h=s*c-u*a;return l>0&&h<0||l<0&&h>0}function le(e,t,r,n){const i=[t[0]-e[0],t[1]-e[1]],o=[n[0]-r[0],n[1]-r[1]];return 0!=(s=o)[0]*(a=i)[1]-s[1]*a[0]&&!(!ce(e,t,r,n)||!ce(r,n,e,t));var s,a}function he(e,t,r){for(const n of r)for(let r=0;r<n.length-1;++r)if(le(e,t,n[r],n[r+1]))return!0;return!1}function pe(e,t){for(let r=0;r<e.length;++r)if(!ae(e[r],t))return!1;for(let r=0;r<e.length-1;++r)if(he(e[r],e[r+1],t))return!1;return!0}function de(e,t){for(let r=0;r<t.length;r++)if(pe(e,t[r]))return!0;return!1}function fe(e,t,r){const n=[];for(let i=0;i<e.length;i++){const o=[];for(let n=0;n<e[i].length;n++){const s=ie(e[i][n],r);re(t,s),o.push(s)}n.push(o)}return n}function Ae(e,t,r){const n=[];for(let i=0;i<e.length;i++){const o=fe(e[i],t,r);n.push(o)}return n}function ge(e,t,r,n){if(e[0]<r[0]||e[0]>r[2]){const t=.5*n;let i=e[0]-r[0]>t?-n:r[0]-e[0]>t?n:0;0===i&&(i=e[0]-r[2]>t?-n:r[2]-e[0]>t?n:0),e[0]+=i}re(t,e)}function _e(e,t,r,n){const i=Math.pow(2,n.z)*te,o=[n.x*te,n.y*te],s=[];if(!e)return s;for(const n of e)for(const e of n){const n=[e.x+o[0],e.y+o[1]];ge(n,t,r,i),s.push(n)}return s}function me(e,t,r,n){const i=Math.pow(2,n.z)*te,o=[n.x*te,n.y*te],s=[];if(!e)return s;for(const r of e){const e=[];for(const n of r){const r=[n.x+o[0],n.y+o[1]];re(t,r),e.push(r)}s.push(e)}if(t[2]-t[0]<=i/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const n of e)ge(n,t,r,i)}var a;return s}class ye{constructor(e,t){this.type=m,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(U(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const r=t.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new ye(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new ye(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new ye(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const o=fe(t.coordinates,n,i),s=_e(e.geometry(),r,n,i);if(!ne(r,n))return!1;for(const e of s)if(!ae(e,o))return!1}if("MultiPolygon"===t.type){const o=Ae(t.coordinates,n,i),s=_e(e.geometry(),r,n,i);if(!ne(r,n))return!1;for(const e of s)if(!ue(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const o=fe(t.coordinates,n,i),s=me(e.geometry(),r,n,i);if(!ne(r,n))return!1;for(const e of s)if(!pe(e,o))return!1}if("MultiPolygon"===t.type){const o=Ae(t.coordinates,n,i),s=me(e.geometry(),r,n,i);if(!ne(r,n))return!1;for(const e of s)if(!de(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Ee(e){if(e instanceof $){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof ye)return!1;let t=!0;return e.eachChild((e=>{t&&!Ee(e)&&(t=!1)})),t}function xe(e){if(e instanceof $&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!xe(e)&&(t=!1)})),t}function Ce(e,t){if(e instanceof $&&t.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild((e=>{r&&!Ce(e,t)&&(r=!1)})),r}class be{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new be(r,t.scope.get(r)):t.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ie{constructor(e,t=[],r,n=new p,i=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=i,this.expectedType=r}parse(e,t,r,n,i={}){return t?this.concat(t,r,n)._parse(e,i):this._parse(e,i)}_parse(e,t){function r(e,t,r){return"assert"===r?new q(t,[e]):"coerce"===r?new W(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=e[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const i=this.registry[n];if(i){let n=i.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,i=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==i.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(e,i))return null}else n=r(n,e,t.typeAnnotation||"coerce");else n=r(n,e,t.typeAnnotation||"assert")}if(!(n instanceof k)&&"resolvedImage"!==n.type.kind&&Te(n)){const e=new J;try{n=new k(n.type,n.evaluate(e))}catch(e){return this.error(e.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return void 0===e?this.error("'undefined' value invalid. Use null instead."):"object"==typeof e?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,r){const n="number"==typeof e?this.path.concat(e):this.path,i=r?this.scope.concat(r):this.scope;return new Ie(this.registry,n,t||null,i,this.errors)}error(e,...t){const r=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new h(r,e))}checkSubtype(e,t){const r=w(e,t);return r&&this.error(r),r}}function Te(e){if(e instanceof be)return Te(e.boundExpression);if(e instanceof $&&"error"===e.name)return!1;if(e instanceof ee)return!1;if(e instanceof ye)return!1;const t=e instanceof W||e instanceof q;let r=!0;return e.eachChild((e=>{r=t?r&&Te(e):r&&e instanceof k})),!!r&&(Ee(e)&&Ce(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}function ve(e,t){const r=e.length-1;let n,i,o=0,s=r,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),n=e[a],i=e[a+1],n<=t){if(a===r||t<i)return a;o=a+1}else{if(!(n>t))throw new z("Input is not a number.");s=a-1}return 0}class Re{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,A);if(!r)return null;const n=[];let i=null;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(let r=1;r<e.length;r+=2){const o=1===r?-1/0:e[r],s=e[r+1],a=r,u=r+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,u,i);if(!c)return null;i=i||c.type,n.push([o,c])}return new Re(i,r,n)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;if(n>=t[i-1])return r[i-1].evaluate(e);return r[ve(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}function Me(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=n}function we(e,t,r){return e*(1-r)+t*r}Me.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,n=0;n<8;n++){var i=this.sampleCurveX(r)-e;if(Math.abs(i)<t)return r;var o=this.sampleCurveDerivativeX(r);if(Math.abs(o)<1e-6)break;r-=i/o}var s=0,a=1;for(r=e,n=0;n<20&&(i=this.sampleCurveX(r),!(Math.abs(i-e)<t));n++)e>i?s=r:a=r,r=.5*(a-s)+s;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var Se=Object.freeze({__proto__:null,number:we,color:function(e,t,r){return new a(we(e.r,t.r,r),we(e.g,t.g,r),we(e.b,t.b,r),we(e.a,t.a,r))},array:function(e,t,r){return e.map(((e,n)=>we(e,t[n],r)))}});const Be=.95047,Oe=1.08883,De=4/29,Fe=6/29,Pe=3*Fe*Fe,Ne=Fe*Fe*Fe,Le=Math.PI/180,Ue=180/Math.PI;function Ge(e){return e>Ne?Math.pow(e,1/3):e/Pe+De}function Qe(e){return e>Fe?e*e*e:Pe*(e-De)}function ke(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function ze(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function je(e){const t=ze(e.r),r=ze(e.g),n=ze(e.b),i=Ge((.4124564*t+.3575761*r+.1804375*n)/Be),o=Ge((.2126729*t+.7151522*r+.072175*n)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-Ge((.0193339*t+.119192*r+.9503041*n)/Oe)),alpha:e.a}}function He(e){let t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*Qe(t),r=Be*Qe(r),n=Oe*Qe(n),new a(ke(3.2404542*r-1.5371385*t-.4985314*n),ke(-.969266*r+1.8760108*t+.041556*n),ke(.0556434*r-.2040259*t+1.0572252*n),e.alpha)}function qe(e,t,r){const n=t-e;return e+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const Ve={forward:je,reverse:He,interpolate:function(e,t,r){return{l:we(e.l,t.l,r),a:we(e.a,t.a,r),b:we(e.b,t.b,r),alpha:we(e.alpha,t.alpha,r)}}},Ye={forward:function(e){const{l:t,a:r,b:n}=je(e),i=Math.atan2(n,r)*Ue;return{h:i<0?i+360:i,c:Math.sqrt(r*r+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Le,r=e.c;return He({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:qe(e.h,t.h,r),c:we(e.c,t.c,r),l:we(e.l,t.l,r),alpha:we(e.alpha,t.alpha,r)}}};var Xe=Object.freeze({__proto__:null,lab:Ve,hcl:Ye});class We{constructor(e,t,r,n,i){this.type=e,this.operator=t,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,r,n){let i=0;if("exponential"===e.name)i=Ke(t,e.base,r,n);else if("linear"===e.name)i=Ke(t,1,r,n);else if("cubic-bezier"===e.name){const o=e.controlPoints;i=new Me(o[0],o[1],o[2],o[3]).solve(Ke(t,1,r,n))}return i}static parse(e,t){let[r,n,i,...o]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const e=n.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,2,A),!i)return null;const s=[];let a=null;"interpolate-hcl"===r||"interpolate-lab"===r?a=y:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<o.length;e+=2){const r=o[e],n=o[e+1],i=e+3,u=e+4;if("number"!=typeof r)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(s.length&&s[s.length-1][0]>=r)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=t.parse(n,u,a);if(!c)return null;a=a||c.type,s.push([r,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new We(a,r,n,i,s):t.error(`Type ${R(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;if(n>=t[i-1])return r[i-1].evaluate(e);const o=ve(t,n),s=t[o],a=t[o+1],u=We.interpolationFactor(this.interpolation,n,s,a),c=r[o].evaluate(e),l=r[o+1].evaluate(e);return"interpolate"===this.operator?Se[this.type.kind.toLowerCase()](c,l,u):"interpolate-hcl"===this.operator?Ye.reverse(Ye.interpolate(Ye.forward(c),Ye.forward(l),u)):Ve.reverse(Ve.interpolate(Ve.forward(c),Ve.forward(l),u))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function Ke(e,t,r,n){const i=n-r,o=e-r;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}class Je{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const n=t.expectedType;n&&"value"!==n.kind&&(r=n);const i=[];for(const n of e.slice(1)){const e=t.parse(n,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,i.push(e)}const o=n&&i.some((e=>w(n,e.type)));return new Je(o?x:r,i)}evaluate(e){let t,r=null,n=0;for(const i of this.args){if(n++,r=i.evaluate(e),r&&r instanceof N&&!r.available&&(t||(t=r),r=null,n===this.args.length))return t;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class Ze{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let n=1;n<e.length-1;n+=2){const i=e[n];if("string"!=typeof i)return t.error(`Expected string, but found ${typeof i} instead.`,n);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const o=t.parse(e[n+1],n+1);if(!o)return null;r.push([i,o])}const n=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return n?new Ze(r,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,r]of this.bindings)e.push(t,r.serialize());return e.push(this.result.serialize()),e}}class $e{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,A),n=t.parse(e[2],2,v(t.expectedType||x));if(!r||!n)return null;const i=n.type;return new $e(i.itemType,r,n)}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new z(`Array index out of bounds: ${t} < 0.`);if(t>=r.length)throw new z(`Array index out of bounds: ${t} > ${r.length-1}.`);if(t!==Math.floor(t))throw new z(`Array index must be an integer, but found ${t} instead.`);return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class et{constructor(e,t){this.type=m,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,x),n=t.parse(e[2],2,x);return r&&n?S(r.type,[m,_,A,d,x])?new et(r,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(r.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!B(t,["boolean","string","number","null"]))throw new z(`Expected first argument to be of type boolean, string, number or null, but found ${R(G(t))} instead.`);if(!B(r,["string","array"]))throw new z(`Expected second argument to be of type array or string, but found ${R(G(r))} instead.`);return r.indexOf(t)>=0}eachChild(){fn(this.needle),fn(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class tt{constructor(e,t,r){this.type=A,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,x),n=t.parse(e[2],2,x);if(!r||!n)return null;if(!S(r.type,[m,_,A,d,x]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(r.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,A);return i?new tt(r,n,i):null}return new tt(r,n)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!B(t,["boolean","string","number","null"]))throw new z(`Expected first argument to be of type boolean, string, number or null, but found ${R(G(t))} instead.`);if(!B(r,["string","array"]))throw new z(`Expected second argument to be of type array or string, but found ${R(G(r))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return r.indexOf(t,n)}return r.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class rt{constructor(e,t,r,n,i,o){this.inputType=e,this.type=t,this.input=r,this.cases=n,this.outputs=i,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let r,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const u=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(r){if(c.checkSubtype(r,G(e)))return null}else r=G(e);if(void 0!==i[String(e)])return c.error("Branch labels must be unique.");i[String(e)]=o.length}const l=t.parse(u,s,n);if(!l)return null;n=n||l.type,o.push(l)}const s=t.parse(e[1],1,x);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,n);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(r,s.type)?null:new rt(r,n,s,i,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(G(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),r=[],n={};for(const e of t){const t=n[this.cases[e]];void 0===t?(n[this.cases[e]]=r.length,r.push([this.cases[e],[e]])):r[t][1].push(e)}const i=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,n]of r)1===n.length?e.push(i(n[0])):e.push(n.map(i)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}class nt{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n=[];for(let i=1;i<e.length-1;i+=2){const o=t.parse(e[i],i,m);if(!o)return null;const s=t.parse(e[i+1],i+1,r);if(!s)return null;n.push([o,s]),r=r||s.type}const i=t.parse(e[e.length-1],e.length-1,r);return i?new nt(r,n,i):null}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class it{constructor(e,t,r,n){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,x),n=t.parse(e[2],2,A);if(!r||!n)return null;if(!S(r.type,[v(x),_,x]))return t.error(`Expected first argument to be of type array or string, but found ${R(r.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,A);return i?new it(r.type,r,n,i):null}return new it(r.type,r,n)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!B(t,["string","array"]))throw new z(`Expected first argument to be of type array or string, but found ${R(G(t))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(r,n)}return t.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ot(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function st(e,t,r,n){return 0===n.compare(t,r)}function at(e,t,r){const n="=="!==e&&"!="!==e;return class i{constructor(e,t,r){this.type=m,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const r=e[0];let o=t.parse(e[1],1,x);if(!o)return null;if(!ot(r,o.type))return t.concat(1).error(`"${r}" comparisons are not supported for type '${R(o.type)}'.`);let s=t.parse(e[2],2,x);if(!s)return null;if(!ot(r,s.type))return t.concat(2).error(`"${r}" comparisons are not supported for type '${R(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${R(o.type)}' and '${R(s.type)}'.`);n&&("value"===o.type.kind&&"value"!==s.type.kind?o=new q(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new q(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,b),!a)return null}return new i(o,s,a)}evaluate(i){const o=this.lhs.evaluate(i),s=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){const t=G(o),r=G(s);if(t.kind!==r.kind||"string"!==t.kind&&"number"!==t.kind)throw new z(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${r.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const e=G(o),r=G(s);if("string"!==e.kind||"string"!==r.kind)return t(i,o,s)}return this.collator?r(i,o,s,this.collator.evaluate(i)):t(i,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const ut=at("==",(function(e,t,r){return t===r}),st),ct=at("!=",(function(e,t,r){return t!==r}),(function(e,t,r,n){return!st(0,t,r,n)})),lt=at("<",(function(e,t,r){return t<r}),(function(e,t,r,n){return n.compare(t,r)<0})),ht=at(">",(function(e,t,r){return t>r}),(function(e,t,r,n){return n.compare(t,r)>0})),pt=at("<=",(function(e,t,r){return t<=r}),(function(e,t,r,n){return n.compare(t,r)<=0})),dt=at(">=",(function(e,t,r){return t>=r}),(function(e,t,r,n){return n.compare(t,r)>=0}));class ft{constructor(e,t,r,n,i,o){this.type=_,this.number=e,this.locale=t,this.currency=r,this.unit=n,this.minFractionDigits=i,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,A);if(!r)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let i=null;if(n.locale&&(i=t.parse(n.locale,1,_),!i))return null;let o=null;if(n.currency&&(o=t.parse(n.currency,1,_),!o))return null;let s=null;if(n.unit&&(s=t.parse(n.unit,1,_),!s))return null;let a=null;if(n["min-fraction-digits"]&&(a=t.parse(n["min-fraction-digits"],1,A),!a))return null;let u=null;return n["max-fraction-digits"]&&(u=t.parse(n["max-fraction-digits"],1,A),!u)?null:new ft(r,i,o,s,a,u)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class At{constructor(e){this.type=A,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=t.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?t.error(`Expected argument of type string or array, but found ${R(r.type)} instead.`):new At(r):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new z(`Expected value to be of type string or array, but found ${R(G(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const gt={"==":ut,"!=":ct,">":ht,"<":lt,">=":dt,"<=":pt,array:q,at:$e,boolean:q,case:nt,coalesce:Je,collator:ee,format:V,image:Y,in:et,"index-of":tt,interpolate:We,"interpolate-hcl":We,"interpolate-lab":We,length:At,let:Ze,literal:k,match:rt,number:q,"number-format":ft,object:q,slice:it,step:Re,string:q,"to-boolean":W,"to-color":W,"to-number":W,"to-string":W,var:be,within:ye};function _t(e,[t,r,n,i]){t=t.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);const o=i?i.evaluate(e):1,s=L(t,r,n,o);if(s)throw new z(s);return new a(t/255*o,r/255*o,n/255*o,o)}function mt(e,t){return e in t}function yt(e,t){const r=t[e];return void 0===r?null:r}function Et(e){return{type:e}}function xt(e){return{result:"success",value:e}}function Ct(e){return{result:"error",value:e}}function bt(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function It(e){return!!e.expression&&e.expression.interpolated}function Tt(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function vt(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Rt(e){return e}function Mt(e,t){const r="color"===t.type,n=e.stops&&"object"==typeof e.stops[0][0],i=n||void 0!==e.property,o=n||!i,s=e.type||(It(t)?"exponential":"interval");if(r&&((e=l({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],a.parse(e[1])]))),e.default?e.default=a.parse(e.default):e.default=a.parse(t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Xe[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let u,c,h;if("exponential"===s)u=Ot;else if("interval"===s)u=Bt;else if("categorical"===s){u=St,c=Object.create(null);for(const t of e.stops)c[t[0]]=t[1];h=typeof e.stops[0][0]}else{if("identity"!==s)throw new Error(`Unknown function type "${s}"`);u=Dt}if(n){const r={},n=[];for(let t=0;t<e.stops.length;t++){const i=e.stops[t],o=i[0].zoom;void 0===r[o]&&(r[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},n.push(o)),r[o].stops.push([i[0].value,i[1]])}const i=[];for(const e of n)i.push([r[e].zoom,Mt(r[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:We.interpolationFactor.bind(void 0,o),zoomStops:i.map((e=>e[0])),evaluate:({zoom:r},n)=>Ot({stops:i,base:e.base},t,r).evaluate(r,n)}}if(o){const r="exponential"===s?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:r,interpolationFactor:We.interpolationFactor.bind(void 0,r),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:r})=>u(e,t,r,c,h)}}return{kind:"source",evaluate(r,n){const i=n&&n.properties?n.properties[e.property]:void 0;return void 0===i?wt(e.default,t.default):u(e,t,i,c,h)}}}function wt(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function St(e,t,r,n,i){return wt(typeof r===i?n[r]:void 0,e.default,t.default)}function Bt(e,t,r){if("number"!==Tt(r))return wt(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[n-1][0])return e.stops[n-1][1];const i=ve(e.stops.map((e=>e[0])),r);return e.stops[i][1]}function Ot(e,t,r){const n=void 0!==e.base?e.base:1;if("number"!==Tt(r))return wt(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[i-1][0])return e.stops[i-1][1];const o=ve(e.stops.map((e=>e[0])),r),s=function(e,t,r,n){const i=n-r,o=e-r;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}(r,n,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],u=e.stops[o+1][1];let c=Se[t.type]||Rt;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Xe[e.colorSpace];c=(e,r)=>t.reverse(t.interpolate(t.forward(e),t.forward(r),s))}return"function"==typeof a.evaluate?{evaluate(...e){const t=a.evaluate.apply(void 0,e),r=u.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==r)return c(t,r,s)}}:c(a,u,s)}function Dt(e,t,r){return"color"===t.type?r=a.parse(r):"formatted"===t.type?r=P.fromString(r.toString()):"resolvedImage"===t.type?r=N.fromString(r.toString()):Tt(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),wt(r,e.default,t.default)}$.register(gt,{error:[{kind:"error"},[_],(e,[t])=>{throw new z(t.evaluate(e))}],typeof:[_,[x],(e,[t])=>R(G(t.evaluate(e)))],"to-rgba":[v(A,4),[y],(e,[t])=>t.evaluate(e).toArray()],rgb:[y,[A,A,A],_t],rgba:[y,[A,A,A,A],_t],has:{type:m,overloads:[[[_],(e,[t])=>mt(t.evaluate(e),e.properties())],[[_,E],(e,[t,r])=>mt(t.evaluate(e),r.evaluate(e))]]},get:{type:x,overloads:[[[_],(e,[t])=>yt(t.evaluate(e),e.properties())],[[_,E],(e,[t,r])=>yt(t.evaluate(e),r.evaluate(e))]]},"feature-state":[x,[_],(e,[t])=>yt(t.evaluate(e),e.featureState||{})],properties:[E,[],e=>e.properties()],"geometry-type":[_,[],e=>e.geometryType()],id:[x,[],e=>e.id()],zoom:[A,[],e=>e.globals.zoom],pitch:[A,[],e=>e.globals.pitch||0],"distance-from-center":[A,[],e=>e.distanceFromCenter()],"heatmap-density":[A,[],e=>e.globals.heatmapDensity||0],"line-progress":[A,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[A,[],e=>e.globals.skyRadialProgress||0],accumulated:[x,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[A,Et(A),(e,t)=>{let r=0;for(const n of t)r+=n.evaluate(e);return r}],"*":[A,Et(A),(e,t)=>{let r=1;for(const n of t)r*=n.evaluate(e);return r}],"-":{type:A,overloads:[[[A,A],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[A],(e,[t])=>-t.evaluate(e)]]},"/":[A,[A,A],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[A,[A,A],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[A,[],()=>Math.LN2],pi:[A,[],()=>Math.PI],e:[A,[],()=>Math.E],"^":[A,[A,A],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[A,[A],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[A,[A],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[A,[A],(e,[t])=>Math.log(t.evaluate(e))],log2:[A,[A],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[A,[A],(e,[t])=>Math.sin(t.evaluate(e))],cos:[A,[A],(e,[t])=>Math.cos(t.evaluate(e))],tan:[A,[A],(e,[t])=>Math.tan(t.evaluate(e))],asin:[A,[A],(e,[t])=>Math.asin(t.evaluate(e))],acos:[A,[A],(e,[t])=>Math.acos(t.evaluate(e))],atan:[A,[A],(e,[t])=>Math.atan(t.evaluate(e))],min:[A,Et(A),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[A,Et(A),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[A,[A],(e,[t])=>Math.abs(t.evaluate(e))],round:[A,[A],(e,[t])=>{const r=t.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[A,[A],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[A,[A],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[m,[_,x],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[m,[x],(e,[t])=>e.id()===t.value],"filter-type-==":[m,[_],(e,[t])=>e.geometryType()===t.value],"filter-<":[m,[_,x],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n<i}],"filter-id-<":[m,[x],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r<n}],"filter->":[m,[_,x],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n>i}],"filter-id->":[m,[x],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r>n}],"filter-<=":[m,[_,x],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[m,[x],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r<=n}],"filter->=":[m,[_,x],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[m,[x],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r>=n}],"filter-has":[m,[x],(e,[t])=>t.value in e.properties()],"filter-has-id":[m,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[m,[v(_)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[m,[v(x)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[m,[_,v(x)],(e,[t,r])=>r.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[m,[_,v(x)],(e,[t,r])=>function(e,t,r,n){for(;r<=n;){const i=r+n>>1;if(t[i]===e)return!0;t[i]>e?n=i-1:r=i+1}return!1}(e.properties()[t.value],r.value,0,r.value.length-1)],all:{type:m,overloads:[[[m,m],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[Et(m),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:m,overloads:[[[m,m],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[Et(m),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[m,[m],(e,[t])=>!t.evaluate(e)],"is-supported-script":[m,[_],(e,[t])=>{const r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[_,[_],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[_,[_],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[_,Et(x),(e,t)=>t.map((t=>Q(t.evaluate(e)))).join("")],"resolved-locale":[_,[b],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Ft{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new J,this._defaultValue=t?function(e){return"color"===e.type&&(vt(e.default)||Array.isArray(e.default))?new a(0,0,0,0):"color"===e.type?a.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,r,n,i,o,s,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,n,i,o,s,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new z(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Pt(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in gt}function Nt(e,t){const r=new Ie(gt,[],t?function(e){const t={color:y,string:_,number:A,enum:_,boolean:m,formatted:I,resolvedImage:T};if("array"===e.type)return v(t[e.value]||x,e.length);return t[e.type]}(t):void 0),n=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?xt(new Ft(n,t)):Ct(r.errors)}class Lt{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!xe(t.expression)}evaluateWithoutErrorHandling(e,t,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,o)}evaluate(e,t,r,n,i,o){return this._styleExpression.evaluate(e,t,r,n,i,o)}}class Ut{constructor(e,t,r,n){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!xe(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,o)}evaluate(e,t,r,n,i,o){return this._styleExpression.evaluate(e,t,r,n,i,o)}interpolationFactor(e,t,r){return this.interpolationType?We.interpolationFactor(this.interpolationType,e,t,r):0}}function Gt(e,t){if("error"===(e=Nt(e,t)).result)return e;const r=e.value.expression,n=Ee(r);if(!n&&!bt(t))return Ct([new h("","data expressions not supported")]);const i=Ce(r,["zoom","pitch","distance-from-center"]);if(!i&&!function(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}(t))return Ct([new h("","zoom expressions not supported")]);const o=kt(r);if(!o&&!i)return Ct([new h("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof h)return Ct([o]);if(o instanceof We&&!It(t))return Ct([new h("",'"interpolate" expressions cannot be used with this property')]);if(!o)return xt(new Lt(n?"constant":"source",e.value));const s=o instanceof We?o.interpolation:void 0;return xt(new Ut(n?"camera":"composite",e.value,o.labels,s))}class Qt{constructor(e,t){this._parameters=e,this._specification=t,l(this,Mt(this._parameters,this._specification))}static deserialize(e){return new Qt(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function kt(e){let t=null;if(e instanceof Ze)t=kt(e.result);else if(e instanceof Je){for(const r of e.args)if(t=kt(r),t)break}else(e instanceof Re||e instanceof We)&&e.input instanceof $&&"zoom"===e.input.name&&(t=e);return t instanceof h||e.eachChild((e=>{const r=kt(e);r instanceof h?t=r:!t&&r?t=new h("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&r&&t!==r&&(t=new h("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function zt(e,t){this.x=e,this.y=t}function jt(e){return null!=e}function Ht(e){var t;this.name="DeveloperError",this.message=e;try{throw new Error}catch(e){t=e.stack}this.stack=t}zt.prototype={clone:function(){return new zt(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=t*this.x-r*this.y,i=r*this.x+t*this.y;return this.x=n,this.y=i,this},_rotateAround:function(e,t){var r=Math.cos(e),n=Math.sin(e),i=t.x+r*(this.x-t.x)-n*(this.y-t.y),o=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},zt.convert=function(e){return e instanceof zt?e:Array.isArray(e)?new zt(e[0],e[1]):e},jt(Object.create)&&(Ht.prototype=Object.create(Error.prototype),Ht.prototype.constructor=Ht),Ht.prototype.toString=function(){var e=this.name+": "+this.message;return jt(this.stack)&&(e+="\n"+this.stack.toString()),e},Ht.throwInstantiationError=function(){throw new Ht("This function defines an interface and should not be called directly.")};var qt={};function Vt(e,t,r){return"Expected "+r+" to be typeof "+t+", actual typeof was "+e}function Yt(e,t){return null!=e?e:t}qt.typeOf={},qt.defined=function(e,t){if(!jt(t))throw new Ht(function(e){return e+" is required, actual value was undefined"}(e))},qt.typeOf.func=function(e,t){if("function"!=typeof t)throw new Ht(Vt(typeof t,"function",e))},qt.typeOf.string=function(e,t){if("string"!=typeof t)throw new Ht(Vt(typeof t,"string",e))},qt.typeOf.number=function(e,t){if("number"!=typeof t)throw new Ht(Vt(typeof t,"number",e))},qt.typeOf.number.lessThan=function(e,t,r){if(qt.typeOf.number(e,t),t>=r)throw new Ht("Expected "+e+" to be less than "+r+", actual value was "+t)},qt.typeOf.number.lessThanOrEquals=function(e,t,r){if(qt.typeOf.number(e,t),t>r)throw new Ht("Expected "+e+" to be less than or equal to "+r+", actual value was "+t)},qt.typeOf.number.greaterThan=function(e,t,r){if(qt.typeOf.number(e,t),t<=r)throw new Ht("Expected "+e+" to be greater than "+r+", actual value was "+t)},qt.typeOf.number.greaterThanOrEquals=function(e,t,r){if(qt.typeOf.number(e,t),t<r)throw new Ht("Expected "+e+" to be greater than or equal to"+r+", actual value was "+t)},qt.typeOf.object=function(e,t){if("object"!=typeof t)throw new Ht(Vt(typeof t,"object",e))},qt.typeOf.bool=function(e,t){if("boolean"!=typeof t)throw new Ht(Vt(typeof t,"boolean",e))},qt.typeOf.number.equals=function(e,t,r,n){if(qt.typeOf.number(e,r),qt.typeOf.number(t,n),r!==n)throw new Ht(e+" must be equal to "+t+", the actual values are "+r+" and "+n)},Yt.EMPTY_OBJECT=Object.freeze({});
/**
    @license

       Copyright (C) 1997 - 2002, Makoto Matsumoto and Takuji Nishimura,
       All rights reserved.

       Redistribution and use in source and binary forms, with or without
       modification, are permitted provided that the following conditions
       are met:

         1. Redistributions of source code must retain the above copyright
            notice, this list of conditions and the following disclaimer.

         2. Redistributions in binary form must reproduce the above copyright
            notice, this list of conditions and the following disclaimer in the
            documentation and/or other materials provided with the distribution.

         3. The names of its contributors may not be used to endorse or promote
            products derived from this software without specific prior written
            permission.

       THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
       "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
       LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
       A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
       CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
       EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
       PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
       PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
       LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
       NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
       SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
    */
var Xt=function(e){null==e&&(e=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_genrand(e)};Xt.prototype.init_genrand=function(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<this.N;this.mti++){e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+this.mti,this.mt[this.mti]>>>=0}},Xt.prototype.genrand_int32=function(){var e,t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var r;for(this.mti==this.N+1&&this.init_genrand(5489),r=0;r<this.N-this.M;r++)e=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+this.M]^e>>>1^t[1&e];for(;r<this.N-1;r++)e=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+(this.M-this.N)]^e>>>1^t[1&e];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[1&e],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,(e^=e>>>18)>>>0},Xt.prototype.random=function(){return this.genrand_int32()*(1/4294967296)};var Wt={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,EPSILON21:1e-21,GRAVITATIONALPARAMETER:3986004418e5,SOLAR_RADIUS:6955e5,LUNAR_RADIUS:1737400,SIXTY_FOUR_KILOBYTES:65536};Wt.sign=Yt(Math.sign,(function(e){return 0===(e=+e)||e!=e?e:e>0?1:-1})),Wt.signNotZero=function(e){return e<0?-1:1},Wt.toSNorm=function(e,t){return t=Yt(t,255),Math.round((.5*Wt.clamp(e,-1,1)+.5)*t)},Wt.fromSNorm=function(e,t){return t=Yt(t,255),Wt.clamp(e,0,t)/t*2-1},Wt.normalize=function(e,t,r){return 0===(r=Math.max(r-t,0))?0:Wt.clamp((e-t)/r,0,1)},Wt.sinh=Yt(Math.sinh,(function(e){return(Math.exp(e)-Math.exp(-e))/2})),Wt.cosh=Yt(Math.cosh,(function(e){return(Math.exp(e)+Math.exp(-e))/2})),Wt.lerp=function(e,t,r){return(1-r)*e+r*t},Wt.PI=Math.PI,Wt.ONE_OVER_PI=1/Math.PI,Wt.PI_OVER_TWO=Math.PI/2,Wt.PI_OVER_THREE=Math.PI/3,Wt.PI_OVER_FOUR=Math.PI/4,Wt.PI_OVER_SIX=Math.PI/6,Wt.THREE_PI_OVER_TWO=3*Math.PI/2,Wt.TWO_PI=2*Math.PI,Wt.ONE_OVER_TWO_PI=1/(2*Math.PI),Wt.RADIANS_PER_DEGREE=Math.PI/180,Wt.DEGREES_PER_RADIAN=180/Math.PI,Wt.RADIANS_PER_ARCSECOND=Wt.RADIANS_PER_DEGREE/3600,Wt.toRadians=function(e){if(!jt(e))throw new Ht("degrees is required.");return e*Wt.RADIANS_PER_DEGREE},Wt.toDegrees=function(e){if(!jt(e))throw new Ht("radians is required.");return e*Wt.DEGREES_PER_RADIAN},Wt.convertLongitudeRange=function(e){if(!jt(e))throw new Ht("angle is required.");var t=Wt.TWO_PI,r=e-Math.floor(e/t)*t;return r<-Math.PI?r+t:r>=Math.PI?r-t:r},Wt.clampToLatitudeRange=function(e){if(!jt(e))throw new Ht("angle is required.");return Wt.clamp(e,-1*Wt.PI_OVER_TWO,Wt.PI_OVER_TWO)},Wt.negativePiToPi=function(e){if(!jt(e))throw new Ht("angle is required.");return Wt.zeroToTwoPi(e+Wt.PI)-Wt.PI},Wt.zeroToTwoPi=function(e){if(!jt(e))throw new Ht("angle is required.");var t=Wt.mod(e,Wt.TWO_PI);return Math.abs(t)<Wt.EPSILON14&&Math.abs(e)>Wt.EPSILON14?Wt.TWO_PI:t},Wt.mod=function(e,t){if(!jt(e))throw new Ht("m is required.");if(!jt(t))throw new Ht("n is required.");return(e%t+t)%t},Wt.equalsEpsilon=function(e,t,r,n){if(!jt(e))throw new Ht("left is required.");if(!jt(t))throw new Ht("right is required.");if(!jt(r))throw new Ht("relativeEpsilon is required.");n=Yt(n,r);var i=Math.abs(e-t);return i<=n||i<=r*Math.max(Math.abs(e),Math.abs(t))},Wt.lessThan=function(e,t,r){if(!jt(e))throw new Ht("first is required.");if(!jt(t))throw new Ht("second is required.");if(!jt(r))throw new Ht("relativeEpsilon is required.");return e-t<-r},Wt.lessThanOrEquals=function(e,t,r){if(!jt(e))throw new Ht("first is required.");if(!jt(t))throw new Ht("second is required.");if(!jt(r))throw new Ht("relativeEpsilon is required.");return e-t<r},Wt.greaterThan=function(e,t,r){if(!jt(e))throw new Ht("first is required.");if(!jt(t))throw new Ht("second is required.");if(!jt(r))throw new Ht("relativeEpsilon is required.");return e-t>r},Wt.greaterThanOrEquals=function(e,t,r){if(!jt(e))throw new Ht("first is required.");if(!jt(t))throw new Ht("second is required.");if(!jt(r))throw new Ht("relativeEpsilon is required.");return e-t>-r};var Kt=[1];Wt.factorial=function(e){if("number"!=typeof e||e<0)throw new Ht("A number greater than or equal to 0 is required.");var t=Kt.length;if(e>=t)for(var r=Kt[t-1],n=t;n<=e;n++){var i=r*n;Kt.push(i),r=i}return Kt[e]},Wt.incrementWrap=function(e,t,r){if(r=Yt(r,0),!jt(e))throw new Ht("n is required.");if(t<=r)throw new Ht("maximumValue must be greater than minimumValue.");return++e>t&&(e=r),e},Wt.isPowerOfTwo=function(e){if("number"!=typeof e||e<0)throw new Ht("A number greater than or equal to 0 is required.");return 0!==e&&!(e&e-1)},Wt.nextPowerOfTwo=function(e){if("number"!=typeof e||e<0)throw new Ht("A number greater than or equal to 0 is required.");return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},Wt.clamp=function(e,t,r){if(!jt(e))throw new Ht("value is required");if(!jt(t))throw new Ht("min is required.");if(!jt(r))throw new Ht("max is required.");return e<t?t:e>r?r:e};var Jt=new Xt;function Zt(e,t,r){this.x=Yt(e,0),this.y=Yt(t,0),this.z=Yt(r,0)}Wt.setRandomNumberSeed=function(e){if(!jt(e))throw new Ht("seed is required.");Jt=new Xt(e)},Wt.nextRandomNumber=function(){return Jt.random()},Wt.randomBetween=function(e,t){return Wt.nextRandomNumber()*(t-e)+e},Wt.acosClamped=function(e){if(!jt(e))throw new Ht("value is required.");return Math.acos(Wt.clamp(e,-1,1))},Wt.asinClamped=function(e){if(!jt(e))throw new Ht("value is required.");return Math.asin(Wt.clamp(e,-1,1))},Wt.chordLength=function(e,t){if(!jt(e))throw new Ht("angle is required.");if(!jt(t))throw new Ht("radius is required.");return 2*t*Math.sin(.5*e)},Wt.logBase=function(e,t){if(!jt(e))throw new Ht("number is required.");if(!jt(t))throw new Ht("base is required.");return Math.log(e)/Math.log(t)},Wt.cbrt=Yt(Math.cbrt,(function(e){var t=Math.pow(Math.abs(e),1/3);return e<0?-t:t})),Wt.log2=Yt(Math.log2,(function(e){return Math.log(e)*Math.LOG2E})),Wt.fog=function(e,t){var r=e*t;return 1-Math.exp(-r*r)},Wt.fastApproximateAtan=function(e){return qt.typeOf.number("x",e),e*(-.1784*Math.abs(e)-.0663*e*e+1.0301)},Wt.fastApproximateAtan2=function(e,t){var r,n;qt.typeOf.number("x",e),qt.typeOf.number("y",t);var i=Math.abs(e);r=Math.abs(t),n=Math.max(i,r);var o=(r=Math.min(i,r))/n;if(isNaN(o))throw new Ht("either x or y must be nonzero");return i=Wt.fastApproximateAtan(o),i=Math.abs(t)>Math.abs(e)?Wt.PI_OVER_TWO-i:i,i=e<0?Wt.PI-i:i,i=t<0?-i:i},Zt.fromSpherical=function(e,t){qt.typeOf.object("spherical",e),jt(t)||(t=new Zt);var r=e.clock,n=e.cone,i=Yt(e.magnitude,1),o=i*Math.sin(n);return t.x=o*Math.cos(r),t.y=o*Math.sin(r),t.z=i*Math.cos(n),t},Zt.fromElements=function(e,t,r,n){return jt(n)?(n.x=e,n.y=t,n.z=r,n):new Zt(e,t,r)},Zt.clone=function(e,t){if(jt(e))return jt(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t):new Zt(e.x,e.y,e.z)},Zt.fromCartesian4=Zt.clone,Zt.packedLength=3,Zt.pack=function(e,t,r){return qt.typeOf.object("value",e),qt.defined("array",t),r=Yt(r,0),t[r++]=e.x,t[r++]=e.y,t[r]=e.z,t},Zt.unpack=function(e,t,r){return qt.defined("array",e),t=Yt(t,0),jt(r)||(r=new Zt),r.x=e[t++],r.y=e[t++],r.z=e[t],r},Zt.packArray=function(e,t){qt.defined("array",e);var r=e.length,n=3*r;if(jt(t)){if(!Array.isArray(t)&&t.length!==n)throw new Ht("If result is a typed array, it must have exactly array.length * 3 elements");t.length!==n&&(t.length=n)}else t=new Array(n);for(var i=0;i<r;++i)Zt.pack(e[i],t,3*i);return t},Zt.unpackArray=function(e,t){if(qt.defined("array",e),qt.typeOf.number.greaterThanOrEquals("array.length",e.length,3),e.length%3!=0)throw new Ht("array length must be a multiple of 3.");var r=e.length;jt(t)?t.length=r/3:t=new Array(r/3);for(var n=0;n<r;n+=3){var i=n/3;t[i]=Zt.unpack(e,n,t[i])}return t},Zt.fromArray=Zt.unpack,Zt.maximumComponent=function(e){return qt.typeOf.object("cartesian",e),Math.max(e.x,e.y,e.z)},Zt.minimumComponent=function(e){return qt.typeOf.object("cartesian",e),Math.min(e.x,e.y,e.z)},Zt.minimumByComponent=function(e,t,r){return qt.typeOf.object("first",e),qt.typeOf.object("second",t),qt.typeOf.object("result",r),r.x=Math.min(e.x,t.x),r.y=Math.min(e.y,t.y),r.z=Math.min(e.z,t.z),r},Zt.maximumByComponent=function(e,t,r){return qt.typeOf.object("first",e),qt.typeOf.object("second",t),qt.typeOf.object("result",r),r.x=Math.max(e.x,t.x),r.y=Math.max(e.y,t.y),r.z=Math.max(e.z,t.z),r},Zt.magnitudeSquared=function(e){return qt.typeOf.object("cartesian",e),e.x*e.x+e.y*e.y+e.z*e.z},Zt.magnitude=function(e){return Math.sqrt(Zt.magnitudeSquared(e))};var $t=new Zt;Zt.distance=function(e,t){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),Zt.subtract(e,t,$t),Zt.magnitude($t)},Zt.distanceSquared=function(e,t){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),Zt.subtract(e,t,$t),Zt.magnitudeSquared($t)},Zt.normalize=function(e,t){qt.typeOf.object("cartesian",e),qt.typeOf.object("result",t);var r=Zt.magnitude(e);if(0===r)return e;if(t.x=e.x/r,t.y=e.y/r,t.z=e.z/r,isNaN(t.x)||isNaN(t.y)||isNaN(t.z))throw new Ht("normalized result is not a number");return t},Zt.dot=function(e,t){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),e.x*t.x+e.y*t.y+e.z*t.z},Zt.multiplyComponents=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x*t.x,r.y=e.y*t.y,r.z=e.z*t.z,r},Zt.divideComponents=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x/t.x,r.y=e.y/t.y,r.z=e.z/t.z,r},Zt.add=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x+t.x,r.y=e.y+t.y,r.z=e.z+t.z,r},Zt.subtract=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x-t.x,r.y=e.y-t.y,r.z=e.z-t.z,r},Zt.multiplyByScalar=function(e,t,r){return qt.typeOf.object("cartesian",e),qt.typeOf.number("scalar",t),qt.typeOf.object("result",r),r.x=e.x*t,r.y=e.y*t,r.z=e.z*t,r},Zt.divideByScalar=function(e,t,r){return qt.typeOf.object("cartesian",e),qt.typeOf.number("scalar",t),qt.typeOf.object("result",r),r.x=e.x/t,r.y=e.y/t,r.z=e.z/t,r},Zt.negate=function(e,t){return qt.typeOf.object("cartesian",e),qt.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t},Zt.abs=function(e,t){return qt.typeOf.object("cartesian",e),qt.typeOf.object("result",t),t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t};var er=new Zt;Zt.lerp=function(e,t,r,n){return qt.typeOf.object("start",e),qt.typeOf.object("end",t),qt.typeOf.number("t",r),qt.typeOf.object("result",n),Zt.multiplyByScalar(t,r,er),n=Zt.multiplyByScalar(e,1-r,n),Zt.add(er,n,n)};var tr=new Zt,rr=new Zt;Zt.angleBetween=function(e,t){qt.typeOf.object("left",e),qt.typeOf.object("right",t),Zt.normalize(e,tr),Zt.normalize(t,rr);var r=Zt.dot(tr,rr),n=Zt.magnitude(Zt.cross(tr,rr,tr));return Math.atan2(n,r)};var nr=new Zt;Zt.mostOrthogonalAxis=function(e,t){qt.typeOf.object("cartesian",e),qt.typeOf.object("result",t);var r=Zt.normalize(e,nr);return Zt.abs(r,r),t=r.x<=r.y?r.x<=r.z?Zt.clone(Zt.UNIT_X,t):Zt.clone(Zt.UNIT_Z,t):r.y<=r.z?Zt.clone(Zt.UNIT_Y,t):Zt.clone(Zt.UNIT_Z,t)},Zt.projectVector=function(e,t,r){qt.defined("a",e),qt.defined("b",t),qt.defined("result",r);var n=Zt.dot(e,t)/Zt.dot(t,t);return Zt.multiplyByScalar(t,n,r)},Zt.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z},Zt.equalsArray=function(e,t,r){return e.x===t[r]&&e.y===t[r+1]&&e.z===t[r+2]},Zt.equalsEpsilon=function(e,t,r,n){return e===t||jt(e)&&jt(t)&&Wt.equalsEpsilon(e.x,t.x,r,n)&&Wt.equalsEpsilon(e.y,t.y,r,n)&&Wt.equalsEpsilon(e.z,t.z,r,n)},Zt.cross=function(e,t,r){qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r);var n=e.x,i=e.y,o=e.z,s=t.x,a=t.y,u=t.z,c=i*u-o*a,l=o*s-n*u,h=n*a-i*s;return r.x=c,r.y=l,r.z=h,r},Zt.midpoint=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=.5*(e.x+t.x),r.y=.5*(e.y+t.y),r.z=.5*(e.z+t.z),r},Zt.fromDegrees=function(e,t,r,n,i){return qt.typeOf.number("longitude",e),qt.typeOf.number("latitude",t),e=Wt.toRadians(e),t=Wt.toRadians(t),Zt.fromRadians(e,t,r,n,i)};var ir=new Zt,or=new Zt,sr=new Zt(40680631590769,40680631590769,40408299984661.445);Zt.fromRadians=function(e,t,r,n,i){qt.typeOf.number("longitude",e),qt.typeOf.number("latitude",t),r=Yt(r,0);var o=jt(n)?n.radiiSquared:sr,s=Math.cos(t);ir.x=s*Math.cos(e),ir.y=s*Math.sin(e),ir.z=Math.sin(t),ir=Zt.normalize(ir,ir),Zt.multiplyComponents(o,ir,or);var a=Math.sqrt(Zt.dot(ir,or));return or=Zt.divideByScalar(or,a,or),ir=Zt.multiplyByScalar(ir,r,ir),jt(i)||(i=new Zt),Zt.add(or,ir,i)},Zt.fromDegreesArray=function(e,t,r){if(qt.defined("coordinates",e),e.length<2||e.length%2!=0)throw new Ht("the number of coordinates must be a multiple of 2 and at least 2");var n=e.length;jt(r)?r.length=n/2:r=new Array(n/2);for(var i=0;i<n;i+=2){var o=e[i],s=e[i+1],a=i/2;r[a]=Zt.fromDegrees(o,s,0,t,r[a])}return r},Zt.fromRadiansArray=function(e,t,r){if(qt.defined("coordinates",e),e.length<2||e.length%2!=0)throw new Ht("the number of coordinates must be a multiple of 2 and at least 2");var n=e.length;jt(r)?r.length=n/2:r=new Array(n/2);for(var i=0;i<n;i+=2){var o=e[i],s=e[i+1],a=i/2;r[a]=Zt.fromRadians(o,s,0,t,r[a])}return r},Zt.fromDegreesArrayHeights=function(e,t,r){if(qt.defined("coordinates",e),e.length<3||e.length%3!=0)throw new Ht("the number of coordinates must be a multiple of 3 and at least 3");var n=e.length;jt(r)?r.length=n/3:r=new Array(n/3);for(var i=0;i<n;i+=3){var o=e[i],s=e[i+1],a=e[i+2],u=i/3;r[u]=Zt.fromDegrees(o,s,a,t,r[u])}return r},Zt.fromRadiansArrayHeights=function(e,t,r){if(qt.defined("coordinates",e),e.length<3||e.length%3!=0)throw new Ht("the number of coordinates must be a multiple of 3 and at least 3");var n=e.length;jt(r)?r.length=n/3:r=new Array(n/3);for(var i=0;i<n;i+=3){var o=e[i],s=e[i+1],a=e[i+2],u=i/3;r[u]=Zt.fromRadians(o,s,a,t,r[u])}return r},Zt.ZERO=Object.freeze(new Zt(0,0,0)),Zt.ONE=Object.freeze(new Zt(1,1,1)),Zt.UNIT_X=Object.freeze(new Zt(1,0,0)),Zt.UNIT_Y=Object.freeze(new Zt(0,1,0)),Zt.UNIT_Z=Object.freeze(new Zt(0,0,1)),Zt.UNIT_XYZ=Object.freeze(new Zt(1,1,1)),Zt.prototype.clone=function(e){return Zt.clone(this,e)},Zt.prototype.equals=function(e){return Zt.equals(this,e)},Zt.prototype.equalsEpsilon=function(e,t,r){return Zt.equalsEpsilon(this,e,t,r)},Zt.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},Zt.prototype.toArray=function(e,t){Zt.pack(this,e,t)},Zt.globalOffset=new Zt(0,0,0);var ar=new Zt,ur=new Zt;function cr(e,t,r,n,i){if(!jt(e))throw new Ht("cartesian is required.");if(!jt(t))throw new Ht("oneOverRadii is required.");if(!jt(r))throw new Ht("oneOverRadiiSquared is required.");if(!jt(n))throw new Ht("centerToleranceSquared is required.");var o=e.x,s=e.y,a=e.z,u=t.x,c=t.y,l=t.z,h=o*o*u*u,p=s*s*c*c,d=a*a*l*l,f=h+p+d,A=Math.sqrt(1/f),g=Zt.multiplyByScalar(e,A,ar);if(f<n)return isFinite(A)?Zt.clone(g,i):void 0;var _=r.x,m=r.y,y=r.z,E=ur;E.x=g.x*_*2,E.y=g.y*m*2,E.z=g.z*y*2;var x,C,b,I,T,v,R,M=(1-A)*Zt.magnitude(e)/(.5*Zt.magnitude(E)),w=0;do{w=(x=h*(T=(C=1/(1+(M-=w)*_))*C)+p*(v=(b=1/(1+M*m))*b)+d*(R=(I=1/(1+M*y))*I)-1)/(-2*(h*(T*C)*_+p*(v*b)*m+d*(R*I)*y))}while(Math.abs(x)>Wt.EPSILON12);return jt(i)?(i.x=o*C,i.y=s*b,i.z=a*I,i):new Zt(o*C,s*b,a*I)}function lr(e,t,r){this.longitude=Yt(e,0),this.latitude=Yt(t,0),this.height=Yt(r,0)}lr.fromRadians=function(e,t,r,n){return qt.typeOf.number("longitude",e),qt.typeOf.number("latitude",t),r=Yt(r,0),jt(n)?(n.longitude=e,n.latitude=t,n.height=r,n):new lr(e,t,r)},lr.fromDegrees=function(e,t,r,n){return qt.typeOf.number("longitude",e),qt.typeOf.number("latitude",t),e=Wt.toRadians(e),t=Wt.toRadians(t),lr.fromRadians(e,t,r,n)};var hr=new Zt,pr=new Zt,dr=new Zt,fr=new Zt(1/6378137,1/6378137,1/6356752.314245179),Ar=new Zt(1/40680631590769,1/40680631590769,1/40408299984661.445),gr=Wt.EPSILON1;function _r(e,t){this.x=Yt(e,0),this.y=Yt(t,0)}lr.fromCartesian=function(e,t,r){var n=jt(t)?t.oneOverRadii:fr,i=jt(t)?t.oneOverRadiiSquared:Ar,o=cr(e,n,i,jt(t)?t._centerToleranceSquared:gr,pr);if(jt(o)){var s=Zt.multiplyComponents(o,i,hr);s=Zt.normalize(s,s);var a=Zt.subtract(e,o,dr),u=Math.atan2(s.y,s.x),c=Math.asin(s.z),l=Wt.sign(Zt.dot(a,e))*Zt.magnitude(a);return jt(r)?(r.longitude=u,r.latitude=c,r.height=l,r):new lr(u,c,l)}},lr.toCartesian=function(e,t,r){return qt.defined("cartographic",e),Zt.fromRadians(e.longitude,e.latitude,e.height,t,r)},lr.sphericalDistance=function(e,t,r,n){if(qt.defined("longitudeA",e),qt.defined("longitudeB",r),qt.defined("latitudeA",t),qt.defined("latitudeB",n),e===r&&t===n)return 0;var i=Wt.toRadians(t),o=Wt.toRadians(n),s=Wt.toRadians(e),a=Wt.toRadians(r),u=s*s+i*i,c=a*a+o*o,l=(u+c-((s-a)*(s-a)+(i-o)*(i-o)))/(2*Math.sqrt(u)*Math.sqrt(c));return l=Wt.clamp(l,-1,1),6378137*Math.acos(l)},lr.clone=function(e,t){if(jt(e))return jt(t)?(t.longitude=e.longitude,t.latitude=e.latitude,t.height=e.height,t):new lr(e.longitude,e.latitude,e.height)},lr.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e.longitude===t.longitude&&e.latitude===t.latitude&&e.height===t.height},lr.equalsEpsilon=function(e,t,r){return qt.typeOf.number("epsilon",r),e===t||jt(e)&&jt(t)&&Math.abs(e.longitude-t.longitude)<=r&&Math.abs(e.latitude-t.latitude)<=r&&Math.abs(e.height-t.height)<=r},lr.ZERO=Object.freeze(new lr(0,0,0)),lr.prototype.clone=function(e){return lr.clone(this,e)},lr.prototype.equals=function(e){return lr.equals(this,e)},lr.prototype.equalsEpsilon=function(e,t){return lr.equalsEpsilon(this,e,t)},lr.prototype.toString=function(){return"("+this.longitude+", "+this.latitude+", "+this.height+")"},_r.fromElements=function(e,t,r){return jt(r)?(r.x=e,r.y=t,r):new _r(e,t)},_r.clone=function(e,t){if(jt(e))return jt(t)?(t.x=e.x,t.y=e.y,t):new _r(e.x,e.y)},_r.fromCartesian3=_r.clone,_r.fromCartesian4=_r.clone,_r.packedLength=2,_r.pack=function(e,t,r){return qt.typeOf.object("value",e),qt.defined("array",t),r=Yt(r,0),t[r++]=e.x,t[r]=e.y,t},_r.unpack=function(e,t,r){return qt.defined("array",e),t=Yt(t,0),jt(r)||(r=new _r),r.x=e[t++],r.y=e[t],r},_r.packArray=function(e,t){qt.defined("array",e);var r=e.length,n=2*r;if(jt(t)){if(!Array.isArray(t)&&t.length!==n)throw new Ht("If result is a typed array, it must have exactly array.length * 2 elements");t.length!==n&&(t.length=n)}else t=new Array(n);for(var i=0;i<r;++i)_r.pack(e[i],t,2*i);return t},_r.unpackArray=function(e,t){if(qt.defined("array",e),qt.typeOf.number.greaterThanOrEquals("array.length",e.length,2),e.length%2!=0)throw new Ht("array length must be a multiple of 2.");var r=e.length;jt(t)?t.length=r/2:t=new Array(r/2);for(var n=0;n<r;n+=2){var i=n/2;t[i]=_r.unpack(e,n,t[i])}return t},_r.fromArray=_r.unpack,_r.maximumComponent=function(e){return qt.typeOf.object("cartesian",e),Math.max(e.x,e.y)},_r.minimumComponent=function(e){return qt.typeOf.object("cartesian",e),Math.min(e.x,e.y)},_r.minimumByComponent=function(e,t,r){return qt.typeOf.object("first",e),qt.typeOf.object("second",t),qt.typeOf.object("result",r),r.x=Math.min(e.x,t.x),r.y=Math.min(e.y,t.y),r},_r.maximumByComponent=function(e,t,r){return qt.typeOf.object("first",e),qt.typeOf.object("second",t),qt.typeOf.object("result",r),r.x=Math.max(e.x,t.x),r.y=Math.max(e.y,t.y),r},_r.magnitudeSquared=function(e){return qt.typeOf.object("cartesian",e),e.x*e.x+e.y*e.y},_r.magnitude=function(e){return Math.sqrt(_r.magnitudeSquared(e))};var mr=new _r;_r.distance=function(e,t){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),_r.subtract(e,t,mr),_r.magnitude(mr)},_r.distanceSquared=function(e,t){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),_r.subtract(e,t,mr),_r.magnitudeSquared(mr)},_r.normalize=function(e,t){qt.typeOf.object("cartesian",e),qt.typeOf.object("result",t);var r=_r.magnitude(e);if(t.x=e.x/r,t.y=e.y/r,isNaN(t.x)||isNaN(t.y))throw new Ht("normalized result is not a number");return t},_r.dot=function(e,t){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),e.x*t.x+e.y*t.y},_r.multiplyComponents=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x*t.x,r.y=e.y*t.y,r},_r.divideComponents=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x/t.x,r.y=e.y/t.y,r},_r.add=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x+t.x,r.y=e.y+t.y,r},_r.subtract=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x-t.x,r.y=e.y-t.y,r},_r.multiplyByScalar=function(e,t,r){return qt.typeOf.object("cartesian",e),qt.typeOf.number("scalar",t),qt.typeOf.object("result",r),r.x=e.x*t,r.y=e.y*t,r},_r.divideByScalar=function(e,t,r){return qt.typeOf.object("cartesian",e),qt.typeOf.number("scalar",t),qt.typeOf.object("result",r),r.x=e.x/t,r.y=e.y/t,r},_r.negate=function(e,t){return qt.typeOf.object("cartesian",e),qt.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t},_r.abs=function(e,t){return qt.typeOf.object("cartesian",e),qt.typeOf.object("result",t),t.x=Math.abs(e.x),t.y=Math.abs(e.y),t};var yr=new _r;_r.lerp=function(e,t,r,n){return qt.typeOf.object("start",e),qt.typeOf.object("end",t),qt.typeOf.number("t",r),qt.typeOf.object("result",n),_r.multiplyByScalar(t,r,yr),n=_r.multiplyByScalar(e,1-r,n),_r.add(yr,n,n)};var Er=new _r,xr=new _r;_r.angleBetween=function(e,t){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),_r.normalize(e,Er),_r.normalize(t,xr),Wt.acosClamped(_r.dot(Er,xr))};var Cr=new _r;function br(e,t,r,n){this.x=Yt(e,0),this.y=Yt(t,0),this.z=Yt(r,0),this.w=Yt(n,0)}_r.mostOrthogonalAxis=function(e,t){qt.typeOf.object("cartesian",e),qt.typeOf.object("result",t);var r=_r.normalize(e,Cr);return _r.abs(r,r),t=r.x<=r.y?_r.clone(_r.UNIT_X,t):_r.clone(_r.UNIT_Y,t)},_r.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e.x===t.x&&e.y===t.y},_r.equalsArray=function(e,t,r){return e.x===t[r]&&e.y===t[r+1]},_r.equalsEpsilon=function(e,t,r,n){return e===t||jt(e)&&jt(t)&&Wt.equalsEpsilon(e.x,t.x,r,n)&&Wt.equalsEpsilon(e.y,t.y,r,n)},_r.ZERO=Object.freeze(new _r(0,0)),_r.UNIT_X=Object.freeze(new _r(1,0)),_r.UNIT_Y=Object.freeze(new _r(0,1)),_r.prototype.clone=function(e){return _r.clone(this,e)},_r.prototype.equals=function(e){return _r.equals(this,e)},_r.prototype.equalsEpsilon=function(e,t,r){return _r.equalsEpsilon(this,e,t,r)},_r.prototype.toString=function(){return"("+this.x+", "+this.y+")"},_r.prototype.toArray=function(e,t){_r.pack(this,e,t)},br.fromElements=function(e,t,r,n,i){return jt(i)?(i.x=e,i.y=t,i.z=r,i.w=n,i):new br(e,t,r,n)},br.fromColor=function(e,t){return qt.typeOf.object("color",e),jt(t)?(t.x=e.red,t.y=e.green,t.z=e.blue,t.w=e.alpha,t):new br(e.red,e.green,e.blue,e.alpha)},br.clone=function(e,t){if(jt(e))return jt(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t):new br(e.x,e.y,e.z,e.w)},br.packedLength=4,br.pack=function(e,t,r){return qt.typeOf.object("value",e),qt.defined("array",t),r=Yt(r,0),t[r++]=e.x,t[r++]=e.y,t[r++]=e.z,t[r]=e.w,t},br.unpack=function(e,t,r){return qt.defined("array",e),t=Yt(t,0),jt(r)||(r=new br),r.x=e[t++],r.y=e[t++],r.z=e[t++],r.w=e[t],r},br.packArray=function(e,t){qt.defined("array",e);var r=e.length,n=4*r;if(jt(t)){if(!Array.isArray(t)&&t.length!==n)throw new Ht("If result is a typed array, it must have exactly array.length * 4 elements");t.length!==n&&(t.length=n)}else t=new Array(n);for(var i=0;i<r;++i)br.pack(e[i],t,4*i);return t},br.unpackArray=function(e,t){if(qt.defined("array",e),qt.typeOf.number.greaterThanOrEquals("array.length",e.length,4),e.length%4!=0)throw new Ht("array length must be a multiple of 4.");var r=e.length;jt(t)?t.length=r/4:t=new Array(r/4);for(var n=0;n<r;n+=4){var i=n/4;t[i]=br.unpack(e,n,t[i])}return t},br.fromArray=br.unpack,br.maximumComponent=function(e){return qt.typeOf.object("cartesian",e),Math.max(e.x,e.y,e.z,e.w)},br.minimumComponent=function(e){return qt.typeOf.object("cartesian",e),Math.min(e.x,e.y,e.z,e.w)},br.minimumByComponent=function(e,t,r){return qt.typeOf.object("first",e),qt.typeOf.object("second",t),qt.typeOf.object("result",r),r.x=Math.min(e.x,t.x),r.y=Math.min(e.y,t.y),r.z=Math.min(e.z,t.z),r.w=Math.min(e.w,t.w),r},br.maximumByComponent=function(e,t,r){return qt.typeOf.object("first",e),qt.typeOf.object("second",t),qt.typeOf.object("result",r),r.x=Math.max(e.x,t.x),r.y=Math.max(e.y,t.y),r.z=Math.max(e.z,t.z),r.w=Math.max(e.w,t.w),r},br.magnitudeSquared=function(e){return qt.typeOf.object("cartesian",e),e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},br.magnitude=function(e){return Math.sqrt(br.magnitudeSquared(e))};var Ir=new br;br.distance=function(e,t){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),br.subtract(e,t,Ir),br.magnitude(Ir)},br.distanceSquared=function(e,t){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),br.subtract(e,t,Ir),br.magnitudeSquared(Ir)},br.normalize=function(e,t){qt.typeOf.object("cartesian",e),qt.typeOf.object("result",t);var r=br.magnitude(e);if(t.x=e.x/r,t.y=e.y/r,t.z=e.z/r,t.w=e.w/r,isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||isNaN(t.w))throw new Ht("normalized result is not a number");return t},br.dot=function(e,t){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},br.multiplyComponents=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x*t.x,r.y=e.y*t.y,r.z=e.z*t.z,r.w=e.w*t.w,r},br.divideComponents=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x/t.x,r.y=e.y/t.y,r.z=e.z/t.z,r.w=e.w/t.w,r},br.add=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x+t.x,r.y=e.y+t.y,r.z=e.z+t.z,r.w=e.w+t.w,r},br.subtract=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x-t.x,r.y=e.y-t.y,r.z=e.z-t.z,r.w=e.w-t.w,r},br.multiplyByScalar=function(e,t,r){return qt.typeOf.object("cartesian",e),qt.typeOf.number("scalar",t),qt.typeOf.object("result",r),r.x=e.x*t,r.y=e.y*t,r.z=e.z*t,r.w=e.w*t,r},br.divideByScalar=function(e,t,r){return qt.typeOf.object("cartesian",e),qt.typeOf.number("scalar",t),qt.typeOf.object("result",r),r.x=e.x/t,r.y=e.y/t,r.z=e.z/t,r.w=e.w/t,r},br.negate=function(e,t){return qt.typeOf.object("cartesian",e),qt.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},br.abs=function(e,t){return qt.typeOf.object("cartesian",e),qt.typeOf.object("result",t),t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t.w=Math.abs(e.w),t};var Tr=new br;br.lerp=function(e,t,r,n){return qt.typeOf.object("start",e),qt.typeOf.object("end",t),qt.typeOf.number("t",r),qt.typeOf.object("result",n),br.multiplyByScalar(t,r,Tr),n=br.multiplyByScalar(e,1-r,n),br.add(Tr,n,n)};var vr=new br;br.mostOrthogonalAxis=function(e,t){qt.typeOf.object("cartesian",e),qt.typeOf.object("result",t);var r=br.normalize(e,vr);return br.abs(r,r),t=r.x<=r.y?r.x<=r.z?r.x<=r.w?br.clone(br.UNIT_X,t):br.clone(br.UNIT_W,t):r.z<=r.w?br.clone(br.UNIT_Z,t):br.clone(br.UNIT_W,t):r.y<=r.z?r.y<=r.w?br.clone(br.UNIT_Y,t):br.clone(br.UNIT_W,t):r.z<=r.w?br.clone(br.UNIT_Z,t):br.clone(br.UNIT_W,t)},br.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},br.equalsArray=function(e,t,r){return e.x===t[r]&&e.y===t[r+1]&&e.z===t[r+2]&&e.w===t[r+3]},br.equalsEpsilon=function(e,t,r,n){return e===t||jt(e)&&jt(t)&&Wt.equalsEpsilon(e.x,t.x,r,n)&&Wt.equalsEpsilon(e.y,t.y,r,n)&&Wt.equalsEpsilon(e.z,t.z,r,n)&&Wt.equalsEpsilon(e.w,t.w,r,n)},br.ZERO=Object.freeze(new br(0,0,0,0)),br.UNIT_X=Object.freeze(new br(1,0,0,0)),br.UNIT_Y=Object.freeze(new br(0,1,0,0)),br.UNIT_Z=Object.freeze(new br(0,0,1,0)),br.UNIT_W=Object.freeze(new br(0,0,0,1)),br.prototype.clone=function(e){return br.clone(this,e)},br.prototype.equals=function(e){return br.equals(this,e)},br.prototype.equalsEpsilon=function(e,t,r){return br.equalsEpsilon(this,e,t,r)},br.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};var Rr=new Float32Array(1),Mr=256,wr=1/65536,Sr=1/16777216;function Br(e,t,r){qt.defined("array",e),qt.defined("itemToFind",t),qt.defined("comparator",r);for(var n,i,o=0,s=e.length-1;o<=s;)if((i=r(e[n=~~((o+s)/2)],t))<0)o=n+1;else{if(!(i>0))return n;s=n-1}return~(s+1)}function Or(e,t,r,n,i){this.xPoleWander=e,this.yPoleWander=t,this.xPoleOffset=r,this.yPoleOffset=n,this.ut1MinusUtc=i}function Dr(){var e=arguments,t=0,r=e[t++],n=function(e,t,r,n){r||(r=" ");var i=e.length>=t?"":Array(1+t-e.length>>>0).join(r);return n?e+i:i+e},i=function(e,t,r,i,o,s){var a=i-e.length;return a>0&&(e=r||!o?n(e,i,s,r):e.slice(0,t.length)+n("",a,"0",!0)+e.slice(t.length)),e},o=function(e,t,r,o,s,a,u){var c=e>>>0;return e=(r=r&&c&&{2:"0b",8:"0",16:"0x"}[t]||"")+n(c.toString(t),a||0,"0",!1),i(e,r,o,s,u)},s=function(e,t,r,n,o,s){return null!=n&&(e=e.slice(0,n)),i(e,"",t,r,o,s)};return r.replace(/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,(function(r,a,u,c,l,h,p){var d,f,A,g,_;if("%%"==r)return"%";for(var m=!1,y="",E=!1,x=!1,C=" ",b=u.length,I=0;u&&I<b;I++)switch(u.charAt(I)){case" ":y=" ";break;case"+":y="+";break;case"-":m=!0;break;case"'":C=u.charAt(I+1);break;case"0":E=!0;break;case"#":x=!0}if((c=c?"*"==c?+e[t++]:"*"==c.charAt(0)?+e[c.slice(1,-1)]:+c:0)<0&&(c=-c,m=!0),!isFinite(c))throw new Error("sprintf: (minimum-)width must be finite");switch(h=h?"*"==h?+e[t++]:"*"==h.charAt(0)?+e[h.slice(1,-1)]:+h:"fFeE".indexOf(p)>-1?6:"d"==p?0:void 0,_=a?e[a.slice(0,-1)]:e[t++],p){case"s":return s(String(_),m,c,h,E,C);case"c":return s(String.fromCharCode(+_),m,c,h,E);case"b":return o(_,2,x,m,c,h,E);case"o":return o(_,8,x,m,c,h,E);case"x":return o(_,16,x,m,c,h,E);case"X":return o(_,16,x,m,c,h,E).toUpperCase();case"u":return o(_,10,x,m,c,h,E);case"i":case"d":return d=+_||0,_=(f=(d=Math.round(d-d%1))<0?"-":y)+n(String(Math.abs(d)),h,"0",!1),i(_,f,m,c,E);case"e":case"E":case"f":case"F":case"g":case"G":return f=(d=+_)<0?"-":y,A=["toExponential","toFixed","toPrecision"]["efg".indexOf(p.toLowerCase())],g=["toString","toUpperCase"]["eEfFgG".indexOf(p)%2],_=f+Math.abs(d)[A](h),i(_,f,m,c,E)[g]();default:return r}}))}function Fr(e,t,r,n,i,o,s,a){this.year=e,this.month=t,this.day=r,this.hour=n,this.minute=i,this.second=o,this.millisecond=s,this.isLeapSecond=a}function Pr(e){if(null===e||isNaN(e))throw new Ht("year is required and must be a number.");return e%4==0&&e%100!=0||e%400==0}function Nr(e,t){this.julianDate=e,this.offset=t}br.packFloat=function(e,t){if(qt.typeOf.number("value",e),jt(t)||(t=new br),Rr[0]=e,0===(e=Rr[0]))return br.clone(br.ZERO,t);var r,n=e<0?1:0;isFinite(e)?(e=Math.abs(e),r=Math.floor(Wt.logBase(e,10))+1,e/=Math.pow(10,r)):(e=.1,r=38);var i=e*Mr;return t.x=Math.floor(i),i=(i-t.x)*Mr,t.y=Math.floor(i),i=(i-t.y)*Mr,t.z=Math.floor(i),t.w=2*(r+38)+n,t},br.unpackFloat=function(e){qt.typeOf.object("packedFloat",e);var t=e.w/2,r=Math.floor(t),n=2*(t-r);if(n=-(n=2*n-1),(r-=38)>=38)return n<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;var i=n*e.x*.00390625;return i+=n*e.y*wr,(i+=n*e.z*Sr)*Math.pow(10,r)},br.prototype.toArray=function(e,t){br.pack(this,e,t)};var Lr=Object.freeze({SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5}),Ur=Object.freeze({UTC:0,TAI:1}),Gr=new Fr,Qr=[31,28,31,30,31,30,31,31,30,31,30,31];function kr(e,t){return nn.compare(e.julianDate,t.julianDate)}var zr=new Nr;function jr(e){zr.julianDate=e;var t=nn.leapSeconds,r=Br(t,zr,kr);r<0&&(r=~r),r>=t.length&&(r=t.length-1);var n=t[r].offset;r>0&&(nn.secondsDifference(t[r].julianDate,e)>n&&(n=t[--r].offset));nn.addSeconds(e,n,e)}function Hr(e,t){zr.julianDate=e;var r=nn.leapSeconds,n=Br(r,zr,kr);if(n<0&&(n=~n),0===n)return nn.addSeconds(e,-r[0].offset,t);if(n>=r.length)return nn.addSeconds(e,-r[n-1].offset,t);var i=nn.secondsDifference(r[n].julianDate,e);return 0===i?nn.addSeconds(e,-r[n].offset,t):i<=1?void 0:nn.addSeconds(e,-r[--n].offset,t)}function qr(e,t,r){var n=t/Lr.SECONDS_PER_DAY|0;return e+=n,(t-=Lr.SECONDS_PER_DAY*n)<0&&(e--,t+=Lr.SECONDS_PER_DAY),r.dayNumber=e,r.secondsOfDay=t,r}function Vr(e,t,r,n,i,o,s){var a=(t-14)/12|0,u=e+4800+a,c=(1461*u/4|0)+(367*(t-2-12*a)/12|0)-(3*((u+100)/100|0)/4|0)+r-32075;(n-=12)<0&&(n+=24);var l=o+(n*Lr.SECONDS_PER_HOUR+i*Lr.SECONDS_PER_MINUTE+s*Lr.SECONDS_PER_MILLISECOND);return l>=43200&&(c-=1),[c,l]}var Yr=/^(\d{4})$/,Xr=/^(\d{4})-(\d{2})$/,Wr=/^(\d{4})-?(\d{3})$/,Kr=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,Jr=/^(\d{4})-?(\d{2})-?(\d{2})$/,Zr=/([Z+\-])?(\d{2})?:?(\d{2})?$/,$r=/^(\d{2})(\.\d+)?/.source+Zr.source,en=/^(\d{2}):?(\d{2})(\.\d+)?/.source+Zr.source,tn=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+Zr.source,rn="Invalid ISO 8601 date.";function nn(e,t,r){this.dayNumber=void 0,this.secondsOfDay=void 0,e=Yt(e,0),t=Yt(t,0),r=Yt(r,Ur.UTC);var n=0|e;qr(n,t+=(e-n)*Lr.SECONDS_PER_DAY,this),r===Ur.UTC&&jr(this)}nn.fromGregorianDate=function(e,t){if(!(e instanceof Fr))throw new Ht("date must be a valid GregorianDate.");var r=Vr(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond);return jt(t)?(qr(r[0],r[1],t),jr(t),t):new nn(r[0],r[1],Ur.UTC)},nn.fromDate=function(e,t){if(!(e instanceof Date)||isNaN(e.getTime()))throw new Ht("date must be a valid JavaScript Date.");var r=Vr(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds());return jt(t)?(qr(r[0],r[1],t),jr(t),t):new nn(r[0],r[1],Ur.UTC)},nn.fromIso8601=function(e,t){if("string"!=typeof e)throw new Ht(rn);var r,n,i,o,s,a=(e=e.replace(",",".")).split("T"),u=1,c=1,l=0,h=0,p=0,d=0,f=a[0],A=a[1];if(!jt(f))throw new Ht(rn);if(null!==(a=f.match(Jr))){if((o=f.split("-").length-1)>0&&2!==o)throw new Ht(rn);r=+a[1],u=+a[2],c=+a[3]}else if(null!==(a=f.match(Xr)))r=+a[1],u=+a[2];else if(null!==(a=f.match(Yr)))r=+a[1];else{var g;if(null!==(a=f.match(Wr))){if(r=+a[1],g=+a[2],i=Pr(r),g<1||i&&g>366||!i&&g>365)throw new Ht(rn)}else{if(null===(a=f.match(Kr)))throw new Ht(rn);r=+a[1];var _=+a[2],m=+a[3]||0;if((o=f.split("-").length-1)>0&&(!jt(a[3])&&1!==o||jt(a[3])&&2!==o))throw new Ht(rn);g=7*_+m-new Date(Date.UTC(r,0,4)).getUTCDay()-3}(n=new Date(Date.UTC(r,0,1))).setUTCDate(g),u=n.getUTCMonth()+1,c=n.getUTCDate()}if(i=Pr(r),u<1||u>12||c<1||(2!==u||!i)&&c>Qr[u-1]||i&&2===u&&c>29)throw new Ht(rn);if(jt(A)){if(null!==(a=A.match(tn))){if((o=A.split(":").length-1)>0&&2!==o&&3!==o)throw new Ht(rn);l=+a[1],h=+a[2],p=+a[3],d=1e3*+(a[4]||0),s=5}else if(null!==(a=A.match(en))){if((o=A.split(":").length-1)>2)throw new Ht(rn);l=+a[1],h=+a[2],p=60*+(a[3]||0),s=4}else{if(null===(a=A.match($r)))throw new Ht(rn);l=+a[1],h=60*+(a[2]||0),s=3}if(h>=60||p>=61||l>24||24===l&&(h>0||p>0||d>0))throw new Ht(rn);var y=a[s],E=+a[s+1],x=+(a[s+2]||0);switch(y){case"+":l-=E,h-=x;break;case"-":l+=E,h+=x;break;case"Z":break;default:h+=new Date(Date.UTC(r,u-1,c,l,h)).getTimezoneOffset()}}var C=60===p;for(C&&p--;h>=60;)h-=60,l++;for(;l>=24;)l-=24,c++;for(n=i&&2===u?29:Qr[u-1];c>n;)c-=n,++u>12&&(u-=12,r++),n=i&&2===u?29:Qr[u-1];for(;h<0;)h+=60,l--;for(;l<0;)l+=24,c--;for(;c<1;)--u<1&&(u+=12,r--),c+=n=i&&2===u?29:Qr[u-1];var b=Vr(r,u,c,l,h,p,d);return jt(t)?(qr(b[0],b[1],t),jr(t)):t=new nn(b[0],b[1],Ur.UTC),C&&nn.addSeconds(t,1,t),t},nn.now=function(e){return nn.fromDate(new Date,e)};var on=new nn(0,0,Ur.TAI);nn.toGregorianDate=function(e,t){if(!jt(e))throw new Ht("julianDate is required.");var r=!1,n=Hr(e,on);jt(n)||(nn.addSeconds(e,-1,on),n=Hr(on,on),r=!0);var i=n.dayNumber,o=n.secondsOfDay;o>=43200&&(i+=1);var s=i+68569|0,a=4*s/146097|0,u=4e3*((s=s-((146097*a+3)/4|0)|0)+1)/1461001|0,c=80*(s=s-(1461*u/4|0)+31|0)/2447|0,l=s-(2447*c/80|0)|0,h=c+2-12*(s=c/11|0)|0,p=100*(a-49)+u+s|0,d=o/Lr.SECONDS_PER_HOUR|0,f=o-d*Lr.SECONDS_PER_HOUR,A=f/Lr.SECONDS_PER_MINUTE|0,g=0|(f-=A*Lr.SECONDS_PER_MINUTE),_=(f-g)/Lr.SECONDS_PER_MILLISECOND;return(d+=12)>23&&(d-=24),r&&(g+=1),jt(t)?(t.year=p,t.month=h,t.day=l,t.hour=d,t.minute=A,t.second=g,t.millisecond=_,t.isLeapSecond=r,t):new Fr(p,h,l,d,A,g,_,r)},nn.toDate=function(e){if(!jt(e))throw new Ht("julianDate is required.");var t=nn.toGregorianDate(e,Gr),r=t.second;return t.isLeapSecond&&(r-=1),new Date(Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,r,t.millisecond))},nn.toIso8601=function(e,t){if(!jt(e))throw new Ht("julianDate is required.");var r=nn.toGregorianDate(e,Gr),n=r.year,i=r.month,o=r.day,s=r.hour,a=r.minute,u=r.second,c=r.millisecond;return 1e4===n&&1===i&&1===o&&0===s&&0===a&&0===u&&0===c&&(n=9999,i=12,o=31,s=24),jt(t)||0===c?jt(t)&&0!==t?Dr("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",n,i,o,s,a,u,(.01*c).toFixed(t).replace(".","").slice(0,t)):Dr("%04d-%02d-%02dT%02d:%02d:%02dZ",n,i,o,s,a,u):Dr("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",n,i,o,s,a,u,(.01*c).toString().replace(".",""))},nn.clone=function(e,t){if(jt(e))return jt(t)?(t.dayNumber=e.dayNumber,t.secondsOfDay=e.secondsOfDay,t):new nn(e.dayNumber,e.secondsOfDay,Ur.TAI)},nn.compare=function(e,t){if(!jt(e))throw new Ht("left is required.");if(!jt(t))throw new Ht("right is required.");var r=e.dayNumber-t.dayNumber;return 0!==r?r:e.secondsOfDay-t.secondsOfDay},nn.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e.dayNumber===t.dayNumber&&e.secondsOfDay===t.secondsOfDay},nn.equalsEpsilon=function(e,t,r){if(!jt(r))throw new Ht("epsilon is required.");return e===t||jt(e)&&jt(t)&&Math.abs(nn.secondsDifference(e,t))<=r},nn.totalDays=function(e){if(!jt(e))throw new Ht("julianDate is required.");return e.dayNumber+e.secondsOfDay/Lr.SECONDS_PER_DAY},nn.secondsDifference=function(e,t){if(!jt(e))throw new Ht("left is required.");if(!jt(t))throw new Ht("right is required.");return(e.dayNumber-t.dayNumber)*Lr.SECONDS_PER_DAY+(e.secondsOfDay-t.secondsOfDay)},nn.daysDifference=function(e,t){if(!jt(e))throw new Ht("left is required.");if(!jt(t))throw new Ht("right is required.");return e.dayNumber-t.dayNumber+(e.secondsOfDay-t.secondsOfDay)/Lr.SECONDS_PER_DAY},nn.computeTaiMinusUtc=function(e){zr.julianDate=e;var t=nn.leapSeconds,r=Br(t,zr,kr);return r<0&&(r=~r,--r<0&&(r=0)),t[r].offset},nn.addSeconds=function(e,t,r){if(!jt(e))throw new Ht("julianDate is required.");if(!jt(t))throw new Ht("seconds is required.");if(!jt(r))throw new Ht("result is required.");return qr(e.dayNumber,e.secondsOfDay+t,r)},nn.addMinutes=function(e,t,r){if(!jt(e))throw new Ht("julianDate is required.");if(!jt(t))throw new Ht("minutes is required.");if(!jt(r))throw new Ht("result is required.");var n=e.secondsOfDay+t*Lr.SECONDS_PER_MINUTE;return qr(e.dayNumber,n,r)},nn.addHours=function(e,t,r){if(!jt(e))throw new Ht("julianDate is required.");if(!jt(t))throw new Ht("hours is required.");if(!jt(r))throw new Ht("result is required.");var n=e.secondsOfDay+t*Lr.SECONDS_PER_HOUR;return qr(e.dayNumber,n,r)},nn.addDays=function(e,t,r){if(!jt(e))throw new Ht("julianDate is required.");if(!jt(t))throw new Ht("days is required.");if(!jt(r))throw new Ht("result is required.");return qr(e.dayNumber+t,e.secondsOfDay,r)},nn.lessThan=function(e,t){return nn.compare(e,t)<0},nn.lessThanOrEquals=function(e,t){return nn.compare(e,t)<=0},nn.greaterThan=function(e,t){return nn.compare(e,t)>0},nn.greaterThanOrEquals=function(e,t){return nn.compare(e,t)>=0},nn.prototype.clone=function(e){return nn.clone(this,e)},nn.prototype.equals=function(e){return nn.equals(this,e)},nn.prototype.equalsEpsilon=function(e,t){return nn.equalsEpsilon(this,e,t)},nn.prototype.toString=function(){return nn.toIso8601(this)},nn.leapSeconds=[new Nr(new nn(2441317,43210,Ur.TAI),10),new Nr(new nn(2441499,43211,Ur.TAI),11),new Nr(new nn(2441683,43212,Ur.TAI),12),new Nr(new nn(2442048,43213,Ur.TAI),13),new Nr(new nn(2442413,43214,Ur.TAI),14),new Nr(new nn(2442778,43215,Ur.TAI),15),new Nr(new nn(2443144,43216,Ur.TAI),16),new Nr(new nn(2443509,43217,Ur.TAI),17),new Nr(new nn(2443874,43218,Ur.TAI),18),new Nr(new nn(2444239,43219,Ur.TAI),19),new Nr(new nn(2444786,43220,Ur.TAI),20),new Nr(new nn(2445151,43221,Ur.TAI),21),new Nr(new nn(2445516,43222,Ur.TAI),22),new Nr(new nn(2446247,43223,Ur.TAI),23),new Nr(new nn(2447161,43224,Ur.TAI),24),new Nr(new nn(2447892,43225,Ur.TAI),25),new Nr(new nn(2448257,43226,Ur.TAI),26),new Nr(new nn(2448804,43227,Ur.TAI),27),new Nr(new nn(2449169,43228,Ur.TAI),28),new Nr(new nn(2449534,43229,Ur.TAI),29),new Nr(new nn(2450083,43230,Ur.TAI),30),new Nr(new nn(2450630,43231,Ur.TAI),31),new Nr(new nn(2451179,43232,Ur.TAI),32),new Nr(new nn(2453736,43233,Ur.TAI),33),new Nr(new nn(2454832,43234,Ur.TAI),34),new Nr(new nn(2456109,43235,Ur.TAI),35),new Nr(new nn(2457204,43236,Ur.TAI),36),new Nr(new nn(2457754,43237,Ur.TAI),37)];var sn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function an(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var un,cn={exports:{}},ln={exports:{}},hn=ln.exports;var pn,dn={exports:{}},An=dn.exports;
/*!
     * URI.js - Mutating URLs
     * IPv6 Support
     *
     * Version: 1.19.11
     *
     * Author: Rodney Rehm
     * Web: http://medialize.github.io/URI.js/
     *
     * Licensed under
     *   MIT License http://www.opensource.org/licenses/mit-license
     *
     */var gn,_n={exports:{}},mn=_n.exports;
/*!
     * URI.js - Mutating URLs
     * Second Level Domain (SLD) Support
     *
     * Version: 1.19.11
     *
     * Author: Rodney Rehm
     * Web: http://medialize.github.io/URI.js/
     *
     * Licensed under
     *   MIT License http://www.opensource.org/licenses/mit-license
     *
     */
/*!
     * URI.js - Mutating URLs
     *
     * Version: 1.19.11
     *
     * Author: Rodney Rehm
     * Web: http://medialize.github.io/URI.js/
     *
     * Licensed under
     *   MIT License http://www.opensource.org/licenses/mit-license
     *
     */
var yn,En=cn.exports;var xn=(yn||(yn=1,function(e){var t,r;t=En,r=function(e,t,r,n){var i=n&&n.URI;function o(e,t){var r=arguments.length>=1;if(!(this instanceof o))return r?arguments.length>=2?new o(e,t):new o(e):new o;if(void 0===e){if(r)throw new TypeError("undefined is not a valid argument for URI");e="undefined"!=typeof location?location.href+"":""}if(null===e&&r)throw new TypeError("null is not a valid argument for URI");return this.href(e),void 0!==t?this.absoluteTo(t):this}o.version="1.19.11";var s=o.prototype,a=Object.prototype.hasOwnProperty;function u(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function c(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function l(e){return"Array"===c(e)}function h(e,t){var r,n,i={};if("RegExp"===c(t))i=null;else if(l(t))for(r=0,n=t.length;r<n;r++)i[t[r]]=!0;else i[t]=!0;for(r=0,n=e.length;r<n;r++)(i&&void 0!==i[e[r]]||!i&&t.test(e[r]))&&(e.splice(r,1),n--,r--);return e}function p(e,t){var r,n;if(l(t)){for(r=0,n=t.length;r<n;r++)if(!p(e,t[r]))return!1;return!0}var i=c(t);for(r=0,n=e.length;r<n;r++)if("RegExp"===i){if("string"==typeof e[r]&&e[r].match(t))return!0}else if(e[r]===t)return!0;return!1}function d(e,t){if(!l(e)||!l(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function f(e){return e.replace(/^\/+|\/+$/g,"")}function A(e){return escape(e)}function g(e){return encodeURIComponent(e).replace(/[!'()*]/g,A).replace(/\*/g,"%2A")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?]))/gi,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();if("input"!==t||"image"===e.type)return o.domAttributes[t]}},o.encode=g,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=g,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(e,t){var r=o.encode(e+"");return void 0===t&&(t=o.escapeQuerySpace),t?r.replace(/%20/g,"+"):r},o.decodeQuery=function(e,t){e+="",void 0===t&&(t=o.escapeQuerySpace);try{return o.decode(t?e.replace(/\+/g,"%20"):e)}catch(t){return e}};var _,m={encode:"encode",decode:"decode"},y=function(e,t){return function(r){try{return o[t](r+"").replace(o.characters[e][t].expression,(function(r){return o.characters[e][t].map[r]}))}catch(e){return r}}};for(_ in m)o[_+"PathSegment"]=y("pathname",m[_]),o[_+"UrnPathSegment"]=y("urnpath",m[_]);var E=function(e,t,r){return function(n){var i;i=r?function(e){return o[t](o[r](e))}:o[t];for(var s=(n+"").split(e),a=0,u=s.length;a<u;a++)s[a]=i(s[a]);return s.join(e)}};function x(e){return function(t,r){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!r),this)}}function C(e,t){return function(r,n){return void 0===r?this._parts[e]||"":(null!==r&&(r+="").charAt(0)===t&&(r=r.substring(1)),this._parts[e]=r,this.build(!n),this)}}o.decodePath=E("/","decodePathSegment"),o.decodeUrnPath=E(":","decodeUrnPathSegment"),o.recodePath=E("/","encodePathSegment","decode"),o.recodeUrnPath=E(":","encodeUrnPathSegment","decode"),o.encodeReserved=y("reserved","encode"),o.parse=function(e,t){var r;return t||(t={preventInvalidHostname:o.preventInvalidHostname}),(r=(e=(e=e.replace(o.leading_whitespace_expression,"")).replace(o.ascii_tab_whitespace,"")).indexOf("#"))>-1&&(t.fragment=e.substring(r+1)||null,e=e.substring(0,r)),(r=e.indexOf("?"))>-1&&(t.query=e.substring(r+1)||null,e=e.substring(0,r)),"//"===(e=(e=e.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://")).replace(/^[/\\]{2,}/i,"//")).substring(0,2)?(t.protocol=null,e=e.substring(2),e=o.parseAuthority(e,t)):(r=e.indexOf(":"))>-1&&(t.protocol=e.substring(0,r)||null,t.protocol&&!t.protocol.match(o.protocol_expression)?t.protocol=void 0:"//"===e.substring(r+1,r+3).replace(/\\/g,"/")?(e=e.substring(r+3),e=o.parseAuthority(e,t)):(e=e.substring(r+1),t.urn=!0)),t.path=e,t},o.parseHost=function(e,t){e||(e="");var r,n,i=(e=e.replace(/\\/g,"/")).indexOf("/");if(-1===i&&(i=e.length),"["===e.charAt(0))r=e.indexOf("]"),t.hostname=e.substring(1,r)||null,t.port=e.substring(r+2,i)||null,"/"===t.port&&(t.port=null);else{var s=e.indexOf(":"),a=e.indexOf("/"),u=e.indexOf(":",s+1);-1!==u&&(-1===a||u<a)?(t.hostname=e.substring(0,i)||null,t.port=null):(n=e.substring(0,i).split(":"),t.hostname=n[0]||null,t.port=n[1]||null)}return t.hostname&&"/"!==e.substring(i).charAt(0)&&(i++,e="/"+e),t.preventInvalidHostname&&o.ensureValidHostname(t.hostname,t.protocol),t.port&&o.ensureValidPort(t.port),e.substring(i)||"/"},o.parseAuthority=function(e,t){return e=o.parseUserinfo(e,t),o.parseHost(e,t)},o.parseUserinfo=function(e,t){var r=e;-1!==e.indexOf("\\")&&(e=e.replace(/\\/g,"/"));var n,i=e.indexOf("/"),s=e.lastIndexOf("@",i>-1?i:e.length-1);return s>-1&&(-1===i||s<i)?(n=e.substring(0,s).split(":"),t.username=n[0]?o.decode(n[0]):null,n.shift(),t.password=n[0]?o.decode(n.join(":")):null,e=r.substring(s+1)):(t.username=null,t.password=null),e},o.parseQuery=function(e,t){if(!e)return{};if(!(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var r,n,i,s={},u=e.split("&"),c=u.length,l=0;l<c;l++)r=u[l].split("="),n=o.decodeQuery(r.shift(),t),i=r.length?o.decodeQuery(r.join("="),t):null,"__proto__"!==n&&(a.call(s,n)?("string"!=typeof s[n]&&null!==s[n]||(s[n]=[s[n]]),s[n].push(i)):s[n]=i);return s},o.build=function(e){var t="",r=!1;return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//",r=!0),t+=o.buildAuthority(e)||"","string"==typeof e.path&&("/"!==e.path.charAt(0)&&r&&(t+="/"),t+=e.path),"string"==typeof e.query&&e.query&&(t+="?"+e.query),"string"==typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},o.buildHost=function(e){var t="";return e.hostname?(o.ip6_expression.test(e.hostname)?t+="["+e.hostname+"]":t+=e.hostname,e.port&&(t+=":"+e.port),t):""},o.buildAuthority=function(e){return o.buildUserinfo(e)+o.buildHost(e)},o.buildUserinfo=function(e){var t="";return e.username&&(t+=o.encode(e.username)),e.password&&(t+=":"+o.encode(e.password)),t&&(t+="@"),t},o.buildQuery=function(e,t,r){var n,i,s,u,c="";for(i in e)if("__proto__"!==i&&a.call(e,i))if(l(e[i]))for(n={},s=0,u=e[i].length;s<u;s++)void 0!==e[i][s]&&void 0===n[e[i][s]+""]&&(c+="&"+o.buildQueryParameter(i,e[i][s],r),!0!==t&&(n[e[i][s]+""]=!0));else void 0!==e[i]&&(c+="&"+o.buildQueryParameter(i,e[i],r));return c.substring(1)},o.buildQueryParameter=function(e,t,r){return o.encodeQuery(e,r)+(null!==t?"="+o.encodeQuery(t,r):"")},o.addQuery=function(e,t,r){if("object"==typeof t)for(var n in t)a.call(t,n)&&o.addQuery(e,n,t[n]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t])return void(e[t]=r);"string"==typeof e[t]&&(e[t]=[e[t]]),l(r)||(r=[r]),e[t]=(e[t]||[]).concat(r)}},o.setQuery=function(e,t,r){if("object"==typeof t)for(var n in t)a.call(t,n)&&o.setQuery(e,n,t[n]);else{if("string"!=typeof t)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");e[t]=void 0===r?null:r}},o.removeQuery=function(e,t,r){var n,i,s;if(l(t))for(n=0,i=t.length;n<i;n++)e[t[n]]=void 0;else if("RegExp"===c(t))for(s in e)t.test(s)&&(e[s]=void 0);else if("object"==typeof t)for(s in t)a.call(t,s)&&o.removeQuery(e,s,t[s]);else{if("string"!=typeof t)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==r?"RegExp"===c(r)?!l(e[t])&&r.test(e[t])?e[t]=void 0:e[t]=h(e[t],r):e[t]!==String(r)||l(r)&&1!==r.length?l(e[t])&&(e[t]=h(e[t],r)):e[t]=void 0:e[t]=void 0}},o.hasQuery=function(e,t,r,n){switch(c(t)){case"String":break;case"RegExp":for(var i in e)if(a.call(e,i)&&t.test(i)&&(void 0===r||o.hasQuery(e,i,r)))return!0;return!1;case"Object":for(var s in t)if(a.call(t,s)&&!o.hasQuery(e,s,t[s]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(c(r)){case"Undefined":return t in e;case"Boolean":return r===Boolean(l(e[t])?e[t].length:e[t]);case"Function":return!!r(e[t],t,e);case"Array":return!!l(e[t])&&(n?p:d)(e[t],r);case"RegExp":return l(e[t])?!!n&&p(e[t],r):Boolean(e[t]&&e[t].match(r));case"Number":r=String(r);case"String":return l(e[t])?!!n&&p(e[t],r):e[t]===r;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var e=[],t=[],r=0,n=0;n<arguments.length;n++){var i=new o(arguments[n]);e.push(i);for(var s=i.segment(),a=0;a<s.length;a++)"string"==typeof s[a]&&t.push(s[a]),s[a]&&r++}if(!t.length||!r)return new o("");var u=new o("").segment(t);return""!==e[0].path()&&"/"!==e[0].path().slice(0,1)||u.path("/"+u.path()),u.normalize()},o.commonPath=function(e,t){var r,n=Math.min(e.length,t.length);for(r=0;r<n;r++)if(e.charAt(r)!==t.charAt(r)){r--;break}return r<1?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":("/"===e.charAt(r)&&"/"===t.charAt(r)||(r=e.substring(0,r).lastIndexOf("/")),e.substring(0,r+1))},o.withinString=function(e,t,r){r||(r={});var n=r.start||o.findUri.start,i=r.end||o.findUri.end,s=r.trim||o.findUri.trim,a=r.parens||o.findUri.parens,u=/[a-z0-9-]=["']?$/i;for(n.lastIndex=0;;){var c=n.exec(e);if(!c)break;var l=c.index;if(r.ignoreHtml){var h=e.slice(Math.max(l-3,0),l);if(h&&u.test(h))continue}for(var p=l+e.slice(l).search(i),d=e.slice(l,p),f=-1;;){var A=a.exec(d);if(!A)break;var g=A.index+A[0].length;f=Math.max(f,g)}if(!((d=f>-1?d.slice(0,f)+d.slice(f).replace(s,""):d.replace(s,"")).length<=c[0].length||r.ignore&&r.ignore.test(d))){var _=t(d,l,p=l+d.length,e);void 0!==_?(_=String(_),e=e.slice(0,l)+_+e.slice(p),n.lastIndex=l+_.length):n.lastIndex=p}}return n.lastIndex=0,e},o.ensureValidHostname=function(t,r){var n=!!t,i=!1;if(!!r&&(i=p(o.hostProtocols,r)),i&&!n)throw new TypeError("Hostname cannot be empty, if protocol is "+r);if(t&&t.match(o.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(t).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(e){if(e){var t=Number(e);if(!(/^[0-9]+$/.test(t)&&t>0&&t<65536))throw new TypeError('Port "'+e+'" is not a valid port')}},o.noConflict=function(e){if(e){var t={URI:this.noConflict()};return n.URITemplate&&"function"==typeof n.URITemplate.noConflict&&(t.URITemplate=n.URITemplate.noConflict()),n.IPv6&&"function"==typeof n.IPv6.noConflict&&(t.IPv6=n.IPv6.noConflict()),n.SecondLevelDomains&&"function"==typeof n.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=n.SecondLevelDomains.noConflict()),t}return n.URI===this&&(n.URI=i),this},s.build=function(e){return!0===e?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},s.clone=function(){return new o(this)},s.valueOf=s.toString=function(){return this.build(!1)._string},s.protocol=x("protocol"),s.username=x("username"),s.password=x("password"),s.hostname=x("hostname"),s.port=x("port"),s.query=C("query","?"),s.fragment=C("fragment","#"),s.search=function(e,t){var r=this.query(e,t);return"string"==typeof r&&r.length?"?"+r:r},s.hash=function(e,t){var r=this.fragment(e,t);return"string"==typeof r&&r.length?"#"+r:r},s.pathname=function(e,t){if(void 0===e||!0===e){var r=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?o.decodeUrnPath:o.decodePath)(r):r}return this._parts.urn?this._parts.path=e?o.recodeUrnPath(e):"":this._parts.path=e?o.recodePath(e):"/",this.build(!t),this},s.path=s.pathname,s.href=function(e,t){var r;if(void 0===e)return this.toString();this._string="",this._parts=o._parts();var n=e instanceof o,i="object"==typeof e&&(e.hostname||e.path||e.pathname);if(e.nodeName&&(e=e[o.getDomAttribute(e)]||"",i=!1),!n&&i&&void 0!==e.pathname&&(e=e.toString()),"string"==typeof e||e instanceof String)this._parts=o.parse(String(e),this._parts);else{if(!n&&!i)throw new TypeError("invalid input");var s=n?e._parts:e;for(r in s)"query"!==r&&a.call(this._parts,r)&&(this._parts[r]=s[r]);s.query&&this.query(s.query,!1)}return this.build(!t),this},s.is=function(e){var t=!1,n=!1,i=!1,s=!1,a=!1,u=!1,c=!1,l=!this._parts.urn;switch(this._parts.hostname&&(l=!1,n=o.ip4_expression.test(this._parts.hostname),i=o.ip6_expression.test(this._parts.hostname),a=(s=!(t=n||i))&&r&&r.has(this._parts.hostname),u=s&&o.idn_expression.test(this._parts.hostname),c=s&&o.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return l;case"absolute":return!l;case"domain":case"name":return s;case"sld":return a;case"ip":return t;case"ip4":case"ipv4":case"inet4":return n;case"ip6":case"ipv6":case"inet6":return i;case"idn":return u;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return c}return null};var b=s.protocol,I=s.port,T=s.hostname;s.protocol=function(e,t){if(e&&!(e=e.replace(/:(\/\/)?$/,"")).match(o.protocol_expression))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return b.call(this,e,t)},s.scheme=s.protocol,s.port=function(e,t){return this._parts.urn?void 0===e?"":this:(void 0!==e&&(0===e&&(e=null),e&&(":"===(e+="").charAt(0)&&(e=e.substring(1)),o.ensureValidPort(e))),I.call(this,e,t))},s.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var r={preventInvalidHostname:this._parts.preventInvalidHostname};if("/"!==o.parseHost(e,r))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=r.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(e,this._parts.protocol)}return T.call(this,e,t)},s.origin=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var r=this.protocol();return this.authority()?(r?r+"://":"")+this.authority():""}var n=o(e);return this.protocol(n.protocol()).authority(n.authority()).build(!t),this},s.host=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?o.buildHost(this._parts):"";if("/"!==o.parseHost(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},s.authority=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?o.buildAuthority(this._parts):"";if("/"!==o.parseAuthority(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},s.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var r=o.buildUserinfo(this._parts);return r?r.substring(0,r.length-1):r}return"@"!==e[e.length-1]&&(e+="@"),o.parseUserinfo(e,this._parts),this.build(!t),this},s.resource=function(e,t){var r;return void 0===e?this.path()+this.search()+this.hash():(r=o.parse(e),this._parts.path=r.path,this._parts.query=r.query,this._parts.fragment=r.fragment,this.build(!t),this)},s.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,r)||""}var n=this._parts.hostname.length-this.domain().length,i=this._parts.hostname.substring(0,n),s=new RegExp("^"+u(i));if(e&&"."!==e.charAt(e.length-1)&&(e+="."),-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");return e&&o.ensureValidHostname(e,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(s,e),this.build(!t),this},s.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.match(/\./g);if(r&&r.length<2)return this._parts.hostname;var n=this._parts.hostname.length-this.tld(t).length-1;return n=this._parts.hostname.lastIndexOf(".",n-1)+1,this._parts.hostname.substring(n)||""}if(!e)throw new TypeError("cannot set domain empty");if(-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(e,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var i=new RegExp(u(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(i,e)}return this.build(!t),this},s.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.lastIndexOf("."),i=this._parts.hostname.substring(n+1);return!0!==t&&r&&r.list[i.toLowerCase()]&&r.get(this._parts.hostname)||i}var o;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!r||!r.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');o=new RegExp(u(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(o,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");o=new RegExp(u(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(o,e)}return this.build(!t),this},s.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var r=this._parts.path.length-this.filename().length-1,n=this._parts.path.substring(0,r)||(this._parts.hostname?"/":"");return e?o.decodePath(n):n}var i=this._parts.path.length-this.filename().length,s=this._parts.path.substring(0,i),a=new RegExp("^"+u(s));return this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=o.recodePath(e),this._parts.path=this._parts.path.replace(a,e),this.build(!t),this},s.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("string"!=typeof e){if(!this._parts.path||"/"===this._parts.path)return"";var r=this._parts.path.lastIndexOf("/"),n=this._parts.path.substring(r+1);return e?o.decodePathSegment(n):n}var i=!1;"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(i=!0);var s=new RegExp(u(this.filename())+"$");return e=o.recodePath(e),this._parts.path=this._parts.path.replace(s,e),i?this.normalizePath(t):this.build(!t),this},s.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path)return"";var r,n,i=this.filename(),s=i.lastIndexOf(".");return-1===s?"":(r=i.substring(s+1),n=/^[a-z0-9%]+$/i.test(r)?r:"",e?o.decodePathSegment(n):n)}"."===e.charAt(0)&&(e=e.substring(1));var a,c=this.suffix();if(c)a=e?new RegExp(u(c)+"$"):new RegExp(u("."+c)+"$");else{if(!e)return this;this._parts.path+="."+o.recodePath(e)}return a&&(e=o.recodePath(e),this._parts.path=this._parts.path.replace(a,e)),this.build(!t),this},s.segment=function(e,t,r){var n=this._parts.urn?":":"/",i=this.path(),o="/"===i.substring(0,1),s=i.split(n);if(void 0!==e&&"number"!=typeof e&&(r=t,t=e,e=void 0),void 0!==e&&"number"!=typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(o&&s.shift(),e<0&&(e=Math.max(s.length+e,0)),void 0===t)return void 0===e?s:s[e];if(null===e||void 0===s[e])if(l(t)){s=[];for(var a=0,u=t.length;a<u;a++)(t[a].length||s.length&&s[s.length-1].length)&&(s.length&&!s[s.length-1].length&&s.pop(),s.push(f(t[a])))}else(t||"string"==typeof t)&&(t=f(t),""===s[s.length-1]?s[s.length-1]=t:s.push(t));else t?s[e]=f(t):s.splice(e,1);return o&&s.unshift(""),this.path(s.join(n),r)},s.segmentCoded=function(e,t,r){var n,i,s;if("number"!=typeof e&&(r=t,t=e,e=void 0),void 0===t){if(l(n=this.segment(e,t,r)))for(i=0,s=n.length;i<s;i++)n[i]=o.decode(n[i]);else n=void 0!==n?o.decode(n):void 0;return n}if(l(t))for(i=0,s=t.length;i<s;i++)t[i]=o.encode(t[i]);else t="string"==typeof t||t instanceof String?o.encode(t):t;return this.segment(e,t,r)};var v=s.query;return s.query=function(e,t){if(!0===e)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof e){var r=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),n=e.call(this,r);return this._parts.query=o.buildQuery(n||r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!=typeof e?(this._parts.query=o.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):v.call(this,e,t)},s.setQuery=function(e,t,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof e||e instanceof String)n[e]=void 0!==t?t:null;else{if("object"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var i in e)a.call(e,i)&&(n[i]=e[i])}return this._parts.query=o.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(r=t),this.build(!r),this},s.addQuery=function(e,t,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(n,e,void 0===t?null:t),this._parts.query=o.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(r=t),this.build(!r),this},s.removeQuery=function(e,t,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(n,e,t),this._parts.query=o.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(r=t),this.build(!r),this},s.hasQuery=function(e,t,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(n,e,t,r)},s.setSearch=s.setQuery,s.addSearch=s.addQuery,s.removeSearch=s.removeQuery,s.hasSearch=s.hasQuery,s.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},s.normalizeProtocol=function(e){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},s.normalizeHostname=function(r){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!r)),this},s.normalizePort=function(e){return"string"==typeof this._parts.protocol&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},s.normalizePath=function(e){var t,r=this._parts.path;if(!r)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!e),this;if("/"===this._parts.path)return this;var n,i,s="";for("/"!==(r=o.recodePath(r)).charAt(0)&&(t=!0,r="/"+r),"/.."!==r.slice(-3)&&"/."!==r.slice(-2)||(r+="/"),r=r.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),t&&(s=r.substring(1).match(/^(\.\.\/)+/)||"")&&(s=s[0]);-1!==(n=r.search(/\/\.\.(\/|$)/));)0!==n?(-1===(i=r.substring(0,n).lastIndexOf("/"))&&(i=n),r=r.substring(0,i)+r.substring(n+3)):r=r.substring(3);return t&&this.is("relative")&&(r=s+r.substring(1)),this._parts.path=r,this.build(!e),this},s.normalizePathname=s.normalizePath,s.normalizeQuery=function(e){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},s.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},s.normalizeSearch=s.normalizeQuery,s.normalizeHash=s.normalizeFragment,s.iso8859=function(){var e=o.encode,t=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=e,o.decode=t}return this},s.unicode=function(){var e=o.encode,t=o.decode;o.encode=g,o.decode=unescape;try{this.normalize()}finally{o.encode=e,o.decode=t}return this},s.readable=function(){var t=this.clone();t.username("").password("").normalize();var r="";if(t._parts.protocol&&(r+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(r+=e.toUnicode(t._parts.hostname),t._parts.port&&(r+=":"+t._parts.port)):r+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(r+="/"),r+=t.path(!0),t._parts.query){for(var n="",i=0,s=t._parts.query.split("&"),a=s.length;i<a;i++){var u=(s[i]||"").split("=");n+="&"+o.decodeQuery(u[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==u[1]&&(n+="="+o.decodeQuery(u[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}r+="?"+n.substring(1)}return r+=o.decodeQuery(t.hash(),!0)},s.absoluteTo=function(e){var t,r,n,i=this.clone(),s=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e instanceof o||(e=new o(e)),i._parts.protocol)return i;if(i._parts.protocol=e._parts.protocol,this._parts.hostname)return i;for(r=0;n=s[r];r++)i._parts[n]=e._parts[n];return i._parts.path?(".."===i._parts.path.substring(-2)&&(i._parts.path+="/"),"/"!==i.path().charAt(0)&&(t=(t=e.directory())||(0===e.path().indexOf("/")?"/":""),i._parts.path=(t?t+"/":"")+i._parts.path,i.normalizePath())):(i._parts.path=e._parts.path,i._parts.query||(i._parts.query=e._parts.query)),i.build(),i},s.relativeTo=function(e){var t,r,n,i,s,a=this.clone().normalize();if(a._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e=new o(e).normalize(),t=a._parts,r=e._parts,i=a.path(),s=e.path(),"/"!==i.charAt(0))throw new Error("URI is already relative");if("/"!==s.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(t.protocol===r.protocol&&(t.protocol=null),t.username!==r.username||t.password!==r.password)return a.build();if(null!==t.protocol||null!==t.username||null!==t.password)return a.build();if(t.hostname!==r.hostname||t.port!==r.port)return a.build();if(t.hostname=null,t.port=null,i===s)return t.path="",a.build();if(!(n=o.commonPath(i,s)))return a.build();var u=r.path.substring(n.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return t.path=u+t.path.substring(n.length)||"./",a.build()},s.equals=function(e){var t,r,n,i,s,u=this.clone(),c=new o(e),h={};if(u.normalize(),c.normalize(),u.toString()===c.toString())return!0;if(n=u.query(),i=c.query(),u.query(""),c.query(""),u.toString()!==c.toString())return!1;if(n.length!==i.length)return!1;for(s in t=o.parseQuery(n,this._parts.escapeQuerySpace),r=o.parseQuery(i,this._parts.escapeQuerySpace),t)if(a.call(t,s)){if(l(t[s])){if(!d(t[s],r[s]))return!1}else if(t[s]!==r[s])return!1;h[s]=!0}for(s in r)if(a.call(r,s)&&!h[s])return!1;return!0},s.preventInvalidHostname=function(e){return this._parts.preventInvalidHostname=!!e,this},s.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},s.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},o},e.exports?e.exports=r((un||(un=1,function(e,t){!function(r){var n=t&&!t.nodeType&&t,i=e&&!e.nodeType&&e,o="object"==typeof sn&&sn;o.global!==o&&o.window!==o&&o.self!==o||(r=o);var s,a,u=2147483647,c=36,l=/^xn--/,h=/[^\x20-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,A=String.fromCharCode;function g(e){throw new RangeError(d[e])}function _(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function m(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+_((e=e.replace(p,".")).split("."),t).join(".")}function y(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function E(e){return _(e,(function(e){var t="";return e>65535&&(t+=A((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+A(e)})).join("")}function x(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function C(e,t,r){var n=0;for(e=r?f(e/700):e>>1,e+=f(e/t);e>455;n+=c)e=f(e/35);return f(n+36*e/(e+38))}function b(e){var t,r,n,i,o,s,a,l,h,p,d,A=[],_=e.length,m=0,y=128,x=72;for((r=e.lastIndexOf("-"))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&g("not-basic"),A.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<_;){for(o=m,s=1,a=c;i>=_&&g("invalid-input"),((l=(d=e.charCodeAt(i++))-48<10?d-22:d-65<26?d-65:d-97<26?d-97:c)>=c||l>f((u-m)/s))&&g("overflow"),m+=l*s,!(l<(h=a<=x?1:a>=x+26?26:a-x));a+=c)s>f(u/(p=c-h))&&g("overflow"),s*=p;x=C(m-o,t=A.length+1,0==o),f(m/t)>u-y&&g("overflow"),y+=f(m/t),m%=t,A.splice(m++,0,y)}return E(A)}function I(e){var t,r,n,i,o,s,a,l,h,p,d,_,m,E,b,I=[];for(_=(e=y(e)).length,t=128,r=0,o=72,s=0;s<_;++s)(d=e[s])<128&&I.push(A(d));for(n=i=I.length,i&&I.push("-");n<_;){for(a=u,s=0;s<_;++s)(d=e[s])>=t&&d<a&&(a=d);for(a-t>f((u-r)/(m=n+1))&&g("overflow"),r+=(a-t)*m,t=a,s=0;s<_;++s)if((d=e[s])<t&&++r>u&&g("overflow"),d==t){for(l=r,h=c;!(l<(p=h<=o?1:h>=o+26?26:h-o));h+=c)b=l-p,E=c-p,I.push(A(x(p+b%E,0))),l=f(b/E);I.push(A(x(l,0))),o=C(r,m,n==i),r=0,++n}++r,++t}return I.join("")}if(s={version:"1.3.2",ucs2:{decode:y,encode:E},decode:b,encode:I,toASCII:function(e){return m(e,(function(e){return h.test(e)?"xn--"+I(e):e}))},toUnicode:function(e){return m(e,(function(e){return l.test(e)?b(e.slice(4).toLowerCase()):e}))}},n&&i)if(e.exports==n)i.exports=s;else for(a in s)s.hasOwnProperty(a)&&(n[a]=s[a]);else r.punycode=s}(hn)}(ln,ln.exports)),ln.exports),(pn||(pn=1,function(e){var t,r;t=An,r=function(e){var t=e&&e.IPv6;return{best:function(e){var t,r,n=e.toLowerCase().split(":"),i=n.length,o=8;for(""===n[0]&&""===n[1]&&""===n[2]?(n.shift(),n.shift()):""===n[0]&&""===n[1]?n.shift():""===n[i-1]&&""===n[i-2]&&n.pop(),-1!==n[(i=n.length)-1].indexOf(".")&&(o=7),t=0;t<i&&""!==n[t];t++);if(t<o)for(n.splice(t,1,"0000");n.length<o;)n.splice(t,0,"0000");for(var s=0;s<o;s++){r=n[s].split("");for(var a=0;a<3&&"0"===r[0]&&r.length>1;a++)r.splice(0,1);n[s]=r.join("")}var u=-1,c=0,l=0,h=-1,p=!1;for(s=0;s<o;s++)p?"0"===n[s]?l+=1:(p=!1,l>c&&(u=h,c=l)):"0"===n[s]&&(p=!0,h=s,l=1);l>c&&(u=h,c=l),c>1&&n.splice(u,c,""),i=n.length;var d="";for(""===n[0]&&(d=":"),s=0;s<i&&(d+=n[s],s!==i-1);s++)d+=":";return""===n[i-1]&&(d+=":"),d},noConflict:function(){return e.IPv6===this&&(e.IPv6=t),this}}},e.exports?e.exports=r():t.IPv6=r(t)}(dn)),dn.exports),(gn||(gn=1,function(e){var t,r;t=mn,r=function(e){var t=e&&e.SecondLevelDomains,r={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;var n=e.lastIndexOf(".",t-1);if(n<=0||n>=t-1)return!1;var i=r.list[e.slice(t+1)];return!!i&&i.indexOf(" "+e.slice(n+1,t)+" ")>=0},is:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;if(e.lastIndexOf(".",t-1)>=0)return!1;var n=r.list[e.slice(t+1)];return!!n&&n.indexOf(" "+e.slice(0,t)+" ")>=0},get:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return null;var n=e.lastIndexOf(".",t-1);if(n<=0||n>=t-1)return null;var i=r.list[e.slice(t+1)];return i?i.indexOf(" "+e.slice(n+1,t)+" ")<0?null:e.slice(n+1):null},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return r},e.exports?e.exports=r():t.SecondLevelDomains=r(t)}(_n)),_n.exports)):t.URI=r(t.punycode,t.IPv6,t.SecondLevelDomains,t)}(cn)),cn.exports),Cn=an(xn);function bn(e,t){if(null===e||"object"!=typeof e)return e;t=Yt(t,!1);var r=new e.constructor;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];t&&(i=bn(i,t)),r[n]=i}return r}function In(e,t,r){r=Yt(r,!1);var n,i,o,s={},a=jt(e),u=jt(t);if(a)for(n in e)e.hasOwnProperty(n)&&(i=e[n],u&&r&&"object"==typeof i&&t.hasOwnProperty(n)?(o=t[n],s[n]="object"==typeof o?In(i,o,r):i):s[n]=i);if(u)for(n in t)t.hasOwnProperty(n)&&!s.hasOwnProperty(n)&&(o=t[n],s[n]=o);return s}function Tn(){let e,t;const r=new Promise((function(r,n){e=r,t=n}));return{resolve:e,reject:t,promise:r}}function vn(e){if(e instanceof vn)this.scheme=e.scheme,this.authority=e.authority,this.path=e.path,this.query=e.query,this.fragment=e.fragment;else if(e){var t=Rn.exec(e);this.scheme=t[1],this.authority=t[2],this.path=t[3],this.query=t[4],this.fragment=t[5]}}vn.prototype.scheme=null,vn.prototype.authority=null,vn.prototype.path="",vn.prototype.query=null,vn.prototype.fragment=null;var Rn=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$");vn.prototype.getScheme=function(){return this.scheme},vn.prototype.getAuthority=function(){return this.authority},vn.prototype.getPath=function(){return this.path},vn.prototype.getQuery=function(){return this.query},vn.prototype.getFragment=function(){return this.fragment},vn.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment},vn.prototype.isSameDocumentAs=function(e){return e.scheme==this.scheme&&e.authority==this.authority&&e.path==this.path&&e.query==this.query},vn.prototype.equals=function(e){return this.isSameDocumentAs(e)&&e.fragment==this.fragment},vn.prototype.normalize=function(){this.removeDotSegments(),this.scheme&&(this.scheme=this.scheme.toLowerCase()),this.authority&&(this.authority=this.authority.replace(Sn,On).replace(Mn,Bn)),this.path&&(this.path=this.path.replace(Mn,Bn)),this.query&&(this.query=this.query.replace(Mn,Bn)),this.fragment&&(this.fragment=this.fragment.replace(Mn,Bn))};var Mn=/%[0-9a-z]{2}/gi,wn=/[a-zA-Z0-9\-\._~]/,Sn=/(.*@)?([^@:]*)(:.*)?/;function Bn(e){var t=unescape(e);return wn.test(t)?t:e.toUpperCase()}function On(e,t,r,n){return(t||"")+r.toLowerCase()+(n||"")}function Dn(e,t){var r;return"undefined"!=typeof document&&(r=document),Dn._implementation(e,t,r)}vn.prototype.resolve=function(e){var t=new vn;return this.scheme?(t.scheme=this.scheme,t.authority=this.authority,t.path=this.path,t.query=this.query):(t.scheme=e.scheme,this.authority?(t.authority=this.authority,t.path=this.path,t.query=this.query):(t.authority=e.authority,""==this.path?(t.path=e.path,t.query=this.query||e.query):("/"==this.path.charAt(0)?(t.path=this.path,t.removeDotSegments()):(e.authority&&""==e.path?t.path="/"+this.path:t.path=e.path.substring(0,e.path.lastIndexOf("/")+1)+this.path,t.removeDotSegments()),t.query=this.query))),t.fragment=this.fragment,t},vn.prototype.removeDotSegments=function(){var e,t=this.path.split("/"),r=[],n=""==t[0];for(n&&t.shift(),""==t[0]&&t.shift();t.length;)".."==(e=t.shift())?r.pop():"."!=e&&r.push(e);"."!=e&&".."!=e||r.push(""),n&&r.unshift(""),this.path=r.join("/")},vn.prototype.toString=function(){var e="";return this.scheme&&(e+=this.scheme+":"),this.authority&&(e+="//"+this.authority),e+=this.path,this.query&&(e+="?"+this.query),this.fragment&&(e+="#"+this.fragment),e},Dn._implementation=function(e,t,r){if(!jt(e))throw new Ht("relative uri is required.");if(!jt(t)){if(void 0===r)return e;t=Yt(r.baseURI,r.location.href)}var n=new vn(t);return new vn(e).resolve(n).toString()};var Fn={};function Pn(e,t,r){jt(t)||(t=e.width),jt(r)||(r=e.height);var n=Fn[t];jt(n)||(n={},Fn[t]=n);var i=n[r];if(!jt(i)){var o=document.createElement("canvas");o.width=t,o.height=r,(i=o.getContext("2d",{willReadFrequently:!0})).globalCompositeOperation="copy",n[r]=i}return i.drawImage(e,0,0,t,r),i.getImageData(0,0,t,r).data}var Nn,Ln=/^blob:/i;function Un(e){return qt.typeOf.string("uri",e),Ln.test(e)}var Gn=/^data:/i;function Qn(e){return qt.typeOf.string("uri",e),Gn.test(e)}function kn(e,t){if(!jt(e))throw new Ht("obj is required.");var r="";for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],o=encodeURIComponent(n)+"=";if(Array.isArray(i))for(var s=0,a=i.length;s<a;++s)r+=!0===t?o+encodeURI(i[s])+"&":o+encodeURIComponent(i[s])+"&";else r+=!0===t?o+encodeURI(i)+"&":o+encodeURIComponent(i)+"&"}return r=r.slice(0,-1)}var zn=Object.freeze({UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5}),jn=Object.freeze({TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3,PACK:4,BLOCK:5,BLOCKPACK:6});function Hn(e){e=Yt(e,Yt.EMPTY_OBJECT);var t=Yt(e.throttleByServer,!1),r=Yt(e.throttle,!1);this.url=e.url,this.requestFunction=e.requestFunction,this.cancelFunction=e.cancelFunction,this.priorityFunction=e.priorityFunction,this.priority=Yt(e.priority,0),this.throttle=r,this.throttleByServer=t,this.type=Yt(e.type,jn.OTHER),this.serverKey=void 0,this.state=zn.UNISSUED,this.deferred=void 0,this.cancelled=!1}function qn(e,t,r){this.statusCode=e,this.response=t,this.responseHeaders=r,"string"==typeof this.responseHeaders&&(this.responseHeaders=function(e){var t={};if(!e)return t;for(var r=e.split("\r\n"),n=0;n<r.length;++n){var i=r[n],o=i.indexOf(": ");if(o>0){var s=i.substring(0,o),a=i.substring(o+2);t[s]=a}}return t}(this.responseHeaders))}function Vn(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}function Yn(e,t){return t-e}function Xn(e){qt.typeOf.object("options",e),qt.defined("options.comparator",e.comparator),this._comparator=e.comparator,this._array=[],this._length=0,this._maximumLength=void 0}function Wn(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}Hn.prototype.cancel=function(){this.cancelled=!0},Hn.prototype.clone=function(e){return jt(e)?(e.url=this.url,e.requestFunction=this.requestFunction,e.cancelFunction=this.cancelFunction,e.priorityFunction=this.priorityFunction,e.priority=this.priority,e.throttle=this.throttle,e.throttleByServer=this.throttleByServer,e.type=this.type,e.serverKey=this.serverKey,e.state=this.RequestState.UNISSUED,e.deferred=void 0,e.cancelled=!1,e):new Hn(this)},qn.prototype.toString=function(){var e="Request has failed.";return jt(this.statusCode)&&(e+=" Status Code: "+this.statusCode),e},Object.defineProperties(Vn.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}}),Vn.prototype.addEventListener=function(e,t){qt.typeOf.func("listener",e),this._listeners.push(e),this._scopes.push(t);var r=this;return function(){r.removeEventListener(e,t)}},Vn.prototype.removeEventListener=function(e,t){qt.typeOf.func("listener",e);for(var r=this._listeners,n=this._scopes,i=-1,o=0;o<r.length;o++)if(r[o]===e&&n[o]===t){i=o;break}return-1!==i&&(this._insideRaiseEvent?(this._toRemove.push(i),r[i]=void 0,n[i]=void 0):(r.splice(i,1),n.splice(i,1)),!0)},Vn.prototype.raiseEvent=function(){var e;this._insideRaiseEvent=!0;var t=this._listeners,r=this._scopes,n=t.length;for(e=0;e<n;e++){jt(t[e])&&t[e].apply(r[e],arguments)}var i=this._toRemove;if((n=i.length)>0){for(i.sort(Yn),e=0;e<n;e++){var o=i[e];t.splice(o,1),r.splice(o,1)}i.length=0}this._insideRaiseEvent=!1},Object.defineProperties(Xn.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(e){this._maximumLength=e,this._length>e&&e>0&&(this._length=e,this._array.length=e)}},comparator:{get:function(){return this._comparator}}}),Xn.prototype.reserve=function(e){e=Yt(e,this._length),this._array.length=e},Xn.prototype.heapify=function(e){e=Yt(e,0);for(var t=this._length,r=this._comparator,n=this._array,i=-1,o=!0;o;){var s=2*(e+1),a=s-1;i=a<t&&r(n[a],n[e])<0?a:e,s<t&&r(n[s],n[i])<0&&(i=s),i!==e?(Wn(n,i,e),e=i):o=!1}},Xn.prototype.resort=function(){for(var e=this._length,t=Math.ceil(e/2);t>=0;--t)this.heapify(t)},Xn.prototype.insert=function(e){qt.defined("element",e);var t,r=this._array,n=this._comparator,i=this._maximumLength,o=this._length++;for(o<r.length?r[o]=e:r.push(e);0!==o;){var s=Math.floor((o-1)/2);if(!(n(r[o],r[s])<0))break;Wn(r,o,s),o=s}return jt(i)&&this._length>i&&(t=r[i],r.pop(),this._length=i),t},Xn.prototype.pop=function(e){if(e=Yt(e,0),0!==this._length){qt.typeOf.number.lessThan("index",e,this._length);var t=this._array,r=t[e];return Wn(t,e,--this._length),t[this._length]=void 0,this.heapify(e),r}};var Kn="undefined"!=typeof performance&&"function"==typeof performance.now&&isFinite(performance.now())?function(){return performance.now()}:function(){return Date.now()};function Jn(e,t){return e.priority-t.priority}var Zn={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0,totalRequestTime:0},$n=20,ei=new Xn({comparator:Jn});ei.maximumLength=$n,ei.reserve($n);var ti=[],ri={},ni="undefined"!=typeof document?new vn(document.location.href):new vn,ii=new Vn;function oi(){}function si(e){jt(e.priorityFunction)&&(e.priority=e.priorityFunction())}function ai(e){return jt(e.packKey)||(e.packKey=e.serverKey+"_"+e.providerName),e.packKey}function ui(e){return jt(e.blockKey)||(e.blockKey=e.serverKey+"_"+e.providerName+"_"+e.quadKey+e.url.substring(e.url.indexOf("dataVersion"))),e.blockKey}function ci(e){var t=ai(e);return jt(oi.packRequestGroup[t])||(oi.packRequestGroup[t]=[]),jt(oi.packRequestQuadKey[t])||(oi.packRequestQuadKey[t]=""),jt(oi.packRequestPromise[t])||(oi.packRequestPromise[t]=Tn()),jt(oi.quadKeyIndex[t])||(oi.quadKeyIndex[t]=0),e.quadKeyIndex=oi.quadKeyIndex[t]++,e.deferred=oi.packRequestPromise[t],e.state=zn.ISSUED,oi.packRequestGroup[t].push(e),e.deferred.promise}function li(e){for(var t=0,r=e.length;t<r;t++){e[t].state=zn.CANCELLED}}function hi(e){for(var t=[],r={},n=0,i=e.length;n<i;n++){var o=e[n];if(!o.cancelled){var s=o.quadKey;r[s]||(r[s]=!0,t.push(s))}}return t}function pi(){var e=oi.packRequestGroup;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];if(r.length<1)continue;var n=r[0].clone(),i=-1!==n.url.indexOf("rest/maps");n.serverKey=r[0].serverKey,n.state=r[0].state;var o=n.url,s=hi(r);if(s.length<1)continue;oi.packRequestQuadKey[t]=i?s.join(","):s.join(";");var a=oi.packRequestQuadKey[t];if(n.throttleByServer&&!oi.serverHasOpenSlots(n.serverKey)){li(r),oi.packRequestPromise[t].reject();continue}n.deferred=oi.packRequestPromise[t];var u=new vn(o);u.query=i?jt(u.query)?u.query+"&tiles="+a:"tiles="+a:jt(u.query)?u.query+"&extratiles="+a:"extratiles="+a,n.url=u.toString(),Ai(n,n.url)}oi.packRequestGroup={},oi.packRequestPromise={},oi.packRequestQuadKey={},oi.quadKeyIndex={}}function di(){var e=oi.blockRequest;for(var t in e){if(e.hasOwnProperty(t))Ai(e[t])}oi.blockRequest={}}function fi(e){if(e.state===zn.UNISSUED)if(e.state=zn.ISSUED,e.type===jn.PACK||e.type===jn.BLOCKPACK){var t=ai(e);jt(oi.packRequestPromise[t])||(oi.packRequestPromise[t]=Tn()),e.deferred=oi.packRequestPromise[t]}else e.deferred=Tn();return e.deferred.promise}function Ai(e,t){var r=fi(e);return e.state=zn.ACTIVE,ti.push(e),++Zn.numberOfActiveRequests,++Zn.numberOfActiveRequestsEver,++ri[e.serverKey],e.startTime=Kn(),e.requestFunction(t).then(function(e){return function(t){if(e.state!==zn.CANCELLED&&(--Zn.numberOfActiveRequests,--ri[e.serverKey],ii.raiseEvent(),e.state=zn.RECEIVED,e.deferred.resolve(t),e.endTime=Kn(),(oi.statisticRequestTime>0||e.type!==jn.OTHER)&&(Zn.totalRequestTime+=e.endTime-e.startTime),e.type===jn.BLOCK||e.type===jn.BLOCKPACK)){var r=ui(e);jt(oi.blockDefer[r])&&(oi.blockDefer[r]=void 0,delete oi.blockDefer[r])}}}(e)).catch(function(e){return function(t){e.state!==zn.CANCELLED&&(++Zn.numberOfFailedRequests,--Zn.numberOfActiveRequests,--ri[e.serverKey],ii.raiseEvent(t),e.state=zn.FAILED,e.deferred.reject(t))}}(e)),r}function gi(e){var t=e.state===zn.ACTIVE;e.state=zn.CANCELLED,++Zn.numberOfCancelledRequests,e.deferred.reject(),t&&(--Zn.numberOfActiveRequests,--ri[e.serverKey],++Zn.numberOfCancelledActiveRequests),jt(e.cancelFunction)&&e.cancelFunction()}function _i(e){var t;this.name="RuntimeError",this.message=e;try{throw new Error}catch(e){t=e.stack}this.stack=t}oi.TIMEOUT=5e3,oi.CANCLE_COUNT=3,oi.statisticRequestTime=-1,oi.maximumRequests=50,oi.maximumRequestsPerServer=18,oi.perPacketCount=20,oi.requestsByServer={},oi.throttleRequests=!0,oi.debugShowStatistics=!1,oi.requestCompletedEvent=ii,Object.defineProperties(oi,{activeRequestLength:{get:function(){return ti.length}},statistics:{get:function(){return Zn}},priorityHeapLength:{get:function(){return $n},set:function(e){if(e<$n)for(;ei.length>e;){gi(ei.pop())}$n=e,ei.maximumLength=e,ei.reserve(e)}}}),oi.serverHasOpenSlots=function(e,t){t=Yt(t,1);const r=Yt(oi.requestsByServer[e],oi.maximumRequestsPerServer);return ri[e]+t<=r},oi.heapHasOpenSlots=function(e){return ei.length+e<=$n},oi.packRequestGroup={},oi.packRequestPromise={},oi.packRequestQuadKey={},oi.quadKeyIndex={},oi.packRequestHeap={},oi.blockDefer={},oi.blockRequest={},oi.update=function(){var e,t,r=0,n=ti.length;for(e=0;e<n;++e)(t=ti[e]).cancelled&&gi(t),t.state===zn.ACTIVE?r>0&&(ti[e-r]=t):++r;ti.length-=r;var i=ei.internalArray,o=ei.length;for(e=0;e<o;++e)si(i[e]);ei.resort(),function(){for(var e in oi.packRequestHeap)if(oi.packRequestHeap.hasOwnProperty(e)){for(var t=oi.packRequestHeap[e],r=t.internalArray,n=t.length,i=0;i<n;++i)si(r[i]);t.resort()}}(),di(),function(){for(var e in oi.packRequestHeap)if(oi.packRequestHeap.hasOwnProperty(e))for(var t=oi.packRequestHeap[e];t.length>0;){var r=t.pop();r.cancelled?gi(r):ci(r)}pi()}();for(var s=Math.max(oi.maximumRequests-ti.length,0),a=0;a<s&&ei.length>0;)(t=ei.pop()).cancelled?gi(t):!t.throttleByServer||oi.serverHasOpenSlots(t.serverKey)?(Ai(t),++a):gi(t);!function(){if(!oi.debugShowStatistics)return;0===Zn.numberOfActiveRequests&&Zn.lastNumberOfActiveRequests>0&&(Zn.numberOfAttemptedRequests>0&&(console.log("Number of attempted requests: "+Zn.numberOfAttemptedRequests),Zn.numberOfAttemptedRequests=0),Zn.numberOfCancelledRequests>0&&(console.log("Number of cancelled requests: "+Zn.numberOfCancelledRequests),Zn.numberOfCancelledRequests=0),Zn.numberOfCancelledActiveRequests>0&&(console.log("Number of cancelled active requests: "+Zn.numberOfCancelledActiveRequests),Zn.numberOfCancelledActiveRequests=0),Zn.numberOfFailedRequests>0&&(console.log("Number of failed requests: "+Zn.numberOfFailedRequests),Zn.numberOfFailedRequests=0));Zn.lastNumberOfActiveRequests=Zn.numberOfActiveRequests}()},oi.getServerKey=function(e){qt.typeOf.string("url",e);var t=new vn(e).resolve(ni);t.normalize();var r=t.authority;return/:/.test(r)||(r=r+":"+("https"===t.scheme?"443":"80")),jt(ri[r])||(ri[r]=0),r},oi.request=function(e){if(qt.typeOf.object("request",e),qt.typeOf.string("request.url",e.url),qt.typeOf.func("request.requestFunction",e.requestFunction),Qn(e.url)||Un(e.url))return ii.raiseEvent(),e.state=zn.RECEIVED,e.requestFunction();if(++Zn.numberOfAttemptedRequests,jt(e.serverKey)||(e.serverKey=oi.getServerKey(e.url)),e.type===jn.BLOCK)return function(e){var t=ui(e),r=oi.blockDefer[t];return jt(r)||(r=oi.blockDefer[t]=Tn(),oi.blockRequest[t]=e),e.deferred=r,e.state=zn.ISSUED,e.deferred.promise}(e);if(!e.throttleByServer||oi.serverHasOpenSlots(e.serverKey)){if(!oi.throttleRequests||!e.throttle)return Ai(e);if(!(ti.length>=oi.maximumRequests)){var t;if(si(e),e.type===jn.PACK||e.type===jn.BLOCKPACK){var r=function(e){var t=ai(e),r=oi.packRequestHeap[t];return jt(r)||((r=oi.packRequestHeap[t]=new Xn({comparator:Jn})).maximumLength=oi.perPacketCount,r.reserve($n)),r}(e),n=!0;if(e.type===jn.BLOCKPACK)for(var i=0;i<r.length;i++)if(r._array[i].quadKey===e.quadKey){e.blockRequest=r._array[i],n=!1;break}n&&(t=r.insert(e))}else t=ei.insert(e);if(jt(t)){if(t===e)return;gi(t)}return fi(e)}}},oi.clearForSpecs=function(){for(;ei.length>0;){gi(ei.pop())}for(var e=ti.length,t=0;t<e;++t)gi(ti[t]);ti.length=0,ri={},Zn.numberOfAttemptedRequests=0,Zn.numberOfActiveRequests=0,Zn.numberOfCancelledRequests=0,Zn.numberOfCancelledActiveRequests=0,Zn.numberOfFailedRequests=0,Zn.numberOfActiveRequestsEver=0,Zn.lastNumberOfActiveRequests=0,Zn.totalRequestTime=0},oi.numberOfActiveRequestsByServer=function(e){return ri[e]},oi.requestHeap=ei,jt(Object.create)&&(_i.prototype=Object.create(Error.prototype),_i.prototype.constructor=_i),_i.prototype.toString=function(){var e=this.name+": "+this.message;return jt(this.stack)&&(e+="\n"+this.stack.toString()),e};var mi={},yi={};mi.add=function(e,t){if(!jt(e))throw new Ht("host is required.");if(!jt(t)||t<=0)throw new Ht("port is required to be greater than 0.");var r=e.toLowerCase()+":"+t;jt(yi[r])||(yi[r]=!0)},mi.remove=function(e,t){if(!jt(e))throw new Ht("host is required.");if(!jt(t)||t<=0)throw new Ht("port is required to be greater than 0.");var r=e.toLowerCase()+":"+t;jt(yi[r])&&delete yi[r]},mi.contains=function(e){if(!jt(e))throw new Ht("url is required.");var t=function(e){var t=new vn(e);t.normalize();var r=t.getAuthority();if(jt(r)){if(-1!==r.indexOf("@")){var n=r.split("@");r=n[1]}if(-1===r.indexOf(":")){var i=t.getScheme();if(jt(i)||(i=(i=window.location.protocol).substring(0,i.length-1)),"http"===i)r+=":80";else{if("https"!==i)return;r+=":443"}}return r}}(e);return!(!jt(t)||!jt(yi[t]))},mi.clear=function(){yi={}};var Ei=Object.freeze({Error:"cacheError"});const xi=function(){try{const e=new XMLHttpRequest;return e.open("GET","#",!0),e.responseType="blob","blob"===e.responseType}catch(e){return!1}}();function Ci(e){"string"==typeof(e=Yt(e,Yt.EMPTY_OBJECT))&&(e={url:e}),qt.typeOf.string("options.url",e.url),this._url=void 0,this._templateValues=bi(e.templateValues,{}),this._queryParameters=bi(e.queryParameters,{}),this.headers=bi(e.headers,{}),this.request=Yt(e.request,new Hn),this.dbConnector=e.dbConnector,this.proxy=e.proxy,this.retryCallback=e.retryCallback,this.retryAttempts=Yt(e.retryAttempts,0),this._retryCount=0;Yt(e.parseUrl,!0)?this.parseUrl(e.url,!0,!0):this._url=e.url,this._credits=e.credits}function bi(e,t){return jt(e)?bn(e):t}let Ii;function Ti(e,t,r){if(!r)return In(e,t);const n=bn(e,!0);for(const e in t)if(t.hasOwnProperty(e)){let r=n[e];const i=t[e];jt(r)?(Array.isArray(r)||(r=n[e]=[r]),n[e]=r.concat(i)):n[e]=Array.isArray(i)?i.slice():i}return n}function vi(e){const t=e.resource,r=e.flipY,n=e.skipColorSpaceConversion,i=e.preferImageBitmap,o=t.request;o.url=t.url,o.requestFunction=function(){let e=!1;t.isDataUri||t.isBlobUri||(e=t.isCrossOriginUrl);const s=Tn();return jt(t.dbConnector)?t.dbConnector.getElementFromDB(o.url,"blob").then((a=>a===Ei.Error?(Ci._Implementations.createImage(o,e,s,r,n,i,t.dbConnector),s.promise):a)):(Ci._Implementations.createImage(o,e,s,r,n,i),s.promise)};const s=oi.request(o);if(jt(s))return s.catch((function(e){return o.state!==zn.FAILED?Promise.reject(e):t.retryOnError(e).then((function(s){return s?(o.state=zn.UNISSUED,o.deferred=void 0,vi({resource:t,flipY:r,skipColorSpaceConversion:n,preferImageBitmap:i})):Promise.reject(e)}))}))}function Ri(e,t,r){const n={};n[t]=r,e.setQueryParameters(n);const i=e.request,o=e.url;i.url=o,i.requestFunction=function(){const e=Tn();return window[r]=function(t){e.resolve(t);try{delete window[r]}catch(e){window[r]=void 0}},Ci._Implementations.loadAndExecuteScript(o,r,e),e.promise};const s=oi.request(i);if(jt(s))return s.catch((function(n){return i.state!==zn.FAILED?Promise.reject(n):e.retryOnError(n).then((function(o){return o?(i.state=zn.UNISSUED,i.deferred=void 0,Ri(e,t,r)):Promise.reject(n)}))}))}function Mi(e){if(e.state===zn.ISSUED||e.state===zn.ACTIVE)throw new _i("The Resource is already being fetched.");e.state=zn.UNISSUED,e.deferred=void 0}Ci.createIfNeeded=function(e){return e instanceof Ci?e.getDerivedResource({request:e.request}):"string"!=typeof e?e:new Ci({url:e})},Ci.supportsImageBitmapOptions=function(){if(jt(Ii))return Ii;if("function"!=typeof createImageBitmap)return Ii=Promise.resolve(!1),Ii;return Ii=Ci.fetchBlob({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAABGdBTUEAAE4g3rEiDgAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAADElEQVQI12Ng6GAAAAEUAIngE3ZiAAAAAElFTkSuQmCC"}).then((function(e){return Promise.all([createImageBitmap(e,{imageOrientation:"flipY",premultiplyAlpha:"none",colorSpaceConversion:"none"}),createImageBitmap(e)])})).then((function(e){const t=Pn(e[0]),r=Pn(e[1]);return t[1]!==r[1]})).catch((function(){return!1})),Ii},Object.defineProperties(Ci,{isBlobSupported:{get:function(){return xi}}}),Object.defineProperties(Ci.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(e){this.parseUrl(e,!1,!1)}},extension:{get:function(){return function(e){if(!jt(e))throw new Ht("uri is required.");var t=new vn(e);t.normalize();var r=t.path,n=r.lastIndexOf("/");return-1!==n&&(r=r.substr(n+1)),n=r.lastIndexOf("."),-1===n?"":r.substr(n+1)}(this._url)}},isDataUri:{get:function(){return Qn(this._url)}},isBlobUri:{get:function(){return Un(this._url)}},isCrossOriginUrl:{get:function(){return function(e){jt(Nn)||(Nn=document.createElement("a")),Nn.href=window.location.href;var t=Nn.host,r=Nn.protocol;return Nn.href=e,Nn.href=Nn.href,r!==Nn.protocol||t!==Nn.host}(this._url)}},hasHeaders:{get:function(){return Object.keys(this.headers).length>0}},credits:{get:function(){return this._credits}}}),Ci.prototype.toString=function(){return this.getUrlComponent(!0,!0)},Ci.prototype.parseUrl=function(e,t,r,n){let i=new Cn(e);const o=function(e){if(0===e.length)return{};if(-1===e.indexOf("="))return{[e]:void 0};return function(e){if(!jt(e))throw new Ht("queryString is required.");var t={};if(""===e)return t;for(var r=e.replace(/\+/g,"%20").split(/[&;]/),n=0,i=r.length;n<i;++n){var o=r[n].split("=");if(o.length>2){var s=r[n].indexOf("=");o=[r[n].substring(0,s),r[n].substring(s+1,r[n].length)]}var a=decodeURIComponent(o[0]),u=o[1];u=jt(u)?decodeURIComponent(u):"";var c=t[a];"string"==typeof c?t[a]=[c,u]:Array.isArray(c)?c.push(u):t[a]=u}return t}(e)}(i.query());this._queryParameters=t?Ti(o,this.queryParameters,r):o,i.search(""),i.fragment(""),jt(n)&&""===i.scheme()&&(i=i.absoluteTo(Dn(n))),this._url=i.toString()},Ci.prototype.getUrlComponent=function(e,t){if(this.isDataUri)return this._url;let r=this._url;e&&(r=`${r}${function(e){const t=Object.keys(e);if(0===t.length)return"";if(1===t.length&&!jt(e[t[0]]))return`?${t[0]}`;return`?${kn(e)}`}(this.queryParameters)}`),r=r.replace(/%7B/g,"{").replace(/%7D/g,"}");const n=this._templateValues;return Object.keys(n).length>0&&(r=r.replace(/{(.*?)}/g,(function(e,t){const r=n[t];return jt(r)&&"s"===t?encodeURI(r):jt(r)?encodeURIComponent(r):e}))),t&&jt(this.proxy)&&(r=this.proxy.getURL(r)),r},Ci.prototype.setQueryParameters=function(e,t){this._queryParameters=t?Ti(this._queryParameters,e,!1):Ti(e,this._queryParameters,!1)},Ci.prototype.appendQueryParameters=function(e){this._queryParameters=Ti(e,this._queryParameters,!0)},Ci.prototype.setTemplateValues=function(e,t){this._templateValues=t?In(this._templateValues,e):In(e,this._templateValues)},Ci.prototype.getDerivedResource=function(e){const t=this.clone();if(t._retryCount=0,jt(e.url)){const r=Yt(e.preserveQueryParameters,!1);t.parseUrl(e.url,!0,r,this._url)}return jt(e.queryParameters)&&(t._queryParameters=In(e.queryParameters,t.queryParameters)),jt(e.templateValues)&&(t._templateValues=In(e.templateValues,t.templateValues)),jt(e.headers)&&(t.headers=In(e.headers,t.headers)),jt(e.proxy)&&(t.proxy=e.proxy),jt(e.request)&&(t.request=e.request),jt(e.retryCallback)&&(t.retryCallback=e.retryCallback),jt(e.retryAttempts)&&(t.retryAttempts=e.retryAttempts),t},Ci.prototype.retryOnError=function(e){const t=this.retryCallback;if("function"!=typeof t||this._retryCount>=this.retryAttempts)return Promise.resolve(!1);const r=this;return Promise.resolve(t(this,e)).then((function(e){return++r._retryCount,e}))},Ci.prototype.clone=function(e){return jt(e)?(e._url=this._url,e._queryParameters=bn(this._queryParameters),e._templateValues=bn(this._templateValues),e.headers=bn(this.headers),e.proxy=this.proxy,e.retryCallback=this.retryCallback,e.retryAttempts=this.retryAttempts,e._retryCount=0,e.request=this.request.clone(),e.dbConnector=this.dbConnector,e):new Ci({url:this._url,queryParameters:this.queryParameters,templateValues:this.templateValues,headers:this.headers,proxy:this.proxy,retryCallback:this.retryCallback,retryAttempts:this.retryAttempts,request:this.request.clone(),parseUrl:!1,credits:jt(this.credits)?this.credits.slice():void 0})},Ci.prototype.getBaseUri=function(e){return function(e,t){if(!jt(e))throw new Ht("uri is required.");var r="",n=e.lastIndexOf("/");return-1!==n&&(r=e.substring(0,n+1)),t?(jt((e=new vn(e)).query)&&(r+="?"+e.query),jt(e.fragment)&&(r+="#"+e.fragment),r):r}(this.getUrlComponent(e),e)},Ci.prototype.appendForwardSlash=function(){var e;this._url=(0!==(e=this._url).length&&"/"===e[e.length-1]||(e+="/"),e)},Ci.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})},Ci.fetchArrayBuffer=function(e){return new Ci(e).fetchArrayBuffer()},Ci.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})},Ci.fetchBlob=function(e){return new Ci(e).fetchBlob()},Ci.prototype.fetchImage=function(e){e=Yt(e,Yt.EMPTY_OBJECT);const t=Yt(e.preferImageBitmap,!1),r=Yt(e.preferBlob,!1),n=Yt(e.flipY,!1),i=Yt(e.skipColorSpaceConversion,!1);if(Mi(this.request),!xi||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!r)return vi({resource:this,flipY:n,skipColorSpaceConversion:i,preferImageBitmap:t});const o=this.fetchBlob();if(!jt(o))return;let s,a,u,c;return Ci.supportsImageBitmapOptions().then((function(e){return s=e,a=s&&t,o})).then((function(e){if(!jt(e))return;if(c=e,a)return Ci.createImageBitmapFromBlob(e,{flipY:n,premultiplyAlpha:!1,skipColorSpaceConversion:i});const t=window.URL.createObjectURL(e);return u=new Ci({url:t}),vi({resource:u,flipY:n,skipColorSpaceConversion:i,preferImageBitmap:!1})})).then((function(e){if(jt(e))return e.blob=c,a||window.URL.revokeObjectURL(u.url),e})).catch((function(e){return jt(u)&&window.URL.revokeObjectURL(u.url),e.blob=c,Promise.reject(e)}))},Ci.fetchImage=function(e){return new Ci(e).fetchImage({flipY:e.flipY,skipColorSpaceConversion:e.skipColorSpaceConversion,preferBlob:e.preferBlob,preferImageBitmap:e.preferImageBitmap})},Ci.prototype.fetchText=function(){return this.fetch({responseType:"text"})},Ci.fetchText=function(e){return new Ci(e).fetchText()},Ci.prototype.fetchJson=function(){const e=this.fetch({responseType:"text",headers:{Accept:"application/json,*/*;q=0.01"}});if(jt(e))return e.then((function(e){if(jt(e))return JSON.parse(e)}))},Ci.fetchJson=function(e){return new Ci(e).fetchJson()},Ci.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})},Ci.fetchXML=function(e){return new Ci(e).fetchXML()},Ci.prototype.fetchJsonp=function(e){let t;e=Yt(e,"callback"),Mi(this.request);do{t=`loadJsonp${Wt.nextRandomNumber().toString().substring(2,8)}`}while(jt(window[t]));return Ri(this,e,t)},Ci.fetchJsonp=function(e){return new Ci(e).fetchJsonp(e.callbackParameterName)},Ci.prototype._makeRequest=function(e){const t=this;Mi(t.request);const r=t.request,n=t.url;r.url=n,r.requestFunction=function(n){const i=e.responseType,o=In(e.headers,t.headers),s=e.overrideMimeType,a=e.method,u=e.data,c=Tn(),l=jt(n)?n:t.url;if(jt(t.dbConnector))return t.dbConnector.getElementFromDB(l,i).then((e=>{if(e===Ei.Error){var n=Ci._Implementations.loadWithXhr(l,i,a,u,o,c,s,t.dbConnector);return jt(n)&&jt(n.abort)&&(r.cancelFunction=function(){n.abort()}),c.promise}return e}));const h=Ci._Implementations.loadWithXhr(l,i,a,u,o,c,s);return jt(h)&&jt(h.abort)&&(r.cancelFunction=function(){h.abort()}),c.promise};const i=oi.request(r);if(jt(i))return i.then((function(e){return r.cancelFunction=void 0,e})).catch((function(n){return r.cancelFunction=void 0,r.state!==zn.FAILED?Promise.reject(n):t.retryOnError(n).then((function(i){return i?(r.state=zn.UNISSUED,r.deferred=void 0,t.fetch(e)):Promise.reject(n)}))}))};const wi=/^data:(.*?)(;base64)?,(.*)$/;function Si(e,t){const r=decodeURIComponent(t);return e?atob(r):r}function Bi(e,t){const r=Si(e,t),n=new ArrayBuffer(r.length),i=new Uint8Array(n);for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e);return n}Ci.prototype.fetch=function(e){return(e=bi(e,{})).method="GET",this._makeRequest(e)},Ci.fetch=function(e){return new Ci(e).fetch({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Ci.prototype.delete=function(e){return(e=bi(e,{})).method="DELETE",this._makeRequest(e)},Ci.delete=function(e){return new Ci(e).delete({responseType:e.responseType,overrideMimeType:e.overrideMimeType,data:e.data})},Ci.prototype.head=function(e){return(e=bi(e,{})).method="HEAD",this._makeRequest(e)},Ci.head=function(e){return new Ci(e).head({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Ci.prototype.options=function(e){return(e=bi(e,{})).method="OPTIONS",this._makeRequest(e)},Ci.options=function(e){return new Ci(e).options({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Ci.prototype.post=function(e,t){return qt.defined("data",e),(t=bi(t,{})).method="POST",t.data=e,this._makeRequest(t)},Ci.post=function(e){return new Ci(e).post(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Ci.prototype.put=function(e,t){return qt.defined("data",e),(t=bi(t,{})).method="PUT",t.data=e,this._makeRequest(t)},Ci.put=function(e){return new Ci(e).put(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Ci.prototype.patch=function(e,t){return qt.defined("data",e),(t=bi(t,{})).method="PATCH",t.data=e,this._makeRequest(t)},Ci.patch=function(e){return new Ci(e).patch(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Ci._Implementations={},Ci._Implementations.loadImageElement=function(e,t,r){const n=new Image;n.onload=function(){0===n.naturalWidth&&0===n.naturalHeight&&0===n.width&&0===n.height&&(n.width=300,n.height=150),r.resolve(n)},n.onerror=function(e){r.reject(e)},t&&(mi.contains(e)?n.crossOrigin="use-credentials":n.crossOrigin=""),n.src=e},Ci._Implementations.createImage=function(e,t,r,n,i,o,s){const a=e.url;Ci.supportsImageBitmapOptions().then((function(u){if(!u||!o)return void Ci._Implementations.loadImageElement(a,t,r);const c=Tn(),l=Ci._Implementations.loadWithXhr(a,"blob","GET",void 0,void 0,c,void 0,s);return jt(l)&&jt(l.abort)&&(e.cancelFunction=function(){l.abort()}),c.promise.then((function(e){if(jt(e))return Ci.createImageBitmapFromBlob(e,{flipY:n,premultiplyAlpha:!1,skipColorSpaceConversion:i});r.reject(new _i(`Successfully retrieved ${a} but it contained no content.`))})).then((function(e){r.resolve(e)}))})).catch((function(e){r.reject(e)}))},Ci.createImageBitmapFromBlob=function(e,t){return qt.defined("options",t),qt.typeOf.bool("options.flipY",t.flipY),qt.typeOf.bool("options.premultiplyAlpha",t.premultiplyAlpha),qt.typeOf.bool("options.skipColorSpaceConversion",t.skipColorSpaceConversion),createImageBitmap(e,{imageOrientation:t.flipY?"flipY":"none",premultiplyAlpha:t.premultiplyAlpha?"premultiply":"none",colorSpaceConversion:t.skipColorSpaceConversion?"none":"default"})};const Oi="undefined"==typeof XMLHttpRequest;function Di(e){if(e=Yt(e,Yt.EMPTY_OBJECT),this._dates=void 0,this._samples=void 0,this._dateColumn=-1,this._xPoleWanderRadiansColumn=-1,this._yPoleWanderRadiansColumn=-1,this._ut1MinusUtcSecondsColumn=-1,this._xCelestialPoleOffsetRadiansColumn=-1,this._yCelestialPoleOffsetRadiansColumn=-1,this._taiMinusUtcSecondsColumn=-1,this._columnCount=0,this._lastIndex=-1,this._downloadPromise=void 0,this._dataError=void 0,this._addNewLeapSeconds=Yt(e.addNewLeapSeconds,!0),jt(e.data))Pi(this,e.data);else if(jt(e.url)){var t=Ci.createIfNeeded(e.url),r=this;this._downloadPromise=Promise.resolve(t.fetchJson()).then((function(e){Pi(r,e)})).catch((function(){r._dataError="An error occurred while retrieving the EOP data from the URL "+t.url+"."}))}else Pi(this,{columnNames:["dateIso8601","modifiedJulianDateUtc","xPoleWanderRadians","yPoleWanderRadians","ut1MinusUtcSeconds","lengthOfDayCorrectionSeconds","xCelestialPoleOffsetRadians","yCelestialPoleOffsetRadians","taiMinusUtcSeconds"],samples:[]})}function Fi(e,t){return nn.compare(e.julianDate,t)}function Pi(e,t){if(jt(t.columnNames))if(jt(t.samples)){var r=t.columnNames.indexOf("modifiedJulianDateUtc"),n=t.columnNames.indexOf("xPoleWanderRadians"),i=t.columnNames.indexOf("yPoleWanderRadians"),o=t.columnNames.indexOf("ut1MinusUtcSeconds"),s=t.columnNames.indexOf("xCelestialPoleOffsetRadians"),a=t.columnNames.indexOf("yCelestialPoleOffsetRadians"),u=t.columnNames.indexOf("taiMinusUtcSeconds");if(r<0||n<0||i<0||o<0||s<0||a<0||u<0)e._dataError="Error in loaded EOP data: The columnNames property must include modifiedJulianDateUtc, xPoleWanderRadians, yPoleWanderRadians, ut1MinusUtcSeconds, xCelestialPoleOffsetRadians, yCelestialPoleOffsetRadians, and taiMinusUtcSeconds columns";else{var c,l=e._samples=t.samples,h=e._dates=[];e._dateColumn=r,e._xPoleWanderRadiansColumn=n,e._yPoleWanderRadiansColumn=i,e._ut1MinusUtcSecondsColumn=o,e._xCelestialPoleOffsetRadiansColumn=s,e._yCelestialPoleOffsetRadiansColumn=a,e._taiMinusUtcSecondsColumn=u,e._columnCount=t.columnNames.length,e._lastIndex=void 0;for(var p=e._addNewLeapSeconds,d=0,f=l.length;d<f;d+=e._columnCount){var A=l[d+r],g=l[d+u],_=new nn(A+Lr.MODIFIED_JULIAN_DATE_DIFFERENCE,g,Ur.TAI);if(h.push(_),p){if(g!==c&&jt(c)){var m=nn.leapSeconds,y=Br(m,_,Fi);if(y<0){var E=new Nr(_,g);m.splice(~y,0,E)}}c=g}}}}else e._dataError="Error in loaded EOP data: The samples property is required.";else e._dataError="Error in loaded EOP data: The columnNames property is required."}function Ni(e,t,r,n,i){var o=r*n;i.xPoleWander=t[o+e._xPoleWanderRadiansColumn],i.yPoleWander=t[o+e._yPoleWanderRadiansColumn],i.xPoleOffset=t[o+e._xCelestialPoleOffsetRadiansColumn],i.yPoleOffset=t[o+e._yCelestialPoleOffsetRadiansColumn],i.ut1MinusUtc=t[o+e._ut1MinusUtcSecondsColumn]}function Li(e,t,r){return t+e*(r-t)}function Ui(e,t,r,n,i,o,s){var a=e._columnCount;if(o>t.length-1)return s.xPoleWander=0,s.yPoleWander=0,s.xPoleOffset=0,s.yPoleOffset=0,s.ut1MinusUtc=0,s;var u=t[i],c=t[o];if(u.equals(c)||n.equals(u))return Ni(e,r,i,a,s),s;if(n.equals(c))return Ni(e,r,o,a,s),s;var l=nn.secondsDifference(n,u)/nn.secondsDifference(c,u),h=i*a,p=o*a,d=r[h+e._ut1MinusUtcSecondsColumn],f=r[p+e._ut1MinusUtcSecondsColumn],A=f-d;if(A>.5||A<-.5){var g=r[h+e._taiMinusUtcSecondsColumn],_=r[p+e._taiMinusUtcSecondsColumn];g!==_&&(c.equals(n)?d=f:f-=_-g)}return s.xPoleWander=Li(l,r[h+e._xPoleWanderRadiansColumn],r[p+e._xPoleWanderRadiansColumn]),s.yPoleWander=Li(l,r[h+e._yPoleWanderRadiansColumn],r[p+e._yPoleWanderRadiansColumn]),s.xPoleOffset=Li(l,r[h+e._xCelestialPoleOffsetRadiansColumn],r[p+e._xCelestialPoleOffsetRadiansColumn]),s.yPoleOffset=Li(l,r[h+e._yCelestialPoleOffsetRadiansColumn],r[p+e._yCelestialPoleOffsetRadiansColumn]),s.ut1MinusUtc=Li(l,d,f),s}function Gi(e,t,r,n){t=Yt(t,0),r=Yt(r,0),n=Yt(n,0),qt.typeOf.number.greaterThanOrEquals("x",t,0),qt.typeOf.number.greaterThanOrEquals("y",r,0),qt.typeOf.number.greaterThanOrEquals("z",n,0),e._radii=new Zt(t,r,n),e._radiiSquared=new Zt(t*t,r*r,n*n),e._radiiToTheFourth=new Zt(t*t*t*t,r*r*r*r,n*n*n*n),e._oneOverRadii=new Zt(0===t?0:1/t,0===r?0:1/r,0===n?0:1/n),e._oneOverRadiiSquared=new Zt(0===t?0:1/(t*t),0===r?0:1/(r*r),0===n?0:1/(n*n)),e._minimumRadius=Math.min(t,r,n),e._maximumRadius=Math.max(t,r,n),e._centerToleranceSquared=Wt.EPSILON1,0!==e._radiiSquared.z&&(e._squaredXOverSquaredZ=e._radiiSquared.x/e._radiiSquared.z)}function Qi(e,t,r){this._radii=void 0,this._radiiSquared=void 0,this._radiiToTheFourth=void 0,this._oneOverRadii=void 0,this._oneOverRadiiSquared=void 0,this._minimumRadius=void 0,this._maximumRadius=void 0,this._centerToleranceSquared=void 0,this._squaredXOverSquaredZ=void 0,Gi(this,e,t,r)}Ci._Implementations.loadWithXhr=function(e,t,r,n,i,o,s,a){var u=e;const c=wi.exec(e);if(null!==c)return void o.resolve(function(e,t){t=Yt(t,"");const r=e[1],n=!!e[2],i=e[3];let o,s;switch(t){case"":case"text":return Si(n,i);case"arraybuffer":return Bi(n,i);case"blob":return o=Bi(n,i),new Blob([o],{type:r});case"document":return s=new DOMParser,s.parseFromString(Si(n,i),r);case"json":return JSON.parse(Si(n,i));default:throw new Ht(`Unhandled responseType: ${t}`)}}(c,t));if(Oi)return void function(e,t,r,n,i,o){fetch(e,{method:r,headers:i}).then((async e=>{if(!e.ok){const t={};return e.headers.forEach(((e,r)=>{t[r]=e})),void o.reject(new qn(e.status,e,t))}switch(t){case"text":o.resolve(e.text());break;case"json":o.resolve(e.json());break;default:o.resolve(new Uint8Array(await e.arrayBuffer()).buffer)}})).catch((()=>{o.reject(new qn)}))}(e,t,r,0,i,o);const l=new XMLHttpRequest;if(mi.contains(e)&&(l.withCredentials=!0),e=e.replace(/{/g,"%7B").replace(/}/g,"%7D"),l.open(r,e,!0),jt(s)&&jt(l.overrideMimeType)&&l.overrideMimeType(s),jt(i))for(const e in i)i.hasOwnProperty(e)&&l.setRequestHeader(e,i[e]);jt(t)&&(l.responseType=t);let h=!1;return"string"==typeof e&&(h=0===e.indexOf("file://")||"undefined"!=typeof window&&"file://"===window.location.origin),l.onload=function(){if((l.status<200||l.status>=300)&&(!h||0!==l.status))return void o.reject(new qn(l.status,l.response,l.getAllResponseHeaders()));const e=l.response,n=l.responseType;if("HEAD"===r||"OPTIONS"===r){const e=l.getAllResponseHeaders().trim().split(/[\r\n]+/),t={};return e.forEach((function(e){const r=e.split(": "),n=r.shift();t[n]=r.join(": ")})),void o.resolve(t)}if(204===l.status)o.resolve(void 0);else if(!jt(e)||jt(t)&&n!==t)if("json"===t&&"string"==typeof e)try{o.resolve(JSON.parse(e))}catch(e){o.reject(e)}else(""===n||"document"===n)&&jt(l.responseXML)&&l.responseXML.hasChildNodes()?o.resolve(l.responseXML):""!==n&&"text"!==n||!jt(l.responseText)?o.reject(new _i("Invalid XMLHttpRequest response type.")):o.resolve(l.responseText);else jt(a)&&a.putElementInDB(void 0,u,e),o.resolve(e)},l.onerror=function(e){o.reject(new qn)},l.send(n),l},Ci._Implementations.loadAndExecuteScript=function(e,t,r){return function(e){var t=Tn(),r=document.createElement("script");r.async=!0,r.src=e;var n=document.getElementsByTagName("head")[0];return r.onload=function(){r.onload=void 0,n.removeChild(r),t.resolve()},r.onerror=function(e){t.reject(e)},n.appendChild(r),t.promise}(e).catch((function(e){r.reject(e)}))},Ci._DefaultImplementations={},Ci._DefaultImplementations.createImage=Ci._Implementations.createImage,Ci._DefaultImplementations.loadWithXhr=Ci._Implementations.loadWithXhr,Ci._DefaultImplementations.loadAndExecuteScript=Ci._Implementations.loadAndExecuteScript,Ci.DEFAULT=Object.freeze(new Ci({url:"undefined"==typeof document?"":document.location.href.split("?")[0]})),Di.NONE=Object.freeze({getPromiseToLoad:function(){return Promise.resolve()},compute:function(e,t){return jt(t)?(t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0):t=new Or(0,0,0,0,0),t}}),Di.prototype.getPromiseToLoad=function(){return Promise.resolve(this._downloadPromise)},Di.prototype.compute=function(e,t){if(jt(this._samples)){if(jt(t)||(t=new Or(0,0,0,0,0)),0===this._samples.length)return t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0,t;var r=this._dates,n=this._lastIndex,i=0,o=0;if(jt(n)){var s=r[n],a=r[n+1],u=nn.lessThanOrEquals(s,e),c=!jt(a),l=c||nn.greaterThanOrEquals(a,e);if(u&&l)return i=n,!c&&a.equals(e)&&++i,o=i+1,Ui(this,r,this._samples,e,i,o,t),t}var h=Br(r,e,nn.compare,this._dateColumn);return h>=0?(h<r.length-1&&r[h+1].equals(e)&&++h,i=h,o=h):(i=(o=~h)-1)<0&&(i=0),this._lastIndex=i,Ui(this,r,this._samples,e,i,o,t),t}if(jt(this._dataError))throw new _i(this._dataError)},Object.defineProperties(Qi.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}}),Qi.clone=function(e,t){if(jt(e)){var r=e._radii;return jt(t)?(Zt.clone(r,t._radii),Zt.clone(e._radiiSquared,t._radiiSquared),Zt.clone(e._radiiToTheFourth,t._radiiToTheFourth),Zt.clone(e._oneOverRadii,t._oneOverRadii),Zt.clone(e._oneOverRadiiSquared,t._oneOverRadiiSquared),t._minimumRadius=e._minimumRadius,t._maximumRadius=e._maximumRadius,t._centerToleranceSquared=e._centerToleranceSquared,t):new Qi(r.x,r.y,r.z)}},Qi.fromCartesian3=function(e,t){return jt(t)||(t=new Qi),jt(e)?(Gi(t,e.x,e.y,e.z),t):t},Qi.WGS84=Object.freeze(new Qi(6378137,6378137,6356752.314245179)),Qi.XIAN80=Object.freeze(new Qi(6378140,6378140,6356755.29)),Qi.CGCS2000=Object.freeze(new Qi(6378137,6378137,6356752.31)),Qi.UNIT_SPHERE=Object.freeze(new Qi(1,1,1)),Qi.MOON=Object.freeze(new Qi(Wt.LUNAR_RADIUS,Wt.LUNAR_RADIUS,Wt.LUNAR_RADIUS)),Qi.prototype.clone=function(e){return Qi.clone(this,e)},Qi.packedLength=Zt.packedLength,Qi.pack=function(e,t,r){return qt.typeOf.object("value",e),qt.defined("array",t),r=Yt(r,0),Zt.pack(e._radii,t,r),t},Qi.unpack=function(e,t,r){qt.defined("array",e),t=Yt(t,0);var n=Zt.unpack(e,t);return Qi.fromCartesian3(n,r)},Qi.prototype.geocentricSurfaceNormal=Zt.normalize,Qi.prototype.geodeticSurfaceNormalCartographic=function(e,t){qt.typeOf.object("cartographic",e);var r=e.longitude,n=e.latitude,i=Math.cos(n),o=i*Math.cos(r),s=i*Math.sin(r),a=Math.sin(n);return jt(t)||(t=new Zt),t.x=o,t.y=s,t.z=a,Zt.normalize(t,t)},Qi.prototype.geodeticSurfaceNormal=function(e,t){return jt(t)||(t=new Zt),t=Zt.multiplyComponents(e,this._oneOverRadiiSquared,t),Zt.normalize(t,t)};var ki=new Zt,zi=new Zt;Qi.prototype.cartographicToCartesian=function(e,t){var r=ki,n=zi;this.geodeticSurfaceNormalCartographic(e,r),Zt.multiplyComponents(this._radiiSquared,r,n);var i=Math.sqrt(Zt.dot(r,n));return Zt.divideByScalar(n,i,n),Zt.multiplyByScalar(r,e.height,r),jt(t)||(t=new Zt),Zt.add(n,r,t)},Qi.prototype.cartographicArrayToCartesianArray=function(e,t){qt.defined("cartographics",e);var r=e.length;jt(t)?t.length=r:t=new Array(r);for(var n=0;n<r;n++)t[n]=this.cartographicToCartesian(e[n],t[n]);return t};var ji=new Zt,Hi=new Zt,qi=new Zt;Qi.prototype.cartesianToCartographic=function(e,t){var r=this.scaleToGeodeticSurface(e,Hi);if(jt(r)){var n=this.geodeticSurfaceNormal(r,ji),i=Zt.subtract(e,r,qi),o=Math.atan2(n.y,n.x),s=Math.asin(n.z),a=Wt.sign(Zt.dot(i,e))*Zt.magnitude(i);return jt(t)?(t.longitude=o,t.latitude=s,t.height=a,t):new lr(o,s,a)}},Qi.prototype.cartesianArrayToCartographicArray=function(e,t){qt.defined("cartesians",e);var r=e.length;jt(t)?t.length=r:t=new Array(r);for(var n=0;n<r;++n)t[n]=this.cartesianToCartographic(e[n],t[n]);return t},Qi.prototype.scaleToGeodeticSurface=function(e,t){return cr(e,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,t)},Qi.prototype.scaleToGeocentricSurface=function(e,t){qt.typeOf.object("cartesian",e),jt(t)||(t=new Zt);var r=e.x,n=e.y,i=e.z,o=this._oneOverRadiiSquared,s=1/Math.sqrt(r*r*o.x+n*n*o.y+i*i*o.z);return Zt.multiplyByScalar(e,s,t)},Qi.prototype.transformPositionToScaledSpace=function(e,t){return jt(t)||(t=new Zt),Zt.multiplyComponents(e,this._oneOverRadii,t)},Qi.prototype.transformPositionFromScaledSpace=function(e,t){return jt(t)||(t=new Zt),Zt.multiplyComponents(e,this._radii,t)},Qi.prototype.equals=function(e){return this===e||jt(e)&&Zt.equals(this._radii,e._radii)},Qi.prototype.toString=function(){return this._radii.toString()},Qi.prototype.getSurfaceNormalIntersectionWithZAxis=function(e,t,r){if(qt.typeOf.object("position",e),!Wt.equalsEpsilon(this._radii.x,this._radii.y,Wt.EPSILON15))throw new Ht("Ellipsoid must be an ellipsoid of revolution (radii.x == radii.y)");qt.typeOf.number.greaterThan("Ellipsoid.radii.z",this._radii.z,0),t=Yt(t,0);var n=this._squaredXOverSquaredZ;if(jt(r)||(r=new Zt),r.x=0,r.y=0,r.z=e.z*(1-n),!(Math.abs(r.z)>=this._radii.z-t))return r};const Vi=new Zt;function Yi(e,t,r){this.heading=Yt(e,0),this.pitch=Yt(t,0),this.roll=Yt(r,0)}Qi.prototype.getLocalCurvature=function(e,t){qt.typeOf.object("surfacePosition",e),jt(t)||(t=new _r);const r=this.getSurfaceNormalIntersectionWithZAxis(e,0,Vi),n=Zt.distance(e,r),i=n*(this.minimumRadius*n/this.maximumRadius**2)**2;return _r.fromElements(1/n,1/i,t)},Yi.fromQuaternion=function(e,t){if(!jt(e))throw new Ht("quaternion is required");jt(t)||(t=new Yi);var r=2*(e.w*e.y-e.z*e.x),n=1-2*(e.x*e.x+e.y*e.y),i=2*(e.w*e.x+e.y*e.z),o=1-2*(e.y*e.y+e.z*e.z),s=2*(e.w*e.z+e.x*e.y);return t.heading=-Math.atan2(s,o),t.roll=Math.atan2(i,n),t.pitch=-Wt.asinClamped(r),t},Yi.fromDegrees=function(e,t,r,n){if(!jt(e))throw new Ht("heading is required");if(!jt(t))throw new Ht("pitch is required");if(!jt(r))throw new Ht("roll is required");return jt(n)||(n=new Yi),n.heading=e*Wt.RADIANS_PER_DEGREE,n.pitch=t*Wt.RADIANS_PER_DEGREE,n.roll=r*Wt.RADIANS_PER_DEGREE,n},Yi.clone=function(e,t){if(jt(e))return jt(t)?(t.heading=e.heading,t.pitch=e.pitch,t.roll=e.roll,t):new Yi(e.heading,e.pitch,e.roll)},Yi.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e.heading===t.heading&&e.pitch===t.pitch&&e.roll===t.roll},Yi.equalsEpsilon=function(e,t,r,n){return e===t||jt(e)&&jt(t)&&Wt.equalsEpsilon(e.heading,t.heading,r,n)&&Wt.equalsEpsilon(e.pitch,t.pitch,r,n)&&Wt.equalsEpsilon(e.roll,t.roll,r,n)},Yi.prototype.clone=function(e){return Yi.clone(this,e)},Yi.prototype.equals=function(e){return Yi.equals(this,e)},Yi.prototype.equalsEpsilon=function(e,t,r){return Yi.equalsEpsilon(this,e,t,r)},Yi.prototype.toString=function(){return"("+this.heading+", "+this.pitch+", "+this.roll+")"};var Xi,Wi,Ki,Ji=/((?:.*\/)|^)SuperMap3D\.js$/;function Zi(e){return"undefined"==typeof document?e:(jt(Xi)||(Xi=document.createElement("a")),Xi.href=e,Xi.href=Xi.href,Xi.href)}function $i(){if(jt(Wi))return Wi;var e;if(e="undefined"!=typeof SUPERMAP3D_BASE_URL?SUPERMAP3D_BASE_URL:"object"==typeof define&&jt(define.amd)&&!define.amd.toUrlUndefined&&jt(require.toUrl)?Dn("..",ro("Core/buildModuleUrl.js")):function(){for(var e=document.getElementsByTagName("script"),t=0,r=e.length;t<r;++t){var n=e[t].getAttribute("src"),i=Ji.exec(n);if(null!==i)return i[1]}}(),!jt(e))throw new Ht("Unable to determine SuperMap3D base URL automatically, try defining a global variable called SUPERMAP3D_BASE_URL.");return(Wi=new Ci({url:Zi(e)})).appendForwardSlash(),Wi}function eo(e){return Zi(require.toUrl("../"+e))}function to(e){return $i().getDerivedResource({url:e}).url}function ro(e){return jt(Ki)||(Ki="object"==typeof define&&jt(define.amd)&&!define.amd.toUrlUndefined&&jt(require.toUrl)?eo:to),Ki(e)}function no(e,t,r){this.x=e,this.y=t,this.s=r}function io(e){e=Yt(e,Yt.EMPTY_OBJECT),this._xysFileUrlTemplate=Ci.createIfNeeded(e.xysFileUrlTemplate),this._interpolationOrder=Yt(e.interpolationOrder,9),this._sampleZeroJulianEphemerisDate=Yt(e.sampleZeroJulianEphemerisDate,2442396.5),this._sampleZeroDateTT=new nn(this._sampleZeroJulianEphemerisDate,0,Ur.TAI),this._stepSizeDays=Yt(e.stepSizeDays,1),this._samplesPerXysFile=Yt(e.samplesPerXysFile,1e3),this._totalSamples=Yt(e.totalSamples,27426),this._samples=new Array(3*this._totalSamples),this._chunkDownloadsInProgress=[];for(var t=this._interpolationOrder,r=this._denominators=new Array(t+1),n=this._xTable=new Array(t+1),i=Math.pow(this._stepSizeDays,t),o=0;o<=t;++o){r[o]=i,n[o]=o*this._stepSizeDays;for(var s=0;s<=t;++s)s!==o&&(r[o]*=o-s);r[o]=1/r[o]}this._work=new Array(t+1),this._coef=new Array(t+1)}ro._cesiumScriptRegex=Ji,ro._buildModuleUrlFromBaseUrl=to,ro._clearBaseResource=function(){Wi=void 0},ro.setBaseUrl=function(e){Wi=Ci.DEFAULT.getDerivedResource({url:e})},ro.getCesiumBaseUrl=$i;var oo=new nn(0,0,Ur.TAI);function so(e,t,r){var n=oo;return n.dayNumber=t,n.secondsOfDay=r,nn.daysDifference(n,e._sampleZeroDateTT)}function ao(e,t){if(e._chunkDownloadsInProgress[t])return e._chunkDownloadsInProgress[t];var r,n=Tn();e._chunkDownloadsInProgress[t]=n;var i=e._xysFileUrlTemplate;return r=jt(i)?i.getDerivedResource({templateValues:{0:t}}):new Ci({url:ro("Assets/IAU2006_XYS/IAU2006_XYS_"+t+".json")}),Promise.resolve(r.fetchJson()).then((function(r){e._chunkDownloadsInProgress[t]=!1;for(var i=e._samples,o=r.samples,s=t*e._samplesPerXysFile*3,a=0,u=o.length;a<u;++a)i[s+a]=o[a];n.resolve()})).catch((function(e){console.log(e)})),n.promise}function uo(e,t,r,n,i,o,s,a,u){this[0]=Yt(e,0),this[1]=Yt(n,0),this[2]=Yt(s,0),this[3]=Yt(t,0),this[4]=Yt(i,0),this[5]=Yt(a,0),this[6]=Yt(r,0),this[7]=Yt(o,0),this[8]=Yt(u,0),this.isMatrix3=!0}io.prototype.preload=function(e,t,r,n){var i=so(this,e,t),o=so(this,r,n),s=i/this._stepSizeDays-this._interpolationOrder/2|0;s<0&&(s=0);var a=o/this._stepSizeDays-this._interpolationOrder/2|0+this._interpolationOrder;a>=this._totalSamples&&(a=this._totalSamples-1);for(var u=s/this._samplesPerXysFile|0,c=a/this._samplesPerXysFile|0,l=[],h=u;h<=c;++h)l.push(ao(this,h));return Promise.all(l)},io.prototype.computeXysRadians=function(e,t,r){var n=so(this,e,t);if(!(n<0)){var i=n/this._stepSizeDays|0;if(!(i>=this._totalSamples)){var o=this._interpolationOrder,s=i-(o/2|0);s<0&&(s=0);var a=s+o;a>=this._totalSamples&&(s=(a=this._totalSamples-1)-o)<0&&(s=0);var u=!1,c=this._samples;if(jt(c[3*s])||(ao(this,s/this._samplesPerXysFile|0),u=!0),jt(c[3*a])||(ao(this,a/this._samplesPerXysFile|0),u=!0),!u){jt(r)?(r.x=0,r.y=0,r.s=0):r=new no(0,0,0);var l,h,p=n-s*this._stepSizeDays,d=this._work,f=this._denominators,A=this._coef,g=this._xTable;for(l=0;l<=o;++l)d[l]=p-g[l];for(l=0;l<=o;++l){for(A[l]=1,h=0;h<=o;++h)h!==l&&(A[l]*=d[h]);A[l]*=f[l];var _=3*(s+l);r.x+=A[l]*c[_++],r.y+=A[l]*c[_++],r.s+=A[l]*c[_]}return r}}}},uo.packedLength=9,uo.pack=function(e,t,r){return qt.typeOf.object("value",e),qt.defined("array",t),r=Yt(r,0),t[r++]=e[0],t[r++]=e[1],t[r++]=e[2],t[r++]=e[3],t[r++]=e[4],t[r++]=e[5],t[r++]=e[6],t[r++]=e[7],t[r++]=e[8],t},uo.unpack=function(e,t,r){return qt.defined("array",e),t=Yt(t,0),jt(r)||(r=new uo),r[0]=e[t++],r[1]=e[t++],r[2]=e[t++],r[3]=e[t++],r[4]=e[t++],r[5]=e[t++],r[6]=e[t++],r[7]=e[t++],r[8]=e[t++],r},uo.clone=function(e,t){if(jt(e))return jt(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):new uo(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])},uo.fromArray=function(e,t,r){return qt.defined("array",e),t=Yt(t,0),jt(r)||(r=new uo),r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],r[4]=e[t+4],r[5]=e[t+5],r[6]=e[t+6],r[7]=e[t+7],r[8]=e[t+8],r},uo.fromColumnMajorArray=function(e,t){return qt.defined("values",e),uo.clone(e,t)},uo.fromRowMajorArray=function(e,t){return qt.defined("values",e),jt(t)?(t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t):new uo(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},uo.fromQuaternion=function(e,t){qt.typeOf.object("quaternion",e);var r=e.x*e.x,n=e.x*e.y,i=e.x*e.z,o=e.x*e.w,s=e.y*e.y,a=e.y*e.z,u=e.y*e.w,c=e.z*e.z,l=e.z*e.w,h=e.w*e.w,p=r-s-c+h,d=2*(n-l),f=2*(i+u),A=2*(n+l),g=-r+s-c+h,_=2*(a-o),m=2*(i-u),y=2*(a+o),E=-r-s+c+h;return jt(t)?(t[0]=p,t[1]=A,t[2]=m,t[3]=d,t[4]=g,t[5]=y,t[6]=f,t[7]=_,t[8]=E,t):new uo(p,d,f,A,g,_,m,y,E)},uo.fromHeadingPitchRoll=function(e,t){qt.typeOf.object("headingPitchRoll",e);var r=Math.cos(-e.pitch),n=Math.cos(-e.heading),i=Math.cos(e.roll),o=Math.sin(-e.pitch),s=Math.sin(-e.heading),a=Math.sin(e.roll),u=r*n,c=-i*s+a*o*n,l=a*s+i*o*n,h=r*s,p=i*n+a*o*s,d=-a*n+i*o*s,f=-o,A=a*r,g=i*r;return jt(t)?(t[0]=u,t[1]=h,t[2]=f,t[3]=c,t[4]=p,t[5]=A,t[6]=l,t[7]=d,t[8]=g,t):new uo(u,c,l,h,p,d,f,A,g)},uo.fromScale=function(e,t){return qt.typeOf.object("scale",e),jt(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=e.y,t[5]=0,t[6]=0,t[7]=0,t[8]=e.z,t):new uo(e.x,0,0,0,e.y,0,0,0,e.z)},uo.fromUniformScale=function(e,t){return qt.typeOf.number("scale",e),jt(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=e,t):new uo(e,0,0,0,e,0,0,0,e)},uo.fromCrossProduct=function(e,t){return qt.typeOf.object("vector",e),jt(t)?(t[0]=0,t[1]=e.z,t[2]=-e.y,t[3]=-e.z,t[4]=0,t[5]=e.x,t[6]=e.y,t[7]=-e.x,t[8]=0,t):new uo(0,-e.z,e.y,e.z,0,-e.x,-e.y,e.x,0)},uo.fromRotationX=function(e,t){qt.typeOf.number("angle",e);var r=Math.cos(e),n=Math.sin(e);return jt(t)?(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=r,t[5]=n,t[6]=0,t[7]=-n,t[8]=r,t):new uo(1,0,0,0,r,-n,0,n,r)},uo.fromRotationY=function(e,t){qt.typeOf.number("angle",e);var r=Math.cos(e),n=Math.sin(e);return jt(t)?(t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=1,t[5]=0,t[6]=n,t[7]=0,t[8]=r,t):new uo(r,0,n,0,1,0,-n,0,r)},uo.fromRotationZ=function(e,t){qt.typeOf.number("angle",e);var r=Math.cos(e),n=Math.sin(e);return jt(t)?(t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new uo(r,-n,0,n,r,0,0,0,1)},uo.toArray=function(e,t){return qt.typeOf.object("matrix",e),jt(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},uo.getElementIndex=function(e,t){return qt.typeOf.number.greaterThanOrEquals("row",t,0),qt.typeOf.number.lessThanOrEquals("row",t,2),qt.typeOf.number.greaterThanOrEquals("column",e,0),qt.typeOf.number.lessThanOrEquals("column",e,2),3*e+t},uo.getColumn=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.number.greaterThanOrEquals("index",t,0),qt.typeOf.number.lessThanOrEquals("index",t,2),qt.typeOf.object("result",r);var n=3*t,i=e[n],o=e[n+1],s=e[n+2];return r.x=i,r.y=o,r.z=s,r},uo.setColumn=function(e,t,r,n){qt.typeOf.object("matrix",e),qt.typeOf.number.greaterThanOrEquals("index",t,0),qt.typeOf.number.lessThanOrEquals("index",t,2),qt.typeOf.object("cartesian",r),qt.typeOf.object("result",n);var i=3*t;return(n=uo.clone(e,n))[i]=r.x,n[i+1]=r.y,n[i+2]=r.z,n},uo.getRow=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.number.greaterThanOrEquals("index",t,0),qt.typeOf.number.lessThanOrEquals("index",t,2),qt.typeOf.object("result",r);var n=e[t],i=e[t+3],o=e[t+6];return r.x=n,r.y=i,r.z=o,r},uo.setRow=function(e,t,r,n){return qt.typeOf.object("matrix",e),qt.typeOf.number.greaterThanOrEquals("index",t,0),qt.typeOf.number.lessThanOrEquals("index",t,2),qt.typeOf.object("cartesian",r),qt.typeOf.object("result",n),(n=uo.clone(e,n))[t]=r.x,n[t+3]=r.y,n[t+6]=r.z,n};var co=new Zt;uo.getScale=function(e,t){return qt.typeOf.object("matrix",e),qt.typeOf.object("result",t),t.x=Zt.magnitude(Zt.fromElements(e[0],e[1],e[2],co)),t.y=Zt.magnitude(Zt.fromElements(e[3],e[4],e[5],co)),t.z=Zt.magnitude(Zt.fromElements(e[6],e[7],e[8],co)),t};var lo=new Zt;uo.getMaximumScale=function(e){return uo.getScale(e,lo),Zt.maximumComponent(lo)},uo.multiply=function(e,t,r){qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r);var n=e[0]*t[0]+e[3]*t[1]+e[6]*t[2],i=e[1]*t[0]+e[4]*t[1]+e[7]*t[2],o=e[2]*t[0]+e[5]*t[1]+e[8]*t[2],s=e[0]*t[3]+e[3]*t[4]+e[6]*t[5],a=e[1]*t[3]+e[4]*t[4]+e[7]*t[5],u=e[2]*t[3]+e[5]*t[4]+e[8]*t[5],c=e[0]*t[6]+e[3]*t[7]+e[6]*t[8],l=e[1]*t[6]+e[4]*t[7]+e[7]*t[8],h=e[2]*t[6]+e[5]*t[7]+e[8]*t[8];return r[0]=n,r[1]=i,r[2]=o,r[3]=s,r[4]=a,r[5]=u,r[6]=c,r[7]=l,r[8]=h,r},uo.add=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r},uo.subtract=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r},uo.multiplyByVector=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.object("cartesian",t),qt.typeOf.object("result",r);var n=t.x,i=t.y,o=t.z,s=e[0]*n+e[3]*i+e[6]*o,a=e[1]*n+e[4]*i+e[7]*o,u=e[2]*n+e[5]*i+e[8]*o;return r.x=s,r.y=a,r.z=u,r},uo.multiplyByScalar=function(e,t,r){return qt.typeOf.object("matrix",e),qt.typeOf.number("scalar",t),qt.typeOf.object("result",r),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r[6]=e[6]*t,r[7]=e[7]*t,r[8]=e[8]*t,r},uo.multiplyByScale=function(e,t,r){return qt.typeOf.object("matrix",e),qt.typeOf.object("scale",t),qt.typeOf.object("result",r),r[0]=e[0]*t.x,r[1]=e[1]*t.x,r[2]=e[2]*t.x,r[3]=e[3]*t.y,r[4]=e[4]*t.y,r[5]=e[5]*t.y,r[6]=e[6]*t.z,r[7]=e[7]*t.z,r[8]=e[8]*t.z,r},uo.negate=function(e,t){return qt.typeOf.object("matrix",e),qt.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t},uo.transpose=function(e,t){qt.typeOf.object("matrix",e),qt.typeOf.object("result",t);var r=e[0],n=e[3],i=e[6],o=e[1],s=e[4],a=e[7],u=e[2],c=e[5],l=e[8];return t[0]=r,t[1]=n,t[2]=i,t[3]=o,t[4]=s,t[5]=a,t[6]=u,t[7]=c,t[8]=l,t};var ho=new Zt(1,1,1);uo.getRotation=function(e,t){qt.typeOf.object("matrix",e),qt.typeOf.object("result",t);var r=Zt.divideComponents(ho,uo.getScale(e,lo),lo);return t=uo.multiplyByScale(e,r,t)};var po=[1,0,0],fo=[2,2,1];function Ao(e){for(var t=0,r=0;r<3;++r){var n=e[uo.getElementIndex(fo[r],po[r])];t+=2*n*n}return Math.sqrt(t)}function go(e,t){for(var r=Wt.EPSILON15,n=0,i=1,o=0;o<3;++o){var s=Math.abs(e[uo.getElementIndex(fo[o],po[o])]);s>n&&(i=o,n=s)}var a=1,u=0,c=po[i],l=fo[i];if(Math.abs(e[uo.getElementIndex(l,c)])>r){var h,p=(e[uo.getElementIndex(l,l)]-e[uo.getElementIndex(c,c)])/2/e[uo.getElementIndex(l,c)];u=(h=p<0?-1/(-p+Math.sqrt(1+p*p)):1/(p+Math.sqrt(1+p*p)))*(a=1/Math.sqrt(1+h*h))}return(t=uo.clone(uo.IDENTITY,t))[uo.getElementIndex(c,c)]=t[uo.getElementIndex(l,l)]=a,t[uo.getElementIndex(l,c)]=u,t[uo.getElementIndex(c,l)]=-u,t}var _o=new uo,mo=new uo;function yo(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A){this[0]=Yt(e,0),this[1]=Yt(i,0),this[2]=Yt(u,0),this[3]=Yt(p,0),this[4]=Yt(t,0),this[5]=Yt(o,0),this[6]=Yt(c,0),this[7]=Yt(d,0),this[8]=Yt(r,0),this[9]=Yt(s,0),this[10]=Yt(l,0),this[11]=Yt(f,0),this[12]=Yt(n,0),this[13]=Yt(a,0),this[14]=Yt(h,0),this[15]=Yt(A,0),this.isMatrix4=!0}uo.computeEigenDecomposition=function(e,t){qt.typeOf.object("matrix",e);var r=Wt.EPSILON20,n=0,i=0;jt(t)||(t={});for(var o=t.unitary=uo.clone(uo.IDENTITY,t.unitary),s=t.diagonal=uo.clone(e,t.diagonal),a=r*function(e){for(var t=0,r=0;r<9;++r){var n=e[r];t+=n*n}return Math.sqrt(t)}(s);i<10&&Ao(s)>a;)go(s,_o),uo.transpose(_o,mo),uo.multiply(s,_o,s),uo.multiply(mo,s,s),uo.multiply(o,_o,o),++n>2&&(++i,n=0);return t},uo.abs=function(e,t){return qt.typeOf.object("matrix",e),qt.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t},uo.determinant=function(e){qt.typeOf.object("matrix",e);var t=e[0],r=e[3],n=e[6],i=e[1],o=e[4],s=e[7],a=e[2],u=e[5],c=e[8];return t*(o*c-u*s)+i*(u*n-r*c)+a*(r*s-o*n)},uo.inverse=function(e,t){qt.typeOf.object("matrix",e),qt.typeOf.object("result",t);var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],c=e[7],l=e[8],h=uo.determinant(e);if(Math.abs(h)<=Wt.EPSILON15)throw new Ht("matrix is not invertible");t[0]=s*l-c*a,t[1]=c*i-n*l,t[2]=n*a-s*i,t[3]=u*a-o*l,t[4]=r*l-u*i,t[5]=o*i-r*a,t[6]=o*c-u*s,t[7]=u*n-r*c,t[8]=r*s-o*n;var p=1/h;return uo.multiplyByScalar(t,p,t)},uo.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},uo.equalsEpsilon=function(e,t,r){return qt.typeOf.number("epsilon",r),e===t||jt(e)&&jt(t)&&Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r&&Math.abs(e[4]-t[4])<=r&&Math.abs(e[5]-t[5])<=r&&Math.abs(e[6]-t[6])<=r&&Math.abs(e[7]-t[7])<=r&&Math.abs(e[8]-t[8])<=r},uo.IDENTITY=Object.freeze(new uo(1,0,0,0,1,0,0,0,1)),uo.ZERO=Object.freeze(new uo(0,0,0,0,0,0,0,0,0)),uo.COLUMN0ROW0=0,uo.COLUMN0ROW1=1,uo.COLUMN0ROW2=2,uo.COLUMN1ROW0=3,uo.COLUMN1ROW1=4,uo.COLUMN1ROW2=5,uo.COLUMN2ROW0=6,uo.COLUMN2ROW1=7,uo.COLUMN2ROW2=8,Object.defineProperties(uo.prototype,{length:{get:function(){return uo.packedLength}}}),uo.prototype.clone=function(e){return uo.clone(this,e)},uo.prototype.equals=function(e){return uo.equals(this,e)},uo.equalsArray=function(e,t,r){return e[0]===t[r]&&e[1]===t[r+1]&&e[2]===t[r+2]&&e[3]===t[r+3]&&e[4]===t[r+4]&&e[5]===t[r+5]&&e[6]===t[r+6]&&e[7]===t[r+7]&&e[8]===t[r+8]},uo.prototype.equalsEpsilon=function(e,t){return uo.equalsEpsilon(this,e,t)},uo.prototype.toString=function(){return"("+this[0]+", "+this[3]+", "+this[6]+")\n("+this[1]+", "+this[4]+", "+this[7]+")\n("+this[2]+", "+this[5]+", "+this[8]+")"},uo.prototype.toArray=function(e,t){uo.pack(this,e,t)},yo.packedLength=16,yo.pack=function(e,t,r){return qt.typeOf.object("value",e),qt.defined("array",t),r=Yt(r,0),t[r++]=e[0],t[r++]=e[1],t[r++]=e[2],t[r++]=e[3],t[r++]=e[4],t[r++]=e[5],t[r++]=e[6],t[r++]=e[7],t[r++]=e[8],t[r++]=e[9],t[r++]=e[10],t[r++]=e[11],t[r++]=e[12],t[r++]=e[13],t[r++]=e[14],t[r]=e[15],t},yo.unpack=function(e,t,r){return qt.defined("array",e),t=Yt(t,0),jt(r)||(r=new yo),r[0]=e[t++],r[1]=e[t++],r[2]=e[t++],r[3]=e[t++],r[4]=e[t++],r[5]=e[t++],r[6]=e[t++],r[7]=e[t++],r[8]=e[t++],r[9]=e[t++],r[10]=e[t++],r[11]=e[t++],r[12]=e[t++],r[13]=e[t++],r[14]=e[t++],r[15]=e[t],r},yo.clone=function(e,t){if(jt(e))return jt(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):new yo(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},yo.fromArray=yo.unpack,yo.fromColumnMajorArray=function(e,t){return qt.defined("values",e),yo.clone(e,t)},yo.fromRowMajorArray=function(e,t){return qt.defined("values",e),jt(t)?(t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t):new yo(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},yo.fromRotationTranslation=function(e,t,r){return qt.typeOf.object("rotation",e),t=Yt(t,Zt.ZERO),jt(r)?(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=0,r[4]=e[3],r[5]=e[4],r[6]=e[5],r[7]=0,r[8]=e[6],r[9]=e[7],r[10]=e[8],r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,r):new yo(e[0],e[3],e[6],t.x,e[1],e[4],e[7],t.y,e[2],e[5],e[8],t.z,0,0,0,1)},yo.fromTranslationQuaternionRotationScale=function(e,t,r,n){qt.typeOf.object("translation",e),qt.typeOf.object("rotation",t),qt.typeOf.object("scale",r),jt(n)||(n=new yo);var i=r.x,o=r.y,s=r.z,a=t.x*t.x,u=t.x*t.y,c=t.x*t.z,l=t.x*t.w,h=t.y*t.y,p=t.y*t.z,d=t.y*t.w,f=t.z*t.z,A=t.z*t.w,g=t.w*t.w,_=a-h-f+g,m=2*(u-A),y=2*(c+d),E=2*(u+A),x=-a+h-f+g,C=2*(p-l),b=2*(c-d),I=2*(p+l),T=-a-h+f+g;return n[0]=_*i,n[1]=E*i,n[2]=b*i,n[3]=0,n[4]=m*o,n[5]=x*o,n[6]=I*o,n[7]=0,n[8]=y*s,n[9]=C*s,n[10]=T*s,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,n},yo.fromTranslationRotationScale=function(e,t){return qt.typeOf.object("translationRotationScale",e),yo.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t)},yo.fromTranslation=function(e,t){return qt.typeOf.object("translation",e),yo.fromRotationTranslation(uo.IDENTITY,e,t)},yo.fromScale=function(e,t){return qt.typeOf.object("scale",e),jt(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e.y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e.z,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new yo(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1)},yo.fromUniformScale=function(e,t){return qt.typeOf.number("scale",e),jt(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new yo(e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1)};var Eo=new Zt,xo=new Zt,Co=new Zt;yo.fromCamera=function(e,t){qt.typeOf.object("camera",e);var r=e.position,n=e.direction,i=e.up;qt.typeOf.object("camera.position",r),qt.typeOf.object("camera.direction",n),qt.typeOf.object("camera.up",i),Zt.normalize(n,Eo),Zt.normalize(Zt.cross(Eo,i,xo),xo),Zt.normalize(Zt.cross(xo,Eo,Co),Co);var o=xo.x,s=xo.y,a=xo.z,u=Eo.x,c=Eo.y,l=Eo.z,h=Co.x,p=Co.y,d=Co.z,f=r.x,A=r.y,g=r.z,_=o*-f+s*-A+a*-g,m=h*-f+p*-A+d*-g,y=u*f+c*A+l*g;return jt(t)?(t[0]=o,t[1]=h,t[2]=-u,t[3]=0,t[4]=s,t[5]=p,t[6]=-c,t[7]=0,t[8]=a,t[9]=d,t[10]=-l,t[11]=0,t[12]=_,t[13]=m,t[14]=y,t[15]=1,t):new yo(o,s,a,_,h,p,d,m,-u,-c,-l,y,0,0,0,1)},yo.computePerspectiveFieldOfView=function(e,t,r,n,i){qt.typeOf.number.greaterThan("fovY",e,0),qt.typeOf.number.lessThan("fovY",e,Math.PI),qt.typeOf.number.greaterThan("near",r,0),qt.typeOf.number.greaterThan("far",n,0),qt.typeOf.object("result",i);var o=1/Math.tan(.5*e),s=o/t,a=(n+r)/(r-n),u=2*n*r/(r-n);return i[0]=s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=a,i[11]=-1,i[12]=0,i[13]=0,i[14]=u,i[15]=0,i},yo.computeOrthographicOffCenter=function(e,t,r,n,i,o,s){qt.typeOf.number("left",e),qt.typeOf.number("right",t),qt.typeOf.number("bottom",r),qt.typeOf.number("top",n),qt.typeOf.number("near",i),qt.typeOf.number("far",o),qt.typeOf.object("result",s);var a=1/(t-e),u=1/(n-r),c=1/(o-i),l=-(t+e)*a,h=-(n+r)*u,p=-(o+i)*c;return a*=2,u*=2,c*=-2,s[0]=a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=u,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=c,s[11]=0,s[12]=l,s[13]=h,s[14]=p,s[15]=1,yo.halfZRange&&yo.multiply(yo.ConvertNDCToHalfZRange,s,s),s},yo.computePerspectiveOffCenter=function(e,t,r,n,i,o,s){qt.typeOf.number("left",e),qt.typeOf.number("right",t),qt.typeOf.number("bottom",r),qt.typeOf.number("top",n),qt.typeOf.number("near",i),qt.typeOf.number("far",o),qt.typeOf.object("result",s);var a=2*i/(t-e),u=2*i/(n-r),c=(t+e)/(t-e),l=(n+r)/(n-r),h=-(o+i)/(o-i),p=-2*o*i/(o-i);return s[0]=a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=u,s[6]=0,s[7]=0,s[8]=c,s[9]=l,s[10]=h,s[11]=-1,s[12]=0,s[13]=0,s[14]=p,s[15]=0,yo.halfZRange&&yo.multiply(yo.ConvertNDCToHalfZRange,s,s),s},yo.computeInfinitePerspectiveOffCenter=function(e,t,r,n,i,o){qt.typeOf.number("left",e),qt.typeOf.number("right",t),qt.typeOf.number("bottom",r),qt.typeOf.number("top",n),qt.typeOf.number("near",i),qt.typeOf.object("result",o);var s=2*i/(t-e),a=2*i/(n-r),u=(t+e)/(t-e),c=(n+r)/(n-r),l=-2*i;return o[0]=s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=a,o[6]=0,o[7]=0,o[8]=u,o[9]=c,o[10]=-1,o[11]=-1,o[12]=0,o[13]=0,o[14]=l,o[15]=0,yo.halfZRange&&yo.multiply(yo.ConvertNDCToHalfZRange,o,o),o},yo.computeViewportTransformation=function(e,t,r,n){qt.typeOf.object("result",n),e=Yt(e,Yt.EMPTY_OBJECT);var i=Yt(e.x,0),o=Yt(e.y,0),s=Yt(e.width,0),a=Yt(e.height,0);t=Yt(t,0);var u=.5*s,c=.5*a,l=.5*((r=Yt(r,1))-t),h=u,p=c,d=l,f=i+u,A=o+c,g=t+l;return n[0]=h,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=p,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=d,n[11]=0,n[12]=f,n[13]=A,n[14]=g,n[15]=1,n},yo.computeView=function(e,t,r,n,i){return qt.typeOf.object("position",e),qt.typeOf.object("direction",t),qt.typeOf.object("up",r),qt.typeOf.object("right",n),qt.typeOf.object("result",i),i[0]=n.x,i[1]=r.x,i[2]=-t.x,i[3]=0,i[4]=n.y,i[5]=r.y,i[6]=-t.y,i[7]=0,i[8]=n.z,i[9]=r.z,i[10]=-t.z,i[11]=0,i[12]=-Zt.dot(n,e),i[13]=-Zt.dot(r,e),i[14]=Zt.dot(t,e),i[15]=1,i},yo.toArray=function(e,t){return qt.typeOf.object("matrix",e),jt(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},yo.getElementIndex=function(e,t){return qt.typeOf.number.greaterThanOrEquals("row",t,0),qt.typeOf.number.lessThanOrEquals("row",t,3),qt.typeOf.number.greaterThanOrEquals("column",e,0),qt.typeOf.number.lessThanOrEquals("column",e,3),4*e+t},yo.getColumn=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.number.greaterThanOrEquals("index",t,0),qt.typeOf.number.lessThanOrEquals("index",t,3),qt.typeOf.object("result",r);var n=4*t,i=e[n],o=e[n+1],s=e[n+2],a=e[n+3];return r.x=i,r.y=o,r.z=s,r.w=a,r},yo.setColumn=function(e,t,r,n){qt.typeOf.object("matrix",e),qt.typeOf.number.greaterThanOrEquals("index",t,0),qt.typeOf.number.lessThanOrEquals("index",t,3),qt.typeOf.object("cartesian",r),qt.typeOf.object("result",n);var i=4*t;return(n=yo.clone(e,n))[i]=r.x,n[i+1]=r.y,n[i+2]=r.z,n[i+3]=r.w,n},yo.setTranslation=function(e,t,r){return qt.typeOf.object("matrix",e),qt.typeOf.object("translation",t),qt.typeOf.object("result",r),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=e[15],r};var bo=new Zt;yo.setScale=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.object("scale",t),qt.typeOf.object("result",r);var n=yo.getScale(e,bo),i=Zt.divideComponents(t,n,bo);return yo.multiplyByScale(e,i,r)},yo.getRow=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.number.greaterThanOrEquals("index",t,0),qt.typeOf.number.lessThanOrEquals("index",t,3),qt.typeOf.object("result",r);var n=e[t],i=e[t+4],o=e[t+8],s=e[t+12];return r.x=n,r.y=i,r.z=o,r.w=s,r},yo.setRow=function(e,t,r,n){return qt.typeOf.object("matrix",e),qt.typeOf.number.greaterThanOrEquals("index",t,0),qt.typeOf.number.lessThanOrEquals("index",t,3),qt.typeOf.object("cartesian",r),qt.typeOf.object("result",n),(n=yo.clone(e,n))[t]=r.x,n[t+4]=r.y,n[t+8]=r.z,n[t+12]=r.w,n};var Io=new Zt;yo.getScale=function(e,t){return qt.typeOf.object("matrix",e),qt.typeOf.object("result",t),t.x=Zt.magnitude(Zt.fromElements(e[0],e[1],e[2],Io)),t.y=Zt.magnitude(Zt.fromElements(e[4],e[5],e[6],Io)),t.z=Zt.magnitude(Zt.fromElements(e[8],e[9],e[10],Io)),t};var To=new Zt;yo.getMaximumScale=function(e){return yo.getScale(e,To),Zt.maximumComponent(To)},yo.multiply=function(e,t,r){qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r);var n=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],c=e[6],l=e[7],h=e[8],p=e[9],d=e[10],f=e[11],A=e[12],g=e[13],_=e[14],m=e[15],y=t[0],E=t[1],x=t[2],C=t[3],b=t[4],I=t[5],T=t[6],v=t[7],R=t[8],M=t[9],w=t[10],S=t[11],B=t[12],O=t[13],D=t[14],F=t[15],P=n*y+a*E+h*x+A*C,N=i*y+u*E+p*x+g*C,L=o*y+c*E+d*x+_*C,U=s*y+l*E+f*x+m*C,G=n*b+a*I+h*T+A*v,Q=i*b+u*I+p*T+g*v,k=o*b+c*I+d*T+_*v,z=s*b+l*I+f*T+m*v,j=n*R+a*M+h*w+A*S,H=i*R+u*M+p*w+g*S,q=o*R+c*M+d*w+_*S,V=s*R+l*M+f*w+m*S,Y=n*B+a*O+h*D+A*F,X=i*B+u*O+p*D+g*F,W=o*B+c*O+d*D+_*F,K=s*B+l*O+f*D+m*F;return r[0]=P,r[1]=N,r[2]=L,r[3]=U,r[4]=G,r[5]=Q,r[6]=k,r[7]=z,r[8]=j,r[9]=H,r[10]=q,r[11]=V,r[12]=Y,r[13]=X,r[14]=W,r[15]=K,r},yo.add=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r[9]=e[9]+t[9],r[10]=e[10]+t[10],r[11]=e[11]+t[11],r[12]=e[12]+t[12],r[13]=e[13]+t[13],r[14]=e[14]+t[14],r[15]=e[15]+t[15],r},yo.subtract=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r[9]=e[9]-t[9],r[10]=e[10]-t[10],r[11]=e[11]-t[11],r[12]=e[12]-t[12],r[13]=e[13]-t[13],r[14]=e[14]-t[14],r[15]=e[15]-t[15],r},yo.multiplyTransformation=function(e,t,r){qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r);var n=e[0],i=e[1],o=e[2],s=e[4],a=e[5],u=e[6],c=e[8],l=e[9],h=e[10],p=e[12],d=e[13],f=e[14],A=t[0],g=t[1],_=t[2],m=t[4],y=t[5],E=t[6],x=t[8],C=t[9],b=t[10],I=t[12],T=t[13],v=t[14],R=n*A+s*g+c*_,M=i*A+a*g+l*_,w=o*A+u*g+h*_,S=n*m+s*y+c*E,B=i*m+a*y+l*E,O=o*m+u*y+h*E,D=n*x+s*C+c*b,F=i*x+a*C+l*b,P=o*x+u*C+h*b,N=n*I+s*T+c*v+p,L=i*I+a*T+l*v+d,U=o*I+u*T+h*v+f;return r[0]=R,r[1]=M,r[2]=w,r[3]=0,r[4]=S,r[5]=B,r[6]=O,r[7]=0,r[8]=D,r[9]=F,r[10]=P,r[11]=0,r[12]=N,r[13]=L,r[14]=U,r[15]=1,r},yo.multiplyByMatrix3=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.object("rotation",t),qt.typeOf.object("result",r);var n=e[0],i=e[1],o=e[2],s=e[4],a=e[5],u=e[6],c=e[8],l=e[9],h=e[10],p=t[0],d=t[1],f=t[2],A=t[3],g=t[4],_=t[5],m=t[6],y=t[7],E=t[8],x=n*p+s*d+c*f,C=i*p+a*d+l*f,b=o*p+u*d+h*f,I=n*A+s*g+c*_,T=i*A+a*g+l*_,v=o*A+u*g+h*_,R=n*m+s*y+c*E,M=i*m+a*y+l*E,w=o*m+u*y+h*E;return r[0]=x,r[1]=C,r[2]=b,r[3]=0,r[4]=I,r[5]=T,r[6]=v,r[7]=0,r[8]=R,r[9]=M,r[10]=w,r[11]=0,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},yo.multiplyByTranslation=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.object("translation",t),qt.typeOf.object("result",r);var n=t.x,i=t.y,o=t.z,s=n*e[0]+i*e[4]+o*e[8]+e[12],a=n*e[1]+i*e[5]+o*e[9]+e[13],u=n*e[2]+i*e[6]+o*e[10]+e[14];return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=s,r[13]=a,r[14]=u,r[15]=e[15],r};var vo=new Zt;yo.multiplyByUniformScale=function(e,t,r){return qt.typeOf.object("matrix",e),qt.typeOf.number("scale",t),qt.typeOf.object("result",r),vo.x=t,vo.y=t,vo.z=t,yo.multiplyByScale(e,vo,r)},yo.multiplyByScale=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.object("scale",t),qt.typeOf.object("result",r);var n=t.x,i=t.y,o=t.z;return 1===n&&1===i&&1===o?yo.clone(e,r):(r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=0,r[4]=i*e[4],r[5]=i*e[5],r[6]=i*e[6],r[7]=0,r[8]=o*e[8],r[9]=o*e[9],r[10]=o*e[10],r[11]=0,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=1,r)},yo.multiplyByVector=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.object("cartesian",t),qt.typeOf.object("result",r);var n=t.x,i=t.y,o=t.z,s=t.w,a=e[0]*n+e[4]*i+e[8]*o+e[12]*s,u=e[1]*n+e[5]*i+e[9]*o+e[13]*s,c=e[2]*n+e[6]*i+e[10]*o+e[14]*s,l=e[3]*n+e[7]*i+e[11]*o+e[15]*s;return r.x=a,r.y=u,r.z=c,r.w=l,r},yo.multiplyByPointAsVector=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.object("cartesian",t),qt.typeOf.object("result",r);var n=t.x,i=t.y,o=t.z,s=e[0]*n+e[4]*i+e[8]*o,a=e[1]*n+e[5]*i+e[9]*o,u=e[2]*n+e[6]*i+e[10]*o;return r.x=s,r.y=a,r.z=u,r},yo.multiplyByPoint=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.object("cartesian",t),qt.typeOf.object("result",r);var n=t.x,i=t.y,o=t.z,s=e[0]*n+e[4]*i+e[8]*o+e[12],a=e[1]*n+e[5]*i+e[9]*o+e[13],u=e[2]*n+e[6]*i+e[10]*o+e[14];return r.x=s,r.y=a,r.z=u,r},yo.multiplyByDirection=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.object("cartesian",t),qt.typeOf.object("result",r);var n=t.x,i=t.y,o=t.z;return r.x=n*e[0]+i*e[4]+o*e[8],r.y=n*e[1]+i*e[5]+o*e[9],r.z=n*e[2]+i*e[6]+o*e[10],r},yo.multiplyByScalar=function(e,t,r){return qt.typeOf.object("matrix",e),qt.typeOf.number("scalar",t),qt.typeOf.object("result",r),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r[6]=e[6]*t,r[7]=e[7]*t,r[8]=e[8]*t,r[9]=e[9]*t,r[10]=e[10]*t,r[11]=e[11]*t,r[12]=e[12]*t,r[13]=e[13]*t,r[14]=e[14]*t,r[15]=e[15]*t,r},yo.multiplyByPlane=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.object("plane",t),qt.typeOf.object("result",r);var n=new yo,i=new yo;yo.inverse(e,n),yo.transpose(n,i);var o=new br(t.normal.x,t.normal.y,t.normal.z,t.distance);yo.multiplyByVector(i,o,o),r.normal.x=o.x,r.normal.y=o.y,r.normal.z=o.z;var s=Zt.magnitude(r.normal);return Zt.normalize(r.normal,r.normal),r.distance=o.w/s,r},yo.negate=function(e,t){return qt.typeOf.object("matrix",e),qt.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},yo.transpose=function(e,t){qt.typeOf.object("matrix",e),qt.typeOf.object("result",t);var r=e[1],n=e[2],i=e[3],o=e[6],s=e[7],a=e[11];return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[10]=e[10],t[11]=e[14],t[12]=i,t[13]=s,t[14]=a,t[15]=e[15],t},yo.abs=function(e,t){return qt.typeOf.object("matrix",e),qt.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t[9]=Math.abs(e[9]),t[10]=Math.abs(e[10]),t[11]=Math.abs(e[11]),t[12]=Math.abs(e[12]),t[13]=Math.abs(e[13]),t[14]=Math.abs(e[14]),t[15]=Math.abs(e[15]),t},yo.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[3]===t[3]&&e[7]===t[7]&&e[11]===t[11]&&e[15]===t[15]},yo.equalsEpsilon=function(e,t,r){return qt.typeOf.number("epsilon",r),e===t||jt(e)&&jt(t)&&Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r&&Math.abs(e[4]-t[4])<=r&&Math.abs(e[5]-t[5])<=r&&Math.abs(e[6]-t[6])<=r&&Math.abs(e[7]-t[7])<=r&&Math.abs(e[8]-t[8])<=r&&Math.abs(e[9]-t[9])<=r&&Math.abs(e[10]-t[10])<=r&&Math.abs(e[11]-t[11])<=r&&Math.abs(e[12]-t[12])<=r&&Math.abs(e[13]-t[13])<=r&&Math.abs(e[14]-t[14])<=r&&Math.abs(e[15]-t[15])<=r},yo.getTranslation=function(e,t){return qt.typeOf.object("matrix",e),qt.typeOf.object("result",t),t.x=e[12],t.y=e[13],t.z=e[14],t},yo.getMatrix3=function(e,t){return qt.typeOf.object("matrix",e),qt.typeOf.object("result",t),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},yo.getRotation=function(e,t){return qt.typeOf.object("matrix",e),qt.typeOf.object("result",t),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t};var Ro=new uo,Mo=new uo,wo=new br,So=new br(0,0,0,1);yo.inverse=function(e,t){qt.typeOf.object("matrix",e),qt.typeOf.object("result",t);var r=e[0],n=e[4],i=e[8],o=e[12],s=e[1],a=e[5],u=e[9],c=e[13],l=e[2],h=e[6],p=e[10],d=e[14],f=e[3],A=e[7],g=e[11],_=e[15],m=p*_,y=d*g,E=h*_,x=d*A,C=h*g,b=p*A,I=l*_,T=d*f,v=l*g,R=p*f,M=l*A,w=h*f,S=m*a+x*u+C*c-(y*a+E*u+b*c),B=y*s+I*u+R*c-(m*s+T*u+v*c),O=E*s+T*a+M*c-(x*s+I*a+w*c),D=b*s+v*a+w*u-(C*s+R*a+M*u),F=y*n+E*i+b*o-(m*n+x*i+C*o),P=m*r+T*i+v*o-(y*r+I*i+R*o),N=x*r+I*n+w*o-(E*r+T*n+M*o),L=C*r+R*n+M*i-(b*r+v*n+w*i),U=(m=i*c)*A+(x=o*a)*g+(C=n*u)*_-((y=o*u)*A+(E=n*c)*g+(b=i*a)*_),G=y*f+(I=r*c)*g+(R=i*s)*_-(m*f+(T=o*s)*g+(v=r*u)*_),Q=E*f+T*A+(M=r*a)*_-(x*f+I*A+(w=n*s)*_),k=b*f+v*A+w*g-(C*f+R*A+M*g),z=E*p+b*d+y*h-(C*d+m*h+x*p),j=v*d+m*l+T*p-(I*p+R*d+y*l),H=I*h+w*d+x*l-(M*d+E*l+T*h),q=M*p+C*l+R*h-(v*h+w*p+b*l),V=r*S+n*B+i*O+o*D;if(Math.abs(V)<Wt.EPSILON21){if(uo.equalsEpsilon(yo.getRotation(e,Ro),Mo,Wt.EPSILON5)&&br.equals(yo.getRow(e,3,wo),So))return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=1,t;throw new _i("matrix is not invertible because its determinate is zero.")}return V=1/V,t[0]=S*V,t[1]=B*V,t[2]=O*V,t[3]=D*V,t[4]=F*V,t[5]=P*V,t[6]=N*V,t[7]=L*V,t[8]=U*V,t[9]=G*V,t[10]=Q*V,t[11]=k*V,t[12]=z*V,t[13]=j*V,t[14]=H*V,t[15]=q*V,t},yo.inverseTransformation=function(e,t){qt.typeOf.object("matrix",e),qt.typeOf.object("result",t);var r=e[0],n=e[1],i=e[2],o=e[4],s=e[5],a=e[6],u=e[8],c=e[9],l=e[10],h=e[12],p=e[13],d=e[14],f=-r*h-n*p-i*d,A=-o*h-s*p-a*d,g=-u*h-c*p-l*d;return t[0]=r,t[1]=o,t[2]=u,t[3]=0,t[4]=n,t[5]=s,t[6]=c,t[7]=0,t[8]=i,t[9]=a,t[10]=l,t[11]=0,t[12]=f,t[13]=A,t[14]=g,t[15]=1,t};const Bo=new yo;var Oo;yo.inverseTranspose=function(e,t){return qt.typeOf.object("matrix",e),qt.typeOf.object("result",t),yo.inverse(yo.transpose(e,Bo),t)},yo.IDENTITY=Object.freeze(new yo(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),yo.ZERO=Object.freeze(new yo(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)),yo.ConvertNDCToHalfZRange=Object.freeze(new yo(1,0,0,0,0,1,0,0,0,0,.5,.5,0,0,0,1)),yo.COLUMN0ROW0=0,yo.COLUMN0ROW1=1,yo.COLUMN0ROW2=2,yo.COLUMN0ROW3=3,yo.COLUMN1ROW0=4,yo.COLUMN1ROW1=5,yo.COLUMN1ROW2=6,yo.COLUMN1ROW3=7,yo.COLUMN2ROW0=8,yo.COLUMN2ROW1=9,yo.COLUMN2ROW2=10,yo.COLUMN2ROW3=11,yo.COLUMN3ROW0=12,yo.COLUMN3ROW1=13,yo.COLUMN3ROW2=14,yo.COLUMN3ROW3=15,yo.halfZRange=!1,Object.defineProperties(yo.prototype,{length:{get:function(){return yo.packedLength}}}),yo.prototype.clone=function(e){return yo.clone(this,e)},yo.prototype.equals=function(e){return yo.equals(this,e)},yo.equalsArray=function(e,t,r){return e[0]===t[r]&&e[1]===t[r+1]&&e[2]===t[r+2]&&e[3]===t[r+3]&&e[4]===t[r+4]&&e[5]===t[r+5]&&e[6]===t[r+6]&&e[7]===t[r+7]&&e[8]===t[r+8]&&e[9]===t[r+9]&&e[10]===t[r+10]&&e[11]===t[r+11]&&e[12]===t[r+12]&&e[13]===t[r+13]&&e[14]===t[r+14]&&e[15]===t[r+15]},yo.prototype.equalsEpsilon=function(e,t){return yo.equalsEpsilon(this,e,t)},yo.prototype.toString=function(){return"("+this[0]+", "+this[4]+", "+this[8]+", "+this[12]+")\n("+this[1]+", "+this[5]+", "+this[9]+", "+this[13]+")\n("+this[2]+", "+this[6]+", "+this[10]+", "+this[14]+")\n("+this[3]+", "+this[7]+", "+this[11]+", "+this[15]+")"},yo.prototype.toArray=function(e,t){yo.pack(this,e,t)};var Do,Fo,Po,No,Lo,Uo,Go,Qo,ko,zo,jo,Ho,qo,Vo,Yo,Xo,Wo,Ko,Jo={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0},Zo={};function $o(e){for(var t=e.split("."),r=0,n=t.length;r<n;++r)t[r]=parseInt(t[r],10);return t}function es(){if(!jt(Fo)&&(Fo=!1,!is())){var e=/ Chrome\/([\.0-9]+)/.exec(Do.userAgent);null!==e&&(Fo=!0,Po=$o(e[1]))}return Fo}function ts(){if(!jt(No)&&(No=!1,!es()&&!is()&&/ Safari\/[\.0-9]+/.test(Do.userAgent))){var e=/ Version\/([\.0-9]+)/.exec(Do.userAgent);null!==e&&(No=!0,Lo=$o(e[1]))}return No}function rs(){if(!jt(Uo)){Uo=!1;var e=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(Do.userAgent);null!==e&&(Uo=!0,(Go=$o(e[1])).isNightly=!!e[2])}return Uo}function ns(){var e;jt(Qo)||(Qo=!1,"Microsoft Internet Explorer"===Do.appName?null!==(e=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(Do.userAgent))&&(Qo=!0,ko=$o(e[1])):"Netscape"===Do.appName&&null!==(e=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(Do.userAgent))&&(Qo=!0,ko=$o(e[1])));return Qo}function is(){if(!jt(zo)){zo=!1;var e=/ Edge\/([\.0-9]+)/.exec(Do.userAgent);null!==e&&(zo=!0,jo=$o(e[1]))}return zo}function os(){if(!jt(Ho)){Ho=!1;var e=/Firefox\/([\.0-9]+)/.exec(Do.userAgent);null!==e&&(Ho=!0,qo=$o(e[1]))}return Ho}function ss(){if(!jt(Ko)){var e=document.createElement("canvas");e.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;");var t=e.style.imageRendering;(Ko=jt(t)&&""!==t)&&(Wo=t)}return Ko}function as(){if(!as.initialized)throw new DeveloperError("You must call FeatureDetection.supportsWebP.initialize and wait for the promise to resolve before calling FeatureDetection.supportsWebP");return as._result}Object.defineProperties(Zo,{element:{get:function(){if(Zo.supportsFullscreen())return document[Jo.fullscreenElement]}},changeEventName:{get:function(){if(Zo.supportsFullscreen())return Jo.fullscreenchange}},errorEventName:{get:function(){if(Zo.supportsFullscreen())return Jo.fullscreenerror}},enabled:{get:function(){if(Zo.supportsFullscreen())return document[Jo.fullscreenEnabled]}},fullscreen:{get:function(){if(Zo.supportsFullscreen())return null!==Zo.element}}}),Zo.supportsFullscreen=function(){if(jt(Oo))return Oo;Oo=!1;var e=document.body;if("function"==typeof e.requestFullscreen)return Jo.requestFullscreen="requestFullscreen",Jo.exitFullscreen="exitFullscreen",Jo.fullscreenEnabled="fullscreenEnabled",Jo.fullscreenElement="fullscreenElement",Jo.fullscreenchange="fullscreenchange",Jo.fullscreenerror="fullscreenerror",Oo=!0;for(var t,r=["webkit","moz","o","ms","khtml"],n=0,i=r.length;n<i;++n){var o=r[n];("function"==typeof e[t=o+"RequestFullscreen"]||"function"==typeof e[t=o+"RequestFullScreen"])&&(Jo.requestFullscreen=t,Oo=!0),t=o+"ExitFullscreen","function"==typeof document[t]?Jo.exitFullscreen=t:(t=o+"CancelFullScreen","function"==typeof document[t]&&(Jo.exitFullscreen=t)),t=o+"FullscreenEnabled",void 0!==document[t]?Jo.fullscreenEnabled=t:(t=o+"FullScreenEnabled",void 0!==document[t]&&(Jo.fullscreenEnabled=t)),t=o+"FullscreenElement",void 0!==document[t]?Jo.fullscreenElement=t:(t=o+"FullScreenElement",void 0!==document[t]&&(Jo.fullscreenElement=t)),t=o+"fullscreenchange",void 0!==document["on"+t]&&("ms"===o&&(t="MSFullscreenChange"),Jo.fullscreenchange=t),t=o+"fullscreenerror",void 0!==document["on"+t]&&("ms"===o&&(t="MSFullscreenError"),Jo.fullscreenerror=t)}return Oo},Zo.requestFullscreen=function(e,t){Zo.supportsFullscreen()&&e[Jo.requestFullscreen]({vrDisplay:t})},Zo.exitFullscreen=function(){Zo.supportsFullscreen()&&document[Jo.exitFullscreen]()},Zo._names=Jo,Do="undefined"!=typeof navigator?navigator:{},as._promise=void 0,as._result=void 0,as.initialize=function(){if(jt(as._promise))return as._promise;const e=Tn();if(as._promise=e.promise,is())return as._result=!1,e.resolve(as._result),e.promise;const t=new Image;return t.onload=function(){as._result=t.width>0&&t.height>0,e.resolve(as._result)},t.onerror=function(){as._result=!1,e.resolve(as._result)},t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.promise},Object.defineProperties(as,{initialized:{get:function(){return jt(as._result)}}});var us=[];"undefined"!=typeof ArrayBuffer&&(us.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),"undefined"!=typeof Uint8ClampedArray&&us.push(Uint8ClampedArray),"undefined"!=typeof CanvasPixelArray&&us.push(CanvasPixelArray));var cs={isChrome:es,chromeVersion:function(){return es()&&Po},isSafari:ts,safariVersion:function(){return ts()&&Lo},isWebkit:rs,webkitVersion:function(){return rs()&&Go},isInternetExplorer:ns,internetExplorerVersion:function(){return ns()&&ko},isEdge:is,edgeVersion:function(){return is()&&jo},isFirefox:os,firefoxVersion:function(){return os()&&qo},isWindows:function(){return jt(Vo)||(Vo=/Windows/i.test(Do.appVersion)),Vo},isNodeJs:function(){return jt(Yo)||(Yo="object"==typeof process&&"[object process]"===Object.prototype.toString.call(process)),Yo},hardwareConcurrency:Yt(Do.hardwareConcurrency,3),supportsPointerEvents:function(){return jt(Xo)||(Xo=!os()&&"undefined"!=typeof PointerEvent&&(!jt(Do.pointerEnabled)||Do.pointerEnabled)),Xo},supportsImageRenderingPixelated:ss,supportsWebP:as,supportsWebPSync:function(){return jt(undefined)||as.initialize(),as._result},imageRenderingValue:function(){return ss()?Wo:void 0},typedArrayTypes:us,isPCBroswer:function(){var e=window.navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),r="iphone os"==e.match(/iphone os/i),n="midp"==e.match(/midp/i),i="ucweb"==e.match(/ucweb/i),o="android"==e.match(/android/i),s="windows ce"==e.match(/windows ce/i),a="windows mobile"==e.match(/windows mobile/i);return!(t||r||n||i||o||s||a)}};function ls(e,t,r,n){this.x=Yt(e,0),this.y=Yt(t,0),this.z=Yt(r,0),this.w=Yt(n,0)}cs.supportsFullscreen=function(){return Zo.supportsFullscreen()},cs.supportsTypedArrays=function(){return"undefined"!=typeof ArrayBuffer},cs.supportsWebWorkers=function(){return"undefined"!=typeof Worker},cs.supportsWebAssembly=function(){return"undefined"!=typeof WebAssembly&&!cs.isEdge()},cs.supportsOffscreenCanvas=function(){return"undefined"!=typeof OffscreenCanvas&&!cs.isEdge()},cs.supportsEsmWebWorkers=function(){return!os()||parseInt(qo)>=114};var hs=new Zt;ls.fromAxisAngle=function(e,t,r){qt.typeOf.object("axis",e),qt.typeOf.number("angle",t);var n=t/2,i=Math.sin(n),o=(hs=Zt.normalize(e,hs)).x*i,s=hs.y*i,a=hs.z*i,u=Math.cos(n);return jt(r)?(r.x=o,r.y=s,r.z=a,r.w=u,r):new ls(o,s,a,u)};var ps=[1,2,0],ds=new Array(3);ls.fromRotationMatrix=function(e,t){var r,n,i,o,s;qt.typeOf.object("matrix",e);var a=e[uo.COLUMN0ROW0],u=e[uo.COLUMN1ROW1],c=e[uo.COLUMN2ROW2],l=a+u+c;if(l>0)s=.5*(r=Math.sqrt(l+1)),r=.5/r,n=(e[uo.COLUMN1ROW2]-e[uo.COLUMN2ROW1])*r,i=(e[uo.COLUMN2ROW0]-e[uo.COLUMN0ROW2])*r,o=(e[uo.COLUMN0ROW1]-e[uo.COLUMN1ROW0])*r;else{var h=0;u>a&&(h=1),c>a&&c>u&&(h=2);var p=ps[h],d=ps[p];r=Math.sqrt(e[uo.getElementIndex(h,h)]-e[uo.getElementIndex(p,p)]-e[uo.getElementIndex(d,d)]+1);var f=ds;f[h]=.5*r,r=.5/r,s=(e[uo.getElementIndex(d,p)]-e[uo.getElementIndex(p,d)])*r,f[p]=(e[uo.getElementIndex(p,h)]+e[uo.getElementIndex(h,p)])*r,f[d]=(e[uo.getElementIndex(d,h)]+e[uo.getElementIndex(h,d)])*r,n=-f[0],i=-f[1],o=-f[2]}return jt(t)?(t.x=n,t.y=i,t.z=o,t.w=s,t):new ls(n,i,o,s)};var fs=new ls,As=new ls,gs=new ls,_s=new ls;ls.fromHeadingPitchRoll=function(e,t){return qt.typeOf.object("headingPitchRoll",e),_s=ls.fromAxisAngle(Zt.UNIT_X,e.roll,fs),gs=ls.fromAxisAngle(Zt.UNIT_Y,-e.pitch,t),t=ls.multiply(gs,_s,gs),As=ls.fromAxisAngle(Zt.UNIT_Z,-e.heading,fs),ls.multiply(As,t,t)};var ms=new Zt,ys=new Zt,Es=new ls,xs=new ls,Cs=new ls;ls.packedLength=4,ls.pack=function(e,t,r){return qt.typeOf.object("value",e),qt.defined("array",t),r=Yt(r,0),t[r++]=e.x,t[r++]=e.y,t[r++]=e.z,t[r]=e.w,t},ls.unpack=function(e,t,r){return qt.defined("array",e),t=Yt(t,0),jt(r)||(r=new ls),r.x=e[t],r.y=e[t+1],r.z=e[t+2],r.w=e[t+3],r},ls.packedInterpolationLength=3,ls.convertPackedArrayForInterpolation=function(e,t,r,n){ls.unpack(e,4*r,Cs),ls.conjugate(Cs,Cs);for(var i=0,o=r-t+1;i<o;i++){var s=3*i;ls.unpack(e,4*(t+i),Es),ls.multiply(Es,Cs,Es),Es.w<0&&ls.negate(Es,Es),ls.computeAxis(Es,ms);var a=ls.computeAngle(Es);n[s]=ms.x*a,n[s+1]=ms.y*a,n[s+2]=ms.z*a}},ls.unpackInterpolationResult=function(e,t,r,n,i){jt(i)||(i=new ls),Zt.fromArray(e,0,ys);var o=Zt.magnitude(ys);return ls.unpack(t,4*n,xs),0===o?ls.clone(ls.IDENTITY,Es):ls.fromAxisAngle(ys,o,Es),ls.multiply(Es,xs,i)},ls.clone=function(e,t){if(jt(e))return jt(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t):new ls(e.x,e.y,e.z,e.w)},ls.conjugate=function(e,t){return qt.typeOf.object("quaternion",e),qt.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t},ls.magnitudeSquared=function(e){return qt.typeOf.object("quaternion",e),e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},ls.magnitude=function(e){return Math.sqrt(ls.magnitudeSquared(e))},ls.normalize=function(e,t){qt.typeOf.object("result",t);var r=1/ls.magnitude(e),n=e.x*r,i=e.y*r,o=e.z*r,s=e.w*r;return t.x=n,t.y=i,t.z=o,t.w=s,t},ls.inverse=function(e,t){qt.typeOf.object("result",t);var r=ls.magnitudeSquared(e);return t=ls.conjugate(e,t),ls.multiplyByScalar(t,1/r,t)},ls.add=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x+t.x,r.y=e.y+t.y,r.z=e.z+t.z,r.w=e.w+t.w,r},ls.subtract=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.x=e.x-t.x,r.y=e.y-t.y,r.z=e.z-t.z,r.w=e.w-t.w,r},ls.negate=function(e,t){return qt.typeOf.object("quaternion",e),qt.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},ls.dot=function(e,t){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},ls.multiply=function(e,t,r){qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r);var n=e.x,i=e.y,o=e.z,s=e.w,a=t.x,u=t.y,c=t.z,l=t.w,h=s*a+n*l+i*c-o*u,p=s*u-n*c+i*l+o*a,d=s*c+n*u-i*a+o*l,f=s*l-n*a-i*u-o*c;return r.x=h,r.y=p,r.z=d,r.w=f,r},ls.multiplyByVec=function(e,t,r){var n=new Zt,i=new Zt,o=new Zt(e.x,e.y,e.z);n=Zt.cross(o,t,n),i=Zt.cross(o,n,i);var s=new Zt;s=Zt.multiplyByScalar(n,2*e.w,s);var a=new Zt;return a=Zt.multiplyByScalar(n,2,a),r=Zt.add(t,s,r),r=Zt.add(r,a,r)},ls.multiplyByScalar=function(e,t,r){return qt.typeOf.object("quaternion",e),qt.typeOf.number("scalar",t),qt.typeOf.object("result",r),r.x=e.x*t,r.y=e.y*t,r.z=e.z*t,r.w=e.w*t,r},ls.divideByScalar=function(e,t,r){return qt.typeOf.object("quaternion",e),qt.typeOf.number("scalar",t),qt.typeOf.object("result",r),r.x=e.x/t,r.y=e.y/t,r.z=e.z/t,r.w=e.w/t,r},ls.computeAxis=function(e,t){qt.typeOf.object("quaternion",e),qt.typeOf.object("result",t);var r=e.w;if(Math.abs(r-1)<Wt.EPSILON6)return t.x=t.y=t.z=0,t;var n=1/Math.sqrt(1-r*r);return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t},ls.computeAngle=function(e){return qt.typeOf.object("quaternion",e),Math.abs(e.w-1)<Wt.EPSILON6?0:2*Math.acos(e.w)};var bs=new ls;ls.lerp=function(e,t,r,n){return qt.typeOf.object("start",e),qt.typeOf.object("end",t),qt.typeOf.number("t",r),qt.typeOf.object("result",n),bs=ls.multiplyByScalar(t,r,bs),n=ls.multiplyByScalar(e,1-r,n),ls.add(bs,n,n)};var Is=new ls,Ts=new ls,vs=new ls;ls.slerp=function(e,t,r,n){qt.typeOf.object("start",e),qt.typeOf.object("end",t),qt.typeOf.number("t",r),qt.typeOf.object("result",n);var i=ls.dot(e,t),o=t;if(i<0&&(i=-i,o=Is=ls.negate(t,Is)),1-i<Wt.EPSILON6)return ls.lerp(e,o,r,n);var s=Math.acos(i);return Ts=ls.multiplyByScalar(e,Math.sin((1-r)*s),Ts),vs=ls.multiplyByScalar(o,Math.sin(r*s),vs),n=ls.add(Ts,vs,n),ls.multiplyByScalar(n,1/Math.sin(s),n)},ls.log=function(e,t){qt.typeOf.object("quaternion",e),qt.typeOf.object("result",t);var r=Wt.acosClamped(e.w),n=0;return 0!==r&&(n=r/Math.sin(r)),Zt.multiplyByScalar(e,n,t)},ls.exp=function(e,t){qt.typeOf.object("cartesian",e),qt.typeOf.object("result",t);var r=Zt.magnitude(e),n=0;return 0!==r&&(n=Math.sin(r)/r),t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=Math.cos(r),t};var Rs=new Zt,Ms=new Zt,ws=new ls,Ss=new ls;ls.computeInnerQuadrangle=function(e,t,r,n){qt.typeOf.object("q0",e),qt.typeOf.object("q1",t),qt.typeOf.object("q2",r),qt.typeOf.object("result",n);var i=ls.conjugate(t,ws);ls.multiply(i,r,Ss);var o=ls.log(Ss,Rs);ls.multiply(i,e,Ss);var s=ls.log(Ss,Ms);return Zt.add(o,s,o),Zt.multiplyByScalar(o,.25,o),Zt.negate(o,o),ls.exp(o,ws),ls.multiply(t,ws,n)},ls.squad=function(e,t,r,n,i,o){qt.typeOf.object("q0",e),qt.typeOf.object("q1",t),qt.typeOf.object("s0",r),qt.typeOf.object("s1",n),qt.typeOf.number("t",i),qt.typeOf.object("result",o);var s=ls.slerp(e,t,i,ws),a=ls.slerp(r,n,i,Ss);return ls.slerp(s,a,2*i*(1-i),o)};for(var Bs=new ls,Os=1.9011074535173003,Ds=cs.supportsTypedArrays()?new Float32Array(8):[],Fs=cs.supportsTypedArrays()?new Float32Array(8):[],Ps=cs.supportsTypedArrays()?new Float32Array(8):[],Ns=cs.supportsTypedArrays()?new Float32Array(8):[],Ls=0;Ls<7;++Ls){var Us=Ls+1,Gs=2*Us+1;Ds[Ls]=1/(Us*Gs),Fs[Ls]=Us/Gs}function Qs(e){this._ellipsoid=Yt(e,Qi.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}Ds[7]=Os/136,Fs[7]=8*Os/17,ls.fastSlerp=function(e,t,r,n){qt.typeOf.object("start",e),qt.typeOf.object("end",t),qt.typeOf.number("t",r),qt.typeOf.object("result",n);var i,o=ls.dot(e,t);o>=0?i=1:(i=-1,o=-o);for(var s=o-1,a=1-r,u=r*r,c=a*a,l=7;l>=0;--l)Ps[l]=(Ds[l]*u-Fs[l])*s,Ns[l]=(Ds[l]*c-Fs[l])*s;var h=i*r*(1+Ps[0]*(1+Ps[1]*(1+Ps[2]*(1+Ps[3]*(1+Ps[4]*(1+Ps[5]*(1+Ps[6]*(1+Ps[7])))))))),p=a*(1+Ns[0]*(1+Ns[1]*(1+Ns[2]*(1+Ns[3]*(1+Ns[4]*(1+Ns[5]*(1+Ns[6]*(1+Ns[7])))))))),d=ls.multiplyByScalar(e,p,Bs);return ls.multiplyByScalar(t,h,n),ls.add(d,n,n)},ls.fastSquad=function(e,t,r,n,i,o){qt.typeOf.object("q0",e),qt.typeOf.object("q1",t),qt.typeOf.object("s0",r),qt.typeOf.object("s1",n),qt.typeOf.number("t",i),qt.typeOf.object("result",o);var s=ls.fastSlerp(e,t,i,ws),a=ls.fastSlerp(r,n,i,Ss);return ls.fastSlerp(s,a,2*i*(1-i),o)},ls.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},ls.equalsEpsilon=function(e,t,r){return qt.typeOf.number("epsilon",r),e===t||jt(e)&&jt(t)&&Math.abs(e.x-t.x)<=r&&Math.abs(e.y-t.y)<=r&&Math.abs(e.z-t.z)<=r&&Math.abs(e.w-t.w)<=r},ls.ZERO=Object.freeze(new ls(0,0,0,0)),ls.IDENTITY=Object.freeze(new ls(0,0,0,1)),ls.prototype.clone=function(e){return ls.clone(this,e)},ls.prototype.equals=function(e){return ls.equals(this,e)},ls.prototype.equalsEpsilon=function(e,t){return ls.equalsEpsilon(this,e,t)},ls.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},Object.defineProperties(Qs.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),Qs.prototype.project=function(e,t){var r=this._semimajorAxis,n=e.longitude*r,i=e.latitude*r,o=e.height;return jt(t)?(t.x=n,t.y=i,t.z=o,t):new Zt(n,i,o)},Qs.prototype.unproject=function(e,t){if(!jt(e))throw new Ht("cartesian is required");var r=this._oneOverSemimajorAxis,n=e.x*r,i=e.y*r,o=e.z;return jt(t)?(t.longitude=n,t.latitude=i,t.height=o,t):new lr(n,i,o)};var ks={},zs={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},js={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Hs={},qs={east:new Zt,north:new Zt,up:new Zt,west:new Zt,south:new Zt,down:new Zt},Vs=new Zt,Ys=new Zt,Xs=new Zt;ks.localFrameToFixedFrameGenerator=function(e,t){if(!zs.hasOwnProperty(e)||!zs[e].hasOwnProperty(t))throw new Ht("firstAxis and secondAxis must be east, north, up, west, south or down.");var r,n=zs[e][t],i=e+t;return jt(Hs[i])?r=Hs[i]:(r=function(r,i,o){if(!jt(r))throw new Ht("origin is required.");if(jt(o)||(o=new yo),Zt.equalsEpsilon(r,Zt.ZERO,Wt.EPSILON14))Zt.unpack(js[e],0,Vs),Zt.unpack(js[t],0,Ys),Zt.unpack(js[n],0,Xs);else if(Wt.equalsEpsilon(r.x,0,Wt.EPSILON14)&&Wt.equalsEpsilon(r.y,0,Wt.EPSILON14)){var s=Wt.sign(r.z);Zt.unpack(js[e],0,Vs),"east"!==e&&"west"!==e&&Zt.multiplyByScalar(Vs,s,Vs),Zt.unpack(js[t],0,Ys),"east"!==t&&"west"!==t&&Zt.multiplyByScalar(Ys,s,Ys),Zt.unpack(js[n],0,Xs),"east"!==n&&"west"!==n&&Zt.multiplyByScalar(Xs,s,Xs)}else{(i=Yt(i,Qi.WGS84)).geodeticSurfaceNormal(r,qs.up);var a=qs.up,u=qs.east;u.x=-r.y,u.y=r.x,u.z=0,Zt.normalize(u,qs.east),Zt.cross(a,u,qs.north),Zt.multiplyByScalar(qs.up,-1,qs.down),Zt.multiplyByScalar(qs.east,-1,qs.west),Zt.multiplyByScalar(qs.north,-1,qs.south),Vs=qs[e],Ys=qs[t],Xs=qs[n]}return o[0]=Vs.x,o[1]=Vs.y,o[2]=Vs.z,o[3]=0,o[4]=Ys.x,o[5]=Ys.y,o[6]=Ys.z,o[7]=0,o[8]=Xs.x,o[9]=Xs.y,o[10]=Xs.z,o[11]=0,o[12]=r.x,o[13]=r.y,o[14]=r.z,o[15]=1,o},Hs[i]=r),r},ks.eastNorthUpToFixedFrame=ks.localFrameToFixedFrameGenerator("east","north"),ks.northEastDownToFixedFrame=ks.localFrameToFixedFrameGenerator("north","east"),ks.northUpEastToFixedFrame=ks.localFrameToFixedFrameGenerator("north","up"),ks.northWestUpToFixedFrame=ks.localFrameToFixedFrameGenerator("north","west");var Ws=new ls,Ks=new Zt(1,1,1),Js=new yo;ks.headingPitchRollToFixedFrame=function(e,t,r,n,i){qt.typeOf.object("HeadingPitchRoll",t),n=Yt(n,ks.eastNorthUpToFixedFrame);var o=ls.fromHeadingPitchRoll(t,Ws),s=yo.fromTranslationQuaternionRotationScale(Zt.ZERO,o,Ks,Js);return i=n(e,r,i),yo.multiply(i,s,i)};var Zs=new yo,$s=new uo;ks.headingPitchRollQuaternion=function(e,t,r,n,i){qt.typeOf.object("HeadingPitchRoll",t);var o=ks.headingPitchRollToFixedFrame(e,t,r,n,Zs),s=yo.getMatrix3(o,$s);return ls.fromRotationMatrix(s,i)};var ea=new Zt(1,1,1),ta=new Zt,ra=new yo,na=new yo,ia=new uo,oa=new ls;ks.fixedFrameToHeadingPitchRoll=function(e,t,r,n){qt.defined("transform",e),t=Yt(t,Qi.WGS84),r=Yt(r,ks.eastNorthUpToFixedFrame),jt(n)||(n=new Yi);var i=yo.getTranslation(e,ta);if(Zt.equals(i,Zt.ZERO))return n.heading=0,n.pitch=0,n.roll=0,n;var o=yo.inverseTransformation(r(i,t,ra),ra),s=yo.setScale(e,ea,na);s=yo.setTranslation(s,Zt.ZERO,s),o=yo.multiply(o,s,o);var a=ls.fromRotationMatrix(yo.getMatrix3(o,ia),oa);return a=ls.normalize(a,a),Yi.fromQuaternion(a,n)};var sa=Wt.TWO_PI/86400,aa=new nn;ks.computeTemeToPseudoFixedMatrix=function(e,t){if(!jt(e))throw new Ht("date is required.");var r,n=(aa=nn.addSeconds(e,-nn.computeTaiMinusUtc(e),aa)).dayNumber,i=aa.secondsOfDay,o=n-2451545,s=(24110.54841+(r=i>=43200?(o+.5)/Lr.DAYS_PER_JULIAN_CENTURY:(o-.5)/Lr.DAYS_PER_JULIAN_CENTURY)*(8640184.812866+r*(.093104+-62e-7*r)))*sa%Wt.TWO_PI+(72921158553e-15+11772758384668e-32*(n-2451545.5))*((i+.5*Lr.SECONDS_PER_DAY)%Lr.SECONDS_PER_DAY),a=Math.cos(s),u=Math.sin(s);return jt(t)?(t[0]=a,t[1]=-u,t[2]=0,t[3]=u,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new uo(a,u,0,-u,a,0,0,0,1)},ks.iau2006XysData=new io,ks.earthOrientationParameters=Di.NONE;var ua=32.184;ks.preloadIcrfFixed=function(e){var t=e.start.dayNumber,r=e.start.secondsOfDay+ua,n=e.stop.dayNumber,i=e.stop.secondsOfDay+ua,o=ks.iau2006XysData.preload(t,r,n,i),s=ks.earthOrientationParameters.getPromiseToLoad();return Promise.all([o,s])},ks.computeIcrfToFixedMatrix=function(e,t){if(!jt(e))throw new Ht("date is required.");jt(t)||(t=new uo);var r=ks.computeFixedToIcrfMatrix(e,t);if(jt(r))return uo.transpose(r,t)};var ca=new no(0,0,0),la=new Or(0,0,0,0,0),ha=new uo,pa=new uo;ks.computeFixedToIcrfMatrix=function(e,t){if(!jt(e))throw new Ht("date is required.");jt(t)||(t=new uo);var r=ks.earthOrientationParameters.compute(e,la);if(jt(r)){var n=e.dayNumber,i=e.secondsOfDay+ua,o=ks.iau2006XysData.computeXysRadians(n,i,ca);if(jt(o)){var s=o.x+r.xPoleOffset,a=o.y+r.yPoleOffset,u=1/(1+Math.sqrt(1-s*s-a*a)),c=ha;c[0]=1-u*s*s,c[3]=-u*s*a,c[6]=s,c[1]=-u*s*a,c[4]=1-u*a*a,c[7]=a,c[2]=-s,c[5]=-a,c[8]=1-u*(s*s+a*a);var l=uo.fromRotationZ(-o.s,pa),h=uo.multiply(c,l,ha),p=e.dayNumber-2451545,d=(e.secondsOfDay-nn.computeTaiMinusUtc(e)+r.ut1MinusUtc)/Lr.SECONDS_PER_DAY,f=.779057273264+d+.00273781191135448*(p+d);f=f%1*Wt.TWO_PI;var A=uo.fromRotationZ(f,pa),g=uo.multiply(h,A,ha),_=Math.cos(r.xPoleWander),m=Math.cos(r.yPoleWander),y=Math.sin(r.xPoleWander),E=Math.sin(r.yPoleWander),x=n-2451545+i/Lr.SECONDS_PER_DAY,C=-47e-6*(x/=36525)*Wt.RADIANS_PER_DEGREE/3600,b=Math.cos(C),I=Math.sin(C),T=pa;return T[0]=_*b,T[1]=_*I,T[2]=y,T[3]=-m*I+E*y*b,T[4]=m*b+E*y*I,T[5]=-E*_,T[6]=-E*I-m*y*b,T[7]=E*b-m*y*I,T[8]=m*_,uo.multiply(g,T,t)}}};var da=new br;ks.pointToWindowCoordinates=function(e,t,r,n){return(n=ks.pointToGLWindowCoordinates(e,t,r,n)).y=2*t[5]-n.y,n},ks.pointToGLWindowCoordinates=function(e,t,r,n){if(!jt(e))throw new Ht("modelViewProjectionMatrix is required.");if(!jt(t))throw new Ht("viewportTransformation is required.");if(!jt(r))throw new Ht("point is required.");jt(n)||(n=new _r);var i=da;return yo.multiplyByVector(e,br.fromElements(r.x,r.y,r.z,1,i),i),br.multiplyByScalar(i,1/i.w,i),yo.multiplyByVector(t,i,i),_r.fromCartesian4(i,n)};var fa=new Zt,Aa=new Zt,ga=new Zt;ks.rotationMatrixFromPositionVelocity=function(e,t,r,n){if(!jt(e))throw new Ht("position is required.");if(!jt(t))throw new Ht("velocity is required.");var i=Yt(r,Qi.WGS84).geodeticSurfaceNormal(e,fa),o=Zt.cross(t,i,Aa);Zt.equalsEpsilon(o,Zt.ZERO,Wt.EPSILON6)&&(o=Zt.clone(Zt.UNIT_X,o));var s=Zt.cross(o,t,ga);return Zt.normalize(s,s),Zt.cross(t,s,o),Zt.negate(o,o),Zt.normalize(o,o),jt(n)||(n=new uo),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=o.x,n[4]=o.y,n[5]=o.z,n[6]=s.x,n[7]=s.y,n[8]=s.z,n};var _a=new yo(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),ma=new lr,ya=new Zt,Ea=new Zt,xa=new uo,Ca=new yo,ba=new yo;ks.basisTo2D=function(e,t,r){if(!jt(e))throw new Ht("projection is required.");if(!jt(t))throw new Ht("matrix is required.");if(!jt(r))throw new Ht("result is required.");var n=yo.getTranslation(t,Ea),i=e.ellipsoid,o=i.cartesianToCartographic(n,ma),s=e.project(o,ya);Zt.fromElements(s.z,s.x,s.y,s);var a=ks.eastNorthUpToFixedFrame(n,i,Ca),u=yo.inverseTransformation(a,ba),c=yo.getMatrix3(t,xa),l=yo.multiplyByMatrix3(u,c,r);return yo.multiply(_a,l,r),yo.setTranslation(r,s,r),r},ks.wgs84To2DModelMatrix=function(e,t,r){if(!jt(e))throw new Ht("projection is required.");if(!jt(t))throw new Ht("center is required.");if(!jt(r))throw new Ht("result is required.");var n=e.ellipsoid,i=ks.eastNorthUpToFixedFrame(t,n,Ca),o=yo.inverseTransformation(i,ba),s=n.cartesianToCartographic(t,ma),a=e.project(s,ya);Zt.fromElements(a.z,a.x,a.y,a);var u=yo.fromTranslation(a,Ca);return yo.multiply(_a,o,r),yo.multiply(u,r,r),r},ks.buildUp=function(e,t){var r=t.clone(),n=e.clone();n=Zt.normalize(n,n),Math.abs(Zt.dot(n,r))>=1&&(n=Math.abs(Zt.dot(r,Zt.UNIT_Y))<1?Zt.clone(Zt.UNIT_Y,n):Zt.clone(Zt.UNIT_Z,n));var i=new Zt;return Zt.cross(n,r,i),i=Zt.normalize(i,i),Zt.cross(r,i,n),n=Zt.normalize(n,n)},ks.getHeading=function(e,t){var r;return r=Wt.equalsEpsilon(Math.abs(e.z),1,Wt.EPSILON3)?Math.atan2(t.y,t.x)-Wt.PI_OVER_TWO:Math.atan2(e.y,e.x)-Wt.PI_OVER_TWO,Wt.TWO_PI-Wt.zeroToTwoPi(r)},ks.convertToColumbusCartesian=function(e){var t=new Qs,r=t.ellipsoid,n=new Zt,i=new lr;return r.cartesianToCartographic(e,i),t.project(i,n),Zt.fromElements(n.z,n.x,n.y)},ks.convertTo3DCartesian=function(e){var t=new Qs,r=t.ellipsoid,n=new Zt,i=new lr;return n=Zt.fromElements(e.y,e.z,e.x),t.unproject(n,i),r.cartographicToCartesian(i,n)};var Ia={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3,getMorphTime:function(e){return e===Ia.SCENE3D?1:e!==Ia.MORPHING?0:void 0}},Ta=Object.freeze(Ia),va=8192,Ra=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1});function Ma(e,t){this.start=Yt(e,0),this.stop=Yt(t,0)}function wa(e,t,r,n){this.west=Yt(e,0),this.south=Yt(t,0),this.east=Yt(r,0),this.north=Yt(n,0)}Object.defineProperties(wa.prototype,{width:{get:function(){return wa.computeWidth(this)}},height:{get:function(){return wa.computeHeight(this)}}}),wa.packedLength=4,wa.pack=function(e,t,r){return qt.typeOf.object("value",e),qt.defined("array",t),r=Yt(r,0),t[r++]=e.west,t[r++]=e.south,t[r++]=e.east,t[r]=e.north,t},wa.unpack=function(e,t,r){return qt.defined("array",e),t=Yt(t,0),jt(r)||(r=new wa),r.west=e[t++],r.south=e[t++],r.east=e[t++],r.north=e[t],r},wa.computeWidth=function(e){qt.typeOf.object("rectangle",e);var t=e.east,r=e.west;return t<r&&(t+=Wt.TWO_PI),t-r},wa.computeHeight=function(e){return qt.typeOf.object("rectangle",e),e.north-e.south},wa.fromDegrees=function(e,t,r,n,i){return e=Wt.toRadians(Yt(e,0)),t=Wt.toRadians(Yt(t,0)),r=Wt.toRadians(Yt(r,0)),n=Wt.toRadians(Yt(n,0)),jt(i)?(i.west=e,i.south=t,i.east=r,i.north=n,i):new wa(e,t,r,n)},wa.fromRadians=function(e,t,r,n,i){return jt(i)?(i.west=Yt(e,0),i.south=Yt(t,0),i.east=Yt(r,0),i.north=Yt(n,0),i):new wa(e,t,r,n)},wa.fromCartographicArray=function(e,t){qt.defined("cartographics",e);for(var r=Number.MAX_VALUE,n=-Number.MAX_VALUE,i=Number.MAX_VALUE,o=-Number.MAX_VALUE,s=Number.MAX_VALUE,a=-Number.MAX_VALUE,u=0,c=e.length;u<c;u++){var l=e[u];r=Math.min(r,l.longitude),n=Math.max(n,l.longitude),s=Math.min(s,l.latitude),a=Math.max(a,l.latitude);var h=l.longitude>=0?l.longitude:l.longitude+Wt.TWO_PI;i=Math.min(i,h),o=Math.max(o,h)}return n-r>o-i&&(r=i,(n=o)>Wt.PI&&(n-=Wt.TWO_PI),r>Wt.PI&&(r-=Wt.TWO_PI)),jt(t)?(t.west=r,t.south=s,t.east=n,t.north=a,t):new wa(r,s,n,a)},wa.fromCartesianArray=function(e,t,r){qt.defined("cartesians",e),t=Yt(t,Qi.WGS84);for(var n=Number.MAX_VALUE,i=-Number.MAX_VALUE,o=Number.MAX_VALUE,s=-Number.MAX_VALUE,a=Number.MAX_VALUE,u=-Number.MAX_VALUE,c=0,l=e.length;c<l;c++){var h=t.cartesianToCartographic(e[c]);n=Math.min(n,h.longitude),i=Math.max(i,h.longitude),a=Math.min(a,h.latitude),u=Math.max(u,h.latitude);var p=h.longitude>=0?h.longitude:h.longitude+Wt.TWO_PI;o=Math.min(o,p),s=Math.max(s,p)}return i-n>s-o&&(n=o,(i=s)>Wt.PI&&(i-=Wt.TWO_PI),n>Wt.PI&&(n-=Wt.TWO_PI)),jt(r)?(r.west=n,r.south=a,r.east=i,r.north=u,r):new wa(n,a,i,u)},wa.clone=function(e,t){if(jt(e))return jt(t)?(t.west=e.west,t.south=e.south,t.east=e.east,t.north=e.north,t):new wa(e.west,e.south,e.east,e.north)},wa.equalsEpsilon=function(e,t,r){return qt.typeOf.number("absoluteEpsilon",r),e===t||jt(e)&&jt(t)&&Math.abs(e.west-t.west)<=r&&Math.abs(e.south-t.south)<=r&&Math.abs(e.east-t.east)<=r&&Math.abs(e.north-t.north)<=r},wa.prototype.clone=function(e){return wa.clone(this,e)},wa.prototype.equals=function(e){return wa.equals(this,e)},wa.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e.west===t.west&&e.south===t.south&&e.east===t.east&&e.north===t.north},wa.prototype.equalsEpsilon=function(e,t){return qt.typeOf.number("epsilon",t),wa.equalsEpsilon(this,e,t)},wa.validate=function(e){qt.typeOf.object("rectangle",e);var t=e.north;qt.typeOf.number.greaterThanOrEquals("north",t,-Wt.PI_OVER_TWO),qt.typeOf.number.lessThanOrEquals("north",t,Wt.PI_OVER_TWO);var r=e.south;qt.typeOf.number.greaterThanOrEquals("south",r,-Wt.PI_OVER_TWO),qt.typeOf.number.lessThanOrEquals("south",r,Wt.PI_OVER_TWO);var n=e.west;qt.typeOf.number.greaterThanOrEquals("west",n,-Math.PI),qt.typeOf.number.lessThanOrEquals("west",n,Math.PI);var i=e.east;qt.typeOf.number.greaterThanOrEquals("east",i,-Math.PI),qt.typeOf.number.lessThanOrEquals("east",i,Math.PI)},wa.southwest=function(e,t){return qt.typeOf.object("rectangle",e),jt(t)?(t.longitude=e.west,t.latitude=e.south,t.height=0,t):new lr(e.west,e.south)},wa.northwest=function(e,t){return qt.typeOf.object("rectangle",e),jt(t)?(t.longitude=e.west,t.latitude=e.north,t.height=0,t):new lr(e.west,e.north)},wa.northeast=function(e,t){return qt.typeOf.object("rectangle",e),jt(t)?(t.longitude=e.east,t.latitude=e.north,t.height=0,t):new lr(e.east,e.north)},wa.southeast=function(e,t){return qt.typeOf.object("rectangle",e),jt(t)?(t.longitude=e.east,t.latitude=e.south,t.height=0,t):new lr(e.east,e.south)},wa.center=function(e,t){qt.typeOf.object("rectangle",e);var r=e.east,n=e.west;r<n&&(r+=Wt.TWO_PI);var i=Wt.negativePiToPi(.5*(n+r)),o=.5*(e.south+e.north);return jt(t)?(t.longitude=i,t.latitude=o,t.height=0,t):new lr(i,o)},wa.intersection=function(e,t,r){qt.typeOf.object("rectangle",e),qt.typeOf.object("otherRectangle",t);var n=e.east,i=e.west,o=t.east,s=t.west;n<i&&o>0?n+=Wt.TWO_PI:o<s&&n>0&&(o+=Wt.TWO_PI),n<i&&s<0?s+=Wt.TWO_PI:o<s&&i<0&&(i+=Wt.TWO_PI);var a=Wt.negativePiToPi(Math.max(i,s)),u=Wt.negativePiToPi(Math.min(n,o));if(!((e.west<e.east||t.west<t.east)&&u<=a)){var c=Math.max(e.south,t.south),l=Math.min(e.north,t.north);if(!(c>=l))return jt(r)?(r.west=a,r.south=c,r.east=u,r.north=l,r):new wa(a,c,u,l)}},wa.simpleIntersection=function(e,t,r){qt.typeOf.object("rectangle",e),qt.typeOf.object("otherRectangle",t);var n=Math.max(e.west,t.west),i=Math.max(e.south,t.south),o=Math.min(e.east,t.east),s=Math.min(e.north,t.north);if(!(i>=s||n>=o))return jt(r)?(r.west=n,r.south=i,r.east=o,r.north=s,r):new wa(n,i,o,s)},wa.union=function(e,t,r){qt.typeOf.object("rectangle",e),qt.typeOf.object("otherRectangle",t),jt(r)||(r=new wa);var n=e.east,i=e.west,o=t.east,s=t.west;n<i&&o>0?n+=Wt.TWO_PI:o<s&&n>0&&(o+=Wt.TWO_PI),n<i&&s<0?s+=Wt.TWO_PI:o<s&&i<0&&(i+=Wt.TWO_PI);var a=Wt.convertLongitudeRange(Math.min(i,s)),u=Wt.convertLongitudeRange(Math.max(n,o));return r.west=a,r.south=Math.min(e.south,t.south),r.east=u,r.east<r.west&&(r.east+=Wt.TWO_PI),r.north=Math.max(e.north,t.north),r},wa.expand=function(e,t,r){return qt.typeOf.object("rectangle",e),qt.typeOf.object("cartographic",t),jt(r)||(r=new wa),r.west=Math.min(e.west,t.longitude),r.south=Math.min(e.south,t.latitude),r.east=Math.max(e.east,t.longitude),r.north=Math.max(e.north,t.latitude),r},wa.contains=function(e,t){qt.typeOf.object("rectangle",e),qt.typeOf.object("cartographic",t);var r=t.longitude,n=t.latitude,i=e.west,o=e.east;return o<i&&(o+=Wt.TWO_PI,r<0&&(r+=Wt.TWO_PI)),(r>i||Wt.equalsEpsilon(r,i,Wt.EPSILON14))&&(r<o||Wt.equalsEpsilon(r,o,Wt.EPSILON14))&&n>=e.south&&n<=e.north};var Sa=new lr;wa.subsample=function(e,t,r,n){qt.typeOf.object("rectangle",e),t=Yt(t,Qi.WGS84),r=Yt(r,0),jt(n)||(n=[]);var i=0,o=e.north,s=e.south,a=e.east,u=e.west,c=Sa;c.height=r,c.longitude=u,c.latitude=o,n[i]=t.cartographicToCartesian(c,n[i]),i++,c.longitude=a,n[i]=t.cartographicToCartesian(c,n[i]),i++,c.latitude=s,n[i]=t.cartographicToCartesian(c,n[i]),i++,c.longitude=u,n[i]=t.cartographicToCartesian(c,n[i]),i++,c.latitude=o<0?o:s>0?s:0;for(var l=1;l<8;++l)c.longitude=-Math.PI+l*Wt.PI_OVER_TWO,wa.contains(e,c)&&(n[i]=t.cartographicToCartesian(c,n[i]),i++);return 0===c.latitude&&(c.longitude=u,n[i]=t.cartographicToCartesian(c,n[i]),i++,c.longitude=a,n[i]=t.cartographicToCartesian(c,n[i]),i++),n.length=i,n};var Ba=new lr;function Oa(e,t){this.center=Zt.clone(Yt(e,Zt.ZERO)),this.radius=Yt(t,0)}wa.prototype.contains=function(e){return wa.contains(this,wa.southwest(e,Ba))&&wa.contains(this,wa.northwest(e,Ba))&&wa.contains(this,wa.southeast(e,Ba))&&wa.contains(this,wa.northeast(e,Ba))},wa.MAX_VALUE=Object.freeze(new wa(-Math.PI,-Wt.PI_OVER_TWO,Math.PI,Wt.PI_OVER_TWO));var Da=new Zt,Fa=new Zt,Pa=new Zt,Na=new Zt,La=new Zt,Ua=new Zt,Ga=new Zt,Qa=new Zt,ka=new Zt,za=new Zt,ja=new Zt,Ha=new Zt,qa=4/3*Wt.PI;Oa.fromPoints=function(e,t){if(jt(t)||(t=new Oa),!jt(e)||0===e.length)return t.center=Zt.clone(Zt.ZERO,t.center),t.radius=0,t;var r,n=Zt.clone(e[0],Ga),i=Zt.clone(n,Da),o=Zt.clone(n,Fa),s=Zt.clone(n,Pa),a=Zt.clone(n,Na),u=Zt.clone(n,La),c=Zt.clone(n,Ua),l=e.length;for(r=1;r<l;r++){Zt.clone(e[r],n);var h=n.x,p=n.y,d=n.z;h<i.x&&Zt.clone(n,i),h>a.x&&Zt.clone(n,a),p<o.y&&Zt.clone(n,o),p>u.y&&Zt.clone(n,u),d<s.z&&Zt.clone(n,s),d>c.z&&Zt.clone(n,c)}var f=Zt.magnitudeSquared(Zt.subtract(a,i,Qa)),A=Zt.magnitudeSquared(Zt.subtract(u,o,Qa)),g=Zt.magnitudeSquared(Zt.subtract(c,s,Qa)),_=i,m=a,y=f;A>y&&(y=A,_=o,m=u),g>y&&(y=g,_=s,m=c);var E=ka;E.x=.5*(_.x+m.x),E.y=.5*(_.y+m.y),E.z=.5*(_.z+m.z);var x=Zt.magnitudeSquared(Zt.subtract(m,E,Qa)),C=Math.sqrt(x),b=za;b.x=i.x,b.y=o.y,b.z=s.z;var I=ja;I.x=a.x,I.y=u.y,I.z=c.z;var T=Zt.midpoint(b,I,Ha),v=0;for(r=0;r<l;r++){Zt.clone(e[r],n);var R=Zt.magnitude(Zt.subtract(n,T,Qa));R>v&&(v=R);var M=Zt.magnitudeSquared(Zt.subtract(n,E,Qa));if(M>x){var w=Math.sqrt(M);x=(C=.5*(C+w))*C;var S=w-C;E.x=(C*E.x+S*n.x)/w,E.y=(C*E.y+S*n.y)/w,E.z=(C*E.z+S*n.z)/w}}return C<v?(Zt.clone(E,t.center),t.radius=C):(Zt.clone(T,t.center),t.radius=v),t};var Va=new Qs,Ya=new Zt,Xa=new Zt,Wa=new lr,Ka=new lr;Oa.fromRectangle2D=function(e,t,r){return Oa.fromRectangleWithHeights2D(e,t,0,0,r)},Oa.fromRectangleWithHeights2D=function(e,t,r,n,i){if(jt(i)||(i=new Oa),!jt(e))return i.center=Zt.clone(Zt.ZERO,i.center),i.radius=0,i;t=Yt(t,Va),wa.southwest(e,Wa),Wa.height=r,wa.northeast(e,Ka),Ka.height=n;var o=t.project(Wa,Ya),s=t.project(Ka,Xa),a=s.x-o.x,u=s.y-o.y,c=s.z-o.z;i.radius=.5*Math.sqrt(a*a+u*u+c*c);var l=i.center;return l.x=o.x+.5*a,l.y=o.y+.5*u,l.z=o.z+.5*c,i};var Ja=[];Oa.fromRectangle3D=function(e,t,r,n){if(t=Yt(t,Qi.WGS84),r=Yt(r,0),jt(n)||(n=new Oa),!jt(e))return n.center=Zt.clone(Zt.ZERO,n.center),n.radius=0,n;var i=wa.subsample(e,t,r,Ja);return Oa.fromPoints(i,n)},Oa.fromVertices=function(e,t,r,n){if(jt(n)||(n=new Oa),!jt(e)||0===e.length)return n.center=Zt.clone(Zt.ZERO,n.center),n.radius=0,n;t=Yt(t,Zt.ZERO),r=Yt(r,3),qt.typeOf.number.greaterThanOrEquals("stride",r,3);var i=Ga;i.x=e[0]+t.x,i.y=e[1]+t.y,i.z=e[2]+t.z;var o,s=Zt.clone(i,Da),a=Zt.clone(i,Fa),u=Zt.clone(i,Pa),c=Zt.clone(i,Na),l=Zt.clone(i,La),h=Zt.clone(i,Ua),p=e.length;for(o=0;o<p;o+=r){var d=e[o]+t.x,f=e[o+1]+t.y,A=e[o+2]+t.z;i.x=d,i.y=f,i.z=A,d<s.x&&Zt.clone(i,s),d>c.x&&Zt.clone(i,c),f<a.y&&Zt.clone(i,a),f>l.y&&Zt.clone(i,l),A<u.z&&Zt.clone(i,u),A>h.z&&Zt.clone(i,h)}var g=Zt.magnitudeSquared(Zt.subtract(c,s,Qa)),_=Zt.magnitudeSquared(Zt.subtract(l,a,Qa)),m=Zt.magnitudeSquared(Zt.subtract(h,u,Qa)),y=s,E=c,x=g;_>x&&(x=_,y=a,E=l),m>x&&(x=m,y=u,E=h);var C=ka;C.x=.5*(y.x+E.x),C.y=.5*(y.y+E.y),C.z=.5*(y.z+E.z);var b=Zt.magnitudeSquared(Zt.subtract(E,C,Qa)),I=Math.sqrt(b),T=za;T.x=s.x,T.y=a.y,T.z=u.z;var v=ja;v.x=c.x,v.y=l.y,v.z=h.z;var R=Zt.midpoint(T,v,Ha),M=0;for(o=0;o<p;o+=r){i.x=e[o]+t.x,i.y=e[o+1]+t.y,i.z=e[o+2]+t.z;var w=Zt.magnitude(Zt.subtract(i,R,Qa));w>M&&(M=w);var S=Zt.magnitudeSquared(Zt.subtract(i,C,Qa));if(S>b){var B=Math.sqrt(S);b=(I=.5*(I+B))*I;var O=B-I;C.x=(I*C.x+O*i.x)/B,C.y=(I*C.y+O*i.y)/B,C.z=(I*C.z+O*i.z)/B}}return I<M?(Zt.clone(C,n.center),n.radius=I):(Zt.clone(R,n.center),n.radius=M),n},Oa.fromEncodedCartesianVertices=function(e,t,r){if(jt(r)||(r=new Oa),!jt(e)||!jt(t)||e.length!==t.length||0===e.length)return r.center=Zt.clone(Zt.ZERO,r.center),r.radius=0,r;var n=Ga;n.x=e[0]+t[0],n.y=e[1]+t[1],n.z=e[2]+t[2];var i,o=Zt.clone(n,Da),s=Zt.clone(n,Fa),a=Zt.clone(n,Pa),u=Zt.clone(n,Na),c=Zt.clone(n,La),l=Zt.clone(n,Ua),h=e.length;for(i=0;i<h;i+=3){var p=e[i]+t[i],d=e[i+1]+t[i+1],f=e[i+2]+t[i+2];n.x=p,n.y=d,n.z=f,p<o.x&&Zt.clone(n,o),p>u.x&&Zt.clone(n,u),d<s.y&&Zt.clone(n,s),d>c.y&&Zt.clone(n,c),f<a.z&&Zt.clone(n,a),f>l.z&&Zt.clone(n,l)}var A=Zt.magnitudeSquared(Zt.subtract(u,o,Qa)),g=Zt.magnitudeSquared(Zt.subtract(c,s,Qa)),_=Zt.magnitudeSquared(Zt.subtract(l,a,Qa)),m=o,y=u,E=A;g>E&&(E=g,m=s,y=c),_>E&&(E=_,m=a,y=l);var x=ka;x.x=.5*(m.x+y.x),x.y=.5*(m.y+y.y),x.z=.5*(m.z+y.z);var C=Zt.magnitudeSquared(Zt.subtract(y,x,Qa)),b=Math.sqrt(C),I=za;I.x=o.x,I.y=s.y,I.z=a.z;var T=ja;T.x=u.x,T.y=c.y,T.z=l.z;var v=Zt.midpoint(I,T,Ha),R=0;for(i=0;i<h;i+=3){n.x=e[i]+t[i],n.y=e[i+1]+t[i+1],n.z=e[i+2]+t[i+2];var M=Zt.magnitude(Zt.subtract(n,v,Qa));M>R&&(R=M);var w=Zt.magnitudeSquared(Zt.subtract(n,x,Qa));if(w>C){var S=Math.sqrt(w);C=(b=.5*(b+S))*b;var B=S-b;x.x=(b*x.x+B*n.x)/S,x.y=(b*x.y+B*n.y)/S,x.z=(b*x.z+B*n.z)/S}}return b<R?(Zt.clone(x,r.center),r.radius=b):(Zt.clone(v,r.center),r.radius=R),r},Oa.fromCornerPoints=function(e,t,r){qt.typeOf.object("corner",e),qt.typeOf.object("oppositeCorner",t),jt(r)||(r=new Oa);var n=Zt.midpoint(e,t,r.center);return r.radius=Zt.distance(n,t),r},Oa.fromEllipsoid=function(e,t){return qt.typeOf.object("ellipsoid",e),jt(t)||(t=new Oa),Zt.clone(Zt.ZERO,t.center),t.radius=e.maximumRadius,t};var Za=new Zt;Oa.fromBoundingSpheres=function(e,t){if(jt(t)||(t=new Oa),!jt(e)||0===e.length)return t.center=Zt.clone(Zt.ZERO,t.center),t.radius=0,t;var r=e.length;if(1===r)return Oa.clone(e[0],t);if(2===r)return Oa.union(e[0],e[1],t);var n,i=[];for(n=0;n<r;n++)i.push(e[n].center);var o=(t=Oa.fromPoints(i,t)).center,s=t.radius;for(n=0;n<r;n++){var a=e[n];s=Math.max(s,Zt.distance(o,a.center,Za)+a.radius)}return t.radius=s,t};var $a=new Zt,eu=new Zt,tu=new Zt;Oa.fromOrientedBoundingBox=function(e,t){qt.defined("orientedBoundingBox",e),jt(t)||(t=new Oa);var r=e.halfAxes,n=uo.getColumn(r,0,$a),i=uo.getColumn(r,1,eu),o=uo.getColumn(r,2,tu);return Zt.add(n,i,n),Zt.add(n,o,n),t.center=Zt.clone(e.center,t.center),t.radius=Zt.magnitude(n),t},Oa.clone=function(e,t){if(jt(e))return jt(t)?(t.center=Zt.clone(e.center,t.center),t.radius=e.radius,t):new Oa(e.center,e.radius)},Oa.packedLength=4,Oa.pack=function(e,t,r){qt.typeOf.object("value",e),qt.defined("array",t),r=Yt(r,0);var n=e.center;return t[r++]=n.x,t[r++]=n.y,t[r++]=n.z,t[r]=e.radius,t},Oa.unpack=function(e,t,r){qt.defined("array",e),t=Yt(t,0),jt(r)||(r=new Oa);var n=r.center;return n.x=e[t++],n.y=e[t++],n.z=e[t++],r.radius=e[t],r};var ru=new Zt,nu=new Zt;Oa.union=function(e,t,r){qt.typeOf.object("left",e),qt.typeOf.object("right",t),jt(r)||(r=new Oa);var n=e.center,i=e.radius,o=t.center,s=t.radius,a=Zt.subtract(o,n,ru),u=Zt.magnitude(a);if(i>=u+s)return e.clone(r),r;if(s>=u+i)return t.clone(r),r;var c=.5*(i+u+s),l=Zt.multiplyByScalar(a,(-i+c)/u,nu);return Zt.add(l,n,l),Zt.clone(l,r.center),r.radius=c,r};var iu=new Zt;Oa.expand=function(e,t,r){qt.typeOf.object("sphere",e),qt.typeOf.object("point",t),r=Oa.clone(e,r);var n=Zt.magnitude(Zt.subtract(t,r.center,iu));return n>r.radius&&(r.radius=n),r},Oa.intersectPlane=function(e,t){qt.typeOf.object("sphere",e),qt.typeOf.object("plane",t);var r=e.center,n=e.radius,i=t.normal,o=Zt.dot(i,r)+t.distance;return o<-n?Ra.OUTSIDE:o<n?Ra.INTERSECTING:Ra.INSIDE},Oa.transform=function(e,t,r){return qt.typeOf.object("sphere",e),qt.typeOf.object("transform",t),jt(r)||(r=new Oa),r.center=yo.multiplyByPoint(t,e.center,r.center),r.radius=yo.getMaximumScale(t)*e.radius,r};var ou=new Zt;Oa.distanceSquaredTo=function(e,t){qt.typeOf.object("sphere",e),qt.typeOf.object("cartesian",t);var r=Zt.subtract(e.center,t,ou);return Zt.magnitudeSquared(r)-e.radius*e.radius},Oa.transformWithoutScale=function(e,t,r){return qt.typeOf.object("sphere",e),qt.typeOf.object("transform",t),jt(r)||(r=new Oa),r.center=yo.multiplyByPoint(t,e.center,r.center),r.radius=e.radius,r};var su=new Zt;Oa.computePlaneDistances=function(e,t,r,n){qt.typeOf.object("sphere",e),qt.typeOf.object("position",t),qt.typeOf.object("direction",r),jt(n)||(n=new Ma);var i=Zt.subtract(e.center,t,su),o=Zt.dot(r,i);return n.start=o-e.radius,n.stop=o+e.radius,n};for(var au=new Zt,uu=new Zt,cu=new Zt,lu=new Zt,hu=new Zt,pu=new lr,du=new Array(8),fu=0;fu<8;++fu)du[fu]=new Zt;var Au=new Qs;function gu(e,t,r){this.minimum=Zt.clone(Yt(e,Zt.ZERO)),this.maximum=Zt.clone(Yt(t,Zt.ZERO)),r=jt(r)?Zt.clone(r):Zt.midpoint(this.minimum,this.maximum,new Zt),this.center=r}Oa.projectTo2D=function(e,t,r){qt.typeOf.object("sphere",e);var n,i=(t=Yt(t,Au)).ellipsoid,o=e.center,s=e.radius;n=Zt.equals(o,Zt.ZERO)?Zt.clone(Zt.UNIT_X,au):i.geodeticSurfaceNormal(o,au);var a=Zt.cross(Zt.UNIT_Z,n,uu);Zt.normalize(a,a);var u=Zt.cross(n,a,cu);Zt.normalize(u,u),Zt.multiplyByScalar(n,s,n),Zt.multiplyByScalar(u,s,u),Zt.multiplyByScalar(a,s,a);var c=Zt.negate(u,hu),l=Zt.negate(a,lu),h=du,p=h[0];Zt.add(n,u,p),Zt.add(p,a,p),p=h[1],Zt.add(n,u,p),Zt.add(p,l,p),p=h[2],Zt.add(n,c,p),Zt.add(p,l,p),p=h[3],Zt.add(n,c,p),Zt.add(p,a,p),Zt.negate(n,n),p=h[4],Zt.add(n,u,p),Zt.add(p,a,p),p=h[5],Zt.add(n,u,p),Zt.add(p,l,p),p=h[6],Zt.add(n,c,p),Zt.add(p,l,p),p=h[7],Zt.add(n,c,p),Zt.add(p,a,p);for(var d=h.length,f=0;f<d;++f){var A=h[f];Zt.add(o,A,A);var g=i.cartesianToCartographic(A,pu);t.project(g,A)}var _=(o=(r=Oa.fromPoints(h,r)).center).x,m=o.y,y=o.z;return o.x=y,o.y=_,o.z=m,r},Oa.isOccluded=function(e,t){return qt.typeOf.object("sphere",e),qt.typeOf.object("occluder",t),!t.isBoundingSphereVisible(e)},Oa.equals=function(e,t){return e===t||jt(e)&&jt(t)&&Zt.equals(e.center,t.center)&&e.radius===t.radius},Oa.prototype.intersectPlane=function(e){return Oa.intersectPlane(this,e)},Oa.prototype.distanceSquaredTo=function(e){return Oa.distanceSquaredTo(this,e)},Oa.prototype.computePlaneDistances=function(e,t,r){return Oa.computePlaneDistances(this,e,t,r)},Oa.prototype.isOccluded=function(e){return Oa.isOccluded(this,e)},Oa.prototype.equals=function(e){return Oa.equals(this,e)},Oa.prototype.clone=function(e){return Oa.clone(this,e)},Oa.prototype.volume=function(){var e=this.radius;return qa*e*e*e},gu.fromPoints=function(e,t){if(jt(t)||(t=new gu),!jt(e)||0===e.length)return t.minimum=Zt.clone(Zt.ZERO,t.minimum),t.maximum=Zt.clone(Zt.ZERO,t.maximum),t.center=Zt.clone(Zt.ZERO,t.center),t;for(var r=e[0].x,n=e[0].y,i=e[0].z,o=e[0].x,s=e[0].y,a=e[0].z,u=e.length,c=1;c<u;c++){var l=e[c],h=l.x,p=l.y,d=l.z;r=Math.min(h,r),o=Math.max(h,o),n=Math.min(p,n),s=Math.max(p,s),i=Math.min(d,i),a=Math.max(d,a)}var f=t.minimum;f.x=r,f.y=n,f.z=i;var A=t.maximum;return A.x=o,A.y=s,A.z=a,t.center=Zt.midpoint(f,A,t.center),t},gu.clone=function(e,t){if(jt(e))return jt(t)?(t.minimum=Zt.clone(e.minimum,t.minimum),t.maximum=Zt.clone(e.maximum,t.maximum),t.center=Zt.clone(e.center,t.center),t):new gu(e.minimum,e.maximum,e.center)},gu.equals=function(e,t){return e===t||jt(e)&&jt(t)&&Zt.equals(e.center,t.center)&&Zt.equals(e.minimum,t.minimum)&&Zt.equals(e.maximum,t.maximum)};var _u=new Zt;gu.intersectPlane=function(e,t){qt.defined("box",e),qt.defined("plane",t),_u=Zt.subtract(e.maximum,e.minimum,_u);var r=Zt.multiplyByScalar(_u,.5,_u),n=t.normal,i=r.x*Math.abs(n.x)+r.y*Math.abs(n.y)+r.z*Math.abs(n.z),o=Zt.dot(e.center,n)+t.distance;return o-i>0?Ra.INSIDE:o+i<0?Ra.OUTSIDE:Ra.INTERSECTING},gu.prototype.clone=function(e){return gu.clone(this,e)},gu.prototype.intersectPlane=function(e){return gu.intersectPlane(this,e)},gu.prototype.equals=function(e){return gu.equals(this,e)};var mu={};function yu(e,t,r){var n=e+t;return Wt.sign(e)!==Wt.sign(t)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(t)))<r?0:n}mu.computeDiscriminant=function(e,t,r){if("number"!=typeof e)throw new Ht("a is a required number.");if("number"!=typeof t)throw new Ht("b is a required number.");if("number"!=typeof r)throw new Ht("c is a required number.");return t*t-4*e*r},mu.computeRealRoots=function(e,t,r){if("number"!=typeof e)throw new Ht("a is a required number.");if("number"!=typeof t)throw new Ht("b is a required number.");if("number"!=typeof r)throw new Ht("c is a required number.");var n;if(0===e)return 0===t?[]:[-r/t];if(0===t){if(0===r)return[0,0];var i=Math.abs(r),o=Math.abs(e);if(i<o&&i/o<Wt.EPSILON14)return[0,0];if(i>o&&o/i<Wt.EPSILON14)return[];if((n=-r/e)<0)return[];var s=Math.sqrt(n);return[-s,s]}if(0===r)return(n=-t/e)<0?[n,0]:[0,n];var a=yu(t*t,-(4*e*r),Wt.EPSILON14);if(a<0)return[];var u=-.5*yu(t,Wt.sign(t)*Math.sqrt(a),Wt.EPSILON14);return t>0?[u/e,r/u]:[r/u,u/e]};var Eu={};function xu(e,t,r,n){var i,o,s=e,a=t/3,u=r/3,c=n,l=s*u,h=a*c,p=a*a,d=u*u,f=s*u-p,A=s*c-a*u,g=a*c-d,_=4*f*g-A*A;if(_<0){var m,y,E;p*h>=l*d?(m=s,y=f,E=-2*a*f+s*A):(m=c,y=g,E=-c*A+2*u*g);var x=-(E<0?-1:1)*Math.abs(m)*Math.sqrt(-_),C=(o=-E+x)/2,b=C<0?-Math.pow(-C,1/3):Math.pow(C,1/3),I=o===x?-b:-y/b;return i=y<=0?b+I:-E/(b*b+I*I+y),p*h>=l*d?[(i-a)/s]:[-c/(i+u)]}var T=f,v=-2*a*f+s*A,R=g,M=-c*A+2*u*g,w=Math.sqrt(_),S=Math.sqrt(3)/2,B=Math.abs(Math.atan2(s*w,-v)/3);i=2*Math.sqrt(-T);var O=Math.cos(B);o=i*O;var D=i*(-O/2-S*Math.sin(B)),F=o+D>2*a?o-a:D-a,P=s,N=F/P;B=Math.abs(Math.atan2(c*w,-M)/3);var L=-c,U=(o=(i=2*Math.sqrt(-R))*(O=Math.cos(B)))+(D=i*(-O/2-S*Math.sin(B)))<2*u?o+u:D+u,G=L/U,Q=-F*U-P*L,k=(u*Q-a*(F*L))/(-a*Q+u*(P*U));return N<=k?N<=G?k<=G?[N,k,G]:[N,G,k]:[G,N,k]:N<=G?[k,N,G]:k<=G?[k,G,N]:[G,k,N]}Eu.computeDiscriminant=function(e,t,r,n){if("number"!=typeof e)throw new Ht("a is a required number.");if("number"!=typeof t)throw new Ht("b is a required number.");if("number"!=typeof r)throw new Ht("c is a required number.");if("number"!=typeof n)throw new Ht("d is a required number.");var i=t*t,o=r*r;return 18*e*t*r*n+i*o-27*(e*e)*(n*n)-4*(e*o*r+i*t*n)},Eu.computeRealRoots=function(e,t,r,n){if("number"!=typeof e)throw new Ht("a is a required number.");if("number"!=typeof t)throw new Ht("b is a required number.");if("number"!=typeof r)throw new Ht("c is a required number.");if("number"!=typeof n)throw new Ht("d is a required number.");var i,o;if(0===e)return mu.computeRealRoots(t,r,n);if(0===t){if(0===r){if(0===n)return[0,0,0];var s=(o=-n/e)<0?-Math.pow(-o,1/3):Math.pow(o,1/3);return[s,s,s]}return 0===n?0===(i=mu.computeRealRoots(e,0,r)).Length?[0]:[i[0],0,i[1]]:xu(e,0,r,n)}return 0===r?0===n?(o=-t/e)<0?[o,0,0]:[0,0,o]:xu(e,t,0,n):0===n?0===(i=mu.computeRealRoots(e,t,r)).length?[0]:i[1]<=0?[i[0],i[1],0]:i[0]>=0?[0,i[0],i[1]]:[i[0],0,i[1]]:xu(e,t,r,n)};var Cu={};function bu(e,t,r,n){var i=e*e,o=t-3*i/8,s=r-t*e/2+i*e/8,a=n-r*e/4+t*i/16-3*i*i/256,u=Eu.computeRealRoots(1,2*o,o*o-4*a,-s*s);if(u.length>0){var c=-e/4,l=u[u.length-1];if(Math.abs(l)<Wt.EPSILON14){var h=mu.computeRealRoots(1,o,a);if(2===h.length){var p,d=h[0],f=h[1];if(d>=0&&f>=0){var A=Math.sqrt(d),g=Math.sqrt(f);return[c-g,c-A,c+A,c+g]}if(d>=0&&f<0)return[c-(p=Math.sqrt(d)),c+p];if(d<0&&f>=0)return[c-(p=Math.sqrt(f)),c+p]}return[]}if(l>0){var _=Math.sqrt(l),m=(o+l-s/_)/2,y=(o+l+s/_)/2,E=mu.computeRealRoots(1,_,m),x=mu.computeRealRoots(1,-_,y);return 0!==E.length?(E[0]+=c,E[1]+=c,0!==x.length?(x[0]+=c,x[1]+=c,E[1]<=x[0]?[E[0],E[1],x[0],x[1]]:x[1]<=E[0]?[x[0],x[1],E[0],E[1]]:E[0]>=x[0]&&E[1]<=x[1]?[x[0],E[0],E[1],x[1]]:x[0]>=E[0]&&x[1]<=E[1]?[E[0],x[0],x[1],E[1]]:E[0]>x[0]&&E[0]<x[1]?[x[0],E[0],x[1],E[1]]:[E[0],x[0],E[1],x[1]]):E):0!==x.length?(x[0]+=c,x[1]+=c,x):[]}}return[]}function Iu(e,t,r,n){var i=e*e,o=-2*t,s=r*e+t*t-4*n,a=i*n-r*t*e+r*r,u=Eu.computeRealRoots(1,o,s,a);if(u.length>0){var c,l,h,p,d,f,A=u[0],g=t-A,_=g*g,m=e/2,y=g/2,E=_-4*n,x=_+4*Math.abs(n),C=i-4*A,b=i+4*Math.abs(A);if(A<0||E*b<C*x){var I=Math.sqrt(C);c=I/2,l=0===I?0:(e*y-r)/I}else{var T=Math.sqrt(E);c=0===T?0:(e*y-r)/T,l=T/2}0===m&&0===c?(h=0,p=0):Wt.sign(m)===Wt.sign(c)?p=A/(h=m+c):h=A/(p=m-c),0===y&&0===l?(d=0,f=0):Wt.sign(y)===Wt.sign(l)?f=n/(d=y+l):d=n/(f=y-l);var v=mu.computeRealRoots(1,h,d),R=mu.computeRealRoots(1,p,f);if(0!==v.length)return 0!==R.length?v[1]<=R[0]?[v[0],v[1],R[0],R[1]]:R[1]<=v[0]?[R[0],R[1],v[0],v[1]]:v[0]>=R[0]&&v[1]<=R[1]?[R[0],v[0],v[1],R[1]]:R[0]>=v[0]&&R[1]<=v[1]?[v[0],R[0],R[1],v[1]]:v[0]>R[0]&&v[0]<R[1]?[R[0],v[0],R[1],v[1]]:[v[0],R[0],v[1],R[1]]:v;if(0!==R.length)return R}return[]}function Tu(e,t){t=Zt.clone(Yt(t,Zt.ZERO)),Zt.equals(t,Zt.ZERO)||Zt.normalize(t,t),this.origin=Zt.clone(Yt(e,Zt.ZERO)),this.direction=t}Cu.computeDiscriminant=function(e,t,r,n,i){if("number"!=typeof e)throw new Ht("a is a required number.");if("number"!=typeof t)throw new Ht("b is a required number.");if("number"!=typeof r)throw new Ht("c is a required number.");if("number"!=typeof n)throw new Ht("d is a required number.");if("number"!=typeof i)throw new Ht("e is a required number.");var o=e*e,s=t*t,a=s*t,u=r*r,c=u*r,l=n*n,h=l*n,p=i*i;return s*u*l-4*a*h-4*e*c*l+18*e*t*r*h-27*o*l*l+256*(o*e)*(p*i)+i*(18*a*r*n-4*s*c+16*e*u*u-80*e*t*u*n-6*e*s*l+144*o*r*l)+p*(144*e*s*r-27*s*s-128*o*u-192*o*t*n)},Cu.computeRealRoots=function(e,t,r,n,i){if("number"!=typeof e)throw new Ht("a is a required number.");if("number"!=typeof t)throw new Ht("b is a required number.");if("number"!=typeof r)throw new Ht("c is a required number.");if("number"!=typeof n)throw new Ht("d is a required number.");if("number"!=typeof i)throw new Ht("e is a required number.");if(Math.abs(e)<Wt.EPSILON15)return Eu.computeRealRoots(t,r,n,i);var o=t/e,s=r/e,a=n/e,u=i/e,c=o<0?1:0;switch(c+=s<0?c+1:c,c+=a<0?c+1:c,c+=u<0?c+1:c){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return bu(o,s,a,u);case 1:case 2:case 5:case 8:case 11:return Iu(o,s,a,u);default:return}},Tu.clone=function(e,t){if(jt(e))return jt(t)?(t.origin=Zt.clone(e.origin),t.direction=Zt.clone(e.direction),t):new Tu(e.origin,e.direction)},Tu.getPoint=function(e,t,r){return qt.typeOf.object("ray",e),qt.typeOf.number("t",t),jt(r)||(r=new Zt),r=Zt.multiplyByScalar(e.direction,t,r),Zt.add(e.origin,r,r)},Tu.transform=function(e,t,r){return qt.typeOf.object("ray",e),qt.typeOf.object("matrix",t),qt.typeOf.object("result",r),yo.multiplyByPoint(t,e.origin,r.origin),yo.multiplyByPointAsVector(t,e.direction,r.direction),r};var vu={rayPlane:function(e,t,r){if(!jt(e))throw new Ht("ray is required.");if(!jt(t))throw new Ht("plane is required.");jt(r)||(r=new Zt);var n=e.origin,i=e.direction,o=t.normal,s=Zt.dot(o,i);if(!(Math.abs(s)<Wt.EPSILON15)){var a=(-t.distance-Zt.dot(o,n))/s;if(!(a<0))return r=Zt.multiplyByScalar(i,a,r),Zt.add(n,r,r)}}},Ru=new Zt,Mu=new Zt,wu=new Zt,Su=new Zt,Bu=new Zt;vu.rayTriangleParametric=function(e,t,r,n,i){if(!jt(e))throw new Ht("ray is required.");if(!jt(t))throw new Ht("p0 is required.");if(!jt(r))throw new Ht("p1 is required.");if(!jt(n))throw new Ht("p2 is required.");i=Yt(i,!1);var o,s,a,u,c,l=e.origin,h=e.direction,p=Zt.subtract(r,t,Ru),d=Zt.subtract(n,t,Mu),f=Zt.cross(h,d,wu),A=Zt.dot(p,f);if(i){if(A<Wt.EPSILON6)return;if(o=Zt.subtract(l,t,Su),(a=Zt.dot(o,f))<0||a>A)return;if(s=Zt.cross(o,p,Bu),(u=Zt.dot(h,s))<0||a+u>A)return;c=Zt.dot(d,s)/A}else{if(Math.abs(A)<Wt.EPSILON6)return;var g=1/A;if(o=Zt.subtract(l,t,Su),(a=Zt.dot(o,f)*g)<0||a>1)return;if(s=Zt.cross(o,p,Bu),(u=Zt.dot(h,s)*g)<0||a+u>1)return;c=Zt.dot(d,s)*g}return c},vu.rayTriangle=function(e,t,r,n,i,o){var s=vu.rayTriangleParametric(e,t,r,n,i);if(jt(s)&&!(s<0))return jt(o)||(o=new Zt),Zt.multiplyByScalar(e.direction,s,o),Zt.add(e.origin,o,o)};var Ou=new Tu;vu.lineSegmentTriangle=function(e,t,r,n,i,o,s){if(!jt(e))throw new Ht("v0 is required.");if(!jt(t))throw new Ht("v1 is required.");if(!jt(r))throw new Ht("p0 is required.");if(!jt(n))throw new Ht("p1 is required.");if(!jt(i))throw new Ht("p2 is required.");var a=Ou;Zt.clone(e,a.origin),Zt.subtract(t,e,a.direction),Zt.normalize(a.direction,a.direction);var u=vu.rayTriangleParametric(a,r,n,i,o);if(!(!jt(u)||u<0||u>Zt.distance(e,t)))return jt(s)||(s=new Zt),Zt.multiplyByScalar(a.direction,u,s),Zt.add(a.origin,s,s)};var Du={root0:0,root1:0};function Fu(e,t,r){jt(r)||(r=new Ma);var n=e.origin,i=e.direction,o=t.center,s=t.radius*t.radius,a=Zt.subtract(n,o,wu),u=function(e,t,r,n){var i=t*t-4*e*r;if(!(i<0)){if(i>0){var o=1/(2*e),s=Math.sqrt(i),a=(-t+s)*o,u=(-t-s)*o;return a<u?(n.root0=a,n.root1=u):(n.root0=u,n.root1=a),n}var c=-t/(2*e);if(0!==c)return n.root0=n.root1=c,n}}(Zt.dot(i,i),2*Zt.dot(i,a),Zt.magnitudeSquared(a)-s,Du);if(jt(u))return r.start=u.root0,r.stop=u.root1,r}vu.raySphere=function(e,t,r){if(!jt(e))throw new Ht("ray is required.");if(!jt(t))throw new Ht("sphere is required.");if(jt(r=Fu(e,t,r))&&!(r.stop<0))return r.start=Math.max(r.start,0),r};var Pu=new Tu;vu.lineSegmentSphere=function(e,t,r,n){if(!jt(e))throw new Ht("p0 is required.");if(!jt(t))throw new Ht("p1 is required.");if(!jt(r))throw new Ht("sphere is required.");var i=Pu;Zt.clone(e,i.origin);var o=Zt.subtract(t,e,i.direction),s=Zt.magnitude(o);if(Zt.normalize(o,o),!(!jt(n=Fu(i,r,n))||n.stop<0||n.start>s))return n.start=Math.max(n.start,0),n.stop=Math.min(n.stop,s),n};var Nu=new Zt,Lu=new Zt;function Uu(e,t,r){var n=e+t;return Wt.sign(e)!==Wt.sign(t)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(t)))<r?0:n}vu.rayEllipsoid=function(e,t){if(!jt(e))throw new Ht("ray is required.");if(!jt(t))throw new Ht("ellipsoid is required.");var r,n,i,o,s,a=t.oneOverRadii,u=Zt.multiplyComponents(a,e.origin,Nu),c=Zt.multiplyComponents(a,e.direction,Lu),l=Zt.magnitudeSquared(u),h=Zt.dot(u,c);if(l>1){if(h>=0)return;var p=h*h;if(r=l-1,p<(i=(n=Zt.magnitudeSquared(c))*r))return;if(p>i){o=h*h-i;var d=(s=-h+Math.sqrt(o))/n,f=r/s;return d<f?new Ma(d,f):{start:f,stop:d}}var A=Math.sqrt(r/n);return new Ma(A,A)}return l<1?(r=l-1,o=h*h-(i=(n=Zt.magnitudeSquared(c))*r),new Ma(0,(s=-h+Math.sqrt(o))/n)):h<0?new Ma(0,-h/(n=Zt.magnitudeSquared(c))):void 0};var Gu=new Zt,Qu=new Zt,ku=new Zt,zu=new Zt,ju=new Zt,Hu=new uo,qu=new uo,Vu=new uo,Yu=new uo,Xu=new uo,Wu=new uo,Ku=new uo,Ju=new Zt,Zu=new Zt,$u=new lr;vu.grazingAltitudeLocation=function(e,t){if(!jt(e))throw new Ht("ray is required.");if(!jt(t))throw new Ht("ellipsoid is required.");var r=e.origin,n=e.direction;if(!Zt.equals(r,Zt.ZERO)){var i=t.geodeticSurfaceNormal(r,Gu);if(Zt.dot(n,i)>=0)return r}var o=jt(this.rayEllipsoid(e,t)),s=t.transformPositionToScaledSpace(n,Gu),a=Zt.normalize(s,s),u=Zt.mostOrthogonalAxis(s,zu),c=Zt.normalize(Zt.cross(u,a,Qu),Qu),l=Zt.normalize(Zt.cross(a,c,ku),ku),h=Hu;h[0]=a.x,h[1]=a.y,h[2]=a.z,h[3]=c.x,h[4]=c.y,h[5]=c.z,h[6]=l.x,h[7]=l.y,h[8]=l.z;var p=uo.transpose(h,qu),d=uo.fromScale(t.radii,Vu),f=uo.fromScale(t.oneOverRadii,Yu),A=Xu;A[0]=0,A[1]=-n.z,A[2]=n.y,A[3]=n.z,A[4]=0,A[5]=-n.x,A[6]=-n.y,A[7]=n.x,A[8]=0;var g,_,m=uo.multiply(uo.multiply(p,f,Wu),A,Wu),y=uo.multiply(uo.multiply(m,d,Ku),h,Ku),E=uo.multiplyByVector(m,r,ju),x=function(e,t,r,n,i){var o,s=n*n,a=i*i,u=(e[uo.COLUMN1ROW1]-e[uo.COLUMN2ROW2])*a,c=i*(n*Uu(e[uo.COLUMN1ROW0],e[uo.COLUMN0ROW1],Wt.EPSILON15)+t.y),l=e[uo.COLUMN0ROW0]*s+e[uo.COLUMN2ROW2]*a+n*t.x+r,h=a*Uu(e[uo.COLUMN2ROW1],e[uo.COLUMN1ROW2],Wt.EPSILON15),p=i*(n*Uu(e[uo.COLUMN2ROW0],e[uo.COLUMN0ROW2])+t.z),d=[];if(0===p&&0===h){if(0===(o=mu.computeRealRoots(u,c,l)).length)return d;var f=o[0],A=Math.sqrt(Math.max(1-f*f,0));if(d.push(new Zt(n,i*f,i*-A)),d.push(new Zt(n,i*f,i*A)),2===o.length){var g=o[1],_=Math.sqrt(Math.max(1-g*g,0));d.push(new Zt(n,i*g,i*-_)),d.push(new Zt(n,i*g,i*_))}return d}var m=p*p,y=h*h,E=p*h,x=u*u+y,C=2*(c*u+E),b=2*l*u+c*c-y+m,I=2*(l*c-E),T=l*l-m;if(0===x&&0===C&&0===b&&0===I)return d;var v=(o=Cu.computeRealRoots(x,C,b,I,T)).length;if(0===v)return d;for(var R=0;R<v;++R){var M=o[R],w=M*M,S=Math.max(1-w,0),B=Math.sqrt(S),O=(Wt.sign(u)===Wt.sign(l)?Uu(u*w+l,c*M,Wt.EPSILON12):Wt.sign(l)===Wt.sign(c*M)?Uu(u*w,c*M+l,Wt.EPSILON12):Uu(u*w+c*M,l,Wt.EPSILON12))*Uu(h*M,p,Wt.EPSILON15);O<0?d.push(new Zt(n,i*M,i*B)):O>0?d.push(new Zt(n,i*M,i*-B)):0!==B?(d.push(new Zt(n,i*M,i*-B)),d.push(new Zt(n,i*M,i*B)),++R):d.push(new Zt(n,i*M,i*B))}return d}(y,Zt.negate(E,Gu),0,0,1),C=x.length;if(C>0){for(var b=Zt.clone(Zt.ZERO,Zu),I=Number.NEGATIVE_INFINITY,T=0;T<C;++T){g=uo.multiplyByVector(d,uo.multiplyByVector(h,x[T],Ju),Ju);var v=Zt.normalize(Zt.subtract(g,r,zu),zu),R=Zt.dot(v,n);R>I&&(I=R,b=Zt.clone(g,b))}var M=t.cartesianToCartographic(b,$u);return I=Wt.clamp(I,0,1),_=Zt.magnitude(Zt.subtract(b,r,zu))*Math.sqrt(1-I*I),_=o?-_:_,M.height=_,t.cartographicToCartesian(M,new Zt)}};var ec=new Zt;function tc(e,t){if(qt.typeOf.object("normal",e),!Wt.equalsEpsilon(Zt.magnitude(e),1,Wt.EPSILON6))throw new Ht("normal must be normalized.");qt.typeOf.number("distance",t),this.normal=Zt.clone(e),this.distance=t}vu.lineSegmentPlane=function(e,t,r,n){if(!jt(e))throw new Ht("endPoint0 is required.");if(!jt(t))throw new Ht("endPoint1 is required.");if(!jt(r))throw new Ht("plane is required.");jt(n)||(n=new Zt);var i=Zt.subtract(t,e,ec),o=r.normal,s=Zt.dot(o,i);if(!(Math.abs(s)<Wt.EPSILON6)){var a=Zt.dot(o,e),u=-(r.distance+a)/s;if(!(u<0||u>1))return Zt.multiplyByScalar(i,u,n),Zt.add(e,n,n),n}},vu.trianglePlaneIntersection=function(e,t,r,n){if(!(jt(e)&&jt(t)&&jt(r)&&jt(n)))throw new Ht("p0, p1, p2, and plane are required.");var i,o,s=n.normal,a=n.distance,u=Zt.dot(s,e)+a<0,c=Zt.dot(s,t)+a<0,l=Zt.dot(s,r)+a<0,h=0;if(h+=u?1:0,h+=c?1:0,1!==(h+=l?1:0)&&2!==h||(i=new Zt,o=new Zt),1===h){if(u)return vu.lineSegmentPlane(e,t,n,i),vu.lineSegmentPlane(e,r,n,o),{positions:[e,t,r,i,o],indices:[0,3,4,1,2,4,1,4,3]};if(c)return vu.lineSegmentPlane(t,r,n,i),vu.lineSegmentPlane(t,e,n,o),{positions:[e,t,r,i,o],indices:[1,3,4,2,0,4,2,4,3]};if(l)return vu.lineSegmentPlane(r,e,n,i),vu.lineSegmentPlane(r,t,n,o),{positions:[e,t,r,i,o],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===h){if(!u)return vu.lineSegmentPlane(t,e,n,i),vu.lineSegmentPlane(r,e,n,o),{positions:[e,t,r,i,o],indices:[1,2,4,1,4,3,0,3,4]};if(!c)return vu.lineSegmentPlane(r,t,n,i),vu.lineSegmentPlane(e,t,n,o),{positions:[e,t,r,i,o],indices:[2,0,4,2,4,3,1,3,4]};if(!l)return vu.lineSegmentPlane(e,r,n,i),vu.lineSegmentPlane(t,r,n,o),{positions:[e,t,r,i,o],indices:[0,1,4,0,4,3,2,3,4]}}},tc.fromPointNormal=function(e,t,r){if(qt.typeOf.object("point",e),qt.typeOf.object("normal",t),!Wt.equalsEpsilon(Zt.magnitude(t),1,Wt.EPSILON6))throw new Ht("normal must be normalized.");var n=-Zt.dot(t,e);return jt(r)?(Zt.clone(t,r.normal),r.distance=n,r):new tc(t,n)};var rc=new Zt;tc.fromCartesian4=function(e,t){qt.typeOf.object("coefficients",e);var r=Zt.fromCartesian4(e,rc),n=e.w;if(!Wt.equalsEpsilon(Zt.magnitude(r),1,Wt.EPSILON6))throw new Ht("normal must be normalized.");return jt(t)?(Zt.clone(r,t.normal),t.distance=n,t):new tc(r,n)},tc.getPointDistance=function(e,t){return qt.typeOf.object("plane",e),qt.typeOf.object("point",t),Zt.dot(e.normal,t)+e.distance};var nc=new Zt;tc.projectPointOntoPlane=function(e,t,r){qt.typeOf.object("plane",e),qt.typeOf.object("point",t),jt(r)||(r=new Zt);var n=tc.getPointDistance(e,t),i=Zt.multiplyByScalar(e.normal,n,nc);return Zt.subtract(t,i,r)};var ic=new Zt;tc.transform=function(e,t,r){return qt.typeOf.object("plane",e),qt.typeOf.object("transform",t),yo.multiplyByPointAsVector(t,e.normal,rc),Zt.normalize(rc,rc),Zt.multiplyByScalar(e.normal,-e.distance,ic),yo.multiplyByPoint(t,ic,ic),tc.fromPointNormal(ic,rc,r)},tc.clone=function(e,t){return qt.typeOf.object("plane",e),jt(t)?(Zt.clone(e.normal,t.normal),t.distance=e.distance,t):new tc(e.normal,e.distance)},tc.equals=function(e,t){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),e.distance===t.distance&&Zt.equals(e.normal,t.normal)},tc.ORIGIN_XY_PLANE=Object.freeze(new tc(Zt.UNIT_Z,0)),tc.ORIGIN_YZ_PLANE=Object.freeze(new tc(Zt.UNIT_X,0)),tc.ORIGIN_ZX_PLANE=Object.freeze(new tc(Zt.UNIT_Y,0));var oc=new br;function sc(e,t){if(qt.defined("origin",e),!jt(e=(t=Yt(t,Qi.WGS84)).scaleToGeodeticSurface(e)))throw new Ht("origin must not be at the center of the ellipsoid.");var r=ks.eastNorthUpToFixedFrame(e,t);this._ellipsoid=t,this._origin=e,this._xAxis=Zt.fromCartesian4(yo.getColumn(r,0,oc)),this._yAxis=Zt.fromCartesian4(yo.getColumn(r,1,oc));var n=Zt.fromCartesian4(yo.getColumn(r,2,oc));this._plane=tc.fromPointNormal(e,n)}Object.defineProperties(sc.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}});var ac=new gu;sc.fromPoints=function(e,t){return qt.defined("cartesians",e),new sc(gu.fromPoints(e,ac).center,t)};var uc=new Tu,cc=new Zt;sc.prototype.projectPointOntoPlane=function(e,t){qt.defined("cartesian",e);var r=uc;r.origin=e,Zt.normalize(e,r.direction);var n=vu.rayPlane(r,this._plane,cc);if(jt(n)||(Zt.negate(r.direction,r.direction),n=vu.rayPlane(r,this._plane,cc)),jt(n)){var i=Zt.subtract(n,this._origin,n),o=Zt.dot(this._xAxis,i),s=Zt.dot(this._yAxis,i);return jt(t)?(t.x=o,t.y=s,t):new _r(o,s)}},sc.prototype.projectPointsOntoPlane=function(e,t){qt.defined("cartesians",e),jt(t)||(t=[]);for(var r=0,n=e.length,i=0;i<n;i++){var o=this.projectPointOntoPlane(e[i],t[r]);jt(o)&&(t[r]=o,r++)}return t.length=r,t},sc.prototype.projectPointToNearestOnPlane=function(e,t){qt.defined("cartesian",e),jt(t)||(t=new _r);var r=uc;r.origin=e,Zt.clone(this._plane.normal,r.direction);var n=vu.rayPlane(r,this._plane,cc);jt(n)||(Zt.negate(r.direction,r.direction),n=vu.rayPlane(r,this._plane,cc));var i=Zt.subtract(n,this._origin,n),o=Zt.dot(this._xAxis,i),s=Zt.dot(this._yAxis,i);return t.x=o,t.y=s,t},sc.prototype.projectPointsToNearestOnPlane=function(e,t){qt.defined("cartesians",e),jt(t)||(t=[]);var r=e.length;t.length=r;for(var n=0;n<r;n++)t[n]=this.projectPointToNearestOnPlane(e[n],t[n]);return t};var lc=new Zt;function hc(e,t,r=2){const n=t&&t.length,i=n?t[0]*r:e.length;let o=pc(e,0,i,r,!0);const s=[];if(!o||o.next===o.prev)return s;let a,u,c;if(n&&(o=function(e,t,r,n){const i=[];for(let r=0,o=t.length;r<o;r++){const s=pc(e,t[r]*n,r<o-1?t[r+1]*n:e.length,n,!1);s===s.next&&(s.steiner=!0),i.push(bc(s))}i.sort(yc);for(let e=0;e<i.length;e++)r=Ec(i[e],r);return r}(e,t,o,r)),e.length>80*r){a=1/0,u=1/0;let t=-1/0,n=-1/0;for(let o=r;o<i;o+=r){const r=e[o],i=e[o+1];r<a&&(a=r),i<u&&(u=i),r>t&&(t=r),i>n&&(n=i)}c=Math.max(t-a,n-u),c=0!==c?32767/c:0}return fc(o,s,r,a,u,c,0),s}function pc(e,t,r,n,i){let o;if(i===function(e,t,r,n){let i=0;for(let o=t,s=r-n;o<r;o+=n)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}(e,t,r,n)>0)for(let i=t;i<r;i+=n)o=Fc(i/n|0,e[i],e[i+1],o);else for(let i=r-n;i>=t;i-=n)o=Fc(i/n|0,e[i],e[i+1],o);return o&&Mc(o,o.next)&&(Pc(o),o=o.next),o}function dc(e,t){if(!e)return e;t||(t=e);let r,n=e;do{if(r=!1,n.steiner||!Mc(n,n.next)&&0!==Rc(n.prev,n,n.next))n=n.next;else{if(Pc(n),n=t=n.prev,n===n.next)break;r=!0}}while(r||n!==t);return t}function fc(e,t,r,n,i,o,s){if(!e)return;!s&&o&&function(e,t,r,n){let i=e;do{0===i.z&&(i.z=Cc(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,r=1;do{let n,i=e;e=null;let o=null;for(t=0;i;){t++;let s=i,a=0;for(let e=0;e<r&&(a++,s=s.nextZ,s);e++);let u=r;for(;a>0||u>0&&s;)0!==a&&(0===u||!s||i.z<=s.z)?(n=i,i=i.nextZ,a--):(n=s,s=s.nextZ,u--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=s}o.nextZ=null,r*=2}while(t>1)}(i)}(e,n,i,o);let a=e;for(;e.prev!==e.next;){const u=e.prev,c=e.next;if(o?gc(e,n,i,o):Ac(e))t.push(u.i,e.i,c.i),Pc(e),e=c.next,a=c.next;else if((e=c)===a){s?1===s?fc(e=_c(dc(e),t),t,r,n,i,o,2):2===s&&mc(e,t,r,n,i,o):fc(dc(e),t,r,n,i,o,1);break}}}function Ac(e){const t=e.prev,r=e,n=e.next;if(Rc(t,r,n)>=0)return!1;const i=t.x,o=r.x,s=n.x,a=t.y,u=r.y,c=n.y,l=Math.min(i,o,s),h=Math.min(a,u,c),p=Math.max(i,o,s),d=Math.max(a,u,c);let f=n.next;for(;f!==t;){if(f.x>=l&&f.x<=p&&f.y>=h&&f.y<=d&&Tc(i,a,o,u,s,c,f.x,f.y)&&Rc(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function gc(e,t,r,n){const i=e.prev,o=e,s=e.next;if(Rc(i,o,s)>=0)return!1;const a=i.x,u=o.x,c=s.x,l=i.y,h=o.y,p=s.y,d=Math.min(a,u,c),f=Math.min(l,h,p),A=Math.max(a,u,c),g=Math.max(l,h,p),_=Cc(d,f,t,r,n),m=Cc(A,g,t,r,n);let y=e.prevZ,E=e.nextZ;for(;y&&y.z>=_&&E&&E.z<=m;){if(y.x>=d&&y.x<=A&&y.y>=f&&y.y<=g&&y!==i&&y!==s&&Tc(a,l,u,h,c,p,y.x,y.y)&&Rc(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,E.x>=d&&E.x<=A&&E.y>=f&&E.y<=g&&E!==i&&E!==s&&Tc(a,l,u,h,c,p,E.x,E.y)&&Rc(E.prev,E,E.next)>=0)return!1;E=E.nextZ}for(;y&&y.z>=_;){if(y.x>=d&&y.x<=A&&y.y>=f&&y.y<=g&&y!==i&&y!==s&&Tc(a,l,u,h,c,p,y.x,y.y)&&Rc(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;E&&E.z<=m;){if(E.x>=d&&E.x<=A&&E.y>=f&&E.y<=g&&E!==i&&E!==s&&Tc(a,l,u,h,c,p,E.x,E.y)&&Rc(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function _c(e,t){let r=e;do{const n=r.prev,i=r.next.next;!Mc(n,i)&&wc(n,r,r.next,i)&&Oc(n,i)&&Oc(i,n)&&(t.push(n.i,r.i,i.i),Pc(r),Pc(r.next),r=e=i),r=r.next}while(r!==e);return dc(r)}function mc(e,t,r,n,i,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&vc(s,e)){let a=Dc(s,e);return s=dc(s,s.next),a=dc(a,a.next),fc(s,t,r,n,i,o,0),void fc(a,t,r,n,i,o,0)}e=e.next}s=s.next}while(s!==e)}function yc(e,t){let r=e.x-t.x;if(0===r&&(r=e.y-t.y,0===r)){r=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)}return r}function Ec(e,t){const r=function(e,t){let r=t;const n=e.x,i=e.y;let o,s=-1/0;if(Mc(e,r))return r;do{if(Mc(e,r.next))return r.next;if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){const e=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=n&&e>s&&(s=e,o=r.x<r.next.x?r:r.next,e===n))return o}r=r.next}while(r!==t);if(!o)return null;const a=o,u=o.x,c=o.y;let l=1/0;r=o;do{if(n>=r.x&&r.x>=u&&n!==r.x&&Ic(i<c?n:s,i,u,c,i<c?s:n,i,r.x,r.y)){const t=Math.abs(i-r.y)/(n-r.x);Oc(r,e)&&(t<l||t===l&&(r.x>o.x||r.x===o.x&&xc(o,r)))&&(o=r,l=t)}r=r.next}while(r!==a);return o}(e,t);if(!r)return t;const n=Dc(r,e);return dc(n,n.next),dc(r,r.next)}function xc(e,t){return Rc(e.prev,e,t.prev)<0&&Rc(t.next,e,e.next)<0}function Cc(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function bc(e){let t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function Ic(e,t,r,n,i,o,s,a){return(i-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(n-a)>=(r-s)*(t-a)&&(r-s)*(o-a)>=(i-s)*(n-a)}function Tc(e,t,r,n,i,o,s,a){return!(e===s&&t===a)&&Ic(e,t,r,n,i,o,s,a)}function vc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&wc(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(Oc(e,t)&&Oc(t,e)&&function(e,t){let r=e,n=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(Rc(e.prev,e,t.prev)||Rc(e,t.prev,t))||Mc(e,t)&&Rc(e.prev,e,e.next)>0&&Rc(t.prev,t,t.next)>0)}function Rc(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Mc(e,t){return e.x===t.x&&e.y===t.y}function wc(e,t,r,n){const i=Bc(Rc(e,t,r)),o=Bc(Rc(e,t,n)),s=Bc(Rc(r,n,e)),a=Bc(Rc(r,n,t));return i!==o&&s!==a||(!(0!==i||!Sc(e,r,t))||(!(0!==o||!Sc(e,n,t))||(!(0!==s||!Sc(r,e,n))||!(0!==a||!Sc(r,t,n)))))}function Sc(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Bc(e){return e>0?1:e<0?-1:0}function Oc(e,t){return Rc(e.prev,e,e.next)<0?Rc(e,t,e.next)>=0&&Rc(e,e.prev,t)>=0:Rc(e,t,e.prev)<0||Rc(e,e.next,t)<0}function Dc(e,t){const r=Nc(e.i,e.x,e.y),n=Nc(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function Fc(e,t,r,n){const i=Nc(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Pc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Nc(e,t,r){return{i:e,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}sc.prototype.projectPointOntoEllipsoid=function(e,t){qt.defined("cartesian",e),jt(t)||(t=new Zt);var r=this._ellipsoid,n=this._origin,i=this._xAxis,o=this._yAxis,s=lc;return Zt.multiplyByScalar(i,e.x,s),t=Zt.add(n,s,t),Zt.multiplyByScalar(o,e.y,s),Zt.add(t,s,t),r.scaleToGeocentricSurface(t,t),t},sc.prototype.projectPointsOntoEllipsoid=function(e,t){qt.defined("cartesians",e);var r=e.length;jt(t)?t.length=r:t=new Array(r);for(var n=0;n<r;++n)t[n]=this.projectPointOntoEllipsoid(e[n],t[n]);return t};var Lc=Object.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_WEBGL:37808,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_BPTC_UNORM:36492,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047}),Uc={BYTE:Lc.BYTE,UNSIGNED_BYTE:Lc.UNSIGNED_BYTE,SHORT:Lc.SHORT,UNSIGNED_SHORT:Lc.UNSIGNED_SHORT,INT:Lc.INT,UNSIGNED_INT:Lc.UNSIGNED_INT,FLOAT:Lc.FLOAT,DOUBLE:Lc.DOUBLE,getSizeInBytes:function(e){if(!jt(e))throw new Ht("value is required.");switch(e){case Uc.BYTE:return Int8Array.BYTES_PER_ELEMENT;case Uc.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Uc.SHORT:return Int16Array.BYTES_PER_ELEMENT;case Uc.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Uc.INT:return Int32Array.BYTES_PER_ELEMENT;case Uc.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Uc.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case Uc.DOUBLE:return Float64Array.BYTES_PER_ELEMENT;default:throw new Ht("componentDatatype is not a valid value.")}},fromTypedArray:function(e){return e instanceof Int8Array?Uc.BYTE:e instanceof Uint8Array?Uc.UNSIGNED_BYTE:e instanceof Int16Array?Uc.SHORT:e instanceof Uint16Array?Uc.UNSIGNED_SHORT:e instanceof Int32Array?Uc.INT:e instanceof Uint32Array?Uc.UNSIGNED_INT:e instanceof Float32Array?Uc.FLOAT:e instanceof Float64Array?Uc.DOUBLE:void 0},validate:function(e){return jt(e)&&(e===Uc.BYTE||e===Uc.UNSIGNED_BYTE||e===Uc.SHORT||e===Uc.UNSIGNED_SHORT||e===Uc.INT||e===Uc.UNSIGNED_INT||e===Uc.FLOAT||e===Uc.DOUBLE)},createTypedArray:function(e,t){if(!jt(e))throw new Ht("componentDatatype is required.");if(!jt(t))throw new Ht("valuesOrLength is required.");switch(e){case Uc.BYTE:return new Int8Array(t);case Uc.UNSIGNED_BYTE:return new Uint8Array(t);case Uc.SHORT:return new Int16Array(t);case Uc.UNSIGNED_SHORT:return new Uint16Array(t);case Uc.INT:return new Int32Array(t);case Uc.UNSIGNED_INT:return new Uint32Array(t);case Uc.FLOAT:return new Float32Array(t);case Uc.DOUBLE:return new Float64Array(t);default:throw new Ht("componentDatatype is not a valid value.")}},createArrayBufferView:function(e,t,r,n){if(!jt(e))throw new Ht("componentDatatype is required.");if(!jt(t))throw new Ht("buffer is required.");switch(r=Yt(r,0),n=Yt(n,(t.byteLength-r)/Uc.getSizeInBytes(e)),e){case Uc.BYTE:return new Int8Array(t,r,n);case Uc.UNSIGNED_BYTE:return new Uint8Array(t,r,n);case Uc.SHORT:return new Int16Array(t,r,n);case Uc.UNSIGNED_SHORT:return new Uint16Array(t,r,n);case Uc.INT:return new Int32Array(t,r,n);case Uc.UNSIGNED_INT:return new Uint32Array(t,r,n);case Uc.FLOAT:return new Float32Array(t,r,n);case Uc.DOUBLE:return new Float64Array(t,r,n);default:throw new Ht("componentDatatype is not a valid value.")}},fromName:function(e){switch(e){case"BYTE":return Uc.BYTE;case"UNSIGNED_BYTE":return Uc.UNSIGNED_BYTE;case"SHORT":return Uc.SHORT;case"UNSIGNED_SHORT":return Uc.UNSIGNED_SHORT;case"INT":return Uc.INT;case"UNSIGNED_INT":return Uc.UNSIGNED_INT;case"FLOAT":return Uc.FLOAT;case"DOUBLE":return Uc.DOUBLE;default:throw new Ht("name is not a valid value.")}}},Gc=Object.freeze(Uc);function Qc(e,t,r){if(0===e)return t*r;var n=e*e,i=n*n,o=i*n,s=o*n,a=s*n,u=a*n,c=r;return t*((1-n/4-3*i/64-5*o/256-175*s/16384-441*a/65536-4851*u/1048576)*c-(3*n/8+3*i/32+45*o/1024+105*s/4096+2205*a/131072+6237*u/524288)*Math.sin(2*c)+(15*i/256+45*o/1024+525*s/16384+1575*a/65536+155925*u/8388608)*Math.sin(4*c)-(35*o/3072+175*s/12288+3675*a/262144+13475*u/1048576)*Math.sin(6*c)+(315*s/131072+2205*a/524288+43659*u/8388608)*Math.sin(8*c)-(693*a/1310720+6237*u/5242880)*Math.sin(10*c)+1001*u/8388608*Math.sin(12*c))}function kc(e,t){if(0===e)return Math.log(Math.tan(.5*(Wt.PI_OVER_TWO+t)));var r=e*Math.sin(t);return Math.log(Math.tan(.5*(Wt.PI_OVER_TWO+t)))-e/2*Math.log((1+r)/(1-r))}var zc=new Zt,jc=new Zt;function Hc(e,t,r,n){var i=Zt.normalize(n.cartographicToCartesian(t,jc),zc),o=Zt.normalize(n.cartographicToCartesian(r,jc),jc);qt.typeOf.number.greaterThanOrEquals("value",Math.abs(Math.abs(Zt.angleBetween(i,o))-Math.PI),.0125);var s=n.maximumRadius,a=n.minimumRadius,u=s*s,c=a*a;e._ellipticitySquared=(u-c)/u,e._ellipticity=Math.sqrt(e._ellipticitySquared),e._start=lr.clone(t,e._start),e._start.height=0,e._end=lr.clone(r,e._end),e._end.height=0,e._heading=function(e,t,r,n,i){var o=kc(e._ellipticity,r),s=kc(e._ellipticity,i);return Math.atan2(Wt.negativePiToPi(n-t),s-o)}(e,t.longitude,t.latitude,r.longitude,r.latitude),e._distance=function(e,t,r,n,i,o,s){var a=e._heading,u=o-n,c=0;if(Wt.equalsEpsilon(Math.abs(a),Wt.PI_OVER_TWO,Wt.EPSILON8))if(t===r)c=t*Math.cos(i)*Wt.negativePiToPi(u);else{var l=Math.sin(i);c=t*Math.cos(i)*Wt.negativePiToPi(u)/Math.sqrt(1-e._ellipticitySquared*l*l)}else{var h=Qc(e._ellipticity,t,i);c=(Qc(e._ellipticity,t,s)-h)/Math.cos(a)}return Math.abs(c)}(e,n.maximumRadius,n.minimumRadius,t.longitude,t.latitude,r.longitude,r.latitude)}function qc(e,t,r,n,i,o){var s,a,u,c=i*i;if(Math.abs(Wt.PI_OVER_TWO-Math.abs(t))>Wt.EPSILON8){a=function(e,t,r){var n=e/r;if(0===t)return n;var i=n*n,o=i*n,s=o*n,a=t*t,u=a*a,c=u*a,l=c*a,h=l*a,p=h*a,d=Math.sin(2*n),f=Math.cos(2*n),A=Math.sin(4*n),g=Math.cos(4*n),_=Math.sin(6*n),m=Math.cos(6*n),y=Math.sin(8*n),E=Math.cos(8*n),x=Math.sin(10*n);return n+n*a/4+7*n*u/64+15*n*c/256+579*n*l/16384+1515*n*h/65536+16837*n*p/1048576+(3*n*u/16+45*n*c/256-n*(32*i-561)*l/4096-n*(232*i-1677)*h/16384+n*(399985-90560*i+512*s)*p/5242880)*f+(21*n*c/256+483*n*l/4096-n*(224*i-1969)*h/16384-n*(33152*i-112599)*p/1048576)*g+(151*n*l/4096+4681*n*h/65536+1479*n*p/16384-453*o*p/32768)*m+(1097*n*h/65536+42783*n*p/1048576)*E+8011*n*p/1048576*Math.cos(10*n)+(3*a/8+3*u/16+213*c/2048-3*i*c/64+255*l/4096-33*i*l/512+20861*h/524288-33*i*h/512+s*h/1024+28273*p/1048576-471*i*p/8192+9*s*p/4096)*d+(21*u/256+21*c/256+533*l/8192-21*i*l/512+197*h/4096-315*i*h/4096+584039*p/16777216-12517*i*p/131072+7*s*p/2048)*A+(151*c/6144+151*l/4096+5019*h/131072-453*i*h/16384+26965*p/786432-8607*i*p/131072)*_+(1097*l/131072+1097*h/65536+225797*p/10485760-1097*i*p/65536)*y+(8011*h/2621440+8011*p/1048576)*x+293393*p/251658240*Math.sin(12*n)}(Qc(i,n,e.latitude)+r*Math.cos(t),i,n);var l=kc(i,e.latitude),h=kc(i,a);u=Math.tan(t)*(h-l),s=Wt.negativePiToPi(e.longitude+u)}else{var p;if(a=e.latitude,0===i)p=n*Math.cos(e.latitude);else{var d=Math.sin(e.latitude);p=n*Math.cos(e.latitude)/Math.sqrt(1-c*d*d)}u=r/p,s=t>0?Wt.negativePiToPi(e.longitude+u):Wt.negativePiToPi(e.longitude-u)}return jt(o)?(o.longitude=s,o.latitude=a,o.height=0,o):new lr(s,a,0)}function Vc(e,t,r){var n=Yt(r,Qi.WGS84);this._ellipsoid=n,this._start=new lr,this._end=new lr,this._heading=void 0,this._distance=void 0,this._ellipticity=void 0,this._ellipticitySquared=void 0,jt(e)&&jt(t)&&Hc(this,e,t,n)}Object.defineProperties(Vc.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return qt.defined("distance",this._distance),this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},heading:{get:function(){return qt.defined("distance",this._distance),this._heading}}}),Vc.fromStartHeadingDistance=function(e,t,r,n,i){qt.defined("start",e),qt.defined("heading",t),qt.defined("distance",r),qt.typeOf.number.greaterThan("distance",r,0);var o=Yt(n,Qi.WGS84),s=o.maximumRadius,a=o.minimumRadius,u=s*s,c=a*a,l=Math.sqrt((u-c)/u),h=qc(e,t=Wt.negativePiToPi(t),r,o.maximumRadius,l);return!jt(i)||jt(n)&&!n.equals(i.ellipsoid)?new Vc(e,h,o):(i.setEndPoints(e,h),i)},Vc.prototype.setEndPoints=function(e,t){qt.defined("start",e),qt.defined("end",t),Hc(this,e,t,this._ellipsoid)},Vc.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(e*this._distance,t)},Vc.prototype.interpolateUsingSurfaceDistance=function(e,t){if(qt.typeOf.number("distance",e),!jt(this._distance)||0===this._distance)throw new Ht("EllipsoidRhumbLine must have distinct start and end set.");return qc(this._start,this._heading,e,this._ellipsoid.maximumRadius,this._ellipticity,t)},Vc.prototype.findIntersectionWithLongitude=function(e,t){if(qt.typeOf.number("intersectionLongitude",e),!jt(this._distance)||0===this._distance)throw new Ht("EllipsoidRhumbLine must have distinct start and end set.");var r=this._ellipticity,n=this._heading,i=Math.abs(n),o=this._start;if(e=Wt.negativePiToPi(e),Wt.equalsEpsilon(Math.abs(e),Math.PI,Wt.EPSILON14)&&(e=Wt.sign(o.longitude)*Math.PI),jt(t)||(t=new lr),Math.abs(Wt.PI_OVER_TWO-i)<=Wt.EPSILON8)return t.longitude=e,t.latitude=o.latitude,t.height=0,t;if(Wt.equalsEpsilon(Math.abs(Wt.PI_OVER_TWO-i),Wt.PI_OVER_TWO,Wt.EPSILON8)){if(Wt.equalsEpsilon(e,o.longitude,Wt.EPSILON12))return;return t.longitude=e,t.latitude=Wt.PI_OVER_TWO*Wt.sign(Wt.PI_OVER_TWO-n),t.height=0,t}var s,a=o.latitude,u=r*Math.sin(a),c=Math.tan(.5*(Wt.PI_OVER_TWO+a))*Math.exp((e-o.longitude)/Math.tan(n)),l=(1+u)/(1-u),h=o.latitude;do{s=h;var p=r*Math.sin(s),d=(1+p)/(1-p);h=2*Math.atan(c*Math.pow(d/l,r/2))-Wt.PI_OVER_TWO}while(!Wt.equalsEpsilon(h,s,Wt.EPSILON12));return t.longitude=e,t.latitude=h,t.height=0,t},Vc.prototype.findIntersectionWithLatitude=function(e,t){if(qt.typeOf.number("intersectionLatitude",e),!jt(this._distance)||0===this._distance)throw new Ht("EllipsoidRhumbLine must have distinct start and end set.");var r=this._ellipticity,n=this._heading,i=this._start;if(!Wt.equalsEpsilon(Math.abs(n),Wt.PI_OVER_TWO,Wt.EPSILON8)){var o=kc(r,i.latitude),s=kc(r,e),a=Math.tan(n)*(s-o),u=Wt.negativePiToPi(i.longitude+a);return jt(t)?(t.longitude=u,t.latitude=e,t.height=0,t):new lr(u,e,0)}};function Yc(e,t,r,n){this[0]=Yt(e,0),this[1]=Yt(r,0),this[2]=Yt(t,0),this[3]=Yt(n,0)}Object.freeze({NONE:0,TRIANGLES:1,LINES:2,POLYLINES:3}),Yc.packedLength=4,Yc.pack=function(e,t,r){return qt.typeOf.object("value",e),qt.defined("array",t),r=Yt(r,0),t[r++]=e[0],t[r++]=e[1],t[r++]=e[2],t[r++]=e[3],t},Yc.unpack=function(e,t,r){return qt.defined("array",e),t=Yt(t,0),jt(r)||(r=new Yc),r[0]=e[t++],r[1]=e[t++],r[2]=e[t++],r[3]=e[t++],r},Yc.clone=function(e,t){if(jt(e))return jt(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):new Yc(e[0],e[2],e[1],e[3])},Yc.fromArray=function(e,t,r){return qt.defined("array",e),t=Yt(t,0),jt(r)||(r=new Yc),r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],r},Yc.fromColumnMajorArray=function(e,t){return qt.defined("values",e),Yc.clone(e,t)},Yc.fromRowMajorArray=function(e,t){return qt.defined("values",e),jt(t)?(t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3],t):new Yc(e[0],e[1],e[2],e[3])},Yc.fromScale=function(e,t){return qt.typeOf.object("scale",e),jt(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=e.y,t):new Yc(e.x,0,0,e.y)},Yc.fromUniformScale=function(e,t){return qt.typeOf.number("scale",e),jt(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=e,t):new Yc(e,0,0,e)},Yc.fromRotation=function(e,t){qt.typeOf.number("angle",e);var r=Math.cos(e),n=Math.sin(e);return jt(t)?(t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t):new Yc(r,-n,n,r)},Yc.toArray=function(e,t){return qt.typeOf.object("matrix",e),jt(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):[e[0],e[1],e[2],e[3]]},Yc.getElementIndex=function(e,t){return qt.typeOf.number.greaterThanOrEquals("row",t,0),qt.typeOf.number.lessThanOrEquals("row",t,1),qt.typeOf.number.greaterThanOrEquals("column",e,0),qt.typeOf.number.lessThanOrEquals("column",e,1),2*e+t},Yc.getColumn=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.number.greaterThanOrEquals("index",t,0),qt.typeOf.number.lessThanOrEquals("index",t,1),qt.typeOf.object("result",r);var n=2*t,i=e[n],o=e[n+1];return r.x=i,r.y=o,r},Yc.setColumn=function(e,t,r,n){qt.typeOf.object("matrix",e),qt.typeOf.number.greaterThanOrEquals("index",t,0),qt.typeOf.number.lessThanOrEquals("index",t,1),qt.typeOf.object("cartesian",r),qt.typeOf.object("result",n);var i=2*t;return(n=Yc.clone(e,n))[i]=r.x,n[i+1]=r.y,n},Yc.getRow=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.number.greaterThanOrEquals("index",t,0),qt.typeOf.number.lessThanOrEquals("index",t,1),qt.typeOf.object("result",r);var n=e[t],i=e[t+2];return r.x=n,r.y=i,r},Yc.setRow=function(e,t,r,n){return qt.typeOf.object("matrix",e),qt.typeOf.number.greaterThanOrEquals("index",t,0),qt.typeOf.number.lessThanOrEquals("index",t,1),qt.typeOf.object("cartesian",r),qt.typeOf.object("result",n),(n=Yc.clone(e,n))[t]=r.x,n[t+2]=r.y,n};var Xc=new _r;Yc.getScale=function(e,t){return qt.typeOf.object("matrix",e),qt.typeOf.object("result",t),t.x=_r.magnitude(_r.fromElements(e[0],e[1],Xc)),t.y=_r.magnitude(_r.fromElements(e[2],e[3],Xc)),t};var Wc=new _r;Yc.getMaximumScale=function(e){return Yc.getScale(e,Wc),_r.maximumComponent(Wc)},Yc.multiply=function(e,t,r){qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r);var n=e[0]*t[0]+e[2]*t[1],i=e[0]*t[2]+e[2]*t[3],o=e[1]*t[0]+e[3]*t[1],s=e[1]*t[2]+e[3]*t[3];return r[0]=n,r[1]=o,r[2]=i,r[3]=s,r},Yc.add=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r},Yc.subtract=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r},Yc.multiplyByVector=function(e,t,r){qt.typeOf.object("matrix",e),qt.typeOf.object("cartesian",t),qt.typeOf.object("result",r);var n=e[0]*t.x+e[2]*t.y,i=e[1]*t.x+e[3]*t.y;return r.x=n,r.y=i,r},Yc.multiplyByScalar=function(e,t,r){return qt.typeOf.object("matrix",e),qt.typeOf.number("scalar",t),qt.typeOf.object("result",r),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r},Yc.multiplyByScale=function(e,t,r){return qt.typeOf.object("matrix",e),qt.typeOf.object("scale",t),qt.typeOf.object("result",r),r[0]=e[0]*t.x,r[1]=e[1]*t.x,r[2]=e[2]*t.y,r[3]=e[3]*t.y,r},Yc.negate=function(e,t){return qt.typeOf.object("matrix",e),qt.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Yc.transpose=function(e,t){qt.typeOf.object("matrix",e),qt.typeOf.object("result",t);var r=e[0],n=e[2],i=e[1],o=e[3];return t[0]=r,t[1]=n,t[2]=i,t[3]=o,t},Yc.abs=function(e,t){return qt.typeOf.object("matrix",e),qt.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t},Yc.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Yc.equalsArray=function(e,t,r){return e[0]===t[r]&&e[1]===t[r+1]&&e[2]===t[r+2]&&e[3]===t[r+3]},Yc.equalsEpsilon=function(e,t,r){return qt.typeOf.number("epsilon",r),e===t||jt(e)&&jt(t)&&Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r},Yc.IDENTITY=Object.freeze(new Yc(1,0,0,1)),Yc.ZERO=Object.freeze(new Yc(0,0,0,0)),Yc.COLUMN0ROW0=0,Yc.COLUMN0ROW1=1,Yc.COLUMN1ROW0=2,Yc.COLUMN1ROW1=3,Object.defineProperties(Yc.prototype,{length:{get:function(){return Yc.packedLength}}}),Yc.prototype.clone=function(e){return Yc.clone(this,e)},Yc.prototype.equals=function(e){return Yc.equals(this,e)},Yc.prototype.equalsEpsilon=function(e,t){return Yc.equalsEpsilon(this,e,t)},Yc.prototype.toString=function(){return"("+this[0]+", "+this[2]+")\n("+this[1]+", "+this[3]+")"};var Kc={POINTS:Lc.POINTS,LINES:Lc.LINES,LINE_LOOP:Lc.LINE_LOOP,LINE_STRIP:Lc.LINE_STRIP,TRIANGLES:Lc.TRIANGLES,TRIANGLE_STRIP:Lc.TRIANGLE_STRIP,TRIANGLE_FAN:Lc.TRIANGLE_FAN,isLines:function(e){return e===Kc.LINES||e===Kc.LINE_LOOP||e===Kc.LINE_STRIP},isTriangles:function(e){return e===Kc.TRIANGLES||e===Kc.TRIANGLE_STRIP||e===Kc.TRIANGLE_FAN},validate:function(e){return e===Kc.POINTS||e===Kc.LINES||e===Kc.LINE_LOOP||e===Kc.LINE_STRIP||e===Kc.TRIANGLES||e===Kc.TRIANGLE_STRIP||e===Kc.TRIANGLE_FAN}},Jc=Object.freeze(Kc);new lr,new Zt,new yo,new lr,new lr,new lr,new _r,new _r,new _r,new _r,new _r,new _r,new Zt,new ls,new yo,new Yc;var Zc={CLOCKWISE:Lc.CW,COUNTER_CLOCKWISE:Lc.CCW,NONE:Lc.NONE,validate:function(e){return e===Zc.CLOCKWISE||e===Zc.COUNTER_CLOCKWISE}},$c=Object.freeze(Zc);new Zt,new Zt,new Zt,new Zt,new Zt,new Zt,new Zt,new Zt,new Zt,new lr,new lr,new lr,new lr,Zt.packedLength,uo.packedLength,new Zt,new Zt,new Zt,new Zt,new Zt,new Zt,new uo,new uo,new uo,new Zt,new Zt,new Zt,new Zt,new Zt,new lr,new Zt,new lr,new lr,new lr,new lr,new lr,new Zt,new Zt,new Zt,new Zt,new Zt,new _r,new _r,new _r,new _r,new _r,new Zt,new Zt,new Zt,new Zt,new _r,new Zt,new Zt,new Zt,new tc(Zt.UNIT_X,0),new Zt,new Zt,new Zt,new Zt,new Zt,new Zt,new Zt,new Oa,new br;var el=[];el.push(new _r),el.push(new _r),el.push(new _r),el.push(new _r),el.push(new _r),el.push(new _r),new lr,new Zt,new Zt,new Zt,new Zt;const tl=Math.PI/180,rl=180/Math.PI;function nl(e){return e*tl}function il(e){return e*rl}function ol(e,t,r){return Math.min(r,Math.max(t,e))}function sl(e,t,r){const n=r-t,i=((e-t)%n+n)%n+t;return i===t?r:i}function al(e){const t=[];for(const r in e)t.push(e[r]);return t}function ul(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}let cl=1;function ll(e,t){return-1!==e.indexOf(t,e.length-t.length)}function hl(e,t,r){const n={};for(const i in e)n[i]=t.call(r||this,e[i],i,e);return n}function pl(e){return Array.isArray(e)?e.map(pl):"object"==typeof e&&e?hl(e,pl):e}const dl={};function fl(e){dl[e]||("undefined"!=typeof console&&console.warn(e),dl[e]=!0)}function Al(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function gl(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}let _l=new lr;function ml(e,t,r,n,i){_l=function(e,t,r,n){const i=va-r,o=1<<n.z,s=(t/va+n.x)/o,a=(i/va+n.y)/o;let u=e.toLngLat(s,a);return _l=lr.fromDegrees(u.lng,u.lat,0,_l),_l}(e,t,r,n),i&&(_l.height=i(_l));var o=lr.toCartesian(_l);return e.sceneMode!=Ta.COLUMBUS_VIEW&&e.sceneMode!=Ta.SCENE2D||(o=ks.convertToColumbusCartesian(o)),o}let yl;function El(e,t,r){if(!window.caches)return;const n={status:t.status,statusText:t.statusText,headers:new window.Headers};t.headers.forEach(((e,t)=>n.headers.set(t,e)));const i=function(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,r,n,i)=>{const o=n||i;return t[r]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}(t.headers.get("Cache-Control")||"");if(i["no-store"])return;i["max-age"]&&n.headers.set("Expires",new Date(r+1e3*i["max-age"]).toUTCString());new Date(n.headers.get("Expires")).getTime()-r<42e4||function(e,t){if(void 0===yl)try{new Response(new ReadableStream),yl=!0}catch(e){yl=!1}yl?t(e.body):e.blob().then(t)}(t,(t=>{const r=new window.Response(t,n);window.caches.open("mapbox-tiles").then((t=>t.put(function(e){const t=e.indexOf("?");return t<0?e:e.slice(0,t)}(e.url),r)))}))}const xl={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(xl);class Cl extends Error{constructor(e,t,r){super(e),this.status=t,this.url=r,this.name=this.constructor.name,this.message=e}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const bl=gl()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href;function Il(e,t){const r=gl()?self:window,n=new r.AbortController,i=new r.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:bl(),signal:n.signal});let o=!1,s=!1;"json"===e.type&&i.headers.set("Accept","application/json");const a=(r,n,a)=>{("arrayBuffer"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text()).then((e=>{s||(n&&a&&El(i,n,a),o=!0,t(null,e,r.headers.get("Cache-Control"),r.headers.get("Expires")))})).catch((e=>t(new Error(e.message))))};return((n,o,u)=>{if(s)return;if(n&&"SecurityError"!==n.message&&fl(n),o&&u)return a(o);const c=Date.now();r.fetch(i).then((r=>r.ok?a(r,null,c):t(new Cl(r.statusText,r.status,e.url)))).catch((e=>{20!==e.code&&t(new Error(e.message))}))})(null,null),{cancel:()=>{s=!0,o||n.abort()}}}const Tl=function(e,t){const r=gl()?self:window;if(n=e.url,!(/^file:/.test(n)||/^file:/.test(bl())&&!/^\w+:/.test(n))){if(r.fetch&&r.Request&&r.AbortController&&r.Request.prototype.hasOwnProperty("signal"))return Il(e,t);if(gl()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t)}var n;return function(e,t){const r=new((gl()?self:window).XMLHttpRequest);r.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(r.responseType="arraybuffer");for(const t in e.headers)r.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===e.credentials,r.onerror=()=>{t(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let n=r.response;if("json"===e.type)try{n=JSON.parse(r.response)}catch(e){return t(e)}t(null,n,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else t(new Cl(r.statusText,r.status,e.url))},r.send(e.body),{cancel:()=>r.abort()}}(e,t)},vl=function(e,t){return Tl(ul(e,{type:"arrayBuffer"}),t)},Rl={};function Ml(e,t,r={}){Rl[t],Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Rl[t]={klass:e,omit:r.omit||[]}}Ml(Object,"Object"),e.serialize=function(e,t){const r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},e.deserialize=function(t){return new e(t.buffer)},Object.defineProperty(e,"name",{value:"Grid"}),Ml(e,"Grid"),Ml(a,"Color"),Ml(Error,"Error"),Ml(Cl,"AJAXError"),Ml(N,"ResolvedImage"),Ml(Qt,"StylePropertyFunction"),Ml(Ft,"StyleExpression",{omit:["_evaluator"]}),Ml(Ut,"ZoomDependentExpression"),Ml(Lt,"ZoomConstantExpression"),Ml($,"CompoundExpression",{omit:["_evaluate"]});for(const e in gt)Rl[gt[e]._classRegistryKey]||Ml(gt[e],`Expression${e}`);function wl(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Sl(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(wl(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const r=e;return t&&t.push(r.buffer),r}if(e instanceof ImageData)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const r=[];for(const n of e)r.push(Sl(n,t));return r}if("object"==typeof e){const r=e.constructor,n=r._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);Rl[n];const i=r.serialize?r.serialize(e,t):{};if(r.serialize)t&&t[t.length-1];else{for(const r in e){if(!e.hasOwnProperty(r))continue;if(Rl[n].omit.indexOf(r)>=0)continue;const o=e[r];i[r]=Sl(o,t)}e instanceof Error&&(i.message=e.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(i.$name=n),i}throw new Error("can't serialize object of type "+typeof e)}function Bl(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||wl(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(Bl);if("object"==typeof e){const t=e.$name||"Object",{klass:r}=Rl[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(e);const n=Object.create(r.prototype);for(const t of Object.keys(e)){if("$name"===t)continue;const r=e[t];n[t]=Bl(r)}return n}throw new Error("can't deserialize object of type "+typeof e)}function Ol(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}function Dl(e,t,r){var n;this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},n=this,["receive","process"].forEach((function(e){n[e]&&(n[e]=n[e].bind(n))})),this.invoker=new Ol(this.process),this.target.addEventListener("message",this.receive,!1)}function Fl(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function Pl(e,t,r){if(r&&r[e]){var n=r[e].indexOf(t);-1!==n&&r[e].splice(n,1)}}Ol.prototype.trigger=function(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))},Dl.prototype.send=function(e,t,r,n){const i=++Dl.taskId;r&&(this.callbacks[i]=r);const o=[];return this.target.postMessage({id:i,type:e,hasCallback:!!r,targetMapId:n,sourceMapId:this.mapId,data:Sl(t,o)},o),{cancel:()=>{r&&delete this.callbacks[i],this.target.postMessage({id:i,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}},Dl.prototype.receive=function(e){const t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){delete this.tasks[r];const e=this.cancelCallbacks[r];delete this.cancelCallbacks[r],e&&e()}else this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()},Dl.prototype.process=function(){if(!this.taskQueue.length)return;const e=this.taskQueue.shift(),t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t)if("<response>"===t.type){const r=this.callbacks[e];delete this.callbacks[e],r&&(t.error?r(Bl(t.error)):r(null,Bl(t.data)))}else{let r=!1;const n=t.hasCallback?(t,n)=>{r=!0,delete this.cancelCallbacks[e];const i=[];this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Sl(t):null,data:Sl(n,i)},i)}:e=>{r=!0};let i=null;const o=Bl(t.data);if(this.parent[t.type])i=this.parent[t.type](t.sourceMapId,o,n);else if(this.parent.getWorkerSource){const e=t.type.split(".");i=this.parent.getWorkerSource(t.sourceMapId,e[0],o.source)[e[1]](o,n)}else n(new Error(`Could not find function ${t.type}`));!r&&i&&i.cancel&&(this.cancelCallbacks[e]=i.cancel)}},Dl.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)},Dl.taskId=0;var Nl=function(e,t){void 0===t&&(t={}),ul(this,t),this.type=e},Ll=function(e){function t(t,r){void 0===r&&(r={}),e.call(this,"error",ul({error:t},r))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Nl),Ul=function(){};Ul.prototype.on=function(e,t){return this._listeners=this._listeners||{},Fl(e,t,this._listeners),this},Ul.prototype.off=function(e,t){return Pl(e,t,this._listeners),Pl(e,t,this._oneTimeListeners),this},Ul.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},Fl(e,t,this._oneTimeListeners),this},Ul.prototype.fire=function(e,t){"string"==typeof e&&(e=new Nl(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var n=0,i=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];n<i.length;n+=1){i[n].call(this,e)}for(var o=0,s=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];o<s.length;o+=1){var a=s[o];Pl(r,a,this._oneTimeListeners),a.call(this,e)}var u=this._eventedParent;u&&(ul(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(e))}else e instanceof Ll&&console.error(e.error);return this},Ul.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Ul.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var Gl=function(){this.first=!0};Gl.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var Ql=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Gl,this.transition={})};Ql.prototype.isSupportedScript=function(e){return!1},Ql.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ql.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};class kl{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(vt(e))return new Qt(e,t);if(Pt(e)){const r=Gt(e,t);if("error"===r.result)throw new Error(r.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return r.value}{let r=e;return"string"==typeof e&&"color"===t.type&&(r=a.parse(e)),{kind:"constant",evaluate:()=>r}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)}}class zl{constructor(e){this.property=e,this.value=new kl(e,void 0)}transitioned(e,t){return new Hl(this.property,this.value,t,ul({},e.transition,this.transition),e.now)}untransitioned(){return new Hl(this.property,this.value,null,{},0)}}class jl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return pl(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new zl(this._values[e].property)),this._values[e].value=new kl(this._values[e].property,null===t?void 0:pl(t))}getTransition(e){return pl(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new zl(this._values[e].property)),this._values[e].transition=pl(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r);const n=this.getTransition(t);void 0!==n&&(e[`${t}-transition`]=n)}return e}transitioned(e,t){const r=new ql(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].transitioned(e,t._values[n]);return r}untransitioned(){const e=new ql(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Hl{constructor(e,t,r,n,i){const o=n.delay||0,s=n.duration||0;i=i||0,this.property=e,this.value=t,this.begin=i+o,this.end=this.begin+s,e.specification.transition&&(n.delay||n.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){const n=e.now||0,i=this.value.possiblyEvaluate(e,t,r),o=this.prior;if(o){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return o.possiblyEvaluate(e,t,r);{const s=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,r),i,function(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}(s))}}return i}}class ql{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){const n=new Xl(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Vl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return pl(this._values[e].value)}setValue(e,t){this._values[e]=new kl(this._values[e].property,null===t?void 0:pl(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r)}return e}possiblyEvaluate(e,t,r){const n=new Xl(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}}class Yl{constructor(e,t,r){this.property=e,this.value=t,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,r,n){return this.property.evaluate(this.value,this.parameters,e,t,r,n)}}class Xl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Wl{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,r){const n=Se[this.specification.type];return n?n(e,t,r):e}}class Kl{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,n){return"constant"===e.expression.kind||"camera"===e.expression.kind?new Yl(this,{kind:"constant",value:e.expression.evaluate(t,null,{},r,n)},t):new Yl(this,e.expression,t)}interpolate(e,t,r){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Yl(this,{kind:"constant",value:void 0},e.parameters);const n=Se[this.specification.type];return n?new Yl(this,{kind:"constant",value:n(e.value.value,t.value.value,r)},e.parameters):e}evaluate(e,t,r,n,i,o){return"constant"===e.kind?e.value:e.evaluate(t,r,n,i,o)}}class Jl{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,n){return!!e.expression.evaluate(t,null,{},r,n)}interpolate(){return!1}}class Zl{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new Ql(0,{});for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const i=this.defaultPropertyValues[r]=new kl(n,void 0),o=this.defaultTransitionablePropertyValues[r]=new zl(n);this.defaultTransitioningPropertyValues[r]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=i.possiblyEvaluate(t)}}}function $l(e,t){return 256*(e=ol(Math.floor(e),0,255))+(t=ol(Math.floor(t),0,255))}Ml(Kl,"DataDrivenProperty"),Ml(Wl,"DataConstantProperty"),Ml(Jl,"ColorRampProperty");const eh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class th{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class rh{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return this.isTransferred,e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.isTransferred,this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function nh(e,t=1){let r=0,n=0;return{members:e.map((e=>{!e.name||e.name.length;const i=(o=e.type,eh[o].BYTES_PER_ELEMENT);var o;const s=r=ih(r,Math.max(t,i)),a=e.components||1;return n=Math.max(n,i),r+=i*a,{name:e.name,type:e.type,components:a,offset:s}})),size:ih(r,Math.max(n,t)),alignment:t}}function ih(e,t){return Math.ceil(e/t)*t}class oh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.int16[n+0]=t,this.int16[n+1]=r,e}}oh.prototype.bytesPerElement=4,Ml(oh,"StructArrayLayout2i4");class sh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.int16[i+0]=t,this.int16[i+1]=r,this.int16[i+2]=n,e}}sh.prototype.bytesPerElement=6,Ml(sh,"StructArrayLayout3i6");class ah extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=r,this.int16[o+2]=n,this.int16[o+3]=i,e}}ah.prototype.bytesPerElement=8,Ml(ah,"StructArrayLayout4i8");class uh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,o,s)}emplace(e,t,r,n,i,o,s,a){const u=6*e,c=12*e,l=3*e;return this.int16[u+0]=t,this.int16[u+1]=r,this.uint8[c+4]=n,this.uint8[c+5]=i,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[l+2]=a,e}}uh.prototype.bytesPerElement=12,Ml(uh,"StructArrayLayout2i4ub1f12");class ch extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=r,this.float32[o+2]=n,this.float32[o+3]=i,e}}ch.prototype.bytesPerElement=16,Ml(ch,"StructArrayLayout4f16");class lh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i)}emplace(e,t,r,n,i,o){const s=6*e,a=3*e;return this.uint16[s+0]=t,this.uint16[s+1]=r,this.uint16[s+2]=n,this.uint16[s+3]=i,this.float32[a+2]=o,e}}lh.prototype.bytesPerElement=12,Ml(lh,"StructArrayLayout4ui1f12");class hh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const o=4*e;return this.uint16[o+0]=t,this.uint16[o+1]=r,this.uint16[o+2]=n,this.uint16[o+3]=i,e}}hh.prototype.bytesPerElement=8,Ml(hh,"StructArrayLayout4ui8");class ph extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,r,n,i,o,s,a)}emplace(e,t,r,n,i,o,s,a,u){const c=14*e,l=7*e;return this.int16[c+0]=t,this.int16[c+1]=r,this.float32[l+1]=n,this.float32[l+2]=i,this.float32[l+3]=o,this.float32[l+4]=s,this.float32[l+5]=a,this.float32[l+6]=u,e}}ph.prototype.bytesPerElement=28,Ml(ph,"StructArrayLayout2i6f28");class dh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,o)}emplace(e,t,r,n,i,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=n,this.int16[a+3]=i,this.int16[a+4]=o,this.int16[a+5]=s,e}}dh.prototype.bytesPerElement=12,Ml(dh,"StructArrayLayout6i12");class fh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,s,a,u,c,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,r,n,i,o,s,a,u,c,l,h)}emplace(e,t,r,n,i,o,s,a,u,c,l,h,p){const d=12*e;return this.int16[d+0]=t,this.int16[d+1]=r,this.int16[d+2]=n,this.int16[d+3]=i,this.uint16[d+4]=o,this.uint16[d+5]=s,this.uint16[d+6]=a,this.uint16[d+7]=u,this.int16[d+8]=c,this.int16[d+9]=l,this.int16[d+10]=h,this.int16[d+11]=p,e}}fh.prototype.bytesPerElement=24,Ml(fh,"StructArrayLayout4i4ui4i24");class Ah extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g,_){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g,_)}emplace(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g,_,m){const y=24*e,E=12*e;return this.int16[y+0]=t,this.int16[y+1]=r,this.int16[y+2]=n,this.int16[y+3]=i,this.uint16[y+4]=o,this.uint16[y+5]=s,this.uint16[y+6]=a,this.uint16[y+7]=u,this.int16[y+8]=c,this.int16[y+9]=l,this.int16[y+10]=h,this.int16[y+11]=p,this.float32[E+6]=d,this.float32[E+7]=f,this.float32[E+8]=A,this.float32[E+9]=g,this.float32[E+10]=_,this.float32[E+11]=m,e}}Ah.prototype.bytesPerElement=48,Ml(Ah,"StructArrayLayout4i4ui4i6f48");class gh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,o)}emplace(e,t,r,n,i,o,s){const a=10*e,u=5*e;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=n,this.float32[u+2]=i,this.float32[u+3]=o,this.float32[u+4]=s,e}}gh.prototype.bytesPerElement=20,Ml(gh,"StructArrayLayout3i3f20");class _h extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){const r=1*e;return this.uint32[r+0]=t,e}}_h.prototype.bytesPerElement=4,Ml(_h,"StructArrayLayout1ul4");class mh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A)}emplace(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g){const _=26*e,m=13*e;return this.int16[_+0]=t,this.int16[_+1]=r,this.int16[_+2]=n,this.int16[_+3]=i,this.int16[_+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=u,this.float32[m+6]=c,this.int16[_+14]=l,this.uint32[m+8]=h,this.uint16[_+18]=p,this.uint16[_+19]=d,this.float32[m+10]=f,this.float32[m+11]=A,this.float32[m+12]=g,e}}mh.prototype.bytesPerElement=52,Ml(mh,"StructArrayLayout5i4f1i1ul2ui3f52");class yh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,o,s)}emplace(e,t,r,n,i,o,s,a){const u=8*e;return this.int16[u+0]=t,this.int16[u+1]=r,this.int16[u+2]=n,this.int16[u+4]=i,this.int16[u+5]=o,this.int16[u+6]=s,this.int16[u+7]=a,e}}yh.prototype.bytesPerElement=16,Ml(yh,"StructArrayLayout3i2i2i16");class Eh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i)}emplace(e,t,r,n,i,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=r,this.float32[s+2]=n,this.int16[a+6]=i,this.int16[a+7]=o,e}}Eh.prototype.bytesPerElement=16,Ml(Eh,"StructArrayLayout2f1f2i16");class xh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const o=12*e,s=3*e;return this.uint8[o+0]=t,this.uint8[o+1]=r,this.float32[s+1]=n,this.float32[s+2]=i,e}}xh.prototype.bytesPerElement=12,Ml(xh,"StructArrayLayout2ub2f12");class Ch extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.float32[i+0]=t,this.float32[i+1]=r,this.float32[i+2]=n,e}}Ch.prototype.bytesPerElement=12,Ml(Ch,"StructArrayLayout3f12");class bh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=r,this.uint16[i+2]=n,e}get(e){const t=3*e;return[this.uint16[t+0],this.uint16[t+1],this.uint16[t+2]]}}bh.prototype.bytesPerElement=6,Ml(bh,"StructArrayLayout3ui6");class Ih extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.uint32[i+0]=t,this.uint32[i+1]=r,this.uint32[i+2]=n,e}copyFrom3ui6(e){if(!(e instanceof bh))throw new Error("expect array to be type of StructArrayLayout3ui6");this.clear();for(let t=0;t<e.length;t++){let r=e.get(t);this.emplaceBack(r[0],r[1],r[2])}}}Ih.prototype.bytesPerElement=12,Ml(Ih,"StructArrayLayout3ul12");class Th extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g,_,m,y,E){const x=this.length;return this.resize(x+1),this.emplace(x,e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g,_,m,y,E)}emplace(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g,_,m,y,E,x){const C=30*e,b=15*e,I=60*e;return this.int16[C+0]=t,this.int16[C+1]=r,this.int16[C+2]=n,this.float32[b+2]=i,this.float32[b+3]=o,this.uint16[C+8]=s,this.uint16[C+9]=a,this.uint32[b+5]=u,this.uint32[b+6]=c,this.uint32[b+7]=l,this.uint16[C+16]=h,this.uint16[C+17]=p,this.uint16[C+18]=d,this.float32[b+10]=f,this.float32[b+11]=A,this.uint8[I+48]=g,this.uint8[I+49]=_,this.uint8[I+50]=m,this.uint32[b+13]=y,this.int16[C+28]=E,this.uint8[I+58]=x,e}}Th.prototype.bytesPerElement=60,Ml(Th,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class vh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g,_,m,y,E,x,C,b,I,T,v,R,M,w){const S=this.length;return this.resize(S+1),this.emplace(S,e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g,_,m,y,E,x,C,b,I,T,v,R,M,w)}emplace(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g,_,m,y,E,x,C,b,I,T,v,R,M,w,S){const B=38*e,O=19*e;return this.int16[B+0]=t,this.int16[B+1]=r,this.int16[B+2]=n,this.float32[O+2]=i,this.float32[O+3]=o,this.int16[B+8]=s,this.int16[B+9]=a,this.int16[B+10]=u,this.int16[B+11]=c,this.int16[B+12]=l,this.int16[B+13]=h,this.uint16[B+14]=p,this.uint16[B+15]=d,this.uint16[B+16]=f,this.uint16[B+17]=A,this.uint16[B+18]=g,this.uint16[B+19]=_,this.uint16[B+20]=m,this.uint16[B+21]=y,this.uint16[B+22]=E,this.uint16[B+23]=x,this.uint16[B+24]=C,this.uint16[B+25]=b,this.uint16[B+26]=I,this.uint16[B+27]=T,this.uint16[B+28]=v,this.uint32[O+15]=R,this.float32[O+16]=M,this.float32[O+17]=w,this.float32[O+18]=S,e}}vh.prototype.bytesPerElement=76,Ml(vh,"StructArrayLayout3i2f6i15ui1ul3f76");class Rh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){const r=1*e;return this.float32[r+0]=t,e}}Rh.prototype.bytesPerElement=4,Ml(Rh,"StructArrayLayout1f4");class Mh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i)}emplace(e,t,r,n,i,o){const s=5*e;return this.float32[s+0]=t,this.float32[s+1]=r,this.float32[s+2]=n,this.float32[s+3]=i,this.float32[s+4]=o,e}}Mh.prototype.bytesPerElement=20,Ml(Mh,"StructArrayLayout5f20");class wh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,o)}emplace(e,t,r,n,i,o,s){const a=6*e;return this.float32[a+0]=t,this.float32[a+1]=r,this.float32[a+2]=n,this.float32[a+3]=i,this.float32[a+4]=o,this.float32[a+5]=s,e}}wh.prototype.bytesPerElement=24,Ml(wh,"StructArrayLayout6f24");class Sh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,s,a,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,r,n,i,o,s,a,u)}emplace(e,t,r,n,i,o,s,a,u,c){const l=9*e;return this.float32[l+0]=t,this.float32[l+1]=r,this.float32[l+2]=n,this.float32[l+3]=i,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,this.float32[l+7]=u,this.float32[l+8]=c,e}}Sh.prototype.bytesPerElement=36,Ml(Sh,"StructArrayLayout9f36");class Bh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,s,a,u,c){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,r,n,i,o,s,a,u,c)}emplace(e,t,r,n,i,o,s,a,u,c,l){const h=10*e;return this.float32[h+0]=t,this.float32[h+1]=r,this.float32[h+2]=n,this.float32[h+3]=i,this.float32[h+4]=o,this.float32[h+5]=s,this.float32[h+6]=a,this.float32[h+7]=u,this.float32[h+8]=c,this.float32[h+9]=l,e}}Bh.prototype.bytesPerElement=40,Ml(Bh,"StructArrayLayout10f40");class Oh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const o=3*e,s=6*e;return this.uint32[o+0]=t,this.uint16[s+2]=r,this.uint16[s+3]=n,this.uint16[s+4]=i,e}}Oh.prototype.bytesPerElement=12,Ml(Oh,"StructArrayLayout1ul3ui12");class Dh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.uint16[n+0]=t,this.uint16[n+1]=r,e}get(e){const t=2*e;return[this.uint16[t+0],this.uint16[t+1]]}}Dh.prototype.bytesPerElement=4,Ml(Dh,"StructArrayLayout2ui4");class Fh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.uint32[n+0]=t,this.uint32[n+1]=r,e}copyFrom2ui4(e){if(!(e instanceof Dh))throw new Error("expect array to be type of StructArrayLayout2ui4");this.clear();for(let t=0;t<e.length;t++){let r=e.get(t);this.emplaceBack(r[0],r[1])}}}Fh.prototype.bytesPerElement=8,Ml(Fh,"StructArrayLayout2ul8");class Ph extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){const r=1*e;return this.uint16[r+0]=t,e}}Ph.prototype.bytesPerElement=2,Ml(Ph,"StructArrayLayout1ui2");class Nh extends rh{constructor(){super()}_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.float32[n+0]=t,this.float32[n+1]=r,e}}Nh.prototype.bytesPerElement=8,Ml(Nh,"StructArrayLayout2f8");class Lh extends th{constructor(e,t){super(e,t)}get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}get ecefX(){return this._structArray.float32[this._pos4+10]}get ecefY(){return this._structArray.float32[this._pos4+11]}get ecefZ(){return this._structArray.float32[this._pos4+12]}}Lh.prototype.size=52;class Uh extends mh{constructor(){super()}get(e){return new Lh(this,e)}}Ml(Uh,"CollisionBoxArray");class Gh extends th{constructor(e,t){super(e,t)}get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Gh.prototype.size=60;class Qh extends Th{constructor(){super()}get(e){return new Gh(this,e)}}Ml(Qh,"PlacedSymbolArray");class kh extends th{constructor(e,t){super(e,t)}get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}kh.prototype.size=76;class zh extends vh{constructor(){super()}get(e){return new kh(this,e)}}Ml(zh,"SymbolInstanceArray");class jh extends Rh{constructor(){super()}getoffsetX(e){return this.float32[1*e+0]}}Ml(jh,"GlyphOffsetArray");class Hh extends oh{constructor(){super()}getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ml(Hh,"SymbolLineVertexArray");class qh extends th{constructor(e,t){super(e,t)}get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}qh.prototype.size=12;class Vh extends Oh{constructor(){super()}get(e){return new qh(this,e)}}Ml(Vh,"FeatureIndexArray");class Yh extends Dh{constructor(){super()}geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ml(Yh,"FillExtrusionCentroidArray");class Xh extends th{constructor(e,t){super(e,t)}get lng(){return this._structArray.float32[this._pos4]}get lat(){return this._structArray.float32[this._pos4+1]}get height(){return this._structArray.float32[this._pos4+2]}get quads(){return this._structArray.float32[this._pos4+3]}set height(e){this._structArray.float32[this._pos4+2]=e}}Xh.prototype.size=16;class Wh extends ch{constructor(){super()}get(e){return new Xh(this,e)}}Ml(Wh,"LngLatHeightQuadArray");const Kh=nh([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Jh=nh([{name:"a_dash",components:4,type:"Uint16"}]);var Zh=function(){this.ids=[],this.positions=[],this.indexed=!1};function $h(e,t,r,n){if(!(r>=n)){for(var i=e[r+n>>1],o=r-1,s=n+1;;){do{o++}while(e[o]<i);do{s--}while(e[s]>i);if(o>=s)break;ep(e,o,s),ep(t,3*o,3*s),ep(t,3*o+1,3*s+1),ep(t,3*o+2,3*s+2)}$h(e,t,r,s),$h(e,t,s+1,n)}}function ep(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}Zh.prototype.add=function(e,t,r,n){this.ids.push(e),this.positions.push(t,r,n)},Zh.prototype.getPositions=function(e){for(var t=0,r=this.ids.length-1;t<r;){var n=t+r>>1;this.ids[n]>=e?r=n:t=n+1}for(var i=[];this.ids[t]===e;){var o=this.positions[3*t],s=this.positions[3*t+1],a=this.positions[3*t+2];i.push({index:o,start:s,end:a}),t++}return i},Zh.serialize=function(e,t){var r=new Float64Array(e.ids),n=new Uint32Array(e.positions);return $h(r,n,0,r.length-1),t&&t.push(r.buffer,n.buffer),{ids:r,positions:n}},Zh.deserialize=function(e){var t=new Zh;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t},Ml(Zh,"FeaturePositionMap");var tp={UNSIGNED_BYTE:Lc.UNSIGNED_BYTE,UNSIGNED_SHORT:Lc.UNSIGNED_SHORT,UNSIGNED_INT:Lc.UNSIGNED_INT,getSizeInBytes:function(e){switch(e){case tp.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case tp.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case tp.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT}throw new Ht("indexDatatype is required and must be a valid IndexDatatype constant.")},fromSizeInBytes:function(e){switch(e){case 2:return tp.UNSIGNED_SHORT;case 4:return tp.UNSIGNED_INT;case 1:return tp.UNSIGNED_BYTE;default:throw new Ht("Size in bytes cannot be mapped to an IndexDatatype")}},validate:function(e){return jt(e)&&(e===tp.UNSIGNED_BYTE||e===tp.UNSIGNED_SHORT||e===tp.UNSIGNED_INT)},createTypedArray:function(e,t){if(!jt(e))throw new Ht("numberOfVertices is required.");return e>=Wt.SIXTY_FOUR_KILOBYTES?new Uint32Array(t):new Uint16Array(t)},createTypedArrayFromArrayBuffer:function(e,t,r,n){if(!jt(e))throw new Ht("numberOfVertices is required.");if(!jt(t))throw new Ht("sourceArray is required.");if(!jt(r))throw new Ht("byteOffset is required.");return e>=Wt.SIXTY_FOUR_KILOBYTES?new Uint32Array(t,r,n):new Uint16Array(t,r,n)},fromTypedArray:function(e){if(e instanceof Uint8Array)return tp.UNSIGNED_BYTE;if(e instanceof Uint16Array)return tp.UNSIGNED_SHORT;if(e instanceof Uint32Array)return tp.UNSIGNED_INT;throw new Ht("array must be a Uint8Array, Uint16Array, or Uint32Array.")}},rp=Object.freeze(tp),np={STREAM_DRAW:Lc.STREAM_DRAW,STATIC_DRAW:Lc.STATIC_DRAW,DYNAMIC_DRAW:Lc.DYNAMIC_DRAW,validate:function(e){return e===np.STREAM_DRAW||e===np.STATIC_DRAW||e===np.DYNAMIC_DRAW}};function ip(){return!0}function op(e,t){function r(){throw new Ht(t)}for(var n in t=Yt(t,"This object was destroyed, i.e., destroy() was called."),e)"function"==typeof e[n]&&(e[n]=r);e.isDestroyed=ip}const sp=0,ap=1;function up(e){if(e=Yt(e,Yt.EMPTY_OBJECT),qt.defined("options.context",e.context),!jt(e.typedArray)&&!jt(e.sizeInBytes))throw new Ht("Either options.sizeInBytes or options.typedArray is required.");if(jt(e.typedArray)&&jt(e.sizeInBytes))throw new Ht("Cannot pass in both options.sizeInBytes and options.typedArray.");if(jt(e.typedArray)&&(qt.typeOf.object("options.typedArray",e.typedArray),qt.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),!np.validate(e.usage))throw new Ht("usage is invalid.");var t=e.context._gl,r=e.bufferTarget,n=e.typedArray,i=e.sizeInBytes,o=e.usage,s=jt(n);s&&(i=n.byteLength),qt.typeOf.number.greaterThan("sizeInBytes",i,0);var a=t.createBuffer();t.bindBuffer(r,a),t.bufferData(r,s?n:i,o),t.bindBuffer(r,null),this._gl=t,this._webgl2=e.context._webgl2,this._bufferTarget=r,this._sizeInBytes=i,this._usage=o,this._buffer=a,this.context=e.context,e.context.memorySize+=i,this._ownerName=e.owner,this.context.memoryAnalyzer.allocateGPUMemory(ap,e.owner,i)}function cp(){}function lp(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=lp._Counter++}function hp(e,t,r,n,i,o,s,a){void 0===n&&(n=0),void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),this._isAlreadyOwned=!1,e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=r,this._instanced=o,this._divisor=a||1,t instanceof lp?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=s?n:n*Float32Array.BYTES_PER_ELEMENT,i||this.create()}function pp(e,t,r,n,i,o,s,a,u,c,l,h,p,d){if(void 0===l&&(l=!1),void 0===h&&(h=!1),void 0===p&&(p=1),void 0===d&&(d=!1),t instanceof hp?(this._buffer=t,this._ownsBuffer=d):(this._buffer=new hp(e,t,n,o,i,s,h),this._ownsBuffer=!0),this.uniqueId=pp._Counter++,this._kind=r,null==c){var f=this.getData();this.type=pp.FLOAT,f instanceof Int8Array?this.type=pp.BYTE:f instanceof Uint8Array?this.type=pp.UNSIGNED_BYTE:f instanceof Int16Array?this.type=pp.SHORT:f instanceof Uint16Array?this.type=pp.UNSIGNED_SHORT:f instanceof Int32Array?this.type=pp.INT:f instanceof Uint32Array&&(this.type=pp.UNSIGNED_INT)}else this.type=c;var A=pp.GetTypeByteLength(this.type);h?(this._size=u||(o?o/A:pp.DeduceStride(r)),this.byteStride=o||this._buffer.byteStride||this._size*A,this.byteOffset=a||0):(this._size=u||o||pp.DeduceStride(r),this.byteStride=o?o*A:this._buffer.byteStride||this._size*A,this.byteOffset=(a||0)*A),this.normalized=l,this._instanced=void 0!==s&&s,this._instanceDivisor=s?p:0,this._computeHashCode()}function dp(e,t,r){void 0===r&&(r=cp.BUFFER_CREATIONFLAG_READWRITE),this._engine=e,this._engine._storageBuffers.push(this),this._create(t,r)}function fp(e){var t=(e=Yt(e,Yt.EMPTY_OBJECT)).context,r=e.bufferTarget,n=e.typedArray,i=e.sizeInBytes,o=e.usage,s=jt(n);s?i=n.byteLength:n=new Uint8Array(i);var a=cp.BUFFER_CREATIONFLAG_STORAGE;jt(o)&&(o==np.STREAM_DRAW||o==np.STATIC_DRAW?a|=cp.BUFFER_CREATIONFLAG_WRITE:o==np.DYNAMIC_DRAW&&(a|=cp.BUFFER_CREATIONFLAG_READWRITE)),jt(r)?r==Lc.ELEMENT_ARRAY_BUFFER?(n instanceof Uint8Array&&(e.indexDatatype==rp.UNSIGNED_INT?n=new Uint32Array(n.buffer,n.byteOffset,n.byteLength/4):e.indexDatatype==rp.UNSIGNED_SHORT&&(n=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2))),this._dataBuffer=t.engine.createIndexBuffer(n)):r==Lc.ARRAY_BUFFER?(this._dataBuffer=new hp(t.engine,n,!0),this._dataBuffer._data=null):console.log("BufferGPU not supported bufferTarget"):(this._dataBuffer=new dp(t.engine,i,a),s&&this._dataBuffer.update(n,0,i)),this._bufferTarget=r,this._sizeInBytes=i,this._usage=o,this.context=e.context,e.context.memorySize+=i,this._ownerName=e.owner,this.context.memoryAnalyzer.allocateGPUMemory(ap,e.owner,i)}function Ap(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function gp(e){if(e=Yt(e,Yt.EMPTY_OBJECT),qt.defined("options.context",e.context),!jt(e.typedArray)&&!jt(e.sizeInBytes))throw new Ht("Either options.sizeInBytes or options.typedArray is required.");if(jt(e.typedArray)&&jt(e.sizeInBytes))throw new Ht("Cannot pass in both options.sizeInBytes and options.typedArray.");jt(e.typedArray)&&(qt.typeOf.object("options.typedArray",e.typedArray),qt.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),this._id=Ap(),e.context.webgpu?this._inner=new fp(e):this._inner=new up(e),this.vertexArrayDestroyable=!0}function _p(e,t,r,n){this.x=Yt(e,0),this.y=Yt(t,0),this.width=Yt(r,0),this.height=Yt(n,0)}Object.defineProperties(up.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}}),up.prototype._getBuffer=function(){return this._buffer},up.prototype.copyFromArrayView=function(e,t){t=Yt(t,0),qt.defined("arrayView",e),qt.typeOf.number.lessThanOrEquals("offsetInBytes + arrayView.byteLength",t+e.byteLength,this._sizeInBytes);var r=this._gl,n=this._bufferTarget;r.bindBuffer(n,this._buffer),r.bufferSubData(n,t,e),r.bindBuffer(n,null)},up.prototype.copyFromBuffer=function(e,t,r,n){if(!this._webgl2)throw new Ht("A WebGL 2 context is required.");if(!jt(e))throw new Ht("readBuffer must be defined.");if(!jt(n)||n<=0)throw new Ht("sizeInBytes must be defined and be greater than zero.");if(!jt(t)||t<0||t+n>e.sizeInBytes)throw new Ht("readOffset must be greater than or equal to zero and readOffset + sizeInBytes must be less than of equal to readBuffer.sizeInBytes.");if(!jt(r)||r<0||r+n>this._sizeInBytes)throw new Ht("writeOffset must be greater than or equal to zero and writeOffset + sizeInBytes must be less than of equal to this.sizeInBytes.");if(this._buffer===e.buffer&&(r>=t&&r<t+n||t>r&&t<r+n))throw new Ht("When readBuffer is equal to this, the ranges [readOffset + sizeInBytes) and [writeOffset, writeOffset + sizeInBytes) must not overlap.");if(this._bufferTarget===Lc.ELEMENT_ARRAY_BUFFER&&e.bufferTarget!==Lc.ELEMENT_ARRAY_BUFFER||this._bufferTarget!==Lc.ELEMENT_ARRAY_BUFFER&&e.bufferTarget===Lc.ELEMENT_ARRAY_BUFFER)throw new Ht("Can not copy an index buffer into another buffer type.");var i=Lc.COPY_READ_BUFFER,o=Lc.COPY_WRITE_BUFFER,s=this._gl;s.bindBuffer(o,this._buffer),s.bindBuffer(i,e.buffer),s.copyBufferSubData(i,o,t,r,n),s.bindBuffer(o,null),s.bindBuffer(i,null)},up.prototype.getBufferData=function(e,t,r,n){if(t=Yt(t,0),r=Yt(r,0),!this._webgl2)throw new Ht("A WebGL 2 context is required.");if(!jt(e))throw new Ht("arrayView is required.");var i,o,s=e.byteLength;if(jt(n)?(i=n,jt(s)?o=1:(s=e.length,o=e.BYTES_PER_ELEMENT)):jt(s)?(i=s-r,o=1):(i=(s=e.length)-r,o=e.BYTES_PER_ELEMENT),r<0||r>s)throw new Ht("destinationOffset must be greater than zero and less than the arrayView length.");if(r+i>s)throw new Ht("destinationOffset + length must be less than or equal to the arrayViewLength.");if(t<0||t>this._sizeInBytes)throw new Ht("sourceOffset must be greater than zero and less than the buffers size.");if(t+i*o>this._sizeInBytes)throw new Ht("sourceOffset + length must be less than the buffers size.");var a=this._gl,u=Lc.COPY_READ_BUFFER;a.bindBuffer(u,this._buffer),a.getBufferSubData(u,t,e,r,n),a.bindBuffer(u,null)},up.prototype.isDestroyed=function(){return!1},up.prototype.destroy=function(){return!this.context._contextWasLost&&this._gl.deleteBuffer(this._buffer),this.context.memorySize-=this.sizeInBytes,this.context.memoryAnalyzer.releaseGPUMemory(ap,this._ownerName,this.sizeInBytes),op(this)},cp.ALPHA_DISABLE=0,cp.ALPHA_ADD=1,cp.ALPHA_COMBINE=2,cp.ALPHA_SUBTRACT=3,cp.ALPHA_MULTIPLY=4,cp.ALPHA_MAXIMIZED=5,cp.ALPHA_ONEONE=6,cp.ALPHA_PREMULTIPLIED=7,cp.ALPHA_PREMULTIPLIED_PORTERDUFF=8,cp.ALPHA_INTERPOLATE=9,cp.ALPHA_SCREENMODE=10,cp.ALPHA_ONEONE_ONEONE=11,cp.ALPHA_ALPHATOCOLOR=12,cp.ALPHA_REVERSEONEMINUS=13,cp.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,cp.ALPHA_ONEONE_ONEZERO=15,cp.ALPHA_EXCLUSION=16,cp.ALPHA_LAYER_ACCUMULATE=17,cp.ALPHA_EQUATION_ADD=0,cp.ALPHA_EQUATION_SUBSTRACT=1,cp.ALPHA_EQUATION_REVERSE_SUBTRACT=2,cp.ALPHA_EQUATION_MAX=3,cp.ALPHA_EQUATION_MIN=4,cp.ALPHA_EQUATION_DARKEN=5,cp.DELAYLOADSTATE_NONE=0,cp.DELAYLOADSTATE_LOADED=1,cp.DELAYLOADSTATE_LOADING=2,cp.DELAYLOADSTATE_NOTLOADED=4,cp.NEVER=512,cp.ALWAYS=519,cp.LESS=513,cp.EQUAL=514,cp.LEQUAL=515,cp.GREATER=516,cp.GEQUAL=518,cp.NOTEQUAL=517,cp.KEEP=7680,cp.ZERO=0,cp.REPLACE=7681,cp.INCR=7682,cp.DECR=7683,cp.INVERT=5386,cp.INCR_WRAP=34055,cp.DECR_WRAP=34056,cp.FRONT=0,cp.BACK=1,cp.TEXTURE_CLAMP_ADDRESSMODE=0,cp.TEXTURE_WRAP_ADDRESSMODE=1,cp.TEXTURE_MIRROR_ADDRESSMODE=2,cp.TEXTURE_CREATIONFLAG_STORAGE=1,cp.TEXTUREFORMAT_ALPHA=0,cp.TEXTUREFORMAT_LUMINANCE=1,cp.TEXTUREFORMAT_LUMINANCE_ALPHA=2,cp.TEXTUREFORMAT_RGB=4,cp.TEXTUREFORMAT_RGBA=5,cp.TEXTUREFORMAT_RED=6,cp.TEXTUREFORMAT_R=6,cp.TEXTUREFORMAT_RG=7,cp.TEXTUREFORMAT_RED_INTEGER=8,cp.TEXTUREFORMAT_R_INTEGER=8,cp.TEXTUREFORMAT_RG_INTEGER=9,cp.TEXTUREFORMAT_RGB_INTEGER=10,cp.TEXTUREFORMAT_RGBA_INTEGER=11,cp.TEXTUREFORMAT_BGRA=12,cp.TEXTUREFORMAT_DEPTH24_STENCIL8=13,cp.TEXTUREFORMAT_DEPTH32_FLOAT=14,cp.TEXTUREFORMAT_DEPTH16=15,cp.TEXTUREFORMAT_DEPTH24=16,cp.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,cp.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,cp.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,cp.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,cp.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,cp.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,cp.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,cp.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,cp.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,cp.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,cp.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,cp.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,cp.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,cp.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,cp.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,cp.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,cp.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,cp.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,cp.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,cp.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,cp.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,cp.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,cp.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,cp.TEXTURETYPE_UNSIGNED_BYTE=0,cp.TEXTURETYPE_UNSIGNED_INT=0,cp.TEXTURETYPE_FLOAT=1,cp.TEXTURETYPE_HALF_FLOAT=2,cp.TEXTURETYPE_BYTE=3,cp.TEXTURETYPE_SHORT=4,cp.TEXTURETYPE_UNSIGNED_SHORT=5,cp.TEXTURETYPE_INT=6,cp.TEXTURETYPE_UNSIGNED_INTEGER=7,cp.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,cp.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,cp.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,cp.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,cp.TEXTURETYPE_UNSIGNED_INT_24_8=12,cp.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,cp.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,cp.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,cp.TEXTURETYPE_UNDEFINED=16,cp.TEXTURE_NEAREST_SAMPLINGMODE=1,cp.TEXTURE_NEAREST_NEAREST=1,cp.TEXTURE_BILINEAR_SAMPLINGMODE=2,cp.TEXTURE_LINEAR_LINEAR=2,cp.TEXTURE_TRILINEAR_SAMPLINGMODE=3,cp.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,cp.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,cp.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,cp.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,cp.TEXTURE_NEAREST_LINEAR=7,cp.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,cp.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,cp.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,cp.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,cp.TEXTURE_LINEAR_NEAREST=12,cp.TEXTURE_EXPLICIT_MODE=0,cp.TEXTURE_SPHERICAL_MODE=1,cp.TEXTURE_PLANAR_MODE=2,cp.TEXTURE_CUBIC_MODE=3,cp.TEXTURE_PROJECTION_MODE=4,cp.TEXTURE_SKYBOX_MODE=5,cp.TEXTURE_INVCUBIC_MODE=6,cp.TEXTURE_EQUIRECTANGULAR_MODE=7,cp.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,cp.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,cp.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,cp.TEXTURE_FILTERING_QUALITY_HIGH=64,cp.TEXTURE_FILTERING_QUALITY_MEDIUM=16,cp.TEXTURE_FILTERING_QUALITY_LOW=8,cp.SCALEMODE_FLOOR=1,cp.SCALEMODE_NEAREST=2,cp.SCALEMODE_CEILING=3,cp.MATERIAL_TextureDirtyFlag=1,cp.MATERIAL_LightDirtyFlag=2,cp.MATERIAL_FresnelDirtyFlag=4,cp.MATERIAL_AttributesDirtyFlag=8,cp.MATERIAL_MiscDirtyFlag=16,cp.MATERIAL_PrePassDirtyFlag=32,cp.MATERIAL_AllDirtyFlag=63,cp.MATERIAL_TriangleFillMode=0,cp.MATERIAL_WireFrameFillMode=1,cp.MATERIAL_PointFillMode=2,cp.MATERIAL_PointListDrawMode=3,cp.MATERIAL_LineListDrawMode=4,cp.MATERIAL_LineLoopDrawMode=5,cp.MATERIAL_LineStripDrawMode=6,cp.MATERIAL_TriangleStripDrawMode=7,cp.MATERIAL_TriangleFanDrawMode=8,cp.MATERIAL_ClockWiseSideOrientation=0,cp.MATERIAL_CounterClockWiseSideOrientation=1,cp.ACTION_NothingTrigger=0,cp.ACTION_OnPickTrigger=1,cp.ACTION_OnLeftPickTrigger=2,cp.ACTION_OnRightPickTrigger=3,cp.ACTION_OnCenterPickTrigger=4,cp.ACTION_OnPickDownTrigger=5,cp.ACTION_OnDoublePickTrigger=6,cp.ACTION_OnPickUpTrigger=7,cp.ACTION_OnPickOutTrigger=16,cp.ACTION_OnLongPressTrigger=8,cp.ACTION_OnPointerOverTrigger=9,cp.ACTION_OnPointerOutTrigger=10,cp.ACTION_OnEveryFrameTrigger=11,cp.ACTION_OnIntersectionEnterTrigger=12,cp.ACTION_OnIntersectionExitTrigger=13,cp.ACTION_OnKeyDownTrigger=14,cp.ACTION_OnKeyUpTrigger=15,cp.PARTICLES_BILLBOARDMODE_Y=2,cp.PARTICLES_BILLBOARDMODE_ALL=7,cp.PARTICLES_BILLBOARDMODE_STRETCHED=8,cp.MESHES_CULLINGSTRATEGY_STANDARD=0,cp.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,cp.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,cp.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,cp.SCENELOADER_NO_LOGGING=0,cp.SCENELOADER_MINIMAL_LOGGING=1,cp.SCENELOADER_SUMMARY_LOGGING=2,cp.SCENELOADER_DETAILED_LOGGING=3,cp.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,cp.PREPASS_POSITION_TEXTURE_TYPE=1,cp.PREPASS_VELOCITY_TEXTURE_TYPE=2,cp.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,cp.PREPASS_COLOR_TEXTURE_TYPE=4,cp.PREPASS_DEPTH_TEXTURE_TYPE=5,cp.PREPASS_NORMAL_TEXTURE_TYPE=6,cp.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,cp.BUFFER_CREATIONFLAG_READ=1,cp.BUFFER_CREATIONFLAG_WRITE=2,cp.BUFFER_CREATIONFLAG_READWRITE=3,cp.BUFFER_CREATIONFLAG_UNIFORM=4,cp.BUFFER_CREATIONFLAG_VERTEX=8,cp.BUFFER_CREATIONFLAG_INDEX=16,cp.BUFFER_CREATIONFLAG_STORAGE=32,cp.RENDERPASS_MAIN=0,cp.INPUT_ALT_KEY=18,cp.INPUT_CTRL_KEY=17,cp.INPUT_META_KEY1=91,cp.INPUT_META_KEY2=92,cp.INPUT_META_KEY3=93,cp.INPUT_SHIFT_KEY=16,cp.SNAPSHOTRENDERING_STANDARD=0,cp.SNAPSHOTRENDERING_FAST=1,cp.PERSPECTIVE_CAMERA=0,cp.ORTHOGRAPHIC_CAMERA=1,cp.FOVMODE_VERTICAL_FIXED=0,cp.FOVMODE_HORIZONTAL_FIXED=1,cp.RIG_MODE_NONE=0,cp.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,cp.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,cp.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,cp.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,cp.RIG_MODE_STEREOSCOPIC_INTERLACED=14,cp.RIG_MODE_VR=20,cp.RIG_MODE_WEBVR=21,cp.RIG_MODE_CUSTOM=22,cp.MAX_SUPPORTED_UV_SETS=6,cp.GL_ALPHA_EQUATION_ADD=32774,cp.GL_ALPHA_EQUATION_MIN=32775,cp.GL_ALPHA_EQUATION_MAX=32776,cp.GL_ALPHA_EQUATION_SUBTRACT=32778,cp.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,cp.GL_ALPHA_FUNCTION_SRC=768,cp.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,cp.GL_ALPHA_FUNCTION_SRC_ALPHA=770,cp.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,cp.GL_ALPHA_FUNCTION_DST_ALPHA=772,cp.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,cp.GL_ALPHA_FUNCTION_DST_COLOR=774,cp.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,cp.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,cp.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,cp.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,cp.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,cp.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,cp.SnippetUrl="",Object.defineProperty(lp.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),lp._Counter=0,hp.prototype.createVertexBuffer=function(e,t,r,n,i,o,s){void 0===o&&(o=!1);var a=o?t:t*Float32Array.BYTES_PER_ELEMENT,u=n?o?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new pp(this._engine,this,e,this._updatable,!0,u,void 0===i?this._instanced:i,a,r,void 0,void 0,!0,this._divisor||s)},hp.prototype.isUpdatable=function(){return this._updatable},hp.prototype.getData=function(){return this._data},hp.prototype.getBuffer=function(){return this._buffer},hp.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},hp.prototype.create=function(e){void 0===e&&(e=null),!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},hp.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},hp.prototype.update=function(e){this.create(e)},hp.prototype.updateDirectly=function(e,t,r,n){void 0===n&&(n=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,n?t:t*Float32Array.BYTES_PER_ELEMENT,r?r*this.byteStride:void 0),this._data=0===t&&void 0===r?e:null)},hp.prototype._increaseReferences=function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)},hp.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)},Object.defineProperty(pp.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,this._instanced=0!=e,this._computeHashCode()},enumerable:!1,configurable:!0}),pp.prototype._computeHashCode=function(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},pp.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},pp.prototype.getKind=function(){return this._kind},pp.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},pp.prototype.getData=function(){return this._buffer.getData()},pp.prototype.getFloatData=function(e,t){var r=this.getData();if(!r)return null;var n=this.getSize()*pp.GetTypeByteLength(this.type),i=e*this.getSize();if(this.type!==pp.FLOAT||this.byteStride!==n){var o=new Float32Array(i);return this.forEach(i,(function(e,t){return o[t]=e})),o}if(!(r instanceof Array||r instanceof Float32Array)||0!==this.byteOffset||r.length!==i){if(r instanceof Array){var s=this.byteOffset/4;return r.slice(s,s+i)}if(r instanceof ArrayBuffer)return new Float32Array(r,this.byteOffset,i);s=r.byteOffset+this.byteOffset;if(t){var a=new Float32Array(i),u=new Float32Array(r.buffer,s,i);return a.set(u),a}var c=s%4;return c&&(s=Math.max(0,s-c)),new Float32Array(r.buffer,s,i)}return t?r.slice():r},pp.prototype.getBuffer=function(){return this._buffer.getBuffer()},pp.prototype.getStrideSize=function(){return this.byteStride/pp.GetTypeByteLength(this.type)},pp.prototype.getOffset=function(){return this.byteOffset/pp.GetTypeByteLength(this.type)},pp.prototype.getSize=function(e){return void 0===e&&(e=!1),e?this._size*pp.GetTypeByteLength(this.type):this._size},pp.prototype.getIsInstanced=function(){return this._instanced},pp.prototype.getInstanceDivisor=function(){return this._instanceDivisor},pp.prototype.create=function(e){this._buffer.create(e)},pp.prototype.update=function(e){this._buffer.update(e)},pp.prototype.updateDirectly=function(e,t,r){void 0===r&&(r=!1),this._buffer.updateDirectly(e,t,void 0,r)},pp.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},pp.prototype.forEach=function(e,t){pp.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,t)},pp.DeduceStride=function(e){switch(e){case pp.UVKind:case pp.UV2Kind:case pp.UV3Kind:case pp.UV4Kind:case pp.UV5Kind:case pp.UV6Kind:return 2;case pp.NormalKind:case pp.PositionKind:return 3;case pp.ColorKind:case pp.MatricesIndicesKind:case pp.MatricesIndicesExtraKind:case pp.MatricesWeightsKind:case pp.MatricesWeightsExtraKind:case pp.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}},pp.GetTypeByteLength=function(e){switch(e){case pp.BYTE:case pp.UNSIGNED_BYTE:return 1;case pp.SHORT:case pp.UNSIGNED_SHORT:return 2;case pp.INT:case pp.UNSIGNED_INT:case pp.FLOAT:return 4;default:throw new Error("Invalid type '".concat(e,"'"))}},pp.ForEach=function(e,t,r,n,i,o,s,a){if(e instanceof Array)for(var u=t/4,c=r/4,l=0;l<o;l+=n){for(var h=0;h<n;h++)a(e[u+h],l+h);u+=c}else{var p=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),d=pp.GetTypeByteLength(i);for(l=0;l<o;l+=n){var f=t;for(h=0;h<n;h++){a(pp._GetFloatValue(p,i,f,s),l+h),f+=d}t+=r}}},pp._GetFloatValue=function(e,t,r,n){switch(t){case pp.BYTE:var i=e.getInt8(r);return n&&(i=Math.max(i/127,-1)),i;case pp.UNSIGNED_BYTE:i=e.getUint8(r);return n&&(i/=255),i;case pp.SHORT:i=e.getInt16(r,!0);return n&&(i=Math.max(i/32767,-1)),i;case pp.UNSIGNED_SHORT:i=e.getUint16(r,!0);return n&&(i/=65535),i;case pp.INT:return e.getInt32(r,!0);case pp.UNSIGNED_INT:return e.getUint32(r,!0);case pp.FLOAT:return e.getFloat32(r,!0);default:throw new Error("Invalid component type ".concat(t))}},pp._Counter=0,pp.BYTE=5120,pp.UNSIGNED_BYTE=5121,pp.SHORT=5122,pp.UNSIGNED_SHORT=5123,pp.INT=5124,pp.UNSIGNED_INT=5125,pp.FLOAT=5126,pp.PositionKind="position",pp.NormalKind="normal",pp.TangentKind="tangent",pp.UVKind="uv",pp.UV2Kind="uv2",pp.UV3Kind="uv3",pp.UV4Kind="uv4",pp.UV5Kind="uv5",pp.UV6Kind="uv6",pp.ColorKind="color",pp.ColorInstanceKind="instanceColor",pp.MatricesIndicesKind="matricesIndices",pp.MatricesWeightsKind="matricesWeights",pp.MatricesIndicesExtraKind="matricesIndicesExtra",pp.MatricesWeightsExtraKind="matricesWeightsExtra",dp.prototype._create=function(e,t){this._bufferSize=e,this._creationFlags=t,this._buffer=this._engine.createStorageBuffer(e,t)},dp.prototype._rebuild=function(){this._create(this._bufferSize,this._creationFlags)},dp.prototype.getBuffer=function(){return this._buffer},dp.prototype.update=function(e,t,r){this._buffer&&this._engine.updateStorageBuffer(this._buffer,e,t,r)},dp.prototype.read=function(e,t,r){return this._engine.readFromStorageBuffer(this._buffer,e,t,r)},dp.prototype.dispose=function(){var e=this._engine._storageBuffers,t=e.indexOf(this);-1!==t&&(e[t]=e[e.length-1],e.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null},Object.defineProperties(fp.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}},dataBuffer:{get:function(){return this._dataBuffer}}}),fp.prototype._getBuffer=function(){return console.log("BufferGPU.prototype._getBuffer"),this._dataBuffer},fp.prototype.copyFromArrayView=function(e,t){this._bufferTarget===Lc.ELEMENT_ARRAY_BUFFER?this.context.engine.updateDynamicIndexBuffer(this._dataBuffer,e):this._dataBuffer.updateDirectly(e,t,null,!0)},fp.prototype.copyFromBuffer=function(e,t,r,n){console.log("BufferGPU.prototype.copyFromBuffer")},fp.prototype.getBufferData=function(e,t,r,n){console.log("BufferGPU.prototype.getBufferData")},fp.prototype.isDestroyed=function(){return!1},fp.prototype.destroy=function(){return this._bufferTarget!==Lc.ELEMENT_ARRAY_BUFFER?this._dataBuffer.dispose():this.context._engine._releaseBuffer(this._dataBuffer),this.context.memorySize-=this.sizeInBytes,this.context.memoryAnalyzer.releaseGPUMemory(ap,this._ownerName,this.sizeInBytes),op(this)},gp.createVertexBuffer=function(e){return qt.defined("options.context",e.context),new gp({context:e.context,bufferTarget:Lc.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage,owner:e.owner})},gp.createIndexBuffer=function(e){if(qt.defined("options.context",e.context),!rp.validate(e.indexDatatype))throw new Ht("Invalid indexDatatype.");if(e.indexDatatype===rp.UNSIGNED_INT&&!e.context.elementIndexUint)throw new Ht("IndexDatatype.UNSIGNED_INT requires OES_element_index_uint, which is not supported on this system.  Check context.elementIndexUint.");var t=e.context,r=e.indexDatatype,n=rp.getSizeInBytes(r),i=new gp({context:t,bufferTarget:Lc.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage,indexDatatype:r,owner:e.owner}),o=i.sizeInBytes/n;return Object.defineProperties(i,{indexDatatype:{get:function(){return r}},bytesPerIndex:{get:function(){return n}},numberOfIndices:{get:function(){return o}}}),i},Object.defineProperties(gp.prototype,{sizeInBytes:{get:function(){return this._inner.sizeInBytes}},usage:{get:function(){return this._inner.usage}},bufferTarget:{get:function(){return this._inner._bufferTarget}},buffer:{get:function(){return this._inner._buffer}}}),gp.prototype._getBuffer=function(){return this._inner._getBuffer()},gp.prototype.copyFromArrayView=function(e,t){this._inner.copyFromArrayView(e,t)},gp.prototype.copyFromBuffer=function(e,t,r,n){this._inner.copyFromBuffer(e,t,r,n)},gp.prototype.getBufferData=function(e,t,r,n){this._inner.getBufferData(e,t,r,n)},gp.prototype.isDestroyed=function(){return!1},gp.prototype.destroy=function(){return this._inner.destroy(),op(this)},_p.packedLength=4,_p.pack=function(e,t,r){return qt.typeOf.object("value",e),qt.defined("array",t),r=Yt(r,0),t[r++]=e.x,t[r++]=e.y,t[r++]=e.width,t[r]=e.height,t},_p.unpack=function(e,t,r){return qt.defined("array",e),t=Yt(t,0),jt(r)||(r=new _p),r.x=e[t++],r.y=e[t++],r.width=e[t++],r.height=e[t],r},_p.fromPoints=function(e,t){if(jt(t)||(t=new _p),!jt(e)||0===e.length)return t.x=0,t.y=0,t.width=0,t.height=0,t;for(var r=e.length,n=e[0].x,i=e[0].y,o=e[0].x,s=e[0].y,a=1;a<r;a++){var u=e[a],c=u.x,l=u.y;n=Math.min(c,n),o=Math.max(c,o),i=Math.min(l,i),s=Math.max(l,s)}return t.x=n,t.y=i,t.width=o-n,t.height=s-i,t};var mp,yp,Ep,xp=new Qs,Cp=new lr,bp=new lr;function Ip(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),6*r<1?e+6*(t-e)*r:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function Tp(e,t,r,n){this.red=Yt(e,1),this.green=Yt(t,1),this.blue=Yt(r,1),this.alpha=Yt(n,1)}_p.fromRectangle=function(e,t,r){if(jt(r)||(r=new _p),!jt(e))return r.x=0,r.y=0,r.width=0,r.height=0,r;var n=(t=Yt(t,xp)).project(wa.southwest(e,Cp)),i=t.project(wa.northeast(e,bp));return _r.subtract(i,n,i),r.x=n.x,r.y=n.y,r.width=i.x,r.height=i.y,r},_p.clone=function(e,t){if(jt(e))return jt(t)?(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t):new _p(e.x,e.y,e.width,e.height)},_p.union=function(e,t,r){qt.typeOf.object("left",e),qt.typeOf.object("right",t),jt(r)||(r=new _p);var n=Math.min(e.x,t.x),i=Math.min(e.y,t.y),o=Math.max(e.x+e.width,t.x+t.width),s=Math.max(e.y+e.height,t.y+t.height);return r.x=n,r.y=i,r.width=o-n,r.height=s-i,r},_p.expand=function(e,t,r){qt.typeOf.object("rectangle",e),qt.typeOf.object("point",t),r=_p.clone(e,r);var n=t.x-r.x,i=t.y-r.y;return n>r.width?r.width=n:n<0&&(r.width-=n,r.x=t.x),i>r.height?r.height=i:i<0&&(r.height-=i,r.y=t.y),r},_p.intersect=function(e,t){qt.typeOf.object("left",e),qt.typeOf.object("right",t);var r=e.x,n=e.y,i=t.x,o=t.y;return r>i+t.width||r+e.width<i||n+e.height<o||n>o+t.height?Ra.OUTSIDE:Ra.INTERSECTING},_p.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height},_p.prototype.clone=function(e){return _p.clone(this,e)},_p.prototype.intersect=function(e){return _p.intersect(this,e)},_p.prototype.equals=function(e){return _p.equals(this,e)},Tp.fromCartesian4=function(e,t){return qt.typeOf.object("cartesian",e),jt(t)?(t.red=e.x,t.green=e.y,t.blue=e.z,t.alpha=e.w,t):new Tp(e.x,e.y,e.z,e.w)},Tp.fromBytes=function(e,t,r,n,i){return e=Tp.byteToFloat(Yt(e,255)),t=Tp.byteToFloat(Yt(t,255)),r=Tp.byteToFloat(Yt(r,255)),n=Tp.byteToFloat(Yt(n,255)),jt(i)?(i.red=e,i.green=t,i.blue=r,i.alpha=n,i):new Tp(e,t,r,n)},Tp.fromAlpha=function(e,t,r){return qt.typeOf.object("color",e),qt.typeOf.number("alpha",t),jt(r)?(r.red=e.red,r.green=e.green,r.blue=e.blue,r.alpha=t,r):new Tp(e.red,e.green,e.blue,t)},cs.supportsTypedArrays()&&(mp=new ArrayBuffer(4),yp=new Uint32Array(mp),Ep=new Uint8Array(mp)),Tp.fromRgba=function(e,t){return yp[0]=e,Tp.fromBytes(Ep[0],Ep[1],Ep[2],Ep[3],t)},Tp.byteToRgba=function(e,t,r,n){return Ep[0]=e,Ep[1]=t,Ep[2]=r,Ep[3]=n,yp[0]},Tp.fromHsl=function(e,t,r,n,i){e=Yt(e,0)%1,t=Yt(t,0),r=Yt(r,0),n=Yt(n,1);var o=r,s=r,a=r;if(0!==t){var u,c=2*r-(u=r<.5?r*(1+t):r+t-r*t);o=Ip(c,u,e+1/3),s=Ip(c,u,e),a=Ip(c,u,e-1/3)}return jt(i)?(i.red=o,i.green=s,i.blue=a,i.alpha=n,i):new Tp(o,s,a,n)},Tp.fromRandom=function(e,t){var r=(e=Yt(e,Yt.EMPTY_OBJECT)).red;if(!jt(r)){var n=Yt(e.minimumRed,0),i=Yt(e.maximumRed,1);qt.typeOf.number.lessThanOrEquals("minimumRed",n,i),r=n+Wt.nextRandomNumber()*(i-n)}var o=e.green;if(!jt(o)){var s=Yt(e.minimumGreen,0),a=Yt(e.maximumGreen,1);qt.typeOf.number.lessThanOrEquals("minimumGreen",s,a),o=s+Wt.nextRandomNumber()*(a-s)}var u=e.blue;if(!jt(u)){var c=Yt(e.minimumBlue,0),l=Yt(e.maximumBlue,1);qt.typeOf.number.lessThanOrEquals("minimumBlue",c,l),u=c+Wt.nextRandomNumber()*(l-c)}var h=e.alpha;if(!jt(h)){var p=Yt(e.minimumAlpha,0),d=Yt(e.maximumAlpha,1);qt.typeOf.number.lessThanOrEquals("minumumAlpha",p,d),h=p+Wt.nextRandomNumber()*(d-p)}return jt(t)?(t.red=r,t.green=o,t.blue=u,t.alpha=h,t):new Tp(r,o,u,h)};var vp=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,Rp=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i,Mp=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,wp=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i;Tp.fromCssColorString=function(e,t){qt.typeOf.string("color",e),jt(t)||(t=new Tp);var r=Tp[e.toUpperCase()];if(jt(r))return Tp.clone(r,t),t;var n=vp.exec(e);return null!==n?(t.red=parseInt(n[1],16)/15,t.green=parseInt(n[2],16)/15,t.blue=parseInt(n[3],16)/15,t.alpha=1,t):null!==(n=Rp.exec(e))?(t.red=parseInt(n[1],16)/255,t.green=parseInt(n[2],16)/255,t.blue=parseInt(n[3],16)/255,t.alpha=1,t):null!==(n=Mp.exec(e))?(t.red=parseFloat(n[1])/("%"===n[1].substr(-1)?100:255),t.green=parseFloat(n[2])/("%"===n[2].substr(-1)?100:255),t.blue=parseFloat(n[3])/("%"===n[3].substr(-1)?100:255),t.alpha=parseFloat(Yt(n[4],"1.0")),t):null!==(n=wp.exec(e))?Tp.fromHsl(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,parseFloat(Yt(n[4],"1.0")),t):t=void 0},Tp.packedLength=4,Tp.pack=function(e,t,r){return qt.typeOf.object("value",e),qt.defined("array",t),r=Yt(r,0),t[r++]=e.red,t[r++]=e.green,t[r++]=e.blue,t[r]=e.alpha,t},Tp.unpack=function(e,t,r){return qt.defined("array",e),t=Yt(t,0),jt(r)||(r=new Tp),r.red=e[t++],r.green=e[t++],r.blue=e[t++],r.alpha=e[t],r},Tp.byteToFloat=function(e){return e/255},Tp.floatToByte=function(e){return 1===e?255:256*e|0},Tp.clone=function(e,t){if(jt(e))return jt(t)?(t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha,t):new Tp(e.red,e.green,e.blue,e.alpha)},Tp.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e.red===t.red&&e.green===t.green&&e.blue===t.blue&&e.alpha===t.alpha},Tp.equalsArray=function(e,t,r){return e.red===t[r]&&e.green===t[r+1]&&e.blue===t[r+2]&&e.alpha===t[r+3]},Tp.prototype.clone=function(e){return Tp.clone(this,e)},Tp.prototype.equals=function(e){return Tp.equals(this,e)},Tp.prototype.equalsEpsilon=function(e,t){return this===e||jt(e)&&Math.abs(this.red-e.red)<=t&&Math.abs(this.green-e.green)<=t&&Math.abs(this.blue-e.blue)<=t&&Math.abs(this.alpha-e.alpha)<=t},Tp.prototype.toString=function(){return"("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"},Tp.prototype.toCssColorString=function(){var e=Tp.floatToByte(this.red),t=Tp.floatToByte(this.green),r=Tp.floatToByte(this.blue);return 1===this.alpha?"rgb("+e+","+t+","+r+")":"rgba("+e+","+t+","+r+","+this.alpha+")"},Tp.prototype.toBytes=function(e){var t=Tp.floatToByte(this.red),r=Tp.floatToByte(this.green),n=Tp.floatToByte(this.blue),i=Tp.floatToByte(this.alpha);return jt(e)?(e[0]=t,e[1]=r,e[2]=n,e[3]=i,e):[t,r,n,i]},Tp.prototype.toRgba=function(){return Ep[0]=Tp.floatToByte(this.red),Ep[1]=Tp.floatToByte(this.green),Ep[2]=Tp.floatToByte(this.blue),Ep[3]=Tp.floatToByte(this.alpha),yp[0]},Tp.prototype.brighten=function(e,t){return qt.typeOf.number("magnitude",e),qt.typeOf.number.greaterThanOrEquals("magnitude",e,0),qt.typeOf.object("result",t),e=1-e,t.red=1-(1-this.red)*e,t.green=1-(1-this.green)*e,t.blue=1-(1-this.blue)*e,t.alpha=this.alpha,t},Tp.prototype.darken=function(e,t){return qt.typeOf.number("magnitude",e),qt.typeOf.number.greaterThanOrEquals("magnitude",e,0),qt.typeOf.object("result",t),e=1-e,t.red=this.red*e,t.green=this.green*e,t.blue=this.blue*e,t.alpha=this.alpha,t},Tp.prototype.withAlpha=function(e,t){return Tp.fromAlpha(this,e,t)},Tp.add=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.red=e.red+t.red,r.green=e.green+t.green,r.blue=e.blue+t.blue,r.alpha=e.alpha+t.alpha,r},Tp.subtract=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.red=e.red-t.red,r.green=e.green-t.green,r.blue=e.blue-t.blue,r.alpha=e.alpha-t.alpha,r},Tp.multiply=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.red=e.red*t.red,r.green=e.green*t.green,r.blue=e.blue*t.blue,r.alpha=e.alpha*t.alpha,r},Tp.divide=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.red=e.red/t.red,r.green=e.green/t.green,r.blue=e.blue/t.blue,r.alpha=e.alpha/t.alpha,r},Tp.mod=function(e,t,r){return qt.typeOf.object("left",e),qt.typeOf.object("right",t),qt.typeOf.object("result",r),r.red=e.red%t.red,r.green=e.green%t.green,r.blue=e.blue%t.blue,r.alpha=e.alpha%t.alpha,r},Tp.lerp=function(e,t,r,n){return qt.typeOf.object("start",e),qt.typeOf.object("end",t),qt.typeOf.number("t",r),qt.typeOf.object("result",n),n.red=Wt.lerp(e.red,t.red,r),n.green=Wt.lerp(e.green,t.green,r),n.blue=Wt.lerp(e.blue,t.blue,r),n.alpha=Wt.lerp(e.alpha,t.alpha,r),n},Tp.multiplyByScalar=function(e,t,r){return qt.typeOf.object("color",e),qt.typeOf.number("scalar",t),qt.typeOf.object("result",r),r.red=e.red*t,r.green=e.green*t,r.blue=e.blue*t,r.alpha=e.alpha*t,r},Tp.divideByScalar=function(e,t,r){return qt.typeOf.object("color",e),qt.typeOf.number("scalar",t),qt.typeOf.object("result",r),r.red=e.red/t,r.green=e.green/t,r.blue=e.blue/t,r.alpha=e.alpha/t,r},Tp.ALICEBLUE=Object.freeze(Tp.fromCssColorString("#F0F8FF")),Tp.ANTIQUEWHITE=Object.freeze(Tp.fromCssColorString("#FAEBD7")),Tp.AQUA=Object.freeze(Tp.fromCssColorString("#00FFFF")),Tp.AQUAMARINE=Object.freeze(Tp.fromCssColorString("#7FFFD4")),Tp.AZURE=Object.freeze(Tp.fromCssColorString("#F0FFFF")),Tp.BEIGE=Object.freeze(Tp.fromCssColorString("#F5F5DC")),Tp.BISQUE=Object.freeze(Tp.fromCssColorString("#FFE4C4")),Tp.BLACK=Object.freeze(Tp.fromCssColorString("#000000")),Tp.BLANCHEDALMOND=Object.freeze(Tp.fromCssColorString("#FFEBCD")),Tp.BLUE=Object.freeze(Tp.fromCssColorString("#0000FF")),Tp.BLUEVIOLET=Object.freeze(Tp.fromCssColorString("#8A2BE2")),Tp.BROWN=Object.freeze(Tp.fromCssColorString("#A52A2A")),Tp.BURLYWOOD=Object.freeze(Tp.fromCssColorString("#DEB887")),Tp.CADETBLUE=Object.freeze(Tp.fromCssColorString("#5F9EA0")),Tp.CHARTREUSE=Object.freeze(Tp.fromCssColorString("#7FFF00")),Tp.CHOCOLATE=Object.freeze(Tp.fromCssColorString("#D2691E")),Tp.CORAL=Object.freeze(Tp.fromCssColorString("#FF7F50")),Tp.CORNFLOWERBLUE=Object.freeze(Tp.fromCssColorString("#6495ED")),Tp.CORNSILK=Object.freeze(Tp.fromCssColorString("#FFF8DC")),Tp.CRIMSON=Object.freeze(Tp.fromCssColorString("#DC143C")),Tp.CYAN=Object.freeze(Tp.fromCssColorString("#00FFFF")),Tp.DARKBLUE=Object.freeze(Tp.fromCssColorString("#00008B")),Tp.DARKCYAN=Object.freeze(Tp.fromCssColorString("#008B8B")),Tp.DARKGOLDENROD=Object.freeze(Tp.fromCssColorString("#B8860B")),Tp.DARKGRAY=Object.freeze(Tp.fromCssColorString("#A9A9A9")),Tp.DARKGREEN=Object.freeze(Tp.fromCssColorString("#006400")),Tp.DARKGREY=Tp.DARKGRAY,Tp.DARKKHAKI=Object.freeze(Tp.fromCssColorString("#BDB76B")),Tp.DARKMAGENTA=Object.freeze(Tp.fromCssColorString("#8B008B")),Tp.DARKOLIVEGREEN=Object.freeze(Tp.fromCssColorString("#556B2F")),Tp.DARKORANGE=Object.freeze(Tp.fromCssColorString("#FF8C00")),Tp.DARKORCHID=Object.freeze(Tp.fromCssColorString("#9932CC")),Tp.DARKRED=Object.freeze(Tp.fromCssColorString("#8B0000")),Tp.DARKSALMON=Object.freeze(Tp.fromCssColorString("#E9967A")),Tp.DARKSEAGREEN=Object.freeze(Tp.fromCssColorString("#8FBC8F")),Tp.DARKSLATEBLUE=Object.freeze(Tp.fromCssColorString("#483D8B")),Tp.DARKSLATEGRAY=Object.freeze(Tp.fromCssColorString("#2F4F4F")),Tp.DARKSLATEGREY=Tp.DARKSLATEGRAY,Tp.DARKTURQUOISE=Object.freeze(Tp.fromCssColorString("#00CED1")),Tp.DARKVIOLET=Object.freeze(Tp.fromCssColorString("#9400D3")),Tp.DEEPPINK=Object.freeze(Tp.fromCssColorString("#FF1493")),Tp.DEEPSKYBLUE=Object.freeze(Tp.fromCssColorString("#00BFFF")),Tp.DIMGRAY=Object.freeze(Tp.fromCssColorString("#696969")),Tp.DIMGREY=Tp.DIMGRAY,Tp.DODGERBLUE=Object.freeze(Tp.fromCssColorString("#1E90FF")),Tp.FIREBRICK=Object.freeze(Tp.fromCssColorString("#B22222")),Tp.FLORALWHITE=Object.freeze(Tp.fromCssColorString("#FFFAF0")),Tp.FORESTGREEN=Object.freeze(Tp.fromCssColorString("#228B22")),Tp.FUCHSIA=Object.freeze(Tp.fromCssColorString("#FF00FF")),Tp.GAINSBORO=Object.freeze(Tp.fromCssColorString("#DCDCDC")),Tp.GHOSTWHITE=Object.freeze(Tp.fromCssColorString("#F8F8FF")),Tp.GOLD=Object.freeze(Tp.fromCssColorString("#FFD700")),Tp.GOLDENROD=Object.freeze(Tp.fromCssColorString("#DAA520")),Tp.GRAY=Object.freeze(Tp.fromCssColorString("#808080")),Tp.GREEN=Object.freeze(Tp.fromCssColorString("#008000")),Tp.GREENYELLOW=Object.freeze(Tp.fromCssColorString("#ADFF2F")),Tp.GREY=Tp.GRAY,Tp.HONEYDEW=Object.freeze(Tp.fromCssColorString("#F0FFF0")),Tp.HOTPINK=Object.freeze(Tp.fromCssColorString("#FF69B4")),Tp.INDIANRED=Object.freeze(Tp.fromCssColorString("#CD5C5C")),Tp.INDIGO=Object.freeze(Tp.fromCssColorString("#4B0082")),Tp.IVORY=Object.freeze(Tp.fromCssColorString("#FFFFF0")),Tp.KHAKI=Object.freeze(Tp.fromCssColorString("#F0E68C")),Tp.LAVENDER=Object.freeze(Tp.fromCssColorString("#E6E6FA")),Tp.LAVENDAR_BLUSH=Object.freeze(Tp.fromCssColorString("#FFF0F5")),Tp.LAWNGREEN=Object.freeze(Tp.fromCssColorString("#7CFC00")),Tp.LEMONCHIFFON=Object.freeze(Tp.fromCssColorString("#FFFACD")),Tp.LIGHTBLUE=Object.freeze(Tp.fromCssColorString("#ADD8E6")),Tp.LIGHTCORAL=Object.freeze(Tp.fromCssColorString("#F08080")),Tp.LIGHTCYAN=Object.freeze(Tp.fromCssColorString("#E0FFFF")),Tp.LIGHTGOLDENRODYELLOW=Object.freeze(Tp.fromCssColorString("#FAFAD2")),Tp.LIGHTGRAY=Object.freeze(Tp.fromCssColorString("#D3D3D3")),Tp.LIGHTGREEN=Object.freeze(Tp.fromCssColorString("#90EE90")),Tp.LIGHTGREY=Tp.LIGHTGRAY,Tp.LIGHTPINK=Object.freeze(Tp.fromCssColorString("#FFB6C1")),Tp.LIGHTSEAGREEN=Object.freeze(Tp.fromCssColorString("#20B2AA")),Tp.LIGHTSKYBLUE=Object.freeze(Tp.fromCssColorString("#87CEFA")),Tp.LIGHTSLATEGRAY=Object.freeze(Tp.fromCssColorString("#778899")),Tp.LIGHTSLATEGREY=Tp.LIGHTSLATEGRAY,Tp.LIGHTSTEELBLUE=Object.freeze(Tp.fromCssColorString("#B0C4DE")),Tp.LIGHTYELLOW=Object.freeze(Tp.fromCssColorString("#FFFFE0")),Tp.LIME=Object.freeze(Tp.fromCssColorString("#00FF00")),Tp.LIMEGREEN=Object.freeze(Tp.fromCssColorString("#32CD32")),Tp.LINEN=Object.freeze(Tp.fromCssColorString("#FAF0E6")),Tp.MAGENTA=Object.freeze(Tp.fromCssColorString("#FF00FF")),Tp.MAROON=Object.freeze(Tp.fromCssColorString("#800000")),Tp.MEDIUMAQUAMARINE=Object.freeze(Tp.fromCssColorString("#66CDAA")),Tp.MEDIUMBLUE=Object.freeze(Tp.fromCssColorString("#0000CD")),Tp.MEDIUMORCHID=Object.freeze(Tp.fromCssColorString("#BA55D3")),Tp.MEDIUMPURPLE=Object.freeze(Tp.fromCssColorString("#9370DB")),Tp.MEDIUMSEAGREEN=Object.freeze(Tp.fromCssColorString("#3CB371")),Tp.MEDIUMSLATEBLUE=Object.freeze(Tp.fromCssColorString("#7B68EE")),Tp.MEDIUMSPRINGGREEN=Object.freeze(Tp.fromCssColorString("#00FA9A")),Tp.MEDIUMTURQUOISE=Object.freeze(Tp.fromCssColorString("#48D1CC")),Tp.MEDIUMVIOLETRED=Object.freeze(Tp.fromCssColorString("#C71585")),Tp.MIDNIGHTBLUE=Object.freeze(Tp.fromCssColorString("#191970")),Tp.MINTCREAM=Object.freeze(Tp.fromCssColorString("#F5FFFA")),Tp.MISTYROSE=Object.freeze(Tp.fromCssColorString("#FFE4E1")),Tp.MOCCASIN=Object.freeze(Tp.fromCssColorString("#FFE4B5")),Tp.NAVAJOWHITE=Object.freeze(Tp.fromCssColorString("#FFDEAD")),Tp.NAVY=Object.freeze(Tp.fromCssColorString("#000080")),Tp.OLDLACE=Object.freeze(Tp.fromCssColorString("#FDF5E6")),Tp.OLIVE=Object.freeze(Tp.fromCssColorString("#808000")),Tp.OLIVEDRAB=Object.freeze(Tp.fromCssColorString("#6B8E23")),Tp.ORANGE=Object.freeze(Tp.fromCssColorString("#FFA500")),Tp.ORANGERED=Object.freeze(Tp.fromCssColorString("#FF4500")),Tp.ORCHID=Object.freeze(Tp.fromCssColorString("#DA70D6")),Tp.PALEGOLDENROD=Object.freeze(Tp.fromCssColorString("#EEE8AA")),Tp.PALEGREEN=Object.freeze(Tp.fromCssColorString("#98FB98")),Tp.PALETURQUOISE=Object.freeze(Tp.fromCssColorString("#AFEEEE")),Tp.PALEVIOLETRED=Object.freeze(Tp.fromCssColorString("#DB7093")),Tp.PAPAYAWHIP=Object.freeze(Tp.fromCssColorString("#FFEFD5")),Tp.PEACHPUFF=Object.freeze(Tp.fromCssColorString("#FFDAB9")),Tp.PERU=Object.freeze(Tp.fromCssColorString("#CD853F")),Tp.PINK=Object.freeze(Tp.fromCssColorString("#FFC0CB")),Tp.PLUM=Object.freeze(Tp.fromCssColorString("#DDA0DD")),Tp.POWDERBLUE=Object.freeze(Tp.fromCssColorString("#B0E0E6")),Tp.PURPLE=Object.freeze(Tp.fromCssColorString("#800080")),Tp.RED=Object.freeze(Tp.fromCssColorString("#FF0000")),Tp.ROSYBROWN=Object.freeze(Tp.fromCssColorString("#BC8F8F")),Tp.ROYALBLUE=Object.freeze(Tp.fromCssColorString("#4169E1")),Tp.SADDLEBROWN=Object.freeze(Tp.fromCssColorString("#8B4513")),Tp.SALMON=Object.freeze(Tp.fromCssColorString("#FA8072")),Tp.SANDYBROWN=Object.freeze(Tp.fromCssColorString("#F4A460")),Tp.SEAGREEN=Object.freeze(Tp.fromCssColorString("#2E8B57")),Tp.SEASHELL=Object.freeze(Tp.fromCssColorString("#FFF5EE")),Tp.SIENNA=Object.freeze(Tp.fromCssColorString("#A0522D")),Tp.SILVER=Object.freeze(Tp.fromCssColorString("#C0C0C0")),Tp.SKYBLUE=Object.freeze(Tp.fromCssColorString("#87CEEB")),Tp.SLATEBLUE=Object.freeze(Tp.fromCssColorString("#6A5ACD")),Tp.SLATEGRAY=Object.freeze(Tp.fromCssColorString("#708090")),Tp.SLATEGREY=Tp.SLATEGRAY,Tp.SNOW=Object.freeze(Tp.fromCssColorString("#FFFAFA")),Tp.SPRINGGREEN=Object.freeze(Tp.fromCssColorString("#00FF7F")),Tp.STEELBLUE=Object.freeze(Tp.fromCssColorString("#4682B4")),Tp.TAN=Object.freeze(Tp.fromCssColorString("#D2B48C")),Tp.TEAL=Object.freeze(Tp.fromCssColorString("#008080")),Tp.THISTLE=Object.freeze(Tp.fromCssColorString("#D8BFD8")),Tp.TOMATO=Object.freeze(Tp.fromCssColorString("#FF6347")),Tp.TURQUOISE=Object.freeze(Tp.fromCssColorString("#40E0D0")),Tp.VIOLET=Object.freeze(Tp.fromCssColorString("#EE82EE")),Tp.WHEAT=Object.freeze(Tp.fromCssColorString("#F5DEB3")),Tp.WHITE=Object.freeze(Tp.fromCssColorString("#FFFFFF")),Tp.WHITESMOKE=Object.freeze(Tp.fromCssColorString("#F5F5F5")),Tp.YELLOW=Object.freeze(Tp.fromCssColorString("#FFFF00")),Tp.YELLOWGREEN=Object.freeze(Tp.fromCssColorString("#9ACD32")),Tp.TRANSPARENT=Object.freeze(new Tp(0,0,0,0));var Sp={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:10,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_highpFloatSupported:!1,_highpIntSupported:!1,_uniformBufferOffsetAlignment:256,_maxUniformBufferBinding:36,_maxArrayTextureLayers:256,_disjointTimerQuery:!1};function Bp(e){if("object"!=typeof e||null===e)return e;for(var t,r=Object.keys(e),n=0;n<r.length;n++)t=r[n],e.hasOwnProperty(t)&&"_applyFunctions"!==t&&(e[t]=Bp(e[t]));return Object.freeze(e)}function Op(){this.reset()}Object.defineProperties(Sp,{maximumCombinedTextureImageUnits:{get:function(){return Sp._maximumCombinedTextureImageUnits}},maximumCubeMapSize:{get:function(){return Sp._maximumCubeMapSize}},maximumFragmentUniformVectors:{get:function(){return Sp._maximumFragmentUniformVectors}},maximumTextureImageUnits:{get:function(){return Sp._maximumTextureImageUnits}},maximumRenderbufferSize:{get:function(){return Sp._maximumRenderbufferSize}},maximumTextureSize:{get:function(){return Sp._maximumTextureSize}},maximumVaryingVectors:{get:function(){return Sp._maximumVaryingVectors}},maximumVertexAttributes:{get:function(){return Sp._maximumVertexAttributes}},maximumVertexTextureImageUnits:{get:function(){return Sp._maximumVertexTextureImageUnits}},maximumVertexUniformVectors:{get:function(){return Sp._maximumVertexUniformVectors}},minimumAliasedLineWidth:{get:function(){return Sp._minimumAliasedLineWidth}},maximumAliasedLineWidth:{get:function(){return Sp._maximumAliasedLineWidth}},minimumAliasedPointSize:{get:function(){return Sp._minimumAliasedPointSize}},maximumAliasedPointSize:{get:function(){return Sp._maximumAliasedPointSize}},maximumViewportWidth:{get:function(){return Sp._maximumViewportWidth}},maximumViewportHeight:{get:function(){return Sp._maximumViewportHeight}},maximumTextureFilterAnisotropy:{get:function(){return Sp._maximumTextureFilterAnisotropy}},maximumDrawBuffers:{get:function(){return Sp._maximumDrawBuffers}},maximumColorAttachments:{get:function(){return Sp._maximumColorAttachments}},highpFloatSupported:{get:function(){return Sp._highpFloatSupported}},highpIntSupported:{get:function(){return Sp._highpIntSupported}},uniformBufferOffsetAlignment:{get:function(){return Sp._uniformBufferOffsetAlignment}},maxUniformBufferBinding:{get:function(){return Sp._maxUniformBufferBinding}},maxArrayTextureLayers:{get:function(){return Sp._maxArrayTextureLayers}},disjointTimerQuery:{get:function(){return Sp._disjointTimerQuery}}}),Op.prototype.reset=function(){this.enabled=!1,this.mask=255,this.funcRef=1,this.funcMask=255,this.frontFunc=Op.ALWAYS,this.backFunc=Op.ALWAYS,this.frontOpStencilFail=Op.KEEP,this.backOpStencilFail=Op.KEEP,this.frontOpDepthFail=Op.KEEP,this.backOpDepthFail=Op.KEEP,this.frontOpStencilDepthPass=Op.REPLACE,this.backOpStencilDepthPass=Op.REPLACE},Object.defineProperty(Op.prototype,"frontStencilFunc",{get:function(){return this.frontFunc},set:function(e){this.frontFunc=e},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"backStencilFunc",{get:function(){return this.backFunc},set:function(e){this.backFunc=e},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"stencilFuncRef",{get:function(){return this.funcRef},set:function(e){this.funcRef=e},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"stencilFuncMask",{get:function(){return this.funcMask},set:function(e){this.funcMask=e},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"frontStencilOpStencilFail",{get:function(){return this.frontOpStencilFail},set:function(e){this.frontOpStencilFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"backStencilOpStencilFail",{get:function(){return this.backOpStencilFail},set:function(e){this.backOpStencilFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"frontStencilOpDepthFail",{get:function(){return this.frontOpDepthFail},set:function(e){this.frontOpDepthFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"backStencilOpDepthFail",{get:function(){return this.backOpDepthFail},set:function(e){this.backOpDepthFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"frontStencilOpStencilDepthPass",{get:function(){return this.frontOpStencilDepthPass},set:function(e){this.frontOpStencilDepthPass=e},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"backStencilOpStencilDepthPass",{get:function(){return this.backOpStencilDepthPass},set:function(e){this.backOpStencilDepthPass=e},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"stencilMask",{get:function(){return this.mask},set:function(e){this.mask=e},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"stencilTest",{get:function(){return this.enabled},set:function(e){this.enabled=e},enumerable:!1,configurable:!0}),Op.ALWAYS=cp.ALWAYS,Op.KEEP=cp.KEEP,Op.REPLACE=cp.REPLACE,Op.FRONT=cp.FRONT,Op.BACK=cp.BACK;var Dp={UNSIGNED_BYTE:Lc.UNSIGNED_BYTE,UNSIGNED_SHORT:Lc.UNSIGNED_SHORT,UNSIGNED_INT:Lc.UNSIGNED_INT,FLOAT:Lc.FLOAT,HALF_FLOAT:Lc.HALF_FLOAT_OES,UNSIGNED_INT_24_8:Lc.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:Lc.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:Lc.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:Lc.UNSIGNED_SHORT_5_6_5,isPacked:function(e){return e===Dp.UNSIGNED_INT_24_8||e===Dp.UNSIGNED_SHORT_4_4_4_4||e===Dp.UNSIGNED_SHORT_5_5_5_1||e===Dp.UNSIGNED_SHORT_5_6_5},sizeInBytes:function(e){switch(e){case Dp.UNSIGNED_BYTE:return 1;case Dp.UNSIGNED_SHORT:case Dp.UNSIGNED_SHORT_4_4_4_4:case Dp.UNSIGNED_SHORT_5_5_5_1:case Dp.UNSIGNED_SHORT_5_6_5:case Lc.HALF_FLOAT:case Lc.HALF_FLOAT_OES:return 2;case Dp.UNSIGNED_INT:case Dp.FLOAT:case Dp.UNSIGNED_INT_24_8:return 4}},validate:function(e){return e===Dp.UNSIGNED_BYTE||e===Dp.UNSIGNED_SHORT||e===Dp.UNSIGNED_INT||e===Dp.FLOAT||e===Lc.HALF_FLOAT||e===Lc.HALF_FLOAT_OES||e===Dp.UNSIGNED_INT_24_8||e===Dp.UNSIGNED_SHORT_4_4_4_4||e===Dp.UNSIGNED_SHORT_5_5_5_1||e===Dp.UNSIGNED_SHORT_5_6_5},toWebGLConstant:function(e,t){switch(e){case Dp.UNSIGNED_BYTE:return Lc.UNSIGNED_BYTE;case Dp.UNSIGNED_SHORT:return Lc.UNSIGNED_SHORT;case Dp.UNSIGNED_INT:return Lc.UNSIGNED_INT;case Dp.FLOAT:return Lc.FLOAT;case Dp.HALF_FLOAT:return t.webgl2?Lc.HALF_FLOAT:Lc.HALF_FLOAT_OES;case Dp.UNSIGNED_INT_24_8:return Lc.UNSIGNED_INT_24_8;case Dp.UNSIGNED_SHORT_4_4_4_4:return Lc.UNSIGNED_SHORT_4_4_4_4;case Dp.UNSIGNED_SHORT_5_5_5_1:return Lc.UNSIGNED_SHORT_5_5_5_1;case Dp.UNSIGNED_SHORT_5_6_5:return Dp.UNSIGNED_SHORT_5_6_5}}},Fp={DEPTH_COMPONENT:Lc.DEPTH_COMPONENT,DEPTH_COMPONENT16:Lc.DEPTH_COMPONENT16,DEPTH_COMPONENT32F:Lc.DEPTH_COMPONENT32F,DEPTH_STENCIL:Lc.DEPTH_STENCIL,ALPHA:Lc.ALPHA,RGB:Lc.RGB,RGBA:Lc.RGBA,LUMINANCE:Lc.LUMINANCE,LUMINANCE_ALPHA:Lc.LUMINANCE_ALPHA,RGB_DXT1:Lc.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:Lc.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:Lc.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:Lc.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:Lc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:Lc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:Lc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:Lc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGBA_ASTC:Lc.COMPRESSED_RGBA_ASTC_4x4_WEBGL,RGB_ETC1:Lc.COMPRESSED_RGB_ETC1_WEBGL,RED_INTEGER:Lc.RED_INTEGER,RED:Lc.RED,RGB8_ETC2:Lc.COMPRESSED_RGB8_ETC2,RGBA8_ETC2_EAC:Lc.COMPRESSED_RGBA8_ETC2_EAC,RGBA_BC7:Lc.COMPRESSED_RGBA_BPTC_UNORM,componentsLength:function(e){switch(e){case Fp.RGB:return 3;case Fp.RGBA:return 4;case Fp.LUMINANCE_ALPHA:return 2;case Fp.ALPHA:case Fp.LUMINANCE:case Fp.RED:case Fp.RED_INTEGER:default:return 1}},validate:function(e){return e===Fp.DEPTH_COMPONENT||e===Fp.DEPTH_COMPONENT16||e===Fp.DEPTH_COMPONENT32F||e===Fp.DEPTH_STENCIL||e===Fp.ALPHA||e===Fp.RED||e===Fp.RED_INTEGER||e===Fp.RGB||e===Fp.RGBA||e===Fp.LUMINANCE||e===Fp.LUMINANCE_ALPHA||e===Fp.RGB_DXT1||e===Fp.RGBA_DXT1||e===Fp.RGBA_DXT3||e===Fp.RGBA_DXT5||e===Fp.RGB_PVRTC_4BPPV1||e===Fp.RGB_PVRTC_2BPPV1||e===Fp.RGBA_PVRTC_4BPPV1||e===Fp.RGBA_PVRTC_2BPPV1||e===Fp.RGBA_ASTC||e===Fp.RGB_ETC1||e===Fp.RGB8_ETC2||e===Fp.RGBA8_ETC2_EAC||e===Fp.RGBA_BC7},isColorFormat:function(e){return e===Fp.ALPHA||e===Fp.RED||e===Fp.RED_INTEGER||e===Fp.RGB||e===Fp.RGBA||e===Fp.LUMINANCE||e===Fp.LUMINANCE_ALPHA},isDepthFormat:function(e){return e===Fp.DEPTH_COMPONENT||e===Fp.DEPTH_COMPONENT16||e===Fp.DEPTH_COMPONENT32F||e===Fp.DEPTH_STENCIL},isCompressedFormat:function(e){return e===Fp.RGB_DXT1||e===Fp.RGBA_DXT1||e===Fp.RGBA_DXT3||e===Fp.RGBA_DXT5||e===Fp.RGB_PVRTC_4BPPV1||e===Fp.RGB_PVRTC_2BPPV1||e===Fp.RGBA_PVRTC_4BPPV1||e===Fp.RGBA_PVRTC_2BPPV1||e===Fp.RGBA_ASTC||e===Fp.RGB_ETC1||e===Fp.RGB8_ETC2||e===Fp.RGBA8_ETC2_EAC||e===Fp.RGBA_BC7},isDXTFormat:function(e){return e===Fp.RGB_DXT1||e===Fp.RGBA_DXT1||e===Fp.RGBA_DXT3||e===Fp.RGBA_DXT5},isPVRTCFormat:function(e){return e===Fp.RGB_PVRTC_4BPPV1||e===Fp.RGB_PVRTC_2BPPV1||e===Fp.RGBA_PVRTC_4BPPV1||e===Fp.RGBA_PVRTC_2BPPV1},isETC1Format:function(e){return e===Fp.RGB_ETC1},compressedTextureSizeInBytes:function(e,t,r,n){var i=jt(n)?n:1;switch(e){case Fp.RGB_DXT1:case Fp.RGBA_DXT1:case Fp.RGB_ETC1:case Fp.RGB8_ETC2:return Math.floor((t+3)/4)*Math.floor((r+3)/4)*8*i;case Fp.RGBA_DXT3:case Fp.RGBA_DXT5:case Fp.RGBA_ASTC:case Fp.RGBA8_ETC2_EAC:return Math.floor((t+3)/4)*Math.floor((r+3)/4)*16*i;case Fp.RGB_PVRTC_4BPPV1:case Fp.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(r,8)*4+7)/8)*i;case Fp.RGB_PVRTC_2BPPV1:case Fp.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(r,8)*2+7)/8)*i;case Fp.RGBA_BC7:return Math.ceil(t/4)*Math.ceil(r/4)*16;default:return 0}},textureSizeInBytes:function(e,t,r,n,i){var o=jt(i)?i:1,s=Fp.componentsLength(e);return Dp.isPacked(t)&&(s=1),s*Dp.sizeInBytes(t)*r*n*o},alignmentInBytes:function(e,t,r){var n=Fp.textureSizeInBytes(e,t,r,1)%4;return 0===n?4:2===n?2:1},createTypedArray:function(e,t,r,n){var i=Dp.sizeInBytes(t);return new(i===Uint8Array.BYTES_PER_ELEMENT?Uint8Array:i===Uint16Array.BYTES_PER_ELEMENT?Uint16Array:i===Float32Array.BYTES_PER_ELEMENT&&t===Dp.FLOAT?Float32Array:Uint32Array)(Fp.componentsLength(e)*r*n)},flipY:function(e,t,r,n,i){if(1===i)return e;for(var o=Fp.createTypedArray(t,r,n,i),s=Fp.componentsLength(t),a=n*s,u=0;u<i;++u)for(var c=u*n*s,l=(i-u-1)*n*s,h=0;h<a;++h)o[l+h]=e[c+h];return o},RGBToRGBA:function(e,t,r,n){for(var i=Fp.createTypedArray(Fp.RGBA,t,r,n),o=e.length/3,s=0;s<o;s++)i[4*s]=e[3*s],i[4*s+1]=e[3*s+1],i[4*s+2]=e[3*s+2];return i},LUMINANCE_ALPHAToRGBA:function(e,t,r,n){for(var i=Fp.createTypedArray(Fp.RGBA,t,r,n),o=e.length/2,s=0;s<o;s++)i[4*s]=e[2*s],i[4*s+1]=0,i[4*s+2]=0,i[4*s+3]=e[2*s+1];return i},toInternalFormat:function(e,t,r){if(!r.webgl2)return e;if(e===Fp.DEPTH_STENCIL)return Lc.DEPTH24_STENCIL8;if(e===Fp.DEPTH_COMPONENT){if(t===Dp.UNSIGNED_SHORT)return Lc.DEPTH_COMPONENT16;if(t===Dp.UNSIGNED_INT)return Lc.DEPTH_COMPONENT24;if(t===Dp.FLOAT)return Lc.DEPTH_COMPONENT32F}if(e===Fp.DEPTH_COMPONENT16)return Lc.DEPTH_COMPONENT16;if(e===Fp.DEPTH_COMPONENT32F)return Lc.DEPTH_COMPONENT32F;if(t===Dp.UNSIGNED_BYTE)switch(e){case Fp.RGBA:return Lc.RGBA8;case Fp.RGB:return Lc.RGB8;case Fp.RED:return Lc.R8}if(t===Dp.FLOAT)switch(e){case Fp.RGBA:return Lc.RGBA32F;case Fp.RGB:return Lc.RGB32F;case Fp.RG:return Lc.RG32F;case Fp.RED:return Lc.R32F}if(t===Dp.HALF_FLOAT)switch(e){case Fp.RGBA:return Lc.RGBA16F;case Fp.RGB:return Lc.RGB16F;case Fp.RG:return Lc.RG16F;case Fp.RED:return Lc.R16F}return e}},Pp=Object.freeze(Fp),Np={CLAMP_TO_EDGE:Lc.CLAMP_TO_EDGE,REPEAT:Lc.REPEAT,MIRRORED_REPEAT:Lc.MIRRORED_REPEAT,validate:function(e){return e===Np.CLAMP_TO_EDGE||e===Np.REPEAT||e===Np.MIRRORED_REPEAT}},Lp=Object.freeze(Np),Up={NEAREST:Lc.NEAREST,LINEAR:Lc.LINEAR,validate:function(e){return e===Up.NEAREST||e===Up.LINEAR}},Gp=Object.freeze(Up),Qp={NEAREST:Lc.NEAREST,LINEAR:Lc.LINEAR,NEAREST_MIPMAP_NEAREST:Lc.NEAREST_MIPMAP_NEAREST,LINEAR_MIPMAP_NEAREST:Lc.LINEAR_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:Lc.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_LINEAR:Lc.LINEAR_MIPMAP_LINEAR,validate:function(e){return e===Qp.NEAREST||e===Qp.LINEAR||e===Qp.NEAREST_MIPMAP_NEAREST||e===Qp.LINEAR_MIPMAP_NEAREST||e===Qp.NEAREST_MIPMAP_LINEAR||e===Qp.LINEAR_MIPMAP_LINEAR}},kp=Object.freeze(Qp);function zp(){}function jp(){}zp.toPixelFormat=function(e){switch(e){case Pp.RED:return cp.TEXTUREFORMAT_RED;case Pp.RED_INTEGER:return cp.TEXTUREFORMAT_RED_INTEGER;case Pp.RGB:return cp.TEXTUREFORMAT_RGB;case Pp.RGBA:return cp.TEXTUREFORMAT_RGBA;case Pp.LUMINANCE_ALPHA:return cp.TEXTUREFORMAT_LUMINANCE_ALPHA;case Pp.ALPHA:return cp.TEXTUREFORMAT_ALPHA;case Pp.LUMINANCE:return cp.TEXTUREFORMAT_LUMINANCE;case Pp.DEPTH_COMPONENT16:return cp.TEXTUREFORMAT_DEPTH16;case Pp.DEPTH_COMPONENT:return cp.TEXTUREFORMAT_DEPTH24;case Pp.DEPTH_COMPONENT32F:return cp.TEXTUREFORMAT_DEPTH32_FLOAT;case Pp.DEPTH_STENCIL:return cp.TEXTUREFORMAT_DEPTH24_STENCIL8;case Pp.RGBA_DXT1:return cp.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1;case Pp.RGBA_DXT3:return cp.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3;case Pp.RGBA_DXT5:return cp.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5;case Pp.RGB_DXT1:return cp.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1;case Pp.RGBA_PVRTC_2BPPV1:case Pp.RGBA_PVRTC_4BPPV1:case Pp.RGB_ETC1:case Pp.RGB_PVRTC_2BPPV1:case Pp.RGB_PVRTC_4BPPV1:default:return 1}},zp.toPixelType=function(e){switch(e){case Dp.FLOAT:return cp.TEXTURETYPE_FLOAT;case Dp.HALF_FLOAT:return cp.TEXTURETYPE_HALF_FLOAT;case Dp.UNSIGNED_BYTE:return cp.TEXTURETYPE_UNSIGNED_BYTE;case Dp.UNSIGNED_INT:return cp.TEXTURETYPE_UNSIGNED_INT;case Dp.UNSIGNED_INT_24_8:return cp.TEXTURETYPE_UNSIGNED_INT_24_8;case Dp.UNSIGNED_SHORT:return cp.TEXTURETYPE_UNSIGNED_SHORT;case Dp.UNSIGNED_SHORT_4_4_4_4:return cp.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4;case Dp.UNSIGNED_SHORT_5_5_5_1:return cp.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1;case Dp.UNSIGNED_SHORT_5_6_5:return cp.TEXTURETYPE_UNSIGNED_SHORT_5_6_5;default:return cp.TEXTURETYPE_UNDEFINED}},zp.toSamplerMode=function(e,t){var r=e==Dp.FLOAT||e==Dp.HALF_FLOAT;if(t.magnificationFilter==Gp.NEAREST){if(t.minificationFilter==kp.NEAREST)return cp.TEXTURE_NEAREST_SAMPLINGMODE;if(t.minificationFilter==kp.LINEAR)return cp.TEXTURE_NEAREST_SAMPLINGMODE;if(t.minificationFilter==kp.NEAREST_MIPMAP_NEAREST)return cp.TEXTURE_NEAREST_SAMPLINGMODE;if(t.minificationFilter==kp.LINEAR_MIPMAP_NEAREST)return cp.TEXTURE_NEAREST_SAMPLINGMODE}else{if(t.magnificationFilter!=Gp.LINEAR)return console.log("EnumConvertor.toSamplerMode unsupported type"),cp.TEXTURE_NEAREST_SAMPLINGMODE;if(t.minificationFilter==kp.NEAREST)return r?cp.TEXTURE_NEAREST_SAMPLINGMODE:cp.TEXTURE_BILINEAR_SAMPLINGMODE;if(t.minificationFilter==kp.LINEAR)return r?cp.TEXTURE_NEAREST_SAMPLINGMODE:cp.TEXTURE_BILINEAR_SAMPLINGMODE;if(t.minificationFilter==kp.NEAREST_MIPMAP_NEAREST)return r?cp.TEXTURE_NEAREST_SAMPLINGMODE:cp.TEXTURE_BILINEAR_SAMPLINGMODE;if(t.minificationFilter==kp.LINEAR_MIPMAP_NEAREST)return r?cp.TEXTURE_NEAREST_SAMPLINGMODE:cp.TEXTURE_BILINEAR_SAMPLINGMODE;if(t.minificationFilter==kp.LINEAR_MIPMAP_LINEAR)return r?cp.TEXTURE_NEAREST_SAMPLINGMODE:cp.TEXTURE_LINEAR_LINEAR_MIPLINEAR}},zp.toAddressMode=function(e){switch(e){case Lp.CLAMP_TO_EDGE:return cp.TEXTURE_CLAMP_ADDRESSMODE;case Lp.REPEAT:return cp.TEXTURE_WRAP_ADDRESSMODE;case Lp.MIRRORED_REPEAT:return cp.TEXTURE_MIRROR_ADDRESSMODE;default:return cp.TEXTURE_CLAMP_ADDRESSMODE}},zp.toFillMode=function(e){switch(e){case Jc.TRIANGLES:return cp.MATERIAL_TriangleFillMode;case Jc.POINTS:return cp.MATERIAL_PointFillMode;case Jc.LINES:return cp.MATERIAL_WireFrameFillMode;case Jc.LINE_STRIP:return cp.MATERIAL_LineStripDrawMode;default:return console.log("EnumConvertor.toFillMode unsupported type"),cp.MATERIAL_TriangleFillMode}},zp.toCullFace=function(e){switch(e){case Lc.FRONT:return 2;case Lc.BACK:default:return 1}},zp.toFrontFace=function(e,t){switch(e){case Lc.CCW:return t?2:1;case Lc.CW:return t?1:2;default:return 1}},zp.toVertexBufferDataType=function(e){switch(e){case Gc.BYTE:return pp.BYTE;case Gc.UNSIGNED_BYTE:return pp.UNSIGNED_BYTE;case Gc.SHORT:return pp.SHORT;case Gc.UNSIGNED_SHORT:return pp.UNSIGNED_SHORT;case Gc.INT:return pp.INT;case Gc.UNSIGNED_INT:return pp.UNSIGNED_INT;case Gc.FLOAT:return pp.FLOAT;default:throw console.log("EnumConvertor.toVertexBufferDataType unsupported type"),new Ht("componentDatatype is not a valid value.")}},jp.applyFrontFace=function(e,t,r){e._depthCullingState.frontFace=zp.toFrontFace(t.frontFace,r)},jp.applyCull=function(e,t){var r=t.cull;r.enabled?(e._depthCullingState.cull=!0,e._depthCullingState.cullFace=zp.toCullFace(r.face)):(e._depthCullingState.cull=!1,e._depthCullingState.cullFace=0)},jp.applyLineWidth=function(e,t){},jp.applyPolygonOffset=function(e,t){var r=t.polygonOffset;r.enabled?(e.setZOffset(r.factor),e.setZOffsetUnits(r.units)):(e.setZOffset(0),e.setZOffsetUnits(0))},jp.applyScissorTest=function(e,t,r){var n=t.scissorTest;if(jt(r.scissorTest)?r.scissorTest.enabled:n.enabled){var i=jt(r.scissorTest)?r.scissorTest.rectangle:n.rectangle;e.enableScissor(i.x,i.y,i.width,i.height)}else e.disableScissor()},jp.applyDepthRange=function(e,t){},jp.applyDepthTest=function(e,t){var r=t.depthTest,n=r.enabled;e.setDepthBuffer(n),n&&e.setDepthFunction(r.func)},jp.applyColorMask=function(e,t){var r=t.colorMask;e.setColorWrite(r.red)},jp.applyDepthMask=function(e,t){e.setDepthWrite(t.depthMask)},jp.applyStencilMask=function(e,t){var r=t.stencilMask;r<0&&(r=255),e.setStencilMask(r)},jp.applyBlendingColor=function(e,t){e.setAlphaConstants(t.red,t.green,t.blue,t.alpha)},jp.applyBlending=function(e,t,r){var n=t.blending;(jt(r.blendingEnabled)?r.blendingEnabled:n.enabled)?(jp.applyBlendingColor(e,n.color),e._alphaState.setAlphaEquationParameters(n.equationRgb,n.equationAlpha),e._alphaState.setAlphaBlendFunctionParameters(n.functionSourceRgb,n.functionDestinationRgb,n.functionSourceAlpha,n.functionDestinationAlpha),e._alphaState.alphaBlend=!0):e.setAlphaMode(cp.ALPHA_DISABLE)},jp.applyStencilTest=function(e,t){var r=t.stencilTest,n=r.enabled;if(e.setStencilBuffer(n),n){var i=r.frontFunction,o=r.backFunction,s=r.reference,a=r.mask;e.setStencilFunction(Op.FRONT,i);var u=r.frontOperation;e.setStencilOperationFail(Op.FRONT,u.fail),e.setStencilOperationDepthFail(Op.FRONT,u.zFail),e.setStencilOperationPass(Op.FRONT,u.zPass),e.setStencilFunction(Op.BACK,o);var c=r.backOperation;e.setStencilOperationFail(Op.BACK,c.fail),e.setStencilOperationDepthFail(Op.BACK,c.zFail),e.setStencilOperationPass(Op.BACK,c.zPass),e.setStencilFunctionReference(s),e.setStencilFunctionMask(a)}},jp.applySampleCoverage=function(e,t){};var Hp=new _p;function qp(){}function Vp(e,t,r){r?e.enable(t):e.disable(t)}jp.applyViewport=function(e,t,r,n,i){var o=Yt(t.viewport,r.viewport);jt(o)||((o=Hp).width=r.context.drawingBufferWidth,o.height=r.context.drawingBufferHeight);var s=Yt(n,r.context.drawingBufferWidth),a=Yt(i,r.context.drawingBufferHeight);r.context.uniformState.viewport=o;var u={x:o.x/s,y:o.y/a,width:o.width/s,height:o.height/a};e.setViewport(u,n,i)},qp.applyFrontFace=function(e,t,r){e.frontFace(t.frontFace)},qp.applyCull=function(e,t){var r=t.cull,n=r.enabled;Vp(e,e.CULL_FACE,n),n&&e.cullFace(r.face)},qp.applyLineWidth=function(e,t){e.lineWidth(t.lineWidth)},qp.applyPolygonOffset=function(e,t){var r=t.polygonOffset,n=r.enabled;Vp(e,e.POLYGON_OFFSET_FILL,n),n&&e.polygonOffset(r.factor,r.units)},qp.applyScissorTest=function(e,t,r){var n=t.scissorTest,i=jt(r.scissorTest)?r.scissorTest.enabled:n.enabled;if(Vp(e,e.SCISSOR_TEST,i),i){var o=jt(r.scissorTest)?r.scissorTest.rectangle:n.rectangle;e.scissor(o.x,o.y,o.width,o.height)}},qp.applyDepthRange=function(e,t){var r=t.depthRange;e.depthRange(r.near,r.far)},qp.applyDepthTest=function(e,t){var r=t.depthTest,n=r.enabled;Vp(e,e.DEPTH_TEST,n),n&&e.depthFunc(r.func)},qp.applyColorMask=function(e,t){var r=t.colorMask;e.colorMask(r.red,r.green,r.blue,r.alpha)},qp.applyDepthMask=function(e,t){e.depthMask(t.depthMask)},qp.applyStencilMask=function(e,t){e.stencilMask(t.stencilMask)},qp.applyBlendingColor=function(e,t){e.blendColor(t.red,t.green,t.blue,t.alpha)},qp.applyBlending=function(e,t,r){var n=t.blending,i=jt(r.blendingEnabled)?r.blendingEnabled:n.enabled;Vp(e,e.BLEND,i),i&&(qp.applyBlendingColor(e,n.color),e.blendEquationSeparate(n.equationRgb,n.equationAlpha),e.blendFuncSeparate(n.functionSourceRgb,n.functionDestinationRgb,n.functionSourceAlpha,n.functionDestinationAlpha))},qp.applyStencilTest=function(e,t){var r=t.stencilTest,n=r.enabled;if(Vp(e,e.STENCIL_TEST,n),n){var i=r.frontFunction,o=r.backFunction,s=r.reference,a=r.mask;e.stencilFunc(i,s,a),e.stencilFuncSeparate(e.BACK,o,s,a),e.stencilFuncSeparate(e.FRONT,i,s,a);var u=r.frontOperation,c=u.fail,l=u.zFail,h=u.zPass;e.stencilOpSeparate(e.FRONT,c,l,h);var p=r.backOperation,d=p.fail,f=p.zFail,A=p.zPass;e.stencilOpSeparate(e.BACK,d,f,A)}},qp.applySampleCoverage=function(e,t){var r=t.sampleCoverage,n=r.enabled;Vp(e,e.SAMPLE_COVERAGE,n),n&&e.sampleCoverage(r.value,r.invert)};var Yp=new _p;function Xp(e){return e===Lc.FUNC_ADD||e===Lc.FUNC_SUBTRACT||e===Lc.FUNC_REVERSE_SUBTRACT||e===Lc.MIN||e===Lc.MAX}function Wp(e){return e===Lc.ZERO||e===Lc.ONE||e===Lc.SRC_COLOR||e===Lc.ONE_MINUS_SRC_COLOR||e===Lc.DST_COLOR||e===Lc.ONE_MINUS_DST_COLOR||e===Lc.SRC_ALPHA||e===Lc.ONE_MINUS_SRC_ALPHA||e===Lc.DST_ALPHA||e===Lc.ONE_MINUS_DST_ALPHA||e===Lc.CONSTANT_COLOR||e===Lc.ONE_MINUS_CONSTANT_COLOR||e===Lc.CONSTANT_ALPHA||e===Lc.ONE_MINUS_CONSTANT_ALPHA||e===Lc.SRC_ALPHA_SATURATE}function Kp(e){return e===Lc.NEVER||e===Lc.LESS||e===Lc.EQUAL||e===Lc.LEQUAL||e===Lc.GREATER||e===Lc.NOTEQUAL||e===Lc.GEQUAL||e===Lc.ALWAYS}function Jp(e){return e===Lc.ZERO||e===Lc.KEEP||e===Lc.REPLACE||e===Lc.INCR||e===Lc.DECR||e===Lc.INVERT||e===Lc.INCR_WRAP||e===Lc.DECR_WRAP}function Zp(e){var t,r,n=Yt(e,{}),i=Yt(n.cull,{}),o=Yt(n.polygonOffset,{}),s=Yt(n.scissorTest,{}),a=Yt(s.rectangle,{}),u=Yt(n.depthRange,{}),c=Yt(n.depthTest,{}),l=Yt(n.colorMask,{}),h=Yt(n.blending,{}),p=Yt(h.color,{}),d=Yt(n.stencilTest,{}),f=Yt(d.frontOperation,{}),A=Yt(d.backOperation,{}),g=Yt(n.sampleCoverage,{}),_=n.viewport;if(this.frontFace=Yt(n.frontFace,$c.COUNTER_CLOCKWISE),this.cull={enabled:Yt(i.enabled,!1),face:Yt(i.face,Lc.BACK)},this.lineWidth=Yt(n.lineWidth,1),this.polygonOffset={enabled:Yt(o.enabled,!1),factor:Yt(o.factor,0),units:Yt(o.units,0)},this.scissorTest={enabled:Yt(s.enabled,!1),rectangle:_p.clone(a)},this.depthRange={near:Yt(u.near,0),far:Yt(u.far,1)},this.depthTest={enabled:Yt(c.enabled,!1),func:Yt(c.func,Lc.LESS)},this.colorMask={red:Yt(l.red,!0),green:Yt(l.green,!0),blue:Yt(l.blue,!0),alpha:Yt(l.alpha,!0)},this.depthMask=Yt(n.depthMask,!0),this.stencilMask=Yt(n.stencilMask,65535),this.blending={enabled:Yt(h.enabled,!1),color:new Tp(Yt(p.red,0),Yt(p.green,0),Yt(p.blue,0),Yt(p.alpha,0)),equationRgb:Yt(h.equationRgb,Lc.FUNC_ADD),equationAlpha:Yt(h.equationAlpha,Lc.FUNC_ADD),functionSourceRgb:Yt(h.functionSourceRgb,Lc.ONE),functionSourceAlpha:Yt(h.functionSourceAlpha,Lc.ONE),functionDestinationRgb:Yt(h.functionDestinationRgb,Lc.ZERO),functionDestinationAlpha:Yt(h.functionDestinationAlpha,Lc.ZERO)},this.stencilTest={enabled:Yt(d.enabled,!1),frontFunction:Yt(d.frontFunction,Lc.ALWAYS),backFunction:Yt(d.backFunction,Lc.ALWAYS),reference:Yt(d.reference,0),mask:Yt(d.mask,65535),frontOperation:{fail:Yt(f.fail,Lc.KEEP),zFail:Yt(f.zFail,Lc.KEEP),zPass:Yt(f.zPass,Lc.KEEP)},backOperation:{fail:Yt(A.fail,Lc.KEEP),zFail:Yt(A.zFail,Lc.KEEP),zPass:Yt(A.zPass,Lc.KEEP)}},this.sampleCoverage={enabled:Yt(g.enabled,!1),value:Yt(g.value,1),invert:Yt(g.invert,!1)},this.viewport=jt(_)?new _p(_.x,_.y,_.width,_.height):void 0,this.lineWidth<Sp.minimumAliasedLineWidth||this.lineWidth>Sp.maximumAliasedLineWidth)throw new Ht("renderState.lineWidth is out of range.  Check minimumAliasedLineWidth and maximumAliasedLineWidth.");if(!$c.validate(this.frontFace))throw new Ht("Invalid renderState.frontFace.");if((t=this.cull.face)!==Lc.FRONT&&t!==Lc.BACK&&t!==Lc.FRONT_AND_BACK)throw new Ht("Invalid renderState.cull.face.");if(this.scissorTest.rectangle.width<0||this.scissorTest.rectangle.height<0)throw new Ht("renderState.scissorTest.rectangle.width and renderState.scissorTest.rectangle.height must be greater than or equal to zero.");if(this.depthRange.near>this.depthRange.far)throw new Ht("renderState.depthRange.near can not be greater than renderState.depthRange.far.");if(this.depthRange.near<0)throw new Ht("renderState.depthRange.near must be greater than or equal to zero.");if(this.depthRange.far>1)throw new Ht("renderState.depthRange.far must be less than or equal to one.");if((r=this.depthTest.func)!==Lc.NEVER&&r!==Lc.LESS&&r!==Lc.EQUAL&&r!==Lc.LEQUAL&&r!==Lc.GREATER&&r!==Lc.NOTEQUAL&&r!==Lc.GEQUAL&&r!==Lc.ALWAYS)throw new Ht("Invalid renderState.depthTest.func.");if(this.blending.color.red<0||this.blending.color.red>1||this.blending.color.green<0||this.blending.color.green>1||this.blending.color.blue<0||this.blending.color.blue>1||this.blending.color.alpha<0||this.blending.color.alpha>1)throw new Ht("renderState.blending.color components must be greater than or equal to zero and less than or equal to one.");if(!Xp(this.blending.equationRgb))throw new Ht("Invalid renderState.blending.equationRgb.");if(!Xp(this.blending.equationAlpha))throw new Ht("Invalid renderState.blending.equationAlpha.");if(!Wp(this.blending.functionSourceRgb))throw new Ht("Invalid renderState.blending.functionSourceRgb.");if(!Wp(this.blending.functionSourceAlpha))throw new Ht("Invalid renderState.blending.functionSourceAlpha.");if(!Wp(this.blending.functionDestinationRgb))throw new Ht("Invalid renderState.blending.functionDestinationRgb.");if(!Wp(this.blending.functionDestinationAlpha))throw new Ht("Invalid renderState.blending.functionDestinationAlpha.");if(!Kp(this.stencilTest.frontFunction))throw new Ht("Invalid renderState.stencilTest.frontFunction.");if(!Kp(this.stencilTest.backFunction))throw new Ht("Invalid renderState.stencilTest.backFunction.");if(!Jp(this.stencilTest.frontOperation.fail))throw new Ht("Invalid renderState.stencilTest.frontOperation.fail.");if(!Jp(this.stencilTest.frontOperation.zFail))throw new Ht("Invalid renderState.stencilTest.frontOperation.zFail.");if(!Jp(this.stencilTest.frontOperation.zPass))throw new Ht("Invalid renderState.stencilTest.frontOperation.zPass.");if(!Jp(this.stencilTest.backOperation.fail))throw new Ht("Invalid renderState.stencilTest.backOperation.fail.");if(!Jp(this.stencilTest.backOperation.zFail))throw new Ht("Invalid renderState.stencilTest.backOperation.zFail.");if(!Jp(this.stencilTest.backOperation.zPass))throw new Ht("Invalid renderState.stencilTest.backOperation.zPass.");if(jt(this.viewport)){if(this.viewport.width<0)throw new Ht("renderState.viewport.width must be greater than or equal to zero.");if(this.viewport.height<0)throw new Ht("renderState.viewport.height must be greater than or equal to zero.");if(this.viewport.width>Sp.maximumViewportWidth)throw new Ht("renderState.viewport.width must be less than or equal to the maximum viewport width ("+Sp.maximumViewportWidth.toString()+").  Check maximumViewportWidth.");if(this.viewport.height>Sp.maximumViewportHeight)throw new Ht("renderState.viewport.height must be less than or equal to the maximum viewport height ("+Sp.maximumViewportHeight.toString()+").  Check maximumViewportHeight.")}this.id=0,this._applyFunctions=[]}qp.applyViewport=function(e,t,r,n,i){var o=Yt(t.viewport,r.viewport);jt(o)||((o=Yp).width=r.context.drawingBufferWidth,o.height=r.context.drawingBufferHeight),r.context.uniformState.viewport=o,e.viewport(o.x,o.y,o.width,o.height)};var $p=0,ed={};function td(e,t,r){(e?jp:qp).applyFrontFace(t,r)}function rd(e,t,r){(e?jp:qp).applyCull(t,r)}function nd(e,t,r){(e?jp:qp).applyLineWidth(t,r)}function id(e,t,r){(e?jp:qp).applyPolygonOffset(t,r)}function od(e,t,r){(e?jp:qp).applyDepthRange(t,r)}function sd(e,t,r){(e?jp:qp).applyDepthTest(t,r)}function ad(e,t,r){(e?jp:qp).applyColorMask(t,r)}function ud(e,t,r){(e?jp:qp).applyDepthMask(t,r)}function cd(e,t,r){(e?jp:qp).applyStencilMask(t,r)}function ld(e,t,r){(e?jp:qp).applyStencilTest(t,r)}function hd(e,t,r){(e?jp:qp).applySampleCoverage(t,r)}Zp.fromCache=function(e){var t=JSON.stringify(e),r=ed[t];if(jt(r))return++r.referenceCount,r.state;var n=new Zp(e),i=JSON.stringify(n);return jt(r=ed[i])||(n.id=$p++,r={referenceCount:0,state:n=Bp(n)},ed[i]=r),++r.referenceCount,ed[t]={referenceCount:1,state:r.state},r.state},Zp.removeFromCache=function(e){var t=new Zp(e),r=JSON.stringify(t),n=ed[r],i=JSON.stringify(e),o=ed[i];jt(o)&&(--o.referenceCount,0===o.referenceCount&&(delete ed[i],jt(n)&&--n.referenceCount)),jt(n)&&0===n.referenceCount&&delete ed[r]},Zp.getCache=function(){return ed},Zp.clearCache=function(){ed={}},Zp.apply=function(e,t,r){const n=jt(e.name)?jp:qp;n.applyFrontFace(e,t),n.applyCull(e,t),n.applyLineWidth(e,t),n.applyPolygonOffset(e,t),n.applyDepthRange(e,t),n.applyDepthTest(e,t),n.applyColorMask(e,t),n.applyDepthMask(e,t),n.applyStencilMask(e,t),n.applyStencilTest(e,t),n.applySampleCoverage(e,t),n.applyScissorTest(e,t,r),n.applyBlending(e,t,r),n.applyViewport(e,t,r)},Zp.partialApply=function(e,t,r,n,i,o,s,a,u,c,l){const h=jt(e.name),p=h?jp:qp;if(t!==r){var d=r._applyFunctions[t.id];jt(d)||(d=function(e,t){var r=[];return e.frontFace!==t.frontFace&&r.push(td),e.cull.enabled===t.cull.enabled&&e.cull.face===t.cull.face||r.push(rd),e.lineWidth!==t.lineWidth&&r.push(nd),e.polygonOffset.enabled===t.polygonOffset.enabled&&e.polygonOffset.factor===t.polygonOffset.factor&&e.polygonOffset.units===t.polygonOffset.units||r.push(id),e.depthRange.near===t.depthRange.near&&e.depthRange.far===t.depthRange.far||r.push(od),e.depthTest.enabled===t.depthTest.enabled&&e.depthTest.func===t.depthTest.func||r.push(sd),e.colorMask.red===t.colorMask.red&&e.colorMask.green===t.colorMask.green&&e.colorMask.blue===t.colorMask.blue&&e.colorMask.alpha===t.colorMask.alpha||r.push(ad),e.depthMask!==t.depthMask&&r.push(ud),e.stencilMask!==t.stencilMask&&r.push(cd),e.stencilTest.enabled===t.stencilTest.enabled&&e.stencilTest.frontFunction===t.stencilTest.frontFunction&&e.stencilTest.backFunction===t.stencilTest.backFunction&&e.stencilTest.reference===t.stencilTest.reference&&e.stencilTest.mask===t.stencilTest.mask&&e.stencilTest.frontOperation.fail===t.stencilTest.frontOperation.fail&&e.stencilTest.frontOperation.zFail===t.stencilTest.frontOperation.zFail&&e.stencilTest.backOperation.fail===t.stencilTest.backOperation.fail&&e.stencilTest.backOperation.zFail===t.stencilTest.backOperation.zFail&&e.stencilTest.backOperation.zPass===t.stencilTest.backOperation.zPass||r.push(ld),e.sampleCoverage.enabled===t.sampleCoverage.enabled&&e.sampleCoverage.value===t.sampleCoverage.value&&e.sampleCoverage.invert===t.sampleCoverage.invert||r.push(hd),r}(t,r),r._applyFunctions[t.id]=d);for(var f=d.length,A=0;A<f;++A)d[A](h,e,r)}((jt(n.scissorTest)?n.scissorTest:t.scissorTest)!==(jt(i.scissorTest)?i.scissorTest:r.scissorTest)||a)&&p.applyScissorTest(e,r,i);var g=jt(n.blendingEnabled)?n.blendingEnabled:t.blending.enabled,_=jt(i.blendingEnabled)?i.blendingEnabled:r.blending.enabled;(g!==_||_&&t.blending!==r.blending)&&p.applyBlending(e,r,i),t===r&&n===i&&n.context===i.context&&o===s||p.applyViewport(e,r,i,u,c)},Zp.getState=function(e){if(!jt(e))throw new Ht("renderState is required.");return{frontFace:e.frontFace,cull:{enabled:e.cull.enabled,face:e.cull.face},lineWidth:e.lineWidth,polygonOffset:{enabled:e.polygonOffset.enabled,factor:e.polygonOffset.factor,units:e.polygonOffset.units},scissorTest:{enabled:e.scissorTest.enabled,rectangle:_p.clone(e.scissorTest.rectangle)},depthRange:{near:e.depthRange.near,far:e.depthRange.far},depthTest:{enabled:e.depthTest.enabled,func:e.depthTest.func},colorMask:{red:e.colorMask.red,green:e.colorMask.green,blue:e.colorMask.blue,alpha:e.colorMask.alpha},depthMask:e.depthMask,stencilMask:e.stencilMask,blending:{enabled:e.blending.enabled,color:Tp.clone(e.blending.color),equationRgb:e.blending.equationRgb,equationAlpha:e.blending.equationAlpha,functionSourceRgb:e.blending.functionSourceRgb,functionSourceAlpha:e.blending.functionSourceAlpha,functionDestinationRgb:e.blending.functionDestinationRgb,functionDestinationAlpha:e.blending.functionDestinationAlpha},stencilTest:{enabled:e.stencilTest.enabled,frontFunction:e.stencilTest.frontFunction,backFunction:e.stencilTest.backFunction,reference:e.stencilTest.reference,mask:e.stencilTest.mask,frontOperation:{fail:e.stencilTest.frontOperation.fail,zFail:e.stencilTest.frontOperation.zFail,zPass:e.stencilTest.frontOperation.zPass},backOperation:{fail:e.stencilTest.backOperation.fail,zFail:e.stencilTest.backOperation.zFail,zPass:e.stencilTest.backOperation.zPass}},sampleCoverage:{enabled:e.sampleCoverage.enabled,value:e.sampleCoverage.value,invert:e.sampleCoverage.invert},viewport:jt(e.viewport)?_p.clone(e.viewport):void 0}};var pd={ADD:Lc.FUNC_ADD,SUBTRACT:Lc.FUNC_SUBTRACT,REVERSE_SUBTRACT:Lc.FUNC_REVERSE_SUBTRACT,MIN:Lc.MIN,MAX:Lc.MAX},dd=Object.freeze(pd),fd={ZERO:Lc.ZERO,ONE:Lc.ONE,SOURCE_COLOR:Lc.SRC_COLOR,ONE_MINUS_SOURCE_COLOR:Lc.ONE_MINUS_SRC_COLOR,DESTINATION_COLOR:Lc.DST_COLOR,ONE_MINUS_DESTINATION_COLOR:Lc.ONE_MINUS_DST_COLOR,SOURCE_ALPHA:Lc.SRC_ALPHA,ONE_MINUS_SOURCE_ALPHA:Lc.ONE_MINUS_SRC_ALPHA,DESTINATION_ALPHA:Lc.DST_ALPHA,ONE_MINUS_DESTINATION_ALPHA:Lc.ONE_MINUS_DST_ALPHA,CONSTANT_COLOR:Lc.CONSTANT_COLOR,ONE_MINUS_CONSTANT_COLOR:Lc.ONE_MINUS_CONSTANT_COLOR,CONSTANT_ALPHA:Lc.CONSTANT_ALPHA,ONE_MINUS_CONSTANT_ALPHA:Lc.ONE_MINUS_CONSTANT_ALPHA,SOURCE_ALPHA_SATURATE:Lc.SRC_ALPHA_SATURATE},Ad=Object.freeze(fd),gd={DISABLED:Object.freeze({enabled:!1}),ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:dd.ADD,equationAlpha:dd.ADD,functionSourceRgb:Ad.SOURCE_ALPHA,functionSourceAlpha:Ad.ONE,functionDestinationRgb:Ad.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:Ad.ONE_MINUS_SOURCE_ALPHA}),PRE_MULTIPLIED_ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:dd.ADD,equationAlpha:dd.ADD,functionSourceRgb:Ad.ONE,functionSourceAlpha:Ad.ONE,functionDestinationRgb:Ad.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:Ad.ONE_MINUS_SOURCE_ALPHA}),ADDITIVE_BLEND:Object.freeze({enabled:!0,equationRgb:dd.ADD,equationAlpha:dd.ADD,functionSourceRgb:Ad.SOURCE_ALPHA,functionSourceAlpha:Ad.ONE,functionDestinationRgb:Ad.ONE,functionDestinationAlpha:Ad.ONE})},_d=Object.freeze(gd);function md(){}md.toVertexBuffer=function(e,t,r,n){var i=gp.createVertexBuffer({context:e,typedArray:t.arrayBuffer,usage:n?np.DYNAMIC_DRAW:np.STATIC_DRAW,owner:"MVT"});return i.vertexArrayDestroyable=!1,i.bytesPerElement=t.bytesPerElement,i.length=t.length,i.attributes=r,i.itemSize=t.bytesPerElement,i.dynamicDraw=n,n||t.destroy(),i},md.toIndexBuffer=function(e,t,r){var n=gp.createIndexBuffer({context:e,typedArray:t.arrayBuffer,usage:np.STATIC_DRAW,indexDatatype:void 0!==t.uint16?rp.UNSIGNED_SHORT:rp.UNSIGNED_INT,owner:"MVT"});return n.vertexArrayDestroyable=!1,n.dynamicDraw=r,n.dynamicDraw||t.destroy(),n},md.toRenderState=function(e,t,r,n){var i=_d.DISABLED;e.blendFunction[0]==Lc.ONE&&e.blendFunction[1]==Lc.ONE_MINUS_SRC_ALPHA&&(i={enabled:!0,equationRgb:dd.ADD,equationAlpha:dd.ADD,functionSourceRgb:Ad.ONE,functionSourceAlpha:Ad.ONE,functionDestinationRgb:Ad.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:Ad.ONE_MINUS_SOURCE_ALPHA});var o=!1;o=!(r.test.func===Lc.ALWAYS&&!r.mask);var s={frontFace:n.frontFace,cull:{enabled:n.enable,face:n.mode},depthRange:{near:t.range[0],far:t.range[1]},depthTest:{enabled:t.func!==Lc.ALWAYS,func:t.func},depthMask:t.mask,colorMask:{red:e.mask[0],green:e.mask[1],blue:e.mask[2],alpha:e.mask[3]},stencilMask:r.mask,stencilTest:{enabled:o,frontFunction:r.test.func,backFunction:r.test.func,reference:r.ref,mask:r.test.mask,frontOperation:{fail:r.fail,zFail:r.depthFail,zPass:r.pass},backOperation:{fail:r.fail,zFail:r.depthFail,zPass:r.pass}},blending:i};return Zp.fromCache(s)},md.toComponentDatatype=function(e){switch(e){case"Int8":return Gc.BYTE;case"Uint8":return Gc.UNSIGNED_BYTE;case"Int16":return Gc.SHORT;case"Uint16":return Gc.UNSIGNED_SHORT;case"Int32":return Gc.INT;case"Uint32":return Gc.UNSIGNED_INT;default:return Gc.FLOAT}},md.mbxAttributeToCesiumVertexArrtribute=function(e,t,r,n){var i=this.toComponentDatatype(e.type);Gc.getSizeInBytes(i);var o=e.strideInBytes||t.bytesPerElement,s=e.offset+o*(n||0);return{name:e.name,index:r,vertexBuffer:t,componentsPerAttribute:e.components,componentDatatype:i,offsetInBytes:s,strideInBytes:o,normalize:!1}},md.copyFromArrayView=function(e,t,r){e.copyFromArrayView(t,r)};class yd{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}set(e,t,r){}}class Ed extends yd{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class xd extends yd{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class Cd extends yd{constructor(e){super(e),this.current=a.transparent}set(e,t,r){this.fetchUniformLocation(e,t)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}var bd=new br;function Id(e){return[$l(255*e.r,255*e.g),$l(255*e.b,255*e.a)]}class Td{constructor(e,t,r){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=r}setUniform(e,t,r,n,i){t.set(e,i,n.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new Cd(e):new Ed(e)}setUniformMap(e,t,r,n,i){var o=this;e[t]=function(){var e=n.get(r).constantOr(o.value);return"color"===o.type&&(e.red=e.r,e.green=e.g,e.blue=e.b,e.alpha=e.a),e}}}class vd{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,r,n,i){const o="u_pattern"===i||"u_dash"===i?this.pattern:"u_pixel_ratio"===i?this.pixelRatio:null;o&&t.set(e,i,o)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new xd(e):new Ed(e)}setUniformMap(e,t,r,n,i){if("u_pattern"===t||"u_dash"===t){const r=this.pattern;e[t]=function(){return bd.x=r[0],bd.y=r[1],bd.z=r[2],bd.w=r[3],bd}}else if("u_pixel_ratio"===t){const r=this.pixelRatio;e[t]=function(){return r}}}}class Rd{constructor(e,t,r,n){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===r?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(e,t,r,n,i,o){const s=this.paintVertexArray.length,a=this.expression.evaluate(new Ql(0),t,{},i,n,o);this.paintVertexArray.resize(e),this._setPaintValue(s,e,a)}updatePaintArray(e,t,r,n,i){const o=this.expression.evaluate({zoom:0},r,n,void 0,i);this._setPaintValue(e,t,o)}_setPaintValue(e,t,r){if("color"===this.type){const n=Id(r);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n[0],n[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.copy(this.paintVertexArray):this.paintVertexBuffer=md.toVertexBuffer(e,this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Md{constructor(e,t,r,n,i,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=r,this.useIntegerZoom=n,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===r?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,r,n,i,o){const s=this.expression.evaluate(new Ql(this.zoom),t,{},i,n,o),a=this.expression.evaluate(new Ql(this.zoom+1),t,{},i,n,o),u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(u,e,s,a)}updatePaintArray(e,t,r,n,i){const o=this.expression.evaluate({zoom:this.zoom},r,n,void 0,i),s=this.expression.evaluate({zoom:this.zoom+1},r,n,void 0,i);this._setPaintValue(e,t,o,s)}_setPaintValue(e,t,r,n){if("color"===this.type){const i=Id(r),o=Id(n);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i[0],i[1],o[0],o[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.copyFromArrayView(this.paintVertexArray.arrayBuffer):this.paintVertexBuffer=md.toVertexBuffer(e,this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,r,n,i){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,s=ol(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(e,i,s)}setUniformMap(e,t,r,n,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,s=ol(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e[t]=function(){return s}}getBinding(e,t){return new Ed(e)}}class wd{constructor(e,t,r,n,i){this.expression=e,this.layerId=i,this.paintVertexAttributes=("array"===r?Jh:Kh).members;for(let e=0;e<t.length;++e);this.paintVertexArray=new n}populatePaintArray(e,t,r){const n=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,n,i,o){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],o)}_setPaintValues(e,t,r,n){if(!n||!r)return;const i=n[r];if(!i)return;const{tl:o,br:s,pixelRatio:a}=i;for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,o[0],o[1],s[0],s[1],a)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=md.toVertexBuffer(e,this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sd{constructor(e,t,r){this.binders={},this._buffers=[];const n=[];if(e)for(const i in e.paint._values){if(r&&!r(i))continue;const o=e.paint.get(i);if(!(o instanceof Yl&&bt(o.property.specification)))continue;const s=Dd(i,e.type),a=o.value,u=o.property.specification.type,c=!!o.property.useIntegerZoom,l="line-dasharray"===i||i.endsWith("pattern"),h="line-dasharray"===i&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==a.kind||h)if("source"===a.kind||h||l){const t=Nd(i,u,"source");this.binders[i]=l?new wd(a,s,u,t,e.id):new Rd(a,s,u,t),n.push(`/a_${i}`)}else{const e=Nd(i,u,"composite");this.binders[i]=new Md(a,s,u,c,t,e),n.push(`/z_${i}`)}else this.binders[i]=l?new vd(a.value,s):new Td(a.value,s,u),n.push(`/u_${i}`)}this.cacheKey=n.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Rd||t instanceof Md?t.maxValue:0}populatePaintArrays(e,t,r,n,i,o){for(const s in this.binders){const a=this.binders[s];(a instanceof Rd||a instanceof Md||a instanceof wd)&&a.populatePaintArray(e,t,r,n,i,o)}}setConstantPatternPositions(e){for(const t in this.binders){const r=this.binders[t];r instanceof vd&&r.setConstantPatternPositions(e)}}updatePaintArrays(e,t,r,n,i,o){let s=!1;for(const a in e){const u=t.getPositions(a);for(const t of u){const u=r.feature(t.index);for(const r in this.binders){const c=this.binders[r];if((c instanceof Rd||c instanceof Md||c instanceof wd)&&!0===c.expression.isStateDependent){const l=n.paint.get(r);c.expression=l.value,c.updatePaintArray(t.start,t.end,u,e[a],i,o),s=!0}}}}return s}defines(){const e=[];for(const t in this.binders){const r=this.binders[t];(r instanceof Td||r instanceof vd)&&e.push(...r.uniformNames.map((e=>`HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof Rd||r instanceof Md||r instanceof wd)for(let t=0;t<r.paintVertexAttributes.length;t++)e.push(r.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof Td||r instanceof vd||r instanceof Md)for(const t of r.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Td||n instanceof vd||n instanceof Md)for(const i of n.uniformNames)t.push({name:i,property:r,binding:n.getBinding(e,i)})}return t}setUniforms(e,t,r,n,i){for(const{name:t,property:o,binding:s}of r)this.binders[o].setUniform(e,s,i,n.get(o),t)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Rd||t instanceof Md||t instanceof wd)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const r=this.binders[t];(r instanceof Rd||r instanceof Md||r instanceof wd)&&r.upload(e)}this.updatePaintBuffers()}getAttributeLocation(){for(var e=0,t={},r=0;r<this.layoutAttributes.length;r++){t[this.layoutAttributes[r].name]=r,e++}for(var n=this.getPaintVertexBuffers(),i=0;n&&i<n.length;i++)for(var o=n[i],s=0;s<o.attributes.length;s++){t[o.attributes[s].name]=e++}return t}getUniformMaps(e,t,r,n){for(var i in this.binders){var o=this.binders[i];if(o.uniformNames)for(var s=0,a=o.uniformNames;s<a.length;s+=1){var u=a[s];e[u]&&o.setUniformMap(r,u,i,t,{zoom:n})}}for(var c in e)!r[c]&&c.endsWith("_t")&&(r[c]=function(){return 0});return r}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Rd||t instanceof Md||t instanceof wd)&&t.destroy()}}}class Bd{constructor(e,t,r,n){this.programConfigurations={};for(const i of t)this.programConfigurations[i.id]=new Sd(i,r,n),this.programConfigurations[i.id].layoutAttributes=e;this.needsUpload=!1,this._featureMap=new Zh,this._bufferOffset=0}populatePaintArrays(e,t,r,n,i,o,s){for(const r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(e,t,n,i,o,s);void 0!==t.id&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,n,i){for(const o of r)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(e,this._featureMap,t,o,n,i)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Od={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Dd(e,t){return Od[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const Fd={"line-pattern":{source:lh,composite:lh},"fill-pattern":{source:lh,composite:lh},"fill-extrusion-pattern":{source:lh,composite:lh},"line-dasharray":{source:hh,composite:hh}},Pd={color:{source:Nh,composite:ch},number:{source:Rh,composite:Nh}};function Nd(e,t,r){const n=Fd[e];return n&&n[r]||Pd[t][r]}function Ld(e){if(Array.isArray(e))return e.map(Ld);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=Ld(e[r]);return t}return function(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}(e)}Ml(Td,"ConstantBinder"),Ml(vd,"PatternConstantBinder"),Ml(Rd,"SourceExpressionBinder"),Ml(wd,"PatternCompositeBinder"),Ml(Md,"CompositeExpressionBinder"),Ml(Sd,"ProgramConfiguration",{omit:["_buffers"]}),Ml(Bd,"ProgramConfigurationSet");var Ud={$version:8,$root:{version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:""},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90 orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},terrain:{type:"terrain",doc:"A global modifier that elevates layers and markers based on a DEM data source."},fog:{type:"fog",doc:"A global effect that fades layers and markers based on their distance to the camera. The fog can be used to approximate the effect of atmosphere on distant objects and enhance the depth perception of the map when used with terrain or 3D features. Note: fog is renamed to atmosphere in the Android and iOS SDKs and planned to be changed in GL-JS v.3.0.0."},sources:{required:!0,type:"sources",doc:"Data source specifications."},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components]."},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components]."},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property.",example:{duration:300,delay:0}},projection:{type:"projection",doc:"The projection the map should be rendered in. Supported projections are Mercator, Globe, Albers, Equal Earth, Equirectangular (WGS84), Lambert conformal conic, Natural Earth, and Winkel Tripel. Terrain, sky and fog are supported by only Mercator and globe. CustomLayerInterface is not supported outside of Mercator.",example:{name:"albers",center:[-154,50],parallels:[55,65]}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array."}},sources:{"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:""},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:""},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers. If specified as an object only specified source layers will have id overriden, others will fallback to original feature id"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:""},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:""},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:""},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:""},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`)  it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\n\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\n\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},source_video:{type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},source_image:{type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},layer:{id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},sky:{doc:"A spherical dome around the map that is always rendered behind all other layers.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:""},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:'An expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `["feature-state", ...]` expression is not supported in filter expressions.  The `["pitch"]` and `["distance-from-center"]` expressions are supported only for filter expressions on the symbol layer.'},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"},"fill-extrusion-edge-radius":{type:"number",private:!0,default:0,minimum:0,maximum:1,doc:"Radius of a fill extrusion edge in meters. If not zero, rounds extrusion edges for a smoother appearance.","sdk-support":{"basic functionality":{js:"v2.10.0",android:"10.7.0",ios:"10.7.0"}},"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."},"line-direction":{doc:"The label is placed in the order defined by the vector data. "}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"ignore-line-rotation":{type:"boolean",values:{true:{doc:"this style is active only if text is alongline, true means not allow line rotation"},false:{doc:"this style is active only if text is alongline, false means allow line rotation"}},default:!1,doc:"In combination with `text-rotation-alignment`, determines the rotation behavior of all glyphs forming the text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options. SDF images are not supported in formatted text and will be ignored.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0",android:"10.0.0",ios:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol's anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text's language supports horizontal writing mode, symbols would be laid out horizontally."},vertical:{doc:"If a text's language supports vertical writing mode, symbols would be laid out vertically."}},doc:"The property allows control over a symbol's orientation. Note that the property values act as a hint, so that a symbol whose language doesnt support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single 'vertical' enum value. For symbol with point placement, the order of elements in an array define priority order for the placement of an orientation variant. For symbol with line placement, the default text writing mode is either ['horizontal', 'vertical'] or ['vertical', 'horizontal'], the order doesn't affect the placement.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},filter:{type:"array",value:"*",doc:"A filter selects specific features from a layer."},filter_symbol:{type:"boolean",doc:'Expression which determines whether or not to display a symbol. Symbols support dynamic filtering, meaning this expression can use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",doc:'Expression which determines whether or not to display a polygon. Fill layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",doc:'Expression which determines whether or not to display a Polygon or LineString. Line layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",doc:'Expression which determines whether or not to display a circle. Circle layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",doc:'Expression which determines whether or not to display a Polygon. Fill-extrusion layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",doc:'Expression used to determine whether a point is being displayed or not. Heatmap layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{doc:'`["==", key, value]` equality: `feature[key] = value`'},"!=":{doc:'`["!=", key, value]` inequality: `feature[key]  value`'},">":{doc:'`[">", key, value]` greater than: `feature[key] > value`'},">=":{doc:'`[">=", key, value]` greater than or equal: `feature[key]  value`'},"<":{doc:'`["<", key, value]` less than: `feature[key] < value`'},"<=":{doc:'`["<=", key, value]` less than or equal: `feature[key]  value`'},in:{doc:'`["in", key, v0, ..., vn]` set inclusion: `feature[key]  {v0, ..., vn}`'},"!in":{doc:'`["!in", key, v0, ..., vn]` set exclusion: `feature[key]  {v0, ..., vn}`'},all:{doc:'`["all", f0, ..., fn]` logical `AND`: `f0  ...  fn`'},any:{doc:'`["any", f0, ..., fn]` logical `OR`: `f0  ...  fn`'},none:{doc:'`["none", f0, ..., fn]` logical `NOR`: `f0  ...  fn`'},has:{doc:'`["has", key]` `feature[key]` exists'},"!has":{doc:'`["!has", key]` `feature[key]` does not exist'},within:{doc:'`["within", object]` feature geometry is within object geometry'}},doc:"The filter operator."},geometry_type:{type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:"A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:\n* In categorical functions, when the feature value does not match any of the stop domain values.\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\nIf no default is provided, the style property's default is used in these circumstances."}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},expression_name:{doc:"",type:"enum",values:{let:{doc:'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:'References variable bound using "let".',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string. In the specific case when the second and third arguments are string literals, you must wrap at least one of them in a [`literal`](#types-literal) expression to hint correct interpretation to the [type system](#type-system).",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0",android:"10.0.0",ios:"10.0.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0",android:"10.0.0",ios:"10.0.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:'Selects the output for which the label value matches the input value, or the fallback value if no match is found. The input can be any expression (for example, `["get", "building_type"]`). Each label must be unique, and must be either:\n - a single literal value; or\n - an array of literal values, the values of which must be all strings or all numbers (for example `[100, 101]` or `["c", "b"]`).\n\nThe input matches if any of the values in the array matches using strict equality, similar to the `"in"` operator.\nIf the input type does not match the type of the labels, the result will be the fallback value.',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first valid value is obtained. Invalid values are `null` and [`'image'`](#types-image) expressions that are unavailable in the style. If all values are invalid, `coalesce` returns the first value listed.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\n\nInterpolation types:\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\'image\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\n- `"text-font"`: Overrides the font stack specified by the root layout property.\n- `"text-color"`: Overrides the color specified by the root paint property.\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `unit` argument specifies a [simple ECMAScript unit] to use for unit-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0",android:"8.4.0",ios:"5.4.0",macos:"0.15.0"}}},"to-string":{doc:'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a [`boolean`](#types-boolean), the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm] of the ECMAScript Language Specification. If the input is a [`color`](#color), it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. If the input is an [`\'image\'`](#types-image) expression, `\'to-string\'` returns the image name. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`] function of the ECMAScript Language Specification.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm] of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color's red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature's properties, or from another object if a second argument is provided. Returns `null` if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature's properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Returns the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:'Returns the feature properties object.  Note that in some cases, it may be more efficient to use `["get", "property_name"]` directly.',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature's state. Returns `null` if the requested property is not present on the feature's state. A feature's state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\"feature-state\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0",android:"10.0.0",ios:"10.0.0"}}},"geometry-type":{doc:"Returns the feature's geometry type: `Point`, `LineString` or `Polygon`. `Multi*` feature types return the singular forms.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Returns the feature's id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:'Returns the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.',group:"Camera","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pitch:{doc:'Returns the current pitch in degrees. `["pitch"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0",android:"10.9.0",ios:"10.9.0"}}},"distance-from-center":{doc:'Returns the distance of a `symbol` instance from the center of the map. The distance is measured in pixels divided by the height of the map container. It measures 0 at the center, decreases towards the camera and increase away from the camera. For example, if the height of the map is 1000px, a value of -1 means 1000px away from the center towards the camera, and a value of 1 means a distance of 1000px away from the camera from the center. `["distance-from-center"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0",android:"10.9.0",ios:"10.9.0"}}},"heatmap-density":{doc:"Returns the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Returns the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},"sky-radial-progress":{doc:"Returns the distance of a point on the sky from the sun position. Returns 0 at sun position and 1 when the distance reaches `sky-gradient-radius`. Can only be used in the `sky-gradient` property.",group:"sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},accumulated:{doc:"Returns the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0",android:"8.4.0",ios:"5.5.0",macos:"0.15.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line's endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0",ios:"4.1.0",macos:"0.8.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"The start and end distance range in which fog fades from fully transparent to fully opaque. The distance to the point at the center of the map is defined as zero, so that negative range values are closer to the camera, and positive values are farther away.",example:[.5,10],"sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the atmosphere region immediately below the horizon and within the `range` and above the horizon and within `horizon-blend`. Using opacity is recommended only for smoothly transitioning fog on/off as anything less than 100% opacity results in more tiles loaded and drawn.","sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},"high-color":{type:"color","property-type":"data-constant",default:"#245cdf",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the atmosphere region above the horizon, `high-color` extends further above the horizon than the `color` property and its spread can be controlled with `horizon-blend`. The opacity can be set to `0` to remove the high atmosphere color contribution.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}},"space-color":{type:"color","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the region above the horizon and after the end of the `horizon-blend` contribution. The opacity can be set to `0` to have a transparent background.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}},"horizon-blend":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,.2,7,.1],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Horizon blend applies a smooth fade from the color of the atmosphere to the color of space. A value of zero leaves a sharp transition from atmosphere to space. Increasing the value blends the color of atmosphere into increasingly high angles of the sky.","sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},"star-intensity":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],5,.35,6,0],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"A value controlling the star intensity where `0` will show no stars and `1` will show stars at their maximum intensity.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0 (0 when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0 when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0, directly above, to 180, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},projection:{name:{type:"enum",values:{albers:{doc:"An Albers equal-area projection centered on the continental United States. You can configure the projection for a different region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},equalEarth:{doc:"An Equal Earth projection."},equirectangular:{doc:"An Equirectangular projection. This projection is very similar to the Plate Carre projection."},lambertConformalConic:{doc:"A Lambert conformal conic projection. You can configure the projection for a region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},mercator:{doc:"The Mercator projection is the default projection."},naturalEarth:{doc:"A Natural Earth projection."},winkelTripel:{doc:"A Winkel Tripel projection."},globe:{doc:"A globe projection."}},default:"mercator",doc:"The name of the projection to be used for rendering the map.",required:!0,"sdk-support":{"basic functionality":{js:"2.6.0"}}},center:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-180,-90],maximum:[180,90],transition:!1,doc:"The reference longitude and latitude of the projection. `center` takes the form of [lng, lat]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic). All other projections are centered on [0, 0].",example:[-96,37.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-90,-90],maximum:[90,90],transition:!1,doc:"The standard parallels of the projection, denoting the desired latitude range with minimal distortion. `parallels` takes the form of [lat0, lat1]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic).",example:[29.5,45.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}}},terrain:{source:{type:"string",doc:"Name of a source of `raster_dem` type to be used for terrain elevation.",required:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Exaggerates the elevation of the terrain by multiplying the data from the DEM with this value.",requires:["source"],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",android:"7.0.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant",type:"number",private:!0,default:0,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Controls the intensity of shading near ground and concave angles between walls. Default value 0.0 disables ambient occlusion and values around 0.3 provide the most plausible results for buildings.","sdk-support":{"basic functionality":{js:"2.10.0",android:"10.7.0",ios:"10.7.0"}}},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant",type:"number",private:!0,default:3,minimum:0,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Shades area near ground and concave angles between walls where the radius defines only vertical impact. Default value 3.0 corresponds to height of one floor and brings the most plausible results for buildings.",requires:["fill-extrusion-edge-radius"],"sdk-support":{"basic functionality":{js:"2.10.0",android:"10.7.0",ios:"10.7.0"}}},"fill-extrusion-rounded-roof":{type:"boolean",default:!0,doc:"Indicates whether top edges should be rounded when fill-extrusion-edge-radius has a value greater than 0. If false, rounded edges are only applied to the sides. Default is true.",requires:["fill-extrusion-edge-radius"],transition:!1,"sdk-support":{"basic functionality":{js:"2.15.0",android:"10.10.0",ios:"10.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!1,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{type:"color",doc:'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{type:"array",value:"number",doc:"The line part between [trim-start, trim-end] will be marked as transparent to make a route vanishing effect. The line trim-off offset is based on the whole line range [0.0, 1.0].",length:2,default:[0,0],minimum:[0,0],maximum:[1,1],transition:!1,requires:[{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"2.9.0",android:"10.5.0",ios:"10.5.0",macos:"10.5.0"}},"property-type":"constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed. `queryRenderedFeatures` on heatmap layers will return points within this radius.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#ffffff",transition:!0,doc:"",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{doc:"Renders the sky with a gradient that can be configured with `sky-gradient-radius` and `sky-gradient`."},atmosphere:{doc:"Renders the sky with a simulated atmospheric scattering algorithm, the sun direction can be attached to the light position or explicitly set through `sky-atmosphere-sun`."}},default:"atmosphere",doc:"The type of the sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the sun center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the sun relative to 0 north, where degrees proceed clockwise. The polar angle indicates the height of the sun, where 0 is directly above, at zenith, and 90 at the horizon. When this property is ommitted, the sun center is directly inherited from the light position.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,doc:"Intensity of the sun as a light source in the atmosphere (on a scale from 0 to a 100). Setting higher values will brighten up the sky.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the gradient center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the gradient center relative to 0 north, where degrees proceed clockwise. The polar angle indicates the height of the gradient center, where 0 is directly above, at zenith, and 90 at the horizon.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,doc:"The angular distance (measured in degrees) from `sky-gradient-center` up to which the gradient extends. A value of 180 causes the gradient to wrap around to the opposite direction from `sky-gradient-center`.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],doc:"Defines a radial color gradient with which to color the sky. The color values can be interpolated with an expression using `sky-radial-progress`. The range [0, 1] for the interpolant covers a radial distance (in degrees) of [0, `sky-gradient-radius`] centered at the position specified by `sky-gradient-center`.",transition:!1,requires:[{"sky-type":"gradient"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",doc:"A color applied to the atmosphere sun halo. The alpha channel describes how strongly the sun halo is represented in an atmosphere sky layer.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",doc:"A color used to tweak the main atmospheric scattering coefficients. Using white applies the default coefficients giving the natural blue color to the atmosphere. This color affects how heavily the corresponding wavelength is represented during scattering. The alpha channel describes the density of the atmosphere, with 1 maximum density and 0 no density.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire sky layer.",transition:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:{"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}}};function Gd(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Gd(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Qd(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Gd(e)||(e=Yd(e));const r=e;let n=!0;try{n=function(e){if(!jd(e))return e;let t=Ld(e);return zd(t),t=kd(t),t}(r)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const i=Ud[`filter_${t}`],o=Nt(n,i);let s=null;if("error"===o.result)throw new Error(o.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(e,t,r)=>o.value.evaluate(e,t,{},r);let a=null,u=null;if(n!==r){const e=Nt(r,i);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(t,r,n,i,o)=>e.value.evaluate(t,r,{},n,void 0,void 0,i,o),u=!Ee(e.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:Vd(n),needFeature:!!u}}function kd(e){if(!Array.isArray(e))return e;const t=function(e){if(Hd.has(e[0]))for(let t=1;t<e.length;t++){if(jd(e[t]))return!0}return e}(e);return!0===t?t:t.map((e=>kd(e)))}function zd(e){let t=!1;const r=[];if("case"===e[0]){for(let n=1;n<e.length-1;n+=2)t=t||jd(e[n]),r.push(e[n+1]);r.push(e[e.length-1])}else if("match"===e[0]){t=t||jd(e[1]);for(let t=2;t<e.length-1;t+=2)r.push(e[t+1]);r.push(e[e.length-1])}else if("step"===e[0]){t=t||jd(e[1]);for(let t=1;t<e.length-1;t+=2)r.push(e[t+1])}t&&(e.length=0,e.push("any",...r));for(let t=1;t<e.length;t++)zd(e[t])}function jd(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let t=1;t<e.length;t++){if(jd(e[t]))return!0}return!1}const Hd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function qd(e,t){return e<t?-1:e>t?1:0}function Vd(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let t=1;t<e.length;t++)if(Vd(e[t]))return!0;return!1}function Yd(e){if(!e)return!0;const t=e[0];if(e.length<=1)return"any"!==t;var r;return"=="===t?Xd(e[1],e[2],"=="):"!="===t?Jd(Xd(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Xd(e[1],e[2],t):"any"===t?(r=e.slice(1),["any"].concat(r.map(Yd))):"all"===t?["all"].concat(e.slice(1).map(Yd)):"none"===t?["all"].concat(e.slice(1).map(Yd).map(Jd)):"in"===t?Wd(e[1],e.slice(2)):"!in"===t?Jd(Wd(e[1],e.slice(2))):"has"===t?Kd(e[1]):"!has"===t?Jd(Kd(e[1])):"within"!==t||e}function Xd(e,t,r){switch(e){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,e,t]}}function Wd(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(qd)]]:["filter-in-small",e,["literal",t]]}}function Kd(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Jd(e){return["!",e]}const Zd="-transition";class $d extends Ul{constructor(e,t,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Vl(t.layout)),t.paint)){this._transitionablePaint=new jl(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xl(t.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,r){"visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t}getPaintProperty(e){return ll(e,Zd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,r={}){if(ll(e,Zd))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{const r=this._transitionablePaint._values[e],n=r.value.isDataDriven(),i=r.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const o=this._transitionablePaint._values[e].value,s=o.isDataDriven(),a=ll(e,"pattern")||"line-dasharray"===e;return s||n||a||this._handleOverridablePaintPropertyUpdate(e,i,o)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||(!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility)}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),function(e,t,r){const n={};for(const i in e)t.call(r||this,e[i],i,e)&&(n[i]=e[i]);return n}(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,r,n,i={}){return!0}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Yl&&bt(t.property.specification)&&(("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent))return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Qd(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const ef=nh([{name:"a_pos",components:2,type:"Int16"},{name:"a_ecef_pos_high",components:3,type:"Float32"},{name:"a_ecef_pos_low",components:3,type:"Float32"}],4);var tf=function(e){void 0===e&&(e=[]),this.segments=e};function rf(e,t,r){return Math.min(r,Math.max(t,e))}tf.prototype.prepareSegment=function(e,t,r,n){var i=this.segments[this.segments.length-1];return(!i||i.vertexLength+e>tf.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i},tf.prototype.get=function(){return this.segments},tf.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var n in r.cesiumVaos)r.cesiumVaos[n].destroy()}},tf.simpleSegment=function(e,t,r,n){return new tf([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:n,vaos:{},cesiumVaos:{},drawCommands:{},sortKey:0}])},tf.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ml(tf,"SegmentVector");var nf,of=(nf=15,{min:-1*Math.pow(2,nf-1),max:Math.pow(2,nf-1)-1});function sf(e,t=!0){for(var r=va/e.extent,n=e.loadGeometry(),i=0;i<n.length;i++)for(var o=n[i],s=0;s<o.length;s++){var a=o[s];a.x=Math.round(a.x*r),a.y=t?va-Math.round(a.y*r):Math.round(a.y*r),(a.x<of.min||a.x>of.max||a.y<of.min||a.y>of.max)&&(a.x=rf(a.x,of.min,of.max),a.y=rf(a.y,of.min,of.max))}return n}function af(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?sf(e):[]}}function uf(){this.high=Zt.clone(Zt.ZERO),this.low=Zt.clone(Zt.ZERO)}uf.encode=function(e,t){var r;return qt.typeOf.number("value",e),jt(t)||(t={high:0,low:0}),e>=0?(r=65536*Math.floor(e/65536),t.high=r,t.low=e-r):(r=65536*Math.floor(-e/65536),t.high=-r,t.low=e+r),t};var cf={high:0,low:0};uf.fromCartesian=function(e,t){qt.typeOf.object("cartesian",e),jt(t)||(t=new uf);var r=t.high,n=t.low;return uf.encode(e.x,cf),r.x=cf.high,n.x=cf.low,uf.encode(e.y,cf),r.y=cf.high,n.y=cf.low,uf.encode(e.z,cf),r.z=cf.high,n.z=cf.low,t};var lf=new uf;function hf(e,t,r,n,i,o,s){e.emplaceBack(2*t+(n+1)/2,2*r+(i+1)/2,o.x,o.y,o.z,s.x,s.y,s.z)}uf.writeElements=function(e,t,r){qt.defined("cartesianArray",t),qt.typeOf.number("index",r),qt.typeOf.number.greaterThanOrEquals("index",r,0),uf.fromCartesian(e,lf);var n=lf.high,i=lf.low;t[r]=n.x,t[r+1]=n.y,t[r+2]=n.z,t[r+3]=i.x,t[r+4]=i.y,t[r+5]=i.z};class pf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ph,this.indexArray=new bh,this.segments=new tf,this.programConfigurations=new Bd(ef.members,e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,r,n){const i=this.layers[0],o=[];let s=null;"circle"===i.type&&(s=i.layout.get("circle-sort-key"));for(const{feature:t,id:n,index:i,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,c=af(t,e);var a=new Ql(this.zoom);if(!this.layers[0]._featureFilter.filter(a,c,r))continue;const l=s?s.evaluate(c,{},r):void 0,h={id:n,properties:t.properties,type:t.type,sourceLayerIndex:u,index:i,geometry:e?c.geometry:sf(t,r),patterns:{},sortKey:l};o.push(h)}s&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const n of o){const{geometry:i,index:o,sourceLayerIndex:s}=n,a=e[o].feature;this.addFeature(n,i,o,t.availableImages,r,null,t.crs),t.featureIndex.insert(a,i,o,s,this.index)}}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=md.toVertexBuffer(e,this.layoutVertexArray,ef.members),this.indexBuffer=md.toIndexBuffer(e,this.indexArray),this.globeExtVertexArray&&this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=md.toVertexBuffer(e,this.globeExtVertexArray,circleGlobeAttributesExt.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,r,n,i,o,s){for(const r of t)for(const t of r){const r=t.x,n=t.y;if(r<0||r>=va||n<0||n>=va)continue;const o=ml(s,r,n,i),a=uf.fromCartesian(o),u=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),c=u.vertexLength;hf(this.layoutVertexArray,r,n,-1,-1,a.high,a.low),hf(this.layoutVertexArray,r,n,1,-1,a.high,a.low),hf(this.layoutVertexArray,r,n,1,1,a.high,a.low),hf(this.layoutVertexArray,r,n,-1,1,a.high,a.low),this.indexArray.emplaceBack(c,c+1,c+2),this.indexArray.emplaceBack(c,c+2,c+3),u.vertexLength+=4,u.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},n,i)}}function df(e,t){for(let r=0;r<e.length;r++)if(Cf(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(Cf(e,t[r]))return!0;return!!_f(e,t)}function ff(e,t,r){return!!Cf(e,t)||!!yf(t,e,r)}function Af(e,t){if(1===e.length)return xf(t,e[0]);for(let r=0;r<t.length;r++){const n=t[r];for(let t=0;t<n.length;t++)if(Cf(e,n[t]))return!0}for(let r=0;r<e.length;r++)if(xf(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(_f(e,t[r]))return!0;return!1}function gf(e,t,r){if(e.length>1){if(_f(e,t))return!0;for(let n=0;n<t.length;n++)if(yf(t[n],e,r))return!0}for(let n=0;n<e.length;n++)if(yf(e[n],t,r))return!0;return!1}function _f(e,t){if(0===e.length||0===t.length)return!1;for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1];for(let e=0;e<t.length-1;e++){if(mf(n,i,t[e],t[e+1]))return!0}}return!1}function mf(e,t,r,n){return Al(e,r,n)!==Al(t,r,n)&&Al(e,t,r)!==Al(e,t,n)}function yf(e,t,r){const n=r*r;if(1===t.length)return e.distSqr(t[0])<n;for(let r=1;r<t.length;r++){if(Ef(e,t[r-1],t[r])<n)return!0}return!1}function Ef(e,t,r){const n=t.distSqr(r);if(0===n)return e.distSqr(t);const i=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/n;return i<0?e.distSqr(t):i>1?e.distSqr(r):e.distSqr(r.sub(t)._mult(i)._add(t))}function xf(e,t){let r,n,i,o=!1;for(let s=0;s<e.length;s++){r=e[s];for(let e=0,s=r.length-1;e<r.length;s=e++)n=r[e],i=r[s],n.y>t.y!=i.y>t.y&&t.x<(i.x-n.x)*(t.y-n.y)/(i.y-n.y)+n.x&&(o=!o)}return o}function Cf(e,t){let r=!1;for(let n=0,i=e.length-1;n<e.length;i=n++){const o=e[n],s=e[i];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(r=!r)}return r}function bf(e,t,r){const n=r[0],i=r[2];if(e.x<n.x&&t.x<n.x||e.x>i.x&&t.x>i.x||e.y<n.y&&t.y<n.y||e.y>i.y&&t.y>i.y)return!1;const o=Al(e,t,r[0]);return o!==Al(e,t,r[1])||o!==Al(e,t,r[2])||o!==Al(e,t,r[3])}function If(e,t,r){const n=t.paint.get(e).value;return"constant"===n.kind?n.value:r.programConfigurations.get(t.id).getMaxValue(e)}function Tf(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function vf(e,t,r,n,i){if(!t[0]&&!t[1])return e;const o=zt.convert(t)._mult(i);"viewport"===r&&o._rotate(-n);const s=[];for(let t=0;t<e.length;t++){const r=e[t];s.push(r.sub(o))}return s}function Rf(e,t,r,n){const i=zt.convert(e)._mult(n);return"viewport"===t&&i._rotate(-r),i}Ml(pf,"CircleBucket",{omit:["layers"]});const Mf=new Zl({"circle-sort-key":new Kl(Ud.layout_circle["circle-sort-key"])});var wf={paint:new Zl({"circle-radius":new Kl(Ud.paint_circle["circle-radius"]),"circle-color":new Kl(Ud.paint_circle["circle-color"]),"circle-blur":new Kl(Ud.paint_circle["circle-blur"]),"circle-opacity":new Kl(Ud.paint_circle["circle-opacity"]),"circle-translate":new Wl(Ud.paint_circle["circle-translate"]),"circle-translate-anchor":new Wl(Ud.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Wl(Ud.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Wl(Ud.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kl(Ud.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kl(Ud.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kl(Ud.paint_circle["circle-stroke-opacity"])}),layout:Mf};function Sf(){}var Bf=1e-6,Of="undefined"!=typeof Float32Array?Float32Array:Array,Df=Math.random;var Ff=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Pf=Object.freeze({EPSILON:Bf,get ARRAY_TYPE(){return Of},RANDOM:Df,setMatrixArrayType:function(e){Of=e},toRadian:function(e){return e*Ff},equals:function(e,t){return Math.abs(e-t)<=Bf*Math.max(1,Math.abs(e),Math.abs(t))}});function Nf(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=r[0],u=r[1],c=r[2],l=r[3];return e[0]=n*a+o*u,e[1]=i*a+s*u,e[2]=n*c+o*l,e[3]=i*c+s*l,e}function Lf(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}var Uf=Nf,Gf=Lf,Qf=Object.freeze({create:function(){var e=new Of(4);return Of!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new Of(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},fromValues:function(e,t,r,n){var i=new Of(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},set:function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},transpose:function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=r*o-i*n;return s?(s=1/s,e[0]=o*s,e[1]=-n*s,e[2]=-i*s,e[3]=r*s,e):null},adjoint:function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:Nf,rotate:function(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(r),u=Math.cos(r);return e[0]=n*u+o*a,e[1]=i*u+s*a,e[2]=n*-a+o*u,e[3]=i*-a+s*u,e},scale:function(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=r[0],u=r[1];return e[0]=n*a,e[1]=i*a,e[2]=o*u,e[3]=s*u,e},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3])},LDU:function(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},subtract:Lf,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],s=t[0],a=t[1],u=t[2],c=t[3];return Math.abs(r-s)<=Bf*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=Bf*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-u)<=Bf*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=Bf*Math.max(1,Math.abs(o),Math.abs(c))},multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},mul:Uf,sub:Gf});function kf(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],u=t[5],c=r[0],l=r[1],h=r[2],p=r[3],d=r[4],f=r[5];return e[0]=n*c+o*l,e[1]=i*c+s*l,e[2]=n*h+o*p,e[3]=i*h+s*p,e[4]=n*d+o*f+a,e[5]=i*d+s*f+u,e}function zf(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}var jf=kf,Hf=zf,qf=Object.freeze({create:function(){var e=new Of(6);return Of!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new Of(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fromValues:function(e,t,r,n,i,o){var s=new Of(6);return s[0]=e,s[1]=t,s[2]=r,s[3]=n,s[4]=i,s[5]=o,s},set:function(e,t,r,n,i,o,s){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=s,e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],u=r*o-n*i;return u?(u=1/u,e[0]=o*u,e[1]=-n*u,e[2]=-i*u,e[3]=r*u,e[4]=(i*a-o*s)*u,e[5]=(n*s-r*a)*u,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:kf,rotate:function(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],u=t[5],c=Math.sin(r),l=Math.cos(r);return e[0]=n*l+o*c,e[1]=i*l+s*c,e[2]=n*-c+o*l,e[3]=i*-c+s*l,e[4]=a,e[5]=u,e},scale:function(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],u=t[5],c=r[0],l=r[1];return e[0]=n*c,e[1]=i*c,e[2]=o*l,e[3]=s*l,e[4]=a,e[5]=u,e},translate:function(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],u=t[5],c=r[0],l=r[1];return e[0]=n,e[1]=i,e[2]=o,e[3]=s,e[4]=n*c+o*l+a,e[5]=i*c+s*l+u,e},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=0,e[5]=0,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},subtract:zf,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=t[0],c=t[1],l=t[2],h=t[3],p=t[4],d=t[5];return Math.abs(r-u)<=Bf*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-c)<=Bf*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-l)<=Bf*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-h)<=Bf*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-p)<=Bf*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-d)<=Bf*Math.max(1,Math.abs(a),Math.abs(d))},mul:jf,sub:Hf});function Vf(){var e=new Of(9);return Of!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Yf(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],h=t[8],p=r[0],d=r[1],f=r[2],A=r[3],g=r[4],_=r[5],m=r[6],y=r[7],E=r[8];return e[0]=p*n+d*s+f*c,e[1]=p*i+d*a+f*l,e[2]=p*o+d*u+f*h,e[3]=A*n+g*s+_*c,e[4]=A*i+g*a+_*l,e[5]=A*o+g*u+_*h,e[6]=m*n+y*s+E*c,e[7]=m*i+y*a+E*l,e[8]=m*o+y*u+E*h,e}function Xf(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}var Wf=Yf,Kf=Xf,Jf=Object.freeze({create:Vf,fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new Of(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues:function(e,t,r,n,i,o,s,a,u){var c=new Of(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=n,c[4]=i,c[5]=o,c[6]=s,c[7]=a,c[8]=u,c},set:function(e,t,r,n,i,o,s,a,u,c){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=u,e[8]=c,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],u=t[6],c=t[7],l=t[8],h=l*s-a*c,p=-l*o+a*u,d=c*o-s*u,f=r*h+n*p+i*d;return f?(f=1/f,e[0]=h*f,e[1]=(-l*n+i*c)*f,e[2]=(a*n-i*s)*f,e[3]=p*f,e[4]=(l*r-i*u)*f,e[5]=(-a*r+i*o)*f,e[6]=d*f,e[7]=(-c*r+n*u)*f,e[8]=(s*r-n*o)*f,e):null},adjoint:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],u=t[6],c=t[7],l=t[8];return e[0]=s*l-a*c,e[1]=i*c-n*l,e[2]=n*a-i*s,e[3]=a*u-o*l,e[4]=r*l-i*u,e[5]=i*o-r*a,e[6]=o*c-s*u,e[7]=n*u-r*c,e[8]=r*s-n*o,e},determinant:function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],u=e[7],c=e[8];return t*(c*o-s*u)+r*(-c*i+s*a)+n*(u*i-o*a)},multiply:Yf,translate:function(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],h=t[8],p=r[0],d=r[1];return e[0]=n,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=u,e[6]=p*n+d*s+c,e[7]=p*i+d*a+l,e[8]=p*o+d*u+h,e},rotate:function(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],h=t[8],p=Math.sin(r),d=Math.cos(r);return e[0]=d*n+p*s,e[1]=d*i+p*a,e[2]=d*o+p*u,e[3]=d*s-p*n,e[4]=d*a-p*i,e[5]=d*u-p*o,e[6]=c,e[7]=l,e[8]=h,e},scale:function(e,t,r){var n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=r+r,a=n+n,u=i+i,c=r*s,l=n*s,h=n*a,p=i*s,d=i*a,f=i*u,A=o*s,g=o*a,_=o*u;return e[0]=1-h-f,e[3]=l-_,e[6]=p+g,e[1]=l+_,e[4]=1-c-f,e[7]=d-A,e[2]=p-g,e[5]=d+A,e[8]=1-c-h,e},normalFromMat4:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],u=t[6],c=t[7],l=t[8],h=t[9],p=t[10],d=t[11],f=t[12],A=t[13],g=t[14],_=t[15],m=r*a-n*s,y=r*u-i*s,E=r*c-o*s,x=n*u-i*a,C=n*c-o*a,b=i*c-o*u,I=l*A-h*f,T=l*g-p*f,v=l*_-d*f,R=h*g-p*A,M=h*_-d*A,w=p*_-d*g,S=m*w-y*M+E*R+x*v-C*T+b*I;return S?(S=1/S,e[0]=(a*w-u*M+c*R)*S,e[1]=(u*v-s*w-c*T)*S,e[2]=(s*M-a*v+c*I)*S,e[3]=(i*M-n*w-o*R)*S,e[4]=(r*w-i*v+o*T)*S,e[5]=(n*v-r*M-o*I)*S,e[6]=(A*b-g*C+_*x)*S,e[7]=(g*E-f*b-_*y)*S,e[8]=(f*C-A*E+_*m)*S,e):null},projection:function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},subtract:Xf,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],c=e[7],l=e[8],h=t[0],p=t[1],d=t[2],f=t[3],A=t[4],g=t[5],_=t[6],m=t[7],y=t[8];return Math.abs(r-h)<=Bf*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-p)<=Bf*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(i-d)<=Bf*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-f)<=Bf*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-A)<=Bf*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(a-g)<=Bf*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(u-_)<=Bf*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(c-m)<=Bf*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(l-y)<=Bf*Math.max(1,Math.abs(l),Math.abs(y))},mul:Wf,sub:Kf});function Zf(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $f(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],h=t[8],p=t[9],d=t[10],f=t[11],A=t[12],g=t[13],_=t[14],m=t[15],y=r[0],E=r[1],x=r[2],C=r[3];return e[0]=y*n+E*a+x*h+C*A,e[1]=y*i+E*u+x*p+C*g,e[2]=y*o+E*c+x*d+C*_,e[3]=y*s+E*l+x*f+C*m,y=r[4],E=r[5],x=r[6],C=r[7],e[4]=y*n+E*a+x*h+C*A,e[5]=y*i+E*u+x*p+C*g,e[6]=y*o+E*c+x*d+C*_,e[7]=y*s+E*l+x*f+C*m,y=r[8],E=r[9],x=r[10],C=r[11],e[8]=y*n+E*a+x*h+C*A,e[9]=y*i+E*u+x*p+C*g,e[10]=y*o+E*c+x*d+C*_,e[11]=y*s+E*l+x*f+C*m,y=r[12],E=r[13],x=r[14],C=r[15],e[12]=y*n+E*a+x*h+C*A,e[13]=y*i+E*u+x*p+C*g,e[14]=y*o+E*c+x*d+C*_,e[15]=y*s+E*l+x*f+C*m,e}function eA(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=n+n,u=i+i,c=o+o,l=n*a,h=n*u,p=n*c,d=i*u,f=i*c,A=o*c,g=s*a,_=s*u,m=s*c;return e[0]=1-(d+A),e[1]=h+m,e[2]=p-_,e[3]=0,e[4]=h-m,e[5]=1-(l+A),e[6]=f+g,e[7]=0,e[8]=p+_,e[9]=f-g,e[10]=1-(l+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function tA(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function rA(e,t){var r=t[0],n=t[1],i=t[2],o=t[4],s=t[5],a=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.hypot(r,n,i),e[1]=Math.hypot(o,s,a),e[2]=Math.hypot(u,c,l),e}function nA(e,t){var r=new Of(3);rA(r,t);var n=1/r[0],i=1/r[1],o=1/r[2],s=t[0]*n,a=t[1]*i,u=t[2]*o,c=t[4]*n,l=t[5]*i,h=t[6]*o,p=t[8]*n,d=t[9]*i,f=t[10]*o,A=s+l+f,g=0;return A>0?(g=2*Math.sqrt(A+1),e[3]=.25*g,e[0]=(h-d)/g,e[1]=(p-u)/g,e[2]=(a-c)/g):s>l&&s>f?(g=2*Math.sqrt(1+s-l-f),e[3]=(h-d)/g,e[0]=.25*g,e[1]=(a+c)/g,e[2]=(p+u)/g):l>f?(g=2*Math.sqrt(1+l-s-f),e[3]=(p-u)/g,e[0]=(a+c)/g,e[1]=.25*g,e[2]=(h+d)/g):(g=2*Math.sqrt(1+f-s-l),e[3]=(a-c)/g,e[0]=(p+u)/g,e[1]=(h+d)/g,e[2]=.25*g),e}function iA(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}var oA=$f,sA=iA,aA=Object.freeze({create:function(){var e=new Of(16);return Of!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},clone:function(e){var t=new Of(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:function(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A){var g=new Of(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=n,g[4]=i,g[5]=o,g[6]=s,g[7]=a,g[8]=u,g[9]=c,g[10]=l,g[11]=h,g[12]=p,g[13]=d,g[14]=f,g[15]=A,g},set:function(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=u,e[8]=c,e[9]=l,e[10]=h,e[11]=p,e[12]=d,e[13]=f,e[14]=A,e[15]=g,e},identity:Zf,transpose:function(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],u=t[6],c=t[7],l=t[8],h=t[9],p=t[10],d=t[11],f=t[12],A=t[13],g=t[14],_=t[15],m=r*a-n*s,y=r*u-i*s,E=r*c-o*s,x=n*u-i*a,C=n*c-o*a,b=i*c-o*u,I=l*A-h*f,T=l*g-p*f,v=l*_-d*f,R=h*g-p*A,M=h*_-d*A,w=p*_-d*g,S=m*w-y*M+E*R+x*v-C*T+b*I;return S?(S=1/S,e[0]=(a*w-u*M+c*R)*S,e[1]=(i*M-n*w-o*R)*S,e[2]=(A*b-g*C+_*x)*S,e[3]=(p*C-h*b-d*x)*S,e[4]=(u*v-s*w-c*T)*S,e[5]=(r*w-i*v+o*T)*S,e[6]=(g*E-f*b-_*y)*S,e[7]=(l*b-p*E+d*y)*S,e[8]=(s*M-a*v+c*I)*S,e[9]=(n*v-r*M-o*I)*S,e[10]=(f*C-A*E+_*m)*S,e[11]=(h*E-l*C-d*m)*S,e[12]=(a*T-s*R-u*I)*S,e[13]=(r*R-n*T+i*I)*S,e[14]=(A*y-f*x-g*m)*S,e[15]=(l*x-h*y+p*m)*S,e):null},adjoint:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],u=t[6],c=t[7],l=t[8],h=t[9],p=t[10],d=t[11],f=t[12],A=t[13],g=t[14],_=t[15];return e[0]=a*(p*_-d*g)-h*(u*_-c*g)+A*(u*d-c*p),e[1]=-(n*(p*_-d*g)-h*(i*_-o*g)+A*(i*d-o*p)),e[2]=n*(u*_-c*g)-a*(i*_-o*g)+A*(i*c-o*u),e[3]=-(n*(u*d-c*p)-a*(i*d-o*p)+h*(i*c-o*u)),e[4]=-(s*(p*_-d*g)-l*(u*_-c*g)+f*(u*d-c*p)),e[5]=r*(p*_-d*g)-l*(i*_-o*g)+f*(i*d-o*p),e[6]=-(r*(u*_-c*g)-s*(i*_-o*g)+f*(i*c-o*u)),e[7]=r*(u*d-c*p)-s*(i*d-o*p)+l*(i*c-o*u),e[8]=s*(h*_-d*A)-l*(a*_-c*A)+f*(a*d-c*h),e[9]=-(r*(h*_-d*A)-l*(n*_-o*A)+f*(n*d-o*h)),e[10]=r*(a*_-c*A)-s*(n*_-o*A)+f*(n*c-o*a),e[11]=-(r*(a*d-c*h)-s*(n*d-o*h)+l*(n*c-o*a)),e[12]=-(s*(h*g-p*A)-l*(a*g-u*A)+f*(a*p-u*h)),e[13]=r*(h*g-p*A)-l*(n*g-i*A)+f*(n*p-i*h),e[14]=-(r*(a*g-u*A)-s*(n*g-i*A)+f*(n*u-i*a)),e[15]=r*(a*p-u*h)-s*(n*p-i*h)+l*(n*u-i*a),e},determinant:function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],u=e[7],c=e[8],l=e[9],h=e[10],p=e[11],d=e[12],f=e[13],A=e[14],g=e[15];return(t*s-r*o)*(h*g-p*A)-(t*a-n*o)*(l*g-p*f)+(t*u-i*o)*(l*A-h*f)+(r*a-n*s)*(c*g-p*d)-(r*u-i*s)*(c*A-h*d)+(n*u-i*a)*(c*f-l*d)},multiply:$f,translate:function(e,t,r){var n,i,o,s,a,u,c,l,h,p,d,f,A=r[0],g=r[1],_=r[2];return t===e?(e[12]=t[0]*A+t[4]*g+t[8]*_+t[12],e[13]=t[1]*A+t[5]*g+t[9]*_+t[13],e[14]=t[2]*A+t[6]*g+t[10]*_+t[14],e[15]=t[3]*A+t[7]*g+t[11]*_+t[15]):(n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],h=t[8],p=t[9],d=t[10],f=t[11],e[0]=n,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=u,e[6]=c,e[7]=l,e[8]=h,e[9]=p,e[10]=d,e[11]=f,e[12]=n*A+a*g+h*_+t[12],e[13]=i*A+u*g+p*_+t[13],e[14]=o*A+c*g+d*_+t[14],e[15]=s*A+l*g+f*_+t[15]),e},scale:function(e,t,r){var n=r[0],i=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},rotate:function(e,t,r,n){var i,o,s,a,u,c,l,h,p,d,f,A,g,_,m,y,E,x,C,b,I,T,v,R,M=n[0],w=n[1],S=n[2],B=Math.hypot(M,w,S);return B<Bf?null:(M*=B=1/B,w*=B,S*=B,i=Math.sin(r),s=1-(o=Math.cos(r)),a=t[0],u=t[1],c=t[2],l=t[3],h=t[4],p=t[5],d=t[6],f=t[7],A=t[8],g=t[9],_=t[10],m=t[11],y=M*M*s+o,E=w*M*s+S*i,x=S*M*s-w*i,C=M*w*s-S*i,b=w*w*s+o,I=S*w*s+M*i,T=M*S*s+w*i,v=w*S*s-M*i,R=S*S*s+o,e[0]=a*y+h*E+A*x,e[1]=u*y+p*E+g*x,e[2]=c*y+d*E+_*x,e[3]=l*y+f*E+m*x,e[4]=a*C+h*b+A*I,e[5]=u*C+p*b+g*I,e[6]=c*C+d*b+_*I,e[7]=l*C+f*b+m*I,e[8]=a*T+h*v+A*R,e[9]=u*T+p*v+g*R,e[10]=c*T+d*v+_*R,e[11]=l*T+f*v+m*R,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[4],s=t[5],a=t[6],u=t[7],c=t[8],l=t[9],h=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*n,e[5]=s*i+l*n,e[6]=a*i+h*n,e[7]=u*i+p*n,e[8]=c*i-o*n,e[9]=l*i-s*n,e[10]=h*i-a*n,e[11]=p*i-u*n,e},rotateY:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],s=t[1],a=t[2],u=t[3],c=t[8],l=t[9],h=t[10],p=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*n,e[1]=s*i-l*n,e[2]=a*i-h*n,e[3]=u*i-p*n,e[8]=o*n+c*i,e[9]=s*n+l*i,e[10]=a*n+h*i,e[11]=u*n+p*i,e},rotateZ:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],s=t[1],a=t[2],u=t[3],c=t[4],l=t[5],h=t[6],p=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*n,e[1]=s*i+l*n,e[2]=a*i+h*n,e[3]=u*i+p*n,e[4]=c*i-o*n,e[5]=l*i-s*n,e[6]=h*i-a*n,e[7]=p*i-u*n,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,t,r){var n,i,o,s=r[0],a=r[1],u=r[2],c=Math.hypot(s,a,u);return c<Bf?null:(s*=c=1/c,a*=c,u*=c,n=Math.sin(t),o=1-(i=Math.cos(t)),e[0]=s*s*o+i,e[1]=a*s*o+u*n,e[2]=u*s*o-a*n,e[3]=0,e[4]=s*a*o-u*n,e[5]=a*a*o+i,e[6]=u*a*o+s*n,e[7]=0,e[8]=s*u*o+a*n,e[9]=a*u*o-s*n,e[10]=u*u*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:eA,fromQuat2:function(e,t){var r=new Of(3),n=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],h=n*n+i*i+o*o+s*s;return h>0?(r[0]=2*(a*s+l*n+u*o-c*i)/h,r[1]=2*(u*s+l*i+c*n-a*o)/h,r[2]=2*(c*s+l*o+a*i-u*n)/h):(r[0]=2*(a*s+l*n+u*o-c*i),r[1]=2*(u*s+l*i+c*n-a*o),r[2]=2*(c*s+l*o+a*i-u*n)),eA(e,t,r),e},getTranslation:tA,getScaling:rA,getRotation:nA,fromRotationTranslationScale:function(e,t,r,n){var i=t[0],o=t[1],s=t[2],a=t[3],u=i+i,c=o+o,l=s+s,h=i*u,p=i*c,d=i*l,f=o*c,A=o*l,g=s*l,_=a*u,m=a*c,y=a*l,E=n[0],x=n[1],C=n[2];return e[0]=(1-(f+g))*E,e[1]=(p+y)*E,e[2]=(d-m)*E,e[3]=0,e[4]=(p-y)*x,e[5]=(1-(h+g))*x,e[6]=(A+_)*x,e[7]=0,e[8]=(d+m)*C,e[9]=(A-_)*C,e[10]=(1-(h+f))*C,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,r,n,i){var o=t[0],s=t[1],a=t[2],u=t[3],c=o+o,l=s+s,h=a+a,p=o*c,d=o*l,f=o*h,A=s*l,g=s*h,_=a*h,m=u*c,y=u*l,E=u*h,x=n[0],C=n[1],b=n[2],I=i[0],T=i[1],v=i[2],R=(1-(A+_))*x,M=(d+E)*x,w=(f-y)*x,S=(d-E)*C,B=(1-(p+_))*C,O=(g+m)*C,D=(f+y)*b,F=(g-m)*b,P=(1-(p+A))*b;return e[0]=R,e[1]=M,e[2]=w,e[3]=0,e[4]=S,e[5]=B,e[6]=O,e[7]=0,e[8]=D,e[9]=F,e[10]=P,e[11]=0,e[12]=r[0]+I-(R*I+S*T+D*v),e[13]=r[1]+T-(M*I+B*T+F*v),e[14]=r[2]+v-(w*I+O*T+P*v),e[15]=1,e},fromQuat:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=r+r,a=n+n,u=i+i,c=r*s,l=n*s,h=n*a,p=i*s,d=i*a,f=i*u,A=o*s,g=o*a,_=o*u;return e[0]=1-h-f,e[1]=l+_,e[2]=p-g,e[3]=0,e[4]=l-_,e[5]=1-c-f,e[6]=d+A,e[7]=0,e[8]=p+g,e[9]=d-A,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,r,n,i,o,s){var a=1/(r-t),u=1/(i-n),c=1/(o-s);return e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(i+n)*u,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0,e},perspective:function(e,t,r,n,i){var o,s=1/Math.tan(t/2);return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(n-i),e[10]=(i+n)*o,e[14]=2*i*n*o):(e[10]=-1,e[14]=-2*n),e},perspectiveFromFieldOfView:function(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),u=2/(s+a),c=2/(i+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(s-a)*u*.5,e[9]=(i-o)*c*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e},ortho:function(e,t,r,n,i,o,s){var a=1/(t-r),u=1/(n-i),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(i+n)*u,e[14]=(s+o)*c,e[15]=1,e},lookAt:function(e,t,r,n){var i,o,s,a,u,c,l,h,p,d,f=t[0],A=t[1],g=t[2],_=n[0],m=n[1],y=n[2],E=r[0],x=r[1],C=r[2];return Math.abs(f-E)<Bf&&Math.abs(A-x)<Bf&&Math.abs(g-C)<Bf?Zf(e):(l=f-E,h=A-x,p=g-C,i=m*(p*=d=1/Math.hypot(l,h,p))-y*(h*=d),o=y*(l*=d)-_*p,s=_*h-m*l,(d=Math.hypot(i,o,s))?(i*=d=1/d,o*=d,s*=d):(i=0,o=0,s=0),a=h*s-p*o,u=p*i-l*s,c=l*o-h*i,(d=Math.hypot(a,u,c))?(a*=d=1/d,u*=d,c*=d):(a=0,u=0,c=0),e[0]=i,e[1]=a,e[2]=l,e[3]=0,e[4]=o,e[5]=u,e[6]=h,e[7]=0,e[8]=s,e[9]=c,e[10]=p,e[11]=0,e[12]=-(i*f+o*A+s*g),e[13]=-(a*f+u*A+c*g),e[14]=-(l*f+h*A+p*g),e[15]=1,e)},targetTo:function(e,t,r,n){var i=t[0],o=t[1],s=t[2],a=n[0],u=n[1],c=n[2],l=i-r[0],h=o-r[1],p=s-r[2],d=l*l+h*h+p*p;d>0&&(l*=d=1/Math.sqrt(d),h*=d,p*=d);var f=u*p-c*h,A=c*l-a*p,g=a*h-u*l;return(d=f*f+A*A+g*g)>0&&(f*=d=1/Math.sqrt(d),A*=d,g*=d),e[0]=f,e[1]=A,e[2]=g,e[3]=0,e[4]=h*g-p*A,e[5]=p*f-l*g,e[6]=l*A-h*f,e[7]=0,e[8]=l,e[9]=h,e[10]=p,e[11]=0,e[12]=i,e[13]=o,e[14]=s,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},subtract:iA,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],c=e[7],l=e[8],h=e[9],p=e[10],d=e[11],f=e[12],A=e[13],g=e[14],_=e[15],m=t[0],y=t[1],E=t[2],x=t[3],C=t[4],b=t[5],I=t[6],T=t[7],v=t[8],R=t[9],M=t[10],w=t[11],S=t[12],B=t[13],O=t[14],D=t[15];return Math.abs(r-m)<=Bf*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(n-y)<=Bf*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-E)<=Bf*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(o-x)<=Bf*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-C)<=Bf*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(a-b)<=Bf*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(u-I)<=Bf*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(c-T)<=Bf*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(l-v)<=Bf*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(h-R)<=Bf*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(p-M)<=Bf*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(d-w)<=Bf*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(f-S)<=Bf*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(A-B)<=Bf*Math.max(1,Math.abs(A),Math.abs(B))&&Math.abs(g-O)<=Bf*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(_-D)<=Bf*Math.max(1,Math.abs(_),Math.abs(D))},mul:oA,sub:sA});function uA(){var e=new Of(3);return Of!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function cA(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function lA(e,t,r){var n=new Of(3);return n[0]=e,n[1]=t,n[2]=r,n}function hA(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function pA(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function dA(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function fA(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.hypot(r,n,i)}function AA(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function gA(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function _A(e,t){var r=t[0],n=t[1],i=t[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function mA(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function yA(e,t,r){var n=t[0],i=t[1],o=t[2],s=r[0],a=r[1],u=r[2];return e[0]=i*u-o*a,e[1]=o*s-n*u,e[2]=n*a-i*s,e}var EA,xA=hA,CA=pA,bA=dA,IA=fA,TA=AA,vA=cA,RA=gA,MA=(EA=uA(),function(e,t,r,n,i,o){var s,a;for(t||(t=3),r||(r=0),a=n?Math.min(n*t+r,e.length):e.length,s=r;s<a;s+=t)EA[0]=e[s],EA[1]=e[s+1],EA[2]=e[s+2],i(EA,EA,o),e[s]=EA[0],e[s+1]=EA[1],e[s+2]=EA[2];return e}),wA=Object.freeze({create:uA,clone:function(e){var t=new Of(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:cA,fromValues:lA,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},subtract:hA,multiply:pA,divide:dA,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e},distance:fA,squaredDistance:AA,squaredLength:gA,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:_A,dot:mA,cross:yA,lerp:function(e,t,r,n){var i=t[0],o=t[1],s=t[2];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=s+n*(r[2]-s),e},hermite:function(e,t,r,n,i,o){var s=o*o,a=s*(2*o-3)+1,u=s*(o-2)+o,c=s*(o-1),l=s*(3-2*o);return e[0]=t[0]*a+r[0]*u+n[0]*c+i[0]*l,e[1]=t[1]*a+r[1]*u+n[1]*c+i[1]*l,e[2]=t[2]*a+r[2]*u+n[2]*c+i[2]*l,e},bezier:function(e,t,r,n,i,o){var s=1-o,a=s*s,u=o*o,c=a*s,l=3*o*a,h=3*u*s,p=u*o;return e[0]=t[0]*c+r[0]*l+n[0]*h+i[0]*p,e[1]=t[1]*c+r[1]*l+n[1]*h+i[1]*p,e[2]=t[2]*c+r[2]*l+n[2]*h+i[2]*p,e},random:function(e,t){t=t||1;var r=2*Df()*Math.PI,n=2*Df()-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e},transformMat4:function(e,t,r){var n=t[0],i=t[1],o=t[2],s=r[3]*n+r[7]*i+r[11]*o+r[15];return s=s||1,e[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/s,e[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/s,e[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/s,e},transformMat3:function(e,t,r){var n=t[0],i=t[1],o=t[2];return e[0]=n*r[0]+i*r[3]+o*r[6],e[1]=n*r[1]+i*r[4]+o*r[7],e[2]=n*r[2]+i*r[5]+o*r[8],e},transformQuat:function(e,t,r){var n=r[0],i=r[1],o=r[2],s=r[3],a=t[0],u=t[1],c=t[2],l=i*c-o*u,h=o*a-n*c,p=n*u-i*a,d=i*p-o*h,f=o*l-n*p,A=n*h-i*l,g=2*s;return l*=g,h*=g,p*=g,d*=2,f*=2,A*=2,e[0]=a+l+d,e[1]=u+h+f,e[2]=c+p+A,e},rotateX:function(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},rotateY:function(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},rotateZ:function(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},angle:function(e,t){var r=lA(e[0],e[1],e[2]),n=lA(t[0],t[1],t[2]);_A(r,r),_A(n,n);var i=mA(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,t){var r=e[0],n=e[1],i=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(r-o)<=Bf*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=Bf*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=Bf*Math.max(1,Math.abs(i),Math.abs(a))},sub:xA,mul:CA,div:bA,dist:IA,sqrDist:TA,len:vA,sqrLen:RA,forEach:MA});function SA(){var e=new Of(4);return Of!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function BA(e){var t=new Of(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function OA(e,t,r,n){var i=new Of(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function DA(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function FA(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function PA(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function NA(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function LA(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function UA(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function GA(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function QA(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.hypot(r,n,i,o)}function kA(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return r*r+n*n+i*i+o*o}function zA(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.hypot(t,r,n,i)}function jA(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function HA(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=r*r+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=n*s,e[2]=i*s,e[3]=o*s,e}function qA(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function VA(e,t,r,n){var i=t[0],o=t[1],s=t[2],a=t[3];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=s+n*(r[2]-s),e[3]=a+n*(r[3]-a),e}function YA(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function XA(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],s=t[0],a=t[1],u=t[2],c=t[3];return Math.abs(r-s)<=Bf*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=Bf*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-u)<=Bf*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=Bf*Math.max(1,Math.abs(o),Math.abs(c))}var WA=NA,KA=LA,JA=UA,ZA=QA,$A=kA,eg=zA,tg=jA,rg=function(){var e=SA();return function(t,r,n,i,o,s){var a,u;for(r||(r=4),n||(n=0),u=i?Math.min(i*r+n,t.length):t.length,a=n;a<u;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}(),ng=Object.freeze({create:SA,clone:BA,fromValues:OA,copy:DA,set:FA,add:PA,subtract:NA,multiply:LA,divide:UA,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:GA,scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},distance:QA,squaredDistance:kA,length:zA,squaredLength:jA,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:HA,dot:qA,cross:function(e,t,r,n){var i=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],s=r[0]*n[3]-r[3]*n[0],a=r[1]*n[2]-r[2]*n[1],u=r[1]*n[3]-r[3]*n[1],c=r[2]*n[3]-r[3]*n[2],l=t[0],h=t[1],p=t[2],d=t[3];return e[0]=h*c-p*u+d*a,e[1]=-l*c+p*s-d*o,e[2]=l*u-h*s+d*i,e[3]=-l*a+h*o-p*i,e},lerp:VA,random:function(e,t){var r,n,i,o,s,a;t=t||1;do{s=(r=2*Df()-1)*r+(n=2*Df()-1)*n}while(s>=1);do{a=(i=2*Df()-1)*i+(o=2*Df()-1)*o}while(a>=1);var u=Math.sqrt((1-s)/a);return e[0]=t*r,e[1]=t*n,e[2]=t*i*u,e[3]=t*o*u,e},transformMat4:function(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*s,e[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*s,e[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*s,e[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*s,e},transformQuat:function(e,t,r){var n=t[0],i=t[1],o=t[2],s=r[0],a=r[1],u=r[2],c=r[3],l=c*n+a*o-u*i,h=c*i+u*n-s*o,p=c*o+s*i-a*n,d=-s*n-a*i-u*o;return e[0]=l*c+d*-s+h*-u-p*-a,e[1]=h*c+d*-a+p*-s-l*-u,e[2]=p*c+d*-u+l*-a-h*-s,e[3]=t[3],e},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:YA,equals:XA,sub:WA,mul:KA,div:JA,dist:ZA,sqrDist:$A,len:eg,sqrLen:tg,forEach:rg});function ig(){var e=new Of(4);return Of!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function og(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function sg(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=r[0],u=r[1],c=r[2],l=r[3];return e[0]=n*l+s*a+i*c-o*u,e[1]=i*l+s*u+o*a-n*c,e[2]=o*l+s*c+n*u-i*a,e[3]=s*l-n*a-i*u-o*c,e}function ag(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(r),u=Math.cos(r);return e[0]=n*u+s*a,e[1]=i*u+o*a,e[2]=o*u-i*a,e[3]=s*u-n*a,e}function ug(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(r),u=Math.cos(r);return e[0]=n*u-o*a,e[1]=i*u+s*a,e[2]=o*u+n*a,e[3]=s*u-i*a,e}function cg(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(r),u=Math.cos(r);return e[0]=n*u+i*a,e[1]=i*u-n*a,e[2]=o*u+s*a,e[3]=s*u-o*a,e}function lg(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=Math.sqrt(r*r+n*n+i*i),a=Math.exp(o),u=s>0?a*Math.sin(s)/s:0;return e[0]=r*u,e[1]=n*u,e[2]=i*u,e[3]=a*Math.cos(s),e}function hg(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=Math.sqrt(r*r+n*n+i*i),a=s>0?Math.atan2(s,o)/s:0;return e[0]=r*a,e[1]=n*a,e[2]=i*a,e[3]=.5*Math.log(r*r+n*n+i*i+o*o),e}function pg(e,t,r,n){var i,o,s,a,u,c=t[0],l=t[1],h=t[2],p=t[3],d=r[0],f=r[1],A=r[2],g=r[3];return(o=c*d+l*f+h*A+p*g)<0&&(o=-o,d=-d,f=-f,A=-A,g=-g),1-o>Bf?(i=Math.acos(o),s=Math.sin(i),a=Math.sin((1-n)*i)/s,u=Math.sin(n*i)/s):(a=1-n,u=n),e[0]=a*c+u*d,e[1]=a*l+u*f,e[2]=a*h+u*A,e[3]=a*p+u*g,e}function dg(e,t){var r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var o=(i+1)%3,s=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*o+o]-t[3*s+s]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*o+s]-t[3*s+o])*r,e[o]=(t[3*o+i]+t[3*i+o])*r,e[s]=(t[3*s+i]+t[3*i+s])*r}return e}var fg,Ag,gg,_g,mg,yg,Eg=BA,xg=OA,Cg=DA,bg=FA,Ig=PA,Tg=sg,vg=GA,Rg=qA,Mg=VA,wg=zA,Sg=wg,Bg=jA,Og=Bg,Dg=HA,Fg=YA,Pg=XA,Ng=(fg=uA(),Ag=lA(1,0,0),gg=lA(0,1,0),function(e,t,r){var n=mA(t,r);return n<-.999999?(yA(fg,Ag,t),vA(fg)<1e-6&&yA(fg,gg,t),_A(fg,fg),og(e,fg,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(yA(fg,t,r),e[0]=fg[0],e[1]=fg[1],e[2]=fg[2],e[3]=1+n,Dg(e,e))}),Lg=(_g=ig(),mg=ig(),function(e,t,r,n,i,o){return pg(_g,t,i,o),pg(mg,r,n,o),pg(e,_g,mg,2*o*(1-o)),e}),Ug=(yg=Vf(),function(e,t,r,n){return yg[0]=r[0],yg[3]=r[1],yg[6]=r[2],yg[1]=n[0],yg[4]=n[1],yg[7]=n[2],yg[2]=-t[0],yg[5]=-t[1],yg[8]=-t[2],Dg(e,dg(e,yg))}),Gg=Object.freeze({create:ig,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:og,getAxisAngle:function(e,t){var r=2*Math.acos(t[3]),n=Math.sin(r/2);return n>Bf?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r},getAngle:function(e,t){var r=Rg(e,t);return Math.acos(2*r*r-1)},multiply:sg,rotateX:ag,rotateY:ug,rotateZ:cg,calculateW:function(e,t){var r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e},exp:lg,ln:hg,pow:function(e,t,r){return hg(e,t),vg(e,e,r),lg(e,e),e},slerp:pg,random:function(e){var t=Df(),r=Df(),n=Df(),i=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*r),e[1]=i*Math.cos(2*Math.PI*r),e[2]=o*Math.sin(2*Math.PI*n),e[3]=o*Math.cos(2*Math.PI*n),e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=r*r+n*n+i*i+o*o,a=s?1/s:0;return e[0]=-r*a,e[1]=-n*a,e[2]=-i*a,e[3]=o*a,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},fromMat3:dg,fromEuler:function(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var o=Math.sin(t),s=Math.cos(t),a=Math.sin(r),u=Math.cos(r),c=Math.sin(n),l=Math.cos(n);return e[0]=o*u*l-s*a*c,e[1]=s*a*l+o*u*c,e[2]=s*u*c-o*a*l,e[3]=s*u*l+o*a*c,e},str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},clone:Eg,fromValues:xg,copy:Cg,set:bg,add:Ig,mul:Tg,scale:vg,dot:Rg,lerp:Mg,length:wg,len:Sg,squaredLength:Bg,sqrLen:Og,normalize:Dg,exactEquals:Fg,equals:Pg,rotationTo:Ng,sqlerp:Lg,setAxes:Ug});function Qg(e,t,r){var n=.5*r[0],i=.5*r[1],o=.5*r[2],s=t[0],a=t[1],u=t[2],c=t[3];return e[0]=s,e[1]=a,e[2]=u,e[3]=c,e[4]=n*c+i*u-o*a,e[5]=i*c+o*s-n*u,e[6]=o*c+n*a-i*s,e[7]=-n*s-i*a-o*u,e}function kg(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}var zg=Cg;var jg=Cg;function Hg(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=r[4],u=r[5],c=r[6],l=r[7],h=t[4],p=t[5],d=t[6],f=t[7],A=r[0],g=r[1],_=r[2],m=r[3];return e[0]=n*m+s*A+i*_-o*g,e[1]=i*m+s*g+o*A-n*_,e[2]=o*m+s*_+n*g-i*A,e[3]=s*m-n*A-i*g-o*_,e[4]=n*l+s*a+i*c-o*u+h*m+f*A+p*_-d*g,e[5]=i*l+s*u+o*a-n*c+p*m+f*g+d*A-h*_,e[6]=o*l+s*c+n*u-i*a+d*m+f*_+h*g-p*A,e[7]=s*l-n*a-i*u-o*c+f*m-h*A-p*g-d*_,e}var qg=Hg;var Vg=Rg;var Yg=wg,Xg=Yg,Wg=Bg,Kg=Wg;var Jg=Object.freeze({create:function(){var e=new Of(8);return Of!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},clone:function(e){var t=new Of(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},fromValues:function(e,t,r,n,i,o,s,a){var u=new Of(8);return u[0]=e,u[1]=t,u[2]=r,u[3]=n,u[4]=i,u[5]=o,u[6]=s,u[7]=a,u},fromRotationTranslationValues:function(e,t,r,n,i,o,s){var a=new Of(8);a[0]=e,a[1]=t,a[2]=r,a[3]=n;var u=.5*i,c=.5*o,l=.5*s;return a[4]=u*n+c*r-l*t,a[5]=c*n+l*e-u*r,a[6]=l*n+u*t-c*e,a[7]=-u*e-c*t-l*r,a},fromRotationTranslation:Qg,fromTranslation:function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},fromRotation:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},fromMat4:function(e,t){var r=ig();nA(r,t);var n=new Of(3);return tA(n,t),Qg(e,r,n),e},copy:kg,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},set:function(e,t,r,n,i,o,s,a,u){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=u,e},getReal:zg,getDual:function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},setReal:jg,setDual:function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},getTranslation:function(e,t){var r=t[4],n=t[5],i=t[6],o=t[7],s=-t[0],a=-t[1],u=-t[2],c=t[3];return e[0]=2*(r*c+o*s+n*u-i*a),e[1]=2*(n*c+o*a+i*s-r*u),e[2]=2*(i*c+o*u+r*a-n*s),e},translate:function(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=.5*r[0],u=.5*r[1],c=.5*r[2],l=t[4],h=t[5],p=t[6],d=t[7];return e[0]=n,e[1]=i,e[2]=o,e[3]=s,e[4]=s*a+i*c-o*u+l,e[5]=s*u+o*a-n*c+h,e[6]=s*c+n*u-i*a+p,e[7]=-n*a-i*u-o*c+d,e},rotateX:function(e,t,r){var n=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],h=a*s+l*n+u*o-c*i,p=u*s+l*i+c*n-a*o,d=c*s+l*o+a*i-u*n,f=l*s-a*n-u*i-c*o;return ag(e,t,r),n=e[0],i=e[1],o=e[2],s=e[3],e[4]=h*s+f*n+p*o-d*i,e[5]=p*s+f*i+d*n-h*o,e[6]=d*s+f*o+h*i-p*n,e[7]=f*s-h*n-p*i-d*o,e},rotateY:function(e,t,r){var n=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],h=a*s+l*n+u*o-c*i,p=u*s+l*i+c*n-a*o,d=c*s+l*o+a*i-u*n,f=l*s-a*n-u*i-c*o;return ug(e,t,r),n=e[0],i=e[1],o=e[2],s=e[3],e[4]=h*s+f*n+p*o-d*i,e[5]=p*s+f*i+d*n-h*o,e[6]=d*s+f*o+h*i-p*n,e[7]=f*s-h*n-p*i-d*o,e},rotateZ:function(e,t,r){var n=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],h=a*s+l*n+u*o-c*i,p=u*s+l*i+c*n-a*o,d=c*s+l*o+a*i-u*n,f=l*s-a*n-u*i-c*o;return cg(e,t,r),n=e[0],i=e[1],o=e[2],s=e[3],e[4]=h*s+f*n+p*o-d*i,e[5]=p*s+f*i+d*n-h*o,e[6]=d*s+f*o+h*i-p*n,e[7]=f*s-h*n-p*i-d*o,e},rotateByQuatAppend:function(e,t,r){var n=r[0],i=r[1],o=r[2],s=r[3],a=t[0],u=t[1],c=t[2],l=t[3];return e[0]=a*s+l*n+u*o-c*i,e[1]=u*s+l*i+c*n-a*o,e[2]=c*s+l*o+a*i-u*n,e[3]=l*s-a*n-u*i-c*o,a=t[4],u=t[5],c=t[6],l=t[7],e[4]=a*s+l*n+u*o-c*i,e[5]=u*s+l*i+c*n-a*o,e[6]=c*s+l*o+a*i-u*n,e[7]=l*s-a*n-u*i-c*o,e},rotateByQuatPrepend:function(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=r[0],u=r[1],c=r[2],l=r[3];return e[0]=n*l+s*a+i*c-o*u,e[1]=i*l+s*u+o*a-n*c,e[2]=o*l+s*c+n*u-i*a,e[3]=s*l-n*a-i*u-o*c,a=r[4],u=r[5],c=r[6],l=r[7],e[4]=n*l+s*a+i*c-o*u,e[5]=i*l+s*u+o*a-n*c,e[6]=o*l+s*c+n*u-i*a,e[7]=s*l-n*a-i*u-o*c,e},rotateAroundAxis:function(e,t,r,n){if(Math.abs(n)<Bf)return kg(e,t);var i=Math.hypot(r[0],r[1],r[2]);n*=.5;var o=Math.sin(n),s=o*r[0]/i,a=o*r[1]/i,u=o*r[2]/i,c=Math.cos(n),l=t[0],h=t[1],p=t[2],d=t[3];e[0]=l*c+d*s+h*u-p*a,e[1]=h*c+d*a+p*s-l*u,e[2]=p*c+d*u+l*a-h*s,e[3]=d*c-l*s-h*a-p*u;var f=t[4],A=t[5],g=t[6],_=t[7];return e[4]=f*c+_*s+A*u-g*a,e[5]=A*c+_*a+g*s-f*u,e[6]=g*c+_*u+f*a-A*s,e[7]=_*c-f*s-A*a-g*u,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e},multiply:Hg,mul:qg,scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e},dot:Vg,lerp:function(e,t,r,n){var i=1-n;return Vg(t,r)<0&&(n=-n),e[0]=t[0]*i+r[0]*n,e[1]=t[1]*i+r[1]*n,e[2]=t[2]*i+r[2]*n,e[3]=t[3]*i+r[3]*n,e[4]=t[4]*i+r[4]*n,e[5]=t[5]*i+r[5]*n,e[6]=t[6]*i+r[6]*n,e[7]=t[7]*i+r[7]*n,e},invert:function(e,t){var r=Wg(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},length:Yg,len:Xg,squaredLength:Wg,sqrLen:Kg,normalize:function(e,t){var r=Wg(t);if(r>0){r=Math.sqrt(r);var n=t[0]/r,i=t[1]/r,o=t[2]/r,s=t[3]/r,a=t[4],u=t[5],c=t[6],l=t[7],h=n*a+i*u+o*c+s*l;e[0]=n,e[1]=i,e[2]=o,e[3]=s,e[4]=(a-n*h)/r,e[5]=(u-i*h)/r,e[6]=(c-o*h)/r,e[7]=(l-s*h)/r}return e},str:function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},equals:function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],c=e[7],l=t[0],h=t[1],p=t[2],d=t[3],f=t[4],A=t[5],g=t[6],_=t[7];return Math.abs(r-l)<=Bf*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(n-h)<=Bf*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-p)<=Bf*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-d)<=Bf*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-f)<=Bf*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-A)<=Bf*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(u-g)<=Bf*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(c-_)<=Bf*Math.max(1,Math.abs(c),Math.abs(_))}});function Zg(){var e=new Of(2);return Of!=Float32Array&&(e[0]=0,e[1]=0),e}function $g(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function e_(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function t_(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function r_(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.hypot(r,n)}function n_(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function i_(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function o_(e){var t=e[0],r=e[1];return t*t+r*r}var s_=i_,a_=$g,u_=e_,c_=t_,l_=r_,h_=n_,p_=o_,d_=function(){var e=Zg();return function(t,r,n,i,o,s){var a,u;for(r||(r=2),n||(n=0),u=i?Math.min(i*r+n,t.length):t.length,a=n;a<u;a+=r)e[0]=t[a],e[1]=t[a+1],o(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}}(),f_=Object.freeze({create:Zg,clone:function(e){var t=new Of(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var r=new Of(2);return r[0]=e,r[1]=t,r},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,r){return e[0]=t,e[1]=r,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},subtract:$g,multiply:e_,divide:t_,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},distance:r_,squaredDistance:n_,length:i_,squaredLength:o_,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:function(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},cross:function(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e},lerp:function(e,t,r,n){var i=t[0],o=t[1];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e},random:function(e,t){t=t||1;var r=2*Df()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},transformMat2:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e},transformMat2d:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e},transformMat3:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e},transformMat4:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e},rotate:function(e,t,r,n){var i=t[0]-r[0],o=t[1]-r[1],s=Math.sin(n),a=Math.cos(n);return e[0]=i*a-o*s+r[0],e[1]=i*s+o*a+r[1],e},angle:function(e,t){var r=e[0],n=e[1],i=t[0],o=t[1],s=r*r+n*n;s>0&&(s=1/Math.sqrt(s));var a=i*i+o*o;a>0&&(a=1/Math.sqrt(a));var u=(r*i+n*o)*s*a;return u>1?0:u<-1?Math.PI:Math.acos(u)},zero:function(e){return e[0]=0,e[1]=0,e},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equals:function(e,t){var r=e[0],n=e[1],i=t[0],o=t[1];return Math.abs(r-i)<=Bf*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-o)<=Bf*Math.max(1,Math.abs(n),Math.abs(o))},len:s_,sub:a_,mul:u_,div:c_,dist:l_,sqrDist:h_,sqrLen:p_,forEach:d_});Sf.glMatrix=Pf,Sf.mat2=Qf,Sf.mat2d=qf,Sf.mat3=Jf,Sf.mat4=aA,Sf.quat=Gg,Sf.quat2=Jg,Sf.vec2=f_,Sf.vec3=wA,Sf.vec4=ng;class A_{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof m_?new m_(e.lng,e.lat):m_.convert(e),this}setSouthWest(e){return this._sw=e instanceof m_?new m_(e.lng,e.lat):m_.convert(e),this}extend(e){const t=this._sw,r=this._ne;let n,i;if(e instanceof m_)n=e,i=e;else{if(!(e instanceof A_))return Array.isArray(e)?e.every(Array.isArray)?this.extend(A_.convert(e)):this.extend(m_.convert(e)):this;if(n=e._sw,i=e._ne,!n||!i)return this}return t||r?(t.lng=Math.min(n.lng,t.lng),t.lat=Math.min(n.lat,t.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new m_(n.lng,n.lat),this._ne=new m_(i.lng,i.lat)),this}getCenter(){return new m_((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new m_(this.getWest(),this.getNorth())}getSouthEast(){return new m_(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:r}=m_.convert(e),n=this._sw.lat<=r&&r<=this._ne.lat;let i=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=t&&t>=this._ne.lng),n&&i}static convert(e){return!e||e instanceof A_?e:new A_(e)}}const g_=6371008.8,__=2*Math.PI*g_;class m_{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);this.lng=+e,this.lat=+t,this.lat>90||this.lat}wrap(){return new m_(sl(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,r=this.lat*t,n=e.lat*t,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return g_*Math.acos(Math.min(i,1))}toBounds(e=0){const t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new A_(new m_(this.lng-r,this.lat-t),new m_(this.lng+r,this.lat+t))}static convert(e){if(e instanceof m_)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new m_(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new m_(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function y_(e,t){return e/(r=t,__*Math.cos(r*Math.PI/180));var r}function E_(e){return 360*e-180}function x_(e){const t=180-360*e;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}const C_=85.051129;var b_=new yo,I_=new Zt;function T_(e,t,r,n){const i=ml(e.crs,t,r,n),o=[0,0,0,1];Sf.vec4.transformMat4(o,[i.x,i.y,i.z,1],e.sceneViewProjMatrix);const s=o[3];o[0]/=s,o[1]/=s,o[2]/=s;var a=new Zt(o[0],o[1],o[2]),u={x:0,y:0,width:e.width,height:e.height},c=yo.computeViewportTransformation(u,0,1,b_),l=yo.multiplyByPoint(c,a,I_);return new zt(l.x,l.y)}function v_(e,t,r,n,i,o,s,a,u){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(u*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical;r.projection.upVectorScale(c,r.center.lat,r.worldSize).metersToTile;for(const i of t)for(const t of i){const i=t.add(a),l=0,h=o?i:T_(r,i.x,i.y,c),p=o?e.tilespaceRays.map((e=>w_(e,l))):e.tilespaceGeometry.map((e=>T_(r,e.x,e.y,c))),d=Sf.vec4.transformMat4([],[h.x,h.y,0,1],n);if(!s&&o&&(u*=d[3]/r.cameraToCenterDistance),o){const e=x_((t.y/va+c.y)/(1<<c.z));u/=r.projection.pixelsPerMeter(e,1)/y_(1,e)}if(ff(p,h,u))return!0}return!1}const R_=Sf.vec3.fromValues(0,0,0),M_=Sf.vec3.fromValues(0,0,1);function w_(e,t){const r=Sf.vec3.create();return R_[2]=t,e.intersectsPlane(R_,M_,r),new zt(r[0],r[1])}var S_={paint:new Zl({"heatmap-radius":new Kl(Ud.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kl(Ud.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Wl(Ud.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Jl(Ud.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Wl(Ud.paint_heatmap["heatmap-opacity"])})};function B_(e,{width:t,height:r},n,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==t*r*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(t*r*n);return e.width=t,e.height=r,e.data=i,e}function O_(e,t,r){const{width:n,height:i}=t;n===e.width&&i===e.height||(D_(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,i)},r),e.width=n,e.height=i,e.data=t.data)}function D_(e,t,r,n,i,o){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;for(let u=0;u<i.height;u++){const c=((r.y+u)*e.width+r.x)*o,l=((n.y+u)*t.width+n.x)*o;for(let e=0;e<i.width*o;e++)a[l+e]=s[c+e]}return t}class F_{constructor(e,t){B_(this,e,1,t)}resize(e){O_(this,new F_(e),1)}clone(){return new F_({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){D_(e,t,r,n,i,1)}}class P_{constructor(e,t){B_(this,e,4,t)}resize(e){O_(this,new P_(e),4)}replace(e,t){t?this.data.set(e):e instanceof Uint8ClampedArray?this.data=new Uint8Array(e.buffer):this.data=e}clone(){return new P_({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){D_(e,t,r,n,i,4)}}function N_(e){const t={},r=e.resolution||256,n=e.clips?e.clips.length:1,i=e.image||new P_({width:r,height:n});var o;o=r,Math.log(o)/Math.LN2%1!=0&&console.log("renderColorRamp width must be isPowerOfTwo.");const s=(r,n,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(evaluationGlobal);i.data[r+n+0]=Math.floor(255*s.r/s.a),i.data[r+n+1]=Math.floor(255*s.g/s.a),i.data[r+n+2]=Math.floor(255*s.b/s.a),i.data[r+n+3]=Math.floor(255*s.a)};if(e.clips)for(let t=0,i=0;t<n;++t,i+=4*r)for(let n=0,o=0;n<r;n++,o+=4){const a=n/(r-1),{start:u,end:c}=e.clips[t];s(i,o,u*(1-a)+c*a)}else for(let e=0,t=0;e<r;e++,t+=4){s(0,t,e/(r-1))}return i}Ml(F_,"AlphaImage"),Ml(P_,"RGBAImage");const L_=nh([{name:"a_pos",components:2,type:"Int16"}],4).members;function U_(e,t,r,n,i){G_(e,t,r||0,n||e.length-1,i||k_)}function G_(e,t,r,n,i){for(;n>r;){if(n-r>600){var o=n-r+1,s=t-r+1,a=Math.log(o),u=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*u*(o-u)/o)*(s-o/2<0?-1:1);G_(e,t,Math.max(r,Math.floor(t-s*u/o+c)),Math.min(n,Math.floor(t+(o-s)*u/o+c)),i)}var l=e[t],h=r,p=n;for(Q_(e,r,t),i(e[n],l)>0&&Q_(e,r,n);h<p;){for(Q_(e,h,p),h++,p--;i(e[h],l)<0;)h++;for(;i(e[p],l)>0;)p--}0===i(e[r],l)?Q_(e,r,p):Q_(e,++p,n),p<=t&&(r=p+1),t<=p&&(n=p-1)}}function Q_(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function k_(e,t){return e<t?-1:e>t?1:0}function z_(e){for(var t=0,r=0,n=e.length,i=n-1,o=void 0,s=void 0;r<n;i=r++)o=e[r],t+=((s=e[i]).x-o.x)*(o.y+s.y);return t}function j_(e,t){var r=e.length;if(r<=1)return[e];for(var n,i,o=[],s=0;s<r;s++){var a=z_(e[s]);0!==a&&(e[s].area=Math.abs(a),void 0===i&&(i=a<0),i===a<0?(n&&o.push(n),n=[e[s]]):n.push(e[s]))}if(n&&o.push(n),t>1)for(var u=0;u<o.length;u++)o[u].length<=t||(U_(o[u],t,1,o[u].length-1,H_),o[u]=o[u].slice(0,t));return o}function H_(e,t){return t.area-e.area}function q_(e,t,r){const n=r.patternDependencies;let i=!1;for(const r of t){const t=r.paint.get(`${e}-pattern`);t.isConstant()||(i=!0);const o=t.constantOr(null);o&&(i=!0,n[o]=!0)}return i}function V_(e,t,r,n,i){const o=i.patternDependencies;for(const s of t){const t=s.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:n},r,{},i.availableImages);e=e&&e.name?e.name:e,o[e]=!0,r.patterns[s.id]=e}}return r}class Y_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new oh,this.indexArray=new bh,this.indexArray2=new Dh,this.programConfigurations=new Bd(L_,e.layers,e.zoom),this.segments=new tf,this.segments2=new tf,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,r,n){this.hasPattern=q_("fill",this.layers,t);const i=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:n,id:s,index:a,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,c=af(n,e);if(!this.layers[0]._featureFilter.filter(new Ql(this.zoom),c,r))continue;const l=i?i.evaluate(c,{},r,t.availableImages):void 0,h={id:s,properties:n.properties,type:n.type,sourceLayerIndex:u,index:a,geometry:e?c.geometry:sf(n,r),patterns:{},sortKey:l};o.push(h)}i&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const n of o){const{geometry:i,index:o,sourceLayerIndex:s}=n;if(this.hasPattern){const e=V_("fill",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,i,o,r,{},t.availableImages);const a=e[o].feature;t.featureIndex.insert(a,i,o,s,this.index)}}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}addFeatures(e,t,r,n,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){if(!this.uploaded){if(null==this.layoutVertexArray)return;this.layoutVertexArray.length>0&&(this.layoutVertexBuffer=md.toVertexBuffer(e,this.layoutVertexArray,L_),this.indexArray.length>0&&(this.indexBuffer=md.toIndexBuffer(e,this.indexArray)),this.indexArray2.length>0&&(this.indexBuffer2=md.toIndexBuffer(e,this.indexArray2)))}this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&!this.layoutVertexBuffer.isDestroyed()&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,r,n,i,o){for(const e of j_(t,500)){let t=0;for(const r of e)t+=r.length;const r=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),n=r.vertexLength,i=[],o=[];for(const t of e){if(0===t.length)continue;if(t!==e[0]&&o.push(i.length/2),t.length>tf.MAX_VERTEX_ARRAY_LENGTH&&this.indexArray instanceof bh){let e=this.indexArray,t=this.indexArray2;this.indexArray=new Ih,this.indexArray2=new Fh,this.indexArray.copyFrom3ui6(e),this.indexArray2.copyFrom2ui4(t)}const r=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),n=r.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(n+t.length-1,n),i.push(t[0].x),i.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(n+e-1,n+e),i.push(t[e].x),i.push(t[e].y);r.vertexLength+=t.length,r.primitiveLength+=t.length}const s=hc(i,o);for(let e=0;e<s.length;e+=3)this.indexArray.emplaceBack(n+s[e],n+s[e+1],n+s[e+2]);r.vertexLength+=t,r.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,o,n)}}Ml(Y_,"FillBucket",{omit:["layers","patternFeatures"]});const X_=new Zl({"fill-sort-key":new Kl(Ud.layout_fill["fill-sort-key"])});var W_={paint:new Zl({"fill-antialias":new Wl(Ud.paint_fill["fill-antialias"]),"fill-opacity":new Kl(Ud.paint_fill["fill-opacity"]),"fill-color":new Kl(Ud.paint_fill["fill-color"]),"fill-outline-color":new Kl(Ud.paint_fill["fill-outline-color"]),"fill-translate":new Wl(Ud.paint_fill["fill-translate"]),"fill-translate-anchor":new Wl(Ud.paint_fill["fill-translate-anchor"]),"fill-pattern":new Kl(Ud.paint_fill["fill-pattern"])}),layout:X_};const K_=nh([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),J_=nh([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Z_=nh([{name:"a_ecef_pos_high",components:3,type:"Float32"},{name:"a_ecef_pos_low",components:3,type:"Float32"},{name:"a_pos_normal_3",components:3,type:"Float32"}]);let $_=new Zt;const em=["Unknown","Point","LineString","Polygon"],tm=Math.pow(2,13);function rm(e,t,r,n,i,o,s,a){e.emplaceBack((t<<1)+s,(r<<1)+o,(Math.floor(n*tm)<<1)+i,Math.round(a))}function nm(e,t,r,n){e.emplaceBack(t.x,t.y,t.z,r.x,r.y,r.z,n.x,n.y,n.z)}class im{constructor(){this.acc=new zt(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new zt(e.x,e.y),this.max=new zt(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const r=this.min,n=this.max;e.x<r.x?r.x=e.x:e.x>n.x&&(n.x=e.x),e.y<r.y?r.y=e.y:e.y>n.y&&(n.y=e.y),((0===e.x||e.x===va)&&e.x===t.x)!=((0===e.y||e.y===va)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,we(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>va!=e.x>va&&this.addBorderIntersection(1,we(t.y,e.y,(va-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,we(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>va!=e.y>va&&this.addBorderIntersection(3,we(t.x,e.x,(va-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];t<r[0]&&(r[0]=t),t>r[1]&&(r[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const r=0===e.x?0:1;this.addBorderIntersection(r,t.y),this.addBorderIntersection(r,e.y)}else{const r=0===e.y?2:3;this.addBorderIntersection(r,t.x),this.addBorderIntersection(r,e.x)}}centroid(){const e=this.polyCount.reduce(((e,t)=>e+t.edges),0);return 0!==e?this.acc.div(e)._round():new zt(0,0)}span(){return new zt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0)}}class om{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new ah,this.centroidVertexArray=new Yh,this.indexArray=new bh,this.programConfigurations=new Bd(K_.members,e.layers,e.zoom),this.segments=new tf,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.enableTerrain=e.enableTerrain}populate(e,t,r,n){this.features=[],this.hasPattern=q_("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(e){const t=40075017,r=e.y/(1<<e.z),n=Math.exp(Math.PI*(1-2*r));return 2*t*n/(n*n+1)/va/(1<<e.z)}(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:i,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,u=af(i,e);if(!this.layers[0]._featureFilter.filter(new Ql(this.zoom),u,r))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:e?u.geometry:sf(i,r),properties:i.properties,type:i.type,patterns:{}},l=this.layoutVertexArray.length;this.hasPattern?this.features.push(V_("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,s,r,{},t.availableImages,n,t.crs),t.featureIndex.insert(i,c.geometry,s,a,this.index,l)}this.sortBorders()}addFeatures(e,t,r,n,i){for(const o of this.features){const{geometry:s}=o;this.addFeature(o,s,o.index,t,r,n,i,e.crs)}this.sortBorders()}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){if(!this.uploaded){if(null==this.layoutVertexArray)return;this.layoutVertexArray.length>0&&(this.layoutVertexBuffer=md.toVertexBuffer(e,this.layoutVertexArray,K_.members),this.indexArray.length>0&&(this.indexBuffer=md.toIndexBuffer(e,this.indexArray)),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=md.toVertexBuffer(e,this.layoutVertexExtArray,Z_.members,!0)))}this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=md.toVertexBuffer(this.centroidVertexArray,J_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&!this.layoutVertexBuffer.isDestroyed()&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,r,n,i,o,s,a){const u=[new zt(0,0),new zt(va,va)];s.projection;const c=this.enableTerrain?new im:null,l="Polygon"===em[e.type];this.layoutVertexExtArray||(this.layoutVertexExtArray=new Sh);const h=j_(t,500);for(let e=h.length-1;e>=0;e--){const t=h[e];(0===t.length||((p=t[0]).every((e=>e.x<=0))||p.every((e=>e.x>=va))||p.every((e=>e.y<=0))||p.every((e=>e.y>=va))))&&h.splice(e,1)}var p;let d;d=[];for(const e of h)d.push({polygon:e,bounds:u});const f=l?this.edgeRadius:0;for(const{polygon:e,bounds:t}of d){let r=0,i=0;for(const t of e)l&&!t[0].equals(t[t.length-1])&&t.push(t[0]),i+=l?t.length-1:t.length;const o=this.segments.prepareSegment((l?5:4)*i,this.layoutVertexArray,this.indexArray);if(l){const t=[],i=[];r=o.vertexLength;for(const r of e){let s,u;r.length&&r!==e[0]&&i.push(t.length/2);{const e=r[0];s=r[1].sub(e)._perp()._unit()}for(let e=1;e<r.length;e++){const i=r[e],c=r[e===r.length-1?1:e+1];let{x:l,y:h}=i;if(f){u=c.sub(i)._perp()._unit();const e=s.add(u)._unit(),t=s.x*e.x+s.y*e.y,r=f*Math.min(4,1/t);l+=r*e.x,h+=r*e.y,s=u}rm(this.layoutVertexArray,l,h,0,0,1,1,0),o.vertexLength++,t.push(i.x,i.y);const p=this.layoutVertexExtArray,d=ml(a,l,h,n),A=uf.fromCartesian(d);Qi.WGS84.geodeticSurfaceNormal(d,$_),nm(p,A.high,A.low,$_)}}const s=hc(t,i);for(let e=0;e<s.length;e+=3)this.indexArray.emplaceBack(r+s[e],r+s[e+2],r+s[e+1]),o.primitiveLength++}for(const i of e){c&&i.length&&c.startRing(i[0]);let e,s,u,h=i.length>4&&lm(i[i.length-2],i[0],i[1]),p=f?am(i[i.length-2],i[0],i[1],f):0;{const e=i[0];s=i[1].sub(e)._perp()._unit()}let d=!0;for(let A=1,g=0;A<i.length;A++){let _=i[A-1],m=i[A];const y=i[A===i.length-1?1:A+1];if(c&&l&&c.currentPolyCount.top++,cm(m,_,t)){f&&(s=y.sub(m)._perp()._unit(),d=!d);continue}c&&c.append(m,_);const E=m.sub(_)._perp(),x=E.x/(Math.abs(E.x)+Math.abs(E.y)),C=E.y>0?1:0,b=_.dist(m);if(g+b>32768&&(g=0),f){u=y.sub(m)._perp()._unit();let e=um(_,m,y,sm(s,u),f);isNaN(e)&&(e=0);const t=m.sub(_)._unit();_=_.add(t.mult(p))._round(),m=m.add(t.mult(-e))._round(),p=e,s=u}const I=o.vertexLength,T=i.length>4&&lm(_,m,y);let v=hm(g,h,d);if(rm(this.layoutVertexArray,_.x,_.y,x,C,0,0,v),rm(this.layoutVertexArray,_.x,_.y,x,C,0,1,v),g+=b,v=hm(g,T,!d),h=T,rm(this.layoutVertexArray,m.x,m.y,x,C,0,0,v),rm(this.layoutVertexArray,m.x,m.y,x,C,0,1,v),o.vertexLength+=4,this.indexArray.emplaceBack(I+0,I+1,I+2),this.indexArray.emplaceBack(I+1,I+3,I+2),o.primitiveLength+=2,f){const n=r+(1===A?i.length-2:A-2),s=1===A?r:n+1;if(this.indexArray.emplaceBack(I+1,n,I+3),this.indexArray.emplaceBack(n,s,I+3),o.primitiveLength+=2,void 0===e&&(e=I),!cm(y,i[A],t)){const t=A===i.length-1?e:o.vertexLength;this.indexArray.emplaceBack(I+2,I+3,t),this.indexArray.emplaceBack(I+3,t+1,t),this.indexArray.emplaceBack(I+3,s,t+1),o.primitiveLength+=3}d=!d}const R=this.layoutVertexExtArray,M=ml(a,_.x,_.y,n),w=ml(a,m.x,m.y,n),S=uf.fromCartesian(M);Qi.WGS84.geodeticSurfaceNormal(M,$_),nm(R,S.high,S.low,$_),nm(R,S.high,S.low,$_);const B=uf.fromCartesian(w);Qi.WGS84.geodeticSurfaceNormal(w,$_),nm(R,B.high,B.low,$_),nm(R,B.high,B.low,$_)}l&&(r+=i.length-1)}}if(c&&c.polyCount.length>0){if(c.borders){c.vertexArrayOffset=this.centroidVertexArray.length;const e=c.borders,t=this.featuresOnBorder.push(c)-1;for(let r=0;r<4;r++)e[r][0]!==Number.MAX_VALUE&&this.borders[r].push(t)}this.encodeCentroid(c.borders?void 0:c.centroid(),c)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,o,n)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort(((t,r)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[r].borders[e][0]))}encodeCentroid(e,t,r=!0){let n,i;if(e)if(0!==e.y){const r=t.span()._mult(this.tileToMeter);n=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(r.x/10)),i=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(r.y/10))}else n=Math.ceil(7*(e.x+450)),i=0;else n=0,i=+r;let o=r?this.centroidVertexArray.length:t.vertexArrayOffset;for(const e of t.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*e.edges+e.top);for(let t=0;t<e.top;t++)this.centroidVertexArray.emplace(o++,n,i);for(let t=0;t<2*e.edges;t++)this.centroidVertexArray.emplace(o++,0,i),this.centroidVertexArray.emplace(o++,n,i)}}}function sm(e,t){const r=e.add(t)._unit();return e.x*r.x+e.y*r.y}function am(e,t,r,n){const i=t.sub(e)._perp()._unit(),o=r.sub(t)._perp()._unit();return um(e,t,r,sm(i,o),n)}function um(e,t,r,n,i){const o=Math.sqrt(1-n*n);return Math.min(e.dist(t)/3,t.dist(r)/3,i*o/n)}function cm(e,t,r){return e.x<r[0].x&&t.x<r[0].x||e.x>r[1].x&&t.x>r[1].x||e.y<r[0].y&&t.y<r[0].y||e.y>r[1].y&&t.y>r[1].y}function lm(e,t,r){if(e.x<0||e.x>=va||t.x<0||t.x>=va||r.x<0||r.x>=va)return!1;const n=r.sub(t),i=n.perp(),o=e.sub(t),s=(n.x*o.x+n.y*o.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(o.x*o.x+o.y*o.y)),a=i.x*o.x+i.y*o.y;return s>-.866&&a<0}function hm(e,t,r){const n=t?2|e:-3&e;return r?1|n:-2&n}Ml(om,"FillExtrusionBucket",{omit:["layers","features"]}),Ml(im,"PartMetadata");const pm=new Zl({"fill-extrusion-edge-radius":new Wl(Ud["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var dm={paint:new Zl({"fill-extrusion-opacity":new Wl(Ud["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kl(Ud["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Wl(Ud["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Wl(Ud["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Kl(Ud["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kl(Ud["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kl(Ud["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Wl(Ud["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Wl(Ud["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Wl(Ud["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new Wl(Ud["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:pm};class fm extends zt{constructor(e,t,r){super(e,t),this.z=r}}function Am(e,t){return e.x*t.x+e.y*t.y}function gm(e,t){if(1===e.length){let r=0;const n=t[r++];let i;for(;!i||n.equals(i);)if(i=t[r++],!i)return 1/0;for(;r<t.length;r++){const o=t[r],s=e[0],a=i.sub(n),u=o.sub(n),c=s.sub(n),l=Am(a,a),h=Am(a,u),p=Am(u,u),d=Am(c,a),f=Am(c,u),A=l*p-h*h,g=(p*d-h*f)/A,_=(l*f-h*d)/A,m=1-g-_,y=n.z*m+i.z*g+o.z*_;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const r of t)e=Math.min(e,r.z);return e}}const _m=nh([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4).members,mm=nh([{name:"a_packed",components:4,type:"Float32"}]).members,ym=["Unknown","Point","LineString","Polygon"],Em=Math.cos(Math.PI/180*37.5);class xm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new uh,this.layoutVertexArray2=new ch,this.indexArray=new bh,this.programConfigurations=new Bd(_m,e.layers,e.zoom),this.segments=new tf,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,r,n){this.hasPattern=q_("line",this.layers,t);const i=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:t,id:n,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,u=af(t,e);if(!this.layers[0]._featureFilter.filter(new Ql(this.zoom),u,r))continue;const c=i?i.evaluate(u,{},r):void 0,l={id:n,properties:t.properties,type:t.type,sourceLayerIndex:a,index:s,geometry:e?u.geometry:sf(t),patterns:{},sortKey:c};o.push(l)}i&&o.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:s,featureIndex:a}=t,u=this.addConstantDashes(s);for(const n of o){const{geometry:i,index:o,sourceLayerIndex:c}=n;if(u&&this.addFeatureDashes(n,s),this.hasPattern){const e=V_("line",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,i,o,r,s.positions,t.availableImages);const l=e[o].feature;a.insert(l,i,o,c,this.index)}}addConstantDashes(e){let t=!1;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,i=r.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==i.kind)t=!0;else{const t=i.value,r=n.value;if(!r)continue;e.addDash(r,t)}}return t}addFeatureDashes(e,t){const r=this.zoom;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,o=n.layout.get("line-cap").value;if("constant"===i.kind&&"constant"===o.kind)continue;let s,a;if("constant"===i.kind){if(s=i.value,!s)continue}else s=i.evaluate({zoom:r},e);a="constant"===o.kind?o.value:o.evaluate({zoom:r},e),t.addDash(s,a),e.patterns[n.id]=t.getKey(s,a)}}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}addFeatures(e,t,r,n,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){if(!this.uploaded){if(null==this.layoutVertexArray)return;0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=md.toVertexBuffer(this.layoutVertexArray2,mm)),0!=this.layoutVertexArray.length&&(this.layoutVertexBuffer=md.toVertexBuffer(e,this.layoutVertexArray,_m),this.indexBuffer=md.toIndexBuffer(e,this.indexArray))}this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&!this.layoutVertexBuffer.isDestroyed()&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end")){return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}}addFeature(e,t,r,n,i,o){const s=this.layers[0].layout,a=s.get("line-join").evaluate(e,{}),u=s.get("line-cap").evaluate(e,{}),c=s.get("line-miter-limit"),l=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const r of t)this.addLine(r,e,a,u,c,l);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,o,n)}addLine(e,t,r,n,i,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===ym[t.type];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;let u=0;for(;u<a-1&&e[u].equals(e[u+1]);)u++;if(a<(s?3:2))return;"bevel"===r&&(i=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0;if(10*a>tf.MAX_VERTEX_ARRAY_LENGTH&&this.indexArray instanceof bh){let e=this.indexArray;this.indexArray=new Ih,this.indexArray.copyFrom3ui6(e)}const l=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,p,d,f,A;this.e1=this.e2=-1,s&&(h=e[a-2],A=e[u].sub(h)._unit()._perp());for(let t=u;t<a;t++){if(d=t===a-1?s?e[u+1]:void 0:e[t+1],d&&e[t].equals(d))continue;A&&(f=A),h&&(p=h),h=e[t],A=d?d.sub(h)._unit()._perp():f,f=f||A;let g=f.add(A);0===g.x&&0===g.y||g._unit();const _=f.x*A.x+f.y*A.y,m=g.x*A.x+g.y*A.y,y=0!==m?1/m:1/0,E=2*Math.sqrt(2-2*m),x=m<Em&&p&&d,C=f.x*A.y-f.y*A.x>0;if(x&&t>u){const e=h.dist(p);if(e>2*c){const t=h.sub(h.sub(p)._mult(c/e)._round());this.updateDistance(p,t),this.addCurrentVertex(t,f,0,0,l),p=t}}const b=p&&d;let I=b?r:s?"butt":n;if(b&&"round"===I&&(y<o?I="miter":y<=2&&(I="fakeround")),"miter"===I&&y>i&&(I="bevel"),"bevel"===I&&(y>2&&(I="flipbevel"),y<i&&(I="miter")),p&&this.updateDistance(p,h),"miter"===I)g._mult(y),this.addCurrentVertex(h,g,0,0,l);else if("flipbevel"===I){if(y>100)g=A.mult(-1);else{const e=y*f.add(A).mag()/f.sub(A).mag();g._perp()._mult(e*(C?-1:1))}this.addCurrentVertex(h,g,0,0,l),this.addCurrentVertex(h,g.mult(-1),0,0,l)}else if("bevel"===I||"fakeround"===I){const e=-Math.sqrt(y*y-1),t=C?e:0,r=C?0:e;if(p&&this.addCurrentVertex(h,f,t,r,l),"fakeround"===I){const e=Math.round(180*E/Math.PI/20);for(let t=1;t<e;t++){let r=t/e;if(.5!==r){const e=r-.5;r+=r*e*(r-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*e*e+(.848013+_*(.215638*_-1.06021)))}const n=A.sub(f)._mult(r)._add(f)._unit()._mult(C?-1:1);this.addHalfVertex(h,n.x,n.y,!1,C,0,l)}}d&&this.addCurrentVertex(h,A,-t,-r,l)}else if("butt"===I)this.addCurrentVertex(h,g,0,0,l);else if("square"===I){const e=p?1:-1;p||this.addCurrentVertex(h,g,e,e,l),this.addCurrentVertex(h,g,0,0,l),p&&this.addCurrentVertex(h,g,e,e,l)}else"round"===I&&(p&&(this.addCurrentVertex(h,f,0,0,l),this.addCurrentVertex(h,f,1,1,l,!0)),d&&(this.addCurrentVertex(h,A,-1,-1,l,!0),this.addCurrentVertex(h,A,0,0,l)));if(x&&t<a-1){const e=h.dist(d);if(e>2*c){const t=h.add(d.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,A,0,0,l),h=t}}}}addCurrentVertex(e,t,r,n,i,o=!1){const s=t.x+t.y*r,a=t.y-t.x*r,u=-t.x+t.y*n,c=-t.y-t.x*n;this.addHalfVertex(e,s,a,o,!1,r,i),this.addHalfVertex(e,u,c,o,!0,-n,i)}addHalfVertex({x:e,y:t},r,n,i,o,s,a){this.layoutVertexArray.emplaceBack((e<<1)+(i?1:0),(t<<1)+(o?1:0),Math.round(63*r)+128,Math.round(63*n)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const u=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),a.primitiveLength++),o?this.e2=u:this.e1=u}updateScaledDistance(){if(this.lineClips){const e=this.lineClips.end-this.lineClips.start,t=this.totalDistance/e;this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Ml(xm,"LineBucket",{omit:["layers","patternFeatures"]});const Cm=new Zl({"line-cap":new Kl(Ud.layout_line["line-cap"]),"line-join":new Kl(Ud.layout_line["line-join"]),"line-miter-limit":new Wl(Ud.layout_line["line-miter-limit"]),"line-round-limit":new Wl(Ud.layout_line["line-round-limit"]),"line-sort-key":new Kl(Ud.layout_line["line-sort-key"])});var bm={paint:new Zl({"line-opacity":new Kl(Ud.paint_line["line-opacity"]),"line-color":new Kl(Ud.paint_line["line-color"]),"line-translate":new Wl(Ud.paint_line["line-translate"]),"line-translate-anchor":new Wl(Ud.paint_line["line-translate-anchor"]),"line-width":new Kl(Ud.paint_line["line-width"]),"line-gap-width":new Kl(Ud.paint_line["line-gap-width"]),"line-offset":new Kl(Ud.paint_line["line-offset"]),"line-blur":new Kl(Ud.paint_line["line-blur"]),"line-dasharray":new Kl(Ud.paint_line["line-dasharray"]),"line-pattern":new Kl(Ud.paint_line["line-pattern"]),"line-gradient":new Jl(Ud.paint_line["line-gradient"]),"line-trim-offset":new Wl(Ud.paint_line["line-trim-offset"])}),layout:Cm};const Im=new class extends Kl{possiblyEvaluate(e,t){return t=new Ql(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,n){return t=ul({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,n)}}(bm.paint.properties["line-width"].specification);Im.useIntegerZoom=!0;function Tm(e,t){return t>0?t+2*e:e}const vm=nh([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Rm=nh([{name:"a_projected_pos",components:4,type:"Float32"},{name:"a_ecef_pos_high",components:3,type:"Float32"},{name:"a_ecef_pos_low",components:3,type:"Float32"}],4);nh([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Mm=nh([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),wm=nh([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);nh([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Sm=nh([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);nh([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4),nh([{name:"triangle",components:3,type:"Uint16"}]),nh([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),nh([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),nh([{type:"Float32",name:"offsetX"}]),nh([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Bm=24;const Om=128;function Dm(e,t){const{expression:r}=t;if("constant"===r.kind){return{kind:"constant",layoutSize:r.evaluate(new Ql(e+1))}}if("source"===r.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:n}=r;let i=0;for(;i<t.length&&t[i]<=e;)i++;i=Math.max(0,i-1);let o=i;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[i],a=t[o];if("composite"===r.kind)return{kind:"composite",minZoom:s,maxZoom:a,interpolationType:n};return{kind:"camera",minZoom:s,maxZoom:a,minSize:r.evaluate(new Ql(s)),maxSize:r.evaluate(new Ql(a)),interpolationType:n}}}function Fm(e,{uSize:t,uSizeT:r},{lowerSize:n,upperSize:i}){return"source"===e.kind?n/Om:"composite"===e.kind?we(n/Om,i/Om,r):t}function Pm(e,t){let r=0,n=0;if("constant"===e.kind)n=e.layoutSize;else if("source"!==e.kind){const{interpolationType:i,minZoom:o,maxZoom:s}=e,a=i?ol(We.interpolationFactor(i,t,o,s),0,1):0;"camera"===e.kind?n=we(e.minSize,e.maxSize,a):r=a}return{uSizeT:r,uSize:n}}function Nm(e,t,r){return e.sections.forEach((function(e){e.text=function(e,t,r){var n=t.layout.get("text-transform").evaluate(r,{});return"uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),e}(e.text,t,r)})),e}var Lm=function(e){return e>=128&&e<=255},Um=function(e){return e>=1536&&e<=1791},Gm=function(e){return e>=1872&&e<=1919},Qm=function(e){return e>=2208&&e<=2303},km=function(e){return e>=4352&&e<=4607},zm=function(e){return e>=5120&&e<=5759},jm=function(e){return e>=6320&&e<=6399},Hm=function(e){return e>=8192&&e<=8303},qm=function(e){return e>=8448&&e<=8527},Vm=function(e){return e>=8528&&e<=8591},Ym=function(e){return e>=8960&&e<=9215},Xm=function(e){return e>=9216&&e<=9279},Wm=function(e){return e>=9280&&e<=9311},Km=function(e){return e>=9312&&e<=9471},Jm=function(e){return e>=9632&&e<=9727},Zm=function(e){return e>=9728&&e<=9983},$m=function(e){return e>=11008&&e<=11263},ey=function(e){return e>=11904&&e<=12031},ty=function(e){return e>=12032&&e<=12255},ry=function(e){return e>=12272&&e<=12287},ny=function(e){return e>=12288&&e<=12351},iy=function(e){return e>=12352&&e<=12447},oy=function(e){return e>=12448&&e<=12543},sy=function(e){return e>=12544&&e<=12591},ay=function(e){return e>=12592&&e<=12687},uy=function(e){return e>=12688&&e<=12703},cy=function(e){return e>=12704&&e<=12735},ly=function(e){return e>=12736&&e<=12783},hy=function(e){return e>=12784&&e<=12799},py=function(e){return e>=12800&&e<=13055},dy=function(e){return e>=13056&&e<=13311},fy=function(e){return e>=13312&&e<=19903},Ay=function(e){return e>=19904&&e<=19967},gy=function(e){return e>=19968&&e<=40959},_y=function(e){return e>=40960&&e<=42127},my=function(e){return e>=42128&&e<=42191},yy=function(e){return e>=43360&&e<=43391},Ey=function(e){return e>=44032&&e<=55215},xy=function(e){return e>=55216&&e<=55295},Cy=function(e){return e>=57344&&e<=63743},by=function(e){return e>=63744&&e<=64255},Iy=function(e){return e>=64336&&e<=65023},Ty=function(e){return e>=65040&&e<=65055},vy=function(e){return e>=65072&&e<=65103},Ry=function(e){return e>=65104&&e<=65135},My=function(e){return e>=65136&&e<=65279},wy=function(e){return e>=65280&&e<=65519};function Sy(e){for(const t of e)if(Fy(t.charCodeAt(0)))return!0;return!1}function By(e){for(const t of e)if(!Oy(t.charCodeAt(0)))return!1;return!0}function Oy(e){return!Um(e)&&(!Gm(e)&&(!Qm(e)&&(!Iy(e)&&!My(e))))}function Dy(e){return!(e<11904)&&(!!cy(e)||(!!sy(e)||(!!vy(e)||(!!by(e)||(!!dy(e)||(!!ey(e)||(!!ly(e)||(!!ny(e)||(!!fy(e)||(!!gy(e)||(!!py(e)||(!!wy(e)||(!!iy(e)||(!!ry(e)||(!!ty(e)||(!!hy(e)||(!!oy(e)||(!!Ty(e)||(!!my(e)||!!_y(e))))))))))))))))))))}function Fy(e){return 746===e||747===e||!(e<4352)&&(!!cy(e)||(!!sy(e)||(!(!vy(e)||e>=65097&&e<=65103)||(!!by(e)||(!!dy(e)||(!!ey(e)||(!!ly(e)||(!(!ny(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||(!!fy(e)||(!!gy(e)||(!!py(e)||(!!ay(e)||(!!yy(e)||(!!xy(e)||(!!km(e)||(!!Ey(e)||(!!iy(e)||(!!ry(e)||(!!uy(e)||(!!ty(e)||(!!hy(e)||(!(!oy(e)||12540===e)||(!(!wy(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||(!(!Ry(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||(!!zm(e)||(!!jm(e)||(!!Ty(e)||(!!Ay(e)||(!!_y(e)||!!my(e))))))))))))))))))))))))))))))}function Py(e){return!(Fy(e)||function(e){return!!(Lm(e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Hm(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||qm(e)||Vm(e)||Ym(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Xm(e)&&9251!==e||Wm(e)||Km(e)||Jm(e)||Zm(e)&&!(e>=9754&&e<=9759)||$m(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ny(e)||oy(e)||Cy(e)||vy(e)||Ry(e)||wy(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function Ny(e){return Um(e)||Gm(e)||Qm(e)||Iy(e)||My(e)}function Ly(e){return e>=1424&&e<=2303||Iy(e)||My(e)}function Uy(e){for(const t of e)if(Ly(t.charCodeAt(0)))return!0;return!1}const Gy={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Qy(e){return""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e}function ky(e){return""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e}const zy="loading",jy="loaded";let Hy="unavailable",qy=null;const Vy={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Hy===jy||null!=Vy.applyArabicShaping,isLoading:()=>Hy===zy,setState(e){Hy=e.pluginStatus,qy=e.pluginURL},isParsed:()=>null!=Vy.applyArabicShaping,getPluginURL:()=>qy};var Yy=function(e,t,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,h=r?i-1:0,p=r?-1:1,d=e[t+h];for(h+=p,o=d&(1<<-l)-1,d>>=-l,l+=a;l>0;o=256*o+e[t+h],h+=p,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+e[t+h],h+=p,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),o-=c}return(d?-1:1)*s*Math.pow(2,o-n)},Xy=function(e,t,r,n,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,h=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,f=n?1:-1,A=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(s++,u/=2),s+h>=l?(a=0,s=l):s+h>=1?(a=(t*u-1)*Math.pow(2,i),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[r+d]=255&a,d+=f,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[r+d]=255&s,d+=f,s/=256,c-=8);e[r+d-f]|=128*A};function Wy(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Wy.Varint=0,Wy.Fixed64=1,Wy.Bytes=2,Wy.Fixed32=5;var Ky=4294967296,Jy=1/Ky;function Zy(e){return e.type===Wy.Bytes?e.readVarint()+e.pos:e.pos+1}function $y(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function eE(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function tE(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function rE(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function nE(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function iE(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function oE(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function sE(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function aE(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function uE(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function cE(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function lE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function hE(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function pE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Wy.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,e(i,t,this),this.pos===o&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=lE(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=pE(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=lE(this.buf,this.pos)+lE(this.buf,this.pos+4)*Ky;return this.pos+=8,e},readSFixed64:function(){var e=lE(this.buf,this.pos)+pE(this.buf,this.pos+4)*Ky;return this.pos+=8,e},readFloat:function(){var e=Yy(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Yy(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,n=this.buf;return t=127&(r=n[this.pos++]),r<128?t:(t|=(127&(r=n[this.pos++]))<<7,r<128?t:(t|=(127&(r=n[this.pos++]))<<14,r<128?t:(t|=(127&(r=n[this.pos++]))<<21,r<128?t:function(e,t,r){var n,i,o=r.buf;if(i=o[r.pos++],n=(112&i)>>4,i<128)return $y(e,n,t);if(i=o[r.pos++],n|=(127&i)<<3,i<128)return $y(e,n,t);if(i=o[r.pos++],n|=(127&i)<<10,i<128)return $y(e,n,t);if(i=o[r.pos++],n|=(127&i)<<17,i<128)return $y(e,n,t);if(i=o[r.pos++],n|=(127&i)<<24,i<128)return $y(e,n,t);if(i=o[r.pos++],n|=(1&i)<<31,i<128)return $y(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=function(e,t,r){var n="",i=t;for(;i<r;){var o,s,a,u=e[i],c=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l>r)break;1===l?u<128&&(c=u):2===l?128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)<=127&&(c=null):3===l?(o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&((c=(15&u)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===l&&(o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&((c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,l=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),i+=l}return n}(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var r=Zy(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=Zy(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=Zy(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=Zy(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=Zy(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=Zy(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=Zy(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=Zy(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=Zy(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Wy.Varint)for(;this.buf[this.pos++]>127;);else if(t===Wy.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Wy.Fixed32)this.pos+=4;else{if(t!==Wy.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),hE(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),hE(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),hE(this.buf,-1&e,this.pos),hE(this.buf,Math.floor(e*Jy),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),hE(this.buf,-1&e,this.pos),hE(this.buf,Math.floor(e*Jy),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var r,n;e>=0?(r=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,n=n+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos]=127&e}(r,0,t),function(e,t){var r=(7&e)<<4;if(t.buf[t.pos++]|=r|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,r){for(var n,i,o=0;o<t.length;o++){if((n=t.charCodeAt(o))>55295&&n<57344){if(!i){n>56319||o+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):i=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(e[r++]=239,e[r++]=191,e[r++]=189,i=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&eE(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),Xy(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Xy(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;n>=128&&eE(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,Wy.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){this.writeMessage(e,tE,t)},writePackedSVarint:function(e,t){this.writeMessage(e,rE,t)},writePackedBoolean:function(e,t){this.writeMessage(e,oE,t)},writePackedFloat:function(e,t){this.writeMessage(e,nE,t)},writePackedDouble:function(e,t){this.writeMessage(e,iE,t)},writePackedFixed32:function(e,t){this.writeMessage(e,sE,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,aE,t)},writePackedFixed64:function(e,t){this.writeMessage(e,uE,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,cE,t)},writeBytesField:function(e,t){this.writeTag(e,Wy.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Wy.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Wy.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Wy.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Wy.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Wy.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Wy.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Wy.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Wy.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Wy.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};function dE(e){for(var t=0,r=0,n=0,i=e;n<i.length;n+=1){var o=i[n];t+=o.w*o.h,r=Math.max(r,o.w)}e.sort((function(e,t){return t.h-e.h}));for(var s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],a=0,u=0,c=0,l=e;c<l.length;c+=1)for(var h=l[c],p=s.length-1;p>=0;p--){var d=s[p];if(!(h.w>d.w||h.h>d.h)){if(h.x=d.x,h.y=d.y,u=Math.max(u,h.y+h.h),a=Math.max(a,h.x+h.w),h.w===d.w&&h.h===d.h){var f=s.pop();p<s.length&&(s[p]=f)}else h.h===d.h?(d.x+=h.w,d.w-=h.w):h.w===d.w?(d.y+=h.h,d.h-=h.h):(s.push({x:d.x+h.w,y:d.y,w:d.w-h.w,h:h.h}),d.y+=h.h,d.h-=h.h);break}}return{w:a,h:u,fill:t/(a*u)||0}}class fE{constructor(e,{pixelRatio:t,version:r,stretchX:n,stretchY:i,content:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=n,this.stretchY=i,this.content=o,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class AE{constructor(e,t){const r={},n={};this.haveRenderCallbacks=[];const i=[];this.addImages(e,r,i),this.addImages(t,n,i);const{w:o,h:s}=dE(i),a=new P_({width:o||1,height:s||1});for(const t in e){const n=e[t],i=r[t].paddedRect;P_.copy(n.data,a,{x:0,y:0},{x:i.x+1,y:i.y+1},n.data)}for(const e in t){const r=t[e],i=n[e].paddedRect,o=i.x+1,s=i.y+1,u=r.data.width,c=r.data.height;P_.copy(r.data,a,{x:0,y:0},{x:o,y:s},r.data),P_.copy(r.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:u,height:1}),P_.copy(r.data,a,{x:0,y:0},{x:o,y:s+c},{width:u,height:1}),P_.copy(r.data,a,{x:u-1,y:0},{x:o-1,y:s},{width:1,height:c}),P_.copy(r.data,a,{x:0,y:0},{x:o+u,y:s},{width:1,height:c})}this.image=a,this.iconPositions=r,this.patternPositions=n}addImages(e,t,r){for(const n in e){const i=e[n],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};r.push(o),t[n]=new fE(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t))),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)}patchUpdatedImage(e,t,r){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[n,i]=e.tl;r.update(t.data,void 0,{x:n,y:i})}}Ml(fE,"ImagePosition"),Ml(AE,"ImageAtlas");const gE={horizontal:1,vertical:2,horizontalOnly:3},_E=-17;class mE{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const r=new mE;return r.scale=e||1,r.fontStack=t,r}static forImage(e){const t=new mE;return t.imageName=e,t}}class yE{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const r=new yE;for(let n=0;n<e.sections.length;n++){const i=e.sections[n];i.image?r.addImageSection(i):r.addTextSection(i,t)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(e){let t="";for(let r=0;r<e.length;r++){const n=e.charCodeAt(r+1)||null,i=e.charCodeAt(r-1)||null;n&&Py(n)&&!Gy[e[r+1]]||i&&Py(i)&&!Gy[e[r-1]]||!Gy[e[r]]?t+=e[r]:t+=Gy[e[r]]}return t}(this.text)}trim(){let e=0;for(let t=0;t<this.text.length&&xE[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&xE[this.text.charCodeAt(r)];r--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const r=new yE;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(mE.forText(e.scale,e.fontStack||t));const r=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(r)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void fl("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(mE.forImage(t)),this.sectionIndex.push(this.sections.length-1)):fl("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function EE(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f){const A=yE.fromFeature(e,i);h===gE.vertical&&A.verticalizePunctuation(p);let g=[];const _=function(e,t,r,n,i,o){if(!e)return[];const s=[],a=function(e,t,r,n,i,o){let s=0;for(let r=0;r<e.length();r++){const a=e.getSection(r);s+=bE(e.getCharCode(r),a,n,i,t,o)}const a=Math.max(1,Math.ceil(s/r));return s/a}(e,t,r,n,i,o),u=e.text.indexOf("")>=0;let c=0;for(let r=0;r<e.length();r++){const l=e.getSection(r),h=e.getCharCode(r);if(xE[h]||(c+=bE(h,l,n,i,t,o)),r<e.length()-1){const t=Dy(h);(CE[h]||t||l.imageName)&&s.push(vE(r+1,c,a,s,TE(h,e.getCharCode(r+1),t&&u),!1))}}return RE(vE(e.length(),c,a,s,0,!0))}(A,c,o,t,n,d),{processBidirectionalText:m,processStyledBidirectionalText:y}=Vy;if(m&&1===A.sections.length){const e=m(A.toString(),_);for(const t of e){const e=new yE;e.text=t,e.sections=A.sections;for(let r=0;r<t.length;r++)e.sectionIndex.push(0);g.push(e)}}else if(y){const e=y(A.text,A.sectionIndex,_);for(const t of e){const e=new yE;e.text=t[0],e.sectionIndex=t[1],e.sections=A.sections,g.push(e)}}else g=function(e,t){const r=[],n=e.text;let i=0;for(const n of t)r.push(e.substring(i,n)),i=n;return i<n.length&&r.push(e.substring(i,n.length)),r}(A,_);const E=[],x={positionedLines:E,text:A.toString(),top:l[1],bottom:l[1],left:l[0],right:l[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,r,n,i,o,s,a,u,c,l,h){let p=0,d=0,f=0;const A="right"===a?1:"left"===a?0:.5;let g=!1;for(const e of i){const r=e.getSections();for(const e of r){if(e.imageName)continue;const r=t[e.fontStack];if(r&&(g=void 0!==r.ascender&&void 0!==r.descender,!g))break}if(!g)break}let _=0;for(const s of i){s.trim();const i=s.getMaxScale(),a=(i-1)*Bm,m={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=m;const y=m.positionedGlyphs;let E=0;if(!s.length()){d+=o,++_;continue}let x=0,C=0;for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),A=s.getCharCode(o);let _=a.scale,m=null,b=null,I=null,T=Bm,v=0;const R=!(u===gE.horizontal||!l&&!Fy(A)||l&&(xE[A]||Ny(A)));if(a.imageName){const t=n[a.imageName];if(!t)continue;I=a.imageName,e.iconsInText=e.iconsInText||!0,b=t.paddedRect;const r=t.displaySize;if(_=_*Bm/h,m={width:r[0],height:r[1],left:1,top:-3,advance:R?r[1]:r[0],localGlyph:!1},g){v=-m.height*_}else v=_E+i*Bm-r[1]*_;T=m.advance;const o=(R?r[0]:r[1])*_-Bm*i;o>0&&o>E&&(E=o)}else{const e=r[a.fontStack];if(!e)continue;e[A]&&(b=e[A]);const n=t[a.fontStack];if(!n)continue;const o=n.glyphs[A];if(!o)continue;if(m=o.metrics,T=8203!==A?Bm:0,g){const e=void 0!==n.ascender?Math.abs(n.ascender):0,t=void 0!==n.descender?Math.abs(n.descender):0,r=(e+t)*_;x<r&&(x=r,C=(e-t)/2*_),v=-e*_}else v=_E+(i-_)*Bm}R?(e.verticalizable=!0,y.push({glyph:A,imageName:I,x:p,y:d+v,vertical:R,scale:_,localGlyph:m.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:m,rect:b}),p+=T*_+c):(y.push({glyph:A,imageName:I,x:p,y:d+v,vertical:R,scale:_,localGlyph:m.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:m,rect:b}),p+=m.advance*_+c)}if(0!==y.length){const e=p-c;f=Math.max(e,f),g?wE(y,A,E,C,o*i/2):wE(y,A,E,0,o/2)}p=0;const b=o*i+E;m.lineOffset=Math.max(E,a),d+=b,++_}const m=d,{horizontalAlign:y,verticalAlign:E}=ME(s);(function(e,t,r,n,i,o){const s=(t-r)*i,a=-o*n;for(const t of e)for(const e of t.positionedGlyphs)e.x+=s,e.y+=a})(e.positionedLines,A,y,E,f,m),e.top+=-E*m,e.bottom=e.top+m,e.left+=-y*f,e.right=e.left+f,e.hasBaseline=g}(x,t,r,n,g,s,a,u,h,c,p,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(E)&&x}const xE={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},CE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bE(e,t,r,n,i,o){if(t.imageName){const e=n[t.imageName];return e?e.displaySize[0]*t.scale*Bm/o+i:0}{const n=r[t.fontStack],o=n&&n.glyphs[e];return o?o.metrics.advance*t.scale+i:0}}function IE(e,t,r,n){const i=Math.pow(e-t,2);return n?e<t?i/2:2*i:i+Math.abs(r)*r}function TE(e,t,r){let n=0;return 10===e&&(n-=1e4),r&&(n+=150),40!==e&&65288!==e||(n+=50),41!==t&&65289!==t||(n+=50),n}function vE(e,t,r,n,i,o){let s=null,a=IE(t,r,i,o);for(const e of n){const n=IE(t-e.x,r,i,o)+e.badness;n<=a&&(s=e,a=n)}return{index:e,x:t,priorBreak:s,badness:a}}function RE(e){return e?RE(e.priorBreak).concat(e.index):[]}function ME(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function wE(e,t,r,n,i){if(!(t||r||n||i))return;const o=e.length-1,s=e[o],a=s.metrics.advance*s.scale,u=(s.x+a)*t;for(let t=0;t<=o;t++)e[t].x-=u,e[t].y+=r+n+i}function SE(e,t,r){const{horizontalAlign:n,verticalAlign:i}=ME(r),o=t[0],s=t[1],a=o-e.displaySize[0]*n,u=a+e.displaySize[0],c=s-e.displaySize[1]*i;return{image:e,top:c,bottom:c+e.displaySize[1],left:a,right:u}}function BE(e,t,r,n,i,o){"none"===r&&console.log("textFit === 'none'"),Array.isArray(n)&&4===n.length||console.log("!Array.isArray(padding) || padding.length !== 4"),Array.isArray(i)&&2===i.length||console.log("!Array.isArray(iconOffset) || iconOffset.length !== 2");const s=e.image;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const u=t.left*o,c=t.right*o;let l,h,p,d;"width"===r||"both"===r?(d=i[0]+u-n[3],h=i[0]+c+n[1]):(d=i[0]+(u+c-s.displaySize[0])/2,h=d+s.displaySize[0]);const f=t.top*o,A=t.bottom*o;return"height"===r||"both"===r?(l=i[1]+f-n[0],p=i[1]+A+n[2]):(l=i[1]+(f+A-s.displaySize[1])/2,p=l+s.displaySize[1]),{image:s,top:l,right:h,bottom:p,left:d,collisionPadding:a}}var OE=function(e){function t(t,r,n,i,o){e.call(this,t,r),this.angle=i,this.z=n,void 0!==o&&(this.segment=o)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.angle,this.segment)},t}(zt);function DE(e,t,r,n,i){if(void 0===t.segment)return!0;for(var o=t,s=t.segment+1,a=0;a>-r/2;){if(--s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;for(var u=[],c=0;a<r/2;){var l=e[s-1],h=e[s],p=e[s+1];if(!p)return!1;var d=l.angleTo(h)-h.angleTo(p);for(d=Math.abs((d+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:a,angleDelta:d}),c+=d;a-u[0].distance>n;)c-=u.shift().angleDelta;if(c>i)return!1;s++,a+=h.dist(p)}return!0}function FE(e){let t=0;for(let r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function PE(e,t,r){return e?.6*t*r:0}function NE(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function LE(e,t,r,n,i,o){const s=PE(r,i,o),a=NE(r,n)*o;let u=0;const c=FE(e)/2;for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1],o=n.dist(i);if(u+o>c){const l=(c-u)/o,h=we(n.x,i.x,l),p=we(n.y,i.y,l),d=new OE(h,p,0,i.angleTo(n),r);return!s||DE(e,d,a,s,t)?d:void 0}u+=o}}function UE(e,t,r,n,i,o,s,a,u,c){const l=PE(n,o,s),h=NE(n,i),p=h*s,d=0===e[0].x||e[0].x===u||0===e[0].y||e[0].y===u;t-p<t/4&&(t=p+t/4);return GE(e,d?t/2*a%t:(h/2+2*o)*s*a%t,t,l,r,p,d,!1,u,c)}function GE(e,t,r,n,i,o,s,a,u,c){const l=o/2,h=FE(e);let p=0,d=t-r,f=[];for(let t=0;t<e.length-1;t++){const s=e[t],a=e[t+1],A=s.dist(a),g=a.angleTo(s);for(;d+r<p+A;){d+=r;const _=(d-p)/A,m=we(s.x,a.x,_),y=we(s.y,a.y,_);if(m>=0&&m<u&&y>=0&&y<u&&d-l>=0&&d+l<=h){const r=new OE(m,y,0,g,t);r._round(),(c||!n||DE(e,r,o,n,i))&&f.push(r)}}p+=A}return a||f.length||s||(f=GE(e,p/2,r,n,i,o,s,!0,u)),f}Ml(OE,"Anchor");function QE(e,t,r,n){const i=[],o=e.image,s=o.pixelRatio,a=o.paddedRect.w-2,u=o.paddedRect.h-2,c=e.right-e.left,l=e.bottom-e.top,h=o.stretchX||[[0,a]],p=o.stretchY||[[0,u]],d=(e,t)=>e+t[1]-t[0],f=h.reduce(d,0),A=p.reduce(d,0),g=a-f,_=u-A;let m=0,y=f,E=0,x=A,C=0,b=g,I=0,T=_;if(o.content&&n){const e=o.content;m=kE(h,0,e[0]),E=kE(p,0,e[1]),y=kE(h,e[0],e[2]),x=kE(p,e[1],e[3]),C=e[0]-m,I=e[1]-E,b=e[2]-e[0]-y,T=e[3]-e[1]-x}const v=(n,i,a,u)=>{const h=jE(n.stretch-m,y,c,e.left),p=HE(n.fixed-C,b,n.stretch,f),d=jE(i.stretch-E,x,l,e.top),g=HE(i.fixed-I,T,i.stretch,A),_=jE(a.stretch-m,y,c,e.left),v=HE(a.fixed-C,b,a.stretch,f),R=jE(u.stretch-E,x,l,e.top),M=HE(u.fixed-I,T,u.stretch,A),w=new zt(h,d),S=new zt(_,d),B=new zt(_,R),O=new zt(h,R),D=new zt(p/s,g/s),F=new zt(v/s,M/s),P=t*Math.PI/180;if(P){const e=Math.sin(P),t=Math.cos(P),r=[t,-e,e,t];w._matMult(r),S._matMult(r),O._matMult(r),B._matMult(r)}const N=n.stretch+n.fixed,L=a.stretch+a.fixed,U=i.stretch+i.fixed,G=u.stretch+u.fixed;return{tl:w,tr:S,bl:O,br:B,tex:{x:o.paddedRect.x+1+N,y:o.paddedRect.y+1+U,w:L-N,h:G-U},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:F,minFontScaleX:b/s/c,minFontScaleY:T/s/l,isSDF:r}};if(n&&(o.stretchX||o.stretchY)){const e=zE(h,g,f),t=zE(p,_,A);for(let r=0;r<e.length-1;r++){const n=e[r],o=e[r+1];for(let e=0;e<t.length-1;e++){const r=t[e],s=t[e+1];i.push(v(n,r,o,s))}}}else i.push(v({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:u+1}));return i}function kE(e,t,r){let n=0;for(const i of e)n+=Math.max(t,Math.min(r,i[1]))-Math.max(t,Math.min(r,i[0]));return n}function zE(e,t,r){const n=[{fixed:-1,stretch:0}];for(const[t,r]of e){const e=n[n.length-1];n.push({fixed:t-e.stretch,stretch:e.stretch}),n.push({fixed:t-e.stretch,stretch:e.stretch+(r-t)})}return n.push({fixed:t+1,stretch:r}),n}function jE(e,t,r,n){return e/t*r+n}function HE(e,t,r,n){return e-t*r/n}function qE(e,t,r,n){const i=t+e.positionedLines[n].lineOffset;if(0===n)return r+i/2;return r+(i+(t+e.positionedLines[n-1].lineOffset))/2}function VE(e,t,r){void 0===t&&(t=1),void 0===r&&(r=!1);for(var n=1/0,i=1/0,o=-1/0,s=-1/0,a=e[0],u=0;u<a.length;u++){var c=a[u];(!u||c.x<n)&&(n=c.x),(!u||c.y<i)&&(i=c.y),(!u||c.x>o)&&(o=c.x),(!u||c.y>s)&&(s=c.y)}var l=o-n,h=s-i,p=Math.min(l,h),d=p/2,f=new TinyQueue([],YE);if(0===p)return new zt(n,i);for(var A=n;A<o;A+=p)for(var g=i;g<s;g+=p)f.push(new XE(A+d,g+d,d,e));for(var _=function(e){for(var t=0,r=0,n=0,i=e[0],o=0,s=i.length,a=s-1;o<s;a=o++){var u=i[o],c=i[a],l=u.x*c.y-c.x*u.y;r+=(u.x+c.x)*l,n+=(u.y+c.y)*l,t+=3*l}return new XE(r/t,n/t,0,e)}(e),m=f.length;f.length;){var y=f.pop();(y.d>_.d||!_.d)&&(_=y,r&&console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,m)),y.max-_.d<=t||(d=y.h/2,f.push(new XE(y.p.x-d,y.p.y-d,d,e)),f.push(new XE(y.p.x+d,y.p.y-d,d,e)),f.push(new XE(y.p.x-d,y.p.y+d,d,e)),f.push(new XE(y.p.x+d,y.p.y+d,d,e)),m+=4)}return r&&(console.log("num probes: "+m),console.log("best distance: "+_.d)),_.p}function YE(e,t){return t.max-e.max}function XE(e,t,r,n){this.p=new zt(e,t),this.h=r,this.d=function(e,t){for(var r=!1,n=1/0,i=0;i<t.length;i++)for(var o=t[i],s=0,a=o.length,u=a-1;s<a;u=s++){var c=o[s],l=o[u];c.y>e.y!=l.y>e.y&&e.x<(l.x-c.x)*(e.y-c.y)/(l.y-c.y)+c.x&&(r=!r),n=Math.min(n,Ef(e,c,l))}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}function WE(e,t){var r,n,i,o,s,a,u,c;for(r=3&e.length,n=e.length-r,i=t,s=3432918353,a=461845907,c=0;c<n;)u=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,i=27492+(65535&(o=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*s+(((u>>>16)*s&65535)<<16)&4294967295)<<15|u>>>17))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(u=0,r){case 3:u^=(255&e.charCodeAt(c+2))<<16;case 2:u^=(255&e.charCodeAt(c+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&e.charCodeAt(c)))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<15|u>>>17))*a+(((u>>>16)*a&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}const KE=Number.POSITIVE_INFINITY,JE=Math.sqrt(2);function ZE(e,[t,r]){let n=0,i=0;if(r===KE){t<0&&(t=0);const r=t/JE;switch(e){case"top-right":case"top-left":i=r-7;break;case"bottom-right":case"bottom-left":i=7-r;break;case"bottom":i=7-t;break;case"top":i=t-7}switch(e){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=t;break;case"right":n=-t}}else{switch(t=Math.abs(t),r=Math.abs(r),e){case"top-right":case"top-left":case"top":i=r-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-r}switch(e){case"top-right":case"bottom-right":case"right":n=-t;break;case"top-left":case"bottom-left":case"left":n=t}}return[n,i]}function $E(e,t,r,n,i,o,s,a,u,c,l){e.createArrays();const h=512*e.overscaling;e.tilePixelRatio=va/h,e.compareText={},e.iconsNeedLinear=!1;const p=e.layers[0].layout,d=e.layers[0]._unevaluatedLayout._values,f={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:r}=e.textSizeData;f.compositeTextSizes=[d["text-size"].possiblyEvaluate(new Ql(t),a),d["text-size"].possiblyEvaluate(new Ql(r),a)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:r}=e.iconSizeData;f.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new Ql(t),a),d["icon-size"].possiblyEvaluate(new Ql(r),a)]}f.layoutTextSize=d["text-size"].possiblyEvaluate(new Ql(u+1),a),f.layoutIconSize=d["icon-size"].possiblyEvaluate(new Ql(u+1),a),f.textMaxSize=d["text-size"].possiblyEvaluate(new Ql(18),a);const A="map"===p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),g=p.get("text-size");A||(e.text.createLngLatQuadsArray(),e.icon.createLngLatQuadsArray());for(const o of e.features){const u=p.get("text-font").evaluate(o,{},a).join(","),h=g.evaluate(o,{},a),d=f.layoutTextSize.evaluate(o,{},a),_=f.layoutIconSize.evaluate(o,{},a),m={horizontal:{},vertical:void 0},y=o.text;let E,x=[0,0];if(y){const n=y.toString(),s=p.get("text-letter-spacing").evaluate(o,{},a)*Bm,c=p.get("text-line-height").evaluate(o,{},a)*Bm,l=By(n)?s:0,f=p.get("text-anchor").evaluate(o,{},a),g=p.get("text-variable-anchor");if(!g){const e=p.get("text-radial-offset").evaluate(o,{},a);x=e?ZE(f,[e*Bm,KE]):p.get("text-offset").evaluate(o,{},a).map((e=>e*Bm))}let _=A?"center":p.get("text-justify").evaluate(o,{},a);const E="point"===p.get("symbol-placement"),C=E?p.get("text-max-width").evaluate(o,{},a)*Bm:1/0,b=o=>{e.allowVerticalPlacement&&Sy(n)&&(m.vertical=EE(y,t,r,i,u,C,c,f,o,l,x,gE.vertical,!0,d,h))};if(!A&&g){const e="auto"===_?g.map((e=>ex(e))):[_];let n=!1;for(let o=0;o<e.length;o++){const s=e[o];if(!m.horizontal[s])if(n)m.horizontal[s]=m.horizontal[0];else{const e=EE(y,t,r,i,u,C,c,"center",s,l,x,gE.horizontal,!1,d,h);e&&(m.horizontal[s]=e,n=1===e.positionedLines.length)}}b("left")}else{if("auto"===_&&(_=ex(f)),E||p.get("text-writing-mode").indexOf("horizontal")>=0||!Sy(n)){const e=EE(y,t,r,i,u,C,c,f,_,l,x,gE.horizontal,!1,d,h);e&&(m.horizontal[_]=e)}b(E?"left":_)}}let C=!1;if(o.icon&&o.icon.name){const t=n[o.icon.name];t&&(E=SE(i[o.icon.name],p.get("icon-offset").evaluate(o,{},a),p.get("icon-anchor").evaluate(o,{},a)),C=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&fl("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==p.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const b=ox(m.horizontal)||m.vertical;e.iconsInText||(e.iconsInText=!!b&&b.iconsInText),(b||E)&&tx(e,o,m,E,n,f,d,_,x,C,s,a,c,l)}o&&e.generateCollisionDebugBuffers(u,e.collisionBoxArray)}function ex(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tx(e,t,r,n,i,o,s,a,u,c,l,h,p,d){let f=o.textMaxSize.evaluate(t,{},h);void 0===f&&(f=s);const A=e.layers[0].layout,g=A.get("icon-offset").evaluate(t,{},h),_=ox(r.horizontal)||r.vertical,m=s/24,y=e.tilePixelRatio*f/24,E=(e.tilePixelRatio,function(e,t){t>18&&e>2&&(e>>=1);const r=va/(512*e);return Math.max(r,1)}(e.overscaling,e.zoom)*A.get("symbol-spacing")),x=A.get("text-padding")*e.tilePixelRatio,C=A.get("icon-padding")*e.tilePixelRatio,b=nl(A.get("text-max-angle")),I="map"===A.get("text-rotation-alignment")&&"point"!==A.get("symbol-placement"),T="map"===A.get("icon-rotation-alignment")&&"point"!==A.get("symbol-placement"),v=A.get("symbol-placement"),R=E/2,M=A.get("ignore-line-rotation"),w=A.get("icon-text-fit");let S;n&&"none"!==w&&(e.allowVerticalPlacement&&r.vertical&&(S=BE(n,r.vertical,w,A.get("icon-text-fit-padding"),g,m)),_&&(n=BE(n,_,w,A.get("icon-text-fit-padding"),g,m)));const B=(s,a,p)=>{if(a.x<0||a.x>=va||a.y<0||a.y>=va)return;const f=ml(d,a.x,a.y,p);!function(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g,_,m,y,E,x,C,b,I,T,v){const R=e.addToLineVertexArray(t,i);let M,w,S,B,O,D,F,P=0,N=0,L=0,U=0,G=-1,Q=-1;const k={};let z=WE("");const j=n?n.anchor:t;let H=0,q=0;void 0===c._unevaluatedLayout.getValue("text-radial-offset")?[H,q]=c.layout.get("text-offset").evaluate(x,{},T).map((e=>e*Bm)):(H=c.layout.get("text-radial-offset").evaluate(x,{},T)*Bm,q=KE);if(e.allowVerticalPlacement&&o.vertical){const e=o.vertical;if(A)D=ax(e),u&&(F=ax(u));else{const n=c.layout.get("text-rotate").evaluate(x,{},T)+90;S=sx(l,j,t,r,h,p,d,e,f,n,g),u&&(B=sx(l,j,t,r,h,p,d,u,m,n))}}if(s){const i=c.layout.get("icon-rotate").evaluate(x,{},T),o="none"!==c.layout.get("icon-text-fit"),a=QE(s,i,b,o),f=u?QE(u,i,b,o):void 0;w=sx(l,j,t,r,h,p,d,s,m,i),P=4*a.length;const A=e.iconSizeData;let g=null;"source"===A.kind?(g=[Om*c.layout.get("icon-size").evaluate(x,{},T)],g[0]>nx&&fl(`${e.layerIds[0]}: Value for "icon-size" is >= ${rx}. Reduce your "icon-size".`)):"composite"===A.kind&&(g=[Om*C.compositeIconSizes[0].evaluate(x,{},T),Om*C.compositeIconSizes[1].evaluate(x,{},T)],(g[0]>nx||g[1]>nx)&&fl(`${e.layerIds[0]}: Value for "icon-size" is >= ${rx}. Reduce your "icon-size".`)),e.addSymbols(e.icon,a,g,E,y,x,!1,n,t,r,R.lineStartIndex,R.lineLength,-1,I,T,v),G=e.icon.placedSymbolArray.length-1,f&&(N=4*f.length,e.addSymbols(e.icon,f,g,E,y,x,gE.vertical,n,t,r,R.lineStartIndex,R.lineLength,-1,I,T,v),Q=e.icon.placedSymbolArray.length-1)}for(const i in o.horizontal){const s=o.horizontal[i];if(!M)if(z=WE(s.text),A)O=ax(s);else{M=sx(l,j,t,r,h,p,d,s,f,c.layout.get("text-rotate").evaluate(x,{},T),g)}const u=1===s.positionedLines.length;if(L+=ix(e,n,t,r,s,a,c,A,x,g,R,o.vertical?gE.horizontal:gE.horizontalOnly,u?Object.keys(o.horizontal):[i],k,G,C,I,T,v),u)break}o.vertical&&(U+=ix(e,n,t,r,o.vertical,a,c,A,x,g,R,gE.vertical,["vertical"],k,Q,C,I,T,v));let V=-1;const Y=(e,t)=>e?Math.max(e,t):t;V=Y(O,V),V=Y(D,V),V=Y(F,V);const X=V>-1?1:0;e.glyphOffsetArray.length>=65535&&fl("Too many glyphs being rendered in a tile.");void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey);const W=j;e.symbolInstances.emplaceBack(W.x,W.y,W.z,t.x,t.y,k.right>=0?k.right:-1,k.center>=0?k.center:-1,k.left>=0?k.left:-1,k.vertical>=0?k.vertical:-1,G,Q,z,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,void 0!==S?S:e.collisionBoxArray.length,void 0!==S?S+1:e.collisionBoxArray.length,void 0!==w?w:e.collisionBoxArray.length,void 0!==w?w+1:e.collisionBoxArray.length,B||e.collisionBoxArray.length,B?B+1:e.collisionBoxArray.length,h,L,U,P,N,X,0,H,q,V)}(e,a,f,null,s,r,n,i,S,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,x,I,u,0,C,T,g,t,o,c,l,h,d)};if("line"===v||"line-direction"===v)for(const i of function(e,t,r,n,i){for(var o=[],s=0;s<e.length;s++)for(var a=e[s],u=void 0,c=0;c<a.length-1;c++){var l=a[c],h=a[c+1];l.x<t&&h.x<t||(l.x<t?l=new zt(t,l.y+(h.y-l.y)*((t-l.x)/(h.x-l.x)))._round():h.x<t&&(h=new zt(t,l.y+(h.y-l.y)*((t-l.x)/(h.x-l.x)))._round()),l.y<r&&h.y<r||(l.y<r?l=new zt(l.x+(h.x-l.x)*((r-l.y)/(h.y-l.y)),r)._round():h.y<r&&(h=new zt(l.x+(h.x-l.x)*((r-l.y)/(h.y-l.y)),r)._round()),l.x>=n&&h.x>=n||(l.x>=n?l=new zt(n,l.y+(h.y-l.y)*((n-l.x)/(h.x-l.x)))._round():h.x>=n&&(h=new zt(n,l.y+(h.y-l.y)*((n-l.x)/(h.x-l.x)))._round()),l.y>=i&&h.y>=i||(l.y>=i?l=new zt(l.x+(h.x-l.x)*((i-l.y)/(h.y-l.y)),i)._round():h.y>=i&&(h=new zt(l.x+(h.x-l.x)*((i-l.y)/(h.y-l.y)),i)._round()),u&&l.equals(u[u.length-1])||(u=[l],o.push(u)),u.push(h)))))}return o}(t.geometry,0,0,va,va)){const t=UE(i,E,b,r.vertical||_,n,24,y,e.overscaling,va,M);for(const r of t){_&&ux(e,_.text,R,r)||B(i,r,h)}}else if("line-center"===v){for(const e of t.geometry)if(e.length>1){const t=LE(e,b,r.vertical||_,n,24,y);t&&B(e,t,h)}}else if("Polygon"===t.type)for(const e of j_(t.geometry,0)){const t=VE(e,16);B(e[0],new OE(t.x,t.y,0,0,void 0),h)}else if("LineString"===t.type)for(const e of t.geometry)B(e,new OE(e[0].x,e[0].y,0,0,void 0),h);else if("Point"===t.type)for(const e of t.geometry)for(const t of e)B([t],new OE(t.x,t.y,0,0,void 0),h)}const rx=255,nx=rx*Om;function ix(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g,_,m){const y=function(e,t,r,n,i,o,s,a){const u=[];if(0===t.positionedLines.length)return u;const c=n.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,l=function(e){const t=e[0],r=e[1],n=t*r;return n>0?[t,-r]:n<0?[-t,r]:0===t?[r,t]:[r,-t]}(r);let h=Math.abs(t.top-t.bottom);for(const e of t.positionedLines)h-=e.lineOffset;const p=t.positionedLines.length,d=h/p;let f=t.top-r[1];for(let e=0;e<p;++e){const n=t.positionedLines[e];f=qE(t,d,f,e);for(const e of n.positionedGlyphs){if(!e.rect)continue;const n=e.rect||{};let o=4,h=!0,p=1,d=0;if(e.imageName){const t=s[e.imageName];if(!t)continue;if(t.sdf){fl("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,p=t.pixelRatio,o=1/p}const A=(i||a)&&e.vertical,g=e.metrics.advance*e.scale/2,_=e.metrics,m=e.rect;if(null===m)continue;a&&t.verticalizable&&(d=e.imageName?g-e.metrics.width*e.scale/2:0);const y=i?[e.x+g,e.y]:[0,0];let E=[0,0],x=[0,0],C=!1;i||(A?(x=[e.x+g+l[0],e.y+l[1]-d],C=!0):E=[e.x+g+r[0],e.y+r[1]-d]);const b=m.w*e.scale/(p*(e.localGlyph?2:1)),I=m.h*e.scale/(p*(e.localGlyph?2:1));let T,v,R,M;if(A){const t=e.y-f,r=new zt(-g,g-t),n=-Math.PI/2,i=new zt(...x);T=new zt(-g+E[0],E[1]),T._rotateAround(n,r)._add(i),T.x+=-t+g,T.y-=(_.left-o)*e.scale;const s=e.imageName?_.advance*e.scale:Bm*e.scale,a=String.fromCharCode(e.glyph);if(Qy(a))T.x+=(1-o)*e.scale;else if(ky(a)){const t=s-_.height*e.scale;T.x+=t+(-o-1)*e.scale}else if(e.imageName||_.width+2*o===m.w&&_.height+2*o===m.h){const e=s-I;T.x+=e/2}else{const t=s-(_.height+2*o)*e.scale;T.x+=t/2}v=new zt(T.x,T.y-b),R=new zt(T.x+I,T.y),M=new zt(T.x+I,T.y-b)}else{const t=(_.left-o)*e.scale-g+E[0],r=(-_.top-o)*e.scale+E[1],n=t+b,i=r+I;T=new zt(t,r),v=new zt(n,r),R=new zt(t,i),M=new zt(n,i)}if(c){let e;e=i?new zt(0,0):C?new zt(l[0],l[1]):new zt(r[0],r[1]),T._rotateAround(c,e),v._rotateAround(c,e),R._rotateAround(c,e),M._rotateAround(c,e)}const w=new zt(0,0),S=new zt(0,0),B=0,O=0;u.push({tl:T,tr:v,bl:R,br:M,tex:n,writingMode:t.writingMode,glyphOffset:y,sectionIndex:e.sectionIndex,isSDF:h,pixelOffsetTL:w,pixelOffsetBR:S,minFontScaleX:B,minFontScaleY:O})}}return u}(0,i,c,s,a,u,o,e.allowVerticalPlacement),E=e.textSizeData;let x=null;"source"===E.kind?(x=[Om*s.layout.get("text-size").evaluate(u,{},_)],x[0]>nx&&fl(`${e.layerIds[0]}: Value for "text-size" is >= ${rx}. Reduce your "text-size".`)):"composite"===E.kind&&(x=[Om*A.compositeTextSizes[0].evaluate(u,{},_),Om*A.compositeTextSizes[1].evaluate(u,{},_)],(x[0]>nx||x[1]>nx)&&fl(`${e.layerIds[0]}: Value for "text-size" is >= ${rx}. Reduce your "text-size".`)),e.addSymbols(e.text,y,x,c,a,u,h,t,r,n,l.lineStartIndex,l.lineLength,f,g,_,m);for(const t of p)d[t]=e.text.placedSymbolArray.length-1;return 4*y.length}function ox(e){for(const t in e)return e[t];return null}function sx(e,t,r,n,i,o,s,a,u,c,l){let h=a.top,p=a.bottom,d=a.left,f=a.right;const A=a.collisionPadding;if(A&&(d-=A[0],h-=A[1],f+=A[2],p+=A[3]),c){const e=new zt(d,h),t=new zt(f,h),r=new zt(d,p),n=new zt(f,p),i=nl(c);let o=new zt(0,0);l&&(o=new zt(l[0],l[1])),e._rotateAround(i,o),t._rotateAround(i,o),r._rotateAround(i,o),n._rotateAround(i,o),d=Math.min(e.x,t.x,r.x,n.x),f=Math.max(e.x,t.x,r.x,n.x),h=Math.min(e.y,t.y,r.y,n.y),p=Math.max(e.y,t.y,r.y,n.y)}return e.emplaceBack(t.x,t.y,t.z,r.x,r.y,d,h,f,p,u,i,o,s,n.x,n.y,n.z),e.length-1}function ax(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function ux(e,t,r,n){const i=e.compareText;if(t in i){const e=i[t];for(let t=e.length-1;t>=0;t--)if(n.dist(e[t])<r)return!0}else i[t]=[];return i[t].push(n),!1}var cx=Object.freeze({ISERVER_TOKEN:"token",IPORTAL_KEY:"key"});function lx(e,t,r){if(!jt(e))throw new Ht("first is required");if(!jt(t))throw new Ht("second is required");if(r=Yt(r,!0),e instanceof vn||(e=new vn(e)),t instanceof vn||(t=new vn(t)),"data"===e.scheme)return e.toString();if("data"===t.scheme)return t.toString();jt(t.authority)&&!jt(t.scheme)&&("undefined"!=typeof document&&jt(document.location)&&jt(document.location.href)?t.scheme=new vn(document.location.href).scheme:t.scheme=e.scheme);var n=e;t.isAbsolute()&&(n=t);var i="";jt(n.scheme)&&(i+=n.scheme+":"),jt(n.authority)&&(i+="//"+n.authority,""!==n.path&&"/"!==n.path&&(i=i.replace(/\/?$/,"/"),n.path=n.path.replace(/^\/?/g,""),""===n.authority&&(i+="/"))),i+=n===e?r?e.path.replace(/\/?$/,"/")+t.path.replace(/^\/?/g,""):e.path+t.path:t.path;var o=jt(e.query),s=jt(t.query);o&&s?i+="?"+e.query+"&"+t.query:o&&!s?i+="?"+e.query:!o&&s&&(i+="?"+t.query);var a=jt(t.fragment);return jt(e.fragment)&&!a?i+="#"+e.fragment:a&&(i+="#"+t.fragment),i}function hx(e,t){this._keymap={},this.addCredential(e,t)}Object.defineProperties(hx.prototype,{value:{get:function(){return this._value},set:function(e){this._value=e}},name:{get:function(){return this._name},set:function(e){this._name=e}}}),hx.addToken=function(e){var t,r=e.substring(0,e.indexOf("/realspace")+10);if(jt(hx.CREDENTIAL._keymap[r]))switch(hx.CREDENTIAL._keymap[r].type){case cx.ISERVER_TOKEN:t="?"+kn({token:hx.CREDENTIAL._keymap[r].value});break;case cx.IPORTAL_KEY:t="?"+kn({key:hx.CREDENTIAL._keymap[r].value});break;default:t=""}else switch(hx.CREDENTIAL.name){case cx.ISERVER_TOKEN:t="?"+kn({token:hx.CREDENTIAL.value});break;case cx.IPORTAL_KEY:t="?"+kn({key:hx.CREDENTIAL.value});break;default:t="?"+hx.CREDENTIAL.name+"="+hx.CREDENTIAL.value}return lx(e,t,!1)},hx.addTokenWithKey=function(e,t){var r;if(jt(hx.CREDENTIAL._keymap[e])){if(hx.CREDENTIAL._keymap[e].type instanceof Array){var n,i=hx.CREDENTIAL._keymap[e].type,o=hx.CREDENTIAL._keymap[e].value;(a={})[i[0]]=o[0],n=lx(t,"?"+kn(a),!1);for(var s=1;s<i.length;s++){(a={})[i[s]]=o[s],n=n+"&"+kn(a)}return n}switch(hx.CREDENTIAL._keymap[e].type){case cx.ISERVER_TOKEN:r="?"+kn({token:hx.CREDENTIAL._keymap[e].value});break;case cx.IPORTAL_KEY:r="?"+kn({key:hx.CREDENTIAL._keymap[e].value});break;default:var a;(a={})[hx.CREDENTIAL._keymap[e].type]=hx.CREDENTIAL._keymap[e].value,r="?"+kn(a)}}else switch(hx.CREDENTIAL.name){case cx.ISERVER_TOKEN:r="?"+kn({token:hx.CREDENTIAL.value});break;case cx.IPORTAL_KEY:r="?"+kn({key:hx.CREDENTIAL.value});break;default:r="?"+hx.CREDENTIAL.name+"="+hx.CREDENTIAL.value}return lx(t,r,!1)},hx.prototype.addCredential=function(e,t){if(e instanceof Array){for(var r=0,n=e.length;r<n;r++)if(this._keymap[e[r].rooturl]={type:e[r].type||cx.ISERVER_TOKEN,value:e[r].value},-1!==e[r].rooturl.indexOf("/realspace")){var i=e[r].rooturl.substring(0,e[r].rooturl.lastIndexOf("/realspace")+10);this._keymap[i]={type:e[r].type||cx.ISERVER_TOKEN,value:e[r].value}}}else{if(this._value=Yt(e,""),null==e)throw new Ht("Credential.value is necessory.");this._name=Yt(t,cx.ISERVER_TOKEN),this._keymap.default={type:this._name,value:this._value}}},hx.CREDENTIAL=null;var px=484813681109536e-20,dx=Math.PI/2,fx=1e-10,Ax=.017453292519943295,gx=57.29577951308232,_x=Math.PI/4,mx=2*Math.PI,yx=3.14159265359,Ex={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},xx={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Cx=/[\s_\-\/\(\)]/g;function bx(e,t){if(e[t])return e[t];for(var r,n=Object.keys(e),i=t.toLowerCase().replace(Cx,""),o=-1;++o<n.length;)if((r=n[o]).toLowerCase().replace(Cx,"")===i)return e[r]}var Ix=function(e){var t,r,n,i={},o=e.split("+").map((function(e){return e.trim()})).filter((function(e){return e})).reduce((function(e,t){var r=t.split("=");return r.push(!0),e[r[0].toLowerCase()]=r[1],e}),{}),s={proj:"projName",datum:"datumCode",rf:function(e){i.rf=parseFloat(e)},lat_0:function(e){i.lat0=e*Ax},lat_1:function(e){i.lat1=e*Ax},lat_2:function(e){i.lat2=e*Ax},lat_ts:function(e){i.lat_ts=e*Ax},lon_0:function(e){i.long0=e*Ax},lon_1:function(e){i.long1=e*Ax},lon_2:function(e){i.long2=e*Ax},alpha:function(e){i.alpha=parseFloat(e)*Ax},lonc:function(e){i.longc=e*Ax},x_0:function(e){i.x0=parseFloat(e)},y_0:function(e){i.y0=parseFloat(e)},k_0:function(e){i.k0=parseFloat(e)},k:function(e){i.k0=parseFloat(e)},a:function(e){i.a=parseFloat(e)},b:function(e){i.b=parseFloat(e)},r_a:function(){i.R_A=!0},zone:function(e){i.zone=parseInt(e,10)},south:function(){i.utmSouth=!0},towgs84:function(e){i.datum_params=e.split(",").map((function(e){return parseFloat(e)}))},to_meter:function(e){i.to_meter=parseFloat(e)},units:function(e){i.units=e;var t=bx(xx,e);t&&(i.to_meter=t.to_meter)},from_greenwich:function(e){i.from_greenwich=e*Ax},pm:function(e){var t=bx(Ex,e);i.from_greenwich=(t||parseFloat(e))*Ax},nadgrids:function(e){"@null"===e?i.datumCode="none":i.nadgrids=e},axis:function(e){var t="ewnsud";3===e.length&&-1!==t.indexOf(e.substr(0,1))&&-1!==t.indexOf(e.substr(1,1))&&-1!==t.indexOf(e.substr(2,1))&&(i.axis=e)}};for(t in o)r=o[t],t in s?"function"==typeof(n=s[t])?n(r):i[n]=r:i[t]=r;return"string"==typeof i.datumCode&&"WGS84"!==i.datumCode&&(i.datumCode=i.datumCode.toLowerCase()),i},Tx=/\s/,vx=/[A-Za-z]/,Rx=/[A-Za-z84]/,Mx=/[,\]]/,wx=/[\d\.E\-\+]/;function Sx(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1}function Bx(e,t,r){Array.isArray(t)&&(r.unshift(t),t=null);var n=t?{}:e,i=r.reduce((function(e,t){return Ox(t,e),e}),n);t&&(e[t]=i)}function Ox(e,t){if(Array.isArray(e)){var r=e.shift();if("PARAMETER"===r&&(r=e.shift()),1===e.length)return Array.isArray(e[0])?(t[r]={},void Ox(e[0],t[r])):void(t[r]=e[0]);if(e.length)if("TOWGS84"!==r){if("AXIS"===r)return r in t||(t[r]=[]),void t[r].push(e);var n;switch(Array.isArray(r)||(t[r]={}),r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[r]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&Ox(e[2],t[r]));case"SPHEROID":case"ELLIPSOID":return t[r]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&Ox(e[3],t[r]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return e[0]=["name",e[0]],void Bx(t,r,e);default:for(n=-1;++n<e.length;)if(!Array.isArray(e[n]))return Ox(e,t[r]);return Bx(t,r,e)}}else t[r]=e;else t[r]=!0}else t[e]=!0}Sx.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;Tx.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case 1:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},Sx.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(Mx.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},Sx.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=1)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},Sx.prototype.number=function(e){if(!wx.test(e)){if(Mx.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)}this.word+=e},Sx.prototype.quoted=function(e){'"'!==e?this.word+=e:this.state=5},Sx.prototype.keyword=function(e){if(Rx.test(e))this.word+=e;else{if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=1)}if(!Mx.test(e))throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place);this.afterItem(e)}},Sx.prototype.neutral=function(e){if(vx.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(wx.test(e))return this.word=e,void(this.state=3);if(!Mx.test(e))throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place);this.afterItem(e)},Sx.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function Dx(e){return.017453292519943295*e}var Fx=function(e){var t=new Sx(e).output(),r=t.shift(),n=t.shift();t.unshift(["name",n]),t.unshift(["type",r]);var i={};return Ox(t,i),function(e){if("GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):"object"==typeof e.PROJECTION?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var t="",r=0,n=e.AXIS.length;r<n;++r){var i=e.AXIS[r][0].toLowerCase();-1!==i.indexOf("north")?t+="n":-1!==i.indexOf("south")?t+="s":-1!==i.indexOf("east")?t+="e":-1!==i.indexOf("west")&&(t+="w")}2===t.length&&(t+="u"),3===t.length&&(e.axis=t)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var o=e.GEOGCS;function s(t){return t*(e.to_meter||1)}"GEOGCS"===e.type&&(o=e),o&&(o.DATUM?e.datumCode=o.DATUM.name.toLowerCase():e.datumCode=o.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==e.datumCode&&"new_zealand_1949"!==e.datumCode||(e.datumCode="nzgd49"),"wgs_1984"!==e.datumCode&&"world_geodetic_system_1984"!==e.datumCode||("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"_ferro"===e.datumCode.slice(-6)&&(e.datumCode=e.datumCode.slice(0,-6)),"_jakarta"===e.datumCode.slice(-8)&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),o.DATUM&&o.DATUM.SPHEROID&&(e.ellps=o.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=o.DATUM.SPHEROID.a,e.rf=parseFloat(o.DATUM.SPHEROID.rf,10)),o.DATUM&&o.DATUM.TOWGS84&&(e.datum_params=o.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),"ch1903+"===e.datumCode&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Dx],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Dx],["x0","false_easting",s],["y0","false_northing",s],["long0","central_meridian",Dx],["lat0","latitude_of_origin",Dx],["lat0","standard_parallel_1",Dx],["lat1","standard_parallel_1",Dx],["lat2","standard_parallel_2",Dx],["azimuth","Azimuth"],["alpha","azimuth",Dx],["srsCode","name"]].forEach((function(t){return r=e,i=(n=t)[0],o=n[1],void(!(i in r)&&o in r&&(r[i]=r[o],3===n.length&&(r[i]=n[2](r[i]))));var r,n,i,o})),e.long0||!e.longc||"Albers_Conic_Equal_Area"!==e.projName&&"Lambert_Azimuthal_Equal_Area"!==e.projName||(e.long0=e.longc),e.lat_ts||!e.lat1||"Stereographic_South_Pole"!==e.projName&&"Polar Stereographic (variant B)"!==e.projName||(e.lat0=Dx(e.lat1>0?90:-90),e.lat_ts=e.lat1)}(i),i};function Px(e){var t=this;if(2===arguments.length){var r=arguments[1];"string"==typeof r?"+"===r.charAt(0)?Px[e]=Ix(arguments[1]):Px[e]=Fx(arguments[1]):Px[e]=r}else if(1===arguments.length){if(Array.isArray(e))return e.map((function(e){Array.isArray(e)?Px.apply(t,e):Px(e)}));if("string"==typeof e){if(e in Px)return Px[e]}else"EPSG"in e?Px["EPSG:"+e.EPSG]=e:"ESRI"in e?Px["ESRI:"+e.ESRI]=e:"IAU2000"in e?Px["IAU2000:"+e.IAU2000]=e:console.log(e);return}}!function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}(Px);var Nx=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var Lx=["3857","900913","3785","102113"];function Ux(e){if(!function(e){return"string"==typeof e}(e))return e;if(function(e){return e in Px}(e))return Px[e];if(function(e){return Nx.some((function(t){return e.indexOf(t)>-1}))}(e)){var t=Fx(e);if(function(e){var t=bx(e,"authority");if(t){var r=bx(t,"epsg");return r&&Lx.indexOf(r)>-1}}(t))return Px["EPSG:3857"];var r=function(e){var t=bx(e,"extension");if(t)return bx(t,"proj4")}(t);return r?Ix(r):t}return function(e){return"+"===e[0]}(e)?Ix(e):void 0}var Gx=function(e,t){var r,n;if(e=e||{},!t)return e;for(n in t)void 0!==(r=t[n])&&(e[n]=r);return e},Qx=function(e,t,r){var n=e*t;return r/Math.sqrt(1-n*n)},kx=function(e){return e<0?-1:1},zx=function(e){return Math.abs(e)<=yx?e:e-kx(e)*mx},jx=function(e,t,r){var n=e*r,i=.5*e;return n=Math.pow((1-n)/(1+n),i),Math.tan(.5*(dx-t))/n},Hx=function(e,t){for(var r,n,i=.5*e,o=dx-2*Math.atan(t),s=0;s<=15;s++)if(r=e*Math.sin(o),o+=n=dx-2*Math.atan(t*Math.pow((1-r)/(1+r),i))-o,Math.abs(n)<=1e-10)return o;return-9999};var qx={init:function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Qx(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(e){var t,r,n=e.x,i=e.y;if(i*gx>90&&i*gx<-90&&n*gx>180&&n*gx<-180)return null;if(Math.abs(Math.abs(i)-dx)<=fx)return null;if(this.sphere)t=this.x0+this.a*this.k0*zx(n-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(_x+.5*i));else{var o=Math.sin(i),s=jx(this.e,i,o);t=this.x0+this.a*this.k0*zx(n-this.long0),r=this.y0-this.a*this.k0*Math.log(s)}return e.x=t,e.y=r,e},inverse:function(e){var t,r,n=e.x-this.x0,i=e.y-this.y0;if(this.sphere)r=dx-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var o=Math.exp(-i/(this.a*this.k0));if(-9999===(r=Hx(this.e,o)))return null}return t=zx(this.long0+n/(this.a*this.k0)),e.x=t,e.y=r,e},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]};function Vx(e){return e}var Yx=[qx,{init:function(){},forward:Vx,inverse:Vx,names:["longlat","identity"]}],Xx={},Wx=[];function Kx(e,t){var r=Wx.length;return e.names?(Wx[r]=e,e.names.forEach((function(e){Xx[e.toLowerCase()]=r})),this):(console.log(t),!0)}var Jx={start:function(){Yx.forEach(Kx)},add:Kx,get:function(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==Xx[t]&&Wx[Xx[t]]?Wx[Xx[t]]:void 0}},Zx={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},$x=Zx.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Zx.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var eC={};function tC(e,t){if(!(this instanceof tC))return new tC(e);t=t||function(e){if(e)throw e};var r=Ux(e);if("object"==typeof r){var n=tC.projections.get(r.projName);if(n){if(r.datumCode&&"none"!==r.datumCode){var i=bx(eC,r.datumCode);i&&(r.datum_params=i.towgs84?i.towgs84.split(","):null,r.ellps=i.ellipse,r.datumName=i.datumName?i.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84";var o=function(e,t,r,n,i){if(!e){var o=bx(Zx,n);o||(o=$x),e=o.a,t=o.b,r=o.rf}return r&&!t&&(t=(1-1/r)*e),(0===r||Math.abs(e-t)<fx)&&(i=!0,t=e),{a:e,b:t,rf:r,sphere:i}}(r.a,r.b,r.rf,r.ellps,r.sphere),s=function(e,t,r,n){var i=e*e,o=t*t,s=(i-o)/i,a=0;return n?(i=(e*=1-s*(.16666666666666666+s*(.04722222222222222+.022156084656084655*s)))*e,s=0):a=Math.sqrt(s),{es:s,e:a,ep2:(i-o)/o}}(o.a,o.b,o.rf,r.R_A),a=r.datum||function(e,t,r,n,i,o){var s={};return s.datum_type=void 0===e||"none"===e?5:4,t&&(s.datum_params=t.map(parseFloat),0===s.datum_params[0]&&0===s.datum_params[1]&&0===s.datum_params[2]||(s.datum_type=1),s.datum_params.length>3&&(0===s.datum_params[3]&&0===s.datum_params[4]&&0===s.datum_params[5]&&0===s.datum_params[6]||(s.datum_type=2,s.datum_params[3]*=px,s.datum_params[4]*=px,s.datum_params[5]*=px,s.datum_params[6]=s.datum_params[6]/1e6+1))),s.a=r,s.b=n,s.es=i,s.ep2=o,s}(r.datumCode,r.datum_params,o.a,o.b,s.es,s.ep2);Gx(this,r),Gx(this,n),this.a=o.a,this.b=o.b,this.rf=o.rf,this.sphere=o.sphere,this.es=s.es,this.e=s.e,this.ep2=s.ep2,this.datum=a,this.init(),t(null,this)}else t(e)}else t(e)}function rC(e,t,r){var n,i,o,s,a=e.x,u=e.y,c=e.z?e.z:0;if(u<-dx&&u>-1.001*dx)u=-dx;else if(u>dx&&u<1.001*dx)u=dx;else{if(u<-dx)return{x:-1/0,y:-1/0,z:e.z};if(u>dx)return{x:1/0,y:1/0,z:e.z}}return a>Math.PI&&(a-=2*Math.PI),i=Math.sin(u),s=Math.cos(u),o=i*i,{x:((n=r/Math.sqrt(1-t*o))+c)*s*Math.cos(a),y:(n+c)*s*Math.sin(a),z:(n*(1-t)+c)*i}}function nC(e,t,r,n){var i,o,s,a,u,c,l,h,p,d,f,A,g,_,m,y=1e-12,E=e.x,x=e.y,C=e.z?e.z:0;if(i=Math.sqrt(E*E+x*x),o=Math.sqrt(E*E+x*x+C*C),i/r<y){if(_=0,o/r<y)return m=-n,{x:e.x,y:e.y,z:e.z}}else _=Math.atan2(x,E);s=C/o,h=(a=i/o)*(1-t)*(u=1/Math.sqrt(1-t*(2-t)*a*a)),p=s*u,g=0;do{g++,c=t*(l=r/Math.sqrt(1-t*p*p))/(l+(m=i*h+C*p-l*(1-t*p*p))),A=(f=s*(u=1/Math.sqrt(1-c*(2-c)*a*a)))*h-(d=a*(1-c)*u)*p,h=d,p=f}while(A*A>1e-24&&g<30);return{x:_,y:Math.atan(f/Math.abs(d)),z:m}}function iC(e){return 1===e||2===e}eC.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},eC.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},eC.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},eC.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},eC.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},eC.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},eC.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},eC.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},eC.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},eC.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},eC.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},eC.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},eC.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},eC.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},eC.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},eC.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},eC.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},tC.projections=Jx,tC.projections.start();var oC=function(e,t,r){return function(e,t){return e.datum_type===t.datum_type&&!(e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(1===e.datum_type?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:2!==e.datum_type||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6])}(e,t)||5===e.datum_type||5===t.datum_type?r:e.es!==t.es||e.a!==t.a||iC(e.datum_type)||iC(t.datum_type)?(r=rC(r,e.es,e.a),iC(e.datum_type)&&(r=function(e,t,r){if(1===t)return{x:e.x+r[0],y:e.y+r[1],z:e.z+r[2]};if(2===t){var n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],u=r[5],c=r[6];return{x:c*(e.x-u*e.y+a*e.z)+n,y:c*(u*e.x+e.y-s*e.z)+i,z:c*(-a*e.x+s*e.y+e.z)+o}}}(r,e.datum_type,e.datum_params)),iC(t.datum_type)&&(r=function(e,t,r){if(1===t)return{x:e.x-r[0],y:e.y-r[1],z:e.z-r[2]};if(2===t){var n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],u=r[5],c=r[6],l=(e.x-n)/c,h=(e.y-i)/c,p=(e.z-o)/c;return{x:l+u*h-a*p,y:-u*l+h+s*p,z:a*l-s*h+p}}}(r,t.datum_type,t.datum_params)),nC(r,t.es,t.a,t.b)):r},sC=function(e,t,r){var n,i,o,s=r.x,a=r.y,u=r.z||0,c={};for(o=0;o<3;o++)if(!t||2!==o||void 0!==r.z)switch(0===o?(n=s,i=-1!=="ew".indexOf(e.axis[o])?"x":"y"):1===o?(n=a,i=-1!=="ns".indexOf(e.axis[o])?"y":"x"):(n=u,i="z"),e.axis[o]){case"e":case"w":case"n":case"s":c[i]=n;break;case"u":void 0!==r[i]&&(c.z=n);break;case"d":void 0!==r[i]&&(c.z=-n);break;default:return null}return c},aC=function(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t};function uC(e){if("function"==typeof Number.isFinite){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof e||e!=e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function cC(e,t,r){var n;return Array.isArray(r)&&(r=aC(r)),function(e){uC(e.x),uC(e.y)}(r),e.datum&&t.datum&&function(e,t){return(1===e.datum.datum_type||2===e.datum.datum_type)&&"WGS84"!==t.datumCode||(1===t.datum.datum_type||2===t.datum.datum_type)&&"WGS84"!==e.datumCode}(e,t)&&(r=cC(e,n=new tC("WGS84"),r),e=n),"enu"!==e.axis&&(r=sC(e,!1,r)),"longlat"===e.projName?r={x:r.x*Ax,y:r.y*Ax,z:r.z||0}:(e.to_meter&&(r={x:r.x*e.to_meter,y:r.y*e.to_meter,z:r.z||0}),r=e.inverse(r)),e.from_greenwich&&(r.x+=e.from_greenwich),r=oC(e.datum,t.datum,r),t.from_greenwich&&(r={x:r.x-t.from_greenwich,y:r.y,z:r.z||0}),"longlat"===t.projName?r={x:r.x*gx,y:r.y*gx,z:r.z||0}:(r=t.forward(r),t.to_meter&&(r={x:r.x/t.to_meter,y:r.y/t.to_meter,z:r.z||0})),"enu"!==t.axis?sC(t,!0,r):r}var lC=tC("WGS84");function hC(e,t,r){var n,i,o;return Array.isArray(r)?(n=cC(e,t,r)||{x:NaN,y:NaN},r.length>2?void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name?"number"==typeof n.z?[n.x,n.y,n.z].concat(r.splice(3)):[n.x,n.y,r[2]].concat(r.splice(3)):[n.x,n.y].concat(r.splice(2)):[n.x,n.y]):(i=cC(e,t,r),2===(o=Object.keys(r)).length||o.forEach((function(n){if(void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name){if("x"===n||"y"===n||"z"===n)return}else if("x"===n||"y"===n)return;i[n]=r[n]})),i)}function pC(e){return e instanceof tC?e:e.oProj?e.oProj:tC(e)}function dC(e,t,r){e=pC(e);var n,i=!1;return void 0===t?(t=e,e=lC,i=!0):(void 0!==t.x||Array.isArray(t))&&(r=t,t=e,e=lC,i=!0),t=pC(t),r?hC(e,t,r):(n={forward:function(r){return hC(e,t,r)},inverse:function(r){return hC(t,e,r)}},i&&(n.oProj=t),n)}var fC="AJSAJS",AC="AFAFAF",gC=65,_C=73,mC=79,yC=86,EC=90,xC={forward:CC,inverse:function(e){var t=vC(wC(e.toUpperCase()));if(t.lat&&t.lon)return[t.lon,t.lat,t.lon,t.lat];return[t.left,t.bottom,t.right,t.top]},toPoint:bC};function CC(e,t){return t=t||5,function(e,t){var r="00000"+e.easting,n="00000"+e.northing;return e.zoneNumber+e.zoneLetter+(d=e.easting,f=e.northing,A=e.zoneNumber,g=MC(A),_=Math.floor(d/1e5),m=Math.floor(f/1e5)%20,i=_,o=m,s=g,a=s-1,u=fC.charCodeAt(a),c=AC.charCodeAt(a),l=u+i-1,h=c+o,p=!1,l>EC&&(l=l-EC+gC-1,p=!0),(l===_C||u<_C&&l>_C||(l>_C||u<_C)&&p)&&l++,(l===mC||u<mC&&l>mC||(l>mC||u<mC)&&p)&&++l===_C&&l++,l>EC&&(l=l-EC+gC-1),h>yC?(h=h-yC+gC-1,p=!0):p=!1,(h===_C||c<_C&&h>_C||(h>_C||c<_C)&&p)&&h++,(h===mC||c<mC&&h>mC||(h>mC||c<mC)&&p)&&++h===_C&&h++,h>yC&&(h=h-yC+gC-1),String.fromCharCode(l)+String.fromCharCode(h))+r.substr(r.length-5,t)+n.substr(n.length-5,t);var i,o,s,a,u,c,l,h,p;var d,f,A,g,_,m}(function(e){var t,r,n,i,o,s,a,u,c=e.lat,l=e.lon,h=6378137,p=.00669438,d=.9996,f=IC(c),A=IC(l);u=Math.floor((l+180)/6)+1,180===l&&(u=60);c>=56&&c<64&&l>=3&&l<12&&(u=32);c>=72&&c<84&&(l>=0&&l<9?u=31:l>=9&&l<21?u=33:l>=21&&l<33?u=35:l>=33&&l<42&&(u=37));a=IC(6*(u-1)-180+3),t=p/(1-p),r=h/Math.sqrt(1-p*Math.sin(f)*Math.sin(f)),n=Math.tan(f)*Math.tan(f),i=t*Math.cos(f)*Math.cos(f),o=Math.cos(f)*(A-a),s=h*((1-p/4-3*p*p/64-5*p*p*p/256)*f-(3*p/8+3*p*p/32+45*p*p*p/1024)*Math.sin(2*f)+(15*p*p/256+45*p*p*p/1024)*Math.sin(4*f)-35*p*p*p/3072*Math.sin(6*f));var g=d*r*(o+(1-n+i)*o*o*o/6+(5-18*n+n*n+72*i-58*t)*o*o*o*o*o/120)+5e5,_=d*(s+r*Math.tan(f)*(o*o/2+(5-n+9*i+4*i*i)*o*o*o*o/24+(61-58*n+n*n+600*i-330*t)*o*o*o*o*o*o/720));c<0&&(_+=1e7);return{northing:Math.round(_),easting:Math.round(g),zoneNumber:u,zoneLetter:RC(c)}}({lat:e[1],lon:e[0]}),t)}function bC(e){var t=vC(wC(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function IC(e){return e*(Math.PI/180)}function TC(e){return e/Math.PI*180}function vC(e){var t=e.northing,r=e.easting,n=e.zoneLetter,i=e.zoneNumber;if(i<0||i>60)return null;var o,s,a,u,c,l,h,p,d,f=.9996,A=6378137,g=.00669438,_=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),m=r-5e5,y=t;n<"N"&&(y-=1e7),h=6*(i-1)-180+3,o=.006739496752268451,d=(p=y/f/6367449.145945056)+(3*_/2-27*_*_*_/32)*Math.sin(2*p)+(21*_*_/16-55*_*_*_*_/32)*Math.sin(4*p)+151*_*_*_/96*Math.sin(6*p),s=A/Math.sqrt(1-g*Math.sin(d)*Math.sin(d)),a=Math.tan(d)*Math.tan(d),u=o*Math.cos(d)*Math.cos(d),c=.99330562*A/Math.pow(1-g*Math.sin(d)*Math.sin(d),1.5),l=m/(s*f);var E=d-s*Math.tan(d)/c*(l*l/2-(5+3*a+10*u-4*u*u-9*o)*l*l*l*l/24+(61+90*a+298*u+45*a*a-1.6983531815716497-3*u*u)*l*l*l*l*l*l/720);E=TC(E);var x,C=(l-(1+2*a+u)*l*l*l/6+(5-2*u+28*a-3*u*u+8*o+24*a*a)*l*l*l*l*l/120)/Math.cos(d);if(C=h+TC(C),e.accuracy){var b=vC({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});x={top:b.lat,right:b.lon,bottom:E,left:C}}else x={lat:E,lon:C};return x}function RC(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function MC(e){var t=e%6;return 0===t&&(t=6),t}function wC(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,r=e.length,n=null,i="",o=0;!/[A-Z]/.test(t=e.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+e;i+=t,o++}var s=parseInt(i,10);if(0===o||o+3>r)throw"MGRSPoint bad conversion from: "+e;var a=e.charAt(o++);if(a<="A"||"B"===a||"Y"===a||a>="Z"||"I"===a||"O"===a)throw"MGRSPoint zone letter "+a+" not handled: "+e;n=e.substring(o,o+=2);for(var u=MC(s),c=function(e,t){var r=fC.charCodeAt(t-1),n=1e5,i=!1;for(;r!==e.charCodeAt(0);){if(++r===_C&&r++,r===mC&&r++,r>EC){if(i)throw"Bad character: "+e;r=gC,i=!0}n+=1e5}return n}(n.charAt(0),u),l=function(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;var r=AC.charCodeAt(t-1),n=0,i=!1;for(;r!==e.charCodeAt(0);){if(++r===_C&&r++,r===mC&&r++,r>yC){if(i)throw"Bad character: "+e;r=gC,i=!0}n+=1e5}return n}(n.charAt(1),u);l<SC(a);)l+=2e6;var h=r-o;if(h%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var p,d,f,A=h/2,g=0,_=0;return A>0&&(p=1e5/Math.pow(10,A),d=e.substring(o,o+A),g=parseFloat(d)*p,f=e.substring(o+A),_=parseFloat(f)*p),{easting:g+c,northing:_+l,zoneLetter:a,zoneNumber:s,accuracy:p}}function SC(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function BC(e,t,r){if(!(this instanceof BC))return new BC(e,t,r);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var n=e.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=e,this.y=t,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}BC.fromMGRS=function(e){return new BC(bC(e))},BC.prototype.toMGRS=function(e){return CC([this.x,this.y],e)};var OC=.046875,DC=.01953125,FC=.01068115234375,PC=function(e){var t=[];t[0]=1-e*(.25+e*(OC+e*(DC+e*FC))),t[1]=e*(.75-e*(OC+e*(DC+e*FC)));var r=e*e;return t[2]=r*(.46875-e*(.013020833333333334+.007120768229166667*e)),r*=e,t[3]=r*(.3645833333333333-.005696614583333333*e),t[4]=r*e*.3076171875,t},NC=function(e,t,r,n){return r*=t,t*=t,n[0]*e-r*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))},LC=function(e,t,r){for(var n=1/(1-t),i=e,o=20;o;--o){var s=Math.sin(i),a=1-t*s*s;if(i-=a=(NC(i,s,Math.cos(i),r)-e)*(a*Math.sqrt(a))*n,Math.abs(a)<fx)return i}return i};var UC={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=PC(this.es),this.ml0=NC(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(e){var t,r,n,i=e.x,o=e.y,s=zx(i-this.long0),a=Math.sin(o),u=Math.cos(o);if(this.es){var c=u*s,l=Math.pow(c,2),h=this.ep2*Math.pow(u,2),p=Math.pow(h,2),d=Math.abs(u)>fx?Math.tan(o):0,f=Math.pow(d,2),A=Math.pow(f,2);t=1-this.es*Math.pow(a,2),c/=Math.sqrt(t);var g=NC(o,a,u,this.en);r=this.a*(this.k0*c*(1+l/6*(1-f+h+l/20*(5-18*f+A+14*h-58*f*h+l/42*(61+179*A-A*f-479*f)))))+this.x0,n=this.a*(this.k0*(g-this.ml0+a*s*c/2*(1+l/12*(5-f+9*h+4*p+l/30*(61+A-58*f+270*h-330*f*h+l/56*(1385+543*A-A*f-3111*f))))))+this.y0}else{var _=u*Math.sin(s);if(Math.abs(Math.abs(_)-1)<fx)return 93;if(r=.5*this.a*this.k0*Math.log((1+_)/(1-_))+this.x0,n=u*Math.cos(s)/Math.sqrt(1-Math.pow(_,2)),(_=Math.abs(n))>=1){if(_-1>fx)return 93;n=0}else n=Math.acos(n);o<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return e.x=r,e.y=n,e},inverse:function(e){var t,r,n,i,o=(e.x-this.x0)*(1/this.a),s=(e.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+s/this.k0,r=LC(t,this.es,this.en),Math.abs(r)<dx){var a=Math.sin(r),u=Math.cos(r),c=Math.abs(u)>fx?Math.tan(r):0,l=this.ep2*Math.pow(u,2),h=Math.pow(l,2),p=Math.pow(c,2),d=Math.pow(p,2);t=1-this.es*Math.pow(a,2);var f=o*Math.sqrt(t)/this.k0,A=Math.pow(f,2);n=r-(t*=c)*A/(1-this.es)*.5*(1-A/12*(5+3*p-9*l*p+l-4*h-A/30*(61+90*p-252*l*p+45*d+46*l-A/56*(1385+3633*p+4095*d+1574*d*p)))),i=zx(this.long0+f*(1-A/6*(1+2*p+l-A/20*(5+28*p+24*d+8*l*p+6*l-A/42*(61+662*p+1320*d+720*d*p))))/u)}else n=dx*kx(s),i=0;else{var g=Math.exp(o/this.k0),_=.5*(g-1/g),m=this.lat0+s/this.k0,y=Math.cos(m);t=Math.sqrt((1-Math.pow(y,2))/(1+Math.pow(_,2))),n=Math.asin(t),s<0&&(n=-n),i=0===_&&0===y?0:zx(Math.atan2(_,y)+this.long0)}return e.x=i,e.y=n,e},names:["Transverse_Mercator","Transverse Mercator","tmerc"]},GC=function(e){var t=Math.exp(e);return t=(t-1/t)/2},QC=function(e,t){e=Math.abs(e),t=Math.abs(t);var r=Math.max(e,t),n=Math.min(e,t)/(r||1);return r*Math.sqrt(1+Math.pow(n,2))},kC=function(e){var t=Math.abs(e);return t=function(e){var t=1+e,r=t-1;return 0===r?e:e*Math.log(t)/r}(t*(1+t/(QC(1,t)+1))),e<0?-t:t},zC=function(e,t){for(var r,n=2*Math.cos(2*t),i=e.length-1,o=e[i],s=0;--i>=0;)r=n*o-s+e[i],s=o,o=r;return t+r*Math.sin(2*t)},jC=function(e,t,r){for(var n,i,o=Math.sin(t),s=Math.cos(t),a=GC(r),u=function(e){var t=Math.exp(e);return(t+1/t)/2}(r),c=2*s*u,l=-2*o*a,h=e.length-1,p=e[h],d=0,f=0,A=0;--h>=0;)n=f,i=d,p=c*(f=p)-n-l*(d=A)+e[h],A=l*f-i+c*d;return[(c=o*u)*p-(l=s*a)*A,c*A+l*p]};var HC={init:function(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),r=t;this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+t*(-2854/675)))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))-2),r*=t,this.cgb[1]=r*(7/3+t*(t*(-227/45+t*(2704/315+t*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),r*=t,this.cgb[2]=r*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=r*(-26/15+t*(34/21+t*(1.6+t*(-12686/2835)))),r*=t,this.cgb[3]=r*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=r*(1237/630+t*(t*(-24832/14175)-2.4)),r*=t,this.cgb[4]=r*(4174/315+t*(-144838/6237)),this.cbg[4]=r*(-734/315+t*(109598/31185)),r*=t,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+r*(1/4+r*(1/64+r/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=r*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=r*(13/48+t*(t*(557/1440+t*(281/630+t*(-1983433/1935360)))-.6)),r*=t,this.utg[2]=r*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=r*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),r*=t,this.utg[3]=r*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=r*(49561/161280+t*(-179/168+t*(6601661/7257600))),r*=t,this.utg[4]=r*(-4583/161280+t*(108847/3991680)),this.gtu[4]=r*(34729/80640+t*(-3418889/1995840)),r*=t,this.utg[5]=r*(-20648693/638668800),this.gtu[5]=.6650675310896665*r;var n=zC(this.cbg,this.lat0);this.Zb=-this.Qn*(n+function(e,t){for(var r,n=2*Math.cos(t),i=e.length-1,o=e[i],s=0;--i>=0;)r=n*o-s+e[i],s=o,o=r;return Math.sin(t)*r}(this.gtu,2*n))},forward:function(e){var t=zx(e.x-this.long0),r=e.y;r=zC(this.cbg,r);var n=Math.sin(r),i=Math.cos(r),o=Math.sin(t),s=Math.cos(t);r=Math.atan2(n,s*i),t=Math.atan2(o*i,QC(n,i*s)),t=kC(Math.tan(t));var a,u,c=jC(this.gtu,2*r,2*t);return r+=c[0],t+=c[1],Math.abs(t)<=2.623395162778?(a=this.a*(this.Qn*t)+this.x0,u=this.a*(this.Qn*r+this.Zb)+this.y0):(a=1/0,u=1/0),e.x=a,e.y=u,e},inverse:function(e){var t,r,n=(e.x-this.x0)*(1/this.a),i=(e.y-this.y0)*(1/this.a);if(i=(i-this.Zb)/this.Qn,n/=this.Qn,Math.abs(n)<=2.623395162778){var o=jC(this.utg,2*i,2*n);i+=o[0],n+=o[1],n=Math.atan(GC(n));var s=Math.sin(i),a=Math.cos(i),u=Math.sin(n),c=Math.cos(n);i=Math.atan2(s*c,QC(u,c*a)),n=Math.atan2(u,c*a),t=zx(n+this.long0),r=zC(this.cgb,i)}else t=1/0,r=1/0;return e.x=t,e.y=r,e},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"]};var qC={init:function(){var e=function(e,t){if(void 0===e){if((e=Math.floor(30*(zx(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e}(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*Ax,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,HC.init.apply(this),this.forward=HC.forward,this.inverse=HC.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},VC=function(e,t){return Math.pow((1-e)/(1+e),t)};var YC={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+_x)/(Math.pow(Math.tan(.5*this.lat0+_x),this.C)*VC(this.e*e,this.ratexp))},forward:function(e){var t=e.x,r=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+_x),this.C)*VC(this.e*Math.sin(r),this.ratexp))-dx,e.x=this.C*t,e},inverse:function(e){for(var t=e.x/this.C,r=e.y,n=Math.pow(Math.tan(.5*r+_x)/this.K,1/this.C),i=20;i>0&&(r=2*Math.atan(n*VC(this.e*Math.sin(e.y),-.5*this.e))-dx,!(Math.abs(r-e.y)<1e-14));--i)e.y=r;return i?(e.x=t,e.y=r,e):null},names:["gauss"]};var XC={init:function(){YC.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(e){var t,r,n,i;return e.x=zx(e.x-this.long0),YC.forward.apply(this,[e]),t=Math.sin(e.y),r=Math.cos(e.y),n=Math.cos(e.x),i=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*r*n),e.x=i*r*Math.sin(e.x),e.y=i*(this.cosc0*t-this.sinc0*r*n),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,r,n,i,o;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,o=Math.sqrt(e.x*e.x+e.y*e.y)){var s=2*Math.atan2(o,this.R2);t=Math.sin(s),r=Math.cos(s),i=Math.asin(r*this.sinc0+e.y*t*this.cosc0/o),n=Math.atan2(e.x*t,o*this.cosc0*r-e.y*this.sinc0*t)}else i=this.phic0,n=0;return e.x=n,e.y=i,YC.inverse.apply(this,[e]),e.x=zx(e.x+this.long0),e},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};var WC={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=fx&&(this.k0=.5*(1+kx(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=fx&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=fx&&(this.k0=.5*this.cons*Qx(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/jx(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Qx(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-dx,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(e){var t,r,n,i,o,s,a=e.x,u=e.y,c=Math.sin(u),l=Math.cos(u),h=zx(a-this.long0);return Math.abs(Math.abs(a-this.long0)-Math.PI)<=fx&&Math.abs(u+this.lat0)<=fx?(e.x=NaN,e.y=NaN,e):this.sphere?(t=2*this.k0/(1+this.sinlat0*c+this.coslat0*l*Math.cos(h)),e.x=this.a*t*l*Math.sin(h)+this.x0,e.y=this.a*t*(this.coslat0*c-this.sinlat0*l*Math.cos(h))+this.y0,e):(r=2*Math.atan(this.ssfn_(u,c,this.e))-dx,i=Math.cos(r),n=Math.sin(r),Math.abs(this.coslat0)<=fx?(o=jx(this.e,u*this.con,this.con*c),s=2*this.a*this.k0*o/this.cons,e.x=this.x0+s*Math.sin(a-this.long0),e.y=this.y0-this.con*s*Math.cos(a-this.long0),e):(Math.abs(this.sinlat0)<fx?(t=2*this.a*this.k0/(1+i*Math.cos(h)),e.y=t*n):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*i*Math.cos(h))),e.y=t*(this.cosX0*n-this.sinX0*i*Math.cos(h))+this.y0),e.x=t*i*Math.sin(h)+this.x0,e))},inverse:function(e){var t,r,n,i,o;e.x-=this.x0,e.y-=this.y0;var s=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var a=2*Math.atan(s/(2*this.a*this.k0));return t=this.long0,r=this.lat0,s<=fx?(e.x=t,e.y=r,e):(r=Math.asin(Math.cos(a)*this.sinlat0+e.y*Math.sin(a)*this.coslat0/s),t=Math.abs(this.coslat0)<fx?this.lat0>0?zx(this.long0+Math.atan2(e.x,-1*e.y)):zx(this.long0+Math.atan2(e.x,e.y)):zx(this.long0+Math.atan2(e.x*Math.sin(a),s*this.coslat0*Math.cos(a)-e.y*this.sinlat0*Math.sin(a))),e.x=t,e.y=r,e)}if(Math.abs(this.coslat0)<=fx){if(s<=fx)return r=this.lat0,t=this.long0,e.x=t,e.y=r,e;e.x*=this.con,e.y*=this.con,n=s*this.cons/(2*this.a*this.k0),r=this.con*Hx(this.e,n),t=this.con*zx(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else i=2*Math.atan(s*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,s<=fx?o=this.X0:(o=Math.asin(Math.cos(i)*this.sinX0+e.y*Math.sin(i)*this.cosX0/s),t=zx(this.long0+Math.atan2(e.x*Math.sin(i),s*this.cosX0*Math.cos(i)-e.y*this.sinX0*Math.sin(i)))),r=-1*Hx(this.e,Math.tan(.5*(dx+o)));return e.x=t,e.y=r,e},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(e,t,r){return t*=r,Math.tan(.5*(dx+e))*Math.pow((1-t)/(1+t),.5*r)}};var KC={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),r=this.a,n=1/this.rf,i=2*n-Math.pow(n,2),o=this.e=Math.sqrt(i);this.R=this.k0*r*Math.sqrt(1-i)/(1-i*Math.pow(t,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var s=Math.log(Math.tan(Math.PI/4+this.b0/2)),a=Math.log(Math.tan(Math.PI/4+e/2)),u=Math.log((1+o*t)/(1-o*t));this.K=s-this.alpha*a+this.alpha*o/2*u},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),n=-this.alpha*(t+r)+this.K,i=2*(Math.atan(Math.exp(n))-Math.PI/4),o=this.alpha*(e.x-this.lambda0),s=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(o))),a=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(o));return e.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,e.x=this.R*s+this.x0,e},inverse:function(e){for(var t=e.x-this.x0,r=e.y-this.y0,n=t/this.R,i=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(n)),s=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(i))),a=this.lambda0+s/this.alpha,u=0,c=o,l=-1e3,h=0;Math.abs(c-l)>1e-7;){if(++h>20)return;u=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),l=c,c=2*Math.atan(Math.exp(u))-Math.PI/2}return e.x=a,e.y=c,e},names:["somerc"]};var JC={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var e=Math.sin(this.lat0),t=Math.cos(this.lat0),r=this.e*e;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(t,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-r*r);var n,i,o=jx(this.e,this.lat0,e),s=this.bl/t*Math.sqrt((1-this.es)/(1-r*r));if(s*s<1&&(s=1),isNaN(this.longc)){var a=jx(this.e,this.lat1,Math.sin(this.lat1)),u=jx(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(s+Math.sqrt(s*s-1))*Math.pow(o,this.bl):this.el=(s-Math.sqrt(s*s-1))*Math.pow(o,this.bl);var c=Math.pow(a,this.bl),l=Math.pow(u,this.bl);i=.5*((n=this.el/c)-1/n);var h=(this.el*this.el-l*c)/(this.el*this.el+l*c),p=(l-c)/(l+c),d=zx(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(h*Math.tan(.5*this.bl*d)/p)/this.bl,this.long0=zx(this.long0);var f=zx(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*f)/i),this.alpha=Math.asin(s*Math.sin(this.gamma0))}else n=this.lat0>=0?s+Math.sqrt(s*s-1):s-Math.sqrt(s*s-1),this.el=n*Math.pow(o,this.bl),i=.5*(n-1/n),this.gamma0=Math.asin(Math.sin(this.alpha)/s),this.long0=this.longc-Math.asin(i*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha))},forward:function(e){var t,r,n,i=e.x,o=e.y,s=zx(i-this.long0);if(Math.abs(Math.abs(o)-dx)<=fx)n=o>0?-1:1,r=this.al/this.bl*Math.log(Math.tan(_x+n*this.gamma0*.5)),t=-1*n*dx*this.al/this.bl;else{var a=jx(this.e,o,Math.sin(o)),u=this.el/Math.pow(a,this.bl),c=.5*(u-1/u),l=.5*(u+1/u),h=Math.sin(this.bl*s),p=(c*Math.sin(this.gamma0)-h*Math.cos(this.gamma0))/l;r=Math.abs(Math.abs(p)-1)<=fx?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-p)/(1+p))/this.bl,t=Math.abs(Math.cos(this.bl*s))<=fx?this.al*this.bl*s:this.al*Math.atan2(c*Math.cos(this.gamma0)+h*Math.sin(this.gamma0),Math.cos(this.bl*s))/this.bl}return this.no_rot?(e.x=this.x0+t,e.y=this.y0+r):(t-=this.uc,e.x=this.x0+r*Math.cos(this.alpha)+t*Math.sin(this.alpha),e.y=this.y0+t*Math.cos(this.alpha)-r*Math.sin(this.alpha)),e},inverse:function(e){var t,r;this.no_rot?(r=e.y-this.y0,t=e.x-this.x0):(r=(e.x-this.x0)*Math.cos(this.alpha)-(e.y-this.y0)*Math.sin(this.alpha),t=(e.y-this.y0)*Math.cos(this.alpha)+(e.x-this.x0)*Math.sin(this.alpha),t+=this.uc);var n=Math.exp(-1*this.bl*r/this.al),i=.5*(n-1/n),o=.5*(n+1/n),s=Math.sin(this.bl*t/this.al),a=(s*Math.cos(this.gamma0)+i*Math.sin(this.gamma0))/o,u=Math.pow(this.el/Math.sqrt((1+a)/(1-a)),1/this.bl);return Math.abs(a-1)<fx?(e.x=this.long0,e.y=dx):Math.abs(a+1)<fx?(e.x=this.long0,e.y=-1*dx):(e.y=Hx(this.e,u),e.x=zx(this.long0-Math.atan2(i*Math.cos(this.gamma0)-s*Math.sin(this.gamma0),Math.cos(this.bl*t/this.al))/this.bl)),e},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]};var ZC={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<fx)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),r=Math.cos(this.lat1),n=Qx(this.e,t,r),i=jx(this.e,this.lat1,t),o=Math.sin(this.lat2),s=Math.cos(this.lat2),a=Qx(this.e,o,s),u=jx(this.e,this.lat2,o),c=jx(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>fx?this.ns=Math.log(n/a)/Math.log(i/u):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=n/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(e){var t=e.x,r=e.y;Math.abs(2*Math.abs(r)-Math.PI)<=fx&&(r=kx(r)*(dx-2e-10));var n,i,o=Math.abs(Math.abs(r)-dx);if(o>fx)n=jx(this.e,r,Math.sin(r)),i=this.a*this.f0*Math.pow(n,this.ns);else{if((o=r*this.ns)<=0)return null;i=0}var s=this.ns*zx(t-this.long0);return e.x=this.k0*(i*Math.sin(s))+this.x0,e.y=this.k0*(this.rh-i*Math.cos(s))+this.y0,e},inverse:function(e){var t,r,n,i,o,s=(e.x-this.x0)/this.k0,a=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(s*s+a*a),r=1):(t=-Math.sqrt(s*s+a*a),r=-1);var u=0;if(0!==t&&(u=Math.atan2(r*s,r*a)),0!==t||this.ns>0){if(r=1/this.ns,n=Math.pow(t/(this.a*this.f0),r),-9999===(i=Hx(this.e,n)))return null}else i=-dx;return o=zx(u/this.ns+this.long0),e.x=o,e.y=i,e},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]};var $C={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(e){var t,r,n,i,o,s,a,u=e.x,c=e.y,l=zx(u-this.long0);return t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45),n=-l*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),o=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(i)),s=this.n*o,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),e.y=a*Math.cos(s)/1,e.x=a*Math.sin(s)/1,this.czech||(e.y*=-1,e.x*=-1),e},inverse:function(e){var t,r,n,i,o,s,a,u=e.x;e.x=e.y,e.y=u,this.czech||(e.y*=-1,e.x*=-1),o=Math.sqrt(e.x*e.x+e.y*e.y),i=Math.atan2(e.y,e.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),r=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(t)),e.x=this.long0-r/this.alfa,s=t,a=0;var c=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(s))/(1-this.e*Math.sin(s)),this.e/2))-this.s45),Math.abs(s-e.y)<1e-10&&(a=1),s=e.y,c+=1}while(0===a&&c<15);return c>=15?null:e},names:["Krovak","krovak"]},eb=function(e,t,r,n,i){return e*i-t*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)},tb=function(e){return 1-.25*e*(1+e/16*(3+1.25*e))},rb=function(e){return.375*e*(1+.25*e*(1+.46875*e))},nb=function(e){return.05859375*e*e*(1+.75*e)},ib=function(e){return e*e*e*(35/3072)},ob=function(e,t,r){var n=t*r;return e/Math.sqrt(1-n*n)},sb=function(e){return Math.abs(e)<dx?e:e-kx(e)*Math.PI},ab=function(e,t,r,n,i){var o,s;o=e/t;for(var a=0;a<15;a++)if(o+=s=(e-(t*o-r*Math.sin(2*o)+n*Math.sin(4*o)-i*Math.sin(6*o)))/(t-2*r*Math.cos(2*o)+4*n*Math.cos(4*o)-6*i*Math.cos(6*o)),Math.abs(s)<=1e-10)return o;return NaN};var ub={init:function(){this.sphere||(this.e0=tb(this.es),this.e1=rb(this.es),this.e2=nb(this.es),this.e3=ib(this.es),this.ml0=this.a*eb(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(e){var t,r,n=e.x,i=e.y;if(n=zx(n-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(i)*Math.sin(n)),r=this.a*(Math.atan2(Math.tan(i),Math.cos(n))-this.lat0);else{var o=Math.sin(i),s=Math.cos(i),a=ob(this.a,this.e,o),u=Math.tan(i)*Math.tan(i),c=n*Math.cos(i),l=c*c,h=this.es*s*s/(1-this.es);t=a*c*(1-l*u*(1/6-(8-u+8*h)*l/120)),r=this.a*eb(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+a*o/s*l*(.5+(5-u+6*h)*l/24)}return e.x=t+this.x0,e.y=r+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,r,n=e.x/this.a,i=e.y/this.a;if(this.sphere){var o=i+this.lat0;t=Math.asin(Math.sin(o)*Math.cos(n)),r=Math.atan2(Math.tan(n),Math.cos(o))}else{var s=this.ml0/this.a+i,a=ab(s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-dx)<=fx)return e.x=this.long0,e.y=dx,i<0&&(e.y*=-1),e;var u=ob(this.a,this.e,Math.sin(a)),c=u*u*u/this.a/this.a*(1-this.es),l=Math.pow(Math.tan(a),2),h=n*this.a/u,p=h*h;t=a-u*Math.tan(a)/c*h*h*(.5-(1+3*l)*h*h/24),r=h*(1-p*(l/3+(1+3*l)*l*p/15))/Math.cos(a)}return e.x=zx(r+this.long0),e.y=sb(t),e},names:["Cassini","Cassini_Soldner","cass"]},cb=function(e,t){var r;return e>1e-7?(1-e*e)*(t/(1-(r=e*t)*r)-.5/e*Math.log((1-r)/(1+r))):2*t};var lb=.3333333333333333,hb=.17222222222222222,pb=.10257936507936508,db=.06388888888888888,fb=.0664021164021164,Ab=.016415012942191543;var gb={init:function(){var e,t=Math.abs(this.lat0);if(Math.abs(t-dx)<fx?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<fx?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=cb(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(e){var t,r=[];return r[0]=e*lb,t=e*e,r[0]+=t*hb,r[1]=t*db,t*=e,r[0]+=t*pb,r[1]+=t*fb,r[2]=t*Ab,r}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=cb(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,r,n,i,o,s,a,u,c,l,h=e.x,p=e.y;if(h=zx(h-this.long0),this.sphere){if(o=Math.sin(p),l=Math.cos(p),n=Math.cos(h),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+l*n:1+this.sinph0*o+this.cosph0*l*n)<=fx)return null;t=(r=Math.sqrt(2/r))*l*Math.sin(h),r*=this.mode===this.EQUIT?o:this.cosph0*o-this.sinph0*l*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(p+this.phi0)<fx)return null;r=_x-.5*p,t=(r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)))*Math.sin(h),r*=n}}else{switch(a=0,u=0,c=0,n=Math.cos(h),i=Math.sin(h),o=Math.sin(p),s=cb(this.e,o),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(a=s/this.qp,u=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:c=1+this.sinb1*a+this.cosb1*u*n;break;case this.EQUIT:c=1+u*n;break;case this.N_POLE:c=dx+p,s=this.qp-s;break;case this.S_POLE:c=p-dx,s=this.qp+s}if(Math.abs(c)<fx)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),r=this.mode===this.OBLIQ?this.ymf*c*(this.cosb1*a-this.sinb1*u*n):(c=Math.sqrt(2/(1+u*n)))*a*this.ymf,t=this.xmf*c*u*i;break;case this.N_POLE:case this.S_POLE:s>=0?(t=(c=Math.sqrt(s))*i,r=n*(this.mode===this.S_POLE?c:-c)):t=r=0}}return e.x=this.a*t+this.x0,e.y=this.a*r+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,r,n,i,o,s,a,u=e.x/this.a,c=e.y/this.a;if(this.sphere){var l,h=0,p=0;if((r=.5*(l=Math.sqrt(u*u+c*c)))>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(p=Math.sin(r),h=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(l)<=fx?0:Math.asin(c*p/l),u*=p,c=h*l;break;case this.OBLIQ:r=Math.abs(l)<=fx?this.phi0:Math.asin(h*this.sinph0+c*p*this.cosph0/l),u*=p*this.cosph0,c=(h-Math.sin(r)*this.sinph0)*l;break;case this.N_POLE:c=-c,r=dx-r;break;case this.S_POLE:r-=dx}t=0!==c||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(u,c):0}else{if(a=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(u/=this.dd,c*=this.dd,(s=Math.sqrt(u*u+c*c))<fx)return e.x=0,e.y=this.phi0,e;i=2*Math.asin(.5*s/this.rq),n=Math.cos(i),u*=i=Math.sin(i),this.mode===this.OBLIQ?(a=n*this.sinb1+c*i*this.cosb1/s,o=this.qp*a,c=s*this.cosb1*n-c*this.sinb1*i):(a=c*i/s,o=this.qp*a,c=s*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(c=-c),!(o=u*u+c*c))return e.x=0,e.y=this.phi0,e;a=1-o/this.qp,this.mode===this.S_POLE&&(a=-a)}t=Math.atan2(u,c),r=function(e,t){var r=e+e;return e+t[0]*Math.sin(r)+t[1]*Math.sin(r+r)+t[2]*Math.sin(r+r+r)}(Math.asin(a),this.apa)}return e.x=zx(this.long0+t),e.y=r,e},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},_b=function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)};var mb={init:function(){Math.abs(this.lat1+this.lat2)<fx||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Qx(this.e3,this.sin_po,this.cos_po),this.qs1=cb(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Qx(this.e3,this.sin_po,this.cos_po),this.qs2=cb(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=cb(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>fx?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(e){var t=e.x,r=e.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var n=cb(this.e3,this.sin_phi,this.cos_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,o=this.ns0*zx(t-this.long0),s=i*Math.sin(o)+this.x0,a=this.rh-i*Math.cos(o)+this.y0;return e.x=s,e.y=a,e},inverse:function(e){var t,r,n,i,o,s;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),n=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),n=-1),i=0,0!==t&&(i=Math.atan2(n*e.x,n*e.y)),n=t*this.ns0/this.a,this.sphere?s=Math.asin((this.c-n*n)/(2*this.ns0)):(r=(this.c-n*n)/this.ns0,s=this.phi1z(this.e3,r)),o=zx(i/this.ns0+this.long0),e.x=o,e.y=s,e},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(e,t){var r,n,i,o,s=_b(.5*t);if(e<fx)return s;for(var a=e*e,u=1;u<=25;u++)if(s+=o=.5*(i=1-(n=e*(r=Math.sin(s)))*n)*i/Math.cos(s)*(t/(1-a)-r/i+.5/e*Math.log((1-n)/(1+n))),Math.abs(o)<=1e-7)return s;return null}};var yb={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(e){var t,r,n,i,o,s,a,u=e.x,c=e.y;return n=zx(u-this.long0),t=Math.sin(c),r=Math.cos(c),i=Math.cos(n),(o=this.sin_p14*t+this.cos_p14*r*i)>0||Math.abs(o)<=fx?(s=this.x0+1*this.a*r*Math.sin(n)/o,a=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*r*i)/o):(s=this.x0+this.infinity_dist*r*Math.sin(n),a=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*r*i)),e.x=s,e.y=a,e},inverse:function(e){var t,r,n,i,o,s;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(i=Math.atan2(t,this.rc),r=Math.sin(i),n=Math.cos(i),s=_b(n*this.sin_p14+e.y*r*this.cos_p14/t),o=Math.atan2(e.x*r,t*this.cos_p14*n-e.y*this.sin_p14*r),o=zx(this.long0+o)):(s=this.phic0,o=0),e.x=o,e.y=s,e},names:["gnom"]};var Eb={init:function(){this.sphere||(this.k0=Qx(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t,r,n=e.x,i=e.y,o=zx(n-this.long0);if(this.sphere)t=this.x0+this.a*o*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var s=cb(this.e,Math.sin(i));t=this.x0+this.a*this.k0*o,r=this.y0+this.a*s*.5/this.k0}return e.x=t,e.y=r,e},inverse:function(e){var t,r;return e.x-=this.x0,e.y-=this.y0,this.sphere?(t=zx(this.long0+e.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(r=function(e,t){var r=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-r)<1e-6)return t<0?-1*dx:dx;for(var n,i,o,s,a=Math.asin(.5*t),u=0;u<30;u++)if(i=Math.sin(a),o=Math.cos(a),s=e*i,a+=n=Math.pow(1-s*s,2)/(2*o)*(t/(1-e*e)-i/(1-s*s)+.5/e*Math.log((1-s)/(1+s))),Math.abs(n)<=1e-10)return a;return NaN}(this.e,2*e.y*this.k0/this.a),t=zx(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=r,e},names:["cea"]};var xb={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,r=e.y,n=zx(t-this.long0),i=sb(r-this.lat0);return e.x=this.x0+this.a*n*this.rc,e.y=this.y0+this.a*i,e},inverse:function(e){var t=e.x,r=e.y;return e.x=zx(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=sb(this.lat0+(r-this.y0)/this.a),e},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};var Cb={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=tb(this.es),this.e1=rb(this.es),this.e2=nb(this.es),this.e3=ib(this.es),this.ml0=this.a*eb(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,r,n,i=e.x,o=e.y,s=zx(i-this.long0);if(n=s*Math.sin(o),this.sphere)Math.abs(o)<=fx?(t=this.a*s,r=-1*this.a*this.lat0):(t=this.a*Math.sin(n)/Math.tan(o),r=this.a*(sb(o-this.lat0)+(1-Math.cos(n))/Math.tan(o)));else if(Math.abs(o)<=fx)t=this.a*s,r=-1*this.ml0;else{var a=ob(this.a,this.e,Math.sin(o))/Math.tan(o);t=a*Math.sin(n),r=this.a*eb(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+a*(1-Math.cos(n))}return e.x=t+this.x0,e.y=r+this.y0,e},inverse:function(e){var t,r,n,i,o,s,a,u,c;if(n=e.x-this.x0,i=e.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=fx)t=zx(n/this.a+this.long0),r=0;else{var l;for(s=this.lat0+i/this.a,a=n*n/this.a/this.a+s*s,u=s,o=20;o;--o)if(u+=c=-1*(s*(u*(l=Math.tan(u))+1)-u-.5*(u*u+a)*l)/((u-s)/l-1),Math.abs(c)<=fx){r=u;break}t=zx(this.long0+Math.asin(n*Math.tan(u)/this.a)/Math.sin(r))}else if(Math.abs(i+this.ml0)<=fx)r=0,t=zx(this.long0+n/this.a);else{var h,p,d,f,A;for(s=(this.ml0+i)/this.a,a=n*n/this.a/this.a+s*s,u=s,o=20;o;--o)if(A=this.e*Math.sin(u),h=Math.sqrt(1-A*A)*Math.tan(u),p=this.a*eb(this.e0,this.e1,this.e2,this.e3,u),d=this.e0-2*this.e1*Math.cos(2*u)+4*this.e2*Math.cos(4*u)-6*this.e3*Math.cos(6*u),u-=c=(s*(h*(f=p/this.a)+1)-f-.5*h*(f*f+a))/(this.es*Math.sin(2*u)*(f*f+a-2*s*f)/(4*h)+(s-f)*(h*d-2/Math.sin(2*u))-d),Math.abs(c)<=fx){r=u;break}h=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),t=zx(this.long0+Math.asin(n*h/this.a)/Math.sin(r))}return e.x=t,e.y=r,e},names:["Polyconic","poly"]};var bb={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var t,r=e.x,n=e.y-this.lat0,i=r-this.long0,o=n/px*1e-5,s=i,a=1,u=0;for(t=1;t<=10;t++)a*=o,u+=this.A[t]*a;var c,l=u,h=s,p=1,d=0,f=0,A=0;for(t=1;t<=6;t++)c=d*l+p*h,p=p*l-d*h,d=c,f=f+this.B_re[t]*p-this.B_im[t]*d,A=A+this.B_im[t]*p+this.B_re[t]*d;return e.x=A*this.a+this.x0,e.y=f*this.a+this.y0,e},inverse:function(e){var t,r,n=e.x,i=e.y,o=n-this.x0,s=(i-this.y0)/this.a,a=o/this.a,u=1,c=0,l=0,h=0;for(t=1;t<=6;t++)r=c*s+u*a,u=u*s-c*a,c=r,l=l+this.C_re[t]*u-this.C_im[t]*c,h=h+this.C_im[t]*u+this.C_re[t]*c;for(var p=0;p<this.iterations;p++){var d,f=l,A=h,g=s,_=a;for(t=2;t<=6;t++)d=A*l+f*h,f=f*l-A*h,A=d,g+=(t-1)*(this.B_re[t]*f-this.B_im[t]*A),_+=(t-1)*(this.B_im[t]*f+this.B_re[t]*A);f=1,A=0;var m=this.B_re[1],y=this.B_im[1];for(t=2;t<=6;t++)d=A*l+f*h,f=f*l-A*h,A=d,m+=t*(this.B_re[t]*f-this.B_im[t]*A),y+=t*(this.B_im[t]*f+this.B_re[t]*A);var E=m*m+y*y;l=(g*m+_*y)/E,h=(_*m-g*y)/E}var x=l,C=h,b=1,I=0;for(t=1;t<=9;t++)b*=x,I+=this.D[t]*b;var T=this.lat0+I*px*1e5,v=this.long0+C;return e.x=v,e.y=T,e},names:["New_Zealand_Map_Grid","nzmg"]};var Ib={init:function(){},forward:function(e){var t=e.x,r=e.y,n=zx(t-this.long0),i=this.x0+this.a*n,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return e.x=i,e.y=o,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=zx(this.long0+e.x/this.a),r=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=r,e},names:["Miller_Cylindrical","mill"]};var Tb={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=PC(this.es)},forward:function(e){var t,r,n=e.x,i=e.y;if(n=zx(n-this.long0),this.sphere){if(this.m)for(var o=this.n*Math.sin(i),s=20;s;--s){var a=(this.m*i+Math.sin(i)-o)/(this.m+Math.cos(i));if(i-=a,Math.abs(a)<fx)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;t=this.a*this.C_x*n*(this.m+Math.cos(i)),r=this.a*this.C_y*i}else{var u=Math.sin(i),c=Math.cos(i);r=this.a*NC(i,u,c,this.en),t=this.a*n*c/Math.sqrt(1-this.es*u*u)}return e.x=t,e.y=r,e},inverse:function(e){var t,r,n,i;return e.x-=this.x0,n=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,n/=this.C_x*(this.m+Math.cos(t)),this.m?t=_b((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=_b(Math.sin(t)/this.n)),n=zx(n+this.long0),t=sb(t)):(t=LC(e.y/this.a,this.es,this.en),(i=Math.abs(t))<dx?(i=Math.sin(t),r=this.long0+e.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(t)),n=zx(r)):i-fx<dx&&(n=this.long0)),e.x=n,e.y=t,e},names:["Sinusoidal","sinu"]};var vb={init:function(){},forward:function(e){for(var t=e.x,r=e.y,n=zx(t-this.long0),i=r,o=Math.PI*Math.sin(r);;){var s=-(i+Math.sin(i)-o)/(1+Math.cos(i));if(i+=s,Math.abs(s)<fx)break}i/=2,Math.PI/2-Math.abs(r)<fx&&(n=0);var a=.900316316158*this.a*n*Math.cos(i)+this.x0,u=1.4142135623731*this.a*Math.sin(i)+this.y0;return e.x=a,e.y=u,e},inverse:function(e){var t,r;e.x-=this.x0,e.y-=this.y0,r=e.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),t=Math.asin(r);var n=zx(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),r=(2*t+Math.sin(2*t))/Math.PI,Math.abs(r)>1&&(r=1);var i=Math.asin(r);return e.x=n,e.y=i,e},names:["Mollweide","moll"]};var Rb={init:function(){Math.abs(this.lat1+this.lat2)<fx||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=tb(this.es),this.e1=rb(this.es),this.e2=nb(this.es),this.e3=ib(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Qx(this.e,this.sinphi,this.cosphi),this.ml1=eb(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<fx?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Qx(this.e,this.sinphi,this.cosphi),this.ml2=eb(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=eb(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(e){var t,r=e.x,n=e.y;if(this.sphere)t=this.a*(this.g-n);else{var i=eb(this.e0,this.e1,this.e2,this.e3,n);t=this.a*(this.g-i)}var o=this.ns*zx(r-this.long0),s=this.x0+t*Math.sin(o),a=this.y0+this.rh-t*Math.cos(o);return e.x=s,e.y=a,e},inverse:function(e){var t,r,n,i;e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns>=0?(r=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(r=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var o=0;if(0!==r&&(o=Math.atan2(t*e.x,t*e.y)),this.sphere)return i=zx(this.long0+o/this.ns),n=sb(this.g-r/this.a),e.x=i,e.y=n,e;var s=this.g-r/this.a;return n=ab(s,this.e0,this.e1,this.e2,this.e3),i=zx(this.long0+o/this.ns),e.x=i,e.y=n,e},names:["Equidistant_Conic","eqdc"]};var Mb={init:function(){this.R=this.a},forward:function(e){var t,r,n=e.x,i=e.y,o=zx(n-this.long0);Math.abs(i)<=fx&&(t=this.x0+this.R*o,r=this.y0);var s=_b(2*Math.abs(i/Math.PI));(Math.abs(o)<=fx||Math.abs(Math.abs(i)-dx)<=fx)&&(t=this.x0,r=i>=0?this.y0+Math.PI*this.R*Math.tan(.5*s):this.y0+Math.PI*this.R*-Math.tan(.5*s));var a=.5*Math.abs(Math.PI/o-o/Math.PI),u=a*a,c=Math.sin(s),l=Math.cos(s),h=l/(c+l-1),p=h*h,d=h*(2/c-1),f=d*d,A=Math.PI*this.R*(a*(h-f)+Math.sqrt(u*(h-f)*(h-f)-(f+u)*(p-f)))/(f+u);o<0&&(A=-A),t=this.x0+A;var g=u+h;return A=Math.PI*this.R*(d*g-a*Math.sqrt((f+u)*(u+1)-g*g))/(f+u),r=i>=0?this.y0+A:this.y0-A,e.x=t,e.y=r,e},inverse:function(e){var t,r,n,i,o,s,a,u,c,l,h,p;return e.x-=this.x0,e.y-=this.y0,h=Math.PI*this.R,o=(n=e.x/h)*n+(i=e.y/h)*i,h=3*(i*i/(u=-2*(s=-Math.abs(i)*(1+o))+1+2*i*i+o*o)+(2*(a=s-2*i*i+n*n)*a*a/u/u/u-9*s*a/u/u)/27)/(c=(s-a*a/3/u)/u)/(l=2*Math.sqrt(-c/3)),Math.abs(h)>1&&(h=h>=0?1:-1),p=Math.acos(h)/3,r=e.y>=0?(-l*Math.cos(p+Math.PI/3)-a/3/u)*Math.PI:-(-l*Math.cos(p+Math.PI/3)-a/3/u)*Math.PI,t=Math.abs(n)<fx?this.long0:zx(this.long0+Math.PI*(o-1+Math.sqrt(1+2*(n*n-i*i)+o*o))/2/n),e.x=t,e.y=r,e},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};var wb={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g,_,m,y,E,x,C,b=e.x,I=e.y,T=Math.sin(e.y),v=Math.cos(e.y),R=zx(b-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=fx?(e.x=this.x0+this.a*(dx-I)*Math.sin(R),e.y=this.y0-this.a*(dx-I)*Math.cos(R),e):Math.abs(this.sin_p12+1)<=fx?(e.x=this.x0+this.a*(dx+I)*Math.sin(R),e.y=this.y0+this.a*(dx+I)*Math.cos(R),e):(m=this.sin_p12*T+this.cos_p12*v*Math.cos(R),_=(g=Math.acos(m))/Math.sin(g),e.x=this.x0+this.a*_*v*Math.sin(R),e.y=this.y0+this.a*_*(this.cos_p12*T-this.sin_p12*v*Math.cos(R)),e):(t=tb(this.es),r=rb(this.es),n=nb(this.es),i=ib(this.es),Math.abs(this.sin_p12-1)<=fx?(o=this.a*eb(t,r,n,i,dx),s=this.a*eb(t,r,n,i,I),e.x=this.x0+(o-s)*Math.sin(R),e.y=this.y0-(o-s)*Math.cos(R),e):Math.abs(this.sin_p12+1)<=fx?(o=this.a*eb(t,r,n,i,dx),s=this.a*eb(t,r,n,i,I),e.x=this.x0+(o+s)*Math.sin(R),e.y=this.y0+(o+s)*Math.cos(R),e):(a=T/v,u=ob(this.a,this.e,this.sin_p12),c=ob(this.a,this.e,T),l=Math.atan((1-this.es)*a+this.es*u*this.sin_p12/(c*v)),y=0===(h=Math.atan2(Math.sin(R),this.cos_p12*Math.tan(l)-this.sin_p12*Math.cos(R)))?Math.asin(this.cos_p12*Math.sin(l)-this.sin_p12*Math.cos(l)):Math.abs(Math.abs(h)-Math.PI)<=fx?-Math.asin(this.cos_p12*Math.sin(l)-this.sin_p12*Math.cos(l)):Math.asin(Math.sin(R)*Math.cos(l)/Math.sin(h)),p=this.e*this.sin_p12/Math.sqrt(1-this.es),g=u*y*(1-(E=y*y)*(A=(d=this.e*this.cos_p12*Math.cos(h)/Math.sqrt(1-this.es))*d)*(1-A)/6+(x=E*y)/8*(f=p*d)*(1-2*A)+(C=x*y)/120*(A*(4-7*A)-3*p*p*(1-7*A))-C*y/48*f),e.x=this.x0+g*Math.sin(h),e.y=this.y0+g*Math.cos(h),e))},inverse:function(e){var t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g,_,m,y,E,x,C;if(e.x-=this.x0,e.y-=this.y0,this.sphere){if((t=Math.sqrt(e.x*e.x+e.y*e.y))>2*dx*this.a)return;return r=t/this.a,n=Math.sin(r),i=Math.cos(r),o=this.long0,Math.abs(t)<=fx?s=this.lat0:(s=_b(i*this.sin_p12+e.y*n*this.cos_p12/t),a=Math.abs(this.lat0)-dx,o=Math.abs(a)<=fx?this.lat0>=0?zx(this.long0+Math.atan2(e.x,-e.y)):zx(this.long0-Math.atan2(-e.x,e.y)):zx(this.long0+Math.atan2(e.x*n,t*this.cos_p12*i-e.y*this.sin_p12*n))),e.x=o,e.y=s,e}return u=tb(this.es),c=rb(this.es),l=nb(this.es),h=ib(this.es),Math.abs(this.sin_p12-1)<=fx?(p=this.a*eb(u,c,l,h,dx),t=Math.sqrt(e.x*e.x+e.y*e.y),s=ab((p-t)/this.a,u,c,l,h),o=zx(this.long0+Math.atan2(e.x,-1*e.y)),e.x=o,e.y=s,e):Math.abs(this.sin_p12+1)<=fx?(p=this.a*eb(u,c,l,h,dx),t=Math.sqrt(e.x*e.x+e.y*e.y),s=ab((t-p)/this.a,u,c,l,h),o=zx(this.long0+Math.atan2(e.x,e.y)),e.x=o,e.y=s,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),A=Math.atan2(e.x,e.y),d=ob(this.a,this.e,this.sin_p12),g=Math.cos(A),m=-(_=this.e*this.cos_p12*g)*_/(1-this.es),y=3*this.es*(1-m)*this.sin_p12*this.cos_p12*g/(1-this.es),C=1-m*(x=(E=t/d)-m*(1+m)*Math.pow(E,3)/6-y*(1+3*m)*Math.pow(E,4)/24)*x/2-E*x*x*x/6,f=Math.asin(this.sin_p12*Math.cos(x)+this.cos_p12*Math.sin(x)*g),o=zx(this.long0+Math.asin(Math.sin(A)*Math.sin(x)/Math.cos(f))),s=Math.atan((1-this.es*C*this.sin_p12/Math.sin(f))*Math.tan(f)/(1-this.es)),e.x=o,e.y=s,e)},names:["Azimuthal_Equidistant","aeqd"]};var Sb={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,r,n,i,o,s,a,u=e.x,c=e.y;return n=zx(u-this.long0),t=Math.sin(c),r=Math.cos(c),i=Math.cos(n),((o=this.sin_p14*t+this.cos_p14*r*i)>0||Math.abs(o)<=fx)&&(s=1*this.a*r*Math.sin(n),a=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*r*i)),e.x=s,e.y=a,e},inverse:function(e){var t,r,n,i,o,s,a;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),r=_b(t/this.a),n=Math.sin(r),i=Math.cos(r),s=this.long0,Math.abs(t)<=fx?(a=this.lat0,e.x=s,e.y=a,e):(a=_b(i*this.sin_p14+e.y*n*this.cos_p14/t),o=Math.abs(this.lat0)-dx,Math.abs(o)<=fx?(s=this.lat0>=0?zx(this.long0+Math.atan2(e.x,-e.y)):zx(this.long0-Math.atan2(-e.x,e.y)),e.x=s,e.y=a,e):(s=zx(this.long0+Math.atan2(e.x*n,t*this.cos_p14*i-e.y*this.sin_p14*n)),e.x=s,e.y=a,e))},names:["ortho"]},Bb=1,Ob=2,Db=3,Fb=4,Pb=5,Nb=6,Lb=1,Ub=2,Gb=3,Qb=4;function kb(e,t,r,n){var i;return e<fx?(n.value=Lb,i=0):(i=Math.atan2(t,r),Math.abs(i)<=_x?n.value=Lb:i>_x&&i<=dx+_x?(n.value=Ub,i-=dx):i>dx+_x||i<=-(dx+_x)?(n.value=Gb,i=i>=0?i-yx:i+yx):(n.value=Qb,i+=dx)),i}function zb(e,t){var r=e+t;return r<-yx?r+=mx:r>+yx&&(r-=mx),r}var jb={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=dx-_x/2?this.face=Pb:this.lat0<=-(dx-_x/2)?this.face=Nb:Math.abs(this.long0)<=_x?this.face=Bb:Math.abs(this.long0)<=dx+_x?this.face=this.long0>0?Ob:Fb:this.face=Db,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(e){var t,r,n,i,o,s,a={x:0,y:0},u={value:0};if(e.x-=this.long0,t=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(e.y)):e.y,r=e.x,this.face===Pb)i=dx-t,r>=_x&&r<=dx+_x?(u.value=Lb,n=r-dx):r>dx+_x||r<=-(dx+_x)?(u.value=Ub,n=r>0?r-yx:r+yx):r>-(dx+_x)&&r<=-_x?(u.value=Gb,n=r+dx):(u.value=Qb,n=r);else if(this.face===Nb)i=dx+t,r>=_x&&r<=dx+_x?(u.value=Lb,n=-r+dx):r<_x&&r>=-_x?(u.value=Ub,n=-r):r<-_x&&r>=-(dx+_x)?(u.value=Gb,n=-r-dx):(u.value=Qb,n=r>0?-r+yx:-r-yx);else{var c,l,h,p,d,f;this.face===Ob?r=zb(r,+dx):this.face===Db?r=zb(r,+yx):this.face===Fb&&(r=zb(r,-dx)),p=Math.sin(t),d=Math.cos(t),f=Math.sin(r),c=d*Math.cos(r),l=d*f,h=p,this.face===Bb?n=kb(i=Math.acos(c),h,l,u):this.face===Ob?n=kb(i=Math.acos(l),h,-c,u):this.face===Db?n=kb(i=Math.acos(-c),h,-l,u):this.face===Fb?n=kb(i=Math.acos(-l),h,c,u):(i=n=0,u.value=Lb)}return s=Math.atan(12/yx*(n+Math.acos(Math.sin(n)*Math.cos(_x))-dx)),o=Math.sqrt((1-Math.cos(i))/(Math.cos(s)*Math.cos(s))/(1-Math.cos(Math.atan(1/Math.cos(n))))),u.value===Ub?s+=dx:u.value===Gb?s+=yx:u.value===Qb&&(s+=1.5*yx),a.x=o*Math.cos(s),a.y=o*Math.sin(s),a.x=a.x*this.a+this.x0,a.y=a.y*this.a+this.y0,e.x=a.x,e.y=a.y,e},inverse:function(e){var t,r,n,i,o,s,a,u,c,l,h,p,d={lam:0,phi:0},f={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,r=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),t=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?f.value=Lb:e.y>=0&&e.y>=Math.abs(e.x)?(f.value=Ub,t-=dx):e.x<0&&-e.x>=Math.abs(e.y)?(f.value=Gb,t=t<0?t+yx:t-yx):(f.value=Qb,t+=dx),c=yx/12*Math.tan(t),o=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),s=Math.atan(o),(a=1-(n=Math.cos(t))*n*(i=Math.tan(r))*i*(1-Math.cos(Math.atan(1/Math.cos(s)))))<-1?a=-1:a>1&&(a=1),this.face===Pb)u=Math.acos(a),d.phi=dx-u,f.value===Lb?d.lam=s+dx:f.value===Ub?d.lam=s<0?s+yx:s-yx:f.value===Gb?d.lam=s-dx:d.lam=s;else if(this.face===Nb)u=Math.acos(a),d.phi=u-dx,f.value===Lb?d.lam=-s+dx:f.value===Ub?d.lam=-s:f.value===Gb?d.lam=-s-dx:d.lam=s<0?-s-yx:-s+yx;else{var A,g,_;c=(A=a)*A,g=(c+=(_=c>=1?0:Math.sqrt(1-c)*Math.sin(s))*_)>=1?0:Math.sqrt(1-c),f.value===Ub?(c=g,g=-_,_=c):f.value===Gb?(g=-g,_=-_):f.value===Qb&&(c=g,g=_,_=-c),this.face===Ob?(c=A,A=-g,g=c):this.face===Db?(A=-A,g=-g):this.face===Fb&&(c=A,A=g,g=-c),d.phi=Math.acos(-_)-dx,d.lam=Math.atan2(g,A),this.face===Ob?d.lam=zb(d.lam,-dx):this.face===Db?d.lam=zb(d.lam,-yx):this.face===Fb&&(d.lam=zb(d.lam,+dx))}return 0!==this.es&&(l=d.phi<0?1:0,h=Math.tan(d.phi),p=this.b/Math.sqrt(h*h+this.one_minus_f_squared),d.phi=Math.atan(Math.sqrt(this.a*this.a-p*p)/(this.one_minus_f*p)),l&&(d.phi=-d.phi)),d.lam+=this.long0,e.x=d.lam,e.y=d.phi,e},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},Hb=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],qb=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Vb=.8487,Yb=1.3523,Xb=gx/5,Wb=1/Xb,Kb=18,Jb=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))};var Zb={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(e){var t=zx(e.x-this.long0),r=Math.abs(e.y),n=Math.floor(r*Xb);n<0?n=0:n>=Kb&&(n=17);var i={x:Jb(Hb[n],r=gx*(r-Wb*n))*t,y:Jb(qb[n],r)};return e.y<0&&(i.y=-i.y),i.x=i.x*this.a*Vb+this.x0,i.y=i.y*this.a*Yb+this.y0,i},inverse:function(e){var t={x:(e.x-this.x0)/(this.a*Vb),y:Math.abs(e.y-this.y0)/(this.a*Yb)};if(t.y>=1)t.x/=Hb[18][0],t.y=e.y<0?-dx:dx;else{var r=Math.floor(t.y*Kb);for(r<0?r=0:r>=Kb&&(r=17);;)if(qb[r][0]>t.y)--r;else{if(!(qb[r+1][0]<=t.y))break;++r}var n=qb[r],i=5*(t.y-n[0])/(qb[r+1][0]-n[0]);i=function(e,t,r,n){for(var i=t;n;--n){var o=e(i);if(i-=o,Math.abs(o)<r)break}return i}((function(e){return(Jb(n,e)-t.y)/function(e,t){return e[1]+t*(2*e[2]+3*t*e[3])}(n,e)}),i,fx,100),t.x/=Jb(Hb[r],i),t.y=(5*r+i)*Ax,e.y<0&&(t.y=-t.y)}return t.x=zx(t.x+this.long0),t},names:["Robinson","robin"]};var $b,eI={init:function(){this.name="geocent"},forward:function(e){return rC(e,this.es,this.a)},inverse:function(e){return nC(e,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};dC.defaultDatum="WGS84",dC.Proj=tC,dC.WGS84=new dC.Proj("WGS84"),dC.Point=BC,dC.toPoint=aC,dC.defs=Px,dC.transform=cC,dC.mgrs=xC,dC.version="2.6.1",($b=dC).Proj.projections.add(UC),$b.Proj.projections.add(HC),$b.Proj.projections.add(qC),$b.Proj.projections.add(XC),$b.Proj.projections.add(WC),$b.Proj.projections.add(KC),$b.Proj.projections.add(JC),$b.Proj.projections.add(ZC),$b.Proj.projections.add($C),$b.Proj.projections.add(ub),$b.Proj.projections.add(gb),$b.Proj.projections.add(mb),$b.Proj.projections.add(yb),$b.Proj.projections.add(Eb),$b.Proj.projections.add(xb),$b.Proj.projections.add(Cb),$b.Proj.projections.add(bb),$b.Proj.projections.add(Ib),$b.Proj.projections.add(Tb),$b.Proj.projections.add(vb),$b.Proj.projections.add(Rb),$b.Proj.projections.add(Mb),$b.Proj.projections.add(wb),$b.Proj.projections.add(Sb),$b.Proj.projections.add(jb),$b.Proj.projections.add(Zb),$b.Proj.projections.add(eI);const tI={"EPSG:4490":'GEOGCS["China Geodetic Coordinate System 2000",DATUM["China_2000",SPHEROID["CGCS2000",6378137,298.257222101,AUTHORITY["EPSG","1024"]],AUTHORITY["EPSG","1043"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4490"]]',"EPSG:4214":'GEOGCS["Beijing 1954",DATUM["Beijing_1954",SPHEROID["Krassowsky 1940",6378245,298.3],TOWGS84[15.8,-154.4,-82.3,0,0,0,0]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4214"]]',"EPSG:4610":'GEOGCS["Xian 1980",DATUM["Xian_1980",SPHEROID["IAG 1975",6378140,298.257,AUTHORITY["EPSG","7049"]],AUTHORITY["EPSG","6610"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4610"]]'};class rI{constructor(e,t,r){this.epsgCode=e,this.extent=r,this.sceneMode=Ta.SCENE3D,Array.isArray(t)&&(this.extent=t),this.getExtent(),this.WKT=t,this.WKT&&!Array.isArray(this.WKT)||(this.WKT=tI[e]),this.WKT&&dC.defs(e,this.WKT);var n=dC.defs(e);if(!n)throw new Error(e+" was not defined,make sure the WKT param was not null");this.unit=n.units||"degree",this.proj4Projection=dC(e),this._id=cl++}getExtent(){if(!this._rectifyExtent){var e=this.extent[2]-this.extent[0],t=this.extent[3]-this.extent[1];if(e===t)this._rectifyExtent=[this.extent[0],this.extent[1],this.extent[2],this.extent[3]];else{var r=Math.max(e,t);this._rectifyExtent=[this.extent[0],this.extent[3]-r,this.extent[0]+r,this.extent[3]]}}return this._rectifyExtent}getLngLatCenter(){return this._rectifyLngLatExtent||this.getLngLatExtent(),[this._rectifyLngLatExtent[2]+(this._rectifyLngLatExtent[2]-this._rectifyLngLatExtent[0])/2,this._rectifyLngLatExtent[3]-(this._rectifyLngLatExtent[3]-this._rectifyLngLatExtent[1])/2]}getLngLatExtent(){if(!this._rectifyLngLatExtent){var e=this.proj4Projection.inverse([this.extent[0],this.extent[1]]),t=this.proj4Projection.inverse([this.extent[2],this.extent[3]]),r=t[0]-e[0],n=t[1]-e[1];if(r===n)this._rectifyLngLatExtent=[e[0],e[1],t[0],t[0]];else{var i=Math.max(r,n);this._rectifyLngLatExtent=[e[0],t[1]-i,e[0]+i,t[1]]}}return this._rectifyLngLatExtent}getOrigin(){return[this.extent[0],this.extent[3]]}getEpsgCode(){return this.epsgCode}getUnit(){return this.unit}getWKT(){return this.WKT}getWidth(){return this._rectifyExtent[2]-this._rectifyExtent[0]}getHeight(){return this._rectifyExtent[3]-this._rectifyExtent[1]}getOriginX(){return this._rectifyExtent[0]}getOriginY(){return this._rectifyExtent[3]}toWGS84(e){return this.proj4Projection.inverse(e)}fromWGS84(e){return this.proj4Projection.forward(e)}fromLngLat(e,t){var r=m_.convert(e),n=this.proj4Projection.forward([r.lng,r.lat]);return{x:(n[0]-this.getOriginX())/this.getWidth(),y:(this.getOriginY()-n[1])/this.getHeight(),z:t||0}}toLngLat(e,t){var r=this.proj4Projection.inverse([e*this.getWidth()+this.getOriginX(),this.getOriginY()-t*this.getHeight()]);return new m_(r[0],r[1])}isProj(){return!("degree"==this.unit||"degrees"==this.unit||"d"==this.unit)}static get(e){for(var t in rI)if(rI.hasOwnProperty(t)&&rI[t].getEpsgCode&&rI[t].getEpsgCode()===e)return rI[t];return null}static set(e){var t=e.getEpsgCode().replace(":","").toUpperCase();rI[t]=e}static fromEpsgCode(e,t,r){"number"==typeof e&&(e="EPSG:"+e);let n=rI[e.replace(":","")];if(void 0===n){if(void 0===t||void 0===r)throw new Error(`Invalid epsgCode: ${e}`);return new rI(e,t,r)}return n}}let nI;function iI(e){let t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",r="";const n=nI.crypto||nI.webkitCrypto||nI.mozCrypto||nI.oCrypto||nI.msCrypto;for(let i=e;i>0;--i)r+=t[Math.floor(n.getRandomValues(new Uint32Array(1))[0]%.9999*62)];return r}rI.EPSG4326=new rI("EPSG:4326",[-180,-90,180,90]),rI.EPSG4490=new rI("EPSG:4490",[-180,-90,180,90]),rI.EPSG4214=new rI("EPSG:4214",[-180,-90,180,90]),rI.EPSG4610=new rI("EPSG:4610",[-180,-90,180,90]),rI.EPSG3857=new rI("EPSG:3857",[-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892]),nI=gl()?self:window,iI(16),iI(12);class oI{constructor(e,t,r,n){this.z=e,this.x=t,this.y=r,this.key=uI(0,e,e,t,r),n&&(this.indexExtent=n,this.worldWidth=n[2]-n[0],this.worldHeight=n[3]-n[1])}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}getTileBBox(){var e=Math.pow(2,this.z);return this.indexExtent,this.indexExtent[0]+this.worldWidth*this.x/e+","+(this.indexExtent[3]-this.worldHeight*(this.y+1)/e)+","+(this.indexExtent[0]+this.worldWidth*(this.x+1)/e)+","+(this.indexExtent[3]-this.worldHeight*this.y/e)}url(e,t,r,n){const i=this.getTileBBox(),o=function(e,t,r){let n,i="";for(let o=e;o>0;o--)n=1<<o-1,i+=(t&n?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y),s=this.x,a=this.y,u=this.z;var c=function(e,t,r){return(e+t)%r}(this.x,this.y,e.length);let l=e[c].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(u)).replace(/{x}/g,String(s)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:a)).replace("{quadkey}",o).replace("{bbox-epsg-3857}",i).replace("{bbox}",i).replace("{width}",r).replace("{height}",r);if(this.getViewBounds){var h=this.getViewBounds();h&&(l=l.replace("{viewBounds}",h))}return n&&(l=l.replace("{scale}",n)),l}getViewBounds(){var e=Math.pow(2,this.z);let t=this.indexExtent[0]+this.worldWidth*this.x/e,r=this.indexExtent[0]+this.worldWidth*(this.x+1)/e;return`{"leftBottom":{"x":${t},"y":${this.indexExtent[3]-this.worldHeight*(this.y+1/e)}},"rightTop":{"x":${r},"y":${this.indexExtent[3]-this.worldHeight*(this.y/e)}}}`}toString(){return`${this.z}/${this.x}/${this.y}`}}class sI{constructor(e,t){this.wrap=e,this.canonical=t,this.key=uI(e,t.z,t.z,t.x,t.y)}}class aI{constructor(e,t,r,n,i,o){this.overscaledZ=e,this.wrap=t,this.canonical=new oI(r,+n,+i,o),this.key=0===t&&e===r?this.canonical.key:uI(t,e,r,n,i),this.indexExtent=o}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new aI(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y,this.indexExtent):new aI(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t,this.indexExtent)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return uI(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return uI(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new aI(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y,this.indexExtent)];const t=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new aI(t,this.wrap,t,r,n,this.indexExtent),new aI(t,this.wrap,t,r+1,n,this.indexExtent),new aI(t,this.wrap,t,r,n+1,this.indexExtent),new aI(t,this.wrap,t,r+1,n+1,this.indexExtent)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new aI(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y,this.indexExtent)}unwrapTo(e){return new aI(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y,this.indexExtent)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sI(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function uI(e,t,r,n,i){const o=1<<Math.min(r,22);let s=o*(i%o)+n%o;if(e&&r<22){s+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))}return 16*(32*s+r)+(t-r)}function cI(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const r=Math.pow(2,-e.z),n=e.x*r,i=(e.x+1)*r,o=e.y*r,s=(e.y+1)*r,a=E_(n),u=E_(i),c=x_(o),l=x_(s),h=t.project(a,c),p=t.project(u,c),d=t.project(u,l),f=t.project(a,l);let A=Math.min(h.x,p.x,d.x,f.x),g=Math.min(h.y,p.y,d.y,f.y),_=Math.max(h.x,p.x,d.x,f.x),m=Math.max(h.y,p.y,d.y,f.y);const y=r/16;function E(e,r,n,i,o,s){const a=(n+o)/2,u=(i+s)/2,c=t.project(E_(a),x_(u)),l=Math.max(0,A-c.x,g-c.y,c.x-_,c.y-m);A=Math.min(A,c.x),_=Math.max(_,c.x),g=Math.min(g,c.y),m=Math.max(m,c.y),l>y&&(E(e,c,n,i,a,u),E(c,r,a,u,o,s))}E(h,p,n,o,i,o),E(p,d,i,o,i,s),E(d,f,i,s,n,s),E(f,h,n,s,n,o),A-=y,g-=y,_+=y,m+=y;const x=1/Math.max(_-A,m-g);return{scale:x,x:A*x,y:g*x,x2:_*x,y2:m*x,projection:t}}Ml(oI,"CanonicalTileID"),Ml(aI,"OverscaledTileID",{omit:["projMatrix"]});const lI=Sf.mat4.identity(new Float32Array(16));class hI{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new m_(0,0)}projectTilePoint(e,t,r){return{x:e,y:t,z:0}}locationPoint(e,t,r=!0){return e._coordinatePoint(e.locationCoordinate(t),r)}pixelsPerMeter(e,t){return y_(1,e)*t}pixelSpaceConversion(e,t,r){return 1}farthestPixelDistance(e){return function(e){const t=e.fovAboveCenter,r=(e._camera.position[2]*e.worldSize-0)/Math.cos(e._pitch),n=Math.sin(t)*r/Math.sin(Math.max(Math.PI/2-e._pitch-t,.01)),i=Math.sin(e._pitch)*n+r,o=r*(1/e._horizonShift);return Math.min(1.01*i,o)}(e,e.pixelsPerMeter)}pointCoordinate(e,t,r,n){const i=e.horizonLineFromTop(!1),o=new zt(t,Math.max(i,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(o,n))}pointCoordinate3D(e,t,r){const n=new zt(t,r),i=this.pointCoordinate(e,n.x,n.y,0);return[i.x,i.y,i.z]}isPointAboveHorizon(e,t){const r=e.horizonLineFromTop();return t.y<r}createInversionMatrix(e,t){return lI}createTileMatrix(e,t,r){let n,i,o;const s=r.canonical,a=Sf.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const u=cI(s,this);n=1,i=u.x+r.wrap*u.scale,o=u.y,Sf.mat4.scale(a,a,[n/u.scale,n/u.scale,e.pixelsPerMeter/t])}else{n=t/e.zoomScale(s.z);i=(s.x+Math.pow(2,s.z)*r.wrap)*n,o=s.y*n}return Sf.mat4.translate(a,a,[i,o,0]),Sf.mat4.scale(a,a,[n/va,n/va,1]),a}upVector(e,t,r){return[0,0,1]}upVectorScale(e,t,r){return{metersToTile:1}}}class pI extends hI{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,r]=this.parallels=e.parallels||[29.5,45.5],n=Math.sin(nl(t));this.n=(n+Math.sin(nl(r)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:r,c:n,r0:i}=this,o=nl(e-this.center[0]),s=nl(t),a=Math.sqrt(n-2*r*Math.sin(s))/r;return{x:a*Math.sin(o*r),y:a*Math.cos(o*r)-i,z:0}}unproject(e,t){const{n:r,c:n,r0:i}=this,o=i+t;let s=Math.atan2(e,Math.abs(o))*Math.sign(o);o*r<0&&(s-=Math.PI*Math.sign(e)*Math.sign(o));const a=nl(this.center[0])*r;s=sl(s,-Math.PI-a,Math.PI-a);const u=ol(il(s/r)+this.center[0],-180,180),c=Math.asin(ol((n-(e*e+o*o)*r*r)/(2*r),-1,1)),l=ol(il(c),-85.051129,C_);return new m_(u,l)}}const dI=1.340264,fI=-.081106,AI=893e-6,gI=.003796,_I=Math.sqrt(3)/2;class mI extends hI{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(_I*Math.sin(t)),n=r*r,i=n*n*n,o=e*Math.cos(r)/(_I*(dI+3*fI*n+i*(7*AI+9*gI*n))),s=r*(dI+fI*n+i*(AI+gI*n));return{x:.5*(o/Math.PI+.5),y:1-.5*(s/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,n=r*r,i=n*n*n;for(let e,o,s,a=0;a<12&&(o=r*(dI+fI*n+i*(AI+gI*n))-t,s=dI+3*fI*n+i*(7*AI+9*gI*n),e=o/s,r=ol(r-e,-Math.PI/3,Math.PI/3),n=r*r,i=n*n*n,!(Math.abs(e)<1e-12));++a);const o=_I*e*(dI+3*fI*n+i*(7*AI+9*gI*n))/Math.cos(r),s=Math.asin(Math.sin(r)/_I),a=ol(180*o/Math.PI,-180,180),u=ol(180*s/Math.PI,-85.051129,C_);return new m_(a,u)}}class yI extends hI{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const r=360*(e-.5),n=ol(360*(.5-t),-85.051129,C_);return new m_(r,n)}}const EI=Math.PI/2;function xI(e){return Math.tan((EI+e)/2)}class CI extends hI{constructor(e){super(e),this.center=e.center||[0,30];const[t,r]=this.parallels=e.parallels||[30,30];let n=nl(t),i=nl(r);this.southernCenter=n+i<0,this.southernCenter&&(n=-n,i=-i);const o=Math.cos(n),s=xI(n);this.n=n===i?Math.sin(n):Math.log(o/Math.cos(i))/Math.log(xI(i)/s),this.f=o*Math.pow(xI(n),this.n)/this.n}project(e,t){t=nl(t),this.southernCenter&&(t=-t),e=nl(e-this.center[0]);const r=1e-6,{n:n,f:i}=this;i>0?t<-EI+r&&(t=-EI+r):t>EI-r&&(t=EI-r);const o=i/Math.pow(xI(t),n);let s=o*Math.sin(n*e),a=i-o*Math.cos(n*e);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:r,f:n}=this,i=n-t,o=Math.sign(i),s=Math.sign(r)*Math.sqrt(e*e+i*i);let a=Math.atan2(e,Math.abs(i))*o;i*r<0&&(a-=Math.PI*Math.sign(e)*o);const u=ol(il(a/r)+this.center[0],-180,180),c=ol(il(2*Math.atan(Math.pow(n/s,1/r))-EI),-85.051129,C_);return new m_(u,this.southernCenter?-c:c)}}class bI extends hI{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){const r=function(e){return(180+e)/360}(e),n=function(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}(t);return{x:r,y:n,z:0}}unproject(e,t){const r=E_(e),n=x_(t);return new m_(r,n)}}const II=nl(C_);class TI extends hI{project(e,t){const r=(t=nl(t))*t,n=r*r,i=t*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)));return{x:.5*((e=nl(e))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(i/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,n=25,i=0,o=r*r;do{o=r*r;const e=o*o;i=(r*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),r=ol(r-i,-II,II)}while(Math.abs(i)>1e-6&&--n>0);o=r*r;const s=ol(il(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=il(r);return new m_(s,a)}}const vI=nl(C_);class RI extends hI{project(e,t){t=nl(t),e=nl(e);const r=Math.cos(t),n=2/Math.PI,i=Math.acos(r*Math.cos(e/2)),o=Math.sin(i)/i,s=.5*(e*n+2*r*Math.sin(e/2)/o)||0,a=.5*(t+Math.sin(t)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(e,t){let r=e=(2*e-.5)*Math.PI,n=t=(2*(1-t)-1)*Math.PI,i=25;const o=1e-6;let s=0,a=0;do{const i=Math.cos(n),o=Math.sin(n),u=2*o*i,c=o*o,l=i*i,h=Math.cos(r/2),p=Math.sin(r/2),d=2*h*p,f=p*p,A=1-l*h*h,g=A?1/A:0,_=A?Math.acos(i*h)*Math.sqrt(1/A):0,m=.5*(2*_*i*p+2*r/Math.PI)-e,y=.5*(_*o+n)-t,E=.5*g*(l*f+_*i*h*c)+1/Math.PI,x=g*(d*u/4-_*o*p),C=.125*g*(u*p-_*o*l*d),b=.5*g*(c*h+_*f*i)+.5,I=x*C-b*E;s=(y*x-m*b)/I,a=(m*C-y*E)/I,r=ol(r-s,-Math.PI,Math.PI),n=ol(n-a,-vI,vI)}while((Math.abs(s)>o||Math.abs(a)>o)&&--i>0);return new m_(il(r),il(n))}}class MI extends hI{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(nl(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:r,cosPhi:n}=this;return{x:nl(e)*n*r+.5,y:-(Math.sin(nl(t))/n)*r+.5,z:0}}unproject(e,t){const{scale:r,cosPhi:n}=this,i=-(t-.5)/r,o=ol(il((e-.5)/r)/n,-180,180),s=i*n,a=Math.asin(ol(s,-1,1)),u=ol(il(a),-85.051129,C_);return new m_(o,u)}}function wI(e){const t=e.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new bI(e);case"equirectangular":return new yI(e);case"naturalEarth":return new TI(e);case"equalEarth":return new mI(e);case"winkelTripel":return new RI(e);case"albers":return r?new MI(e):new pI(e);case"lambertConformalConic":return r?new MI(e):new CI(e)}throw new Error(`Invalid projection name: ${e.name}`)}const SI=(e,t,r,n)=>{let i=t;const o=r>>>1,s=e[i-1];for(;t<=o;){(t=i<<1)<r&&0>n(e[t-1],e[t])&&++t;const o=e[t-1];if(0>=n(o,s))break;e[i-1]=o,i=t}e[i-1]=s},BI=(e,t)=>e<t?-1:e>t?1:0;function OI(){}function DI(e=1){this._seed=e}function FI(){}function PI(e){return e}function NI(e){return e?(kI.seed=e,()=>kI.getFloat()):Math.random}OI.sort=function(e,t,r,n){void 0===t&&(t=0),void 0===r&&(r=e.length),void 0===n&&(n=BI);for(var i=r>>>1;i>t;i--)SI(e,i,r,n);for(i=t+1,--r;r>t;r--){const o=e[t];e[t]=e[r],e[r]=o,SI(e,i,r,n)}},OI.iterableSort=function*(e,t,r,n){void 0===t&&(t=0),void 0===r&&(r=e.length),void 0===n&&(n=BI);for(var i=r>>>1;i>t;i--)SI(e,i,r,n),yield;for(i=t+1,--r;r>t;r--){const o=e[t];e[t]=e[r],e[r]=o,SI(e,i,r,n),yield}},Object.defineProperties(DI.prototype,{seed:{set:function(e){this._seed=null==e?Math.random()*c._m:e}}}),DI.prototype.getInt=function(){return this._seed=(c._a*this._seed+c._c)%c._m},DI.prototype.getFloat=function(){return this.getInt()/(c._m-1)},DI.prototype.getIntRange=function(e,t){return Math.round(this.getFloatRange(e,t))},DI.prototype.getFloatRange=function(e,t){t-=e;return e+this.getInt()/c._m*t},DI._m=2147483647,DI._a=48271,DI._c=0;const LI=!!Array.prototype.fill;function UI(){this.last=0}const GI=new UI,QI=new Set,kI=new DI;function zI(e){e.data.length>1.5*e.length&&(e.data.length=Math.floor(1.1*e.length))}function jI(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new UI,e&&(e.initialSize&&(this.data=Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),void 0!==e.deallocator&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>zI(this)))}function HI(e,t=30){this.name=e,this._counter=0,this._samples=Array(t)}function qI(){}function VI(){}function YI(){this._groups=new Map}function XI(){}function WI(e){return{remove:()=>{e&&(e(),e=void 0)}}}function KI(e,t,r,n=1,i=0){if(this._ctor=e,this._acquireFunction=t,this._releaseFunction=r,this.allocationSize=n,this._pool=Array(i),this._initialSize=i,this._ctor)for(e=0;e<i;e++)this._pool[e]=new this._ctor;this.allocationSize=Math.max(n,1)}function JI(e){e.length=0}function ZI(e=50,t=50){this._pool=new KI(Array,void 0,JI,t,e)}FI.EmptyArray=[],FI.ReallocGrowthFactor=1.5,FI.ReallocShrinkFactor=1/1.5,FI.ReallocShrinkTreshold=.5,FI.binaryFindClosest=function(e,t,r){if(e&&0!==e.length){var n=e.length-1,i=e[0];if(t<=r(i))return i;if(t>=r(i=e[n]))return i;var o=0;i=0;for(var s=n;o<s;){const u=e[i=o+Math.floor((s-o)/2)],c=r(u);if(c===t)return u;if(t<c){if(0<i){var a=r(s=e[i-1]);if(t>a)return t-a>=c-t?u:s}s=i}else{if(i<n&&t<(a=r(o=e[i+1])))return t-c>=a-t?o:u;o=i+1}}return e[i]}},FI.binaryIndexOf=function(e,t,r){const n=e.length;let i=0;for(var o=n-1;i<o;){const r=i+Math.floor((o-i)/2);t>e[r]?i=r+1:o=r}return o=e[i],r?t>=e[n-1]?-1:o===t?i:i-1:o===t?i:-1},FI.constant=function(e,t){if(LI)return Array(e).fill(t);const r=Array(e);for(let n=0;n<e;n++)r[n]=t;return r},FI.difference=function(e,t,r){let n,i;return r?(n=t.filter((t=>!e.some((e=>r(e,t))))),i=e.filter((e=>!t.some((t=>r(t,e)))))):(n=t.filter((t=>!e.includes(t))),i=e.filter((e=>!t.includes(e)))),{added:n,removed:i}},FI.equals=function(e,t,r){if(null==e&&null==t)return!0;if(null==e||null==t||e.length!==t.length)return!1;if(r){for(let n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},FI.filterInPlace=function(e,t){let r=0;for(let n=0;n<e.length;++n){const i=e[n];t(i,n)&&(e[r]=i,r++)}e.length=r},FI.first=function(e){if(e)return 0<e.length?e[0]:void 0},FI.groupToMap=function(e,t){const r=new Map,n=e.length;for(let i=0;i<n;i++){const n=e[i],o=t(n,i,e),s=r.get(o);s?s.push(n):r.set(o,[n])}return r},FI.intersect=function(e,t,r){return e&&t?r?e.filter((e=>-1<t.findIndex((t=>r(e,t))))):e.filter((e=>t.includes(e))):[]},FI.isArrayLike=function(e){return e&&"number"==typeof e.length},FI.isSome=function(e,t){return null!=e},FI.last=function(e){if(e){var t=e.length;return 0<t?e[t-1]:void 0}},FI.max=function(e,t=PI){if(e&&0!==e.length){var r=e[0],n=t(r);for(let i=1;i<e.length;++i){const o=e[i],s=Number(t(o));s>n&&(n=s,r=o)}return r}},FI.min=function(e,t=PI){return FI.max(e,(e=>-t(e)))},FI.pickRandom=function(e,t,r){const n=e.length;if(t>=n)return e.slice(0);let i=NI(r);const o=new Set,s=[];for(;s.length<t;){const t=Math.floor(i()*n);o.has(t)||(o.add(t),s.push(e[t]))}return s},FI.range=function(e,t){void 0===t&&(t=e,e=0);const r=Array(t-e);for(let n=e;n<t;n++)r[n-e]=n;return r},FI.indexOf=function(e,t,r,n){n=n||GI;var i=Math.max(0,n.last-10);for(let o=i;o<r;++o)if(e[o]===t)return n.last=o;for(r=Math.min(i,r),i=0;i<r;++i)if(e[i]===t)return n.last=i;return-1},FI.remove=function(e,t){const r=e.indexOf(t);return-1!==r?(e.splice(r,1),t):null},FI.removeUnordered=function(e,t,r,n){const i=null==r?e.length:r;let o=FI.indexOf(e,t,i,n);if(-1!==o)return e[o]=e[i-1],null==r&&e.pop(),t},FI.removeUnorderedMany=function(e,t,r=e.length,n=t.length,i,o){if(0===n||0===r)return r;QI.clear();for(let e=0;e<n;++e)QI.add(t[e]);i=i||GI;let s=Math.max(0,i.last-10);for(var a=s;a<r;++a)if(QI.has(e[a])&&(o&&o.push(e[a]),QI.delete(e[a]),e[a]=e[r-1],--r,--a,0===QI.size||0===r))return QI.clear(),r;for(a=0;a<s;++a)if(QI.has(e[a])&&(o&&o.push(e[a]),QI.delete(e[a]),e[a]=e[r-1],--r,--a,0===QI.size||0===r))return QI.clear(),r;return QI.clear(),r},FI.shuffle=function(e,t){let r=NI(t);for(let t=e.length-1;0<t;t--){const n=Math.floor(r()*(t+1)),i=e[t];e[t]=e[n],e[n]=i}return e},FI.splitIntoChunks=function(e,t){const r=e.length;if(0===r)return[];const n=[];for(let i=0;i<r;i+=t)n.push(e.slice(i,i+t));return n},FI.unique=function(e,t){return t?e.filter(((e,r,n)=>n.findIndex(t.bind(null,e))===r)):e.filter(((e,t,r)=>r.indexOf(e)===t))},FI.update=function(e,t){let r=e.length!==t.length;r&&(e.length=t.length);for(let n=0;n<t.length;++n)e[n]!==t[n]&&(e[n]=t[n],r=!0);return r},jI.prototype.toArray=function(){return this.data.slice(0,this.length)},jI.prototype.filter=function(e){const t=[];for(let r=0;r<this._length;r++){const n=this.data[r];e(n)&&t.push(n)}return t},jI.prototype.at=function(e){if(0>(e=Math.trunc(e)||0)&&(e+=this._length),!(0>e||e>=this._length))return this.data[e]},jI.prototype.includes=function(e,t){return-1!==(e=this.data.indexOf(e,t))&&e<this.length},jI.prototype.clear=function(){this.length=0},jI.prototype.prune=function(){this.clear(),this.data=[]},jI.prototype.push=function(e){this.data[this._length++]=e},jI.prototype.pushArray=function(e,t=e.length){for(let r=0;r<t;r++)this.data[this._length++]=e[r]},jI.prototype.fill=function(e,t){for(let r=0;r<t;r++)this.data[this._length++]=e},jI.prototype.pushNew=function(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e},jI.prototype.unshift=function(e){this.data.unshift(e),this._length++,zI(this)},jI.prototype.pop=function(){if(0!==this.length){var e=this.data[this.length-1];return--this.length,this._shrink(),e}},jI.prototype.remove=function(e){const t=FI.indexOf(this.data,e,this.length,this._hint);if(-1!==t)return this.data.splice(t,1),--this.length,e},jI.prototype.removeUnordered=function(e){return this.removeUnorderedIndex(FI.indexOf(this.data,e,this.length,this._hint))},jI.prototype.removeUnorderedIndex=function(e){if(!(e>=this.length||0>e))return this.swapElements(e,this.length-1),this.pop()},jI.prototype.removeUnorderedMany=function(e,t=e.length,r){this.length=FI.removeUnorderedMany(this.data,e,this.length,t,this._hint,r),this._shrink()},jI.prototype.front=function(){if(0!==this.length)return this.data[0]},jI.prototype.back=function(){if(0!==this.length)return this.data[this.length-1]},jI.prototype.swapElements=function(e,t){if(!(e>=this.length||t>=this.length||e===t)){var r=this.data[e];this.data[e]=this.data[t],this.data[t]=r}},jI.prototype.sort=function(e){OI.sort(this.data,0,this.length,e)},jI.prototype.iterableSort=function(e){return OI.iterableSort(this.data,0,this.length,e)},jI.prototype.some=function(e,t){for(let r=0;r<this.length;++r)if(e.call(t,this.data[r],r,this.data))return!0;return!1},jI.prototype.find=function(e,t){for(let r=0;r<this.length;++r){const n=this.data[r];if(e.call(t,n,r))return n}},jI.prototype.filterInPlace=function(e,t){let r=0;for(let n=0;n<this._length;++n){const i=this.data[n];e.call(t,i,n,this.data)&&(this.data[n]=this.data[r],this.data[r]=i,r++)}if(this._deallocator)for(e=r;e<this._length;e++)this.data[e]=this._deallocator(this.data[e]);return this._length=r,this._shrink(),this},jI.prototype.forAll=function(e,t){const r=this.length,n=this.data;for(let i=0;i<r;++i)e.call(t,n[i],i,n)},jI.prototype.forEach=function(e,t){for(let r=0;r<this.length;++r)e.call(t,this.data[r],r,this.data)},jI.prototype.map=function(e,t){const r=Array(this.length);for(let n=0;n<this.length;++n)r[n]=e.call(t,this.data[n],n,this.data);return r},jI.prototype.reduce=function(e,t){for(let r=0;r<this.length;++r)t=e(t,this.data[r],r,this.data);return t},jI.prototype.has=function(e){const t=this.length,r=this.data;for(let n=0;n<t;++n)if(r[n]===e)return!0;return!1},Object.defineProperties(jI.prototype,{length:{get:function(){return this._length},set:function(e){if(e>this._length)if(this._allocator)for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);else this._length=e;else{if(this._deallocator)for(let t=e;t<this._length;++t)this.data[t]=this._deallocator(this.data[t]);this._length=e,this._shrink()}}}}),Object.defineProperties(HI.prototype,{median:{get:function(){return this._samples.slice().sort(((e,t)=>e-t))[Math.floor(this._samples.length/2)]}},average:{get:function(){return this._samples.reduce(((e,t)=>e+t),0)/this._samples.length}},last:{get:function(){return this._samples[this._counter%this._samples.length]}}}),HI.prototype.record=function(e){null!=e&&(this._samples[++this._counter%this._samples.length]=e)},qI.cache=function(e){const t=[];return function*(){yield*t;for(const r of e)t.push(r),yield r}},qI.find=function(e,t){for(const r of e)if(null!=r&&t(r))return r},qI.isIterable=function(e){return null!=e&&"function"==typeof e[Symbol.iterator]},VI.abortMaybe=function(e){return e&&e.abort(),null},VI.applySome=function(e,t){return null!=e?t(e):null},VI.assertIsSome=function(e,t){if(null==e)throw Error(t||"value is None")},VI.assumeNonNull=function(e){return e},VI.destroyMaybe=function(e){return e&&e.destroy(),null},VI.disposeMaybe=function(e){return e&&e.dispose(),null},VI.equalsMaybe=function(e,t,r){return null!=e&&null!=t?null!=r?r(e,t):e.equals(t):e===t},VI.forEachSome=function(e,t){for(const r of e)VI.applySome(r,t)},VI.mapMany=function(e,t){const r=[];for(const n of e)r.push(null!=n?t(n):null);return r},VI.nullifyNonNullableForDispose=function(e){return null},VI.releaseMaybe=function(e){return e&&e.release(),null},VI.removeMaybe=function(e){return e&&e.remove(),null},VI.unwrapOrThrow=function(e,t){return VI.assertIsSome(e,t),e},Object.defineProperties(YI.prototype,{size:{get:function(){let e=0;return this._groups.forEach((t=>{e+=t.length})),e}}}),YI.prototype.destroy=function(){this.removeAll()},YI.prototype.add=function(e,t){if(qI.isIterable(e)){t=this._getOrCreateGroup(t);for(const r of e)this._isHandle(r)&&t.push(r)}else this._isHandle(e)&&this._getOrCreateGroup(t).push(e);return this},YI.prototype.forEach=function(e,t){if("function"==typeof e)this._groups.forEach((t=>t.forEach(e)));else{const r=this._getGroup(e);r&&t&&r.forEach(t)}},YI.prototype.has=function(e){return this._groups.has(this._ensureGroupKey(e))},YI.prototype.remove=function(e){if("string"!=typeof e&&qI.isIterable(e)){for(const t of e)this.remove(t);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this},YI.prototype.removeAll=function(){return this._groups.forEach((e=>this._removeAllFromGroup(e))),this._groups.clear(),this},YI.prototype._isHandle=function(e){return e&&(!!e.remove||e instanceof f)},YI.prototype._getOrCreateGroup=function(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t},YI.prototype._getGroup=function(e){return VI.assumeNonNull(this._groups.get(this._ensureGroupKey(e)))},YI.prototype._ensureGroupKey=function(e){return e||"_default_"},YI.prototype._removeAllFromGroup=function(e){for(const t of e)t instanceof f?t.removeAll():t.remove()},XI.abortHandle=function(e){return WI((()=>e&&e.abort()))},XI.asyncHandle=function(e,t){let r=!1,n=null;return e.then((e=>{r?e.remove():n=e})),WI((()=>{r=!0,null!=n?n.remove():null!=t&&(t.abort(),t=null)}))},XI.destroyHandle=function(e){return WI(null!=e?()=>e.destroy():void 0)},XI.handlesGroup=function(e){return WI((()=>e.forEach((e=>null!=e&&e.remove()))))},XI.makeHandle=WI,XI.refHandle=function(e){return WI((()=>{const t=e();null!=t&&t.remove()}))},XI.timeoutHandle=function(e,t){const r=setTimeout(e,t);return WI((()=>clearTimeout(r)))},KI.prototype.destroy=function(){this.prune(0)},KI.prototype.acquire=function(...e){if(KI.test.disabled)var t=new this._ctor;else{if(0===this._pool.length){t=this.allocationSize;for(let e=0;e<t;e++)this._pool[e]=new this._ctor}t=this._pool.pop()}return this._acquireFunction?this._acquireFunction(t,...e):t&&t.acquire&&"function"==typeof t.acquire&&t.acquire(...e),t},KI.prototype.release=function(e){e&&!KI.test.disabled&&(this._releaseFunction?this._releaseFunction(e):e&&e.release&&"function"==typeof e.release&&e.release(),this._pool.push(e))},KI.prototype.prune=function(e=this._initialSize){if(!(e>=this._pool.length)){for(let t=e;t<this._pool.length;++t)this._dispose(this._pool[t]);this._pool.length=e}},KI.prototype._dispose=function(e){e.dispose&&"function"==typeof e.dispose&&e.dispose()},KI.test={disabled:!1},ZI.prototype.acquire=function(){return this._pool.acquire()},ZI.prototype.release=function(e){this._pool.release(e)},ZI.prototype.prune=function(){this._pool.prune(0)},ZI.acquire=function(){return $I.acquire()},ZI.release=function(e){return $I.release(e)},ZI.prune=function(){$I.prune()};const $I=new ZI(100);function eT(){}function tT(e){return"Int8Array"===e&&e.constructor&&e.constructor.name}function rT(e){return"Uint8Array"===e&&e.constructor&&e.constructor.name}function nT(e){return"Uint8ClampedArray"===e&&e.constructor&&e.constructor.name}function iT(e){return"Int16Array"===e&&e.constructor&&e.constructor.name}function oT(e){return"Uint16Array"===e&&e.constructor&&e.constructor.name}function sT(e){return"Int32Array"===e&&e.constructor&&e.constructor.name}function aT(e){return"Uint32Array"===e&&e.constructor&&e.constructor.name}function uT(e){return"Float32Array"===e&&e.constructor&&e.constructor.name}function cT(e){return"Float64Array"===e&&e.constructor&&e.constructor.name}function lT(e){return!("buffer"in e)}function hT(){}function pT(e){return"function"==typeof e.map&&"function"==typeof e.forEach}function dT(e){if(eT.isInt8Array(e)||eT.isUint8Array(e)||eT.isUint8ClampedArray(e)||eT.isInt16Array(e)||eT.isUint16Array(e)||eT.isInt32Array(e)||eT.isUint32Array(e)||eT.isFloat32Array(e)||eT.isFloat64Array(e))return e.slice();if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){var t=new Map;for(const[r,n]of e)t.set(r,hT.clone(n));return t}if(e instanceof Set){t=new Set;for(const r of e)t.add(hT.clone(r));return t}return null}function fT(){KI.call(this,...arguments),this._set=new Set}function AT(){}eT.NATIVE_ARRAY_MAX_SIZE=1024,eT.estimateSize=function(e){return null!=e?lT(e)?8*e.length+12:e.byteLength+145:0},eT.isArray=lT,eT.isArrayBuffer=function(e){return e instanceof ArrayBuffer},eT.isFloat=function(e){return cT(e)||uT(e)},eT.isFloat32Array=uT,eT.isFloat64Array=cT,eT.isInt16Array=iT,eT.isInt32Array=sT,eT.isInt8Array=tT,eT.isSigned=function(e){return cT(e)||uT(e)||sT(e)||iT(e)||tT(e)},eT.isUint16Array=oT,eT.isUint32Array=aT,eT.isUint8Array=rT,eT.isUint8ClampedArray=nT,eT.maximumValue=function(e){return cT(e)?179769e303:uT(e)?3402823e32:aT(e)?4294967295:oT(e)?65535:rT(e)||nT(e)?255:sT(e)?2147483647:iT(e)?32767:tT(e)?127:256},eT.typedArrayStaticSize=145,hT.clone=function(e){if(!e||"object"!=typeof e||"function"==typeof e)return e;var t=dT(e);if(null!=t)return t;if(hT.isClonable(e))return e.clone();if(pT(e))return e.map(g);if(hT.isAccessorLike(e))return e.clone();t={};for(const r of Object.getOwnPropertyNames(e))t[r]=hT.clone(e[r]);return t},hT.equals=function(e,t){return e===t||"number"==typeof e&&isNaN(e)&&"number"==typeof t&&isNaN(t)||"function"==typeof(e||{}).getTime&&"function"==typeof(t||{}).getTime&&e.getTime()===t.getTime()||!1},hT.equalsShallow=function(e,t){if(e===t)return!0;if(null==e||"string"==typeof e)return e===t;if("number"==typeof e)return e===t||"number"==typeof t&&isNaN(e)&&isNaN(t);if(e instanceof Date)return t instanceof Date&&e.getTime()===t.getTime();if(Array.isArray(e))return Array.isArray(t)&&FI.equals(e,t);if(e instanceof Set){var r;if(r=t instanceof Set)e:if(e.size!==t.size)r=!1;else{for(const n of e)if(!t.has(n)){r=!1;break e}r=!0}return r}if(e instanceof Map){if(r=t instanceof Map)e:if(e.size!==t.size)r=!1;else{for(const[n,i]of e)if((e=t.get(n))!==i||void 0===e&&!t.has(n)){r=!1;break e}r=!0}return r}return!!hT.isPlainObject(e)&&(hT.isPlainObject(t)&&function(e,t){if(null===e||null===t)return!1;const r=Object.keys(e);if(null===t||Object.keys(t).length!==r.length)return!1;for(const n of r)if(e[n]!==t[n]||!Object.prototype.hasOwnProperty.call(t,n))return!1;return!0}(e,t))},hT.fixJson=function(e,t){let r;if(t)for(r in e)e.hasOwnProperty(r)&&(void 0===e[r]?delete e[r]:e[r]instanceof Object&&hT.fixJson(e[r],!0));else for(r in e)e.hasOwnProperty(r)&&void 0===e[r]&&delete e[r];return e},hT.isAccessorLike=function(e){return"function"==typeof e.notifyChange&&"function"==typeof e.watch},hT.isClonable=function(e){return"function"==typeof e.clone},hT.isPlainObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)&&(null===(e=Object.getPrototypeOf(e))||e===Object.prototype)},hT.tryClone=function(e){if(!e||"object"!=typeof e||"function"==typeof e||"HTMLElement"in globalThis&&e instanceof HTMLElement)return e;var t=dT(e);if(null!=t)return t;if(pT(e)){let t=!0;return e=e.map((e=>{const r=hT.tryClone(e);return null!=e&&null==r&&(t=!1),r})),t?e:null}if(u(e))return e.clone();if(e instanceof File||e instanceof Blob)return e;if(!hT.isAccessorLike(e)){t=new(Object.getPrototypeOf(e).constructor);for(const r of Object.getOwnPropertyNames(e)){const n=e[r],i=hT.tryClone(n);if(null!=n&&null==i)return null;t[r]=i}return t}return null},fT.prototype=Object.create(KI.prototype),fT.prototype.constructor=fT,fT.prototype.destroy=function(){KI.prototype.destroy.apply(this),this._set=null},fT.prototype.acquire=function(...e){return e=KI.prototype.acquire.apply(this,Array.prototype.slice.apply(arguments)),this._set.delete(e),e},fT.prototype.release=function(e){e&&!this._set.has(e)&&(KI.prototype.release.apply(this,e),this._set.add(e))},fT.prototype._dispose=function(e){this._set.delete(e),KI.prototype._dispose.apply(this,e)};const gT=[];function _T(){}function mT(){for(;ET.length;){const e=ET.shift();e.isActive&&e.callback()}xT.willDispatch=!1}AT.nextTick=function(e){gT.push(e),1===gT.length&&queueMicrotask((()=>{const e=gT.slice();gT.length=0;for(const t of e)t()}))};class yT{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}}var ET=[];const xT={willDispatch:!1,dispatch:mT};_T.schedule=function(e){return e=new yT(e),ET.push(e),xT.willDispatch||(xT.willDispatch=!0,AT.nextTick(mT)),e};let CT=0;function bT(){}function IT(){}function TT(e){return e.__accessor__?e.__accessor__:null}function vT(e,t,r){return t?Object.keys(t).reduce(((e,n)=>{let i=null;var o="merge";if(r&&(i=r.path?`${r.path}.${n}`:n,o=r.policy(i)),"replace"===o||"replace-arrays"===o&&Array.isArray(e[n]))return e[n]=t[n],e;if(void 0===e[n])return e[n]=hT.clone(t[n]),e;let s=e[n];if(o=t[n],s===o)return e;if(Array.isArray(o)||Array.isArray(e))s=s?Array.isArray(s)?e[n]=s.concat():e[n]=[s]:e[n]=[],o&&(Array.isArray(o)||(o=[o]),o.forEach((e=>{s.includes(e)||s.push(e)})));else if(o&&"object"==typeof o)if(r){const t=r.path;r.path=VI.assumeNonNull(i),e[n]=vT(s,o,r),r.path=t}else e[n]=vT(s,o,null);else e.hasOwnProperty(n)&&!t.hasOwnProperty(n)||(e[n]=o);return e}),e||{}):e}function RT(e){return Array.isArray(e)?e:e.split(".")}function MT(e){return e.includes(",")?e.split(",").map((e=>e.trim())):[e.trim()]}function wT(e){if(Array.isArray(e)){const t=[];for(const r of e)t.push(...MT(r));return t}return MT(e)}function ST(){}function BT(e,t){if(e="?"===e[e.length-1]?e.slice(0,-1):e,null!=t.getItemAt||Array.isArray(t)){var r=parseInt(e,10);if(!isNaN(r))return Array.isArray(t)?t[r]:t.at(r)}return r=IT.getProperties(t),IT.isPropertyDeclared(r,e)?r.get(e):t[e]}function OT(e,t,r){return null==e?e:!(e=BT(t[r],e))&&r<t.length-1?void 0:r===t.length-1?e:OT(e,t,r+1)}function DT(e,t,r=0){return"string"!=typeof t||t.includes(".")?OT(e,IT.pathToArray(t),r):BT(t,e)}function FT(){}function PT(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}function NT(e){this._accessed=[],this._handles=[],this._observerObject=new PT(e)}bT.NullUID=0,bT.generateUID=function(){return++CT},IT.getDependsInfo=function(e,t){const r=TT(e);return r?r.getDependsInfo(e,t,""):""},IT.getProperties=TT,IT.isPropertyDeclared=function(e,t){return null!=e&&e.metadatas&&null!=e.metadatas[t]},IT.merge=function(e,t,r){return vT(e,t,r?{policy:r,path:""}:null)},IT.once=function(e){let t=!1;return()=>{t||(t=!0,e())}},IT.parse=function(e,t,r,n){return 1!==(t=wT(t)).length?(t=t.map((t=>n(e,t,r))),XI.handlesGroup(t)):n(e,t[0],r)},IT.parseConditionalPath=function(e){if(!e.includes("?"))return null;e=RT(e);const t=Array(e.length);for(let r=0;r<e.length;r++){const n=e[r];t[r]="?"===n[n.length-1],t[r]&&(e[r]=n.slice(0,-1))}return{fullPath:e.join("."),conditional:t}},IT.pathToArray=RT,IT.pathToStringOrArray=function(e){return!e||"string"==typeof e&&!e.includes(".")?e:RT(e)},IT.splitPath=wT,ST.exists=function(e,t){return void 0!==DT(t,e)},ST.get=function(e,t){return DT(e,t)},ST.valueOf=DT,PT.prototype.onInvalidated=function(){this._invalidCount++},PT.prototype.onCommitted=function(){if(!this.destroyed){var e=this._invalidCount;1===e?(this._invalidCount=0,this._notify()):this._invalidCount=0<e?e-1:0}},PT.prototype.destroy=function(){this.destroyed=!0,this._notify=FT},NT.prototype.destroy=function(){this._accessed.length=0,this._observerObject&&this._observerObject.destroy(),this.clear()},NT.prototype.onObservableAccessed=function(e){const t=this._accessed;t.includes(e)||t.push(e)},NT.prototype.onTrackingEnd=function(){const e=this._handles,t=this._accessed,r=this._observerObject;for(let n=0;n<t.length;++n)e.push(t[n].observe(r));t.length=0},NT.prototype.clear=function(){const e=this._handles;for(let t=0;t<e.length;++t)e[t].remove();e.length=0};let LT={};function UT(){}function GT(){var e=zT.length;if(1<e){const t=zT.pop();jT=zT[e-2],t.onTrackingEnd()}else if(1===e){const e=zT.pop();jT=kT,e.onTrackingEnd()}else jT=kT}function QT(e,t,r){if(t="?"===t[t.length-1]?t.slice(0,-1):t,null!=e.getItemAt||Array.isArray(e)){var n=parseInt(t,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.at(n)}return(n=IT.getProperties(e))&&(n=n.propertiesByName.get(t))&&(UT.trackAccess(n.observerObject),UT.initializeDependencyTracking(e,n)),r?e[t]:void 0}LT[LT.Dirty=1]="Dirty",LT[LT.Overriden=2]="Overriden",LT[LT.Computing=4]="Computing",LT[LT.NonNullable=8]="NonNullable",LT[LT.HasDefaultValue=16]="HasDefaultValue",LT[LT.DepTrackingInitialized=32]="DepTrackingInitialized",LT[LT.AutoTracked=64]="AutoTracked",LT[LT.ExplicitlyTracking=128]="ExplicitlyTracking";const kT={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},zT=[];let jT=kT,HT=!1,qT=!1;const VT=[];function YT(){}UT.initializeDependencyTracking=function(e,t){if(!(t.flags&LT.DepTrackingInitialized)){var r=qT;qT=!1,t.flags&LT.AutoTracked?UT.runTrackedNoThrow(t,t.metadata.get,e):UT.trackExplicitDependencies(e,t),qT=r}},UT.runTracked=function(e,t,r){if(HT)return UT.runTrackedNoThrow(e,t,r);jT=e,zT.push(e);var n=t.call(r);return GT(),n},UT.runTrackedNoThrow=function(e,t,r){const n=HT;HT=!0,jT=e,zT.push(e),e=null;try{e=t.call(r)}catch(e){qT&&console.log("core.accessorSupport.tracking",e)}return GT(),HT=n,e},UT.runUntracked=function(e,t){return UT.runTracked(kT,e,t)},UT.trackAccess=function(e){jT.onObservableAccessed(e)},UT.trackExplicitDependencies=function(e,t){const r=t.observerObject;r.flags&LT.ExplicitlyTracking||(r.flags|=LT.ExplicitlyTracking,UT.runTrackedNoThrow(t,(()=>{var r=t.metadata.dependsOn||VT;for(const t of r)if("string"!=typeof t||t.includes(".")){r=IT.pathToArray(t);for(let t=0,n=e;t<r.length&&null!=n&&"object"==typeof n;++t)n=QT(n,r[t],t!==r.length-1)}else QT(e,t,!1)})),r.flags&=~LT.ExplicitlyTracking)};let XT=!1;const WT=[];function KT(){this.uid=bT.generateUID(),this.removed=!1,this.equals=null,this.path=null,this.target=null,this.getValue=null,this.callback=null,this.oldValue=null,this.type=null}function JT(){}function ZT(e){iv.delete(e),iv.add(e),ov||(ov=_T.schedule(ev))}function $T(e){if(!e.removed){var t=e.oldValue,r=e.getValue();e.equals(t,r)||(e.oldValue=r,e.notify(r,t))}}function ev(){let e=10;for(;ov&&e--;){ov=null;const e=tv(),t=nv.acquire();for(const r of e){const e=r.uid;$T(r),e===r.uid&&r.removed&&t.push(r)}for(const e of iv)e.removed&&(t.push(e),iv.delete(e));for(const e of t)KT.pool.release(e);nv.release(t),nv.release(e),sv.forEach((e=>e()))}}function tv(){const e=nv.acquire();e.length=iv.size;let t=0;for(const r of iv)e[t]=r,++t;return iv.clear(),e}var rv;YT.autorun=function(e){let t=new NT((function n(){if(t&&!r)if(XT)WT.includes(n)||WT.unshift(n);else for(t.clear(),r=XT=!0,UT.runTracked(t,e),XT=r=!1;WT.length;)WT.pop()()})),r=!1;return r=!0,UT.runTracked(t,e),r=!1,{remove:function(){t&&(t.destroy(),t=null)}}},YT.reaction=function(e,t){let r=new NT((function o(){if(r&&!i)if(XT)WT.includes(o)||WT.unshift(o);else{var s=n;for(r.clear(),i=XT=!0,n=UT.runTracked(r,e),XT=i=!1,t(n,s);WT.length;)WT.pop()()}})),n=null,i=!1;return i=!0,n=UT.runTracked(r,e),i=!1,{remove:function(){r&&(r.destroy(),n=r=null)}}},YT.reactionDeferred=function(e,t){function r(){return n?(n.clear(),i=UT.runTracked(n,e)):null}let n=new NT((function(){t(i,r)}));var i=null;return r(),{remove:function(){n&&(n.destroy(),n=null),i=null}}},KT.acquireUntracked=function(e,t,r,n,i){return this.pool.acquire(rv.Untracked,e,t,r,n,i,hT.equals)},KT.acquireTracked=function(e,t,r,n){return this.pool.acquire(rv.Tracked,e,t,r,null,null,n)},KT.prototype.notify=function(e,t){this.type===rv.Untracked?this.callback.call(this.target,e,t,this.path,this.target):this.callback.call(null,e,t,void 0,void 0)},KT.prototype.acquire=function(e,t,r,n,i,o,s){this.uid=bT.generateUID(),this.removed=!1,this.type=e,this.oldValue=t,this.callback=r,this.getValue=n,this.target=i,this.path=o,this.equals=s},KT.prototype.release=function(){this.target=null,this.path=null,this.oldValue=null,this.callback=null,this.getValue=null,this.uid=bT.generateUID(),this.removed=!1},KT.pool=new fT(KT),function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"}(rv||(rv={}));const nv=new ZI,iv=new Set;let ov;const sv=new Set;function av(){}function uv(e="Aborted"){return{type:"AbortError",status:e}}function cv(e,t="Aborted"){if(hv(e))throw uv(t)}function lv(e){return null!=e?"aborted"in e?e:e.signal:e}function hv(e){return null!=(e=lv(e))&&e.aborted}function pv(e,t){null!=(e=lv(e))&&e.aborted&&t()}function dv(e){return"AbortError"===e?.name}async function fv(e){if(e){if("function"!=typeof e.forEach){const t=Object.keys(e),r=t.map((t=>e[t])),n=await fv(r),i={};return t.map(((e,t)=>i[e]=n[t])),i}return Promise.allSettled(e).then((t=>Array.from(e,((e,r)=>"fulfilled"===(r=t[r]).status?{promise:e,value:r.value}:{promise:e,error:r.reason}))))}}function Av(e){return e&&"function"==typeof e.then}function gv(){}function _v(e,t,r={},n){let i=null;const o=r.once?(e,r)=>{n(e)&&(VI.removeMaybe(i),t(e,r))}:(e,r)=>{n(e)&&t(e,r)};if(i=JT.watchTracked(e,o,r.sync,r.equals),r.initial){let t=e();o(t,t)}return i}function mv(e,t,r){if(av.isAborted(r))return Promise.reject(av.createAbortError());const n=e();if(t&&t(n))return Promise.resolve(n);let i=null;return new Promise(((n,o)=>{i=XI.handlesGroup([av.onAbort(r,(()=>{i=VI.removeMaybe(i),o(av.createAbortError())})),_v(e,(e=>{i=VI.removeMaybe(i),n(e)}),{sync:!1,once:!0},t||yv)])}))}function yv(e){return!0}function Ev(e){return!!e}function xv(e,t){this._observers=e,this._observer=t}function Cv(){this._observers=null,this.destroyed=!1}JT.afterDispatch=function(e){return sv.add(e),XI.makeHandle((()=>sv.delete(e)))},JT.dispatch=ev,JT.removeTarget=function(e){for(const t of iv.values())t.target===e&&(t.removed=!0)},JT.watch=function(e,t,r,n=!1){return!e.__accessor__||e.__accessor__.destroyed?XI.makeHandle():n?function(e,t,r){const n=IT.parse(e,t,r,((e,t,r)=>{let i=!1;return YT.reaction((()=>ST.valueOf(e,t)),((o,s)=>{e.__accessor__.destroyed?n.remove():i||(i=!0,hT.equals(s,o)||r.call(e,o,s,t,e),i=!1)}))}));return n}(e,t,r):function(e,t,r){let n=IT.parse(e,t,r,((e,t,r)=>{let i,o,s=YT.reactionDeferred((()=>ST.valueOf(e,t)),((s,a)=>{e.__accessor__.destroyed||i&&i.uid!==o?n.remove():(i||(i=KT.acquireUntracked(s,r,a,e,t),o=i.uid),ZT(i))}));return XI.makeHandle((()=>{s.remove(),i&&(i.uid!==o||i.removed||(i.removed=!0,ZT(i)),i=null),n=s=null}))}));return n}(e,t,r)},JT.watchTracked=function(e,t,r=!1,n=hT.equalsShallow){return r?function(e,t,r){let n=!1;return YT.reaction(e,((e,i)=>{n||(n=!0,r(i,e)||t(e,i),n=!1)}))}(e,t,n):function(e,t,r){var n,i,o=YT.reactionDeferred(e,((e,s)=>{n&&n.uid!==i?o.remove():(n||(n=KT.acquireTracked(e,t,s,r),i=n.uid),ZT(n))}));return XI.makeHandle((()=>{o.remove(),n&&(n.uid!==i||n.removed||(n.removed=!0,ZT(n)),n=null),o=null}))}(e,t,n)},av.after=function(e,t,r){const n=new AbortController;return pv(r,(()=>n.abort())),new Promise(((r,i)=>{let o=setTimeout((()=>{o=0,r(t)}),e);pv(n,(()=>{o&&(clearTimeout(o),i(uv()))}))}))},av.allSettledErrors=async function(e){return(await Promise.allSettled(e)).filter((e=>"rejected"===e.status)).map((e=>e.reason))},av.allSettledValues=async function(e){return(await Promise.allSettled(e)).filter((e=>"fulfilled"===e.status)).map((e=>e.value))},av.always=function(e,t){return e.then(t,t)},av.createAbortError=uv,av.eachAlways=fv,av.eachAlwaysValues=async function(e){return(await fv(e)).filter((e=>!!e.value)).map((e=>e.value))},av.filter=async function(e,t){const r=e.slice(),n=await Promise.all(e.map(((e,r)=>t(e,r))));return r.filter(((e,t)=>n[t]))},av.ignoreAbortErrors=async function(e){try{return await e}catch(e){if(!dv(e))throw e}},av.isAbortError=dv,av.isAborted=hv,av.isPromiseLike=Av,av.onAbort=pv,av.settleWithPromise=function(e,t){t.then(e.resolve,e.reject)},av.throwIfAbortError=function(e){if(dv(e))throw e},av.throwIfAborted=cv,av.throwIfNotAbortError=function(e){if(!dv(e))throw e},av.waitTick=async function(e){await Promise.resolve(),cv(e)},av.when=function(e){return Av(e)?e:Promise.resolve(e)},av.whenOrAbort=function(e,t){return null==lv(t)?e:new Promise(((r,n)=>{let i=pv(t,(()=>n(uv())));const o=()=>{i=VI.removeMaybe(i)};e.then(o,o),e.then(r,n)}))},gv.autorun=YT.autorun,gv.initial={initial:!0},gv.pausable=function(e,t,r={}){let n=!1;const i=gv.watch(e,((e,r)=>{n||t(e,r)}),r);return{remove(){i.remove()},pause(){n=!0},resume(){n=!1}}},gv.sync={sync:!0},gv.syncAndInitial={sync:!0,initial:!0},gv.watch=function(e,t,r={}){return _v(e,t,r,yv)},gv.when=function(e,t,r={}){return _v(e,t,r,Ev)},gv.once=function(e,t){return mv(e,null,t)},gv.whenOnce=function(e,t){return mv(e,Ev,t)},xv.prototype.remove=function(){FI.remove(this._observers,this._observer)},Cv.prototype.observe=function(e){if(this.destroyed||e.destroyed)return bv;null==this._observers&&(this._observers=[]);const t=this._observers;let r=!1,n=!1;const i=t.length;for(let o=0;o<i;++o){const i=t[o];if(i.destroyed)n=!0;else if(i===e){r=!0;break}}return r||(t.push(e),n&&this._removeDestroyedObservers()),new xv(t,e)},Cv.prototype._removeDestroyedObservers=function(){const e=this._observers;if(e&&0!==e.length){var t=e.length,r=0;for(let n=0;n<t;++n){for(;n+r<t&&e[n+r].destroyed;)++r;if(0<r){if(!(n+r<t))break;e[n]=e[n+r]}}e.length=t-r}},Cv.prototype.destroy=function(){if(!this.destroyed){this.destroyed=!0;var e=this._observers;if(null!=e){for(const t of e)t.onCommitted();this._observers=null}}};const bv=XI.makeHandle();function Iv(){Cv.call(this)}function Tv(e,t){this._observable=new Iv,this._value=e,this._equalityFunction=t}function vv(e,t,r,n,i){this.resolve=e,this.reject=t,this.callback=r,this.signal=n,this.abortCallback=i}function Rv(){this._tasks=[],this._running=Tv.signal(!1)}Iv.prototype=Object.create(Cv.prototype),Iv.prototype.constructor=Cv,Iv.prototype.notify=function(){var e=this._observers;if(e&&0<e.length){e=e.slice();for(const t of e)t.onInvalidated(),t.onCommitted()}},Object.defineProperties(Tv.prototype,{value:{get:function(){return UT.trackAccess(this._observable),this._value},set:function(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}}}),Tv.prototype.mutate=function(e){e(this._value),this._observable.notify()},Tv.signal=function(e,t=hT.equalsShallow){return new Tv(e,t)},Object.defineProperties(Rv.prototype,{length:{get:function(){return this._tasks.length}},running:{get:function(){return this._running.value}}}),Rv.prototype.destroy=function(){this.cancelAll()},Rv.prototype.runTask=function(e){for(;!e.done&&this._process(e);)e.madeProgress()},Rv.prototype.push=function(e,t,r){return this._running.value=!0,new Promise(((n,i)=>this._tasks.push(new vv(n,i,e,t,r))))},Rv.prototype.unshift=function(e,t,r){return this._running.value=!0,new Promise(((n,i)=>this._tasks.unshift(new vv(n,i,e,t,r))))},Rv.prototype._process=function(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const r=c.isAborted(t.signal);if(r&&!t.abortCallback)t.reject(c.createAbortError());else{const n=r?t.abortCallback&&t.abortCallback(c.createAbortError()):t.callback(e);c.isPromiseLike(n)?n.then(t.resolve,t.reject):t.resolve(n)}}catch(e){t.reject(e)}return this._running.value=0<this._tasks.length,!0},Rv.prototype.cancelAll=function(){const e=c.createAbortError();for(const t of this._tasks)if(t.abortCallback){const r=t.abortCallback(e);t.resolve(r)}else t.reject(e);this._tasks.length=0,this._running.value=!1};const Mv="YIELD",wv="INTERACTING",Sv="IDLE";function Bv(e){return Lv.has(e)?Lv.get(e):"number"==typeof e?e:1}const Ov={TESTA:"immediate",TESTB:"schedule",TESTC:"slide",SHADOW_ACCUMULATOR:"shadow accumulator",GRAPHICS_DECONFLICTOR:"graphics deconflictor",LABELER:"LABELER",GET_ELEVATION:"GET_ELEVATION"},Dv="s",Fv="r",Pv="w",Nv="i",Lv=new Map([[Ov.RESOURCE_CONTROLLER_IMMEDIATE,0],[Ov.RESOURCE_CONTROLLER,4],[Ov.GRAPHICS_DECONFLICTOR,4],[Ov.LABELER,8],[Ov.GET_ELEVATION,9],[Ov.SLIDE,0],[Ov.SHADOW_ACCUMULATOR,30]]);function Uv(e){this._updating=Tv.signal(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new HI("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new Gv,this._state=wv,this._tasks=new jI,this._runQueue=new jI,this._load=0,this._idleStateCallbacks=new jI,this._debug=!1,this._forceTask=!1,this._idleUpdatesStartFired=!1,this._cameraChangeTime=0;for(const e of Object.keys(Ov))this.performanceInfo.tasks.set(Ov[e],new HI(Ov[e]));const t=this;e.camera.changed.addEventListener((()=>{t._cameraChangeTime=performance.now()}))}Object.defineProperties(Uv.prototype,{updating:{get:function(){return this._updating.value}},load:{get:function(){return this._load}},state:{get:function(){return this._state},set:function(e){this._state!==e&&(this._state=e,this.state!==Sv&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}},test:{get:function(){return this._test}}}),Uv.prototype._updatingChanged=function(){this._updating.value=this._tasks.some((e=>e.needsUpdate))},Uv.prototype.destroy=function(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),this._microTaskQueued=!1,this._updatingChanged()},Uv.prototype.taskRunningChanged=function(e){this._updatingChanged(),e&&0<this._budget.remaining&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,0<this._budget.remaining&&this._schedule()&&this.frame())})))},Uv.prototype.registerTask=function(e,t){return t=new Qv(this,e,t,Bv(e)),this._tasks.push(t),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(H,new HI(e)),t},Uv.prototype.registerIdleStateCallbacks=function(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),this.state===Sv&&this._idleUpdatesStartFired&&r.idleBegin();const n=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){n._idleUpdatesStartFired&&(r.idleEnd(),n._state===Sv&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}};function Gv(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=Sv,this._progressed=this._done=!1,this._enabled=!0}function Qv(e,t,r,n){this._scheduler=e,this.name=t,this._basePriority=n,this.runtime=this.blockFrame=0,this._queue=new Rv,this._handles=new YI,this.schedulePriority=this._basePriority,this._task=Tv.signal(null!=r?r:this._queue),this._handles.add(gv.when((()=>{this.task.running}),(t=>e.taskRunningChanged(t))))}function kv(e){qt.defined("scene",e.scene),qt.defined("globe",e.globe),this._scene=e.scene,this._globe=e.globe,this._running=!0,this._frameTask=this._scene._frameScheduler.registerTask(Ov.GET_ELEVATION,this),this._requestManager=new Vv}Uv.prototype.updateBudget=function(e){++this._frameNumber;let t=6.5,r=e.frameDuration,n=1;switch(this.state){case Sv:t=0,r=Math.max(60,e.frameDuration),n=15;break;case wv:r=Math.max(5,e.frameDuration)}return r=r-e.elapsedFrameTime-t,this.state!==Sv&&r<1&&!this._forceTask?(this._forceTask=!0,!1):(r=Math.max(r,n),this._budget.reset(r,this.state),this._updateLoad(),this._schedule())},Uv.prototype.frame=function(){switch(300>=performance.now()-this._cameraChangeTime?this._state=wv:this._state=Sv,this._microTaskQueued=this._forceTask=!1,this.state){case Sv:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case wv:this._runInteracting();break;default:this._runAnimating()}},Uv.prototype.stopFrame=function(){this._budget.reset(0,this._state),this._budget.madeProgress()},Uv.prototype._removeIdleStateCallbacks=function(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)},Uv.prototype.removeTask=function(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()},Uv.prototype._updateTask=function(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))},Uv.prototype._getState=function(e){if(this._runQueue.some((t=>t.name===e)))return Dv;let t=Nv;return this._tasks.forAll((r=>{r.name===e&&r.needsUpdate&&(1>=r.schedulePriority?t=Fv:t!==Fv&&(t=Pv))})),t},Uv.prototype._getRuntime=function(e){let t=0;return this._tasks.forAll((r=>{r.name===e&&(t+=r.runtime)})),t},Uv.prototype._resetRuntimes=function(){this._tasks.forAll((e=>e.runtime=0))},Uv.prototype._getRunning=function(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,r)=>{t=1<e?t+` ${e}x ${r}`:t+` ${r}`})),t},Uv.prototype._runIdle=function(){this._run()},Uv.prototype._runInteracting=function(){this._run()},Uv.prototype._runAnimating=function(){this._run()},Uv.prototype._updateLoad=function(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)},Uv.prototype._schedule=function(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1;if(this._tasks.forAll((t=>{if(t.needsUpdate&&0!==t.schedulePriority&&0!==t.basePriority&&t.blockFrame!==this._frameNumber)if(e=!0,1===t.schedulePriority)t.schedulePriority=0,this._runQueue.push(t);else--t.schedulePriority})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0},Uv.prototype._run=function(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;0<this._runQueue.length;){var t=this._budget.now();const n=this._runQueue.pop();this._budget.resetProgress();try{n.task.runTask(this._budget)===Mv&&(n.blockFrame=this._frameNumber)}catch(e){console.log(`Exception in task "${n.name}"`+e)}!this._budget.hasProgressed&&n.blockFrame!==this._frameNumber&&n.needsUpdate&&(n.blockFrame=this._frameNumber),n.schedulePriority=n.basePriority;var r=this._budget.now()-t;if(n.runtime+=r,this._frameTaskTimes.set(n.priority,this._frameTaskTimes.get(n.priority)+r),this._debug&&r>2*this._budget.budget&&console.log("Task",n.name,"used",r,"of max",this._budget.budget,"ms"),0>=this._budget.remaining)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)},Uv.prototype._startFrameTaskTimes=function(){for(const e of Object.keys(Ov))this._frameTaskTimes.set(Ov[e],0)},Uv.prototype._recordFrameTaskTimes=function(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)},Object.defineProperties(Gv.prototype,{done:{get:function(){return this._done}},budget:{get:function(){return this._budget}},state:{get:function(){return this._state}},enabled:{get:function(){return this._enabled}},remaining:{get:function(){return Math.max(this._budget-this.elapsed,0)}},elapsed:{get:function(){return performance.now()-this._begin}},hasProgressed:{get:function(){return this._progressed}}}),Gv.prototype.run=function(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)},Gv.prototype.madeProgress=function(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled},Gv.prototype.reset=function(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()},Gv.prototype.now=function(){return performance.now()},Gv.prototype.resetProgress=function(){this._done=this._progressed=!1},Object.defineProperties(Qv.prototype,{task:{get:function(){return this._task.value}},updating:{get:function(){return this._queue.running}},basePriority:{get:function(){return this._basePriority}},priority:{get:function(){return this.name},set:function(e){this.setPriority(e)}},needsUpdate:{get:function(){return this.updating||this.task.running}}}),Qv.prototype.remove=function(){this.processQueue(C),this._scheduler.removeTask(this),this.schedule=D.schedule,this.reschedule=D.reschedule,this._handles.destroy()},Qv.prototype.setPriority=function(e){this.name=e;let t=Bv(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t},Qv.prototype.schedule=function(e,t,r){return this._queue.push(e,t,r)},Qv.prototype.reschedule=function(e,t,r){return this._queue.unshift(e,t,r)},Qv.prototype.processQueue=function(e){this._queue.runTask(e)},Object.defineProperties(kv.prototype,{clampEnabled:{get:function(){return!!this._scene._hasLayerCoveredMap||this._globe.terrainProvider!==this._globe._defaultTerrainProvider}},clampTerrainEnabled:{get:function(){return!this._scene._hasLayerCoveredMap&&this._globe.terrainProvider!==this._globe._defaultTerrainProvider}},clampModelEnabled:{get:function(){return this._scene._hasLayerCoveredMap}},running:{get:function(){return this._running}}});var zv=new Tu,jv=new lr;function Hv(e,t,r){if(!t.visible||null==t.coveredMap)return 0;var n=e._scene,i=e._globe._ellipsoid;r.height=9e3,lr.toCartesian(r,Qi.WGS84,zv.origin),i.geodeticSurfaceNormal(zv.origin,zv.direction),Zt.negate(zv.direction,zv.direction);let o=t.intersect(zv,n);return jt(o)?(lr.fromCartesian(o,Qi.WGS84,jv),jv.height):void 0}function qv(e){this._set=new Set,this.carto=lr.clone(e)}function Vv(){this._map=new Map}function Yv(e){this.owner=e.owner,this.callbackParameter=e.callbackParameter,this.requesCarto=e.requesCarto,this.key=this._getRequesKey()}kv.prototype.getElevation=function(e){let t=this._globe.getHeight(e);if(void 0===t&&(t=0),this.clampModelEnabled){var r=t;let n=this._scene.layers.layerQueue;for(let i of n)t=Hv(this,i,e),jt(t)&&r<t&&(r=t);return r}return t},kv.prototype.cancelRequestor=function(e){this._requestManager.remove(e)},kv.prototype.requestElevation=function(e){this._requestManager.add(e)},kv.prototype._resetIterator=function(){this._iterators=null},kv.prototype.runTask=function(e){for(this._iterators||(this._iterators=function*(e){var t=e.iterableIterator();for(let e=t.next();!e.done;e=t.next())yield e.value[1]}(this._requestManager));!e.done;){e.madeProgress();let t=this._iterators.next();if(!0===t.done)return this._resetIterator(),this._requestManager.clear(),Mv;let r=t.value;if(r.size>0){let e=this.getElevation(r.carto);r.updateElevation(e),r.clear()}}return Mv},Object.defineProperties(qv.prototype,{size:{get:function(){return this._set.size}}}),qv.prototype.add=function(e){this._set.add(e)},qv.prototype.remove=function(e){this._set.delete(e)},qv.prototype.updateElevation=function(e){for(let t of this._set)t.updateElevation(e)},qv.prototype.clear=function(){this._set.clear()},Vv.prototype.iterableIterator=function(){return this._map.entries()},Vv.prototype.add=function(e){let t=e.key,r=null;this._map.has(t)?r=this._map.get(t):(r=new qv(e.requesCarto),this._map.set(t,r)),r.add(e)},Vv.prototype.remove=function(e){let t=e.key,r=this._map.get(t);r&&r.remove(e)},Vv.prototype.clear=function(){this._map.clear()},Yv.prototype._getRequesKey=function(){return this.requesCarto.longitude+"_"+this.requesCarto.latitude},Yv.prototype.updateElevation=function(e){this.owner&&this.owner.updateElevationRequestor(e,this.callbackParameter)};let Xv=new lr,Wv=new lr,Kv=new Zt,Jv=new uf;var Zv=["Unknown","Point","LineString","Polygon"];const $v=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0,strideInBytes:1}],eR=[{name:"a_fade_opacity",components:1,type:"Uint32",offset:0,strideInBytes:4}];function tR(e,t,r,n,i,o,s,a,u,c,l,h,p){const d=a?Math.min(nx,Math.round(a[0])):0,f=a?Math.min(nx,Math.round(a[1])):0;e.emplaceBack(t,r,Math.round(32*n),Math.round(32*i),o,s,(d<<1)+(u?1:0),f,16*c,16*l,256*h,256*p)}function rR(e){for(const t of e.sections)if(Uy(t.text))return!0;return!1}class nR{constructor(e){this.layoutVertexArray=new fh,this.indexArray=new bh,this.programConfigurations=e,this.segments=new tf,this.dynamicLayoutVertexArray=new Bh,this.opacityVertexArray=new _h,this.placedSymbolArray=new Qh,this.alongLine=!0}createLngLatQuadsArray(){this.lngLatQuadsArray=new Wh,this.alongLine=!1,this.heightDirty=!0}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,r,n){this.isEmpty()||((r||!this.alongLine&&this.heightDirty)&&(void 0===this.dynamicLayoutVertexBuffer?this.dynamicLayoutVertexBuffer=md.toVertexBuffer(e,this.dynamicLayoutVertexArray,Rm.members,!0):md.copyFromArrayView(this.dynamicLayoutVertexBuffer,this.dynamicLayoutVertexArray.arrayBuffer,0),!this.alongLine&&(this.heightDirty=!1)),r&&(this.layoutVertexBuffer=md.toVertexBuffer(e,this.layoutVertexArray,vm.members),this.indexBuffer=md.toIndexBuffer(e,this.indexArray,t),this.opacityVertexBuffer=md.toVertexBuffer(e,this.opacityVertexArray,e.webgpu?eR:$v,!0),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(e))}updateElevationRequestor(e,t){let r=this.lngLatQuadsArray.get(t.lngLatQuadsIndex),n=r.lng,i=r.lat,o=r.quads;lr.fromRadians(n,i,0,Xv),Xv.height=e,lr.toCartesian(Xv,void 0,Kv);let s=this._crs;s.sceneMode!=Ta.COLUMBUS_VIEW&&s.sceneMode!=Ta.SCENE2D||(Kv=ks.convertToColumbusCartesian(Kv)),uf.fromCartesian(Kv,Jv),r.height=Xv.height;let a=this.dynamicLayoutVertexArray.bytesPerElement/4,u=4*a,c=t.quadIndex,l=this.dynamicLayoutVertexArray.float32;for(let e=0;e<o;e++){for(let e=0;e<4;e++){let t=c*u+e*a;l[t+4]=Jv.high.x,l[t+5]=Jv.high.y,l[t+6]=Jv.high.z,l[t+7]=Jv.low.x,l[t+8]=Jv.low.y,l[t+9]=Jv.low.z}c++}this.heightDirty=!0}correctHeight(e,t){if(this._elevationProvider=e,this._crs=t,!this.alongLine){this.createElevationRequestors();for(let t=0;t<this.elevationRequestorArray.length;t++){let r=this.elevationRequestorArray[t];e.requestElevation(r)}}}createElevationRequestors(){if(this.elevationRequestorArray)return;this.elevationRequestorArray=[];let e=0;for(let t=0;t<this.lngLatQuadsArray.length;t++){let r=this.lngLatQuadsArray.get(t),n=r.lng,i=r.lat,o=lr.fromRadians(n,i,0),s=r.quads;this.elevationRequestorArray.push(new Yv({owner:this,callbackParameter:{quadIndex:e,lngLatQuadsIndex:t},requesCarto:o})),e+=s}}destroy(){if(this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.lngLatQuadsArray&&this.lngLatQuadsArray.destroy(),this.elevationRequestorArray)){for(let e=0;e<this.elevationRequestorArray.length;e++){let t=this.elevationRequestorArray[e];this._elevationProvider.cancelRequestor(t)}this.elevationRequestorArray=[]}}}Ml(nR,"SymbolBuffers");class iR{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new tf,this.collisionVertexArray=new xh,this.collisionVertexArrayExt=new Ch}upload(e){this.layoutVertexBuffer=md.toVertexBuffer(e,this.layoutVertexArray,this.layoutAttributes.members),this.indexBuffer=md.toIndexBuffer(e,this.indexArray),this.collisionVertexBuffer=md.toVertexBuffer(e,this.collisionVertexArray,Mm.members,!0),this.collisionVertexBufferExt=md.toVertexBuffer(e,this.collisionVertexArrayExt,wm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ml(iR,"CollisionBuffers");class oR{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.webgpu=e.webgpu,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Sf.mat4.identity([]),this.placementViewportMatrix=Sf.mat4.identity([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Dm(this.zoom,t["text-size"]),this.iconSizeData=Dm(this.zoom,t["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1);const o="viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey;this.sortFeaturesByY=o&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map((e=>gE[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){var e=vm.members;this.text=new nR(new Bd(e,this.layers,this.zoom,(e=>/^text/.test(e))),this.webgpu),this.icon=new nR(new Bd(e,this.layers,this.zoom,(e=>/^icon/.test(e))),this.webgpu),this.glyphOffsetArray=new jh,this.lineVertexArray=new Hh,this.symbolInstances=new zh}calculateGlyphDependencies(e,t,r,n,i){for(let r=0;r<e.length;r++)if(t[e.charCodeAt(r)]=!0,n&&i){const n=Gy[e.charAt(r)];n&&(t[n.charCodeAt(0)]=!0)}}populate(e,t,r,n){const i=this.layers[0],o=i.layout,s=o.get("text-font"),a=o.get("text-field"),u=o.get("icon-image"),c=("constant"!==a.value.kind||a.value.value instanceof P&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),l="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!c&&!l)return;const p=t.iconDependencies,d=t.glyphDependencies,f=t.availableImages,A=new Ql(this.zoom);for(const{feature:t,id:n,index:a,sourceLayerIndex:u}of e){const e=i._featureFilter.needGeometry,g=af(t,e);if(!i._featureFilter.filter(A,g,r))continue;let _,m;if(e||(g.geometry=sf(t)),c){const e=i.getValueAndResolveTokens("text-field",g,r,f),t=P.factory(e);rR(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Hy||this.hasRTLText&&Vy.isParsed())&&(_=Nm(t,i,g))}if(l){const e=i.getValueAndResolveTokens("icon-image",g,r,f);m=e instanceof N?e:N.fromString(e)}if(!_&&!m)continue;const y=this.sortFeaturesByKey?h.evaluate(g,{},r):void 0,E={id:n,text:_,icon:m,index:a,sourceLayerIndex:u,geometry:g.geometry,properties:t.properties,type:Zv[t.type],sortKey:y};if(this.features.push(E),m&&(p[m.name]=!0),_){const e=s.evaluate(g,{},r).join(","),t="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(gE.vertical)>=0;for(const r of _.sections)if(r.image)p[r.image.name]=!0;else{const n=Sy(_.toString()),i=r.fontStack||e,o=d[i]=d[i]||{};this.calculateGlyphDependencies(r.text,o,t,this.allowVerticalPlacement,n)}}}"line"!==o.get("symbol-placement")&&"line-direction"!==o.get("symbol-placement")||(this.features=function(e){var t={},r={},n=[],i=0;function o(t){n.push(e[t]),i++}function s(e,t,i){var o=r[e];return delete r[e],r[t]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(i[0]),o}function a(e,r,i){var o=t[r];return delete t[r],t[e]=o,n[o].geometry[0].shift(),n[o].geometry[0]=i[0].concat(n[o].geometry[0]),o}function u(e,t,r){var n=r?t[0][t[0].length-1]:t[0][0];return e+":"+n.x+":"+n.y}for(var c=0;c<e.length;c++){var l=e[c],h=l.geometry,p=l.text?l.text.toString():null;if(p){var d=u(p,h),f=u(p,h,!0);if(d in r&&f in t&&r[d]!==t[f]){var A=a(d,f,h),g=s(d,f,n[A].geometry);delete t[d],delete r[f],r[u(p,n[g].geometry,!0)]=g,n[A].geometry=null}else d in r?s(d,f,h):f in t?a(d,f,h):(o(c),t[d]=i-1,r[f]=i-1)}else o(c)}return n.filter((function(e){return e.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,r,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload||this.text.heightDirty||this.icon.heightDirty}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=wI(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const r=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:e,y:r}of t)this.lineVertexArray.emplaceBack(e,r);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A){const g=e.indexArray,_=e.layoutVertexArray,m=e.segments.prepareSegment(4*t.length,_,g,this.canOverlap?o.sortKey:void 0),y=this.glyphOffsetArray.length,E=m.vertexLength,x=this.allowVerticalPlacement&&s===gE.vertical?Math.PI/2:0,C=o.text&&o.text.sections;if(!i){let r=function(e,t,r){if(e.sceneMode===Ta.COLUMBUS_VIEW||e.sceneMode===Ta.SCENE2D){let e=ks.convertTo3DCartesian(t);return lr.fromCartesian(e,void 0,r)}return lr.fromCartesian(t,void 0,r)}(A,c,Wv);e.lngLatQuadsArray.emplaceBack(r.longitude,r.latitude,0,t.length)}for(let n=0;n<t.length;n++){const{tl:i,tr:s,bl:a,br:l,tex:h,pixelOffsetTL:p,pixelOffsetBR:A,minFontScaleX:y,minFontScaleY:E,glyphOffset:b,isSDF:I,sectionIndex:T}=t[n],v=m.vertexLength,R=b[1];tR(_,u.x,u.y,i.x,R+i.y,h.x,h.y,r,I,p.x,p.y,y,E),tR(_,u.x,u.y,s.x,R+s.y,h.x+h.w,h.y,r,I,A.x,p.y,y,E),tR(_,u.x,u.y,a.x,R+a.y,h.x,h.y+h.h,r,I,p.x,A.y,y,E),tR(_,u.x,u.y,l.x,R+l.y,h.x+h.w,h.y+h.h,r,I,A.x,A.y,y,E);const M=uf.fromCartesian(c);oR.addDynamicAttributes(e.dynamicLayoutVertexArray,u.x,u.y,u.z,x,M.high.x,M.high.y,M.high.z,M.low.x,M.low.y,M.low.z),g.emplaceBack(v,v+1,v+2),g.emplaceBack(v+1,v+2,v+3),m.vertexLength+=4,m.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(b[0]),n!==t.length-1&&T===t[n+1].sectionIndex||e.programConfigurations.populatePaintArrays(_.length,o,o.index,{},d,f,C&&C[T])}const b=u;e.placedSymbolArray.emplaceBack(b.x,b.y,b.z,u.x,u.y,y,this.glyphOffsetArray.length-y,E,l,h,u.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],s,0,!1,0,p,0)}_commitLayoutVertex(e,t,r,n,i,o,s){e.emplaceBack(t,r,n,i,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,t,r,n,i,o,s){const a=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),u=a.vertexLength,c=s.tileAnchorX,l=s.tileAnchorY;for(let e=0;e<4;e++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,n,i,o,c,l,new zt(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,o,c,l,new zt(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,o,c,l,new zt(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,n,i,o,c,l,new zt(e.x1,e.y2)),a.vertexLength+=4;const h=r.indexArray;h.emplaceBack(u,u+1),h.emplaceBack(u+1,u+2),h.emplaceBack(u+2,u+3),h.emplaceBack(u+3,u),a.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,r,n,i,o){for(let s=n;s<i;s++){const n=r.get(s),i=this.getSymbolInstanceTextSize(e,o,t,s);this._addCollisionDebugVertices(n,i,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,r,n,i,o){for(let s=n;s<i;s++){const n=r.get(s),i=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._addCollisionDebugVertices(n,i,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new iR(yh,Sm.members,Dh),this.iconCollisionBox=new iR(yh,Sm.members,Dh);const r=Pm(this.iconSizeData,e),n=Pm(this.textSizeData,e);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this._addTextDebugCollisionBoxes(n,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(n,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(r,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(r,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceText(e){let t=this.symbolInstances.get(e);return t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:e}getSymbolInstanceTextSize(e,t,r,n){const i=t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:n,o=this.text.placedSymbolArray.get(i),s=Fm(this.textSizeData,e,o)/Bm;return this.tilePixelRatio*s}getSymbolInstanceIconSize(e,t,r){const n=this.icon.placedSymbolArray.get(r),i=Fm(this.iconSizeData,e,n);return this.tilePixelRatio*i}_commitDebugCollisionVertexUpdate(e,t,r){e.emplaceBack(t,-r,-r),e.emplaceBack(t,r,-r),e.emplaceBack(t,r,r),e.emplaceBack(t,-r,r)}_updateTextDebugCollisionBoxes(e,t,r,n,i,o){for(let s=n;s<i;s++){const n=r.get(s),i=this.getSymbolInstanceTextSize(e,o,t,s),a=this.textCollisionBox.collisionVertexArrayExt;this._commitDebugCollisionVertexUpdate(a,i,n.padding)}}_updateIconDebugCollisionBoxes(e,t,r,n,i,o){for(let s=n;s<i;s++){const n=r.get(s),i=this.getSymbolInstanceIconSize(e,t,o),a=this.iconCollisionBox.collisionVertexArrayExt;this._commitDebugCollisionVertexUpdate(a,i,n.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Pm(this.iconSizeData,e),n=Pm(this.textSizeData,e);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this._updateTextDebugCollisionBoxes(n,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(n,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(r,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(r,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.copyFromArrayView(this.textCollisionBox.collisionVertexArrayExt.arrayBuffer),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.copyFromArrayView(this.iconCollisionBox.collisionVertexArrayExt.arrayBuffer)}_deserializeCollisionBoxesForSymbol(e,t,r,n,i,o,s,a,u){const c={};if(t<r){const{x1:r,y1:n,x2:i,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:u,projectedAnchorZ:l,tileAnchorX:h,tileAnchorY:p,featureIndex:d,ecefX:f,ecefY:A,ecefZ:g}=e.get(t);c.textBox={x1:r,y1:n,x2:i,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:u,projectedAnchorZ:l,tileAnchorX:h,tileAnchorY:p,ecefX:f,ecefY:A,ecefZ:g},c.textFeatureIndex=d}if(n<i){const{x1:t,y1:r,x2:i,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:u,projectedAnchorZ:l,tileAnchorX:h,tileAnchorY:p,featureIndex:d,ecefX:f,ecefY:A,ecefZ:g}=e.get(n);c.verticalTextBox={x1:t,y1:r,x2:i,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:u,projectedAnchorZ:l,tileAnchorX:h,tileAnchorY:p,ecefX:f,ecefY:A,ecefZ:g},c.verticalTextFeatureIndex=d}if(o<s){const{x1:t,y1:r,x2:n,y2:i,padding:s,projectedAnchorX:a,projectedAnchorY:u,projectedAnchorZ:l,tileAnchorX:h,tileAnchorY:p,featureIndex:d,ecefX:f,ecefY:A,ecefZ:g}=e.get(o);c.iconBox={x1:t,y1:r,x2:n,y2:i,padding:s,projectedAnchorX:a,projectedAnchorY:u,projectedAnchorZ:l,tileAnchorX:h,tileAnchorY:p,ecefX:f,ecefY:A,ecefZ:g},c.iconFeatureIndex=d}if(a<u){const{x1:t,y1:r,x2:n,y2:i,padding:o,projectedAnchorX:s,projectedAnchorY:u,projectedAnchorZ:l,tileAnchorX:h,tileAnchorY:p,featureIndex:d,ecefX:f,ecefY:A,ecefZ:g}=e.get(a);c.verticalIconBox={x1:t,y1:r,x2:n,y2:i,padding:o,projectedAnchorX:s,projectedAnchorY:u,projectedAnchorZ:l,tileAnchorX:h,tileAnchorY:p,ecefX:f,ecefY:A,ecefZ:g},c.verticalIconFeatureIndex=d}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const r=e.placedSymbolArray.get(t),n=r.vertexStartIndex+4*r.numGlyphs;for(let t=r.vertexStartIndex;t<n;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),r=Math.cos(e),n=[],i=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);const s=this.symbolInstances.get(e);n.push(0|Math.round(t*s.tileAnchorX+r*s.tileAnchorY)),i.push(s.featureIndex)}return o.sort(((e,t)=>n[e]-n[t]||i[t]-i[e])),o}addToSortKeyRanges(e,t){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:n,leftJustifiedTextSymbolIndex:i,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=t;r>=0&&this.addIndicesForPlacedSymbol(this.text,r),n>=0&&n!==r&&this.addIndicesForPlacedSymbol(this.text,n),i>=0&&i!==n&&i!==r&&this.addIndicesForPlacedSymbol(this.text,i),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.copyFromArrayView(this.text.indexArray.arrayBuffer),this.icon.indexBuffer&&this.icon.indexBuffer.copyFromArrayView(this.icon.indexArray.arrayBuffer)}}static addDynamicAttributes(e,t,r,n,i,o,s,a,u,c,l){e.emplaceBack(t,r,n,i,o,s,a,u,c,l),e.emplaceBack(t,r,n,i,o,s,a,u,c,l),e.emplaceBack(t,r,n,i,o,s,a,u,c,l),e.emplaceBack(t,r,n,i,o,s,a,u,c,l)}}Ml(oR,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]});const sR=new Zl({"symbol-placement":new Wl(Ud.layout_symbol["symbol-placement"]),"symbol-spacing":new Wl(Ud.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Wl(Ud.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kl(Ud.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Wl(Ud.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Wl(Ud.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Wl(Ud.layout_symbol["icon-ignore-placement"]),"icon-optional":new Wl(Ud.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Wl(Ud.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kl(Ud.layout_symbol["icon-size"]),"icon-text-fit":new Wl(Ud.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Wl(Ud.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kl(Ud.layout_symbol["icon-image"]),"icon-rotate":new Kl(Ud.layout_symbol["icon-rotate"]),"icon-padding":new Wl(Ud.layout_symbol["icon-padding"]),"icon-keep-upright":new Wl(Ud.layout_symbol["icon-keep-upright"]),"icon-offset":new Kl(Ud.layout_symbol["icon-offset"]),"icon-anchor":new Kl(Ud.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Wl(Ud.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Wl(Ud.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Wl(Ud.layout_symbol["text-rotation-alignment"]),"text-field":new Kl(Ud.layout_symbol["text-field"]),"text-font":new Kl(Ud.layout_symbol["text-font"]),"text-size":new Kl(Ud.layout_symbol["text-size"]),"text-max-width":new Kl(Ud.layout_symbol["text-max-width"]),"text-line-height":new Kl(Ud.layout_symbol["text-line-height"]),"text-letter-spacing":new Kl(Ud.layout_symbol["text-letter-spacing"]),"text-justify":new Kl(Ud.layout_symbol["text-justify"]),"text-radial-offset":new Kl(Ud.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Wl(Ud.layout_symbol["text-variable-anchor"]),"text-anchor":new Kl(Ud.layout_symbol["text-anchor"]),"text-max-angle":new Wl(Ud.layout_symbol["text-max-angle"]),"text-writing-mode":new Wl(Ud.layout_symbol["text-writing-mode"]),"text-rotate":new Kl(Ud.layout_symbol["text-rotate"]),"text-padding":new Wl(Ud.layout_symbol["text-padding"]),"text-keep-upright":new Wl(Ud.layout_symbol["text-keep-upright"]),"text-transform":new Kl(Ud.layout_symbol["text-transform"]),"text-offset":new Kl(Ud.layout_symbol["text-offset"]),"text-allow-overlap":new Wl(Ud.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Wl(Ud.layout_symbol["text-ignore-placement"]),"text-optional":new Wl(Ud.layout_symbol["text-optional"]),"ignore-line-rotation":new Wl(Ud.layout_symbol["ignore-line-rotation"])});var aR={paint:new Zl({"icon-opacity":new Kl(Ud.paint_symbol["icon-opacity"]),"icon-color":new Kl(Ud.paint_symbol["icon-color"]),"icon-halo-color":new Kl(Ud.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kl(Ud.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kl(Ud.paint_symbol["icon-halo-blur"]),"icon-translate":new Wl(Ud.paint_symbol["icon-translate"]),"icon-translate-anchor":new Wl(Ud.paint_symbol["icon-translate-anchor"]),"text-opacity":new Kl(Ud.paint_symbol["text-opacity"]),"text-color":new Kl(Ud.paint_symbol["text-color"],{runtimeType:y,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Kl(Ud.paint_symbol["text-halo-color"]),"text-halo-width":new Kl(Ud.paint_symbol["text-halo-width"]),"text-halo-blur":new Kl(Ud.paint_symbol["text-halo-blur"]),"text-translate":new Wl(Ud.paint_symbol["text-translate"]),"text-translate-anchor":new Wl(Ud.paint_symbol["text-translate-anchor"])}),layout:sR};class uR{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:d,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){if(!this.defaultValue.isConstant()){e(this.defaultValue.value._styleExpression.expression)}}outputDefined(){return!1}serialize(){return null}}Ml(uR,"FormatSectionOverride",{omit:["defaultValue"]});class cR extends $d{constructor(e){super(e,aR)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const e=[];for(const t of r)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else"point"===this.layout.get("symbol-placement")?this.layout._values["text-writing-mode"]=["horizontal"]:this.layout._values["text-writing-mode"]=["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,r,n){const i=this.layout.get(e).evaluate(t,{},r,n),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Pt(o.value)||!i?i:function(e,t){return t.replace(/{([^{}]+)}/g,((t,r)=>r in e?String(e[r]):""))}(t.properties,i)}createBucket(e){return new oR(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of aR.paint.overridableProperties){if(!cR.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),r=new uR(t),n=new Ft(r,t.property.specification);let i=null;i="constant"===t.value.kind||"source"===t.value.kind?new Lt("source",n):new Ut("composite",n,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Yl(t.property,i,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&cR.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const r=e.get("text-field"),n=aR.paint.properties[t];let i=!1;const o=e=>{for(const t of e)if(n.overrides&&n.overrides.hasOverride(t))return void(i=!0)};if("constant"===r.value.kind&&r.value.value instanceof P)o(r.value.value.sections);else if("source"===r.value.kind){const e=t=>{if(!i)if(t instanceof k&&G(t.value)===I){const e=t.value;o(e.sections)}else t instanceof V?o(t.sections):t.eachChild(e)},t=r.value;t._styleExpression&&e(t._styleExpression.expression)}return i}getProgramConfiguration(e){return new Sd(this,e)}}var lR={paint:new Zl({"background-color":new Wl(Ud.paint_background["background-color"]),"background-pattern":new Wl(Ud.paint_background["background-pattern"]),"background-opacity":new Wl(Ud.paint_background["background-opacity"])})};var hR={paint:new Zl({"raster-opacity":new Wl(Ud.paint_raster["raster-opacity"]),"raster-hue-rotate":new Wl(Ud.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Wl(Ud.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Wl(Ud.paint_raster["raster-brightness-max"]),"raster-saturation":new Wl(Ud.paint_raster["raster-saturation"]),"raster-contrast":new Wl(Ud.paint_raster["raster-contrast"]),"raster-resampling":new Wl(Ud.paint_raster["raster-resampling"]),"raster-fade-duration":new Wl(Ud.paint_raster["raster-fade-duration"])})};class pR extends $d{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const dR={circle:class extends $d{constructor(e){super(e,wf)}createBucket(e){return new pf(e)}queryRadius(e){const t=e;return If("circle-radius",this,t)+If("circle-stroke-width",this,t)+Tf(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,n,i,o,s,a){const u=Rf(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return v_(e,n,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),u,c)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new Sd(this,e)}},heatmap:class extends $d{createBucket(e){return new HeatmapBucket(e)}constructor(e){super(e,S_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){const e=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=N_({expression:e,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return If("heatmap-radius",this,e)}queryIntersectsFeature(e,t,r,n,i,o,s,a){const u=this.paint.get("heatmap-radius").evaluate(t,r);return v_(e,n,o,s,0,!0,!0,new zt(0,0),u)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new Sd(this,e)}},fill:class extends $d{constructor(e){super(e,W_)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(e){return new Sd(this,e)}recalculate(e,t){super.recalculate(e,t);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Y_(e)}queryRadius(){return Tf(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,n,i,o){if(e.queryGeometry.isAboveHorizon)return!1;return Af(vf(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends $d{constructor(e){super(e,dm)}createBucket(e){return new om(e)}queryRadius(){return Tf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new Sd(this,e)}queryIntersectsFeature(e,t,r,n,i,o,s,a,u){const c=Rf(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),l=this.paint.get("fill-extrusion-height").evaluate(t,r),h=this.paint.get("fill-extrusion-base").evaluate(t,r),[p,d]=function(e,t,r,n,i){const o=[],s=[],a=i[8]*t,u=i[9]*t,c=i[10]*t,l=i[11]*t,h=i[8]*r,p=i[9]*r,d=i[10]*r,f=i[11]*r;for(const t of e){const e=[],r=[];for(const o of t){const t=o.x+n.x,s=o.y+n.y,A=i[0]*t+i[4]*s+i[12],g=i[1]*t+i[5]*s+i[13],_=i[2]*t+i[6]*s+i[14],m=i[3]*t+i[7]*s+i[15],y=A+a,E=g+u,x=_+c,C=Math.max(m+l,1e-5),b=A+h,I=g+p,T=_+d,v=Math.max(m+f,1e-5);e.push(new fm(y/C,E/C,x/C)),r.push(new fm(b/v,I/v,T/v))}o.push(e),s.push(r)}return[o,s]}(n,h,l,c,s),f=e.queryGeometry;return function(e,t,r){let n=1/0;Af(r,t)&&(n=gm(r,t[0]));for(let i=0;i<t.length;i++){const o=t[i],s=e[i];for(let e=0;e<o.length-1;e++){const t=o[e],i=o[e+1],a=s[e],u=[t,i,s[e+1],a,t];df(r,u)&&(n=Math.min(n,gm(r,u)))}}return n!==1/0&&n}(p,d,f.isPointQuery()?f.screenBounds:f.screenGeometry)}},line:class extends $d{constructor(e){super(e,bm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Re,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Im.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new xm(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new Sd(this,e)}queryRadius(e){const t=e,r=Tm(If("line-width",this,t),If("line-gap-width",this,t)),n=If("line-offset",this,t);return r/2+Math.abs(n)+Tf(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,n,i,o){if(e.queryGeometry.isAboveHorizon)return!1;const s=vf(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*Tm(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),u=this.paint.get("line-offset").evaluate(t,r);return u&&(n=function(e,t){const r=[],n=new zt(0,0);for(let i=0;i<e.length;i++){const o=e[i],s=[];for(let e=0;e<o.length;e++){const r=o[e-1],i=o[e],a=o[e+1],u=0===e?n:i.sub(r)._unit()._perp(),c=e===o.length-1?n:a.sub(i)._unit()._perp(),l=u._add(c)._unit(),h=l.x*c.x+l.y*c.y;l._mult(1/h),s.push(l._mult(t)._add(i))}r.push(s)}return r}(n,u*e.pixelToTileUnitsFactor)),function(e,t,r){for(let n=0;n<t.length;n++){const i=t[n];if(e.length>=3)for(let t=0;t<i.length;t++)if(Cf(e,i[t]))return!0;if(gf(e,i,r))return!0}return!1}(s,n,a)}isTileClipped(){return!0}},symbol:cR,background:class extends $d{constructor(e){super(e,lR)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends $d{constructor(e){super(e,hR)}getProgramIds(){return["raster"]}}};function fR(e){return"custom"===e.type?new pR(e):new dR[e.type](e)}var AR=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function gR(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const r of e)t+=`${gR(r)},`;return`${t}]`}let t="{";for(const r of Object.keys(e).sort())t+=`${r}:${gR(e[r])},`;return`${t}}`}function _R(e){let t="";for(const r of AR)t+=`/${gR(e[r])}`;return t}class mR{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(e,t){for(const t of e){this._layerConfigs[t.id]=t;(this._layers[t.id]=fR(t)).compileFilter(),this.keyCache[t.id]&&delete this.keyCache[t.id]}for(const e of t)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const r=function(e,t){const r={};for(let n=0;n<e.length;n++){const i=t&&t[e[n].id]||_R(e[n]);t&&(t[e[n].id]=i);let o=r[i];o||(o=r[i]=[]),o.push(e[n])}const n=[];for(const e in r)n.push(r[e]);return n}(al(this._layerConfigs),this.keyCache);for(const e of r){const t=e.map((e=>this._layers[e.id])),r=t[0];if("none"===r.visibility)continue;const n=r.source||"";let i=this.familiesBySource[n];i||(i=this.familiesBySource[n]={});const o=r.sourceLayer||"_geojsonTileLayer";let s=i[o];s||(s=i[o]=[]),s.push(t)}}}function yR(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(ER,this,t)}function ER(e,t,r){1==e?t.id=r.readVarint():2==e?function(e,t){var r=e.readVarint()+e.pos;for(;e.pos<r;){var n=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[n]=i}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function xR(e){for(var t,r,n=0,i=0,o=e.length,s=o-1;i<o;s=i++)t=e[i],n+=((r=e[s]).x-t.x)*(t.y+r.y);return n}function CR(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(bR,this,t),this.length=this._features.length}function bR(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){var t=null,r=e.readVarint()+e.pos;for(;e.pos<r;){var n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}return t}(r))}function IR(e,t){this.layers=e.readFields(TR,{},t)}function TR(e,t,r){if(3===e){var n=new CR(r,r.readVarint()+r.pos);n.length&&(t[n.name]=n)}}yR.types=["Unknown","Point","LineString","Polygon"],yR.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,n=1,i=0,o=0,s=0,a=[];e.pos<r;){if(i<=0){var u=e.readVarint();n=7&u,i=u>>3}i--,1===n||2===n?(o+=e.readSVarint(),s+=e.readSVarint(),1===n&&(t&&a.push(t),t=[]),t.push(new zt(o,s))):7===n?t&&t.push(t[0].clone()):console.log("VectorTileFeature loadGeometry unknown command "+n)}return t&&a.push(t),a},yR.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,i=0,o=0,s=1/0,a=-1/0,u=1/0,c=-1/0;e.pos<t;){if(n<=0){var l=e.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)(i+=e.readSVarint())<s&&(s=i),i>a&&(a=i),(o+=e.readSVarint())<u&&(u=o),o>c&&(c=o);else if(7!==r)throw new Error("unknown command "+r)}return[s,u,a,c]},yR.prototype.toGeoJSON=function(e,t,r){var n,i,o=this.extent*Math.pow(2,r),s=this.extent*e,a=this.extent*t,u=this.loadGeometry(),c=yR.types[this.type];function l(e){for(var t=0;t<e.length;t++){var r=e[t],n=180-360*(r.y+a)/o;e[t]=[360*(r.x+s)/o-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<u.length;n++)h[n]=u[n][0];l(u=h);break;case 2:for(n=0;n<u.length;n++)l(u[n]);break;case 3:for(u=function(e){var t=e.length;if(t<=1)return[e];for(var r,n,i=[],o=0;o<t;o++){var s=xR(e[o]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(r&&i.push(r),r=[e[o]]):r.push(e[o]))}r&&i.push(r);return i}(u),n=0;n<u.length;n++)for(i=0;i<u[n].length;i++)l(u[n][i])}1===u.length?u=u[0]:c="Multi"+c;var p={type:"Feature",geometry:{type:c,coordinates:u},properties:this.properties};return"id"in this&&(p.id=this.id),p},CR.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new yR(this._pbf,t,this.extent,this._keys,this._values)};class vR{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const RR=["tile","layer","source","sourceLayer","state"];class MR{constructor(e,t,r,n,i){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=r,this._y=n,this.properties=e.properties,this.id=i}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of RR)void 0!==this[t]&&(e[t]=this[t]);return e}}var wR,SR={DONT_CARE:Lc.DONT_CARE,FASTEST:Lc.FASTEST,NICEST:Lc.NICEST,validate:function(e){return e===SR.DONT_CARE||e===SR.FASTEST||e===SR.NICEST}},BR=Object.freeze(SR);function OR(e){e=Yt(e,Yt.EMPTY_OBJECT);var t=Yt(e.wrapS,Lp.CLAMP_TO_EDGE),r=Yt(e.wrapT,Lp.CLAMP_TO_EDGE),n=Yt(e.wrapR,Lp.CLAMP_TO_EDGE),i=Yt(e.minificationFilter,kp.LINEAR),o=Yt(e.magnificationFilter,Gp.LINEAR),s=jt(e.maximumAnisotropy)?e.maximumAnisotropy:1;if(!Lp.validate(t))throw new Ht("Invalid sampler.wrapS.");if(!Lp.validate(r))throw new Ht("Invalid sampler.wrapT.");if(!Lp.validate(n))throw new Ht("Invalid sampler.wrapR.");if(!kp.validate(i))throw new Ht("Invalid sampler.minificationFilter.");if(!Gp.validate(o))throw new Ht("Invalid sampler.magnificationFilter.");qt.typeOf.number.greaterThanOrEquals("maximumAnisotropy",s,1),this._wrapS=t,this._wrapT=r,this._wrapR=n,this._minificationFilter=i,this._magnificationFilter=o,this._maximumAnisotropy=s,this._comparisonFunction=e.comparisonFunction}function DR(e,t,r,n){var i=e._gl;if(r.is3D||r.is2DArray){const e=n||0,o=0;i.framebufferTextureLayer(i.FRAMEBUFFER,t,r._inner._texture,o,e)}else i.framebufferTexture2D(i.FRAMEBUFFER,t,r._target,r._texture,0)}function FR(e,t,r){var n=e._gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,t,n.RENDERBUFFER,r._getRenderbuffer())}function PR(e){var t=(e=Yt(e,Yt.EMPTY_OBJECT)).context;qt.defined("options.context",t);var r=t._gl,n=Sp.maximumColorAttachments;if(this._context=t,this._gl=r,this._framebuffer=r.createFramebuffer(),this._colorTextures=[],this._colorRenderbuffers=[],this._activeColorAttachments=[],this._depthTexture=void 0,this._depthRenderbuffer=void 0,this._stencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this.destroyAttachments=Yt(e.destroyAttachments,!0),jt(e.colorTextures)&&jt(e.colorRenderbuffers))throw new Ht("Cannot have both color texture and color renderbuffer attachments.");if(jt(e.depthTexture)&&jt(e.depthRenderbuffer))throw new Ht("Cannot have both a depth texture and depth renderbuffer attachment.");if(jt(e.depthStencilTexture)&&jt(e.depthStencilRenderbuffer))throw new Ht("Cannot have both a depth-stencil texture and depth-stencil renderbuffer attachment.");var i,o,s,a,u,c=jt(e.depthTexture)||jt(e.depthRenderbuffer),l=jt(e.depthStencilTexture)||jt(e.depthStencilRenderbuffer);if(c&&l)throw new Ht("Cannot have both a depth and depth-stencil attachment.");if(jt(e.stencilRenderbuffer)&&l)throw new Ht("Cannot have both a stencil and depth-stencil attachment.");if(c&&jt(e.stencilRenderbuffer))throw new Ht("Cannot have both a depth and stencil attachment.");if(this._bind(),jt(e.colorTextures)){var h=e.colorTextures;if((a=this._colorTextures.length=this._activeColorAttachments.length=h.length)>n)throw new Ht("The number of color attachments exceeds the number supported.");if(jt(e.colorTextureActiveLayers)&&e.colorTextureActiveLayers.length!=a)throw new Ht("length of colorTextureActiveLayers must be equal to colorTextures.");for(s=0;s<a;++s){if(i=h[s],!Pp.isColorFormat(i.pixelFormat))throw new Ht("The color-texture pixel-format must be a color format.");if(i.pixelDatatype===Dp.FLOAT&&!t.colorBufferFloat)throw new Ht("The color texture pixel datatype is FLOAT and the WebGL implementation does not support the EXT_color_buffer_float or WEBGL_color_buffer_float extensions. See Context.colorBufferFloat.");if(i.pixelDatatype===Dp.HALF_FLOAT&&!t.colorBufferHalfFloat)throw new Ht("The color texture pixel datatype is HALF_FLOAT and the WebGL implementation does not support the EXT_color_buffer_half_float extension. See Context.colorBufferHalfFloat.");var p=0;jt(e.colorTextureActiveLayers)&&(p=e.colorTextureActiveLayers[s]),DR(this,u=this._gl.COLOR_ATTACHMENT0+s,i,p),this._activeColorAttachments[s]=u,this._colorTextures[s]=i}}if(jt(e.colorRenderbuffers)){var d=e.colorRenderbuffers;if((a=this._colorRenderbuffers.length=this._activeColorAttachments.length=d.length)>n)throw new Ht("The number of color attachments exceeds the number supported.");for(s=0;s<a;++s)o=d[s],FR(this,u=this._gl.COLOR_ATTACHMENT0+s,o),this._activeColorAttachments[s]=u,this._colorRenderbuffers[s]=o}if(jt(e.depthTexture)){if((i=e.depthTexture).pixelFormat!==Pp.DEPTH_COMPONENT&&i.pixelFormat!==Pp.DEPTH_COMPONENT16&&i.pixelFormat!==Pp.DEPTH_COMPONENT32F)throw new Ht("The depth-texture pixel-format must be DEPTH_COMPONENT.");DR(this,this._gl.DEPTH_ATTACHMENT,i,0),this._depthTexture=i}if(jt(e.depthRenderbuffer)&&(o=e.depthRenderbuffer,FR(this,this._gl.DEPTH_ATTACHMENT,o),this._depthRenderbuffer=o),jt(e.stencilRenderbuffer)&&(o=e.stencilRenderbuffer,FR(this,this._gl.STENCIL_ATTACHMENT,o),this._stencilRenderbuffer=o),jt(e.depthStencilTexture)){if((i=e.depthStencilTexture).pixelFormat!==Pp.DEPTH_STENCIL)throw new Ht("The depth-stencil pixel-format must be DEPTH_STENCIL.");DR(this,this._gl.DEPTH_STENCIL_ATTACHMENT,i,0),this._depthStencilTexture=i}jt(e.depthStencilRenderbuffer)&&(o=e.depthStencilRenderbuffer,FR(this,this._gl.DEPTH_STENCIL_ATTACHMENT,o),this._depthStencilRenderbuffer=o),this._unBind()}function NR(e,t,r,n){void 0===t&&(t=!1),this.initialize(e,t,r,n)}function LR(e,t,r){void 0===r&&(r=null),this.callback=e,this.mask=t,this.scope=r,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1}function UR(e){this._observers=new Array,this._eventState=new NR(0),e&&(this._onObserverAdded=e)}function GR(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}Object.defineProperties(OR.prototype,{wrapS:{get:function(){return this._wrapS}},wrapT:{get:function(){return this._wrapT}},wrapR:{get:function(){return this._wrapR}},minificationFilter:{get:function(){return this._minificationFilter}},magnificationFilter:{get:function(){return this._magnificationFilter}},maximumAnisotropy:{get:function(){return this._maximumAnisotropy}},comparisonFunction:{get:function(){return this._comparisonFunction}}}),OR.equals=function(e,t){return e===t||jt(e)&&jt(t)&&e._wrapS===t._wrapS&&e._wrapT===t._wrapT&&e._wrapR===t._wrapR&&e._minificationFilter===t._minificationFilter&&e._magnificationFilter===t._magnificationFilter&&e._maximumAnisotropy===t._maximumAnisotropy},Object.defineProperties(PR.prototype,{status:{get:function(){this._bind();var e=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);return this._unBind(),e}},numberOfColorAttachments:{get:function(){return this._activeColorAttachments.length}},depthTexture:{get:function(){return this._depthTexture}},depthRenderbuffer:{get:function(){return this._depthRenderbuffer}},stencilRenderbuffer:{get:function(){return this._stencilRenderbuffer}},depthStencilTexture:{get:function(){return this._depthStencilTexture}},depthStencilRenderbuffer:{get:function(){return this._depthStencilRenderbuffer}},hasDepthAttachment:{get:function(){return!!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}}}),PR.prototype._bind=function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer)},PR.prototype._unBind=function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,null)},PR.prototype._attachTexture=function(e,t){if(1==this.destroyAttachments)throw new Ht("destroyAttachments must be false");var r=this._gl;r.framebufferTexture2D(r.FRAMEBUFFER,e,t._target,t._texture,0)},PR.prototype._getActiveColorAttachments=function(){return this._activeColorAttachments},PR.prototype.getColorTexture=function(e){if(!jt(e)||e<0||e>=this._colorTextures.length)throw new Ht("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorTextures[e]},PR.prototype.getColorRenderbuffer=function(e){if(!jt(e)||e<0||e>=this._colorRenderbuffers.length)throw new Ht("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorRenderbuffers[e]},PR.prototype.isDestroyed=function(){return!1},PR.prototype.destroy=function(){if(this.destroyAttachments){for(var e=0,t=this._colorTextures,r=t.length;e<r;++e){var n=t[e];jt(n)&&n.destroy()}var i=this._colorRenderbuffers;for(r=i.length,e=0;e<r;++e){var o=i[e];jt(o)&&o.destroy()}this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy(),this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()}return!this._context._contextWasLost&&this._gl.deleteFramebuffer(this._framebuffer),op(this)},PR.blitFramebuffers=function(e,t,r,n,i,o){if(e.webgl2){var s=e._gl,a=0;if(r.numberOfColorAttachments>0&&(a|=s.COLOR_BUFFER_BIT),(jt(r.depthStencilTexture)||jt(r.depthTexture))&&(a|=s.DEPTH_BUFFER_BIT|(o?s.STENCIL_BUFFER_BIT:0)),0!=a){s.bindFramebuffer(s.READ_FRAMEBUFFER,t._inner._framebuffer),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,r._inner._framebuffer);var u=r.getColorTexture(0),c=u.width,l=u.height;s.blitFramebuffer(0,0,c,l,0,0,c,l,a,s.NEAREST),s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null)}}},NR.prototype.initialize=function(e,t,r,n){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=r,this.currentTarget=n,this},UR.FromPromise=function(e,t){var r=new UR;return e.then((function(e){r.notifyObservers(e)})).catch((function(e){if(!t)throw e;t.notifyObservers(e)})),r},Object.defineProperty(UR.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),UR.prototype.add=function(e,t,r,n,i){if(void 0===t&&(t=-1),void 0===r&&(r=!1),void 0===n&&(n=null),void 0===i&&(i=!1),!e)return null;var o=new LR(e,t,n);return o.unregisterOnNextCall=i,r?this._observers.unshift(o):this._observers.push(o),this._onObserverAdded&&this._onObserverAdded(o),o},UR.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},UR.prototype.remove=function(e){return!!e&&(-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0))},UR.prototype.removeCallback=function(e,t){for(var r=0;r<this._observers.length;r++){var n=this._observers[r];if(!n._willBeUnregistered&&(n.callback===e&&(!t||t===n.scope)))return this._deferUnregister(n),!0}return!1},UR.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((function(){t._remove(e)}),0)},UR.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},UR.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},UR.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},UR.prototype.notifyObservers=function(e,t,r,n,i){if(void 0===t&&(t=-1),!this._observers.length)return!0;var o=this._eventState;o.mask=t,o.target=r,o.currentTarget=n,o.skipNextObservers=!1,o.lastReturnValue=e,o.userInfo=i;for(var s=0,a=this._observers;s<a.length;s++){var u=a[s];if(!u._willBeUnregistered&&(u.mask&t&&(u.scope?o.lastReturnValue=u.callback.apply(u.scope,[e,o]):o.lastReturnValue=u.callback(e,o),u.unregisterOnNextCall&&this._deferUnregister(u)),o.skipNextObservers))return!1}return!0},UR.prototype.notifyObserversWithPromise=function(e,t,r,n,i){var o=this;void 0===t&&(t=-1);var s=Promise.resolve(e);if(!this._observers.length)return s;var a=this._eventState;return a.mask=t,a.target=r,a.currentTarget=n,a.skipNextObservers=!1,a.userInfo=i,this._observers.forEach((function(r){a.skipNextObservers||r._willBeUnregistered||r.mask&t&&(s=r.scope?s.then((function(t){return a.lastReturnValue=t,r.callback.apply(r.scope,[e,a])})):s.then((function(t){return a.lastReturnValue=t,r.callback(e,a)})),r.unregisterOnNextCall&&o._deferUnregister(r))})),s.then((function(){return e}))},UR.prototype.notifyObserver=function(e,t,r){if(void 0===r&&(r=-1),!e._willBeUnregistered){var n=this._eventState;n.mask=r,n.skipNextObservers=!1,e.callback(t,n),e.unregisterOnNextCall&&this._deferUnregister(e)}},UR.prototype.hasObservers=function(){return this._observers.length>0},UR.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},UR.prototype.clone=function(){var e=new UR;return e._observers=this._observers.slice(0),e},UR.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,r=this._observers;t<r.length;t++){var n=r[t];if(n.mask&e||n.mask===e)return!0}return!1},Object.defineProperty(GR.prototype,"wrapU",{get:function(){return this._cachedWrapU},set:function(e){this._cachedWrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(GR.prototype,"wrapV",{get:function(){return this._cachedWrapV},set:function(e){this._cachedWrapV=e},enumerable:!1,configurable:!0}),Object.defineProperty(GR.prototype,"wrapR",{get:function(){return this._cachedWrapR},set:function(e){this._cachedWrapR=e},enumerable:!1,configurable:!0}),Object.defineProperty(GR.prototype,"anisotropicFilteringLevel",{get:function(){return this._cachedAnisotropicFilteringLevel},set:function(e){this._cachedAnisotropicFilteringLevel=e},enumerable:!1,configurable:!0}),Object.defineProperty(GR.prototype,"comparisonFunction",{get:function(){return this._comparisonFunction},set:function(e){this._comparisonFunction=e},enumerable:!1,configurable:!0}),Object.defineProperty(GR.prototype,"useMipMaps",{get:function(){return this._useMipMaps},set:function(e){this._useMipMaps=e},enumerable:!1,configurable:!0}),GR.prototype.setParameters=function(e,t,r,n,i,o){return void 0===e&&(e=cp.TEXTURE_WRAP_ADDRESSMODE),void 0===t&&(t=cp.TEXTURE_WRAP_ADDRESSMODE),void 0===r&&(r=cp.TEXTURE_WRAP_ADDRESSMODE),void 0===n&&(n=1),void 0===i&&(i=cp.TEXTURE_BILINEAR_SAMPLINGMODE),void 0===o&&(o=0),this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=r,this._cachedAnisotropicFilteringLevel=n,this.samplingMode=i,this._comparisonFunction=o,this},GR.prototype.compareSampler=function(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps},function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.DepthStencil=12]="DepthStencil",e[e.CubeRawRGBD=13]="CubeRawRGBD",e[e.Depth=14]="Depth"}(wR||(wR={}));const QR=wR;function kR(e,t,r){void 0===r&&(r=!1);var n=GR.call(this)||this;return n.isReady=!1,n.isCube=!1,n.is3D=!1,n.is2DArray=!1,n.isMultiview=!1,n.url="",n.generateMipMaps=!1,n.samples=0,n.type=-1,n.format=-1,n.onLoadedObservable=new UR,n.onErrorObservable=new UR,n.onRebuildCallback=null,n.width=0,n.height=0,n.depth=0,n.baseWidth=0,n.baseHeight=0,n.baseDepth=0,n.invertY=!1,n._invertVScale=!1,n._associatedChannel=-1,n._source=QR.Unknown,n._buffer=null,n._bufferView=null,n._bufferViewArray=null,n._bufferViewArrayArray=null,n._size=0,n._extension="",n._files=null,n._workingCanvas=null,n._workingContext=null,n._cachedCoordinatesMode=null,n._isDisabled=!1,n._compression=null,n._sphericalPolynomial=null,n._sphericalPolynomialPromise=null,n._sphericalPolynomialComputed=!1,n._lodGenerationScale=0,n._lodGenerationOffset=0,n._useSRGBBuffer=!1,n._lodTextureHigh=null,n._lodTextureMid=null,n._lodTextureLow=null,n._isRGBD=!1,n._linearSpecularLOD=!1,n._irradianceTexture=null,n._hardwareTexture=null,n._maxLodLevel=null,n._references=1,n._gammaSpace=null,n._engine=e,n._source=t,n._uniqueId=kR._Counter++,r||(n._hardwareTexture=e._createHardwareTexture()),n}function zR(e,t,r,n){this._textures=null,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=e,this._isCube=t,this._size=r,this._engine=n,this._depthStencilTexture=null}function jR(e){var t=(e=Yt(e,Yt.EMPTY_OBJECT)).context,r=e.width,n=e.height,i=Yt(e.depth,0);Yt(e.mipmapLevels,0);var o=e.source,s=Yt(e.is3D,!0);this._is3D=s;var a=Yt(e.pixelFormat,Pp.RGBA),u=Yt(e.pixelDatatype,Dp.UNSIGNED_BYTE),c=Pp.toInternalFormat(a,u,t),l=Pp.isCompressedFormat(c);if(!jt(r)||!jt(n))throw new Ht("options requires a source field to create an initialized texture or width and height fields to create a blank texture.");if(qt.typeOf.number.greaterThan("width",r,0),r>Sp.maximumTextureSize)throw new Ht("Width must be less than or equal to the maximum texture size ("+Sp.maximumTextureSize+").  Check maximumTextureSize.");if(qt.typeOf.number.greaterThan("height",n,0),n>Sp.maximumTextureSize)throw new Ht("Height must be less than or equal to the maximum texture size ("+Sp.maximumTextureSize+").  Check maximumTextureSize.");if(!Pp.validate(a))throw new Ht("Invalid options.pixelFormat.");if(!l&&!Dp.validate(u))throw new Ht("Invalid options.pixelDatatype.");if(a===Pp.DEPTH_COMPONENT&&u!==Dp.UNSIGNED_SHORT&&u!==Dp.UNSIGNED_INT)throw new Ht("When options.pixelFormat is DEPTH_COMPONENT, options.pixelDatatype must be UNSIGNED_SHORT or UNSIGNED_INT.");if(a===Pp.DEPTH_STENCIL&&u!==Dp.UNSIGNED_INT_24_8)throw new Ht("When options.pixelFormat is DEPTH_STENCIL, options.pixelDatatype must be UNSIGNED_INT_24_8.");if(u===Dp.FLOAT&&!t.floatingPointTexture)throw new Ht("When options.pixelDatatype is FLOAT, this WebGL implementation must support the OES_texture_float extension.  Check context.floatingPointTexture.");if(u===Dp.HALF_FLOAT&&!t.halfFloatingPointTexture)throw new Ht("When options.pixelDatatype is HALF_FLOAT, this WebGL implementation must support the OES_texture_half_float extension. Check context.halfFloatingPointTexture.");if(Pp.isDepthFormat(a)&&!t.depthTexture)throw new Ht("When options.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, this WebGL implementation must support WEBGL_depth_texture.  Check context.depthTexture.");if(l){if(Pp.isDXTFormat(c)&&!t.s3tc)throw new Ht("When options.pixelFormat is S3TC compressed, this WebGL implementation must support the WEBGL_texture_compression_s3tc extension. Check context.s3tc.");if(Pp.isPVRTCFormat(c)&&!t.pvrtc)throw new Ht("When options.pixelFormat is PVRTC compressed, this WebGL implementation must support the WEBGL_texture_compression_pvrtc extension. Check context.pvrtc.");if(Pp.isETC1Format(c)&&!t.etc1)throw new Ht("When options.pixelFormat is ETC1 compressed, this WebGL implementation must support the WEBGL_texture_compression_etc1 extension. Check context.etc1.")}var h,p=e.preMultiplyAlpha||a===Pp.RGB||a===Pp.LUMINANCE,d=Yt(e.flipY,!0),f=t._gl,A=s?f.TEXTURE_3D:f.TEXTURE_2D_ARRAY,g=f.createTexture();f.activeTexture(f.TEXTURE0),f.bindTexture(A,g),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1),jt(o)?jt(o.arrayBufferView):f.texImage3D(A,0,c,r,n,i,0,a,u,null),f.bindTexture(A,null),h=l?Pp.compressedTextureSizeInBytes(a,r,n,i):Pp.textureSizeInBytes(a,u,r,n,i),this._id=Ap(),this._context=t,this._textureFilterAnisotropic=t._textureFilterAnisotropic,this._textureTarget=A,this._texture=g,this._pixelFormat=a,this._internalFormat=c,this._pixelDatatype=u,this._width=r,this._height=n,this._depth=i,this._dimensions=new Zt(r,n,i),this._hasMipmap=!1,this._sizeInBytes=h,this._preMultiplyAlpha=p,this._flipY=d,this._sampler=void 0,this.ignoreWEBGL2=!1,this._isCompressed=l,this.sampler=jt(e.sampler)?e.sampler:new OR,t.memorySize+=h,this._ownerName=e.owner,t.memoryAnalyzer.allocateGPUMemory(sp,e.owner,h)}function HR(e,t,r){switch(e){case Pp.RGB_DXT1:case Pp.RGB_ETC1:return(t+3>>2)*(r+3>>2)*8;case Pp.RGBA_DXT5:return(t+3>>2)*(r+3>>2)*16;case Pp.RGB_PVRTC_4BPPV1:case Pp.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(r,8)*4+7)/8);case Pp.RGB_PVRTC_2BPPV1:case Pp.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(r,8)*2+7)/8);case Lc.RGB565:return t*r*2;case Pp.RGBA:return t*r*4;case Pp.LUMINANCE_ALPHA:return t*r*2;default:return 0}}function qR(e,t){this.width=e,this.height=t}function VR(e){this._wrapU=cp.TEXTURE_WRAP_ADDRESSMODE,this._wrapV=cp.TEXTURE_WRAP_ADDRESSMODE,this.wrapR=cp.TEXTURE_WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=4,this.delayLoadState=cp.DELAYLOADSTATE_NONE,this._texture=null,this._engine=null,this._cachedSize=qR.Zero(),this._cachedBaseSize=qR.Zero(),this._initialSamplingMode=cp.TEXTURE_BILINEAR_SAMPLINGMODE,this._texture=e,this._texture&&(this._engine=this._texture.getEngine())}function YR(e){var t=(e=Yt(e,Yt.EMPTY_OBJECT)).context,r=e.width,n=e.height,i=e.depth;e.mipmapLevels,this._is3D=Yt(e.is3D,!0);var o=e.source;this._hasMipmap=Yt(e.generateMipmap,!1);var s=Yt(e.pixelFormat,Pp.RGBA),a=Yt(e.pixelDatatype,Dp.UNSIGNED_BYTE),u=s,c=e.context.engine,l=zp.toPixelFormat(s),h=zp.toPixelType(a);this._sampler=jt(e.sampler)?e.sampler:new OR,this._samples=Yt(e.samples,1);var p,d=zp.toAddressMode(this._sampler.wrapS),f=zp.toAddressMode(this._sampler.wrapT),A=zp.toAddressMode(this._sampler.wrapR),g=zp.toSamplerMode(a,this._sampler),_=Pp.isCompressedFormat(u),m=e.preMultiplyAlpha||s===Pp.RGB||s===Pp.LUMINANCE,y=Yt(e.flipY,!0),E=null;jt(o)||((E=this._is3D?c.createRawTexture3D(null,r,n,i,l,this._hasMipmap,y,g,0,h):c.createRawTexture2DArray(null,r,n,i,l,this._hasMipmap,y,g,0,h)).samples=this._samples,this._texture=new VR(E),E.wrapU=d,E.wrapV=f,E.wrapR=A),p=_?Pp.compressedTextureSizeInBytes(s,r,n,i):Pp.textureSizeInBytes(s,a,r,n,i),this._id=Ap(),this._context=t,this._textureFilterAnisotropic=t._textureFilterAnisotropic,this._textureTarget=null,this._pixelFormat=s,this._internalFormat=u,this._pixelDatatype=a,this._width=r,this._height=n,this._depth=i,this._dimensions=new Zt(r,n,i),this._sizeInBytes=p,this._preMultiplyAlpha=m,this._flipY=y,this._sampler=void 0,this._isCompressed=_,this._renderTargetWrapperRefCount=0,this.sampler=jt(e.sampler)?e.sampler:new OR,t.memorySize+=p,this._ownerName=e.owner,t.memoryAnalyzer.allocateGPUMemory(sp,e.owner,p)}function XR(e){(e=Yt(e,Yt.EMPTY_OBJECT)).context.webgpu?this._inner=new YR(e):this._inner=new jR(e)}GR&&(kR.__proto__=GR),kR.prototype=Object.create(GR&&GR.prototype),kR.prototype.constructor=GR,Object.defineProperty(kR.prototype,"useMipMaps",{get:function(){return this._useMipMaps},set:function(e){this._useMipMaps=e},enumerable:!1,configurable:!0}),Object.defineProperty(kR.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),kR.prototype.getEngine=function(){return this._engine},Object.defineProperty(kR.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),kR.prototype.incrementReferences=function(){this._references++},kR.prototype.updateSize=function(e,t,r){void 0===r&&(r=1),this._engine.updateTextureDimensions(this,e,t,r),this.width=e,this.height=t,this.depth=r,this.baseWidth=e,this.baseHeight=t,this.baseDepth=r,this._size=e*t*r},kR.prototype._rebuild=function(){var e,t=this;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){var r=this.onRebuildCallback(this),n=function(e){e._swapAndDie(t,!1),t.isReady=r.isReady};r.isAsync?r.proxy.then(n):n(r.proxy)}else{var i;switch(this.source){case QR.Temp:break;case QR.Url:return void(i=this._engine.createTexture(null!==(e=this._originalUrl)&&void 0!==e?e:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){i._swapAndDie(t,!1),t.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case QR.Raw:(i=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,void 0,this._useSRGBBuffer))._swapAndDie(this,!1),this.isReady=!0;break;case QR.Raw3D:(i=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case QR.Raw2DArray:(i=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case QR.Dynamic:(i=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this,!1),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);break;case QR.Cube:return void(i=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){i._swapAndDie(t,!1),t.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer));case QR.CubeRaw:(i=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this,!1),this.isReady=!0;break;case QR.CubeRawRGBD:return;case QR.CubePrefiltered:return void((i=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(e){e&&e._swapAndDie(t,!1),t.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}}},kR.prototype._swapAndDie=function(e,t){var r;void 0===t&&(t=!0),null===(r=this._hardwareTexture)||void 0===r||r.setUsage(e._source,this.generateMipMaps,this.isCube,this.width,this.height),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var n=this._engine.getLoadedTexturesCache(),i=n.indexOf(this);-1!==i&&n.splice(i,1),-1===(i=n.indexOf(e))&&n.push(e)},kR.prototype.dispose=function(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null)},kR._Counter=0,Object.defineProperty(zR.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!1,configurable:!0}),Object.defineProperty(zR.prototype,"depthStencilTextureWithStencil",{get:function(){return this._depthStencilTextureWithStencil},enumerable:!1,configurable:!0}),Object.defineProperty(zR.prototype,"isCube",{get:function(){return this._isCube},enumerable:!1,configurable:!0}),Object.defineProperty(zR.prototype,"isMulti",{get:function(){return this._isMulti},enumerable:!1,configurable:!0}),Object.defineProperty(zR.prototype,"is2DArray",{get:function(){return this.layers>0},enumerable:!1,configurable:!0}),Object.defineProperty(zR.prototype,"size",{get:function(){return this.width},enumerable:!1,configurable:!0}),Object.defineProperty(zR.prototype,"width",{get:function(){return this._size.width||this._size},enumerable:!1,configurable:!0}),Object.defineProperty(zR.prototype,"height",{get:function(){return this._size.height||this._size},enumerable:!1,configurable:!0}),Object.defineProperty(zR.prototype,"layers",{get:function(){return this._size.layers||0},enumerable:!1,configurable:!0}),Object.defineProperty(zR.prototype,"texture",{get:function(){var e,t;return null!==(t=null===(e=this._textures)||void 0===e?void 0:e[0])&&void 0!==t?t:null},enumerable:!1,configurable:!0}),Object.defineProperty(zR.prototype,"textures",{get:function(){return this._textures},enumerable:!1,configurable:!0}),Object.defineProperty(zR.prototype,"samples",{get:function(){var e,t;return null!==(t=null===(e=this.texture)||void 0===e?void 0:e.samples)&&void 0!==t?t:1},enumerable:!1,configurable:!0}),zR.prototype.setSamples=function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=!1),this.samples!==e||r?this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,e,t):this._engine.updateRenderTargetTextureSampleCount(this,e):e},zR.prototype.setTextures=function(e){Array.isArray(e)?this._textures=e:this._textures=e?[e]:null},zR.prototype.setTexture=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=!0),this._textures||(this._textures=[]),this._textures[t]&&r&&this._textures[t].dispose(),this._textures[t]=e},zR.prototype.createDepthStencilTexture=function(e,t,r,n,i){var o;return void 0===e&&(e=0),void 0===t&&(t=!0),void 0===r&&(r=!1),void 0===n&&(n=1),void 0===i&&(i=cp.TEXTUREFORMAT_DEPTH32_FLOAT),null===(o=this._depthStencilTexture)||void 0===o||o.dispose(),this._depthStencilTextureWithStencil=r,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:r,isCube:this._isCube,samples:n,depthTextureFormat:i},this),this._depthStencilTexture},zR.prototype._shareDepth=function(e){this._depthStencilTexture&&(e._depthStencilTexture&&e._depthStencilTexture.dispose(),e._depthStencilTexture=this._depthStencilTexture,this._depthStencilTexture.incrementReferences())},zR.prototype._swapAndDie=function(e){this.texture&&this.texture._swapAndDie(e),this._textures=null,this.dispose(!0)},zR.prototype._cloneRenderTargetWrapper=function(){var e,t,r,n,i,o,s=null;if(this._isMulti){var a=this.textures;if(a&&a.length>0){var u=!1,c=a.length,l=a[a.length-1]._source;l!==QR.Depth&&l!==QR.DepthStencil||(u=!0,c--);for(var h=[],p=[],d=0;d<c;++d){var f=a[d];h.push(f.samplingMode),p.push(f.type)}var A={samplingModes:h,generateMipMaps:a[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:u,types:p,textureCount:c},g={width:this.width,height:this.height};s=this._engine.createMultipleRenderTarget(g,A)}}else{var _={};if(_.generateDepthBuffer=this._generateDepthBuffer,_.generateMipMaps=null!==(t=null===(e=this.texture)||void 0===e?void 0:e.generateMipMaps)&&void 0!==t&&t,_.generateStencilBuffer=this._generateStencilBuffer,_.samplingMode=null===(r=this.texture)||void 0===r?void 0:r.samplingMode,_.type=null===(n=this.texture)||void 0===n?void 0:n.type,_.format=null===(i=this.texture)||void 0===i?void 0:i.format,this.isCube)s=this._engine.createRenderTargetCubeTexture(this.width,_);else{g={width:this.width,height:this.height,layers:this.is2DArray?null===(o=this.texture)||void 0===o?void 0:o.depth:void 0};s=this._engine.createRenderTargetTexture(g,_)}s.texture.isReady=!0}return s},zR.prototype._swapRenderTargetWrapper=function(e){if(this._textures&&e._textures)for(var t=0;t<this._textures.length;++t)this._textures[t]._swapAndDie(e._textures[t],!1),e._textures[t].isReady=!0;this._depthStencilTexture&&e._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(e._depthStencilTexture),e._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null},zR.prototype._rebuild=function(){var e=this._cloneRenderTargetWrapper();if(e){if(this._depthStencilTexture){var t=this._depthStencilTexture.samplingMode,r=t===cp.TEXTURE_BILINEAR_SAMPLINGMODE||t===cp.TEXTURE_TRILINEAR_SAMPLINGMODE||t===cp.TEXTURE_LINEAR_LINEAR_MIPNEAREST;e.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,r,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples)}this.samples>1&&e.setSamples(this.samples),e._swapRenderTargetWrapper(this),e.dispose()}},zR.prototype.releaseTextures=function(){var e,t;if(this._textures)for(var r=0;null!==(t=r<(null===(e=this._textures)||void 0===e?void 0:e.length))&&void 0!==t&&t;++r)this._textures[r].dispose();this._textures=null},zR.prototype.dispose=function(e){var t;void 0===e&&(e=!1),e||(null===(t=this._depthStencilTexture)||void 0===t||t.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)},Object.defineProperties(jR.prototype,{id:{set:function(e){this._id=e},get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(e){var t=e.minificationFilter,r=e.magnificationFilter,n=t===kp.NEAREST_MIPMAP_NEAREST||t===kp.NEAREST_MIPMAP_LINEAR||t===kp.LINEAR_MIPMAP_NEAREST||t===kp.LINEAR_MIPMAP_LINEAR,i=this._context,o=this._pixelDatatype;const s=this._pixelFormat;(o===Dp.FLOAT&&!i.textureFloatLinear||o===Dp.HALF_FLOAT&&!i.textureHalfFloatLinear)&&(t=n?kp.NEAREST_MIPMAP_NEAREST:kp.NEAREST,r=Gp.NEAREST),i.webgl2&&Pp.isDepthFormat(s)&&(t=kp.NEAREST,r=Gp.NEAREST);var a=i._gl,u=this._textureTarget;a.activeTexture(a.TEXTURE0),a.bindTexture(u,this._texture),a.texParameteri(u,a.TEXTURE_MIN_FILTER,t),a.texParameteri(u,a.TEXTURE_MAG_FILTER,r),a.texParameteri(u,a.TEXTURE_WRAP_S,e.wrapS),a.texParameteri(u,a.TEXTURE_WRAP_T,e.wrapT),a.texParameteri(u,a.TEXTURE_WRAP_R,e.wrapR),jt(this._textureFilterAnisotropic)&&a.texParameteri(u,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.maximumAnisotropy),a.bindTexture(u,null),this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},depth:{get:function(){return this._depth}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}},is3D:{get:function(){return this._is3D}}}),jR.prototype.copyFromFramebuffer=function(e,t,r,n,i,o,s,a){if(t=Yt(t,0),r=Yt(r,0),n=Yt(n,0),i=Yt(i,0),o=Yt(o,0),s=Yt(s,this._width),a=Yt(a,this._height),Pp.isDepthFormat(this._pixelFormat))throw new Ht("Cannot call copyFromFramebuffer when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(this._pixelDatatype===Dp.FLOAT)throw new Ht("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this._pixelDatatype===Dp.HALF_FLOAT)throw new Ht("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");if(Pp.isCompressedFormat(this._pixelFormat))throw new Ht("Cannot call copyFrom with a compressed texture pixel format.");qt.typeOf.number.greaterThanOrEquals("xOffset",t,0),qt.typeOf.number.greaterThanOrEquals("yOffset",r,0),qt.typeOf.number.greaterThanOrEquals("zOffset",n,0),qt.typeOf.number.greaterThanOrEquals("framebufferXOffset",i,0),qt.typeOf.number.greaterThanOrEquals("framebufferYOffset",o,0),qt.typeOf.number.lessThanOrEquals("xOffset + width",t+s,this._width),qt.typeOf.number.lessThanOrEquals("yOffset + height",r+a,this._height);var u=this._context._gl,c=this._textureTarget;u.activeTexture(u.TEXTURE0),u.bindTexture(c,this._texture),u.copyTexSubImage3D(c,e,t,r,n,i,o,s,a),u.bindTexture(c,null),this._initialized=!0},jR.prototype.copyFromTexture=function(e,t,r,n,i,o,s,a,u){var c=this._context,l=new PM({context:c,colorTextures:[e],destroyAttachments:!1});if(l!==c._currentFramebuffer&&(c._currentFramebuffer=l,jt(l))){l._bind();var h=l._getActiveColorAttachments();c.drawBuffers&&c.glDrawBuffers(h)}this.copyFromFramebuffer(t,r,n,i,o,s,a,u),l.destroy()},jR.prototype.setDataBufferWithMipmap=function(e,t){var r=this._context._gl;r.activeTexture(r.TEXTURE0),r.bindTexture(this._textureTarget,this._texture);var n=this._width,i=this._height,o=function(e,t,r,n){if(!Wt.isPowerOfTwo(r)||!Wt.isPowerOfTwo(n))return!1;for(var i=e.length,o=r,s=n,a=0;a+=Pp.compressedTextureSizeInBytes(t,o,s),s>>=1,0!=(o>>=1)||0!=s;)o=Math.max(o,1),s=Math.max(s,1);return a==i}(t,this._internalFormat,n,i),s=0,a=0;do{var u,c=HR(this._internalFormat,n,i);u=this._internalFormat==Pp.RGBA&&this._pixelDatatype===Dp.FLOAT?new Float32Array(t.buffer,t.byteOffset+s,c):new Uint8Array(t.buffer,t.byteOffset+s,c),this._isCompressed?r.compressedTexSubImage3D(this._textureTarget,a++,0,0,e,n,i,1,this._internalFormat,u):r.texSubImage3D(this._textureTarget,a++,0,0,e,n,i,1,this._internalFormat,this._pixelDatatype,u),n=Math.max(n>>1,1),i=Math.max(i>>1,1),s+=c}while(s<t.length&&o);r.bindTexture(this._textureTarget,null)},jR.prototype.generateMipmap=function(e){if(e=Yt(e,BR.DONT_CARE),this._width>1&&!Wt.isPowerOfTwo(this._width))throw new Ht("width must be a power of two to call generateMipmap().");if(this._height>1&&!Wt.isPowerOfTwo(this._height))throw new Ht("height must be a power of two to call generateMipmap().");var t=this._context._gl,r=this._target;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(r,this._texture),t.generateMipmap(r)},jR.prototype.isDestroyed=function(){return!1},jR.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),this._context.memorySize-=this._sizeInBytes,this._context.memoryAnalyzer.releaseGPUMemory(sp,this._ownerName,this._sizeInBytes),op(this)},qR.prototype.toString=function(){return"{W: ".concat(this.width,", H: ").concat(this.height,"}")},qR.prototype.getClassName=function(){return"Size"},qR.prototype.getHashCode=function(){var e=0|this.width;return e=397*e^this.height},qR.prototype.copyFrom=function(e){this.width=e.width,this.height=e.height},qR.prototype.copyFromFloats=function(e,t){return this.width=e,this.height=t,this},qR.prototype.set=function(e,t){return this.copyFromFloats(e,t)},qR.prototype.multiplyByFloats=function(e,t){return new qR(this.width*e,this.height*t)},qR.prototype.clone=function(){return new qR(this.width,this.height)},qR.prototype.equals=function(e){return!!e&&(this.width===e.width&&this.height===e.height)},Object.defineProperty(qR.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),qR.Zero=function(){return new qR(0,0)},qR.prototype.add=function(e){return new qR(this.width+e.width,this.height+e.height)},qR.prototype.subtract=function(e){return new qR(this.width-e.width,this.height-e.height)},qR.Lerp=function(e,t,r){return new qR(e.width+(t.width-e.width)*r,e.height+(t.height-e.height)*r)},Object.defineProperty(VR.prototype,"wrapU",{get:function(){return this._wrapU},set:function(e){this._wrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(VR.prototype,"wrapV",{get:function(){return this._wrapV},set:function(e){this._wrapV=e},enumerable:!1,configurable:!0}),Object.defineProperty(VR.prototype,"coordinatesMode",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(VR.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(e){this._texture&&(this._texture.isCube=e)},enumerable:!1,configurable:!0}),Object.defineProperty(VR.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)},enumerable:!1,configurable:!0}),Object.defineProperty(VR.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(e){this._texture&&(this._texture.is2DArray=e)},enumerable:!1,configurable:!0}),VR.prototype.getClassName=function(){return"ThinTexture"},VR.prototype.isReady=function(){return this.delayLoadState===cp.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},VR.prototype.delayLoad=function(){},VR.prototype.getInternalTexture=function(){return this._texture},VR.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},VR.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)},Object.defineProperty(VR.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!1,configurable:!0}),VR.prototype.updateSamplingMode=function(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)},VR.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},VR.prototype.dispose=function(){this._texture&&(this.releaseInternalTexture(),this._engine=null)},Object.defineProperties(YR.prototype,{id:{set:function(e){this._id=e},get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(e){this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},depth:{get:function(){return this._depth}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}},is3D:{get:function(){return this._is3D}},thinTexture:{get:function(){return this._texture}},internalTexture:{get:function(){return this._texture._texture}},GPUTexture:{get:function(){return this._texture._texture._hardwareTexture.underlyingResource}}}),YR.prototype.copyFromTexture=function(e,t,r,n,i,o,s,a,u){var c=this._context.engine._device,l=this.GPUTexture,h=e._inner.GPUTexture,p=c.createCommandEncoder({});p.copyTextureToTexture({texture:h,origin:{x:o,y:s},mipLevel:t},{texture:l,origin:{x:r,y:n,z:i},mipLevel:t},{width:h.width,height:h.height,depthOrArrayLayers:1}),c.queue.submit([p.finish()])},YR.prototype.setDataBufferWithMipmap=function(e,t){console.log("Texture3DGPU.prototype.setDataBufferWithMipmap not supported")},YR.prototype.useSharedRenderTargetWrapper=function(e){return this._renderTargetWrapper||(this._renderTargetWrapper=new zR(!1,!1,e,this._context.engine)),this._renderTargetWrapperRefCount++,this._renderTargetWrapper},YR.prototype.unuseSharedRenderTargetWrapper=function(){this._renderTargetWrapperRefCount--,this._renderTargetWrapperRefCount=Math.max(0,this._renderTargetWrapperRefCount),0==this._renderTargetWrapperRefCount&&this._renderTargetWrapper.dispose(!0)},YR.prototype.generateMipmap=function(e){console.log("Texture3DGPU.prototype.generateMipmap not supported")},YR.prototype.isDestroyed=function(){return!1},YR.prototype.destroy=function(){return this._context.memorySize-=this._sizeInBytes,this._context.memoryAnalyzer.releaseGPUMemory(sp,this._ownerName,this._sizeInBytes),this._texture.dispose(),op(this)},XR.create=function(e){return new Texture(e)},Object.defineProperties(XR.prototype,{id:{set:function(e){this._inner.id=e},get:function(){return this._inner.id}},sampler:{get:function(){return this._inner.sampler},set:function(e){this._inner.sampler=e}},pixelFormat:{get:function(){return this._inner.pixelFormat}},pixelDatatype:{get:function(){return this._inner.pixelDatatype}},dimensions:{get:function(){return this._inner.dimensions}},preMultiplyAlpha:{get:function(){return this._inner.preMultiplyAlpha}},flipY:{get:function(){return this._inner.flipY}},width:{get:function(){return this._inner.width}},depth:{get:function(){return this._inner.depth}},height:{get:function(){return this._inner.height}},sizeInBytes:{get:function(){return this._inner.sizeInBytes}},_target:{get:function(){return this._inner._target}},_texture:{get:function(){return this._inner._texture}},is3D:{get:function(){return this._inner.is3D}},is2DArray:{get:function(){return!this._inner.is3D}}}),XR.prototype.setDataBufferWithMipmap=function(e,t){this._inner.setDataBufferWithMipmap(e,t)},XR.prototype.copyFromTexture=function(e,t,r,n,i,o,s,a,u){this._inner.copyFromTexture(e,t,r,n,i,o,s,a,u)},XR.prototype.generateMipmap=function(e){this._inner.generateMipmap(e)},XR.prototype.isDestroyed=function(){return!1},XR.prototype.destroy=function(){return this._inner.destroy(),op(this)};var WR,KR,JR,ZR,$R,eM,tM,rM,nM,iM,oM,sM,aM,uM,cM,lM,hM,pM,dM,fM,AM,gM,_M,mM,yM,EM,xM,CM,bM,IM,TM,vM,RM,MM,wM,SM,BM,OM,DM=1;function FM(e){var t=(e=Yt(e,Yt.EMPTY_OBJECT)).context;qt.defined("options.context",t),this.id=DM++,this._faceIndex=0,this._context=t,this._colorTextures=[],this._activeColorAttachments=[],this._depthTexture=void 0,this._depthStencilTexture=void 0,this.destroyAttachments=Yt(e.destroyAttachments,!0);var r=e.colorTextures,n=!1,i=!1,o=1,s=1;jt(e.colorTextures)?(n=r.length>1,o=r[0].width,s=r[0].height,i=r[0]&&r[0]._texture&&r[0]._texture.isCube):jt(e.depthTexture)?(o=e.depthTexture.width,s=e.depthTexture.height):jt(e.depthStencilTexture)&&(o=e.depthStencilTexture.width,s=e.depthStencilTexture.height);var a,u,c,l=0;(this._shareRenderTargetWrapper=!1,jt(e.colorTextureActiveLayers)&&e.colorTextures)&&((h=e.colorTextures[0])instanceof XR&&(this._shareRenderTargetWrapper=!0,l=r[0].depth));if(i){var h=e.colorTextures[0];this._faceIndex=h.targetFace,this._shareRenderTargetWrapper=!0}if(this._textureSize={width:o,height:s,layers:l},this._shareRenderTargetWrapper){h=e.colorTextures[0];this._renderTargetWrapper=h._inner.useSharedRenderTargetWrapper(this._textureSize),this._activeLayer=e.colorTextureActiveLayers?e.colorTextureActiveLayers[0]:0}else this._renderTargetWrapper=new zR(n,i,this._textureSize,t.engine),this._activeLayer=0;if(jt(e.colorTextures)){var p=e.colorTextures;c=this._colorTextures.length=this._activeColorAttachments.length=p.length;var d=[],f=[];for(u=0;u<c;++u){if(a=p[u],!Pp.isColorFormat(a.pixelFormat))throw new Ht("The color-texture pixel-format must be a color format.");if(a.pixelDatatype===Dp.FLOAT&&!t.colorBufferFloat)throw new Ht("The color texture pixel datatype is FLOAT and the WebGL implementation does not support the EXT_color_buffer_float or WEBGL_color_buffer_float extensions. See Context.colorBufferFloat.");if(a.pixelDatatype===Dp.HALF_FLOAT&&!t.colorBufferHalfFloat)throw new Ht("The color texture pixel datatype is HALF_FLOAT and the WebGL implementation does not support the EXT_color_buffer_half_float extension. See Context.colorBufferHalfFloat.");this._renderTargetWrapper.setTexture(a._inner.internalTexture,u,!1),this._colorTextures[u]=a,d.push(u+1),f.push(u+1)}this._renderTargetWrapper._attachments=d,this._renderTargetWrapper._defaultAttachments=f}jt(e.depthTexture)&&(this._renderTargetWrapper._depthStencilTextureWithStencil=!1,this._renderTargetWrapper._depthStencilTexture=e.depthTexture._inner.internalTexture,this._depthTexture=e.depthTexture),jt(e.depthStencilTexture)&&(this._renderTargetWrapper._depthStencilTextureWithStencil=!0,this._renderTargetWrapper._depthStencilTexture=e.depthStencilTexture._inner.internalTexture,this._depthStencilTexture=e.depthStencilTexture)}function PM(e){var t=(e=Yt(e,Yt.EMPTY_OBJECT)).context;qt.defined("options.context",t),e.context.webgpu?this._inner=new FM(e):this._inner=new PR(e)}function NM(e){e=Yt(e,Yt.EMPTY_OBJECT),qt.defined("options.context",e.context);var t=e.context,r=e.width,n=e.height,i=e.source;jt(i)&&(jt(r)||(r=Yt(i.videoWidth,i.width)),jt(n)||(n=Yt(i.videoHeight,i.height)));var o=Yt(e.pixelFormat,Pp.RGBA),s=Yt(e.pixelDatatype,Dp.UNSIGNED_BYTE),a=Pp.toInternalFormat(o,s,t),u=Yt(e.unpackAlignment,4),c=Pp.isCompressedFormat(a);if(!jt(r)||!jt(n))throw new Ht("options requires a source field to create an initialized texture or width and height fields to create a blank texture.");if(qt.typeOf.number.greaterThan("width",r,0),r>Sp.maximumTextureSize)throw new Ht("Width must be less than or equal to the maximum texture size ("+Sp.maximumTextureSize+").  Check maximumTextureSize.");if(qt.typeOf.number.greaterThan("height",n,0),n>Sp.maximumTextureSize)throw new Ht("Height must be less than or equal to the maximum texture size ("+Sp.maximumTextureSize+").  Check maximumTextureSize.");if(!Pp.validate(o))throw new Ht("Invalid options.pixelFormat.");if(!c&&!Dp.validate(s))throw new Ht("Invalid options.pixelDatatype.");if(o===Pp.DEPTH_COMPONENT&&s!==Dp.UNSIGNED_SHORT&&s!==Dp.UNSIGNED_INT&&s!==Dp.FLOAT)throw new Ht("When options.pixelFormat is DEPTH_COMPONENT, options.pixelDatatype must be UNSIGNED_SHORT or UNSIGNED_INT.");if(o===Pp.DEPTH_STENCIL&&s!==Dp.UNSIGNED_INT_24_8)throw new Ht("When options.pixelFormat is DEPTH_STENCIL, options.pixelDatatype must be UNSIGNED_INT_24_8.");if(s===Dp.FLOAT&&!t.floatingPointTexture)throw new Ht("When options.pixelDatatype is FLOAT, this WebGL implementation must support the OES_texture_float extension.  Check context.floatingPointTexture.");if(s===Dp.HALF_FLOAT&&!t.halfFloatingPointTexture)throw new Ht("When options.pixelDatatype is HALF_FLOAT, this WebGL implementation must support the OES_texture_half_float extension. Check context.halfFloatingPointTexture.");if(Pp.isDepthFormat(o)){if(jt(i))throw new Ht("When options.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, source cannot be provided.");if(!t.depthTexture)throw new Ht("When options.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, this WebGL implementation must support WEBGL_depth_texture.  Check context.depthTexture.")}if(c){if(!jt(i)||!jt(i.arrayBufferView))throw new Ht("When options.pixelFormat is compressed, options.source.arrayBufferView must be defined.");if(Pp.isDXTFormat(a)&&!t.s3tc)throw new Ht("When options.pixelFormat is S3TC compressed, this WebGL implementation must support the WEBGL_texture_compression_s3tc extension. Check context.s3tc.");if(Pp.isPVRTCFormat(a)&&!t.pvrtc)throw new Ht("When options.pixelFormat is PVRTC compressed, this WebGL implementation must support the WEBGL_texture_compression_pvrtc extension. Check context.pvrtc.");if(Pp.isETC1Format(a)&&!t.etc1)throw new Ht("When options.pixelFormat is ETC1 compressed, this WebGL implementation must support the WEBGL_texture_compression_etc1 extension. Check context.etc1.");if(Pp.compressedTextureSizeInBytes(a,r,n)!==i.arrayBufferView.byteLength)throw new Ht("The byte length of the array buffer is invalid for the compressed texture with the given width and height.")}var l=e.preMultiplyAlpha||o===Pp.RGB||o===Pp.LUMINANCE,h=e.forcePremultipliedAlpha||!1,p=Yt(e.flipY,!0);const d=Yt(e.skipColorSpaceConversion,!1);var f,A=!0,g=t._gl,_=g.TEXTURE_2D,m=g.createTexture();if(g.activeTexture(g.TEXTURE0),g.bindTexture(_,m),!jt(e.unpackAlignment)&&jt(i)&&jt(i.arrayBufferView)&&!c&&(u=Pp.alignmentInBytes(o,s,r)),g.pixelStorei(g.UNPACK_ALIGNMENT,u),d?g.pixelStorei(g.UNPACK_COLORSPACE_CONVERSION_WEBGL,g.NONE):g.pixelStorei(g.UNPACK_COLORSPACE_CONVERSION_WEBGL,g.BROWSER_DEFAULT_WEBGL),jt(i))if(jt(i.arrayBufferView)){h&&o===Pp.RGBA&&!c?g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0):g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1);var y,E,x=i.arrayBufferView;if(c){if(g.compressedTexImage2D(_,0,a,r,n,0,x),jt(i.mipLevels))for(y=r,E=n,C=0;C<i.mipLevels.length;++C)(y=0|Math.floor(y/2))<1&&(y=1),(E=0|Math.floor(E/2))<1&&(E=1),g.compressedTexImage2D(_,C+1,a,y,E,0,i.mipLevels[C])}else if(p&&(x=Pp.flipY(x,o,s,r,n)),g.texImage2D(_,0,a,r,n,0,o,Dp.toWebGLConstant(s,t),x),jt(i.mipLevels))for(y=r,E=n,C=0;C<i.mipLevels.length;++C)(y=0|Math.floor(y/2))<1&&(y=1),(E=0|Math.floor(E/2))<1&&(E=1),g.texImage2D(_,C+1,a,y,E,0,o,Dp.toWebGLConstant(s,t),i.mipLevels[C])}else if(jt(i.framebuffer))g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1),i.framebuffer!==t.defaultFramebuffer&&i.framebuffer._bind(),g.copyTexImage2D(_,0,a,i.xOffset,i.yOffset,r,n,0),i.framebuffer!==t.defaultFramebuffer&&i.framebuffer._unBind();else{g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,p),g.texImage2D(_,0,a,o,Dp.toWebGLConstant(s,t),i);let r=e.mipLevels;if(jt(r))for(var C=0,b=r.length;C<b;++C)g.texImage2D(_,C+1,a,o,Dp.toWebGLConstant(s,t),r[C])}else g.texImage2D(_,0,a,r,n,0,o,Dp.toWebGLConstant(s,t),null),A=!1;g.bindTexture(_,null),f=c?Pp.compressedTextureSizeInBytes(o,r,n):Pp.textureSizeInBytes(o,s,r,n),this._id=Ap(),this._context=t,this._textureFilterAnisotropic=t._textureFilterAnisotropic,this._textureTarget=_,this._texture=m,this._internalFormat=a,this._pixelFormat=o,this._pixelDatatype=s,this._width=r,this._height=n,this._dimensions=new _r(r,n),this._size=[r,n],this._hasMipmap=!1,this._sizeInBytes=f,this._preMultiplyAlpha=l,this._flipY=p,this._initialized=A,this._sampler=void 0,this.ignoreWEBGL2=!1,this._samples=Yt(e.samples,1),this.sampler=jt(e.sampler)?e.sampler:new OR,t.memorySize+=f,this._ownerName=e.owner,t.memoryAnalyzer.allocateGPUMemory(sp,e.owner,f)}Object.defineProperties(FM.prototype,{status:{get:function(){return Lc.FRAMEBUFFER_COMPLETE}},numberOfColorAttachments:{get:function(){return this._activeColorAttachments.length}},depthTexture:{get:function(){return this._depthTexture}},depthRenderbuffer:{get:function(){return this._depthRenderbuffer}},stencilRenderbuffer:{get:function(){return this._stencilRenderbuffer}},depthStencilTexture:{get:function(){return this._depthStencilTexture}},depthStencilRenderbuffer:{get:function(){return this._depthStencilRenderbuffer}},hasDepthAttachment:{get:function(){return!!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}},textureSize:{get:function(){return this._textureSize}}}),FM.prototype._bind=function(){jt(this._renderTargetWrapper)&&this._context._engine.bindFramebuffer(this._renderTargetWrapper,this._faceIndex,null,null,null,null,this._activeLayer,0)},FM.prototype._unBind=function(){jt(this._renderTargetWrapper)&&this._context._engine.unBindFramebuffer(this._renderTargetWrapper)},FM.prototype._attachTexture=function(e,t){console.log("FramebufferGPU.prototype._attachTexture")},FM.prototype._getActiveColorAttachments=function(){console.log("FramebufferGPU.prototype._getActiveColorAttachments")},FM.prototype.getColorTexture=function(e){if(!jt(e)||e<0||e>=this._colorTextures.length)throw new Ht("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorTextures[e]},FM.prototype.getColorRenderbuffer=function(e){if(!jt(e)||e<0||e>=this._colorRenderbuffers.length)throw new Ht("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorRenderbuffers[e]},FM.prototype.isDestroyed=function(){return!1},FM.prototype.destroy=function(){if(this._shareRenderTargetWrapper?(this._colorTextures[0]._inner.unuseSharedRenderTargetWrapper(),this._renderTargetWrapper=void 0):this._renderTargetWrapper.dispose(!0),this.destroyAttachments){for(var e=this._colorTextures,t=e.length,r=0;r<t;++r){var n=e[r];jt(n)&&n.destroy()}this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy()}return op(this)},Object.defineProperties(PM.prototype,{status:{get:function(){return this._inner.status}},numberOfColorAttachments:{get:function(){return this._inner.numberOfColorAttachments}},depthTexture:{get:function(){return this._inner.depthTexture}},depthRenderbuffer:{get:function(){return this._inner.depthRenderbuffer}},stencilRenderbuffer:{get:function(){return this._inner.stencilRenderbuffer}},depthStencilTexture:{get:function(){return this._inner.depthStencilTexture}},depthStencilRenderbuffer:{get:function(){return this._inner.depthStencilRenderbuffer}},hasDepthAttachment:{get:function(){return!!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}},textureSize:{get:function(){return this._inner.textureSize}}}),PM.prototype._bind=function(){this._inner._bind()},PM.prototype._unBind=function(){this._inner._unBind()},PM.prototype._attachTexture=function(e,t){this._inner._attachTexture(e,t)},PM.prototype._getActiveColorAttachments=function(){return this._inner._getActiveColorAttachments()},PM.prototype.getColorTexture=function(e){return this._inner.getColorTexture(e)},PM.prototype.getColorRenderbuffer=function(e){return this._inner.getColorRenderbuffer(e)},PM.prototype.isDestroyed=function(){return!1},PM.prototype.destroy=function(){return this._inner.destroy(),op(this)},PM.blitFramebuffers=function(e,t,r,n,i,o){e.webgpu||PR.blitFramebuffers(e,t,r,n,i,o)},NM.fromFramebuffer=function(e){e=Yt(e,Yt.EMPTY_OBJECT),qt.defined("options.context",e.context);var t=e.context,r=t._gl,n=Yt(e.pixelFormat,Pp.RGB),i=Yt(e.framebufferXOffset,0),o=Yt(e.framebufferYOffset,0),s=Yt(e.width,r.drawingBufferWidth),a=Yt(e.height,r.drawingBufferHeight),u=e.framebuffer;if(!Pp.validate(n))throw new Ht("Invalid pixelFormat.");if(Pp.isDepthFormat(n)||Pp.isCompressedFormat(n))throw new Ht("pixelFormat cannot be DEPTH_COMPONENT, DEPTH_STENCIL or a compressed format.");if(qt.defined("options.context",e.context),qt.typeOf.number.greaterThanOrEquals("framebufferXOffset",i,0),qt.typeOf.number.greaterThanOrEquals("framebufferYOffset",o,0),i+s>r.drawingBufferWidth)throw new Ht("framebufferXOffset + width must be less than or equal to drawingBufferWidth");if(o+a>r.drawingBufferHeight)throw new Ht("framebufferYOffset + height must be less than or equal to drawingBufferHeight.");return new NM({context:t,width:s,height:a,pixelFormat:n,source:{framebuffer:jt(u)?u:t.defaultFramebuffer,xOffset:i,yOffset:o,width:s,height:a}})},Object.defineProperties(NM.prototype,{id:{set:function(e){this._id=e},get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(e){var t=e.minificationFilter,r=e.magnificationFilter,n=e.comparisonFunction,i=t===kp.NEAREST_MIPMAP_NEAREST||t===kp.NEAREST_MIPMAP_LINEAR||t===kp.LINEAR_MIPMAP_NEAREST||t===kp.LINEAR_MIPMAP_LINEAR,o=this._context,s=this._pixelDatatype;const a=this._pixelFormat;(s===Dp.FLOAT&&!o.textureFloatLinear||s===Dp.HALF_FLOAT&&!o.textureHalfFloatLinear)&&(t=i?kp.NEAREST_MIPMAP_NEAREST:kp.NEAREST,r=Gp.NEAREST),o.webgl2&&Pp.isDepthFormat(a)&&(t=kp.NEAREST,r=Gp.NEAREST);var u=o._gl,c=this._textureTarget;u.activeTexture(u.TEXTURE0),u.bindTexture(c,this._texture),u.texParameteri(c,u.TEXTURE_MIN_FILTER,t),u.texParameteri(c,u.TEXTURE_MAG_FILTER,r),u.texParameteri(c,u.TEXTURE_WRAP_S,e.wrapS),u.texParameteri(c,u.TEXTURE_WRAP_T,e.wrapT),jt(this._textureFilterAnisotropic)&&u.texParameteri(c,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.maximumAnisotropy),o.webgl2&&n&&(n===Lc.LEQUAL?(u.texParameteri(c,u.TEXTURE_COMPARE_FUNC,Lc.LEQUAL),u.texParameteri(c,u.TEXTURE_COMPARE_MODE,u.NONE)):(u.texParameteri(c,u.TEXTURE_COMPARE_FUNC,n),u.texParameteri(c,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE))),u.bindTexture(c,null),this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},size:{get:function(){return this._size}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}}}),NM.prototype.copyFrom=function(e,t,r){if(t=Yt(t,0),r=Yt(r,0),qt.defined("source",e),Pp.isDepthFormat(this._pixelFormat))throw new Ht("Cannot call copyFrom when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");var n=Pp.isCompressedFormat(this._pixelFormat);qt.typeOf.number.greaterThanOrEquals("xOffset",t,0),qt.typeOf.number.greaterThanOrEquals("yOffset",r,0),qt.typeOf.number.lessThanOrEquals("xOffset + source.width",t+e.width,this._width),qt.typeOf.number.lessThanOrEquals("yOffset + source.height",r+e.height,this._height);const i=this._context;var o=i._gl,s=this._textureTarget;o.activeTexture(o.TEXTURE0),o.bindTexture(s,this._texture);var a=e.width,u=e.height,c=e.arrayBufferView,l=this._width,h=this._height,p=this._pixelFormat,d=this._pixelDatatype;const f=this._internalFormat;var A=this._preMultiplyAlpha,g=this._flipY,_=Yt(e.unpackAlignment,4);!jt(e.unpackAlignment)&&jt(c)&&(_=Pp.alignmentInBytes(p,d,a)),o.pixelStorei(o.UNPACK_ALIGNMENT,_),o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,o.BROWSER_DEFAULT_WEBGL);var m=!1;if(!this._initialized){if(0===t&&0===r&&a===l&&u===h)jt(c)?(o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1),g&&(c=Pp.flipY(c,p,d,l,h)),o.texImage2D(s,0,f,l,h,0,p,Dp.toWebGLConstant(d,i),c)):(o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,g),o.texImage2D(s,0,f,p,Dp.toWebGLConstant(d,i),e)),m=!0;else{o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1);var y=Pp.createTypedArray(p,d,l,h);o.texImage2D(s,0,f,l,h,0,p,Dp.toWebGLConstant(d,i),y)}this._initialized=!0}m||(jt(c)?(o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1),g&&(c=Pp.flipY(c,p,d,a,u)),n?o.compressedTexSubImage2D(s,0,t,r,a,u,p,c):o.texSubImage2D(s,0,t,r,a,u,p,Dp.toWebGLConstant(d,i),c)):(o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,g),n?o.compressedTexSubImage2D(s,0,t,r,a,u,p,c):o.texSubImage2D(s,0,t,r,p,Dp.toWebGLConstant(d,i),e))),o.bindTexture(s,null)},NM.prototype.copyFromFramebuffer=function(e,t,r,n,i,o){if(e=Yt(e,0),t=Yt(t,0),r=Yt(r,0),n=Yt(n,0),i=Yt(i,this._width),o=Yt(o,this._height),Pp.isDepthFormat(this._pixelFormat))throw new Ht("Cannot call copyFromFramebuffer when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(this._pixelDatatype===Dp.FLOAT)throw new Ht("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this._pixelDatatype===Dp.HALF_FLOAT)throw new Ht("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");if(Pp.isCompressedFormat(this._pixelFormat))throw new Ht("Cannot call copyFrom with a compressed texture pixel format.");qt.typeOf.number.greaterThanOrEquals("xOffset",e,0),qt.typeOf.number.greaterThanOrEquals("yOffset",t,0),qt.typeOf.number.greaterThanOrEquals("framebufferXOffset",r,0),qt.typeOf.number.greaterThanOrEquals("framebufferYOffset",n,0),qt.typeOf.number.lessThanOrEquals("xOffset + width",e+i,this._width),qt.typeOf.number.lessThanOrEquals("yOffset + height",t+o,this._height);var s=this._context._gl,a=this._textureTarget;s.activeTexture(s.TEXTURE0),s.bindTexture(a,this._texture),s.copyTexSubImage2D(a,0,e,t,r,n,i,o),s.bindTexture(a,null),this._initialized=!0},NM.prototype.copyFromTexture=function(e,t,r,n,i,o,s){var a=this._context,u=new PM({context:a,colorTextures:[e],destroyAttachments:!1});if(u!==a._currentFramebuffer&&(a._currentFramebuffer=u,jt(u))){u._bind();var c=u._getActiveColorAttachments();a.drawBuffers&&a.glDrawBuffers(c)}this.copyFromFramebuffer(t,r,n,i,o,s),u.destroy()},NM.prototype.generateMipmap=function(e){if(e=Yt(e,BR.DONT_CARE),Pp.isDepthFormat(this._pixelFormat))throw new Ht("Cannot call generateMipmap when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(Pp.isCompressedFormat(this._pixelFormat))throw new Ht("Cannot call generateMipmap with a compressed pixel format.");if(!this._context.webgl2){if(this._width>1&&!Wt.isPowerOfTwo(this._width))throw new Ht("width must be a power of two to call generateMipmap() in a WebGL1 context.");if(this._height>1&&!Wt.isPowerOfTwo(this._height))throw new Ht("height must be a power of two to call generateMipmap() in a WebGL1 context.")}if(!BR.validate(e))throw new Ht("hint is invalid.");this._hasMipmap=!0;var t=this._context._gl,r=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(r,this._texture),t.generateMipmap(r),t.bindTexture(r,null)},NM.prototype.isDestroyed=function(){return!1},NM.prototype.destroy=function(){return!this._context._contextWasLost&&this._context._gl.deleteTexture(this._texture),this._context.memorySize-=this._sizeInBytes,this._context.memoryAnalyzer.releaseGPUMemory(sp,this._ownerName,this._sizeInBytes),op(this)},function(e){e.SRGB="srgb"}(WR||(WR={})),function(e){e.LowPower="low-power",e.HighPerformance="high-performance"}(KR||(KR={})),function(e){e.DepthClipControl="depth-clip-control",e.Depth24UnormStencil8="depth24unorm-stencil8",e.Depth32FloatStencil8="depth32float-stencil8",e.TextureCompressionBC="texture-compression-bc",e.TextureCompressionETC2="texture-compression-etc2",e.TextureCompressionASTC="texture-compression-astc",e.TimestampQuery="timestamp-query",e.IndirectFirstInstance="indirect-first-instance",e.ShaderF16="shader-f16",e.BGRA8UnormStorage="bgra8unorm-storage"}(JR||(JR={})),function(e){e[e.MapRead=1]="MapRead",e[e.MapWrite=2]="MapWrite",e[e.CopySrc=4]="CopySrc",e[e.CopyDst=8]="CopyDst",e[e.Index=16]="Index",e[e.Vertex=32]="Vertex",e[e.Uniform=64]="Uniform",e[e.Storage=128]="Storage",e[e.Indirect=256]="Indirect",e[e.QueryResolve=512]="QueryResolve"}(ZR||(ZR={})),function(e){e[e.Read=1]="Read",e[e.Write=2]="Write"}($R||($R={})),function(e){e.E1d="1d",e.E2d="2d",e.E3d="3d"}(eM||(eM={})),function(e){e[e.CopySrc=1]="CopySrc",e[e.CopyDst=2]="CopyDst",e[e.TextureBinding=4]="TextureBinding",e[e.StorageBinding=8]="StorageBinding",e[e.RenderAttachment=16]="RenderAttachment"}(tM||(tM={})),function(e){e.E1d="1d",e.E2d="2d",e.E2dArray="2d-array",e.Cube="cube",e.CubeArray="cube-array",e.E3d="3d"}(rM||(rM={})),function(e){e.All="all",e.StencilOnly="stencil-only",e.DepthOnly="depth-only"}(nM||(nM={})),function(e){e.R8Unorm="r8unorm",e.R8Snorm="r8snorm",e.R8Uint="r8uint",e.R8Sint="r8sint",e.R16Uint="r16uint",e.R16Sint="r16sint",e.R16Float="r16float",e.RG8Unorm="rg8unorm",e.RG8Snorm="rg8snorm",e.RG8Uint="rg8uint",e.RG8Sint="rg8sint",e.R32Uint="r32uint",e.R32Sint="r32sint",e.R32Float="r32float",e.RG16Uint="rg16uint",e.RG16Sint="rg16sint",e.RG16Float="rg16float",e.RGBA8Unorm="rgba8unorm",e.RGBA8UnormSRGB="rgba8unorm-srgb",e.RGBA8Snorm="rgba8snorm",e.RGBA8Uint="rgba8uint",e.RGBA8Sint="rgba8sint",e.BGRA8Unorm="bgra8unorm",e.BGRA8UnormSRGB="bgra8unorm-srgb",e.RGB9E5UFloat="rgb9e5ufloat",e.RGB10A2Unorm="rgb10a2unorm",e.RG11B10UFloat="rg11b10ufloat",e.RG32Uint="rg32uint",e.RG32Sint="rg32sint",e.RG32Float="rg32float",e.RGBA16Uint="rgba16uint",e.RGBA16Sint="rgba16sint",e.RGBA16Float="rgba16float",e.RGBA32Uint="rgba32uint",e.RGBA32Sint="rgba32sint",e.RGBA32Float="rgba32float",e.Stencil8="stencil8",e.Depth16Unorm="depth16unorm",e.Depth24Plus="depth24plus",e.Depth24PlusStencil8="depth24plus-stencil8",e.Depth32Float="depth32float",e.BC1RGBAUnorm="bc1-rgba-unorm",e.BC1RGBAUnormSRGB="bc1-rgba-unorm-srgb",e.BC2RGBAUnorm="bc2-rgba-unorm",e.BC2RGBAUnormSRGB="bc2-rgba-unorm-srgb",e.BC3RGBAUnorm="bc3-rgba-unorm",e.BC3RGBAUnormSRGB="bc3-rgba-unorm-srgb",e.BC4RUnorm="bc4-r-unorm",e.BC4RSnorm="bc4-r-snorm",e.BC5RGUnorm="bc5-rg-unorm",e.BC5RGSnorm="bc5-rg-snorm",e.BC6HRGBUFloat="bc6h-rgb-ufloat",e.BC6HRGBFloat="bc6h-rgb-float",e.BC7RGBAUnorm="bc7-rgba-unorm",e.BC7RGBAUnormSRGB="bc7-rgba-unorm-srgb",e.ETC2RGB8Unorm="etc2-rgb8unorm",e.ETC2RGB8UnormSRGB="etc2-rgb8unorm-srgb",e.ETC2RGB8A1Unorm="etc2-rgb8a1unorm",e.ETC2RGB8A1UnormSRGB="etc2-rgb8a1unorm-srgb",e.ETC2RGBA8Unorm="etc2-rgba8unorm",e.ETC2RGBA8UnormSRGB="etc2-rgba8unorm-srgb",e.EACR11Unorm="eac-r11unorm",e.EACR11Snorm="eac-r11snorm",e.EACRG11Unorm="eac-rg11unorm",e.EACRG11Snorm="eac-rg11snorm",e.ASTC4x4Unorm="astc-4x4-unorm",e.ASTC4x4UnormSRGB="astc-4x4-unorm-srgb",e.ASTC5x4Unorm="astc-5x4-unorm",e.ASTC5x4UnormSRGB="astc-5x4-unorm-srgb",e.ASTC5x5Unorm="astc-5x5-unorm",e.ASTC5x5UnormSRGB="astc-5x5-unorm-srgb",e.ASTC6x5Unorm="astc-6x5-unorm",e.ASTC6x5UnormSRGB="astc-6x5-unorm-srgb",e.ASTC6x6Unorm="astc-6x6-unorm",e.ASTC6x6UnormSRGB="astc-6x6-unorm-srgb",e.ASTC8x5Unorm="astc-8x5-unorm",e.ASTC8x5UnormSRGB="astc-8x5-unorm-srgb",e.ASTC8x6Unorm="astc-8x6-unorm",e.ASTC8x6UnormSRGB="astc-8x6-unorm-srgb",e.ASTC8x8Unorm="astc-8x8-unorm",e.ASTC8x8UnormSRGB="astc-8x8-unorm-srgb",e.ASTC10x5Unorm="astc-10x5-unorm",e.ASTC10x5UnormSRGB="astc-10x5-unorm-srgb",e.ASTC10x6Unorm="astc-10x6-unorm",e.ASTC10x6UnormSRGB="astc-10x6-unorm-srgb",e.ASTC10x8Unorm="astc-10x8-unorm",e.ASTC10x8UnormSRGB="astc-10x8-unorm-srgb",e.ASTC10x10Unorm="astc-10x10-unorm",e.ASTC10x10UnormSRGB="astc-10x10-unorm-srgb",e.ASTC12x10Unorm="astc-12x10-unorm",e.ASTC12x10UnormSRGB="astc-12x10-unorm-srgb",e.ASTC12x12Unorm="astc-12x12-unorm",e.ASTC12x12UnormSRGB="astc-12x12-unorm-srgb",e.Depth24UnormStencil8="depth24unorm-stencil8",e.Depth32FloatStencil8="depth32float-stencil8"}(iM||(iM={})),function(e){e.ClampToEdge="clamp-to-edge",e.Repeat="repeat",e.MirrorRepeat="mirror-repeat"}(oM||(oM={})),function(e){e.Nearest="nearest",e.Linear="linear"}(sM||(sM={})),function(e){e.Never="never",e.Less="less",e.Equal="equal",e.LessEqual="less-equal",e.Greater="greater",e.NotEqual="not-equal",e.GreaterEqual="greater-equal",e.Always="always"}(aM||(aM={})),function(e){e[e.Vertex=1]="Vertex",e[e.Fragment=2]="Fragment",e[e.Compute=4]="Compute"}(uM||(uM={})),function(e){e.Uniform="uniform",e.Storage="storage",e.ReadOnlyStorage="read-only-storage"}(cM||(cM={})),function(e){e.Filtering="filtering",e.NonFiltering="non-filtering",e.Comparison="comparison"}(lM||(lM={})),function(e){e.Float="float",e.UnfilterableFloat="unfilterable-float",e.Depth="depth",e.Sint="sint",e.Uint="uint"}(hM||(hM={})),function(e){e.WriteOnly="write-only"}(pM||(pM={})),function(e){e.Error="error",e.Warning="warning",e.Info="info"}(dM||(dM={})),function(e){e.Auto="auto"}(fM||(fM={})),function(e){e.PointList="point-list",e.LineList="line-list",e.LineStrip="line-strip",e.TriangleList="triangle-list",e.TriangleStrip="triangle-strip"}(AM||(AM={})),function(e){e.CCW="ccw",e.CW="cw"}(gM||(gM={})),function(e){e.None="none",e.Front="front",e.Back="back"}(_M||(_M={})),function(e){e[e.Red=1]="Red",e[e.Green=2]="Green",e[e.Blue=4]="Blue",e[e.Alpha=8]="Alpha",e[e.All=15]="All"}(mM||(mM={})),function(e){e.Zero="zero",e.One="one",e.Src="src",e.OneMinusSrc="one-minus-src",e.SrcAlpha="src-alpha",e.OneMinusSrcAlpha="one-minus-src-alpha",e.Dst="dst",e.OneMinusDst="one-minus-dst",e.DstAlpha="dst-alpha",e.OneMinusDstAlpha="one-minus-dst-alpha",e.SrcAlphaSaturated="src-alpha-saturated",e.Constant="constant",e.OneMinusConstant="one-minus-constant"}(yM||(yM={})),function(e){e.Add="add",e.Subtract="subtract",e.ReverseSubtract="reverse-subtract",e.Min="min",e.Max="max"}(EM||(EM={})),function(e){e.Keep="keep",e.Zero="zero",e.Replace="replace",e.Invert="invert",e.IncrementClamp="increment-clamp",e.DecrementClamp="decrement-clamp",e.IncrementWrap="increment-wrap",e.DecrementWrap="decrement-wrap"}(xM||(xM={})),function(e){e.Uint16="uint16",e.Uint32="uint32"}(CM||(CM={})),function(e){e.Uint8x2="uint8x2",e.Uint8x4="uint8x4",e.Sint8x2="sint8x2",e.Sint8x4="sint8x4",e.Unorm8x2="unorm8x2",e.Unorm8x4="unorm8x4",e.Snorm8x2="snorm8x2",e.Snorm8x4="snorm8x4",e.Uint16x2="uint16x2",e.Uint16x4="uint16x4",e.Sint16x2="sint16x2",e.Sint16x4="sint16x4",e.Unorm16x2="unorm16x2",e.Unorm16x4="unorm16x4",e.Snorm16x2="snorm16x2",e.Snorm16x4="snorm16x4",e.Float16x2="float16x2",e.Float16x4="float16x4",e.Float32="float32",e.Float32x2="float32x2",e.Float32x3="float32x3",e.Float32x4="float32x4",e.Uint32="uint32",e.Uint32x2="uint32x2",e.Uint32x3="uint32x3",e.Uint32x4="uint32x4",e.Sint32="sint32",e.Sint32x2="sint32x2",e.Sint32x3="sint32x3",e.Sint32x4="sint32x4"}(bM||(bM={})),function(e){e.Vertex="vertex",e.Instance="instance"}(IM||(IM={})),function(e){e.Beginning="beginning",e.End="end"}(TM||(TM={})),function(e){e.Beginning="beginning",e.End="end"}(vM||(vM={})),function(e){e.Load="load",e.Clear="clear"}(RM||(RM={})),function(e){e.Store="store",e.Discard="discard"}(MM||(MM={})),function(e){e.Occlusion="occlusion",e.Timestamp="timestamp"}(wM||(wM={})),function(e){e.Opaque="opaque",e.Premultiplied="premultiplied"}(SM||(SM={})),function(e){e.Destroyed="destroyed"}(BM||(BM={})),function(e){e.OutOfMemory="out-of-memory",e.Validation="validation"}(OM||(OM={}));var LM,UM,GM={PredefinedColorSpace:WR,PowerPreference:KR,FeatureName:JR,BufferUsage:ZR,MapMode:$R,TextureDimension:eM,TextureUsage:tM,TextureViewDimension:rM,TextureAspect:nM,TextureFormat:iM,AddressMode:oM,FilterMode:sM,CompareFunction:aM,ShaderStage:uM,BufferBindingType:cM,SamplerBindingType:lM,TextureSampleType:hM,StorageTextureAccess:pM,CompilationMessageType:dM,AutoLayoutMode:fM,PrimitiveTopology:AM,FrontFace:gM,CullMode:_M,ColorWriteFlags:mM,BlendFactor:yM,BlendOperation:EM,StencilOperation:xM,IndexFormat:CM,VertexFormat:bM,InputStepMode:IM,ComputePassTimestampLocation:TM,RenderPassTimestampLocation:vM,LoadOp:RM,StoreOp:MM,QueryType:wM,CanvasCompositingAlphaMode:SM,DeviceLostReason:BM,ErrorFilter:OM};function QM(){}function kM(e){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=kM._Counter++;return this._buffer=e,this}function zM(e){var t=VR.call(this,null)||this;return t.metadata=null,t.reservedDataStore=null,t._hasAlpha=!1,t._getAlphaFromRGB=!1,t.level=1,t._coordinatesIndex=0,t._coordinatesMode=cp.TEXTURE_EXPLICIT_MODE,t.wrapR=cp.TEXTURE_WRAP_ADDRESSMODE,t.anisotropicFilteringLevel=zM.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,t._isCube=!1,t._gammaSpace=!0,t.invertZ=!1,t.lodLevelInAlpha=!1,t.isRenderTarget=!1,t._prefiltered=!1,t._forceSerialize=!1,t.animations=new Array,t.onDisposeObservable=new UR,t._onDisposeObserver=null,t._scene=null,t._uid=null,t._parentContainer=null,t._loadingError=!1,e?zM._IsScene(e)?t._scene=e:t._engine=e:t._scene=EngineStore.LastCreatedScene,t._scene&&(t.uniqueId=t._scene.getUniqueId(),t._scene.addTexture(t),t._engine=t._scene.getEngine()),t._uid=null,t}function jM(e,t,r,n,i,o,s,a,u,c,l,h,p,d){void 0===i&&(i=jM.TRILINEAR_SAMPLINGMODE),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===u&&(u=!1);var f,A,g,_,m,y,E,x,C,b,I=this;(I=zM.call(this,t)||this).url=null,I.uOffset=0,I.vOffset=0,I.uScale=1,I.vScale=1,I.uAng=0,I.vAng=0,I.wAng=0,I.uRotationCenter=.5,I.vRotationCenter=.5,I.wRotationCenter=.5,I.homogeneousRotationInUVTransform=!1,I.inspectableCustomProperties=null,I._noMipmap=!1,I._invertY=!1,I._rowGenerationMatrix=null,I._cachedTextureMatrix=null,I._projectionModeMatrix=null,I._t0=null,I._t1=null,I._t2=null,I._cachedUOffset=-1,I._cachedVOffset=-1,I._cachedUScale=0,I._cachedVScale=0,I._cachedUAng=-1,I._cachedVAng=-1,I._cachedWAng=-1,I._cachedProjectionMatrixId=-1,I._cachedURotationCenter=-1,I._cachedVRotationCenter=-1,I._cachedWRotationCenter=-1,I._cachedHomogeneousRotationInUVTransform=!1,I._cachedCoordinatesMode=-1,I._buffer=null,I._deleteBuffer=!1,I._format=null,I._delayedOnLoad=null,I._delayedOnError=null,I.onLoadObservable=new UR,I._isBlocking=!0,I.name=e||"",I.url=e;var T=!1,v=null;"object"==typeof r&&null!==r?(b=null!==(f=r.noMipmap)&&void 0!==f&&f,n=null!==(A=r.invertY)&&void 0!==A&&A,i=null!==(g=r.samplingMode)&&void 0!==g?g:jM.TRILINEAR_SAMPLINGMODE,o=null!==(_=r.onLoad)&&void 0!==_?_:null,s=null!==(m=r.onError)&&void 0!==m?m:null,a=null!==(y=r.buffer)&&void 0!==y?y:null,u=null!==(E=r.deleteBuffer)&&void 0!==E&&E,c=r.format,l=r.mimeType,h=r.loaderOptions,p=r.creationFlags,T=null!==(x=r.useSRGBBuffer)&&void 0!==x&&x,v=null!==(C=r.internalTexture)&&void 0!==C?C:null):b=!!r,I._noMipmap=b,I._invertY=void 0!==n&&n,I._initialSamplingMode=i,I._buffer=a,I._deleteBuffer=u,I._mimeType=l,I._loaderOptions=h,I._creationFlags=p,I._useSRGBBuffer=T,I._forcedExtension=d,c&&(I._format=c);var R=I.getScene(),M=I._getEngine();if(!M)return I;M.onBeforeTextureInitObservable.notifyObservers(I);var w=function(){I._texture&&(I._texture._invertVScale&&(I.vScale*=-1,I.vOffset+=1),null!==I._texture._cachedWrapU&&(I.wrapU=I._texture._cachedWrapU,I._texture._cachedWrapU=null),null!==I._texture._cachedWrapV&&(I.wrapV=I._texture._cachedWrapV,I._texture._cachedWrapV=null),null!==I._texture._cachedWrapR&&(I.wrapR=I._texture._cachedWrapR,I._texture._cachedWrapR=null)),I.onLoadObservable.hasObservers()&&I.onLoadObservable.notifyObservers(I),o&&o(),!I.isBlocking&&R&&R.resetCachedMaterial()},S=function(e,t){I._loadingError=!0,I._errorObject={message:e,exception:t},s&&s(e,t),jM.OnTextureLoadErrorObservable.notifyObservers(I)};if(!I.url)return I._delayedOnLoad=w,I._delayedOnError=S,I;if(I._texture=null!=v?v:I._getFromCache(I.url,b,i,I._invertY,T),I._texture)if(I._texture.isReady)_Misc_timingTools__WEBPACK_IMPORTED_MODULE_8__.TimingTools.SetImmediate((function(){return w()}));else{var B=I._texture.onLoadedObservable.add(w);I._texture.onErrorObservable.add((function(e){var t;S(e.message,e.exception),null===(t=I._texture)||void 0===t||t.onLoadedObservable.remove(B)}))}else if(R&&R.useDelayedTextureLoading)I.delayLoadState=cp.DELAYLOADSTATE_NOTLOADED,I._delayedOnLoad=w,I._delayedOnError=S;else{try{I._texture=M.createTexture(I.url,b,I._invertY,R,i,w,S,I._buffer,void 0,I._format,I._forcedExtension,l,h,p,T)}catch(e){throw S("error loading",e),e}u&&(I._buffer=null)}return I}function HM(){}function qM(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A,g){void 0===i&&(i=!0),void 0===o&&(o=cp.TEXTURETYPE_UNSIGNED_INT),void 0===s&&(s=!1),void 0===a&&(a=jM.TRILINEAR_SAMPLINGMODE),void 0===u&&(u=!0),void 0===c&&(c=!1),void 0===l&&(l=!1),void 0===h&&(h=cp.TEXTUREFORMAT_RGBA),void 0===p&&(p=!1),void 0===A&&(A=!1),void 0===g&&(g=!1);var _,m=this;if((m=jM.call(this,null,r,!n,void 0,a,void 0,void 0,void 0,void 0,h)||this).renderParticles=!0,m.renderSprites=!1,m.ignoreCameraViewport=!1,m.onBeforeBindObservable=new UR,m.onAfterUnbindObservable=new UR,m.onBeforeRenderObservable=new UR,m.onAfterRenderObservable=new UR,m.onClearObservable=new UR,m.onResizeObservable=new UR,m._cleared=!1,m.skipInitialClear=!1,m._currentRefreshId=-1,m._refreshRate=1,m._samples=1,m._canRescale=!0,m._renderTarget=null,m.boundingBoxPosition=_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Vector3.Zero(),!(r=m.getScene()))return m;var y=m.getScene().getEngine();return m._coordinatesMode=jM.PROJECTION_MODE,m.renderList=new Array,m.name=e,m.isRenderTarget=!0,m._initialSizeParameter=t,m._renderPassIds=[],m._isCubeData=s,m._processSizeParameter(t),m.renderPassId=m._renderPassIds[0],m._resizeObserver=y.onResizeObservable.add((function(){})),m._generateMipMaps=!!n,m._doNotChangeAspectRatio=i,m._renderingManager=new _Rendering_renderingManager__WEBPACK_IMPORTED_MODULE_6__.RenderingManager(r),m._renderingManager._useSceneAutoClearSetup=!0,l||(m._renderTargetOptions={generateMipMaps:n,type:o,format:null!==(_=m._format)&&void 0!==_?_:void 0,samplingMode:m.samplingMode,generateDepthBuffer:u,generateStencilBuffer:c,samples:d,creationFlags:f,noColorTarget:A,useSRGBBuffer:g},m.samplingMode===jM.NEAREST_SAMPLINGMODE&&(m.wrapU=jM.CLAMP_ADDRESSMODE,m.wrapV=jM.CLAMP_ADDRESSMODE),p||(s?(m._renderTarget=r.getEngine().createRenderTargetCubeTexture(m.getRenderSize(),m._renderTargetOptions),m.coordinatesMode=jM.INVCUBIC_MODE,m._textureMatrix=_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.Identity()):m._renderTarget=r.getEngine().createRenderTargetTexture(m._size,m._renderTargetOptions),m._texture=m._renderTarget.texture,void 0!==d&&(m.samples=d))),m}QM.WithinEpsilon=function(e,t,r){return void 0===r&&(r=1401298e-51),Math.abs(e-t)<=r},QM.ToHex=function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()},QM.Sign=function(e){return 0===(e=+e)||isNaN(e)?e:e>0?1:-1},QM.Clamp=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=1),Math.min(r,Math.max(t,e))},QM.Log2=function(e){return Math.log(e)*Math.LOG2E},QM.ILog2=function(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(0===e)return-1/0;var t=0;if(e<1){for(;e<1;)t++,e*=2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t},QM.Repeat=function(e,t){return e-Math.floor(e/t)*t},QM.Normalize=function(e,t,r){return(e-t)/(r-t)},QM.Denormalize=function(e,t,r){return e*(r-t)+t},QM.DeltaAngle=function(e,t){var r=QM.Repeat(t-e,360);return r>180&&(r-=360),r},QM.PingPong=function(e,t){var r=QM.Repeat(e,2*t);return t-Math.abs(r-t)},QM.SmoothStep=function(e,t,r){var n=QM.Clamp(r);return t*(n=-2*n*n*n+3*n*n)+e*(1-n)},QM.MoveTowards=function(e,t,r){return Math.abs(t-e)<=r?t:e+QM.Sign(t-e)*r},QM.MoveTowardsAngle=function(e,t,r){var n=QM.DeltaAngle(e,t),i=0;return-r<n&&n<r?i=t:(t=e+n,i=QM.MoveTowards(e,t,r)),i},QM.Lerp=function(e,t,r){return e+(t-e)*r},QM.LerpAngle=function(e,t,r){var n=QM.Repeat(t-e,360);return n>180&&(n-=360),e+n*QM.Clamp(r)},QM.InverseLerp=function(e,t,r){return e!=t?QM.Clamp((r-e)/(t-e)):0},QM.Hermite=function(e,t,r,n,i){var o=i*i,s=i*o;return e*(2*s-3*o+1)+r*(-2*s+3*o)+t*(s-2*o+i)+n*(s-o)},QM.Hermite1stDerivative=function(e,t,r,n,i){var o=i*i;return 6*(o-i)*e+(3*o-4*i+1)*t+6*(-o+i)*r+(3*o-2*i)*n},QM.RandomRange=function(e,t){return e===t?e:Math.random()*(t-e)+e},QM.RangeToPercent=function(e,t,r){return(e-t)/(r-t)},QM.PercentToRange=function(e,t,r){return(r-t)*e+t},QM.NormalizeRadians=function(e){return e-=QM.TwoPi*Math.floor((e+Math.PI)/QM.TwoPi)},QM.HCF=function(e,t){var r=e%t;return 0===r?t:QM.HCF(t,r)},QM.TwoPi=2*Math.PI,Object.defineProperty(kM.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),kM._Counter=0,VR&&(zM.__proto__=VR),zM.prototype=Object.create(VR&&VR.prototype),zM.prototype.constructor=VR,Object.defineProperty(zM.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(e){var t=this;this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(cp.MATERIAL_TextureDirtyFlag,(function(e){return e.hasTexture(t)})))},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"getAlphaFromRGB",{get:function(){return this._getAlphaFromRGB},set:function(e){var t=this;this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(cp.MATERIAL_TextureDirtyFlag,(function(e){return e.hasTexture(t)})))},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"coordinatesIndex",{get:function(){return this._coordinatesIndex},set:function(e){var t=this;this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(cp.MATERIAL_TextureDirtyFlag,(function(e){return e.hasTexture(t)})))},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(e){var t=this;this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(cp.MATERIAL_TextureDirtyFlag,(function(e){return e.hasTexture(t)})))},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"wrapU",{get:function(){return this._wrapU},set:function(e){this._wrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"wrapV",{get:function(){return this._wrapV},set:function(e){this._wrapV=e},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"isCube",{get:function(){return this._texture?this._texture.isCube:this._isCube},set:function(e){this._texture?this._texture.isCube=e:this._isCube=e},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(e){this._texture&&(this._texture.is2DArray=e)},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"gammaSpace",{get:function(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace},set:function(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},set:function(e){this._texture&&(this._texture._isRGBD=e)},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"noMipmap",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(e){this._texture&&(this._texture._lodGenerationOffset=e)},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(e){this._texture&&(this._texture._lodGenerationScale=e)},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(e){this._texture&&(this._texture._linearSpecularLOD=e)},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(e){this._texture&&(this._texture._irradianceTexture=e)},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"uid",{get:function(){return this._uid||(this._uid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))),this._uid},enumerable:!1,configurable:!0}),zM.prototype.toString=function(){return this.name},zM.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(zM.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"isBlocking",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"loadingError",{get:function(){return this._loadingError},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!1,configurable:!0}),zM.prototype.getScene=function(){return this._scene},zM.prototype._getEngine=function(){return this._engine},zM.prototype.checkTransformsAreIdentical=function(e){return null!==e},zM.prototype.getTextureMatrix=function(){return _Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.IdentityReadOnly},zM.prototype.getReflectionTextureMatrix=function(){return _Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.IdentityReadOnly},zM.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()||this.loadingError},zM.prototype.scale=function(e){},Object.defineProperty(zM.prototype,"canRescale",{get:function(){return!1},enumerable:!1,configurable:!0}),zM.prototype._getFromCache=function(e,t,r,n,i){var o=this._getEngine();if(!o)return null;for(var s=o._getUseSRGBBuffer(!!i,t),a=o.getLoadedTexturesCache(),u=0;u<a.length;u++){var c=a[u];if((void 0===i||s===c._useSRGBBuffer)&&!(void 0!==n&&n!==c.invertY||c.url!==e||c.generateMipMaps!==!t||r&&r!==c.samplingMode))return c.incrementReferences(),c}return null},zM.prototype._rebuild=function(){},zM.prototype.clone=function(){return null},Object.defineProperty(zM.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:cp.TEXTURETYPE_UNSIGNED_INT},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:cp.TEXTUREFORMAT_RGBA},enumerable:!1,configurable:!0}),zM.prototype._markAllSubMeshesAsTexturesDirty=function(){var e=this.getScene();e&&e.markAllMaterialsAsDirty(cp.MATERIAL_TextureDirtyFlag)},zM.prototype.readPixels=function(e,t,r,n,i,o,s,a,u){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=null),void 0===n&&(n=!0),void 0===i&&(i=!1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=Number.MAX_VALUE),void 0===u&&(u=Number.MAX_VALUE),!this._texture)return null;var c=this._getEngine();if(!c)return null;var l=this.getSize(),h=l.width,p=l.height;0!==t&&(h/=Math.pow(2,t),p/=Math.pow(2,t),h=Math.round(h),p=Math.round(p)),a=Math.min(h,a),u=Math.min(p,u);try{return this._texture.isCube?c._readTexturePixels(this._texture,a,u,e,t,r,n,i,o,s):c._readTexturePixels(this._texture,a,u,-1,t,r,n,i,o,s)}catch(e){return null}},zM.prototype._readPixelsSync=function(e,t,r,n,i){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=null),void 0===n&&(n=!0),void 0===i&&(i=!1),!this._texture)return null;var o=this.getSize(),s=o.width,a=o.height,u=this._getEngine();if(!u)return null;0!=t&&(s/=Math.pow(2,t),a/=Math.pow(2,t),s=Math.round(s),a=Math.round(a));try{return this._texture.isCube?u._readTexturePixelsSync(this._texture,s,a,e,t,r,n,i):u._readTexturePixelsSync(this._texture,s,a,-1,t,r,n,i)}catch(e){return null}},Object.defineProperty(zM.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!1,configurable:!0}),Object.defineProperty(zM.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!1,configurable:!0}),zM.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){var t=this._parentContainer.textures.indexOf(this);t>-1&&this._parentContainer.textures.splice(t,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,_super.prototype.dispose.call(this)},zM.prototype.serialize=function(){if(!this.name)return null;var e=_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Serialize(this);return _Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.AppendSerializedAnimations(this,e),e},zM.WhenAllReady=function(e,t){var r=e.length;if(0!==r)for(var n=0;n<e.length;n++){var i=e[n];if(i.isReady())0==--r&&t();else{var o=i.onLoadObservable;o?o.addOnce((function(){0==--r&&t()})):0==--r&&t()}}else t()},zM._IsScene=function(e){return"Scene"===e.getClassName()},zM.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,zM&&(jM.__proto__=zM),jM.prototype=Object.create(zM&&zM.prototype),jM.prototype.constructor=zM,Object.defineProperty(jM.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(jM.prototype,"mimeType",{get:function(){return this._mimeType},enumerable:!1,configurable:!0}),Object.defineProperty(jM.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!1,configurable:!0}),Object.defineProperty(jM.prototype,"invertY",{get:function(){return this._invertY},enumerable:!1,configurable:!0}),jM.prototype.updateURL=function(e,t,r,n){void 0===t&&(t=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(cp.MATERIAL_TextureDirtyFlag)),this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=n,this.delayLoadState=cp.DELAYLOADSTATE_NOTLOADED,r&&(this._delayedOnLoad=r),this.delayLoad()},jM.prototype.delayLoad=function(){if(this.delayLoadState===cp.DELAYLOADSTATE_NOTLOADED){var e=this.getScene();e&&(this.delayLoadState=cp.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer),this._texture?this._delayedOnLoad&&(this._texture.isReady?_Misc_timingTools__WEBPACK_IMPORTED_MODULE_8__.TimingTools.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}},jM.prototype._prepareRowForTextureGeneration=function(e,t,r,n){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,r-=this.wRotationCenter,_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Vector3.TransformCoordinatesFromFloatsToRef(e,t,r,this._rowGenerationMatrix,n),n.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,n.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,n.z+=this.wRotationCenter},jM.prototype.checkTransformsAreIdentical=function(e){return null!==e&&this.uOffset===e.uOffset&&this.vOffset===e.vOffset&&this.uScale===e.uScale&&this.vScale===e.vScale&&this.uAng===e.uAng&&this.vAng===e.vAng&&this.wAng===e.wAng},jM.prototype.getTextureMatrix=function(e){var t=this;if(void 0===e&&(e=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.Zero(),this._rowGenerationMatrix=new _Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix,this._t0=_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Vector3.Zero(),this._t1=_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Vector3.Zero(),this._t2=_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Vector3.Zero()),_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.TmpVectors.Matrix[0]),_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.TmpVectors.Matrix[1]),_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.ScalingToRef(this._cachedUScale,this._cachedVScale,0,_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.TmpVectors.Matrix[2]),_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.TmpVectors.Matrix[3]),_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.TmpVectors.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.TmpVectors.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.TmpVectors.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.TmpVectors.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));var r=this.getScene();return r?(r.markAllMaterialsAsDirty(cp.MATERIAL_TextureDirtyFlag,(function(e){return e.hasTexture(t)})),this._cachedTextureMatrix):this._cachedTextureMatrix},jM.prototype.getReflectionTextureMatrix=function(){var e=this,t=this.getScene();if(!t)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==jM.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===t.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}this._cachedTextureMatrix||(this._cachedTextureMatrix=_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.Zero());var r=this._cachedCoordinatesMode!==this.coordinatesMode;switch(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case jM.PLANAR_MODE:_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case jM.PROJECTION_MODE:_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var n=t.getProjectionMatrix();this._cachedProjectionMatrixId=n.updateFlag,n.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:_Maths_math_vector__WEBPACK_IMPORTED_MODULE_3__.Matrix.IdentityToRef(this._cachedTextureMatrix)}return r&&t.markAllMaterialsAsDirty(cp.MATERIAL_TextureDirtyFlag,(function(t){return-1!==t.getActiveTextures().indexOf(e)})),this._cachedTextureMatrix},jM.prototype.clone=function(){var e=this,t={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return _Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Clone((function(){return new jM(e._texture?e._texture.url:null,e.getScene(),t)}),this)},jM.prototype.serialize=function(){var e=this.name;jM.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");var t=_super.prototype.serialize.call(this);return t?((jM.SerializeBuffers||jM.ForceSerializeBuffers)&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(t.base64String=this._buffer,t.name=t.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?t.base64String="data:image/png;base64,"+(0,_Misc_stringTools__WEBPACK_IMPORTED_MODULE_11__.EncodeArrayBufferToBase64)(this._buffer):(jM.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(t.base64String=!this._engine||this._engine._features.supportSyncTextureRead?(0,_Misc_copyTools__WEBPACK_IMPORTED_MODULE_12__.GenerateBase64StringFromTexture)(this):(0,_Misc_copyTools__WEBPACK_IMPORTED_MODULE_12__.GenerateBase64StringFromTextureAsync)(this))),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t._creationFlags=this._creationFlags,t._useSRGBBuffer=this._useSRGBBuffer,this.name=e,t):null},jM.prototype.getClassName=function(){return"Texture"},jM.prototype.dispose=function(){_super.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},jM.Parse=function(e,t,r){if(e.customType){var n=_Misc_instantiationTools__WEBPACK_IMPORTED_MODULE_9__.InstantiationTools.Instantiate(e.customType).Parse(e,t,r);return e.samplingMode&&n.updateSamplingMode&&n._samplingMode&&n._samplingMode!==e.samplingMode&&n.updateSamplingMode(e.samplingMode),n}if(e.isCube&&!e.isRenderTarget)return jM._CubeTextureParser(e,t,r);if(!e.name&&!e.isRenderTarget)return null;var i=function(){if(o&&o._texture&&(o._texture._cachedWrapU=null,o._texture._cachedWrapV=null,o._texture._cachedWrapR=null),e.samplingMode){var t=e.samplingMode;o&&o.samplingMode!==t&&o.updateSamplingMode(t)}if(o&&e.animations)for(var r=0;r<e.animations.length;r++){var n=e.animations[r],i=(0,_Misc_typeStore__WEBPACK_IMPORTED_MODULE_6__.GetClass)("BABYLON.Animation");i&&o.animations.push(i.Parse(n))}},o=_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Parse((function(){var n,o,s,a,u=!0;if(e.noMipmap&&(u=!1),e.mirrorPlane){var c=jM._CreateMirror(e.name,e.renderTargetSize,t,u);return c._waitingRenderList=e.renderList,c.mirrorPlane=_Maths_math_plane__WEBPACK_IMPORTED_MODULE_10__.Plane.FromArray(e.mirrorPlane),i(),c}if(e.isRenderTarget){var l=null;if(e.isCube){if(t.reflectionProbes)for(var h=0;h<t.reflectionProbes.length;h++){var p=t.reflectionProbes[h];if(p.name===e.name)return p.cubeTexture}}else(l=jM._CreateRenderTargetTexture(e.name,e.renderTargetSize,t,u,null!==(n=e._creationFlags)&&void 0!==n?n:0))._waitingRenderList=e.renderList;return i(),l}if(e.base64String)a=jM.CreateFromBase64String(e.base64String,e.name,t,!u,e.invertY,e.samplingMode,i,null!==(o=e._creationFlags)&&void 0!==o?o:0,null!==(s=e._useSRGBBuffer)&&void 0!==s&&s);else{var d=void 0;d=e.name&&e.name.indexOf("://")>0?e.name:r+e.name,e.url&&(e.url.startsWith("data:")||jM.UseSerializedUrlIfAny)&&(d=e.url),a=new jM(d,t,!u,e.invertY,e.samplingMode,i)}return a}),e,t);return o},jM.CreateFromBase64String=function(e,t,r,n,i,o,s,a,u,c){return void 0===o&&(o=jM.TRILINEAR_SAMPLINGMODE),void 0===s&&(s=null),void 0===a&&(a=null),void 0===u&&(u=cp.TEXTUREFORMAT_RGBA),new jM("data:"+t,r,n,i,o,s,a,e,!1,u,void 0,void 0,c)},jM.LoadFromDataString=function(e,t,r,n,i,o,s,a,u,c,l){return void 0===n&&(n=!1),void 0===o&&(o=!0),void 0===s&&(s=jM.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===u&&(u=null),void 0===c&&(c=cp.TEXTUREFORMAT_RGBA),"data:"!==e.substr(0,5)&&(e="data:"+e),new jM(e,r,i,o,s,a,u,t,n,c,void 0,void 0,l)},jM.SerializeBuffers=!0,jM.ForceSerializeBuffers=!1,jM.OnTextureLoadErrorObservable=new UR,jM._CubeTextureParser=function(e,t,r){throw(0,_Misc_devTools__WEBPACK_IMPORTED_MODULE_7__._WarnImport)("CubeTexture")},jM._CreateMirror=function(e,t,r,n){throw(0,_Misc_devTools__WEBPACK_IMPORTED_MODULE_7__._WarnImport)("MirrorTexture")},jM._CreateRenderTargetTexture=function(e,t,r,n,i){throw(0,_Misc_devTools__WEBPACK_IMPORTED_MODULE_7__._WarnImport)("RenderTargetTexture")},jM.NEAREST_SAMPLINGMODE=cp.TEXTURE_NEAREST_SAMPLINGMODE,jM.NEAREST_NEAREST_MIPLINEAR=cp.TEXTURE_NEAREST_NEAREST_MIPLINEAR,jM.BILINEAR_SAMPLINGMODE=cp.TEXTURE_BILINEAR_SAMPLINGMODE,jM.LINEAR_LINEAR_MIPNEAREST=cp.TEXTURE_LINEAR_LINEAR_MIPNEAREST,jM.TRILINEAR_SAMPLINGMODE=cp.TEXTURE_TRILINEAR_SAMPLINGMODE,jM.LINEAR_LINEAR_MIPLINEAR=cp.TEXTURE_LINEAR_LINEAR_MIPLINEAR,jM.NEAREST_NEAREST_MIPNEAREST=cp.TEXTURE_NEAREST_NEAREST_MIPNEAREST,jM.NEAREST_LINEAR_MIPNEAREST=cp.TEXTURE_NEAREST_LINEAR_MIPNEAREST,jM.NEAREST_LINEAR_MIPLINEAR=cp.TEXTURE_NEAREST_LINEAR_MIPLINEAR,jM.NEAREST_LINEAR=cp.TEXTURE_NEAREST_LINEAR,jM.NEAREST_NEAREST=cp.TEXTURE_NEAREST_NEAREST,jM.LINEAR_NEAREST_MIPNEAREST=cp.TEXTURE_LINEAR_NEAREST_MIPNEAREST,jM.LINEAR_NEAREST_MIPLINEAR=cp.TEXTURE_LINEAR_NEAREST_MIPLINEAR,jM.LINEAR_LINEAR=cp.TEXTURE_LINEAR_LINEAR,jM.LINEAR_NEAREST=cp.TEXTURE_LINEAR_NEAREST,jM.EXPLICIT_MODE=cp.TEXTURE_EXPLICIT_MODE,jM.SPHERICAL_MODE=cp.TEXTURE_SPHERICAL_MODE,jM.PLANAR_MODE=cp.TEXTURE_PLANAR_MODE,jM.CUBIC_MODE=cp.TEXTURE_CUBIC_MODE,jM.PROJECTION_MODE=cp.TEXTURE_PROJECTION_MODE,jM.SKYBOX_MODE=cp.TEXTURE_SKYBOX_MODE,jM.INVCUBIC_MODE=cp.TEXTURE_INVCUBIC_MODE,jM.EQUIRECTANGULAR_MODE=cp.TEXTURE_EQUIRECTANGULAR_MODE,jM.FIXED_EQUIRECTANGULAR_MODE=cp.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,jM.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=cp.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,jM.CLAMP_ADDRESSMODE=cp.TEXTURE_CLAMP_ADDRESSMODE,jM.WRAP_ADDRESSMODE=cp.TEXTURE_WRAP_ADDRESSMODE,jM.MIRROR_ADDRESSMODE=cp.TEXTURE_MIRROR_ADDRESSMODE,Object.defineProperty(HM,"BaseUrl",{get:function(){return _fileTools__WEBPACK_IMPORTED_MODULE_9__.FileToolsOptions.BaseUrl},set:function(e){_fileTools__WEBPACK_IMPORTED_MODULE_9__.FileToolsOptions.BaseUrl=e},enumerable:!1,configurable:!0}),Object.defineProperty(HM,"DefaultRetryStrategy",{get:function(){return _fileTools__WEBPACK_IMPORTED_MODULE_9__.FileToolsOptions.DefaultRetryStrategy},set:function(e){_fileTools__WEBPACK_IMPORTED_MODULE_9__.FileToolsOptions.DefaultRetryStrategy=e},enumerable:!1,configurable:!0}),Object.defineProperty(HM,"CorsBehavior",{get:function(){return _fileTools__WEBPACK_IMPORTED_MODULE_9__.FileToolsOptions.CorsBehavior},set:function(e){_fileTools__WEBPACK_IMPORTED_MODULE_9__.FileToolsOptions.CorsBehavior=e},enumerable:!1,configurable:!0}),Object.defineProperty(HM,"UseFallbackTexture",{get:function(){return _Engines_engineStore__WEBPACK_IMPORTED_MODULE_8__.EngineStore.UseFallbackTexture},set:function(e){_Engines_engineStore__WEBPACK_IMPORTED_MODULE_8__.EngineStore.UseFallbackTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(HM,"RegisteredExternalClasses",{get:function(){return _instantiationTools__WEBPACK_IMPORTED_MODULE_11__.InstantiationTools.RegisteredExternalClasses},set:function(e){_instantiationTools__WEBPACK_IMPORTED_MODULE_11__.InstantiationTools.RegisteredExternalClasses=e},enumerable:!1,configurable:!0}),Object.defineProperty(HM,"fallbackTexture",{get:function(){return _Engines_engineStore__WEBPACK_IMPORTED_MODULE_8__.EngineStore.FallbackTexture},set:function(e){_Engines_engineStore__WEBPACK_IMPORTED_MODULE_8__.EngineStore.FallbackTexture=e},enumerable:!1,configurable:!0}),HM.FetchToRef=function(e,t,r,n,i,o){var s=4*((Math.abs(e)*r%r|0)+(Math.abs(t)*n%n|0)*r);o.r=i[s]/255,o.g=i[s+1]/255,o.b=i[s+2]/255,o.a=i[s+3]/255},HM.Mix=function(e,t,r){return e*(1-r)+t*r},HM.Instantiate=function(e){return _instantiationTools__WEBPACK_IMPORTED_MODULE_11__.InstantiationTools.Instantiate(e)},HM.SetImmediate=function(e){_timingTools__WEBPACK_IMPORTED_MODULE_10__.TimingTools.SetImmediate(e)},HM.IsExponentOfTwo=function(e){var t=1;do{t*=2}while(t<e);return t===e},HM.FloatRound=function(e){return Math.fround?Math.fround(e):(HM._TmpFloatArray[0]=e,HM._TmpFloatArray[0])},HM.GetFilename=function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},HM.GetFolderPath=function(e,t){void 0===t&&(t=!1);var r=e.lastIndexOf("/");return r<0?t?e:"":e.substring(0,r+1)},HM.ToDegrees=function(e){return 180*e/Math.PI},HM.ToRadians=function(e){return e*Math.PI/180},HM.MakeArray=function(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null},HM.GetPointerPrefix=function(e){var t="pointer";return(0,_domManagement__WEBPACK_IMPORTED_MODULE_2__.IsWindowObjectExist)()&&!window.PointerEvent&&(t="mouse"),!e._badDesktopOS||e._badOS||document&&"ontouchend"in document||(t="mouse"),t},HM.SetCorsBehavior=function(e,t){t.crossOrigin="anonymous"},HM.CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},Object.defineProperty(HM,"PreprocessUrl",{get:function(){return _fileTools__WEBPACK_IMPORTED_MODULE_9__.FileToolsOptions.PreprocessUrl},set:function(e){_fileTools__WEBPACK_IMPORTED_MODULE_9__.FileToolsOptions.PreprocessUrl=e},enumerable:!1,configurable:!0}),HM.LoadImage=function(e,t,r,n,i,o){return(0,_fileTools__WEBPACK_IMPORTED_MODULE_9__.LoadImage)(e,t,r,n,i,o)},HM.LoadFile=function(e,t,r,n,i,o){return(0,_fileTools__WEBPACK_IMPORTED_MODULE_9__.LoadFile)(e,t,r,n,i,o)},HM.LoadFileAsync=function(e,t){return void 0===t&&(t=!0),new Promise((function(r,n){(0,_fileTools__WEBPACK_IMPORTED_MODULE_9__.LoadFile)(e,(function(e){r(e)}),void 0,void 0,t,(function(e,t){n(t)}))}))},HM.LoadScript=function(e,t,r,n){if("undefined"!=typeof window){var i=document.getElementsByTagName("head")[0],o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",e),n&&(o.id=n),o.onload=function(){t&&t()},o.onerror=function(t){r&&r("Unable to load script '".concat(e,"'"),t)},i.appendChild(o)}},HM.LoadScriptAsync=function(e){var t=this;return new Promise((function(r,n){t.LoadScript(e,(function(){r()}),(function(e,t){n(t)}))}))},HM.ReadFileAsDataURL=function(e,t,r){var n=new FileReader,i={onCompleteObservable:new _observable__WEBPACK_IMPORTED_MODULE_1__.Observable,abort:function(){return n.abort()}};return n.onloadend=function(){i.onCompleteObservable.notifyObservers(i)},n.onload=function(e){t(e.target.result)},n.onprogress=r,n.readAsDataURL(e),i},HM.ReadFile=function(e,t,r,n,i){return(0,_fileTools__WEBPACK_IMPORTED_MODULE_9__.ReadFile)(e,t,r,n,i)},HM.FileAsURL=function(e){var t=new Blob([e]);return(window.URL||window.webkitURL).createObjectURL(t)},HM.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},HM.DeepCopy=function(e,t,r,n){_deepCopier__WEBPACK_IMPORTED_MODULE_4__.DeepCopier.DeepCopy(e,t,r,n)},HM.IsEmpty=function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},HM.RegisterTopRootEvents=function(e,t){for(var r=0;r<t.length;r++){var n=t[r];e.addEventListener(n.name,n.handler,!1);try{window.parent&&window.parent.addEventListener(n.name,n.handler,!1)}catch(e){}}},HM.UnregisterTopRootEvents=function(e,t){for(var r=0;r<t.length;r++){var n=t[r];e.removeEventListener(n.name,n.handler);try{e.parent&&e.parent.removeEventListener(n.name,n.handler)}catch(e){}}},HM.DumpFramebuffer=function(e,t,r,n,i,o){return void 0===i&&(i="image/png"),(0,tslib__WEBPACK_IMPORTED_MODULE_0__.__awaiter)(this,void 0,void 0,(function(){var s,a;return(0,tslib__WEBPACK_IMPORTED_MODULE_0__.__generator)(this,(function(u){switch(u.label){case 0:return[4,r.readPixels(0,0,e,t)];case 1:return s=u.sent(),a=new Uint8Array(s.buffer),HM.DumpData(e,t,a,n,i,o,!0),[2]}}))}))},HM.DumpData=function(e,t,r,n,i,o,s,a,u){void 0===i&&(i="image/png"),void 0===s&&(s=!1),void 0===a&&(a=!1),HM._ScreenshotCanvas||(HM._ScreenshotCanvas=document.createElement("canvas")),HM._ScreenshotCanvas.width=e,HM._ScreenshotCanvas.height=t;var c=HM._ScreenshotCanvas.getContext("2d");if(c){if(r instanceof Float32Array){for(var l=new Uint8Array(r.length),h=r.length;h--;){var p=r[h];l[h]=p<0?0:p>1?1:Math.round(255*p)}r=l}var d=c.createImageData(e,t);d.data.set(r),c.putImageData(d,0,0);var f=HM._ScreenshotCanvas;if(s){var A=document.createElement("canvas");A.width=e,A.height=t;var g=A.getContext("2d");if(!g)return;g.translate(0,t),g.scale(1,-1),g.drawImage(HM._ScreenshotCanvas,0,0),f=A}a?HM.ToBlob(f,(function(e){var t=new FileReader;t.onload=function(e){var t=e.target.result;n&&n(t)},t.readAsArrayBuffer(e)}),i,u):HM.EncodeScreenshotCanvasData(n,i,o,f,u)}},HM.DumpDataAsync=function(e,t,r,n,i,o,s,a){return void 0===n&&(n="image/png"),void 0===o&&(o=!1),void 0===s&&(s=!1),new Promise((function(u){HM.DumpData(e,t,r,(function(e){return u(e)}),n,i,o,s,a)}))},HM.ToBlob=function(e,t,r,n){void 0===r&&(r="image/png"),e.toBlob||(e.toBlob=function(e,t,r){var n=this;setTimeout((function(){for(var i=atob(n.toDataURL(t,r).split(",")[1]),o=i.length,s=new Uint8Array(o),a=0;a<o;a++)s[a]=i.charCodeAt(a);e(new Blob([s]))}))}),e.toBlob((function(e){t(e)}),r,n)},HM.EncodeScreenshotCanvasData=function(e,t,r,n,i){(void 0===t&&(t="image/png"),e)?e((null!=n?n:HM._ScreenshotCanvas).toDataURL(t,i)):this.ToBlob(null!=n?n:HM._ScreenshotCanvas,(function(e){if("download"in document.createElement("a")){if(!r){var t=new Date,n=(t.getFullYear()+"-"+(t.getMonth()+1)).slice(2)+"-"+t.getDate()+"_"+t.getHours()+"-"+("0"+t.getMinutes()).slice(-2);r="screenshot_"+n+".png"}HM.Download(e,r)}else if(e){var i=URL.createObjectURL(e),o=window.open("");if(!o)return;var s=o.document.createElement("img");s.onload=function(){URL.revokeObjectURL(i)},s.src=i,o.document.body.appendChild(s)}}),t,i)},HM.Download=function(e,t){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(e,t);else{var r=window.URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=r,n.download=t,n.addEventListener("click",(function(){n.parentElement&&n.parentElement.removeChild(n)})),n.click(),window.URL.revokeObjectURL(r)}},HM.BackCompatCameraNoPreventDefault=function(e){return"boolean"==typeof e[0]?e[0]:"boolean"==typeof e[1]&&e[1]},HM.CreateScreenshot=function(e,t,r,n,i){throw(0,_devTools__WEBPACK_IMPORTED_MODULE_6__._WarnImport)("ScreenshotTools")},HM.CreateScreenshotAsync=function(e,t,r,n){throw(0,_devTools__WEBPACK_IMPORTED_MODULE_6__._WarnImport)("ScreenshotTools")},HM.CreateScreenshotUsingRenderTarget=function(e,t,r,n,i,o,s,a){throw(0,_devTools__WEBPACK_IMPORTED_MODULE_6__._WarnImport)("ScreenshotTools")},HM.CreateScreenshotUsingRenderTargetAsync=function(e,t,r,n,i,o,s){throw(0,_devTools__WEBPACK_IMPORTED_MODULE_6__._WarnImport)("ScreenshotTools")},HM.RandomId=function(){return(0,_guid__WEBPACK_IMPORTED_MODULE_12__.RandomGUID)()},HM.IsBase64=function(e){return(0,_fileTools__WEBPACK_IMPORTED_MODULE_9__.IsBase64DataUrl)(e)},HM.DecodeBase64=function(e){return(0,_fileTools__WEBPACK_IMPORTED_MODULE_9__.DecodeBase64UrlToBinary)(e)},Object.defineProperty(HM,"errorsCount",{get:function(){return _logger__WEBPACK_IMPORTED_MODULE_3__.Logger.errorsCount},enumerable:!1,configurable:!0}),HM.Log=function(e){_logger__WEBPACK_IMPORTED_MODULE_3__.Logger.Log(e)},HM.Warn=function(e){_logger__WEBPACK_IMPORTED_MODULE_3__.Logger.Warn(e)},HM.Error=function(e){_logger__WEBPACK_IMPORTED_MODULE_3__.Logger.Error(e)},Object.defineProperty(HM,"LogCache",{get:function(){return _logger__WEBPACK_IMPORTED_MODULE_3__.Logger.LogCache},enumerable:!1,configurable:!0}),HM.ClearLogCache=function(){_logger__WEBPACK_IMPORTED_MODULE_3__.Logger.ClearLogCache()},Object.defineProperty(HM,"LogLevels",{set:function(e){_logger__WEBPACK_IMPORTED_MODULE_3__.Logger.LogLevels=e},enumerable:!1,configurable:!0}),Object.defineProperty(HM,"PerformanceLogLevel",{set:function(e){return(e&HM.PerformanceUserMarkLogLevel)===HM.PerformanceUserMarkLogLevel?(HM.StartPerformanceCounter=HM._StartUserMark,void(HM.EndPerformanceCounter=HM._EndUserMark)):(e&HM.PerformanceConsoleLogLevel)===HM.PerformanceConsoleLogLevel?(HM.StartPerformanceCounter=HM._StartPerformanceConsole,void(HM.EndPerformanceCounter=HM._EndPerformanceConsole)):(HM.StartPerformanceCounter=HM._StartPerformanceCounterDisabled,void(HM.EndPerformanceCounter=HM._EndPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),HM._StartPerformanceCounterDisabled=function(e,t){},HM._EndPerformanceCounterDisabled=function(e,t){},HM._StartUserMark=function(e,t){if(void 0===t&&(t=!0),!HM._Performance){if(!(0,_domManagement__WEBPACK_IMPORTED_MODULE_2__.IsWindowObjectExist)())return;HM._Performance=window.performance}t&&HM._Performance.mark&&HM._Performance.mark(e+"-Begin")},HM._EndUserMark=function(e,t){void 0===t&&(t=!0),t&&HM._Performance.mark&&(HM._Performance.mark(e+"-End"),HM._Performance.measure(e,e+"-Begin",e+"-End"))},HM._StartPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(HM._StartUserMark(e,t),console.time&&console.time(e))},HM._EndPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(HM._EndUserMark(e,t),console.timeEnd(e))},Object.defineProperty(HM,"Now",{get:function(){return _precisionDate__WEBPACK_IMPORTED_MODULE_5__.PrecisionDate.Now},enumerable:!1,configurable:!0}),HM.GetClassName=function(e,t){void 0===t&&(t=!1);var r=null;if(!t&&e.getClassName)r=e.getClassName();else{if(e instanceof Object)r=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__;r||(r=typeof e)}return r},HM.First=function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(t(i))return i}return null},HM.getFullClassName=function(e,t){void 0===t&&(t=!1);var r=null,n=null;if(!t&&e.getClassName)r=e.getClassName();else{if(e instanceof Object){var i=t?e:Object.getPrototypeOf(e);r=i.constructor.__bjsclassName__,n=i.constructor.__bjsmoduleName__}r||(r=typeof e)}return r?(null!=n?n+".":"")+r:null},HM.DelayAsync=function(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))},HM.IsSafari=function(){return!!(0,_domManagement__WEBPACK_IMPORTED_MODULE_2__.IsNavigatorAvailable)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},jM&&(qM.__proto__=jM),qM.prototype=Object.create(jM&&jM.prototype),qM.prototype.constructor=jM,Object.defineProperty(qM.prototype,"renderList",{get:function(){return this._renderList},set:function(e){this._renderList=e,this._renderList&&this._hookArray(this._renderList)},enumerable:!1,configurable:!0}),qM.prototype._hookArray=function(e){var t=this,r=e.push;e.push=function(){for(var n,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var s=0===e.length,a=r.apply(e,i);return s&&(null===(n=t.getScene())||void 0===n||n.meshes.forEach((function(e){e._markSubMeshesAsLightDirty()}))),a};var n=e.splice;e.splice=function(r,i){var o,s=n.apply(e,[r,i]);return 0===e.length&&(null===(o=t.getScene())||void 0===o||o.meshes.forEach((function(e){e._markSubMeshesAsLightDirty()}))),s}},Object.defineProperty(qM.prototype,"postProcesses",{get:function(){return this._postProcesses},enumerable:!1,configurable:!0}),Object.defineProperty(qM.prototype,"_prePassEnabled",{get:function(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(qM.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(qM.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(qM.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(qM.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(qM.prototype,"renderPassIds",{get:function(){return this._renderPassIds},enumerable:!1,configurable:!0}),Object.defineProperty(qM.prototype,"currentRefreshId",{get:function(){return this._currentRefreshId},enumerable:!1,configurable:!0}),qM.prototype.setMaterialForRendering=function(e,t){var r;r=Array.isArray(e)?e:[e];for(var n=0;n<r.length;++n)for(var i=0;i<this._renderPassIds.length;++i)r[n].setMaterialForRenderPass(this._renderPassIds[i],void 0!==t?Array.isArray(t)?t[i]:t:void 0)},Object.defineProperty(qM.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!1,configurable:!0}),Object.defineProperty(qM.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!1,configurable:!0}),qM.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(qM.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(cp.MATERIAL_TextureDirtyFlag)}},enumerable:!1,configurable:!0}),Object.defineProperty(qM.prototype,"depthStencilTexture",{get:function(){var e,t;return null!==(t=null===(e=this._renderTarget)||void 0===e?void 0:e._depthStencilTexture)&&void 0!==t?t:null},enumerable:!1,configurable:!0}),qM.prototype.createDepthStencilTexture=function(e,t,r,n,i){var o;void 0===e&&(e=0),void 0===t&&(t=!0),void 0===r&&(r=!1),void 0===n&&(n=1),void 0===i&&(i=cp.TEXTUREFORMAT_DEPTH32_FLOAT),null===(o=this._renderTarget)||void 0===o||o.createDepthStencilTexture(e,t,r,n,i)},qM.prototype._releaseRenderPassId=function(){if(this._scene)for(var e=this._scene.getEngine(),t=0;t<this._renderPassIds.length;++t)e.releaseRenderPassId(this._renderPassIds[t]);this._renderPassIds=[]},qM.prototype._createRenderPassId=function(){this._releaseRenderPassId();for(var e=this._scene.getEngine(),t=this._isCubeData?6:this.getRenderLayers()||1,r=0;r<t;++r)this._renderPassIds[r]=e.createRenderPassId("RenderTargetTexture - ".concat(this.name,"#").concat(r))},qM.prototype._processSizeParameter=function(e){if(e.ratio){this._sizeRatio=e.ratio;var t=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(t.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(t.getRenderHeight(),this._sizeRatio)}}else this._size=e;this._createRenderPassId()},Object.defineProperty(qM.prototype,"samples",{get:function(){var e,t;return null!==(t=null===(e=this._renderTarget)||void 0===e?void 0:e.samples)&&void 0!==t?t:this._samples},set:function(e){this._renderTarget&&(this._samples=this._renderTarget.setSamples(e))},enumerable:!1,configurable:!0}),qM.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(qM.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),qM.prototype.addPostProcess=function(e){if(!this._postProcessManager){var t=this.getScene();if(!t)return;this._postProcessManager=new _PostProcesses_postProcessManager__WEBPACK_IMPORTED_MODULE_5__.PostProcessManager(t),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1},qM.prototype.clearPostProcesses=function(e){if(void 0===e&&(e=!1),this._postProcesses){if(e)for(var t=0,r=this._postProcesses;t<r.length;t++){r[t].dispose()}this._postProcesses=[]}},qM.prototype.removePostProcess=function(e){if(this._postProcesses){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},qM.prototype._shouldRender=function(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},qM.prototype.getRenderSize=function(){return this.getRenderWidth()},qM.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},qM.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},qM.prototype.getRenderLayers=function(){var e=this._size.layers;return e||0},qM.prototype.disableRescaling=function(){this._canRescale=!1},Object.defineProperty(qM.prototype,"canRescale",{get:function(){return this._canRescale},enumerable:!1,configurable:!0}),qM.prototype.scale=function(e){var t=Math.max(1,this.getRenderSize()*e);this.resize(t)},qM.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:_super.prototype.getReflectionTextureMatrix.call(this)},qM.prototype.resize=function(e){var t,r=this.isCube;null===(t=this._renderTarget)||void 0===t||t.dispose(),this._renderTarget=null;var n=this.getScene();n&&(this._processSizeParameter(e),this._renderTarget=r?n.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):n.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},qM.prototype.render=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this._render(e,t)},qM.prototype.isReadyForRendering=function(){return this._render(!1,!1,!0)},qM.prototype._render=function(e,t,r){var n;void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===r&&(r=!1);var i=this.getScene();if(!i)return r;var o=i.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var s=0;s<this._waitingRenderList.length;s++){var a=this._waitingRenderList[s];(l=i.getMeshById(a))&&this.renderList.push(l)}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];var u=this.getScene();if(!u)return r;var c=u.meshes;for(s=0;s<c.length;s++){var l=c[s];this.renderListPredicate(l)&&this.renderList.push(l)}}var h=o.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);var p=null!==(n=this.activeCamera)&&void 0!==n?n:i.activeCamera;p&&(p!==i.activeCamera&&i.setTransformMatrix(p.getViewMatrix(),p.getProjectionMatrix(!0)),o.setViewport(p.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;var d=r;if(r){i.getViewMatrix()||i.updateTransformMatrix();var f=this.is2DArray?this.getRenderLayers():this.isCube?6:1;for(y=0;y<f&&d;y++){var A=null,g=this.renderList?this.renderList:i.getActiveMeshes().data,_=this.renderList?this.renderList.length:i.getActiveMeshes().length;o.currentRenderPassId=this._renderPassIds[y],this.onBeforeRenderObservable.notifyObservers(y),this.getCustomRenderList&&(A=this.getCustomRenderList(y,g,_)),A||(A=g),this._doNotChangeAspectRatio||i.updateTransformMatrix(!0);for(var m=0;m<A.length&&d;++m){if((l=A[m]).isEnabled()&&!l.isBlocked&&l.isVisible&&l.subMeshes)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(l,this.refreshRate)){d=!1;break}}else if(!l.isReady(!0)){d=!1;break}}this.onAfterRenderObservable.notifyObservers(y)}}else if(this.is2DArray)for(var y=0;y<this.getRenderLayers();y++)this._renderToTarget(0,e,t,y,p),i.incrementRenderId(),i.resetCachedMaterial();else if(this.isCube)for(var E=0;E<6;E++)this._renderToTarget(E,e,t,void 0,p),i.incrementRenderId(),i.resetCachedMaterial();else this._renderToTarget(0,e,t,void 0,p);return this.onAfterUnbindObservable.notifyObservers(this),o.currentRenderPassId=h,i.activeCamera&&((i.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==i.activeCamera)&&i.setTransformMatrix(i.activeCamera.getViewMatrix(),i.activeCamera.getProjectionMatrix(!0)),o.setViewport(i.activeCamera.viewport)),i.resetCachedMaterial(),d},qM.prototype._bestReflectionRenderTargetDimension=function(e,t){var r=e*t,n=_Engines_engine__WEBPACK_IMPORTED_MODULE_10__.Engine.NearestPOT(r+16384/(128+r));return Math.min(_Engines_engine__WEBPACK_IMPORTED_MODULE_10__.Engine.FloorPOT(e),n)},qM.prototype._prepareRenderingManager=function(e,t,r,n){var i=this.getScene();if(i){this._renderingManager.reset();for(var o=i.getRenderId(),s=0;s<t;s++){var a=e[s];if(a&&!a.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(a,this.refreshRate)){this.resetRefreshCounter();continue}}else if(!a.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!a._internalAbstractMeshDataInfo._currentLODIsUpToDate&&i.activeCamera&&(a._internalAbstractMeshDataInfo._currentLOD=i.customLODSelector?i.customLODSelector(a,this.activeCamera||i.activeCamera):a.getLOD(this.activeCamera||i.activeCamera),a._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!a._internalAbstractMeshDataInfo._currentLOD)continue;var u=a._internalAbstractMeshDataInfo._currentLOD;u._preActivateForIntermediateRendering(o);var c=void 0;if(c=!(!n||!r)&&!(a.layerMask&r.layerMask),a.isEnabled()&&a.isVisible&&a.subMeshes&&!c&&(u!==a&&u._activate(o,!0),a._activate(o,!0)&&a.subMeshes.length)){a.isAnInstance?a._internalAbstractMeshDataInfo._actAsRegularMesh&&(u=a):u._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,u._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var l=0;l<u.subMeshes.length;l++){var h=u.subMeshes[l];this._renderingManager.dispatch(h,u)}}}}for(var p=0;p<i.particleSystems.length;p++){var d=i.particleSystems[p],f=d.emitter;d.isStarted()&&f&&f.position&&f.isEnabled()&&(e.indexOf(f)>=0&&this._renderingManager.dispatchParticles(d))}}},qM.prototype._bindFrameBuffer=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var r=this.getScene();if(r){var n=r.getEngine();this._renderTarget&&n.bindFramebuffer(this._renderTarget,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}},qM.prototype._unbindFrameBuffer=function(e,t){var r=this;this._renderTarget&&e.unBindFramebuffer(this._renderTarget,this.isCube,(function(){r.onAfterRenderObservable.notifyObservers(t)}))},qM.prototype._prepareFrame=function(e,t,r,n){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):n&&e.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(t,r)},qM.prototype._renderToTarget=function(e,t,r,n,i){var o,s,a,u,c,l;void 0===n&&(n=0),void 0===i&&(i=null);var h=this.getScene();if(h){var p=h.getEngine();if(null===(o=p._debugPushGroup)||void 0===o||o.call(p,"render to face #".concat(e," layer #").concat(n),1),this._prepareFrame(h,e,n,t),this.is2DArray?(p.currentRenderPassId=this._renderPassIds[n],this.onBeforeRenderObservable.notifyObservers(n)):(p.currentRenderPassId=this._renderPassIds[e],this.onBeforeRenderObservable.notifyObservers(e)),p.snapshotRendering&&p.snapshotRenderingMode===cp.SNAPSHOTRENDERING_FAST)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(p):this.skipInitialClear||p.clear(this.clearColor||h.clearColor,!0,!0,!0);else{var d=null,f=this.renderList?this.renderList:h.getActiveMeshes().data,A=this.renderList?this.renderList.length:h.getActiveMeshes().length;this.getCustomRenderList&&(d=this.getCustomRenderList(this.is2DArray?n:e,f,A)),d?this._prepareRenderingManager(d,d.length,i,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(f,A,i,!this.renderList),this._defaultRenderListPrepared=!0),d=f);for(var g=0,_=h._beforeRenderTargetClearStage;g<_.length;g++){_[g].action(this,e,n)}this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(p):this.skipInitialClear||p.clear(this.clearColor||h.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||h.updateTransformMatrix(!0);for(var m=0,y=h._beforeRenderTargetDrawStage;m<y.length;m++){y[m].action(this,e,n)}this._renderingManager.render(this.customRenderFunction,d,this.renderParticles,this.renderSprites);for(var E=0,x=h._afterRenderTargetDrawStage;E<x.length;E++){x[E].action(this,e,n)}var C=null!==(a=null===(s=this._texture)||void 0===s?void 0:s.generateMipMaps)&&void 0!==a&&a;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,null!==(u=this._renderTarget)&&void 0!==u?u:void 0,e,this._postProcesses,this.ignoreCameraViewport):t&&h.postProcessManager._finalizeFrame(!1,null!==(c=this._renderTarget)&&void 0!==c?c:void 0,e),this._texture&&(this._texture.generateMipMaps=C),this._doNotChangeAspectRatio||h.updateTransformMatrix(!0),r&&HM.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),p)}this._unbindFrameBuffer(p,e),this._texture&&this.isCube&&5===e&&p.generateMipMapsForCubemap(this._texture),null===(l=p._debugPopGroup)||void 0===l||l.call(p,1)}},qM.prototype.setRenderingOrder=function(e,t,r,n){void 0===t&&(t=null),void 0===r&&(r=null),void 0===n&&(n=null),this._renderingManager.setRenderingOrder(e,t,r,n)},qM.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1},qM.prototype.clone=function(){var e=this.getSize(),t=new qM(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t},qM.prototype.serialize=function(){if(!this.name)return null;var e=_super.prototype.serialize.call(this);if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(var t=0;t<this.renderList.length;t++)e.renderList.push(this.renderList[t].id);return e},qM.prototype.disposeFramebufferObjects=function(){var e;null===(e=this._renderTarget)||void 0===e||e.dispose(!0)},qM.prototype.releaseInternalTexture=function(){var e;null===(e=this._renderTarget)||void 0===e||e.releaseTextures(),this._texture=null},qM.prototype.dispose=function(){var e;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var t=this.getScene();if(t){var r=t.customRenderTargets.indexOf(this);r>=0&&t.customRenderTargets.splice(r,1);for(var n=0,i=t.cameras;n<i.length;n++){var o=i[n];(r=o.customRenderTargets.indexOf(this))>=0&&o.customRenderTargets.splice(r,1)}null===(e=this._renderTarget)||void 0===e||e.dispose(),this._renderTarget=null,this._texture=null,_super.prototype.dispose.call(this)}},qM.prototype._rebuild=function(){this.refreshRate===qM.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=qM.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},qM.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},qM.prototype.getViewCount=function(){return 1},qM.REFRESHRATE_RENDER_ONCE=0,qM.REFRESHRATE_RENDER_ONEVERYFRAME=1,qM.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,jM._CreateRenderTargetTexture=function(e,t,r,n,i){return new qM(e,t,r,n)};var VM={CreateResizedCopy:function(e,t,r,n){void 0===n&&(n=!0);var i=e.getScene(),o=i.getEngine(),s=new qM("resized"+e.name,{width:t,height:r},i,!e.noMipmap,!0,e._texture.type,!1,e.samplingMode,!1);s.wrapU=e.wrapU,s.wrapV=e.wrapV,s.uOffset=e.uOffset,s.vOffset=e.vOffset,s.uScale=e.uScale,s.vScale=e.vScale,s.uAng=e.uAng,s.vAng=e.vAng,s.wAng=e.wAng,s.coordinatesIndex=e.coordinatesIndex,s.level=e.level,s.anisotropicFilteringLevel=e.anisotropicFilteringLevel,s._texture.isReady=!1,e.wrapU=jM.CLAMP_ADDRESSMODE,e.wrapV=jM.CLAMP_ADDRESSMODE;var a=new _PostProcesses_passPostProcess__WEBPACK_IMPORTED_MODULE_2__.PassPostProcess("pass",1,null,n?jM.BILINEAR_SAMPLINGMODE:jM.NEAREST_SAMPLINGMODE,o,!1,cp.TEXTURETYPE_UNSIGNED_INT);return a.externalTextureSamplerBinding=!0,a.getEffect().executeWhenCompiled((function(){a.onApply=function(t){t.setTexture("textureSampler",e)};var t=s.renderTarget;t&&(i.postProcessManager.directRender([a],t),o.unBindFramebuffer(t),s.disposeFramebufferObjects(),a.dispose(),s.getInternalTexture().isReady=!0)})),s},ApplyPostProcess:function(e,t,r,n,i,o){var s=t.getEngine();return t.isReady=!1,i=null!=i?i:t.samplingMode,n=null!=n?n:t.type,o=null!=o?o:t.format,-1===n&&(n=cp.TEXTURETYPE_UNSIGNED_BYTE),new Promise((function(a){var u=new _PostProcesses_postProcess__WEBPACK_IMPORTED_MODULE_4__.PostProcess("postprocess",e,null,null,1,null,i,s,!1,void 0,n,void 0,null,!1,o);u.externalTextureSamplerBinding=!0;var c=s.createRenderTargetTexture({width:t.width,height:t.height},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:i,type:n,format:o});u.getEffect().executeWhenCompiled((function(){u.onApply=function(e){e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},r.postProcessManager.directRender([u],c,!0),s.restoreDefaultFramebuffer(),s._releaseTexture(t),u&&u.dispose(),c._swapAndDie(t),t.type=n,t.format=cp.TEXTUREFORMAT_RGBA,t.isReady=!0,a(t)}))}))},ToHalfFloat:function(e){LM||(LM=new Float32Array(1),UM=new Int32Array(LM.buffer)),LM[0]=e;var t=UM[0],r=t>>16&32768,n=t>>12&2047,i=t>>23&255;return i<103?r:i>142?(r|=31744,r|=(255==i?0:1)&&8388607&t):i<113?r|=((n|=2048)>>114-i)+(n>>113-i&1):(r|=i-112<<10|n>>1,r+=1&n)},FromHalfFloat:function(e){var t=(32768&e)>>15,r=(31744&e)>>10,n=1023&e;return 0===r?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):31==r?n?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,r-15)*(1+n/Math.pow(2,10))}};function YM(e){void 0===e&&(e=!0),this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}function XM(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}function WM(){}function KM(){return"undefined"!=typeof window}function JM(){return"undefined"!=typeof document}function ZM(){}function $M(e){void 0===e&&(e=!0),this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}Object.defineProperty(YM.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(YM.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(YM.prototype,"zOffsetUnits",{get:function(){return this._zOffsetUnits},set:function(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(YM.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(YM.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(YM.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(YM.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(YM.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(YM.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),YM.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1},YM.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},Object.defineProperty(XM.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(XM.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),XM.prototype.setAlphaBlendConstants=function(e,t,r,n){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===r&&this._blendConstants[3]===n||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=r,this._blendConstants[3]=n,this._isBlendConstantsDirty=!0)},XM.prototype.setAlphaBlendFunctionParameters=function(e,t,r,n){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===r&&this._blendFunctionParameters[3]===n||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=r,this._blendFunctionParameters[3]=n,this._isBlendFunctionParametersDirty=!0)},XM.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},XM.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},XM.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},WM._CheckLimit=function(e,t){var r=WM._LogLimitOutputs[e];return r?r.current++:(r={limit:t,current:1},WM._LogLimitOutputs[e]=r),r.current<=r.limit},WM._GenerateLimitMessage=function(e,t){var r=WM._LogLimitOutputs[e];if(r&&WM.MessageLimitReached&&r.current===r.limit)switch(t){case 0:WM.Log(WM.MessageLimitReached.replace(/%LIMIT%/g,""+r.limit).replace(/%TYPE%/g,"log"));break;case 1:WM.Warn(WM.MessageLimitReached.replace(/%LIMIT%/g,""+r.limit).replace(/%TYPE%/g,"warning"));break;case 2:WM.Error(WM.MessageLimitReached.replace(/%LIMIT%/g,""+r.limit).replace(/%TYPE%/g,"error"))}},WM._AddLogEntry=function(e){WM._LogCache=e+WM._LogCache,WM.OnNewCacheEntry&&WM.OnNewCacheEntry(e)},WM._FormatMessage=function(e){var t=function(e){return e<10?"0"+e:""+e},r=new Date;return"["+t(r.getHours())+":"+t(r.getMinutes())+":"+t(r.getSeconds())+"]: "+e},WM._LogDisabled=function(e,t){},WM._LogEnabled=function(e,t){if(void 0===t||WM._CheckLimit(e,t)){var r=WM._FormatMessage(e);console.log("BJS - "+r);var n="<div style='color:white'>"+r+"</div><br>";WM._AddLogEntry(n),WM._GenerateLimitMessage(e,0)}},WM._WarnDisabled=function(e,t){},WM._WarnEnabled=function(e,t){if(void 0===t||WM._CheckLimit(e,t)){var r=WM._FormatMessage(e);console.warn("BJS - "+r);var n="<div style='color:orange'>"+e+"</div><br>";WM._AddLogEntry(n),WM._GenerateLimitMessage(e,1)}},WM._ErrorDisabled=function(e,t){},WM._ErrorEnabled=function(e,t){if(void 0===t||WM._CheckLimit(e,t)){var r=WM._FormatMessage(e);WM.errorsCount++,console.error("BJS - "+r);var n="<div style='color:red'>"+r+"</div><br>";WM._AddLogEntry(n),WM._GenerateLimitMessage(e,2)}},Object.defineProperty(WM,"LogCache",{get:function(){return WM._LogCache},enumerable:!1,configurable:!0}),WM.ClearLogCache=function(){WM._LogCache="",WM._LogLimitOutputs={},WM.errorsCount=0},Object.defineProperty(WM,"LogLevels",{set:function(e){(e&WM.MessageLogLevel)===WM.MessageLogLevel?WM.Log=WM._LogEnabled:WM.Log=WM._LogDisabled,(e&WM.WarningLogLevel)===WM.WarningLogLevel?WM.Warn=WM._WarnEnabled:WM.Warn=WM._WarnDisabled,(e&WM.ErrorLogLevel)===WM.ErrorLogLevel?WM.Error=WM._ErrorEnabled:WM.Error=WM._ErrorDisabled},enumerable:!1,configurable:!0}),WM.NoneLogLevel=0,WM.MessageLogLevel=1,WM.WarningLogLevel=2,WM.ErrorLogLevel=4,WM.AllLogLevel=7,WM.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",WM._LogCache="",WM._LogLimitOutputs={},WM.errorsCount=0,WM.Log=WM._LogEnabled,WM.Warn=WM._WarnEnabled,WM.Error=WM._ErrorEnabled,ZM.SetMatrixPrecision=function(e){if(ZM.MatrixTrackPrecisionChange=!1,e&&!ZM.MatrixUse64Bits&&ZM.MatrixTrackedMatrices)for(var t=0;t<ZM.MatrixTrackedMatrices.length;++t){var r=ZM.MatrixTrackedMatrices[t],n=r._m;r._m=new Array(16);for(var i=0;i<16;++i)r._m[i]=n[i]}ZM.MatrixUse64Bits=e,ZM.MatrixCurrentType=ZM.MatrixUse64Bits?Array:Float32Array,ZM.MatrixTrackedMatrices=null},ZM.MatrixUse64Bits=!1,ZM.MatrixTrackPrecisionChange=!0,ZM.MatrixCurrentType=Float32Array,ZM.MatrixTrackedMatrices=[],Object.defineProperty($M.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty($M.prototype,"func",{get:function(){return this._func},set:function(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty($M.prototype,"funcRef",{get:function(){return this._funcRef},set:function(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty($M.prototype,"funcMask",{get:function(){return this._funcMask},set:function(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty($M.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty($M.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty($M.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty($M.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty($M.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),$M.prototype.reset=function(){var e;this.stencilMaterial=void 0,null===(e=this.stencilGlobal)||void 0===e||e.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},$M.prototype.apply=function(e){var t;if(e){var r=!this.useStencilGlobalOnly&&!!(null===(t=this.stencilMaterial)||void 0===t?void 0:t.enabled);this.enabled=r?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=r?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=r?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=r?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=r?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=r?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=r?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=r?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}};var ew=function(){};function tw(e,t,r,n){var i=this;this._name="WebGL",this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=null,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this.disableUniformBuffers=!1,this.onDisposeObservable=new UR,this._frameId=0,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new UR,this.onContextRestoredObservable=new UR,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new YM,this._stencilStateComposer=new $M,this._stencilState=new Op,this._alphaState=new XM,this._alphaMode=cp.ALPHA_ADD,this._alphaEquation=cp.ALPHA_DISABLE,this._internalTexturesCache=new Array,this._renderTargetWrapperCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._activeRequests=new Array,this._adaptToDeviceRatio=!1,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new UR,this._isWebGPU=!1,this._snapshotRenderingMode=cp.SNAPSHOTRENDERING_STANDARD,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={};var o=null;if(r=r||{},this._creationOptions=r,this._adaptToDeviceRatio=null!=n&&n,this._stencilStateComposer.stencilGlobal=this._stencilState,ZM.SetMatrixPrecision(!!r.useHighPrecisionMatrix),e){if(n=n||r.adaptToDeviceRatio||!1,e.getContext){if(o=e,this._renderingCanvas=o,void 0!==t&&(r.antialias=t),void 0===r.deterministicLockstep&&(r.deterministicLockstep=!1),void 0===r.lockstepMaxSteps&&(r.lockstepMaxSteps=4),void 0===r.timeStep&&(r.timeStep=1/60),void 0===r.preserveDrawingBuffer&&(r.preserveDrawingBuffer=!1),void 0===r.audioEngine&&(r.audioEngine=!0),void 0!==r.audioEngineOptions&&void 0!==r.audioEngineOptions.audioContext&&(this._audioContext=r.audioEngineOptions.audioContext),void 0!==r.audioEngineOptions&&void 0!==r.audioEngineOptions.audioDestination&&(this._audioDestination=r.audioEngineOptions.audioDestination),void 0===r.stencil&&(r.stencil=!0),!1===r.premultipliedAlpha&&(this.premultipliedAlpha=!1),void 0===r.xrCompatible&&(r.xrCompatible=!0),this._doNotHandleContextLost=!!r.doNotHandleContextLost,navigator&&navigator.userAgent){this._checkForMobile=function(){var e=navigator.userAgent;i.hostInformation.isMobile=-1!==e.indexOf("Mobile")||-1!==e.indexOf("Mac")&&JM()&&"ontouchend"in document},this._checkForMobile(),KM()&&window.addEventListener("resize",this._checkForMobile);for(var s=navigator.userAgent,a=0,u=tw.ExceptionList;a<u.length;a++){var c=u[a],l=c.key,h=c.targets;if(new RegExp(l).test(s)){if(c.capture&&c.captureConstraint){var p=c.capture,d=c.captureConstraint,f=new RegExp(p).exec(s);if(f&&f.length>0)if(parseInt(f[f.length-1])>=d)continue}for(var A=0,g=h;A<g.length;A++){switch(g[A]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":r.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),i._contextWasLost=!0,WM.Warn("WebGL context lost."),i.onContextLostObservable.notifyObservers(i)},this._onContextRestored=function(){i._restoreEngineAfterContextLost(i._initGLContext.bind(i))},o.addEventListener("webglcontextlost",this._onContextLost,!1),o.addEventListener("webglcontextrestored",this._onContextRestored,!1),r.powerPreference="high-performance"),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._badDesktopOS&&(r.xrCompatible=!1),!r.disableWebGL2Support)try{this._gl=o.getContext("webgl2",r)||o.getContext("experimental-webgl2",r),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(e){}if(!this._gl){if(!o)throw new Error("The provided canvas is null or undefined.");try{this._gl=o.getContext("webgl",r)||o.getContext("experimental-webgl",r)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=e,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";var _=this._gl.getContextAttributes();_&&(r.stencil=_.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==r.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=r.useHighPrecisionFloats);var m=KM()&&window.devicePixelRatio||1,y=r.limitDeviceRatio||m;this._hardwareScalingLevel=n?1/Math.min(y,m):1,this.resize(),this._isStencilEnable=!!r.stencil,this._initGLContext(),this._initFeatures();for(var E=0;E<this._caps.maxVertexAttribs;E++)this._currentBufferPointers[E]=new ew;this._shaderProcessor=this.webGLVersion>1?new _WebGL_webGL2ShaderProcessors__WEBPACK_IMPORTED_MODULE_13__.WebGL2ShaderProcessor:new _WebGL_webGLShaderProcessors__WEBPACK_IMPORTED_MODULE_12__.WebGLShaderProcessor,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent);var x="Babylon.js v".concat(tw.Version);console.log(x+" - ".concat(this.description)),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",x)}}function rw(e,t,r,n){switch(void 0===r&&(r=!1),e){case cp.TEXTURETYPE_BYTE:var i=(ArrayBuffer,new Int8Array(t));return n&&i.set(new Int8Array(n)),i;case cp.TEXTURETYPE_UNSIGNED_BYTE:var o=(ArrayBuffer,new Uint8Array(t));return n&&o.set(new Uint8Array(n)),o;case cp.TEXTURETYPE_SHORT:var s=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(r?t/2:t);return n&&s.set(new Int16Array(n)),s;case cp.TEXTURETYPE_UNSIGNED_SHORT:case cp.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:case cp.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:case cp.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:case cp.TEXTURETYPE_HALF_FLOAT:var a=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(r?t/2:t);return n&&a.set(new Uint16Array(n)),a;case cp.TEXTURETYPE_INT:var u=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(r?t/4:t);return n&&u.set(new Int32Array(n)),u;case cp.TEXTURETYPE_UNSIGNED_INTEGER:case cp.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:case cp.TEXTURETYPE_UNSIGNED_INT_24_8:case cp.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:case cp.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:case cp.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:var c=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(r?t/4:t);return n&&c.set(new Uint32Array(n)),c;case cp.TEXTURETYPE_FLOAT:var l=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(r?t/4:t);return n&&l.set(new Float32Array(n)),l}var h=(ArrayBuffer,new Uint8Array(t));return n&&h.set(new Uint8Array(n)),h}function nw(e){this._deferredReleaseBuffers=[],this._device=e}function iw(e){void 0===e&&(e=null),this.format=GM.TextureFormat.RGBA8Unorm,this.textureUsages=0,this.textureAdditionalUsages=0,this._webgpuTexture=e,this._webgpuMSAATexture=null,this.view=null,this.viewForWriting=null,this.msaaView=null}function ow(){}function sw(){this.children=[]}function aw(){}function uw(){return null!==sw&&sw.apply(this,arguments)||this}function cw(){return null!==sw&&sw.apply(this,arguments)||this}function lw(){}function hw(e,t){void 0===t&&(t=!1);var r=lw.call(this)||this;return r.define=e,r.not=t,r}function pw(){return null!==lw&&lw.apply(this,arguments)||this}function dw(){return null!==lw&&lw.apply(this,arguments)||this}function fw(e,t,r){var n=lw.call(this)||this;return n.define=e,n.operand=t,n.testValue=r,n}Object.defineProperty(tw,"NpmPackage",{get:function(){return"babylonjs@5.9.0"},enumerable:!1,configurable:!0}),Object.defineProperty(tw,"Version",{get:function(){return"5.9.0"},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"description",{get:function(){var e=this.name+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"version",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),Object.defineProperty(tw,"ShadersRepository",{get:function(){return _Materials_effect__WEBPACK_IMPORTED_MODULE_2__.Effect.ShadersRepository},set:function(e){_Materials_effect__WEBPACK_IMPORTED_MODULE_2__.Effect.ShadersRepository=e},enumerable:!1,configurable:!0}),tw.prototype._getShaderProcessor=function(e){return this._shaderProcessor},Object.defineProperty(tw.prototype,"useReverseDepthBuffer",{get:function(){return this._useReverseDepthBuffer},set:function(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,this._depthCullingState.depthFunc=e?cp.GEQUAL:cp.LEQUAL)},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"frameId",{get:function(){return this._frameId},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),tw.prototype.getCreationOptions=function(){return this._creationOptions},Object.defineProperty(tw.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"activeRenderLoops",{get:function(){return this._activeRenderLoops},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"framebufferDimensionsObject",{set:function(e){this._framebufferDimensionsObject=e},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,cp.TEXTUREFORMAT_RGBA,!1,!1,cp.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,cp.TEXTUREFORMAT_RGBA,!1,!1,cp.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,cp.TEXTUREFORMAT_RGBA,!1,!1,cp.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,cp.TEXTUREFORMAT_RGBA,cp.TEXTURETYPE_UNSIGNED_INT,!1,!1,cp.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"isWebGPU",{get:function(){return this._isWebGPU},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"shaderPlatformName",{get:function(){return this._shaderPlatformName},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"snapshotRendering",{get:function(){return!1},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"snapshotRenderingMode",{get:function(){return this._snapshotRenderingMode},set:function(e){this._snapshotRenderingMode=e},enumerable:!1,configurable:!0}),tw.prototype.snapshotRenderingReset=function(){this.snapshotRendering=!1},tw._CreateCanvas=function(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);var r=document.createElement("canvas");return r.width=e,r.height=t,r},tw.prototype.createCanvas=function(e,t){return tw._CreateCanvas(e,t)},tw.prototype.createCanvasImage=function(){return document.createElement("img")},tw.prototype._restoreEngineAfterContextLost=function(e){var t=this;setTimeout((function(){return(0,tslib__WEBPACK_IMPORTED_MODULE_0__.__awaiter)(t,void 0,void 0,(function(){var t,r,n,i,o;return(0,tslib__WEBPACK_IMPORTED_MODULE_0__.__generator)(this,(function(s){switch(s.label){case 0:return this._dummyFramebuffer=null,t=this._depthCullingState.depthTest,r=this._depthCullingState.depthFunc,n=this._depthCullingState.depthMask,i=this._stencilState.stencilTest,[4,e()];case 1:return s.sent(),this._rebuildEffects(),null===(o=this._rebuildComputeEffects)||void 0===o||o.call(this),this._rebuildInternalTextures(),this._rebuildRenderTargetWrappers(),this._rebuildBuffers(),this.wipeCaches(!0),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=r,this._depthCullingState.depthMask=n,this._stencilState.stencilTest=i,WM.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1,[2]}}))}))}),0)},tw.prototype._sharedInit=function(e,t,r){this._renderingCanvas=e},tw.prototype._getShaderProcessingContext=function(e){return null},tw.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++){t[e]._rebuild()}},tw.prototype._rebuildRenderTargetWrappers=function(){for(var e=0,t=this._renderTargetWrapperCache.slice();e<t.length;e++){t[e]._rebuild()}},tw.prototype._rebuildEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e];t._pipelineContext=null,t._wasPreviouslyReady=!1,t._prepareEffect()}_Materials_effect__WEBPACK_IMPORTED_MODULE_2__.Effect.ResetCache()},tw.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects){if(!this._compiledEffects[e].isReady())return!1}return!0},tw.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++){t[e]._rebuild()}for(var r=0,n=this._storageBuffers;r<n.length;r++){n[r]._rebuild()}},tw.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?256:128},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var r=0;r<16;r++)this._gl["COLOR_ATTACHMENT"+r+"_WEBGL"]=t["COLOR_ATTACHMENT"+r+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var n=this._gl.getExtension("WEBGL_depth_texture");null!=n&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=n.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var i=this._gl.getExtension("OES_vertex_array_object");null!=i&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=i.createVertexArrayOES.bind(i),this._gl.bindVertexArray=i.bindVertexArrayOES.bind(i),this._gl.deleteVertexArray=i.deleteVertexArrayOES.bind(i))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var o=this._gl.getExtension("ANGLE_instanced_arrays");null!=o?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=o.drawArraysInstancedANGLE.bind(o),this._gl.drawElementsInstanced=o.drawElementsInstancedANGLE.bind(o),this._gl.vertexAttribDivisor=o.vertexAttribDivisorANGLE.bind(o)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var s=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),a=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);s&&a&&(this._caps.highPrecisionShaderSupported=0!==s.precision&&0!==a.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var u=this._gl.getExtension("EXT_blend_minmax");null!=u&&(this._caps.blendMinMax=!0,this._gl.MAX=u.MAX_EXT,this._gl.MIN=u.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0;else{var c=this._gl.getExtension("EXT_sRGB");null!=c&&(this._caps.supportSRGBBuffers=!0,this._gl.SRGB=c.SRGB_EXT,this._gl.SRGB8=c.SRGB_ALPHA_EXT,this._gl.SRGB8_ALPHA8=c.SRGB_ALPHA_EXT)}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!(!this._creationOptions||!this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var l=0;l<this._maxSimultaneousTextures;l++)this._nextFreeTextureSlots.push(l)},tw.prototype._initFeatures=function(){this._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,_collectUbosUpdatedInFrame:!1}},Object.defineProperty(tw.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),tw.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(tw.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),tw.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=this.createCanvas(1,1);var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},tw.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},tw.prototype.getInfo=function(){return this.getGlInfo()},tw.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},tw.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},tw.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},tw.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},tw.prototype.getCaps=function(){return this._caps},tw.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},tw.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++){(0,this._activeRenderLoops[t])()}this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},tw.prototype.getRenderingCanvas=function(){return this._renderingCanvas},tw.prototype.getAudioContext=function(){return this._audioContext},tw.prototype.getAudioDestination=function(){return this._audioDestination},tw.prototype.getHostWindow=function(){return KM()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},tw.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},tw.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},tw.prototype._queueNewFrame=function(e,t){return tw.QueueNewFrame(e,t)},tw.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},tw.prototype.clear=function(e,t,r,n){void 0===n&&(n=!1);var i=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=i;var o=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),o|=this._gl.COLOR_BUFFER_BIT),r&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),o|=this._gl.DEPTH_BUFFER_BIT),n&&(this._gl.clearStencil(0),o|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(o)},tw.prototype._viewport=function(e,t,r,n){e===this._viewportCached.x&&t===this._viewportCached.y&&r===this._viewportCached.z&&n===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=n,this._gl.viewport(e,t,r,n))},tw.prototype.setViewport=function(e,t,r){var n=t||this.getRenderWidth(),i=r||this.getRenderHeight(),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._viewport(o*n,s*i,n*e.width,i*e.height)},tw.prototype.beginFrame=function(){},tw.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._frameId++},tw.prototype.resize=function(e){var t,r;if(void 0===e&&(e=!1),this._adaptToDeviceRatio){var n=KM()&&window.devicePixelRatio||1,i=this._creationOptions.limitDeviceRatio||n;this._hardwareScalingLevel=this._adaptToDeviceRatio?1/Math.min(i,n):1}KM()?(t=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,r=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(t=this._renderingCanvas?this._renderingCanvas.width:100,r=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(t/this._hardwareScalingLevel,r/this._hardwareScalingLevel,e)},tw.prototype.setSize=function(e,t,r){return void 0===r&&(r=!1),!!this._renderingCanvas&&(e|=0,t|=0,!(!r&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t)&&(this._renderingCanvas.width=e,this._renderingCanvas.height=t,!0))},tw.prototype.bindFramebuffer=function(e,t,r,n,i,o,s){var a,u,c,l,h;void 0===t&&(t=0),void 0===o&&(o=0),void 0===s&&(s=0);var p=e;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(p._MSAAFramebuffer?p._MSAAFramebuffer:p._framebuffer);var d=this._gl;e.is2DArray?d.framebufferTextureLayer(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,null===(a=e.texture._hardwareTexture)||void 0===a?void 0:a.underlyingResource,o,s):e.isCube&&d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+t,null===(u=e.texture._hardwareTexture)||void 0===u?void 0:u.underlyingResource,o);var f=e._depthStencilTexture;if(f){var A=e._depthStencilTextureWithStencil?d.DEPTH_STENCIL_ATTACHMENT:d.DEPTH_ATTACHMENT;e.is2DArray?d.framebufferTextureLayer(d.FRAMEBUFFER,A,null===(c=f._hardwareTexture)||void 0===c?void 0:c.underlyingResource,o,s):e.isCube?d.framebufferTexture2D(d.FRAMEBUFFER,A,d.TEXTURE_CUBE_MAP_POSITIVE_X+t,null===(l=f._hardwareTexture)||void 0===l?void 0:l.underlyingResource,o):d.framebufferTexture2D(d.FRAMEBUFFER,A,d.TEXTURE_2D,null===(h=f._hardwareTexture)||void 0===h?void 0:h.underlyingResource,o)}this._cachedViewport&&!i?this.setViewport(this._cachedViewport,r,n):(r||(r=e.width,o&&(r/=Math.pow(2,o))),n||(n=e.height,o&&(n/=Math.pow(2,o))),this._viewport(0,0,r,n)),this.wipeCaches()},tw.prototype.setState=function(e,t,r,n,i,o,s){var a,u;void 0===t&&(t=0),void 0===n&&(n=!1),void 0===s&&(s=0),(this._depthCullingState.cull!==e||r)&&(this._depthCullingState.cull=e);var c=null===(u=null!==(a=this.cullBackFaces)&&void 0!==a?a:i)||void 0===u||u?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==c||r)&&(this._depthCullingState.cullFace=c),this.setZOffset(t),this.setZOffsetUnits(s);var l=n?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==l||r)&&(this._depthCullingState.frontFace=l),this._stencilStateComposer.stencilMaterial=o},tw.prototype.setZOffset=function(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e},tw.prototype.getZOffset=function(){var e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e},tw.prototype.setZOffsetUnits=function(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e},tw.prototype.getZOffsetUnits=function(){var e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e},tw.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},tw.prototype._currentFrameBufferIsDefaultFrameBuffer=function(){return null===this._currentFramebuffer},tw.prototype.generateMipmaps=function(e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)},tw.prototype.unBindFramebuffer=function(e,t,r){var n;void 0===t&&(t=!1);var i=e;this._currentRenderTarget=null;var o=this._gl;if(i._MSAAFramebuffer){if(e.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(e,t,r);o.bindFramebuffer(o.READ_FRAMEBUFFER,i._MSAAFramebuffer),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,i._framebuffer),o.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,o.COLOR_BUFFER_BIT,o.NEAREST)}!(null===(n=e.texture)||void 0===n?void 0:n.generateMipMaps)||t||e.isCube||this.generateMipmaps(e.texture),r&&(i._MSAAFramebuffer&&this._bindUnboundFramebuffer(i._framebuffer),r()),this._bindUnboundFramebuffer(null)},tw.prototype.flushFramebuffer=function(){this._gl.flush()},tw.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},tw.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},tw.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},tw.prototype._createVertexBuffer=function(e,t){var r=this._gl.createBuffer();if(!r)throw new Error("Unable to create vertex buffer");var n=new _Meshes_WebGL_webGLDataBuffer__WEBPACK_IMPORTED_MODULE_14__.WebGLDataBuffer(r);return this.bindArrayBuffer(n),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),this._resetVertexBufferBinding(),n.references=1,n},tw.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},tw.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},tw.prototype.createIndexBuffer=function(e,t){var r=this._gl.createBuffer(),n=new _Meshes_WebGL_webGLDataBuffer__WEBPACK_IMPORTED_MODULE_14__.WebGLDataBuffer(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(n);var i=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),n.references=1,n.is32Bits=4===i.BYTES_PER_ELEMENT,n},tw.prototype._normalizeIndexData=function(e){if(2===e.BYTES_PER_ELEMENT)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},tw.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)},tw.prototype.bindUniformBlock=function(e,t,r){var n=e.program,i=this._gl.getUniformBlockIndex(n,t);this._gl.uniformBlockBinding(n,i,r)},tw.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},tw.prototype._bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},tw.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},tw.prototype._vertexAttribPointer=function(e,t,r,n,i,o,s){var a=this._currentBufferPointers[t];if(a){var u=!1;a.active?(a.buffer!==e&&(a.buffer=e,u=!0),a.size!==r&&(a.size=r,u=!0),a.type!==n&&(a.type=n,u=!0),a.normalized!==i&&(a.normalized=i,u=!0),a.stride!==o&&(a.stride=o,u=!0),a.offset!==s&&(a.offset=s,u=!0)):(u=!0,a.active=!0,a.index=t,a.size=r,a.type=n,a.normalized=i,a.stride=o,a.offset=s,a.buffer=e),(u||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,r,n,i,o,s))}},tw.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},tw.prototype._bindVertexBuffersAttributes=function(e,t,r){var n=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var i=0;i<n.length;i++){var o=t.getAttributeLocation(i);if(o>=0){var s=n[i],a=null;if(r&&(a=r[s]),a||(a=e[s]),!a)continue;this._gl.enableVertexAttribArray(o),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[o]=!0);var u=a.getBuffer();u&&(this._vertexAttribPointer(u,o,a.getSize(),a.type,a.normalized,a.byteStride,a.byteOffset),a.getIsInstanced()&&(this._gl.vertexAttribDivisor(o,a.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(o),this._currentInstanceBuffers.push(u))))}}},tw.prototype.recordVertexArrayObject=function(e,t,r,n){var i=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(i),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,r,n),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),i},tw.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},tw.prototype.bindBuffersDirectly=function(e,t,r,n,i){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i;var o=i.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var s=0,a=0;a<o;a++)if(a<r.length){var u=i.getAttributeLocation(a);u>=0&&(this._gl.enableVertexAttribArray(u),this._vertexAttribArraysEnabled[u]=!0,this._vertexAttribPointer(e,u,r[a],this._gl.FLOAT,!1,n,s)),s+=4*r[a]}}this._bindIndexBufferWithCache(t)},tw.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},tw.prototype.bindBuffers=function(e,t,r,n){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===r||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this._bindVertexBuffersAttributes(e,r,n)),this._bindIndexBufferWithCache(t)},tw.prototype.unbindInstanceAttributes=function(){for(var e,t=0,r=this._currentInstanceLocations.length;t<r;t++){var n=this._currentInstanceBuffers[t];e!=n&&n.references&&(e=n,this.bindArrayBuffer(n));var i=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(i,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},tw.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},tw.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)},tw.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},tw.prototype.updateAndBindInstancesBuffer=function(e,t,r){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==r[0].index)this.bindInstancesBuffer(e,r,!0);else for(var n=0;n<4;n++){var i=r[n];this._vertexAttribArraysEnabled[i]||(this._gl.enableVertexAttribArray(i),this._vertexAttribArraysEnabled[i]=!0),this._vertexAttribPointer(e,i,4,this._gl.FLOAT,!1,64,16*n),this._gl.vertexAttribDivisor(i,1),this._currentInstanceLocations.push(i),this._currentInstanceBuffers.push(e)}},tw.prototype.bindInstancesBuffer=function(e,t,r){void 0===r&&(r=!0),this.bindArrayBuffer(e);var n=0;if(r)for(var i=0;i<t.length;i++){n+=4*(o=t[i]).attributeSize}for(i=0;i<t.length;i++){var o;void 0===(o=t[i]).index&&(o.index=this._currentEffect.getAttributeLocationByName(o.attributeName)),o.index<0||(this._vertexAttribArraysEnabled[o.index]||(this._gl.enableVertexAttribArray(o.index),this._vertexAttribArraysEnabled[o.index]=!0),this._vertexAttribPointer(e,o.index,o.attributeSize,o.attributeType||this._gl.FLOAT,o.normalized||!1,n,o.offset),this._gl.vertexAttribDivisor(o.index,void 0===o.divisor?1:o.divisor),this._currentInstanceLocations.push(o.index),this._currentInstanceBuffers.push(e))}},tw.prototype.disableInstanceAttributeByName=function(e){if(this._currentEffect){var t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}},tw.prototype.disableInstanceAttribute=function(e){for(var t,r=!1;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),r=!0,t=this._currentInstanceLocations.indexOf(e);r&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},tw.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},tw.prototype.draw=function(e,t,r,n){this.drawElementsType(e?cp.MATERIAL_TriangleFillMode:cp.MATERIAL_WireFrameFillMode,t,r,n)},tw.prototype.drawPointClouds=function(e,t,r){this.drawArraysType(cp.MATERIAL_PointFillMode,e,t,r)},tw.prototype.drawUnIndexed=function(e,t,r,n){this.drawArraysType(e?cp.MATERIAL_TriangleFillMode:cp.MATERIAL_WireFrameFillMode,t,r,n)},tw.prototype.drawElementsType=function(e,t,r,n){this.applyStates(),this._reportDrawCall();var i=this._drawMode(e),o=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,s=this._uintIndicesCurrentlySet?4:2;n?this._gl.drawElementsInstanced(i,r,o,t*s,n):this._gl.drawElements(i,r,o,t*s)},tw.prototype.drawArraysType=function(e,t,r,n){this.applyStates(),this._reportDrawCall();var i=this._drawMode(e);n?this._gl.drawArraysInstanced(i,t,r,n):this._gl.drawArrays(i,t,r)},tw.prototype._drawMode=function(e){switch(e){case cp.MATERIAL_TriangleFillMode:return this._gl.TRIANGLES;case cp.MATERIAL_PointFillMode:return this._gl.POINTS;case cp.MATERIAL_WireFrameFillMode:return this._gl.LINES;case cp.MATERIAL_PointListDrawMode:return this._gl.POINTS;case cp.MATERIAL_LineListDrawMode:return this._gl.LINES;case cp.MATERIAL_LineLoopDrawMode:return this._gl.LINE_LOOP;case cp.MATERIAL_LineStripDrawMode:return this._gl.LINE_STRIP;case cp.MATERIAL_TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case cp.MATERIAL_TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},tw.prototype._reportDrawCall=function(){},tw.prototype._releaseEffect=function(e){if(this._compiledEffects[e._key]){delete this._compiledEffects[e._key];var t=e.getPipelineContext();t&&this._deletePipelineContext(t)}},tw.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},tw.prototype._getGlobalDefines=function(e){if(e)return this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,void(this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER);var t="";return this.isNDCHalfZRange&&(t+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(t&&(t+="\n"),t+="#define USE_REVERSE_DEPTHBUFFER"),t},tw.prototype.createEffect=function(e,t,r,n,i,o,s,a,u,c){var l;void 0===c&&(c=_Materials_shaderLanguage__WEBPACK_IMPORTED_MODULE_20__.ShaderLanguage.GLSL);var h=e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e,p=e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e,d=this._getGlobalDefines(),f=null!==(l=null!=i?i:t.defines)&&void 0!==l?l:"";d&&(f+=d);var A=h+"+"+p+"@"+f;if(this._compiledEffects[A]){var g=this._compiledEffects[A];return s&&g.isReady()&&s(g),g}var _=new _Materials_effect__WEBPACK_IMPORTED_MODULE_2__.Effect(e,t,r,n,this,i,o,s,a,u,A,c);return this._compiledEffects[A]=_,_},tw._ConcatenateShader=function(e,t,r){return void 0===r&&(r=""),r+(t?t+"\n":"")+e},tw.prototype._compileShader=function(e,t,r,n){return this._compileRawShader(tw._ConcatenateShader(e,r,n),t)},tw.prototype._compileRawShader=function(e,t){var r=this._gl,n=r.createShader("vertex"===t?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!n){for(var i=r.NO_ERROR,o=r.NO_ERROR;(o=r.getError())!==r.NO_ERROR;)i=o;throw new Error("Something went wrong while creating a gl ".concat(t," shader object. gl error=").concat(i,", gl isContextLost=").concat(r.isContextLost(),", _contextWasLost=").concat(this._contextWasLost))}return r.shaderSource(n,e),r.compileShader(n),n},tw.prototype._getShaderSource=function(e){return this._gl.getShaderSource(e)},tw.prototype.createRawShaderProgram=function(e,t,r,n,i){void 0===i&&(i=null),n=n||this._gl;var o=this._compileRawShader(t,"vertex"),s=this._compileRawShader(r,"fragment");return this._createShaderProgram(e,o,s,n,i)},tw.prototype.createShaderProgram=function(e,t,r,n,i,o){void 0===o&&(o=null),i=i||this._gl;var s=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",a=this._compileShader(t,"vertex",n,s),u=this._compileShader(r,"fragment",n,s);return this._createShaderProgram(e,a,u,i,o)},tw.prototype.inlineShaderCode=function(e){return e},tw.prototype.createPipelineContext=function(e){var t=new _WebGL_webGLPipelineContext__WEBPACK_IMPORTED_MODULE_15__.WebGLPipelineContext;return t.engine=this,this._caps.parallelShaderCompile&&(t.isParallelCompiled=!0),t},tw.prototype.createMaterialContext=function(){},tw.prototype.createDrawContext=function(){},tw.prototype._createShaderProgram=function(e,t,r,n,i){var o=n.createProgram();if(e.program=o,!o)throw new Error("Unable to create program");return n.attachShader(o,t),n.attachShader(o,r),n.linkProgram(o),e.context=n,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),o},tw.prototype._finalizePipelineContext=function(e){var t=e.context,r=e.vertexShader,n=e.fragmentShader,i=e.program;if(!t.getProgramParameter(i,t.LINK_STATUS)){var o,s;if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS))if(o=this._gl.getShaderInfoLog(r))throw e.vertexCompilationError=o,new Error("VERTEX SHADER "+o);if(!this._gl.getShaderParameter(n,this._gl.COMPILE_STATUS))if(o=this._gl.getShaderInfoLog(n))throw e.fragmentCompilationError=o,new Error("FRAGMENT SHADER "+o);if(s=t.getProgramInfoLog(i))throw e.programLinkError=s,new Error(s)}if(this.validateShaderPrograms&&(t.validateProgram(i),!t.getProgramParameter(i,t.VALIDATE_STATUS)&&(s=t.getProgramInfoLog(i))))throw e.programValidationError=s,new Error(s);t.deleteShader(r),t.deleteShader(n),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},tw.prototype._preparePipelineContext=function(e,t,r,n,i,o,s,a,u,c){var l=e;l.program=n?this.createRawShaderProgram(l,t,r,void 0,u):this.createShaderProgram(l,t,r,a,void 0,u),l.program.__SPECTOR_rebuildProgram=s},tw.prototype._isRenderingStateCompiled=function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)},tw.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var r=e;if(r.isParallelCompiled){var n=r.onCompiled;r.onCompiled=n?function(){n(),t()}:t}else t()},tw.prototype.getUniforms=function(e,t){for(var r=new Array,n=e,i=0;i<t.length;i++)r.push(this._gl.getUniformLocation(n.program,t[i]));return r},tw.prototype.getAttributes=function(e,t){for(var r=[],n=e,i=0;i<t.length;i++)try{r.push(this._gl.getAttribLocation(n.program,t[i]))}catch(e){r.push(-1)}return r},tw.prototype.enableEffect=function(e){(e=null!==e&&_Materials_drawWrapper__WEBPACK_IMPORTED_MODULE_18__.DrawWrapper.IsWrapper(e)?e.effect:e)&&e!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},tw.prototype.setInt=function(e,t){return!!e&&(this._gl.uniform1i(e,t),!0)},tw.prototype.setInt2=function(e,t,r){return!!e&&(this._gl.uniform2i(e,t,r),!0)},tw.prototype.setInt3=function(e,t,r,n){return!!e&&(this._gl.uniform3i(e,t,r,n),!0)},tw.prototype.setInt4=function(e,t,r,n,i){return!!e&&(this._gl.uniform4i(e,t,r,n,i),!0)},tw.prototype.setIntArray=function(e,t){return!!e&&(this._gl.uniform1iv(e,t),!0)},tw.prototype.setIntArray2=function(e,t){return!(!e||t.length%2!=0)&&(this._gl.uniform2iv(e,t),!0)},tw.prototype.setIntArray3=function(e,t){return!(!e||t.length%3!=0)&&(this._gl.uniform3iv(e,t),!0)},tw.prototype.setIntArray4=function(e,t){return!(!e||t.length%4!=0)&&(this._gl.uniform4iv(e,t),!0)},tw.prototype.setArray=function(e,t){return!!e&&(!(t.length<1)&&(this._gl.uniform1fv(e,t),!0))},tw.prototype.setArray2=function(e,t){return!(!e||t.length%2!=0)&&(this._gl.uniform2fv(e,t),!0)},tw.prototype.setArray3=function(e,t){return!(!e||t.length%3!=0)&&(this._gl.uniform3fv(e,t),!0)},tw.prototype.setArray4=function(e,t){return!(!e||t.length%4!=0)&&(this._gl.uniform4fv(e,t),!0)},tw.prototype.setMatrices=function(e,t){return!!e&&(this._gl.uniformMatrix4fv(e,!1,t),!0)},tw.prototype.setMatrix3x3=function(e,t){return!!e&&(this._gl.uniformMatrix3fv(e,!1,t),!0)},tw.prototype.setMatrix2x2=function(e,t){return!!e&&(this._gl.uniformMatrix2fv(e,!1,t),!0)},tw.prototype.setFloat=function(e,t){return!!e&&(this._gl.uniform1f(e,t),!0)},tw.prototype.setFloat2=function(e,t,r){return!!e&&(this._gl.uniform2f(e,t,r),!0)},tw.prototype.setFloat3=function(e,t,r,n){return!!e&&(this._gl.uniform3f(e,t,r,n),!0)},tw.prototype.setFloat4=function(e,t,r,n,i){return!!e&&(this._gl.uniform4f(e,t,r,n,i),!0)},tw.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var e=this._colorWrite;this._gl.colorMask(e,e,e,e)}},tw.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},tw.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(tw.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),Object.defineProperty(tw.prototype,"stencilStateComposer",{get:function(){return this._stencilStateComposer},enumerable:!1,configurable:!0}),tw.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},tw.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=cp.ALPHA_ADD,this._alphaEquation=cp.ALPHA_DISABLE,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},tw.prototype._getSamplingParameters=function(e,t){var r=this._gl,n=r.NEAREST,i=r.NEAREST;switch(e){case cp.TEXTURE_LINEAR_LINEAR_MIPNEAREST:n=r.LINEAR,i=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case cp.TEXTURE_LINEAR_LINEAR_MIPLINEAR:n=r.LINEAR,i=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case cp.TEXTURE_NEAREST_NEAREST_MIPLINEAR:n=r.NEAREST,i=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case cp.TEXTURE_NEAREST_NEAREST_MIPNEAREST:n=r.NEAREST,i=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case cp.TEXTURE_NEAREST_LINEAR_MIPNEAREST:n=r.NEAREST,i=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case cp.TEXTURE_NEAREST_LINEAR_MIPLINEAR:n=r.NEAREST,i=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case cp.TEXTURE_NEAREST_LINEAR:n=r.NEAREST,i=r.LINEAR;break;case cp.TEXTURE_NEAREST_NEAREST:n=r.NEAREST,i=r.NEAREST;break;case cp.TEXTURE_LINEAR_NEAREST_MIPNEAREST:n=r.LINEAR,i=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case cp.TEXTURE_LINEAR_NEAREST_MIPLINEAR:n=r.LINEAR,i=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case cp.TEXTURE_LINEAR_LINEAR:n=r.LINEAR,i=r.LINEAR;break;case cp.TEXTURE_LINEAR_NEAREST:n=r.LINEAR,i=r.NEAREST}return{min:i,mag:n}},tw.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},tw.prototype._createHardwareTexture=function(){return new _WebGL_webGLHardwareTexture__WEBPACK_IMPORTED_MODULE_17__.WebGLHardwareTexture(this._createTexture(),this._gl)},tw.prototype._createInternalTexture=function(e,t,r,n){void 0===n&&(n=QR.Unknown);var i={};void 0!==t&&"object"==typeof t?(i.generateMipMaps=t.generateMipMaps,i.type=void 0===t.type?cp.TEXTURETYPE_UNSIGNED_INT:t.type,i.samplingMode=void 0===t.samplingMode?cp.TEXTURE_TRILINEAR_SAMPLINGMODE:t.samplingMode,i.format=void 0===t.format?cp.TEXTUREFORMAT_RGBA:t.format,i.useSRGBBuffer=void 0!==t.useSRGBBuffer&&t.useSRGBBuffer):(i.generateMipMaps=t,i.type=cp.TEXTURETYPE_UNSIGNED_INT,i.samplingMode=cp.TEXTURE_TRILINEAR_SAMPLINGMODE,i.format=cp.TEXTUREFORMAT_RGBA,i.useSRGBBuffer=!1),i.useSRGBBuffer=i.useSRGBBuffer&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU),(i.type!==cp.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(i.type!==cp.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(i.samplingMode=cp.TEXTURE_NEAREST_SAMPLINGMODE),i.type!==cp.TEXTURETYPE_FLOAT||this._caps.textureFloat||(i.type=cp.TEXTURETYPE_UNSIGNED_INT,WM.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));var o=this._gl,s=new kR(this,n);s._useSRGBBuffer=!!i.useSRGBBuffer;var a=e.width||e,u=e.height||e,c=e.layers||0,l=this._getSamplingParameters(i.samplingMode,!!i.generateMipMaps),h=0!==c?o.TEXTURE_2D_ARRAY:o.TEXTURE_2D,p=this._getRGBABufferInternalSizedFormat(i.type,i.format,i.useSRGBBuffer),d=this._getInternalFormat(i.format),f=this._getWebGLTextureType(i.type);return this._bindTextureDirectly(h,s),0!==c?(s.is2DArray=!0,o.texImage3D(h,0,p,a,u,c,0,d,f,null)):o.texImage2D(h,0,p,a,u,0,d,f,null),o.texParameteri(h,o.TEXTURE_MAG_FILTER,l.mag),o.texParameteri(h,o.TEXTURE_MIN_FILTER,l.min),o.texParameteri(h,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(h,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),i.generateMipMaps&&this._gl.generateMipmap(h),this._bindTextureDirectly(h,null),s.baseWidth=a,s.baseHeight=u,s.width=a,s.height=u,s.depth=c,s.isReady=!0,s.samples=1,s.generateMipMaps=!!i.generateMipMaps,s.samplingMode=i.samplingMode,s.type=i.type,s.format=i.format,this._internalTexturesCache.push(s),s},tw.prototype._getUseSRGBBuffer=function(e,t){return e&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||t)},tw.prototype._createTextureBase=function(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f,A){var g=this;void 0===i&&(i=cp.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===o&&(o=null),void 0===s&&(s=null),void 0===c&&(c=null),void 0===l&&(l=null),void 0===h&&(h=null),void 0===p&&(p=null);var _="data:"===(e=e||"").substr(0,5),m="blob:"===e.substr(0,5),y=_&&-1!==e.indexOf(";base64,"),E=l||new kR(this,QR.Url),x=e;!this._transformTextureUrl||y||l||c||(e=this._transformTextureUrl(e)),x!==e&&(E._originalUrl=x);var C=e.lastIndexOf("."),b=p||(C>-1?e.substring(C).toLowerCase():""),I=null;b.indexOf("?")>-1&&(b=b.split("?")[0]);for(var T=0,v=tw._TextureLoaders;T<v.length;T++){var R=v[T];if(R.canLoad(b,d)){I=R;break}}n&&n._addPendingData(E),E.url=e,E.generateMipMaps=!t,E.samplingMode=i,E.invertY=r,E._useSRGBBuffer=this._getUseSRGBBuffer(!!A,t),this._doNotHandleContextLost||(E._buffer=c);var M=null;o&&!l&&(M=E.onLoadedObservable.add(o)),l||this._internalTexturesCache.push(E);var w=function(r,l){n&&n._removePendingData(E),e===x?(M&&E.onLoadedObservable.remove(M),_engineStore__WEBPACK_IMPORTED_MODULE_1__.EngineStore.UseFallbackTexture&&g._createTextureBase(_engineStore__WEBPACK_IMPORTED_MODULE_1__.EngineStore.FallbackTexture,t,E.invertY,n,i,null,s,a,u,c,E),r=(r||"Unknown error")+(_engineStore__WEBPACK_IMPORTED_MODULE_1__.EngineStore.UseFallbackTexture?" - Fallback texture was used":""),E.onErrorObservable.notifyObservers({message:r,exception:l}),s&&s(r,l)):(WM.Warn("Failed to load ".concat(e,", falling back to ").concat(x)),g._createTextureBase(x,t,E.invertY,n,i,o,s,a,u,c,E,h,p,d,f,A))};if(I){var S=function(e){I.loadData(e,E,(function(e,t,r,o,s,u){u?w("TextureLoader failed to load data"):a(E,b,n,{width:e,height:t},E.invertY,!r,o,(function(){return s(),!1}),i)}),f)};c?c instanceof ArrayBuffer?S(new Uint8Array(c)):ArrayBuffer.isView(c)?S(c):s&&s("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(e,(function(e){return S(new Uint8Array(e))}),void 0,n?n.offlineProvider:void 0,!0,(function(e,t){w("Unable to load "+(e&&e.responseURL,t))}))}else{var B=function(e){m&&!g._doNotHandleContextLost&&(E._buffer=e),a(E,b,n,e,E.invertY,t,!1,u,i)};!_||y?c&&("string"==typeof c.decoding||c.close)&&B(c):"string"==typeof c||c instanceof ArrayBuffer||ArrayBuffer.isView(c)||c instanceof Blob||c&&B(c)}return E},tw.prototype.createTexture=function(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f){var A=this;return void 0===i&&(i=cp.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===l&&(l=null),this._createTextureBase(e,t,r,n,i,o,s,this._prepareWebGLTexture.bind(this),(function(e,t,r,i,o,s){var a=A._gl,u=r.width===e&&r.height===t,l=c?A._getInternalFormat(c,o._useSRGBBuffer):".jpg"!==i||o._useSRGBBuffer?o._useSRGBBuffer?a.SRGB8_ALPHA8:a.RGBA:a.RGB,h=c?A._getInternalFormat(c):".jpg"!==i||o._useSRGBBuffer?a.RGBA:a.RGB;if(o._useSRGBBuffer&&1===A.webGLVersion&&(h=l),u)return a.texImage2D(a.TEXTURE_2D,0,l,h,a.UNSIGNED_BYTE,r),!1;var p=A._caps.maxTextureSize;if(r.width>p||r.height>p||!A._supportsHardwareTextureRescaling)return A._prepareWorkingCanvas(),!(!A._workingCanvas||!A._workingContext)&&(A._workingCanvas.width=e,A._workingCanvas.height=t,A._workingContext.drawImage(r,0,0,r.width,r.height,0,0,e,t),a.texImage2D(a.TEXTURE_2D,0,l,h,a.UNSIGNED_BYTE,A._workingCanvas),o.width=e,o.height=t,!1);var d=new kR(A,QR.Temp);return A._bindTextureDirectly(a.TEXTURE_2D,d,!0),a.texImage2D(a.TEXTURE_2D,0,l,h,a.UNSIGNED_BYTE,r),A._rescaleTexture(d,o,n,l,(function(){A._releaseTexture(d),A._bindTextureDirectly(a.TEXTURE_2D,o,!0),s()})),!0}),a,u,c,l,h,p,f)},tw._FileToolsLoadImage=function(e,t,r,n,i,o){throw(0,_Misc_devTools__WEBPACK_IMPORTED_MODULE_3__._WarnImport)("FileTools")},tw.prototype._rescaleTexture=function(e,t,r,n,i){},tw.prototype.createRawTexture=function(e,t,r,n,i,o,s,a,u,c,l){throw(0,_Misc_devTools__WEBPACK_IMPORTED_MODULE_3__._WarnImport)("Engine.RawTexture")},tw.prototype.createRawCubeTexture=function(e,t,r,n,i,o,s,a){throw(0,_Misc_devTools__WEBPACK_IMPORTED_MODULE_3__._WarnImport)("Engine.RawTexture")},tw.prototype.createRawTexture3D=function(e,t,r,n,i,o,s,a,u,c){throw(0,_Misc_devTools__WEBPACK_IMPORTED_MODULE_3__._WarnImport)("Engine.RawTexture")},tw.prototype.createRawTexture2DArray=function(e,t,r,n,i,o,s,a,u,c){throw(0,_Misc_devTools__WEBPACK_IMPORTED_MODULE_3__._WarnImport)("Engine.RawTexture")},tw.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},tw.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},tw.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},tw.prototype.updateTextureSamplingMode=function(e,t,r){void 0===r&&(r=!1);var n=this._getTextureTarget(t),i=this._getSamplingParameters(e,t.generateMipMaps||r);this._setTextureParameterInteger(n,this._gl.TEXTURE_MAG_FILTER,i.mag,t),this._setTextureParameterInteger(n,this._gl.TEXTURE_MIN_FILTER,i.min),r&&(t.generateMipMaps=!0,this._gl.generateMipmap(n)),this._bindTextureDirectly(n,null),t.samplingMode=e},tw.prototype.updateTextureDimensions=function(e,t,r,n){},tw.prototype.updateTextureWrappingMode=function(e,t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var i=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==r&&(this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(r),e),e._cachedWrapV=r),(e.is2DArray||e.is3D)&&null!==n&&(this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(n),e),e._cachedWrapR=n),this._bindTextureDirectly(i,null)},tw.prototype._setupDepthStencilTexture=function(e,t,r,n,i,o){void 0===o&&(o=1);var s=t.width||t,a=t.height||t,u=t.layers||0;e.baseWidth=s,e.baseHeight=a,e.width=s,e.height=a,e.is2DArray=u>0,e.depth=u,e.isReady=!0,e.samples=o,e.generateMipMaps=!1,e.samplingMode=n?cp.TEXTURE_BILINEAR_SAMPLINGMODE:cp.TEXTURE_NEAREST_SAMPLINGMODE,e.type=cp.TEXTURETYPE_UNSIGNED_INT,e._comparisonFunction=i;var c=this._gl,l=this._getTextureTarget(e),h=this._getSamplingParameters(e.samplingMode,!1);c.texParameteri(l,c.TEXTURE_MAG_FILTER,h.mag),c.texParameteri(l,c.TEXTURE_MIN_FILTER,h.min),c.texParameteri(l,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(l,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),0===i?(c.texParameteri(l,c.TEXTURE_COMPARE_FUNC,cp.LEQUAL),c.texParameteri(l,c.TEXTURE_COMPARE_MODE,c.NONE)):(c.texParameteri(l,c.TEXTURE_COMPARE_FUNC,i),c.texParameteri(l,c.TEXTURE_COMPARE_MODE,c.COMPARE_REF_TO_TEXTURE))},tw.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,n,i,o,s){void 0===o&&(o=0),void 0===s&&(s=0);var a=this._gl,u=a.TEXTURE_2D;if(e.isCube&&(u=a.TEXTURE_CUBE_MAP_POSITIVE_X+o),e._useSRGBBuffer)switch(t){case cp.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2:case cp.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL:this._caps.etc2?t=a.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case cp.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC:this._caps.etc2?t=a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case cp.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM:t=a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case cp.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4:t=a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case cp.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case cp.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case cp.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1}this._gl.compressedTexImage2D(u,s,t,r,n,0,i)},tw.prototype._uploadDataToTextureDirectly=function(e,t,r,n,i,o){void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=!1);var s=this._gl,a=this._getWebGLTextureType(e.type),u=this._getInternalFormat(e.format),c=void 0===i?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(i,e._useSRGBBuffer);this._unpackFlipY(e.invertY);var l=s.TEXTURE_2D;e.isCube&&(l=s.TEXTURE_CUBE_MAP_POSITIVE_X+r);var h=Math.round(Math.log(e.width)*Math.LOG2E),p=Math.round(Math.log(e.height)*Math.LOG2E),d=o?e.width:Math.pow(2,Math.max(h-n,0)),f=o?e.height:Math.pow(2,Math.max(p-n,0));s.texImage2D(l,n,c,d,f,0,u,a,t)},tw.prototype.updateTextureData=function(e,t,r,n,i,o,s,a,u){void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=!1);var c=this._gl,l=this._getWebGLTextureType(e.type),h=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var p=c.TEXTURE_2D;e.isCube&&(p=c.TEXTURE_CUBE_MAP_POSITIVE_X+s),this._bindTextureDirectly(p,e,!0),c.texSubImage2D(p,a,r,n,i,o,h,l,t),u&&this._gl.generateMipmap(p),this._bindTextureDirectly(p,null)},tw.prototype._uploadArrayBufferViewToTexture=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var i=this._gl,o=e.isCube?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D;this._bindTextureDirectly(o,e,!0),this._uploadDataToTextureDirectly(e,t,r,n),this._bindTextureDirectly(o,null,!0)},tw.prototype._prepareWebGLTextureContinuation=function(e,t,r,n,i){var o=this._gl;if(o){var s=this._getSamplingParameters(i,!r);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,s.mag),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,s.min),r||n||o.generateMipmap(o.TEXTURE_2D),this._bindTextureDirectly(o.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},tw.prototype._prepareWebGLTexture=function(e,t,r,n,i,o,s,a,u){var c=this;void 0===u&&(u=cp.TEXTURE_TRILINEAR_SAMPLINGMODE);var l=this.getCaps().maxTextureSize,h=Math.min(l,this.needPOTTextures?tw.GetExponentOfTwo(n.width,l):n.width),p=Math.min(l,this.needPOTTextures?tw.GetExponentOfTwo(n.height,l):n.height),d=this._gl;d&&(e._hardwareTexture?(this._bindTextureDirectly(d.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===i||!!i),e.baseWidth=n.width,e.baseHeight=n.height,e.width=h,e.height=p,e.isReady=!0,a(h,p,n,t,e,(function(){c._prepareWebGLTextureContinuation(e,r,o,s,u)}))||this._prepareWebGLTextureContinuation(e,r,o,s,u)):r&&r._removePendingData(e))},tw.prototype._setupFramebufferDepthAttachments=function(e,t,r,n,i){void 0===i&&(i=1);var o=this._gl;if(e&&t)return this._createRenderBuffer(r,n,i,o.DEPTH_STENCIL,o.DEPTH24_STENCIL8,o.DEPTH_STENCIL_ATTACHMENT);if(t){var s=o.DEPTH_COMPONENT16;return this._webGLVersion>1&&(s=o.DEPTH_COMPONENT32F),this._createRenderBuffer(r,n,i,s,s,o.DEPTH_ATTACHMENT)}return e?this._createRenderBuffer(r,n,i,o.STENCIL_INDEX8,o.STENCIL_INDEX8,o.STENCIL_ATTACHMENT):null},tw.prototype._createRenderBuffer=function(e,t,r,n,i,o,s){void 0===s&&(s=!0);var a=this._gl,u=a.createRenderbuffer();return a.bindRenderbuffer(a.RENDERBUFFER,u),r>1&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(a.RENDERBUFFER,r,i,e,t):a.renderbufferStorage(a.RENDERBUFFER,n,e,t),a.framebufferRenderbuffer(a.FRAMEBUFFER,o,a.RENDERBUFFER,u),s&&a.bindRenderbuffer(a.RENDERBUFFER,null),u},tw.prototype._releaseTexture=function(e){var t;this._deleteTexture(null===(t=e._hardwareTexture)||void 0===t?void 0:t.underlyingResource),this.unbindAllTextures();var r=this._internalTexturesCache.indexOf(e);-1!==r&&this._internalTexturesCache.splice(r,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},tw.prototype._releaseRenderTargetWrapper=function(e){var t=this._renderTargetWrapperCache.indexOf(e);-1!==t&&this._renderTargetWrapperCache.splice(t,1)},tw.prototype._deleteTexture=function(e){e&&this._gl.deleteTexture(e)},tw.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},tw.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var r=e.getSamplers(),n=0;n<r.length;n++){var i=e.getUniform(r[n]);i&&(this._boundUniforms[n]=i)}this._currentEffect=null},tw.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},tw.prototype._bindTextureDirectly=function(e,t,r,n){var i,o;void 0===r&&(r=!1),void 0===n&&(n=!1);var s=!1,a=t&&t._associatedChannel>-1;if(r&&a&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||n){if(this._activateCurrentTexture(),t&&t.isMultiview)throw console.error(e,t),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,null!==(o=null===(i=null==t?void 0:t._hardwareTexture)||void 0===i?void 0:i.underlyingResource)&&void 0!==o?o:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else r&&(s=!0,this._activateCurrentTexture());return a&&!r&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),s},tw.prototype._bindTexture=function(e,t,r){if(void 0!==e){t&&(t._associatedChannel=e),this._activeChannel=e;var n=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(n,t)}},tw.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},tw.prototype.setTexture=function(e,t,r,n){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,r))},tw.prototype._bindSamplerUniformToChannel=function(e,t){var r=this._boundUniforms[e];r&&r._currentState!==t&&(this._gl.uniform1i(r,t),r._currentState=t)},tw.prototype._getTextureWrapMode=function(e){switch(e){case cp.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case cp.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case cp.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},tw.prototype._setTexture=function(e,t,r,n,i){if(void 0===r&&(r=!1),void 0===n&&(n=!1),!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(t.delayLoadState===cp.DELAYLOADSTATE_NOTLOADED)return t.delayLoad(),!1;var o;o=n?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!r&&o&&(o._associatedChannel=e);var s=!0;this._boundTexturesCache[e]===o&&(r||this._bindSamplerUniformToChannel(o._associatedChannel,e),s=!1),this._activeChannel=e;var a=this._getTextureTarget(o);if(s&&this._bindTextureDirectly(a,o,r),o&&!o.isMultiview){if(o.isCube&&o._cachedCoordinatesMode!==t.coordinatesMode){o._cachedCoordinatesMode=t.coordinatesMode;var u=t.coordinatesMode!==cp.TEXTURE_CUBIC_MODE&&t.coordinatesMode!==cp.TEXTURE_SKYBOX_MODE?cp.TEXTURE_WRAP_ADDRESSMODE:cp.TEXTURE_CLAMP_ADDRESSMODE;t.wrapU=u,t.wrapV=u}o._cachedWrapU!==t.wrapU&&(o._cachedWrapU=t.wrapU,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),o)),o._cachedWrapV!==t.wrapV&&(o._cachedWrapV=t.wrapV,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),o)),o.is3D&&o._cachedWrapR!==t.wrapR&&(o._cachedWrapR=t.wrapR,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),o)),this._setAnisotropicLevel(a,o,t.anisotropicFilteringLevel)}return!0},tw.prototype.setTextureArray=function(e,t,r,n){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===r.length||(this._textureUnits=new Int32Array(r.length));for(var i=0;i<r.length;i++){var o=r[i].getInternalTexture();o?(this._textureUnits[i]=e+i,o._associatedChannel=e+i):this._textureUnits[i]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var s=0;s<r.length;s++)this._setTexture(this._textureUnits[s],r[s],!0)}},tw.prototype._setAnisotropicLevel=function(e,t,r){var n=this._caps.textureAnisotropicFilterExtension;t.samplingMode!==cp.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&t.samplingMode!==cp.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&t.samplingMode!==cp.TEXTURE_LINEAR_LINEAR&&(r=1),n&&t._cachedAnisotropicFilteringLevel!==r&&(this._setTextureParameterFloat(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=r)},tw.prototype._setTextureParameterFloat=function(e,t,r,n){this._bindTextureDirectly(e,n,!0,!0),this._gl.texParameterf(e,t,r)},tw.prototype._setTextureParameterInteger=function(e,t,r,n){n&&this._bindTextureDirectly(e,n,!0,!0),this._gl.texParameteri(e,t,r)},tw.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}},tw.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},tw.prototype.dispose=function(){var e;this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),null===(e=this.releaseComputeEffects)||void 0===e||e.call(this),this.unbindAllAttributes(),this._boundUniforms=[],KM()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),window.removeEventListener("resize",this._checkForMobile)),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null;for(var t=0,r=this._activeRequests;t<r.length;t++){r[t].abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},tw.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},tw.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},tw.prototype.getError=function(){return this._gl.getError()},tw.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(cp.TEXTURETYPE_FLOAT)},tw.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(cp.TEXTURETYPE_HALF_FLOAT)},tw.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var r=!0,n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER);if((r=(r=r&&o===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),r=r&&t.getError()===t.NO_ERROR),r){t.bindFramebuffer(t.FRAMEBUFFER,null);var s=t.RGBA,a=t.UNSIGNED_BYTE,u=new Uint8Array(4);t.readPixels(0,0,1,1,s,a,u),r=r&&t.getError()===t.NO_ERROR}for(t.deleteTexture(n),t.deleteFramebuffer(i),t.bindFramebuffer(t.FRAMEBUFFER,null);!r&&t.getError()!==t.NO_ERROR;);return r},tw.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case cp.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case cp.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case cp.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case cp.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case cp.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case cp.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case cp.TEXTURETYPE_BYTE:return this._gl.BYTE;case cp.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case cp.TEXTURETYPE_SHORT:return this._gl.SHORT;case cp.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case cp.TEXTURETYPE_INT:return this._gl.INT;case cp.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case cp.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case cp.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case cp.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case cp.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case cp.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case cp.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case cp.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case cp.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case cp.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case cp.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},tw.prototype._getInternalFormat=function(e,t){void 0===t&&(t=!1);var r=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case cp.TEXTUREFORMAT_ALPHA:r=this._gl.ALPHA;break;case cp.TEXTUREFORMAT_LUMINANCE:r=this._gl.LUMINANCE;break;case cp.TEXTUREFORMAT_LUMINANCE_ALPHA:r=this._gl.LUMINANCE_ALPHA;break;case cp.TEXTUREFORMAT_RED:r=this._gl.RED;break;case cp.TEXTUREFORMAT_RG:r=this._gl.RG;break;case cp.TEXTUREFORMAT_RGB:r=t?this._gl.SRGB:this._gl.RGB;break;case cp.TEXTUREFORMAT_RGBA:r=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(e){case cp.TEXTUREFORMAT_RED_INTEGER:r=this._gl.RED_INTEGER;break;case cp.TEXTUREFORMAT_RG_INTEGER:r=this._gl.RG_INTEGER;break;case cp.TEXTUREFORMAT_RGB_INTEGER:r=this._gl.RGB_INTEGER;break;case cp.TEXTUREFORMAT_RGBA_INTEGER:r=this._gl.RGBA_INTEGER}return r},tw.prototype._getRGBABufferInternalSizedFormat=function(e,t,r){if(void 0===r&&(r=!1),1===this._webGLVersion){if(void 0!==t)switch(t){case cp.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case cp.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case cp.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;case cp.TEXTUREFORMAT_RGB:return r?this._gl.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case cp.TEXTURETYPE_BYTE:switch(t){case cp.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case cp.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case cp.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case cp.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case cp.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case cp.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case cp.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case cp.TEXTURETYPE_UNSIGNED_BYTE:switch(t){case cp.TEXTUREFORMAT_RED:return this._gl.R8;case cp.TEXTUREFORMAT_RG:return this._gl.RG8;case cp.TEXTUREFORMAT_RGB:return r?this._gl.SRGB8:this._gl.RGB8;case cp.TEXTUREFORMAT_RGBA:return r?this._gl.SRGB8_ALPHA8:this._gl.RGBA8;case cp.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case cp.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case cp.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case cp.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;case cp.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case cp.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case cp.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case cp.TEXTURETYPE_SHORT:switch(t){case cp.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case cp.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case cp.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case cp.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case cp.TEXTURETYPE_UNSIGNED_SHORT:switch(t){case cp.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case cp.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case cp.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case cp.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case cp.TEXTURETYPE_INT:switch(t){case cp.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case cp.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case cp.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case cp.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case cp.TEXTURETYPE_UNSIGNED_INTEGER:switch(t){case cp.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case cp.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case cp.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case cp.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case cp.TEXTURETYPE_FLOAT:switch(t){case cp.TEXTUREFORMAT_RED:return this._gl.R32F;case cp.TEXTUREFORMAT_RG:return this._gl.RG32F;case cp.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case cp.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case cp.TEXTURETYPE_HALF_FLOAT:switch(t){case cp.TEXTUREFORMAT_RED:return this._gl.R16F;case cp.TEXTUREFORMAT_RG:return this._gl.RG16F;case cp.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case cp.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case cp.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case cp.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case cp.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case cp.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case cp.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case cp.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(t){case cp.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case cp.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return r?this._gl.SRGB8_ALPHA8:this._gl.RGBA8},tw.prototype._getRGBAMultiSampleBufferFormat=function(e){return e===cp.TEXTURETYPE_FLOAT?this._gl.RGBA32F:e===cp.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},tw.prototype._loadFile=function(e,t,r,n,i,o){var s=this,a=tw._FileToolsLoadFile(e,t,r,n,i,o);return this._activeRequests.push(a),a.onCompleteObservable.add((function(e){s._activeRequests.splice(s._activeRequests.indexOf(e),1)})),a},tw._FileToolsLoadFile=function(e,t,r,n,i,o){throw(0,_Misc_devTools__WEBPACK_IMPORTED_MODULE_3__._WarnImport)("FileTools")},tw.prototype.readPixels=function(e,t,r,n,i,o){void 0===i&&(i=!0),void 0===o&&(o=!0);var s=i?4:3,a=i?this._gl.RGBA:this._gl.RGB,u=new Uint8Array(n*r*s);return o&&this.flushFramebuffer(),this._gl.readPixels(e,t,r,n,a,this._gl.UNSIGNED_BYTE,u),Promise.resolve(u)},Object.defineProperty(tw,"IsSupportedAsync",{get:function(){return Promise.resolve(this.isSupported())},enumerable:!1,configurable:!0}),Object.defineProperty(tw,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),tw.isSupported=function(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._IsSupported=!1}return this._IsSupported},Object.defineProperty(tw,"HasMajorPerformanceCaveat",{get:function(){if(null===this._HasMajorPerformanceCaveat)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(e){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),tw.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},tw.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},tw.NearestPOT=function(e){var t=tw.CeilingPOT(e),r=tw.FloorPOT(e);return t-e>e-r?r:t},tw.GetExponentOfTwo=function(e,t,r){var n;switch(void 0===r&&(r=cp.SCALEMODE_NEAREST),r){case cp.SCALEMODE_FLOOR:n=tw.FloorPOT(e);break;case cp.SCALEMODE_NEAREST:n=tw.NearestPOT(e);break;case cp.SCALEMODE_CEILING:default:n=tw.CeilingPOT(e)}return Math.min(n,t)},tw.QueueNewFrame=function(e,t){return KM()?(t||(t=window),t.requestPostAnimationFrame?t.requestPostAnimationFrame(e):t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,16)},tw.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:JM()?document:null},tw.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],tw._TextureLoaders=[],tw.CollisionsEpsilon=.001,tw._IsSupported=null,tw._HasMajorPerformanceCaveat=null,tw.prototype._createHardwareRenderTargetWrapper=function(e,t,r){var n=new _WebGL_webGLRenderTargetWrapper__WEBPACK_IMPORTED_MODULE_4__.WebGLRenderTargetWrapper(e,t,r,this,this._gl);return this._renderTargetWrapperCache.push(n),n},tw.prototype.createDepthStencilTexture=function(e,t,r){if(t.isCube){var n=e.width||e;return this._createDepthStencilCubeTexture(n,t,r)}return this._createDepthStencilTexture(e,t,r)},tw.prototype._readTexturePixelsSync=function(e,t,r,n,i,o,s,a,u,c){var l,h;void 0===n&&(n=-1),void 0===i&&(i=0),void 0===o&&(o=null),void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===u&&(u=0),void 0===c&&(c=0);var p=this._gl;if(!p)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var d=p.createFramebuffer();if(!d)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=d}p.bindFramebuffer(p.FRAMEBUFFER,this._dummyFramebuffer),n>-1?p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_CUBE_MAP_POSITIVE_X+n,null===(l=e._hardwareTexture)||void 0===l?void 0:l.underlyingResource,i):p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,null===(h=e._hardwareTexture)||void 0===h?void 0:h.underlyingResource,i);var f=void 0!==e.type?this._getWebGLTextureType(e.type):p.UNSIGNED_BYTE;if(a)o||(o=rw(e.type,4*t*r));else if(f===p.UNSIGNED_BYTE)o||(o=new Uint8Array(4*t*r)),f=p.UNSIGNED_BYTE;else o||(o=new Float32Array(4*t*r)),f=p.FLOAT;return s&&this.flushFramebuffer(),p.readPixels(u,c,t,r,p.RGBA,f,o),p.bindFramebuffer(p.FRAMEBUFFER,this._currentFramebuffer),o},tw.prototype._readTexturePixels=function(e,t,r,n,i,o,s,a,u,c){return void 0===n&&(n=-1),void 0===i&&(i=0),void 0===o&&(o=null),void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===u&&(u=0),void 0===c&&(c=0),Promise.resolve(this._readTexturePixelsSync(e,t,r,n,i,o,s,a,u,c))},nw._IsGPUBuffer=function(e){return void 0===e.underlyingResource},nw.prototype.createRawBuffer=function(e,t,r){void 0===r&&(r=!1);var n={mappedAtCreation:r,size:void 0!==e.byteLength?e.byteLength+3&-4:e+3&-4,usage:t};return this._device.createBuffer(n)},nw.prototype.createBuffer=function(e,t){var r=void 0!==e.byteLength,n=new kM(this.createRawBuffer(e,t));return n.references=1,n.capacity=r?e.byteLength:e,r&&this.setSubData(n,0,e),n},nw.prototype.setRawData=function(e,t,r,n,i){this._device.queue.writeBuffer(e,t,r.buffer,n,i)},nw.prototype.setSubData=function(e,t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=0);var o=e.underlyingResource;i=i||r.byteLength,i=Math.min(i,e.capacity-t);var s=r.byteOffset+n,a=s+i,u=i+3&-4;if(u!==i){var c=new Uint8Array(r.buffer.slice(s,a));(r=new Uint8Array(u)).set(c),n=0,s=0,a=u,i=u}for(var l=15728640,h=0;a-(s+h)>l;)this._device.queue.writeBuffer(o,t+h,r.buffer,s+h,l),h+=l;this._device.queue.writeBuffer(o,t+h,r.buffer,s+h,i-h)},nw.prototype.createBufferByMap=function(e,t){var r=void 0!==e.byteLength,n=new kM(o=this.createRawBuffer(e,t,!0));if(n.references=1,n.capacity=r?e.byteLength:e,r){var i=e,o=n.underlyingResource,s=i.byteLength;s=Math.min(s,n.capacity-0);var a=i.byteOffset,u=a+s,c=s+3&-4;if(c!==s){var l=new Uint8Array(i.buffer.slice(a,u));(i=new Uint8Array(c)).set(l),a=0,u=c,s=c}var h=o.getMappedRange();new(0,i.constructor)(h).set(i),o.unmap()}return n},nw.prototype._getHalfFloatAsFloatRGBAArrayBuffer=function(e,t,r){r||(r=new Float32Array(e));for(var n=new Uint16Array(t);e--;)r[e]=VM(n[e]);return r},nw.prototype.readDataFromBuffer=function(e,t,r,n,i,o,s,a,u,c,l){var h=this;void 0===s&&(s=cp.TEXTURETYPE_UNSIGNED_BYTE),void 0===a&&(a=0),void 0===u&&(u=null),void 0===c&&(c=!0),void 0===l&&(l=!1);var p=s===cp.TEXTURETYPE_FLOAT?2:s===cp.TEXTURETYPE_HALF_FLOAT?1:0;return new Promise((function(r,d){e.mapAsync(GM.MapMode.Read,a,t).then((function(){var d=e.getMappedRange(a,t),f=u;if(l)f=null===f?rw(s,t,!0,d):rw(s,f.buffer,void 0,d);else if(null===f)switch(p){case 0:(f=new Uint8Array(t)).set(new Uint8Array(d));break;case 1:f=h._getHalfFloatAsFloatRGBAArrayBuffer(t/2,d);break;case 2:(f=new Float32Array(t/4)).set(new Float32Array(d))}else switch(p){case 0:(f=new Uint8Array(f.buffer)).set(new Uint8Array(d));break;case 1:f=h._getHalfFloatAsFloatRGBAArrayBuffer(t/2,d,u);break;case 2:(f=new Float32Array(f.buffer)).set(new Float32Array(d))}if(i!==o){1!==p||l||(i*=2,o*=2);for(var A=new Uint8Array(f.buffer),g=i,_=0,m=1;m<n;++m){_=m*o;for(var y=0;y<i;++y)A[g++]=A[_++]}f=0===p||l?new Uint8Array(A.buffer,0,g):new Float32Array(A.buffer,0,g/4)}e.unmap(),c&&h.releaseBuffer(e),r(f)}),(function(e){return d(e)}))}))},nw.prototype.releaseBuffer=function(e){return nw._IsGPUBuffer(e)?(this._deferredReleaseBuffers.push(e),!0):(e.references--,0===e.references&&(this._deferredReleaseBuffers.push(e.underlyingResource),!0))},nw.prototype.destroyDeferredBuffers=function(){for(var e=0;e<this._deferredReleaseBuffers.length;++e)this._deferredReleaseBuffers[e].destroy();this._deferredReleaseBuffers.length=0},Object.defineProperty(iw.prototype,"underlyingResource",{get:function(){return this._webgpuTexture},enumerable:!1,configurable:!0}),Object.defineProperty(iw.prototype,"msaaTexture",{get:function(){return this._webgpuMSAATexture},set:function(e){this._webgpuMSAATexture=e},enumerable:!1,configurable:!0}),iw.prototype.set=function(e){this._webgpuTexture=e},iw.prototype.setUsage=function(e,t,r,n,i){t=e!==_Materials_Textures_internalTexture__WEBPACK_IMPORTED_MODULE_0__.InternalTextureSource.RenderTarget&&t,this.createView({format:this.format,dimension:r?GM.TextureViewDimension.Cube:GM.TextureViewDimension.E2d,mipLevelCount:t?_Maths_math_scalar__WEBPACK_IMPORTED_MODULE_1__.Scalar.ILog2(Math.max(n,i))+1:1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:r?6:1,aspect:GM.TextureAspect.All})},iw.prototype.createView=function(e,t){if(void 0===t&&(t=!1),this.view=this._webgpuTexture.createView(e),t&&e){var r=e.mipLevelCount;e.mipLevelCount=1,this.viewForWriting=this._webgpuTexture.createView(e),e.mipLevelCount=r}},iw.prototype.createMSAAView=function(e){this.msaaView=this._webgpuMSAATexture.createView(e)},iw.prototype.reset=function(){this._webgpuTexture=null,this._webgpuMSAATexture=null,this.view=null,this.viewForWriting=null,this.msaaView=null},iw.prototype.release=function(){var e,t,r;null===(e=this._webgpuTexture)||void 0===e||e.destroy(),null===(t=this._webgpuMSAATexture)||void 0===t||t.destroy(),null===(r=this._copyInvertYTempTexture)||void 0===r||r.destroy(),this.reset()},Object.defineProperty(ow.prototype,"UniqueId",{get:function(){var e=this._UniqueIdCounter;return this._UniqueIdCounter++,e},enumerable:!1,configurable:!0}),ow._UniqueIdCounter=0,ow.add=function(){},sw.prototype.isValid=function(e){return!0},sw.prototype.process=function(e,t){var r="";if(this.line){var n=this.line,i=t.processor;if(i){if(i.lineProcessor&&(n=i.lineProcessor(n,t.isFragment,t.processingContext)),i.attributeProcessor&&this.line.startsWith("attribute"))n=i.attributeProcessor(this.line,e,t.processingContext);else if(i.varyingProcessor&&this.line.startsWith("varying"))n=i.varyingProcessor(this.line,t.isFragment,e,t.processingContext);else if(i.uniformProcessor&&i.uniformRegexp&&i.uniformRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(n=i.uniformProcessor(this.line,t.isFragment,e,t.processingContext));else if(i.uniformBufferProcessor&&i.uniformBufferRegexp&&i.uniformBufferRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(n=i.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0);else if(i.textureProcessor&&i.textureRegexp&&i.textureRegexp.test(this.line))n=i.textureProcessor(this.line,t.isFragment,e,t.processingContext);else if((i.uniformProcessor||i.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:mediump)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?i.uniformProcessor&&(n=i.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):i.uniformBufferProcessor&&(n=i.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)}t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,i.endOfUniformBufferProcessor&&(n=i.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}r+=n+"\r\n"}return this.children.forEach((function(n){r+=n.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),r},Object.defineProperty(aw.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(aw.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(aw.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,r=e;t<r.length;t++){var n=r[t];if("#"!==n[0])if(n.trim().startsWith("//"))this._lines.push(n);else for(var i=n.split(";"),o=0;o<i.length;o++){var s=i[o];(s=s.trim())&&this._lines.push(s+(o!==i.length-1?";":""))}else this._lines.push(n)}},enumerable:!1,configurable:!0}),sw&&(uw.__proto__=sw),uw.prototype=Object.create(sw&&sw.prototype),uw.prototype.constructor=sw,uw.prototype.process=function(e,t){for(var r=0;r<this.children.length;r++){var n=this.children[r];if(n.isValid(e))return n.process(e,t)}return""},sw&&(cw.__proto__=sw),cw.prototype=Object.create(sw&&sw.prototype),cw.prototype.constructor=sw,cw.prototype.isValid=function(e){return this.testExpression.isTrue(e)},lw.prototype.isTrue=function(e){return!0},lw.postfixToInfix=function(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];if(void 0===lw._OperatorPriority[i])t.push(i);else{var o=t[t.length-1],s=t[t.length-2];t.length-=2,t.push("(".concat(s).concat(i).concat(o,")"))}}return t[t.length-1]},lw.infixToPostfix=function(e){for(var t=[],r=-1,n=function(){""!==(u=u.trim())&&(t.push(u),u="")},i=function(e){r<lw._Stack.length-1&&(lw._Stack[++r]=e)},o=function(){return lw._Stack[r]},s=function(){return-1===r?"!!INVALID EXPRESSION!!":lw._Stack[r--]},a=0,u="";a<e.length;){var c=e.charAt(a),l=a<e.length-1?e.substr(a,2):"";if("("===c)u="",i(c);else if(")"===c){for(n();-1!==r&&"("!==o();)t.push(s());s()}else if(lw._OperatorPriority[l]>1){for(n();-1!==r&&lw._OperatorPriority[o()]>=lw._OperatorPriority[l];)t.push(s());i(l),a++}else u+=c;a++}for(n();-1!==r;)"("===o()?s():t.push(s());return t},lw._OperatorPriority={")":0,"(":1,"||":2,"&&":3},lw._Stack=["","","","","","","","","","","","","","","","","","","",""],lw&&(hw.__proto__=lw),hw.prototype=Object.create(lw&&lw.prototype),hw.prototype.constructor=lw,hw.prototype.isTrue=function(e){var t=void 0!==e[this.define];return this.not&&(t=!t),t},lw&&(pw.__proto__=lw),pw.prototype=Object.create(lw&&lw.prototype),pw.prototype.constructor=lw,pw.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)},lw&&(dw.__proto__=lw),dw.prototype=Object.create(lw&&lw.prototype),dw.prototype.constructor=lw,dw.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)},lw&&(fw.__proto__=lw),fw.prototype=Object.create(lw&&lw.prototype),fw.prototype.constructor=lw,fw.prototype.isTrue=function(e){var t=e[this.define];void 0===t&&(t=this.define);var r=!1,n=parseInt(t),i=parseInt(this.testValue);switch(this.operand){case">":r=n>i;break;case"<":r=n<i;break;case"<=":r=n<=i;break;case">=":r=n>=i;break;case"==":r=n===i}return r};var Aw=Object.freeze({GLSL:0,WGSL:1,0:"GLSL",1:"WGSL"}),gw=/defined\s*?\((.+?)\)/g,_w=/defined\s*?\[(.+?)\]/g,mw=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g;function yw(){}function Ew(){}function xw(e,t,r,n){var i,o,s,a=this;void 0===n&&(n=""),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.uniqueId=0,this.onCompileObservable=new UR,this.onErrorObservable=new UR,this.onBindObservable=new UR,this._wasPreviouslyReady=!1,this._isReady=!1,this._compilationError="",this._key="",this._computeSourceCodeOverride="",this._pipelineContext=null,this._computeSourceCode="",this._rawComputeSourceCode="",this._shaderLanguage=Aw.WGSL,this.name=e,this._key=n,this._engine=r,this.uniqueId=xw._uniqueIdSeed++,this.defines=null!==(i=t.defines)&&void 0!==i?i:"",this.onError=t.onError,this.onCompiled=t.onCompiled,this._entryPoint=null!==(o=t.entryPoint)&&void 0!==o?o:"main",this._shaderStore=Ew.GetShadersStore(this._shaderLanguage),this._shaderRepository=Ew.GetShadersRepository(this._shaderLanguage),this._includeShaderStore=Ew.GetIncludesShadersStore(this._shaderLanguage);var u=KM()?this._engine.getHostDocument():null;e.computeSource?s="source:"+e.computeSource:e.computeElement?(s=u?u.getElementById(e.computeElement):null)||(s=e.computeElement):s=e.compute||e;var c={defines:this.defines.split("\n"),indexParameters:void 0,isFragment:!1,shouldUseHighPrecisionShader:!1,processor:null,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:this._shaderRepository,includesShadersStore:this._includeShaderStore,version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:null,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer};this._loadShader(s,"Compute","",(r=>{yw.Initialize(c),yw.PreProcess(r,c,(function(n){a._rawComputeSourceCode=r,t.processFinalCode&&(n=t.processFinalCode(n));var i=yw.Finalize(n,"",c);a._useFinalCode(i.vertexCode,e)}),a._engine)}))}function Cw(){}function bw(){}function Iw(e){void 0===e&&(e=30),this._enabled=!0,this._rollingFrameTime=new Tw(e)}function Tw(e){this._samples=new Array(e),this.reset()}function vw(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}function Rw(e,t,r,n){void 0===n&&(n=!1);var i=tw.call(this,e,t,r,n)||this;if(i.enableOfflineSupport=!1,i.disableManifestCheck=!1,i.scenes=new Array,i._virtualScenes=new Array,i.onNewSceneAddedObservable=new UR,i.postProcesses=new Array,i.isPointerLock=!1,i.onResizeObservable=new UR,i.onCanvasBlurObservable=new UR,i.onCanvasFocusObservable=new UR,i.onCanvasPointerOutObservable=new UR,i.onBeginFrameObservable=new UR,i.customAnimationFrameRequester=null,i.onEndFrameObservable=new UR,i.onBeforeShaderCompilationObservable=new UR,i.onAfterShaderCompilationObservable=new UR,i._deterministicLockstep=!1,i._lockstepMaxSteps=4,i._timeStep=1/60,i._fps=60,i._deltaTime=0,i._drawCalls=new vw,i.canvasTabIndex=1,i.disablePerformanceMonitorInBackground=!1,i._performanceMonitor=new Iw,i._compatibilityMode=!0,i.currentRenderPassId=cp.RENDERPASS_MAIN,i._renderPassNames=["main"],Rw.Instances.push(i),!e)return i;if(i._features.supportRenderPasses=!0,r=i._creationOptions,e.getContext){var o=e;if(i._sharedInit(o,!!r.doNotHandleTouchAction,r.audioEngine),(0,_Misc_domManagement__WEBPACK_IMPORTED_MODULE_3__.IsWindowObjectExist)()){var s=document;i._onFullscreenChange=function(){void 0!==s.fullscreen?i.isFullscreen=s.fullscreen:void 0!==s.mozFullScreen?i.isFullscreen=s.mozFullScreen:void 0!==s.webkitIsFullScreen?i.isFullscreen=s.webkitIsFullScreen:void 0!==s.msIsFullScreen&&(i.isFullscreen=s.msIsFullScreen),i.isFullscreen&&i._pointerLockRequested&&o&&Rw._RequestPointerlock(o)},document.addEventListener("fullscreenchange",i._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",i._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",i._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",i._onFullscreenChange,!1),i._onPointerLockChange=function(){i.isPointerLock=s.mozPointerLockElement===o||s.webkitPointerLockElement===o||s.msPointerLockElement===o||s.pointerLockElement===o},document.addEventListener("pointerlockchange",i._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",i._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",i._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",i._onPointerLockChange,!1),!Rw.audioEngine&&r.audioEngine&&Rw.AudioEngineFactory&&(Rw.audioEngine=Rw.AudioEngineFactory(i.getRenderingCanvas(),i.getAudioContext(),i.getAudioDestination()))}i._connectVREvents(),i.enableOfflineSupport=void 0!==Rw.OfflineProviderFactory,i._deterministicLockstep=!!r.deterministicLockstep,i._lockstepMaxSteps=r.lockstepMaxSteps||0,i._timeStep=r.timeStep||1/60}return i._prepareVRComponent(),r.autoEnableWebVR&&i.initWebVR(),i}function Mw(e,t,r,n,i,o,s,a,u,c,l,h){void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===l&&(l=""),void 0===h&&(h=Aw.GLSL);var p,d,f,A=this;this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new UR,this.onErrorObservable=new UR,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._isDisposed=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._compiledVertexWGSL="",this._compiledFragmentWGSL="",this.name=e,this._key=l;var g,_,m=void 0,y=null;if(t.attributes){var E=t;if(this._engine=r,this._attributesNames=E.attributes,this._uniformsNames=E.uniformsNames.concat(E.samplers),this._samplerList=E.samplers.slice(),this.defines=E.defines,this.onError=E.onError,this.onCompiled=E.onCompiled,this._fallbacks=E.fallbacks,this._indexParameters=E.indexParameters,this._transformFeedbackVaryings=E.transformFeedbackVaryings||null,this._multiTarget=!!E.multiTarget,this._shaderLanguage=null!==(p=E.shaderLanguage)&&void 0!==p?p:Aw.GLSL,E.uniformBuffersNames){this._uniformBuffersNamesList=E.uniformBuffersNames.slice();for(var x=0;x<E.uniformBuffersNames.length;x++)this._uniformBuffersNames[E.uniformBuffersNames[x]]=x}y=null!==(d=E.processFinalCode)&&void 0!==d?d:null,m=null!==(f=E.processCodeAfterIncludes)&&void 0!==f?f:void 0}else this._engine=i,this.defines=null==o?"":o,this._uniformsNames=r.concat(n),this._samplerList=n?n.slice():[],this._attributesNames=t,this._uniformBuffersNamesList=[],this._shaderLanguage=h,this.onError=u,this.onCompiled=a,this._indexParameters=c,this._fallbacks=s;this._attributeLocationByName={},this.uniqueId=Mw._UniqueIdSeed++;var C=KM()?this._engine.getHostDocument():null;e.vertexSource?g="source:"+e.vertexSource:e.vertexElement?(g=C?C.getElementById(e.vertexElement):null)||(g=e.vertexElement):g=e.vertex||e,e.fragmentSource?_="source:"+e.fragmentSource:e.fragmentElement?(_=C?C.getElementById(e.fragmentElement):null)||(_=e.fragmentElement):_=e.fragment||e,this._processingContext=this._engine._getShaderProcessingContext(this._shaderLanguage);var b={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:Ew.GetShadersRepository(this._shaderLanguage),includesShadersStore:Ew.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:m};this._engine._getCompiledShaderFromIndexDB(this._shaderLanguage,l,((r,n,i)=>{r&&(A._compiledVertexWGSL=n,A._compiledFragmentWGSL=i),this._loadShaderAsNormal(e,g,_,y,t,b)}))}function ww(e,t,r,n,i,o){void 0===i&&(i=!1),this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers||i,this._dynamic=r,this._name=null!=n?n:"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._trackUbosInFrame=null!=o?o:this._engine._features.trackUbosInFrame,this._trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform)}function Sw(){}function Bw(e,t){this._name="unnamed",this.shaderProcessingContext=e,this._leftOverUniformsByName={},this.engine=t}yw.Initialize=function(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)},yw.Process=function(e,t,r,n){var i,o=this;(null===(i=t.processor)||void 0===i?void 0:i.preProcessShaderCode)&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,(function(e){t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e));var i=o._ProcessShaderConversion(e,t,n);r(i)}))},yw.PreProcess=function(e,t,r,n){var i,o=this;(null===(i=t.processor)||void 0===i?void 0:i.preProcessShaderCode)&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,(function(e){t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e));var i=o._ApplyPreProcessing(e,t,n);r(i)}))},yw.Finalize=function(e,t,r){return r.processor&&r.processor.finalizeShaders?r.processor.finalizeShaders(e,t,r.processingContext):{vertexCode:e,fragmentCode:t}},yw._ProcessPrecision=function(e,t){var r;if(null===(r=t.processor)||void 0===r?void 0:r.noPrecision)return e;var n=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=n?"precision highp float;\n"+e:"precision mediump float;\n"+e:n||(e=e.replace("precision highp float","precision mediump float")),e},yw._ExtractOperation=function(e){var t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new hw(t[1].trim(),"!"===e[0]);for(var r="",n=0,i=0,o=["==",">=","<=","<",">"];i<o.length&&(r=o[i],!((n=e.indexOf(r))>-1));i++);return-1===n?new hw(e):new fw(e.substring(0,n).trim(),r,e.substring(n+r.length).trim())},yw._BuildSubExpression=function(e){e=e.replace(gw,"defined[$1]");for(var t=[],r=0,n=lw.infixToPostfix(e);r<n.length;r++){var i=n[r];if("||"!==i&&"&&"!==i)t.push(i);else if(t.length>=2){var o=t[t.length-1],s=t[t.length-2];t.length-=2;var a="&&"==i?new dw:new pw;"string"==typeof o&&(o=o.replace(_w,"defined($1)")),"string"==typeof s&&(s=s.replace(_w,"defined($1)")),a.leftOperand="string"==typeof s?this._ExtractOperation(s):s,a.rightOperand="string"==typeof o?this._ExtractOperation(o):o,t.push(a)}}var u=t[t.length-1];return"string"==typeof u&&(u=u.replace(_w,"defined($1)")),"string"==typeof u?this._ExtractOperation(u):u},yw._BuildExpression=function(e,t){var r=new cw,n=e.substring(0,t),i=e.substring(t);return i=i.substring(0,(i.indexOf("//")+1||i.length+1)-1).trim(),r.testExpression="#ifdef"===n?new hw(i):"#ifndef"===n?new hw(i,!0):this._BuildSubExpression(i),r},yw._MoveCursorWithinIf=function(e,t,r){for(var n=e.currentLine;this._MoveCursor(e,r);){var i=(n=e.currentLine).substring(0,5).toLowerCase();if("#else"===i){var o=new sw;return t.children.push(o),void this._MoveCursor(e,o)}if("#elif"===i){var s=this._BuildExpression(n,5);t.children.push(s),r=s}}},yw._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var r=e.currentLine,n=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(r);if(n&&n.length){switch(n[0]){case"#ifdef":var i=new uw;t.children.push(i);var o=this._BuildExpression(r,6);i.children.push(o),this._MoveCursorWithinIf(e,i,o);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":i=new uw;t.children.push(i);o=this._BuildExpression(r,7);i.children.push(o),this._MoveCursorWithinIf(e,i,o);break;case"#if":i=new uw,o=this._BuildExpression(r,3);t.children.push(i),i.children.push(o),this._MoveCursorWithinIf(e,i,o)}}else{var s=new sw;if(s.line=r,t.children.push(s),"#"===r[0]&&"d"===r[1]){var a=r.replace(";","").split(" ");s.additionalDefineKey=a[1],3===a.length&&(s.additionalDefineValue=a[2])}}}return!1},yw._EvaluatePreProcessors=function(e,t,r){var n=new sw,i=new aw;return i.lineIndex=-1,i.lines=e.split("\n"),this._MoveCursor(i,n),n.process(t,r)},yw.removeUnuseCode=function(e,t,r){for(var n={},i=0,o=t.concat(r);i<o.length;i++){var s=o[i].replace("#define","").replace(";","").trim().split(" ");n[s[0]]=s.length>1?s[1]:""}var a=new sw,u=new aw;return u.lineIndex=-1,u.lines=e.split("\n"),this._MoveCursor(u,a),a.process(n,{processor:{}})},yw._PreparePreProcessors=function(e,t){for(var r,n={},i=0,o=e.defines;i<o.length;i++){var s=o[i].replace("#define","").replace(";","").trim().split(" ");n[s[0]]=s.length>1?s[1]:""}return(null===(r=e.processor)||void 0===r?void 0:r.shaderLanguage)===Aw.GLSL&&(n.GL_ES="true"),n.__VERSION__=e.version,n[e.platformName]="true",t._getGlobalDefines(n),n},yw._ProcessShaderConversion=function(e,t,r){var n=this._ProcessPrecision(e,t);if(!t.processor)return n;if(t.processor.shaderLanguage===Aw.GLSL&&-1!==n.indexOf("#version 3"))return n.replace("#version 300 es","");var i=t.defines,o=this._PreparePreProcessors(t,r);return t.processor.preProcessor&&(n=t.processor.preProcessor(n,i,t.isFragment,t.processingContext)),n=this._EvaluatePreProcessors(n,o,t),t.processor.postProcessor&&(n=t.processor.postProcessor(n,i,t.isFragment,t.processingContext,r)),r._features.needShaderCodeInlining&&(n=r.inlineShaderCode(n)),n},yw._ApplyPreProcessing=function(e,t,r){var n,i,o=e,s=t.defines,a=this._PreparePreProcessors(t,r);return(null===(n=t.processor)||void 0===n?void 0:n.preProcessor)&&(o=t.processor.preProcessor(o,s,t.isFragment,t.processingContext)),o=this._EvaluatePreProcessors(o,a,t),(null===(i=t.processor)||void 0===i?void 0:i.postProcessor)&&(o=t.processor.postProcessor(o,s,t.isFragment,t.processingContext,r)),r._features.needShaderCodeInlining&&(o=r.inlineShaderCode(o)),o},yw._ProcessIncludes=function(e,t,r){for(var n=this,i=mw.exec(e),o=new String(e),s=!1,a=function(){var a=i[1];if(-1!==a.indexOf("__decl__")&&(a=a.replace(/__decl__/,""),t.supportsUniformBuffers&&(a=(a=a.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),a+="Declaration"),!t.includesShadersStore[a]){var u=t.shadersRepository+"ShadersInclude/"+a+".fx";return yw._FileToolsLoadFile(u,(function(e){t.includesShadersStore[a]=e,n._ProcessIncludes(o,t,r)})),{value:void 0}}var c=t.includesShadersStore[a];if(i[2])for(var l=i[3].split(","),h=0;h<l.length;h+=2){var p=new RegExp(l[h],"g"),d=l[h+1];c=c.replace(p,d)}if(i[4]){var f=i[5];if(-1!==f.indexOf("..")){var A=f.split(".."),g=parseInt(A[0]),_=parseInt(A[1]),m=c.slice(0);c="",isNaN(_)&&(_=t.indexParameters[A[1]]);for(var y=g;y<_;y++)t.supportsUniformBuffers||(m=m.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),c+=m.replace(/\{X\}/g,y.toString())+"\n"}else t.supportsUniformBuffers||(c=c.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),c=c.replace(/\{X\}/g,f)}o=o.replace(i[0],c),s=s||c.indexOf("#include<")>=0||c.indexOf("#include <")>=0,i=mw.exec(e)};null!=i;){var u=a();if("object"==typeof u)return u.value}s?this._ProcessIncludes(o.toString(),t,r):r(o)},yw._FileToolsLoadFile=function(e,t,r,n,i,o){throw(0,_Misc_devTools__WEBPACK_IMPORTED_MODULE_9__._WarnImport)("FileTools")},Ew.GetShadersRepository=function(e){return void 0===e&&(e=Aw.GLSL),e===Aw.GLSL?Ew.ShadersRepository:Ew.ShadersRepositoryWGSL},Ew.GetShadersStore=function(e){return void 0===e&&(e=Aw.GLSL),e===Aw.GLSL?Ew.ShadersStore:Ew.ShadersStoreWGSL},Ew.GetIncludesShadersStore=function(e){return void 0===e&&(e=Aw.GLSL),e===Aw.GLSL?Ew.IncludesShadersStore:Ew.IncludesShadersStoreWGSL},Ew.ShadersRepository="Source/Shaders/",Ew.ShadersStore={},Ew.IncludesShadersStore={},Ew.ShadersRepositoryWGSL="Source/ShadersWGSL/",Ew.ShadersStoreWGSL={},Ew.IncludesShadersStoreWGSL={},xw.prototype._useFinalCode=function(e,t){if(t){var r=t.computeElement||t.compute||t.spectorName||t;this._computeSourceCode="//#define SHADER_NAME compute:"+r+"\n"+e}else this._computeSourceCode=e;this._prepareEffect()},Object.defineProperty(xw.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),xw.prototype.isReady=function(){try{return this._isReadyInternal()}catch(e){return!1}},xw.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},xw.prototype.getEngine=function(){return this._engine},xw.prototype.getPipelineContext=function(){return this._pipelineContext},xw.prototype.getCompilationError=function(){return this._compilationError},xw.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add((function(t){e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){t._checkIsReady(null)}),16))},xw.prototype._checkIsReady=function(e){var t=this;try{if(this._isReadyInternal())return}catch(t){return void this._processCompilationErrors(t,e)}setTimeout((function(){t._checkIsReady(e)}),16)},xw.prototype._loadShader=function(e,t,r,n){var i;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return void n(Object(_Misc_domManagement__WEBPACK_IMPORTED_MODULE_2__.GetDOMTextContent)(e));"source:"!==e.substr(0,7)?"base64:"!==e.substr(0,7)?this._shaderStore[e+t+"Shader"]?n(this._shaderStore[e+t+"Shader"]):r&&this._shaderStore[e+r+"Shader"]?n(this._shaderStore[e+r+"Shader"]):(i="."===e[0]||"/"===e[0]||e.indexOf("http")>-1?e:this._shaderRepository+e,this._engine._loadFile(i+"."+t.toLowerCase()+".fx",n)):n(window.atob(e.substr(7))):n(e.substr(7))},Object.defineProperty(xw.prototype,"computeSourceCode",{get:function(){var e,t;return this._computeSourceCodeOverride?this._computeSourceCodeOverride:null!==(t=null===(e=this._pipelineContext)||void 0===e?void 0:e._getComputeShaderCode())&&void 0!==t?t:this._computeSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(xw.prototype,"rawComputeSourceCode",{get:function(){return this._rawComputeSourceCode},enumerable:!1,configurable:!0}),xw.prototype._prepareEffect=function(){var e=this,t=this.defines,r=this._pipelineContext;this._isReady=!1;try{var n=this._engine;this._pipelineContext=n.createComputePipelineContext(),this._pipelineContext._name=this._key,n._prepareComputePipelineContext(this._pipelineContext,this._computeSourceCodeOverride?this._computeSourceCodeOverride:this._computeSourceCode,this._rawComputeSourceCode,this._computeSourceCodeOverride?null:t,this._entryPoint),n._executeWhenComputeStateIsCompiled(this._pipelineContext,(function(){e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),r&&e.getEngine()._deleteComputePipelineContext(r)})),this._pipelineContext.isAsync&&this._checkIsReady(r)}catch(e){this._processCompilationErrors(e,r)}},xw.prototype._getShaderCodeAndErrorLine=function(e,t){var r=null;if(t&&e){var n=t.match(/COMPUTE SHADER ERROR: 0:(\d+?):/);if(n&&2===n.length){var i=parseInt(n[1]),o=e.split("\n",-1);o.length>=i&&(r="Offending line ["+i+"] in compute code: "+o[i-1])}}return[e,r]},xw.prototype._processCompilationErrors=function(e,t){var r,n;if(void 0===t&&(t=null),this._compilationError=e.message,WM.Error("Unable to compile compute effect:"),WM.Error("Defines:\r\n"+this.defines),xw.LogShaderCodeOnCompilationError){var i=null,o=null;(null===(n=this._pipelineContext)||void 0===n?void 0:n._getComputeShaderCode())&&(o=(r=this._getShaderCodeAndErrorLine(this._pipelineContext._getComputeShaderCode(),this._compilationError))[0],i=r[1],o&&(WM.Error("Compute code:"),WM.Error(o))),i&&WM.Error(i)}WM.Error("Error: "+this._compilationError),t&&(this._pipelineContext=t,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this))},xw.prototype.dispose=function(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseComputeEffect(this)},xw.RegisterShader=function(e,t){Ew.GetShadersStore(Aw.WGSL)[e+"ComputeShader"]=t},xw._uniqueIdSeed=0,xw.LogShaderCodeOnCompilationError=!0,Object.defineProperty(Cw,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(Cw,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),Cw.Instances=new Array,Cw._LastCreatedScene=null,Cw.UseFallbackTexture=!0,Cw.FallbackTexture="",Object.defineProperty(bw,"Now",{get:function(){return"undefined"!=typeof window&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),Iw.prototype.sampleFrame=function(e){if(void 0===e&&(e=bw.Now),this._enabled){if(null!=this._lastFrameTimeMs){var t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}},Object.defineProperty(Iw.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(Iw.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!1,configurable:!0}),Object.defineProperty(Iw.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!1,configurable:!0}),Object.defineProperty(Iw.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(Iw.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e},enumerable:!1,configurable:!0}),Object.defineProperty(Iw.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!1,configurable:!0}),Iw.prototype.enable=function(){this._enabled=!0},Iw.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(Iw.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),Iw.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},Tw.prototype.add=function(e){var t;if(this.isSaturated()){var r=this._samples[this._pos];t=r-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(r-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},Tw.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},Tw.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},Tw.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},Tw.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},Object.defineProperty(vw.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(vw.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0}),Object.defineProperty(vw.prototype,"average",{get:function(){return this._average},enumerable:!1,configurable:!0}),Object.defineProperty(vw.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!1,configurable:!0}),Object.defineProperty(vw.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(vw.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!1,configurable:!0}),Object.defineProperty(vw.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!1,configurable:!0}),vw.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},vw.prototype.addCount=function(e,t){vw.Enabled&&(this._current+=e,t&&this._fetchResult())},vw.prototype.beginMonitoring=function(){vw.Enabled&&(this._startMonitoringTime=bw.Now)},vw.prototype.endMonitoring=function(e){if(void 0===e&&(e=!0),vw.Enabled){e&&this.fetchNewFrame();var t=bw.Now;this._current=t-this._startMonitoringTime,e&&this._fetchResult()}},vw.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=bw.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},vw.Enabled=!0,tw&&(Rw.__proto__=tw),Rw.prototype=Object.create(tw&&tw.prototype),Rw.prototype.constructor=tw,Object.defineProperty(Rw,"NpmPackage",{get:function(){return _thinEngine__WEBPACK_IMPORTED_MODULE_6__.ThinEngine.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(Rw,"Version",{get:function(){return tw.Version},enumerable:!1,configurable:!0}),Object.defineProperty(Rw,"Instances",{get:function(){return Cw.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(Rw,"LastCreatedEngine",{get:function(){return Cw.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(Rw,"LastCreatedScene",{get:function(){return Cw.LastCreatedScene},enumerable:!1,configurable:!0}),Rw.prototype._createImageBitmapFromSource=function(e,t){var r=this;return new Promise((function(n,i){var o=new Image;o.onload=function(){o.decode().then((function(){r.createImageBitmap(o,t).then((function(e){n(e)}))}))},o.onerror=function(){i("Error loading image ".concat(o.src))},o.src=e}))},Rw.prototype.createImageBitmap=function(e,t){return createImageBitmap(e,t)},Rw.prototype.resizeImageBitmap=function(e,t,r){var n=this.createCanvas(t,r).getContext("2d");if(!n)throw new Error("Unable to get 2d context for resizeImageBitmap");return n.drawImage(e,0,0),n.getImageData(0,0,t,r).data},Rw.MarkAllMaterialsAsDirty=function(e,t){for(var r=0;r<Rw.Instances.length;r++)for(var n=Rw.Instances[r],i=0;i<n.scenes.length;i++)n.scenes[i].markAllMaterialsAsDirty(e,t)},Rw.DefaultLoadingScreenFactory=function(e){throw(0,_Misc_devTools__WEBPACK_IMPORTED_MODULE_5__._WarnImport)("LoadingScreen")},Object.defineProperty(Rw.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!Rw._RescalePostProcessFactory},enumerable:!1,configurable:!0}),Object.defineProperty(Rw.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!1,configurable:!0}),Object.defineProperty(Rw.prototype,"compatibilityMode",{get:function(){return this._compatibilityMode},set:function(e){this._compatibilityMode=!0},enumerable:!1,configurable:!0}),Rw.prototype.getInputElement=function(){return this._renderingCanvas},Rw.prototype._sharedInit=function(e,t,r){var n=this;if(tw.prototype._sharedInit.call(this,e,t,r),this._onCanvasFocus=function(){n.onCanvasFocusObservable.notifyObservers(n)},this._onCanvasBlur=function(){n.onCanvasBlurObservable.notifyObservers(n)},e.addEventListener("focus",this._onCanvasFocus),e.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){n.disablePerformanceMonitorInBackground&&n._performanceMonitor.disable(),n._windowIsBackground=!0},this._onFocus=function(){n.disablePerformanceMonitorInBackground&&n._performanceMonitor.enable(),n._windowIsBackground=!1},this._onCanvasPointerOut=function(t){document.elementFromPoint(t.clientX,t.clientY)!==e&&n.onCanvasPointerOutObservable.notifyObservers(t)},(0,_Misc_domManagement__WEBPACK_IMPORTED_MODULE_3__.IsWindowObjectExist)()){var i=this.getHostWindow();i&&(i.addEventListener("blur",this._onBlur),i.addEventListener("focus",this._onFocus))}e.addEventListener("pointerout",this._onCanvasPointerOut),t||this._disableTouchAction(),!Rw.audioEngine&&r&&Rw.AudioEngineFactory&&(Rw.audioEngine=Rw.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination()))},Rw.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var r=e.viewport;return this.getRenderWidth(t)*r.width/(this.getRenderHeight(t)*r.height)},Rw.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},Rw.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},Rw.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},Rw.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},Rw.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},Rw.prototype.getTimeStep=function(){return 1e3*this._timeStep},Rw.prototype.generateMipMapsForCubemap=function(e,t){if(void 0===t&&(t=!0),e.generateMipMaps){var r=this._gl;this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,e,!0),r.generateMipmap(r.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null)}},Rw.prototype.getDepthBuffer=function(){return this._depthCullingState.depthTest},Rw.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},Rw.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},Rw.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},Rw.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},Rw.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},Rw.prototype.getStencilMask=function(){return this._stencilState.stencilMask},Rw.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},Rw.prototype.getStencilFunction=function(e){return e===cp.FRONT?this._stencilState.frontStencilFunc:this._stencilState.backStencilFunc},Rw.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},Rw.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},Rw.prototype.setStencilFunction=function(e,t){e===cp.FRONT?this._stencilState.frontStencilFunc=t:this._stencilState.backStencilFunc=t},Rw.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},Rw.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},Rw.prototype.getStencilOperationFail=function(e){return e===cp.FRONT?this._stencilState.frontStencilOpStencilFail:this._stencilState.backStencilOpStencilFail},Rw.prototype.getStencilOperationDepthFail=function(e){return e===cp.FRONT?this._stencilState.frontStencilOpDepthFail:this._stencilState.backStencilOpDepthFail},Rw.prototype.getStencilOperationPass=function(e){return e===cp.FRONT?this._stencilState.frontStencilOpStencilDepthPass:this._stencilState.backStencilOpStencilDepthPass},Rw.prototype.setStencilOperationFail=function(e,t){e===cp.FRONT?this._stencilState.frontStencilOpStencilFail=t:this._stencilState.backStencilOpStencilFail=t},Rw.prototype.setStencilOperationDepthFail=function(e,t){e===cp.FRONT?this._stencilState.frontStencilOpDepthFail=t:this._stencilState.backStencilOpDepthFail=t},Rw.prototype.setStencilOperationPass=function(e,t){e===cp.FRONT?this._stencilState.frontStencilOpStencilDepthPass=t:this._stencilState.backStencilOpStencilDepthPass=t},Rw.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},Rw.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},Rw.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},Rw.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},Rw.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(cp.GREATER)},Rw.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(cp.GEQUAL)},Rw.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(cp.LESS)},Rw.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(cp.LEQUAL)},Rw.prototype.setDirectViewport=function(e,t,r,n){var i=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,r,n),i},Rw.prototype.scissorClear=function(e,t,r,n,i){this.enableScissor(e,t,r,n),this.clear(i,!0,!0,!0),this.disableScissor()},Rw.prototype.enableScissor=function(e,t,r,n){var i=this._gl;i.enable(i.SCISSOR_TEST),i.scissor(e,t,r,n)},Rw.prototype.disableScissor=function(){var e=this._gl;e.disable(e.SCISSOR_TEST)},Rw.prototype._reportDrawCall=function(e){void 0===e&&(e=1),this._drawCalls.addCount(e,!1)},Rw.prototype.initWebVR=function(){throw(0,_Misc_devTools__WEBPACK_IMPORTED_MODULE_5__._WarnImport)("WebVRCamera")},Rw.prototype._prepareVRComponent=function(){},Rw.prototype._connectVREvents=function(e,t){},Rw.prototype._submitVRFrame=function(){},Rw.prototype.disableVR=function(){},Rw.prototype.isVRPresenting=function(){return!1},Rw.prototype._requestVRFrame=function(){},Rw.prototype._loadFileAsync=function(e,t,r){var n=this;return new Promise((function(i,o){n._loadFile(e,(function(e){i(e)}),void 0,t,r,(function(e,t){o(t)}))}))},Rw.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null},Rw.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null},Rw.prototype.setDepthStencilTexture=function(e,t,r,n){void 0!==e&&(t&&(this._boundUniforms[e]=t),r&&r.depthStencilTexture?this._setTexture(e,r,!1,!0,n):this._setTexture(e,null,void 0,void 0,n))},Rw.prototype.setTextureFromPostProcess=function(e,t,r){var n,i=null;t&&(t._textures.data[t._currentRenderTextureInd]?i=t._textures.data[t._currentRenderTextureInd]:t._forcedOutputTexture&&(i=t._forcedOutputTexture)),this._bindTexture(e,null!==(n=null==i?void 0:i.texture)&&void 0!==n?n:null,r)},Rw.prototype.setTextureFromPostProcessOutput=function(e,t,r){var n,i;this._bindTexture(e,null!==(i=null===(n=null==t?void 0:t._outputTexture)||void 0===n?void 0:n.texture)&&void 0!==i?i:null,r)},Rw.prototype._rebuildBuffers=function(){for(var e=0,t=this.scenes;e<t.length;e++){(i=t[e]).resetCachedMaterial(),i._rebuildGeometries(),i._rebuildTextures()}for(var r=0,n=this._virtualScenes;r<n.length;r++){var i;(i=n[r]).resetCachedMaterial(),i._rebuildGeometries(),i._rebuildTextures()}tw.prototype._rebuildBuffers.call(this)},Rw.prototype._renderFrame=function(){for(var e=0;e<this._activeRenderLoops.length;e++){(0,this._activeRenderLoops[e])()}},Rw.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},Rw.prototype._renderViews=function(){return!1},Rw.prototype.switchFullscreen=function(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)},Rw.prototype.enterFullscreen=function(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&Rw._RequestFullscreen(this._renderingCanvas))},Rw.prototype.exitFullscreen=function(){this.isFullscreen&&Rw._ExitFullscreen()},Rw.prototype.enterPointerlock=function(){this._renderingCanvas&&Rw._RequestPointerlock(this._renderingCanvas)},Rw.prototype.exitPointerlock=function(){Rw._ExitPointerlock()},Rw.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),tw.prototype.beginFrame.call(this)},Rw.prototype.endFrame=function(){tw.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},Rw.prototype.resize=function(e){void 0===e&&(e=!1),this.isVRPresenting()||tw.prototype.resize.call(this,e)},Rw.prototype.setSize=function(e,t,r){if(void 0===r&&(r=!1),!this._renderingCanvas)return!1;if(!tw.prototype.setSize.call(this,e,t,r))return!1;if(this.scenes){for(var n=0;n<this.scenes.length;n++)for(var i=this.scenes[n],o=0;o<i.cameras.length;o++){i.cameras[o]._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},Rw.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),tw.prototype._deletePipelineContext.call(this,e)},Rw.prototype.createShaderProgram=function(e,t,r,n,i,o){void 0===o&&(o=null),i=i||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var s=tw.prototype.createShaderProgram.call(this,e,t,r,n,i,o);return this.onAfterShaderCompilationObservable.notifyObservers(this),s},Rw.prototype._createShaderProgram=function(e,t,r,n,i){void 0===i&&(i=null);var o=n.createProgram();if(e.program=o,!o)throw new Error("Unable to create program");if(n.attachShader(o,t),n.attachShader(o,r),this.webGLVersion>1&&i){var s=this.createTransformFeedback();this.bindTransformFeedback(s),this.setTranformFeedbackVaryings(o,i),e.transformFeedback=s}return n.linkProgram(o),this.webGLVersion>1&&i&&this.bindTransformFeedback(null),e.context=n,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),o},Rw.prototype._releaseTexture=function(e){tw.prototype._releaseTexture.call(this,e)},Rw.prototype._releaseRenderTargetWrapper=function(e){tw.prototype._releaseRenderTargetWrapper.call(this,e),this.scenes.forEach((function(t){t.postProcesses.forEach((function(t){t._outputTexture===e&&(t._outputTexture=null)})),t.cameras.forEach((function(t){t._postProcesses.forEach((function(t){t&&t._outputTexture===e&&(t._outputTexture=null)}))}))}))},Rw.prototype.getRenderPassNames=function(){return this._renderPassNames},Rw.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},Rw.prototype.createRenderPassId=function(e){var t=++Rw._RenderPassIdCounter;return this._renderPassNames[t]=null!=e?e:"NONAME",t},Rw.prototype.releaseRenderPassId=function(e){this._renderPassNames[e]=void 0;for(var t=0;t<this.scenes.length;++t)for(var r=this.scenes[t],n=0;n<r.meshes.length;++n){var i=r.meshes[n];if(i.subMeshes)for(var o=0;o<i.subMeshes.length;++o){i.subMeshes[o]._removeDrawWrapper(e)}}},Rw.prototype._rescaleTexture=function(e,t,r,n,i){var o=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var s=this.createRenderTargetTexture({width:t.width,height:t.height},{generateMipMaps:!1,type:cp.TEXTURETYPE_UNSIGNED_INT,samplingMode:cp.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&Rw._RescalePostProcessFactory&&(this._rescalePostProcess=Rw._RescalePostProcessFactory(this)),this._rescalePostProcess.externalTextureSamplerBinding=!0,this._rescalePostProcess.getEffect().executeWhenCompiled((function(){o._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",e)};var a=r;a||(a=o.scenes[o.scenes.length-1]),a.postProcessManager.directRender([o._rescalePostProcess],s,!0),o._bindTextureDirectly(o._gl.TEXTURE_2D,t,!0),o._gl.copyTexImage2D(o._gl.TEXTURE_2D,0,n,0,0,t.width,t.height,0),o.unBindFramebuffer(s),s.dispose(),i&&i()}))},Rw.prototype.getFps=function(){return this._fps},Rw.prototype.getDeltaTime=function(){return this._deltaTime},Rw.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},Rw.prototype.wrapWebGLTexture=function(e){var t=new _WebGL_webGLHardwareTexture__WEBPACK_IMPORTED_MODULE_12__.WebGLHardwareTexture(e,this._gl),r=new _Materials_Textures_internalTexture__WEBPACK_IMPORTED_MODULE_2__.InternalTexture(this,_Materials_Textures_internalTexture__WEBPACK_IMPORTED_MODULE_2__.InternalTextureSource.Unknown,!0);return r._hardwareTexture=t,r.isReady=!0,r},Rw.prototype._uploadImageToTexture=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var i=this._gl,o=this._getWebGLTextureType(e.type),s=this._getInternalFormat(e.format),a=this._getRGBABufferInternalSizedFormat(e.type,s),u=e.isCube?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D;this._bindTextureDirectly(u,e,!0),this._unpackFlipY(e.invertY);var c=i.TEXTURE_2D;e.isCube&&(c=i.TEXTURE_CUBE_MAP_POSITIVE_X+r),i.texImage2D(c,n,a,s,o,t),this._bindTextureDirectly(u,null,!0)},Rw.prototype.updateTextureComparisonFunction=function(e,t){if(1!==this.webGLVersion){var r=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,cp.LEQUAL),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,t),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,cp.LEQUAL),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}else WM.Error("WebGL 1 does not support texture comparison.")},Rw.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");var r=new _Meshes_WebGL_webGLDataBuffer__WEBPACK_IMPORTED_MODULE_10__.WebGLDataBuffer(t);return r.capacity=e,this.bindArrayBuffer(r),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),r.references=1,r},Rw.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},Rw.prototype._clientWaitAsync=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=10);var n=this._gl;return new Promise((function(i,o){var s=function(){var a=n.clientWaitSync(e,t,0);a!=n.WAIT_FAILED?a!=n.TIMEOUT_EXPIRED?i():setTimeout(s,r):o()};s()}))},Rw.prototype._readPixelsAsync=function(e,t,r,n,i,o,s){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var a=this._gl,u=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,u),a.bufferData(a.PIXEL_PACK_BUFFER,s.byteLength,a.STREAM_READ),a.readPixels(e,t,r,n,i,o,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null);var c=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);return c?(a.flush(),this._clientWaitAsync(c,0,10).then((function(){return a.deleteSync(c),a.bindBuffer(a.PIXEL_PACK_BUFFER,u),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,s),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteBuffer(u),s}))):null},Rw.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();1===Rw.Instances.length&&Rw.audioEngine&&(Rw.audioEngine.dispose(),Rw.audioEngine=null),this.disableVR(),tw.prototype.dispose.call(this);var e=Rw.Instances.indexOf(this);e>=0&&Rw.Instances.splice(e,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},Rw.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},Rw.prototype.displayLoadingUI=function(){if((0,_Misc_domManagement__WEBPACK_IMPORTED_MODULE_3__.IsWindowObjectExist)()){var e=this.loadingScreen;e&&e.displayLoadingUI()}},Rw.prototype.hideLoadingUI=function(){var e=this._loadingScreen;e&&e.hideLoadingUI()},Object.defineProperty(Rw.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=Rw.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!1,configurable:!0}),Object.defineProperty(Rw.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!1,configurable:!0}),Object.defineProperty(Rw.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!1,configurable:!0}),Rw.prototype.createVideoElement=function(e){return document.createElement("video")},Rw._RequestPointerlock=function(e){e.requestPointerLock=e.requestPointerLock||e.msRequestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock&&(e.requestPointerLock(),e.focus())},Rw._ExitPointerlock=function(){var e=document;document.exitPointerLock=document.exitPointerLock||e.msExitPointerLock||e.mozExitPointerLock||e.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},Rw._RequestFullscreen=function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)},Rw._ExitFullscreen=function(){var e=document;document.exitFullscreen?document.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msCancelFullScreen&&e.msCancelFullScreen()},Rw.prototype.getFontOffset=function(e){var t=document.createElement("span");t.innerHTML="Hg",t.setAttribute("style","font: ".concat(e," !important"));var r=document.createElement("div");r.style.display="inline-block",r.style.width="1px",r.style.height="0px",r.style.verticalAlign="bottom";var n=document.createElement("div");n.style.whiteSpace="nowrap",n.appendChild(t),n.appendChild(r),document.body.appendChild(n);var i=0,o=0;try{o=r.getBoundingClientRect().top-t.getBoundingClientRect().top,r.style.verticalAlign="baseline",i=r.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(n)}return{ascent:i,height:o,descent:o-i}},Rw.ALPHA_DISABLE=cp.ALPHA_DISABLE,Rw.ALPHA_ADD=cp.ALPHA_ADD,Rw.ALPHA_COMBINE=cp.ALPHA_COMBINE,Rw.ALPHA_SUBTRACT=cp.ALPHA_SUBTRACT,Rw.ALPHA_MULTIPLY=cp.ALPHA_MULTIPLY,Rw.ALPHA_MAXIMIZED=cp.ALPHA_MAXIMIZED,Rw.ALPHA_ONEONE=cp.ALPHA_ONEONE,Rw.ALPHA_PREMULTIPLIED=cp.ALPHA_PREMULTIPLIED,Rw.ALPHA_PREMULTIPLIED_PORTERDUFF=cp.ALPHA_PREMULTIPLIED_PORTERDUFF,Rw.ALPHA_INTERPOLATE=cp.ALPHA_INTERPOLATE,Rw.ALPHA_SCREENMODE=cp.ALPHA_SCREENMODE,Rw.DELAYLOADSTATE_NONE=cp.DELAYLOADSTATE_NONE,Rw.DELAYLOADSTATE_LOADED=cp.DELAYLOADSTATE_LOADED,Rw.DELAYLOADSTATE_LOADING=cp.DELAYLOADSTATE_LOADING,Rw.DELAYLOADSTATE_NOTLOADED=cp.DELAYLOADSTATE_NOTLOADED,Rw.NEVER=cp.NEVER,Rw.ALWAYS=cp.ALWAYS,Rw.LESS=cp.LESS,Rw.EQUAL=cp.EQUAL,Rw.LEQUAL=cp.LEQUAL,Rw.GREATER=cp.GREATER,Rw.GEQUAL=cp.GEQUAL,Rw.NOTEQUAL=cp.NOTEQUAL,Rw.KEEP=cp.KEEP,Rw.REPLACE=cp.REPLACE,Rw.INCR=cp.INCR,Rw.DECR=cp.DECR,Rw.INVERT=cp.INVERT,Rw.INCR_WRAP=cp.INCR_WRAP,Rw.DECR_WRAP=cp.DECR_WRAP,Rw.TEXTURE_CLAMP_ADDRESSMODE=cp.TEXTURE_CLAMP_ADDRESSMODE,Rw.TEXTURE_WRAP_ADDRESSMODE=cp.TEXTURE_WRAP_ADDRESSMODE,Rw.TEXTURE_MIRROR_ADDRESSMODE=cp.TEXTURE_MIRROR_ADDRESSMODE,Rw.TEXTUREFORMAT_ALPHA=cp.TEXTUREFORMAT_ALPHA,Rw.TEXTUREFORMAT_LUMINANCE=cp.TEXTUREFORMAT_LUMINANCE,Rw.TEXTUREFORMAT_LUMINANCE_ALPHA=cp.TEXTUREFORMAT_LUMINANCE_ALPHA,Rw.TEXTUREFORMAT_RGB=cp.TEXTUREFORMAT_RGB,Rw.TEXTUREFORMAT_RGBA=cp.TEXTUREFORMAT_RGBA,Rw.TEXTUREFORMAT_RED=cp.TEXTUREFORMAT_RED,Rw.TEXTUREFORMAT_R=cp.TEXTUREFORMAT_R,Rw.TEXTUREFORMAT_RG=cp.TEXTUREFORMAT_RG,Rw.TEXTUREFORMAT_RED_INTEGER=cp.TEXTUREFORMAT_RED_INTEGER,Rw.TEXTUREFORMAT_R_INTEGER=cp.TEXTUREFORMAT_R_INTEGER,Rw.TEXTUREFORMAT_RG_INTEGER=cp.TEXTUREFORMAT_RG_INTEGER,Rw.TEXTUREFORMAT_RGB_INTEGER=cp.TEXTUREFORMAT_RGB_INTEGER,Rw.TEXTUREFORMAT_RGBA_INTEGER=cp.TEXTUREFORMAT_RGBA_INTEGER,Rw.TEXTURETYPE_UNSIGNED_BYTE=cp.TEXTURETYPE_UNSIGNED_BYTE,Rw.TEXTURETYPE_UNSIGNED_INT=cp.TEXTURETYPE_UNSIGNED_INT,Rw.TEXTURETYPE_FLOAT=cp.TEXTURETYPE_FLOAT,Rw.TEXTURETYPE_HALF_FLOAT=cp.TEXTURETYPE_HALF_FLOAT,Rw.TEXTURETYPE_BYTE=cp.TEXTURETYPE_BYTE,Rw.TEXTURETYPE_SHORT=cp.TEXTURETYPE_SHORT,Rw.TEXTURETYPE_UNSIGNED_SHORT=cp.TEXTURETYPE_UNSIGNED_SHORT,Rw.TEXTURETYPE_INT=cp.TEXTURETYPE_INT,Rw.TEXTURETYPE_UNSIGNED_INTEGER=cp.TEXTURETYPE_UNSIGNED_INTEGER,Rw.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=cp.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4,Rw.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=cp.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1,Rw.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=cp.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,Rw.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=cp.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV,Rw.TEXTURETYPE_UNSIGNED_INT_24_8=cp.TEXTURETYPE_UNSIGNED_INT_24_8,Rw.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=cp.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV,Rw.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=cp.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV,Rw.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=cp.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV,Rw.TEXTURE_NEAREST_SAMPLINGMODE=cp.TEXTURE_NEAREST_SAMPLINGMODE,Rw.TEXTURE_BILINEAR_SAMPLINGMODE=cp.TEXTURE_BILINEAR_SAMPLINGMODE,Rw.TEXTURE_TRILINEAR_SAMPLINGMODE=cp.TEXTURE_TRILINEAR_SAMPLINGMODE,Rw.TEXTURE_NEAREST_NEAREST_MIPLINEAR=cp.TEXTURE_NEAREST_NEAREST_MIPLINEAR,Rw.TEXTURE_LINEAR_LINEAR_MIPNEAREST=cp.TEXTURE_LINEAR_LINEAR_MIPNEAREST,Rw.TEXTURE_LINEAR_LINEAR_MIPLINEAR=cp.TEXTURE_LINEAR_LINEAR_MIPLINEAR,Rw.TEXTURE_NEAREST_NEAREST_MIPNEAREST=cp.TEXTURE_NEAREST_NEAREST_MIPNEAREST,Rw.TEXTURE_NEAREST_LINEAR_MIPNEAREST=cp.TEXTURE_NEAREST_LINEAR_MIPNEAREST,Rw.TEXTURE_NEAREST_LINEAR_MIPLINEAR=cp.TEXTURE_NEAREST_LINEAR_MIPLINEAR,Rw.TEXTURE_NEAREST_LINEAR=cp.TEXTURE_NEAREST_LINEAR,Rw.TEXTURE_NEAREST_NEAREST=cp.TEXTURE_NEAREST_NEAREST,Rw.TEXTURE_LINEAR_NEAREST_MIPNEAREST=cp.TEXTURE_LINEAR_NEAREST_MIPNEAREST,Rw.TEXTURE_LINEAR_NEAREST_MIPLINEAR=cp.TEXTURE_LINEAR_NEAREST_MIPLINEAR,Rw.TEXTURE_LINEAR_LINEAR=cp.TEXTURE_LINEAR_LINEAR,Rw.TEXTURE_LINEAR_NEAREST=cp.TEXTURE_LINEAR_NEAREST,Rw.TEXTURE_EXPLICIT_MODE=cp.TEXTURE_EXPLICIT_MODE,Rw.TEXTURE_SPHERICAL_MODE=cp.TEXTURE_SPHERICAL_MODE,Rw.TEXTURE_PLANAR_MODE=cp.TEXTURE_PLANAR_MODE,Rw.TEXTURE_CUBIC_MODE=cp.TEXTURE_CUBIC_MODE,Rw.TEXTURE_PROJECTION_MODE=cp.TEXTURE_PROJECTION_MODE,Rw.TEXTURE_SKYBOX_MODE=cp.TEXTURE_SKYBOX_MODE,Rw.TEXTURE_INVCUBIC_MODE=cp.TEXTURE_INVCUBIC_MODE,Rw.TEXTURE_EQUIRECTANGULAR_MODE=cp.TEXTURE_EQUIRECTANGULAR_MODE,Rw.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=cp.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,Rw.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=cp.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,Rw.SCALEMODE_FLOOR=cp.SCALEMODE_FLOOR,Rw.SCALEMODE_NEAREST=cp.SCALEMODE_NEAREST,Rw.SCALEMODE_CEILING=cp.SCALEMODE_CEILING,Rw._RescalePostProcessFactory=null,Rw._RenderPassIdCounter=0,Mw.prototype._loadShaderAsNormal=function(e,t,r,n,i,o){var s=this,a=[void 0,void 0],u=function(){if(a[0]&&a[1]){o.isFragment=!0;var t=a[0],r=a[1];yw.Process(r,o,(function(r){n&&(r=n("fragment",r));var i=yw.Finalize(t,r,o);s._useFinalCode(i.vertexCode,i.fragmentCode,e)}),s._engine)}};i.vertexCode?(yw.Initialize(o),yw.Process(i.vertexCode,o,(function(e){s._rawVertexSourceCode=i.vertexCode,n&&(e=n("vertex",e)),a[0]=e,u()}),s._engine)):this._loadShader(t,"Vertex","",(function(e){yw.Initialize(o),yw.Process(e,o,(function(t){s._rawVertexSourceCode=e,n&&(t=n("vertex",t)),a[0]=t,u()}),s._engine)})),i.fragmentCode?(s._rawFragmentSourceCode=i.fragmentCode,a[1]=i.fragmentCode,u()):this._loadShader(r,"Fragment","Pixel",(function(e){s._rawFragmentSourceCode=e,a[1]=e,u()}))},Object.defineProperty(Mw,"ShadersRepository",{get:function(){return Ew.ShadersRepository},set:function(e){Ew.ShadersRepository=e},enumerable:!1,configurable:!0}),Object.defineProperty(Mw.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new _Misc_observable__WEBPACK_IMPORTED_MODULE_0__.Observable),this._onBindObservable},enumerable:!1,configurable:!0}),Mw.prototype._useFinalCode=function(e,t,r){if(r){var n=r.vertexElement||r.vertex||r.spectorName||r,i=r.fragmentElement||r.fragment||r.spectorName||r;this._vertexSourceCode=(this._shaderLanguage===Aw.WGSL?"//":"")+"#define SHADER_NAME vertex:"+n+"\n"+e,this._fragmentSourceCode=(this._shaderLanguage===Aw.WGSL?"//":"")+"#define SHADER_NAME fragment:"+i+"\n"+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()},Object.defineProperty(Mw.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),Mw.prototype.isReady=function(){try{return this._isReadyInternal()}catch(e){return!1}},Mw.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},Mw.prototype.getEngine=function(){return this._engine},Mw.prototype.getPipelineContext=function(){return this._pipelineContext},Mw.prototype.getAttributesNames=function(){return this._attributesNames},Mw.prototype.getAttributeLocation=function(e){return this._attributes[e]},Mw.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},Mw.prototype.getAttributesCount=function(){return this._attributes.length},Mw.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},Mw.prototype.getUniform=function(e){return this._uniforms[e]},Mw.prototype.getSamplers=function(){return this._samplerList},Mw.prototype.getUniformNames=function(){return this._uniformsNames},Mw.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},Mw.prototype.getIndexParameters=function(){return this._indexParameters},Mw.prototype.getCompilationError=function(){return this._compilationError},Mw.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},Mw.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add((function(t){e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){t._checkIsReady(null)}),16))},Mw.prototype._checkIsReady=function(e){var t=this;try{if(this._isReadyInternal())return}catch(t){return void this._processCompilationErrors(t,e)}this._isDisposed||setTimeout((function(){t._checkIsReady(e)}),16)},Mw.prototype._loadShader=function(e,t,r,n){if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return void n(function(e){for(var t="",r=e.firstChild;r;)3===r.nodeType&&(t+=r.textContent),r=r.nextSibling;return t}(e));if("source:"!==e.substr(0,7))if("base64:"!==e.substr(0,7)){var i,o=Ew.GetShadersStore(this._shaderLanguage);if(o[e+t+"Shader"])n(o[e+t+"Shader"]);else if(r&&o[e+r+"Shader"])n(o[e+r+"Shader"]);else i="."===e[0]||"/"===e[0]||e.indexOf("http")>-1?e:Ew.GetShadersRepository(this._shaderLanguage)+e,this._engine._loadFile(i+"."+t.toLowerCase()+".fx",n)}else{n(window.atob(e.substr(7)))}else n(e.substr(7))},Object.defineProperty(Mw.prototype,"vertexSourceCode",{get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!==(t=null===(e=this._pipelineContext)||void 0===e?void 0:e._getVertexShaderCode())&&void 0!==t?t:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(Mw.prototype,"fragmentSourceCode",{get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!==(t=null===(e=this._pipelineContext)||void 0===e?void 0:e._getFragmentShaderCode())&&void 0!==t?t:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(Mw.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(Mw.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),Mw.prototype._rebuildProgram=function(e,t,r,n){var i=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){n&&n(t)},this.onCompiled=function(){var e=i.getEngine().scenes;if(e)for(var t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(cp.MATERIAL_AllDirtyFlag);i._pipelineContext._handlesSpectorRebuildCallback(r)},this._fallbacks=null,this._prepareEffect()},Mw.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,r=this.defines,n=this._pipelineContext;this._isReady=!1;try{var i=this._engine;this._pipelineContext=i.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key;var o=this._rebuildProgram.bind(this);this._compiledVertexWGSL&&this._compiledFragmentWGSL?i._preparePipelineContext(this._pipelineContext,this._compiledVertexWGSL,this._compiledFragmentWGSL,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,o,null,this._transformFeedbackVaryings,this._key,Aw.WGSL):this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?i._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,o,null,this._transformFeedbackVaryings,this._key):i._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,o,r,this._transformFeedbackVaryings,this._key),i._executeWhenRenderingStateIsCompiled(this._pipelineContext,(function(){if(e._attributes=[],e._pipelineContext._fillEffectInformation(e,e._uniformBuffersNames,e._uniformsNames,e._uniforms,e._samplerList,e._samplers,t,e._attributes),t)for(var r=0;r<t.length;r++){var o=t[r];e._attributeLocationByName[o]=e._attributes[r]}i.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),n&&e.getEngine()._deletePipelineContext(n)})),this._pipelineContext.isAsync&&this._checkIsReady(n)}catch(e){this._processCompilationErrors(e,n)}},Mw.prototype._getShaderCodeAndErrorLine=function(e,t,r){var n=r?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,i=null;if(t&&e){var o=t.match(n);if(o&&2===o.length){var s=parseInt(o[1]),a=e.split("\n",-1);a.length>=s&&(i="Offending line [".concat(s,"] in ").concat(r?"fragment":"vertex"," code: ").concat(a[s-1]))}}return[e,i]},Mw.prototype._processCompilationErrors=function(e,t){var r,n,i,o,s;void 0===t&&(t=null),this._compilationError=e.message;var a=this._attributesNames,u=this._fallbacks;if(WM.Error("Unable to compile compute effect:"),WM.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),WM.Error("Attributes: "+a.map((function(e){return" "+e}))),WM.Error("Defines:\r\n"+this.defines),Mw.LogShaderCodeOnCompilationError){var c=null,l=null,h=null;(null===(i=this._pipelineContext)||void 0===i?void 0:i._getVertexShaderCode())&&(h=(r=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1))[0],c=r[1],h&&(WM.Error("Vertex code:"),WM.Error(h))),(null===(o=this._pipelineContext)||void 0===o?void 0:o._getFragmentShaderCode())&&(h=(n=this._getShaderCodeAndErrorLine(null===(s=this._pipelineContext)||void 0===s?void 0:s._getFragmentShaderCode(),this._compilationError,!0))[0],l=n[1],h&&(WM.Error("Fragment code:"),WM.Error(h))),c&&WM.Error(c),l&&WM.Error(l)}WM.Error("Error: "+this._compilationError),t&&(this._pipelineContext=t,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),u?(this._pipelineContext=null,u.hasMoreFallbacks?(this._allFallbacksProcessed=!1,WM.Error("Trying next fallback."),this.defines=u.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(Mw.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!1,configurable:!0}),Mw.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t,e)},Mw.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)},Mw.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)},Mw.prototype.setTextureArray=function(e,t){var r=e+"Ex";if(-1===this._samplerList.indexOf(r+"0")){for(var n=this._samplerList.indexOf(e),i=1;i<t.length;i++){var o=r+(i-1).toString();this._samplerList.splice(n+i,0,o)}for(var s=0,a=0,u=this._samplerList;a<u.length;a++){var c=u[a];this._samplers[c]=s,s+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)},Mw.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)},Mw.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)},Mw.prototype.bindUniformBuffer=function(e,t){var r=this._uniformBuffersNames[t];void 0===r||Mw._BaseCache[r]===e&&this._engine._features.useUBOBindingCache||(Mw._BaseCache[r]=e,this._engine.bindUniformBufferBase(e,r,t))},Mw.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},Mw.prototype.setInt=function(e,t){return this._pipelineContext.setInt(e,t),this},Mw.prototype.setInt2=function(e,t,r){return this._pipelineContext.setInt2(e,t,r),this},Mw.prototype.setInt3=function(e,t,r,n){return this._pipelineContext.setInt3(e,t,r,n),this},Mw.prototype.setInt4=function(e,t,r,n,i){return this._pipelineContext.setInt4(e,t,r,n,i),this},Mw.prototype.setIntArray=function(e,t){return this._pipelineContext.setIntArray(e,t),this},Mw.prototype.setIntArray2=function(e,t){return this._pipelineContext.setIntArray2(e,t),this},Mw.prototype.setIntArray3=function(e,t){return this._pipelineContext.setIntArray3(e,t),this},Mw.prototype.setIntArray4=function(e,t){return this._pipelineContext.setIntArray4(e,t),this},Mw.prototype.setFloatArray=function(e,t){return this._pipelineContext.setArray(e,t),this},Mw.prototype.setFloatArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},Mw.prototype.setFloatArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},Mw.prototype.setFloatArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},Mw.prototype.setArray=function(e,t){return this._pipelineContext.setArray(e,t),this},Mw.prototype.setArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},Mw.prototype.setArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},Mw.prototype.setArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},Mw.prototype.setMatrices=function(e,t){return this._pipelineContext.setMatrices(e,t),this},Mw.prototype.setMatrix=function(e,t){return this._pipelineContext.setMatrix(e,t),this},Mw.prototype.setMatrix3x3=function(e,t){return this._pipelineContext.setMatrix3x3(e,t),this},Mw.prototype.setMatrix2x2=function(e,t){return this._pipelineContext.setMatrix2x2(e,t),this},Mw.prototype.setFloat=function(e,t){return this._pipelineContext.setFloat(e,t),this},Mw.prototype.setBool=function(e,t){return this._pipelineContext.setInt(e,t?1:0),this},Mw.prototype.setVector2=function(e,t){return this._pipelineContext.setVector2(e,t),this},Mw.prototype.setFloat2=function(e,t,r){return this._pipelineContext.setFloat2(e,t,r),this},Mw.prototype.setVector3=function(e,t){return this._pipelineContext.setVector3(e,t),this},Mw.prototype.setFloat3=function(e,t,r,n){return this._pipelineContext.setFloat3(e,t,r,n),this},Mw.prototype.setVector4=function(e,t){return this._pipelineContext.setVector4(e,t),this},Mw.prototype.setFloat4=function(e,t,r,n,i){return this._pipelineContext.setFloat4(e,t,r,n,i),this},Mw.prototype.setColor3=function(e,t){return this._pipelineContext.setColor3(e,t),this},Mw.prototype.setColor4=function(e,t,r){return this._pipelineContext.setColor4(e,t,r),this},Mw.prototype.setDirectColor4=function(e,t){return this._pipelineContext.setDirectColor4(e,t),this},Mw.prototype.dispose=function(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseEffect(this),this._isDisposed=!0},Mw.RegisterShader=function(e,t,r,n){void 0===n&&(n=Aw.GLSL),t&&(Ew.GetShadersStore(n)["".concat(e,"PixelShader")]=t),r&&(Ew.GetShadersStore(n)["".concat(e,"VertexShader")]=r)},Mw.ResetCache=function(){Mw._BaseCache={}},Mw.LogShaderCodeOnCompilationError=!0,Mw._UniqueIdSeed=0,Mw._BaseCache={},Mw.ShadersStore=Ew.ShadersStore,Mw.IncludesShadersStore=Ew.IncludesShadersStore,Object.defineProperty(ww.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(ww.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),ww.prototype.isDynamic=function(){return void 0!==this._dynamic},ww.prototype.getData=function(){return this._bufferData},ww.prototype.getBuffer=function(){return this._buffer},ww.prototype._fillAlignment=function(e){var t;if(t=e<=2?e:4,this._uniformLocationPointer%t!=0){var r=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var n=this._uniformLocationPointer-r,i=0;i<n;i++)this._data.push(0)}},ww.prototype.addUniform=function(e,t,r){if(void 0===r&&(r=0),!this._noUBO&&void 0===this._uniformLocations[e]){var n;if(r>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;if(this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:r},16==t)t*=r;else t=t*r+(4-t)*r;n=[];for(var i=0;i<t;i++)n.push(0)}else{if(t instanceof Array)t=(n=t).length;else{n=[];for(i=0;i<t;i++)n.push(0)}this._fillAlignment(t)}this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(i=0;i<t;i++)this._data.push(n[i]);this._needSync=!0}},ww.prototype.addMatrix=function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))},ww.prototype.addFloat2=function(e,t,r){var n=[t,r];this.addUniform(e,n)},ww.prototype.addFloat3=function(e,t,r,n){var i=[t,r,n];this.addUniform(e,i)},ww.prototype.addColor3=function(e,t){var r=[t.r,t.g,t.b];this.addUniform(e,r)},ww.prototype.addColor4=function(e,t,r){var n=[t.r,t.g,t.b,r];this.addUniform(e,n)},ww.prototype.addVector3=function(e,t){var r=[t.x,t.y,t.z];this.addUniform(e,r)},ww.prototype.addMatrix3x3=function(e){this.addUniform(e,12)},ww.prototype.addMatrix2x2=function(e){this.addUniform(e,8)},ww.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},ww.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData),this._trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))},Object.defineProperty(ww.prototype,"_numBuffers",{get:function(){return this._buffers.length},enumerable:!1,configurable:!0}),Object.defineProperty(ww.prototype,"_indexBuffer",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),Object.defineProperty(ww.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),ww.prototype._buffersEqual=function(e,t){for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0},ww.prototype._copyBuffer=function(e,t){for(var r=0;r<e.length;++r)t[r]=e[r]},ww.prototype.update=function(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(ww._UpdatedUbosInFrame[this._name]||(ww._UpdatedUbosInFrame[this._name]=0),ww._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._trackUbosInFrame}else this._createBufferOnWrite=this._trackUbosInFrame;else this.create()},ww.prototype._createNewBuffer=function(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()},ww.prototype._checkNewFrame=function(){this._trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)},ww.prototype.updateUniform=function(e,t,r){this._checkNewFrame();var n=this._uniformLocations[e];if(void 0===n){if(this._buffer)return void WM.Error("Cannot add an uniform after UBO has been created.");this.addUniform(e,r),n=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(o=0;o<r;o++)this._bufferData[n+o]=t[o];else{for(var i=!1,o=0;o<r;o++)(16===r&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[n+o]!==HM.FloatRound(t[o]))&&(i=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[n+o]=t[o]);this._needSync=this._needSync||i}},ww.prototype.updateUniformArray=function(e,t,r){this._checkNewFrame();var n=this._uniformLocations[e];if(void 0!==n){this._buffer||this.create();var i=this._uniformArraySizes[e];if(this._dynamic)for(u=0;u<r;u++)this._bufferData[n+u]=t[u];else{for(var o=!1,s=0,a=0,u=0;u<r;u++)if(this._bufferData[n+4*a+s]!==HM.FloatRound(t[u])&&(o=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[n+4*a+s]=t[u]),++s===i.strideSize){for(;s<4;s++)this._bufferData[n+4*a+s]=0;s=0,a++}this._needSync=this._needSync||o}}else WM.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform.")},ww.prototype._cacheMatrix=function(e,t){this._checkNewFrame();var r=this._valueCache[e],n=t.updateFlag;return(void 0===r||r!==n)&&(this._valueCache[e]=n,!0)},ww.prototype._updateMatrix3x3ForUniform=function(e,t){for(var r=0;r<3;r++)ww._TempBuffer[4*r]=t[3*r],ww._TempBuffer[4*r+1]=t[3*r+1],ww._TempBuffer[4*r+2]=t[3*r+2],ww._TempBuffer[4*r+3]=0;this.updateUniform(e,ww._TempBuffer,12)},ww.prototype._updateMatrix3x3ForEffect=function(e,t){this._currentEffect.setMatrix3x3(e,t)},ww.prototype._updateMatrix2x2ForEffect=function(e,t){this._currentEffect.setMatrix2x2(e,t)},ww.prototype._updateMatrix2x2ForUniform=function(e,t){for(var r=0;r<2;r++)ww._TempBuffer[4*r]=t[2*r],ww._TempBuffer[4*r+1]=t[2*r+1],ww._TempBuffer[4*r+2]=0,ww._TempBuffer[4*r+3]=0;this.updateUniform(e,ww._TempBuffer,8)},ww.prototype._updateFloatForEffect=function(e,t){this._currentEffect.setFloat(e,t)},ww.prototype._updateFloatForUniform=function(e,t){ww._TempBuffer[0]=t,this.updateUniform(e,ww._TempBuffer,1)},ww.prototype._updateFloat2ForEffect=function(e,t,r,n){void 0===n&&(n=""),this._currentEffect.setFloat2(e+n,t,r)},ww.prototype._updateFloat2ForUniform=function(e,t,r){ww._TempBuffer[0]=t,ww._TempBuffer[1]=r,this.updateUniform(e,ww._TempBuffer,2)},ww.prototype._updateFloat3ForEffect=function(e,t,r,n,i){void 0===i&&(i=""),this._currentEffect.setFloat3(e+i,t,r,n)},ww.prototype._updateFloat3ForUniform=function(e,t,r,n){ww._TempBuffer[0]=t,ww._TempBuffer[1]=r,ww._TempBuffer[2]=n,this.updateUniform(e,ww._TempBuffer,3)},ww.prototype._updateFloat4ForEffect=function(e,t,r,n,i,o){void 0===o&&(o=""),this._currentEffect.setFloat4(e+o,t,r,n,i)},ww.prototype._updateFloat4ForUniform=function(e,t,r,n,i){ww._TempBuffer[0]=t,ww._TempBuffer[1]=r,ww._TempBuffer[2]=n,ww._TempBuffer[3]=i,this.updateUniform(e,ww._TempBuffer,4)},ww.prototype._updateFloatArrayForEffect=function(e,t){this._currentEffect.setFloatArray(e,t)},ww.prototype._updateFloatArrayForUniform=function(e,t){this.updateUniformArray(e,t,t.length)},ww.prototype._updateArrayForEffect=function(e,t){this._currentEffect.setArray(e,t)},ww.prototype._updateArrayForUniform=function(e,t){this.updateUniformArray(e,t,t.length)},ww.prototype._updateIntArrayForEffect=function(e,t){this._currentEffect.setIntArray(e,t)},ww.prototype._updateIntArrayForUniform=function(e,t){ww._TempBufferInt32View.set(t),this.updateUniformArray(e,ww._TempBuffer,t.length)},ww.prototype._updateMatrixForEffect=function(e,t){this._currentEffect.setMatrix(e,t)},ww.prototype._updateMatrixForUniform=function(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.toArray(),16)},ww.prototype._updateMatricesForEffect=function(e,t){this._currentEffect.setMatrices(e,t)},ww.prototype._updateMatricesForUniform=function(e,t){this.updateUniform(e,t,t.length)},ww.prototype._updateVector3ForEffect=function(e,t){this._currentEffect.setVector3(e,t)},ww.prototype._updateVector3ForUniform=function(e,t){ww._TempBuffer[0]=t.x,ww._TempBuffer[1]=t.y,ww._TempBuffer[2]=t.z,this.updateUniform(e,ww._TempBuffer,3)},ww.prototype._updateVector4ForEffect=function(e,t){this._currentEffect.setVector4(e,t)},ww.prototype._updateVector4ForUniform=function(e,t){ww._TempBuffer[0]=t.x,ww._TempBuffer[1]=t.y,ww._TempBuffer[2]=t.z,ww._TempBuffer[3]=t.w,this.updateUniform(e,ww._TempBuffer,4)},ww.prototype._updateColor3ForEffect=function(e,t,r){void 0===r&&(r=""),this._currentEffect.setColor3(e+r,t)},ww.prototype._updateColor3ForUniform=function(e,t){ww._TempBuffer[0]=t.r,ww._TempBuffer[1]=t.g,ww._TempBuffer[2]=t.b,this.updateUniform(e,ww._TempBuffer,3)},ww.prototype._updateColor4ForEffect=function(e,t,r,n){void 0===n&&(n=""),this._currentEffect.setColor4(e+n,t,r)},ww.prototype._updateDirectColor4ForEffect=function(e,t,r){void 0===r&&(r=""),this._currentEffect.setDirectColor4(e+r,t)},ww.prototype._updateColor4ForUniform=function(e,t,r){ww._TempBuffer[0]=t.r,ww._TempBuffer[1]=t.g,ww._TempBuffer[2]=t.b,ww._TempBuffer[3]=r,this.updateUniform(e,ww._TempBuffer,4)},ww.prototype._updateDirectColor4ForUniform=function(e,t){t.red?(ww._TempBuffer[0]=t.red,ww._TempBuffer[1]=t.green,ww._TempBuffer[2]=t.blue,ww._TempBuffer[3]=t.alpha):(ww._TempBuffer[0]=t.r,ww._TempBuffer[1]=t.g,ww._TempBuffer[2]=t.b,ww._TempBuffer[3]=t.a),this.updateUniform(e,ww._TempBuffer,4)},ww.prototype._updateIntForEffect=function(e,t,r){void 0===r&&(r=""),this._currentEffect.setInt(e+r,t)},ww.prototype._updateIntForUniform=function(e,t){ww._TempBufferInt32View[0]=t,this.updateUniform(e,ww._TempBuffer,1)},ww.prototype._updateInt2ForEffect=function(e,t,r,n){void 0===n&&(n=""),this._currentEffect.setInt2(e+n,t,r)},ww.prototype._updateInt2ForUniform=function(e,t,r){ww._TempBufferInt32View[0]=t,ww._TempBufferInt32View[1]=r,this.updateUniform(e,ww._TempBuffer,2)},ww.prototype._updateInt3ForEffect=function(e,t,r,n,i){void 0===i&&(i=""),this._currentEffect.setInt3(e+i,t,r,n)},ww.prototype._updateInt3ForUniform=function(e,t,r,n){ww._TempBufferInt32View[0]=t,ww._TempBufferInt32View[1]=r,ww._TempBufferInt32View[2]=n,this.updateUniform(e,ww._TempBuffer,3)},ww.prototype._updateInt4ForEffect=function(e,t,r,n,i,o){void 0===o&&(o=""),this._currentEffect.setInt4(e+o,t,r,n,i)},ww.prototype._updateInt4ForUniform=function(e,t,r,n,i){ww._TempBufferInt32View[0]=t,ww._TempBufferInt32View[1]=r,ww._TempBufferInt32View[2]=n,ww._TempBufferInt32View[3]=i,this.updateUniform(e,ww._TempBuffer,4)},ww.prototype.setTexture=function(e,t){this._currentEffect.setTexture(e,t)},ww.prototype.updateUniformDirectly=function(e,t){this.updateUniform(e,t,t.length),this.update()},ww.prototype.bindToEffect=function(e,t){this._currentEffect=e,this._currentEffectName=t},ww.prototype.bindUniformBuffer=function(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)},ww.prototype.unbindEffect=function(){this._currentEffect=void 0,this._currentEffectName=void 0},ww.prototype.setDataBuffer=function(e){if(!this._buffers)return this._buffer===e;for(var t=0;t<this._buffers.length;++t){if(this._buffers[t][0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1},ww.prototype.dispose=function(){if(!this._noUBO){var e=this._engine._uniformBuffers,t=e.indexOf(this);if(-1!==t&&(e[t]=e[e.length-1],e.pop()),this._trackUbosInFrame&&this._buffers)for(var r=0;r<this._buffers.length;++r){var n=this._buffers[r][0];this._engine._releaseBuffer(n)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},ww._UpdatedUbosInFrame={},ww._MAX_UNIFORM_SIZE=256,ww._TempBuffer=new Float32Array(ww._MAX_UNIFORM_SIZE),ww._TempBufferInt32View=new Uint32Array(ww._TempBuffer.buffer),Sw.prototype._addUniformToLeftOverUBO=function(e,t,r){var n,i;e=(n=this._getArraySize(e,t,r))[0],t=n[1],i=n[2];for(var o=0;o<this._webgpuProcessingContext.leftOverUniforms.length;o++)if(this._webgpuProcessingContext.leftOverUniforms[o].name===e)return;this._webgpuProcessingContext.leftOverUniforms.push({name:e,type:t,length:i})},Sw.prototype._buildLeftOverUBO=function(){if(!this._webgpuProcessingContext.leftOverUniforms.length)return"";var e=Sw.LeftOvertUBOName,t=this._webgpuProcessingContext.availableBuffers[e];return t||(t={binding:this._webgpuProcessingContext.getNextFreeUBOBinding()},this._webgpuProcessingContext.availableBuffers[e]=t,this._addBufferBindingDescription(e,t,GM.BufferBindingType.Uniform,!0),this._addBufferBindingDescription(e,t,GM.BufferBindingType.Uniform,!1)),this._generateLeftOverUBOCode(e,t)},Sw.prototype._collectBindingNames=function(){for(var e=0;e<this._webgpuProcessingContext.bindGroupLayoutEntries.length;e++){var t=this._webgpuProcessingContext.bindGroupLayoutEntries[e];if(void 0!==t)for(var r=0;r<t.length;r++){var n=this._webgpuProcessingContext.bindGroupLayoutEntries[e][r],i=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[e][n.binding].name,o=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[e][n.binding].nameInArrayOfTexture;n&&(n.texture||n.externalTexture||n.storageTexture?this._webgpuProcessingContext.textureNames.push(o):n.sampler?this._webgpuProcessingContext.samplerNames.push(i):n.buffer&&this._webgpuProcessingContext.bufferNames.push(i))}else this._webgpuProcessingContext.bindGroupLayoutEntries[e]=[]}},Sw.prototype._preCreateBindGroupEntries=function(){for(var e=this._webgpuProcessingContext.bindGroupEntries,t=0;t<this._webgpuProcessingContext.bindGroupLayoutEntries.length;t++){for(var r=this._webgpuProcessingContext.bindGroupLayoutEntries[t],n=[],i=0;i<r.length;i++){var o=this._webgpuProcessingContext.bindGroupLayoutEntries[t][i];o.sampler||o.texture||o.storageTexture||o.externalTexture?n.push({binding:o.binding,resource:void 0}):o.buffer&&n.push({binding:o.binding,resource:{buffer:void 0,offset:0,size:0}})}e[t]=n}},Sw.prototype._addTextureBindingDescription=function(e,t,r,n,i,o){var s=t.textures[r],a=s.groupIndex,u=s.bindingIndex;if(this._webgpuProcessingContext.bindGroupLayoutEntries[a]||(this._webgpuProcessingContext.bindGroupLayoutEntries[a]=[],this._webgpuProcessingContext.bindGroupLayoutEntryInfo[a]=[]),!this._webgpuProcessingContext.bindGroupLayoutEntryInfo[a][u]){var c=void 0;c=null===n?this._webgpuProcessingContext.bindGroupLayoutEntries[a].push({binding:u,visibility:0,externalTexture:{}}):i?this._webgpuProcessingContext.bindGroupLayoutEntries[a].push({binding:u,visibility:0,storageTexture:{access:GM.StorageTextureAccess.WriteOnly,format:i,viewDimension:n}}):this._webgpuProcessingContext.bindGroupLayoutEntries[a].push({binding:u,visibility:0,texture:{sampleType:t.sampleType,viewDimension:n,multisampled:t.isMultisampled}});var l=t.isTextureArray?e+r:e;this._webgpuProcessingContext.bindGroupLayoutEntryInfo[a][u]={name:e,index:c-1,nameInArrayOfTexture:l}}u=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[a][u].index,this._webgpuProcessingContext.bindGroupLayoutEntries[a][u].visibility|=o?GM.ShaderStage.Vertex:GM.ShaderStage.Fragment},Sw.prototype._addSamplerBindingDescription=function(e,t,r){var n=t.binding,i=n.groupIndex,o=n.bindingIndex;if(this._webgpuProcessingContext.bindGroupLayoutEntries[i]||(this._webgpuProcessingContext.bindGroupLayoutEntries[i]=[],this._webgpuProcessingContext.bindGroupLayoutEntryInfo[i]=[]),!this._webgpuProcessingContext.bindGroupLayoutEntryInfo[i][o]){var s=this._webgpuProcessingContext.bindGroupLayoutEntries[i].push({binding:o,visibility:0,sampler:{type:t.type}});this._webgpuProcessingContext.bindGroupLayoutEntryInfo[i][o]={name:e,index:s-1}}o=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[i][o].index,this._webgpuProcessingContext.bindGroupLayoutEntries[i][o].visibility|=r?GM.ShaderStage.Vertex:GM.ShaderStage.Fragment},Sw.prototype._addBufferBindingDescription=function(e,t,r,n){var i=t.binding,o=i.groupIndex,s=i.bindingIndex;if(this._webgpuProcessingContext.bindGroupLayoutEntries[o]||(this._webgpuProcessingContext.bindGroupLayoutEntries[o]=[],this._webgpuProcessingContext.bindGroupLayoutEntryInfo[o]=[]),!this._webgpuProcessingContext.bindGroupLayoutEntryInfo[o][s]){var a=this._webgpuProcessingContext.bindGroupLayoutEntries[o].push({binding:s,visibility:0,buffer:{type:r}});this._webgpuProcessingContext.bindGroupLayoutEntryInfo[o][s]={name:e,index:a-1}}s=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[o][s].index,this._webgpuProcessingContext.bindGroupLayoutEntries[o][s].visibility|=n?GM.ShaderStage.Vertex:GM.ShaderStage.Fragment},Sw.prototype._injectStartingAndEndingCode=function(e,t,r,n){if(r){var i=e.indexOf(t);if(i>=0){for(;i++<e.length&&"{"!=e.charAt(i););if(i<e.length){for(;i++<e.length&&"\n"!=e.charAt(i););if(i<e.length){var o=e.substring(0,i+1),s=e.substring(i+1);e=o+r+s}}}}if(n){var a=e.lastIndexOf("}");e=e.substring(0,a),e+=n+"\n}"}return e},Sw.AutoSamplerSuffix="Sampler",Sw.LeftOvertUBOName="LeftOver",Sw.InternalsUBOName="Internals",Sw.UniformSizes={bool:1,int:1,float:1,vec2:2,ivec2:2,vec3:3,ivec3:3,vec4:4,ivec4:4,mat2:4,mat3:12,mat4:16,i32:1,u32:1,f32:1,mat2x2:4,mat3x3:12,mat4x4:16},Sw._SamplerFunctionByWebGLSamplerType={sampler2D:"sampler2D",sampler2DArray:"sampler2DArray",sampler2DShadow:"sampler2DShadow",sampler2DArrayShadow:"sampler2DArrayShadow",samplerCube:"samplerCube",sampler3D:"sampler3D"},Sw._TextureTypeByWebGLSamplerType={sampler2D:"texture2D",sampler2DArray:"texture2DArray",sampler2DShadow:"texture2D",sampler2DArrayShadow:"texture2DArray",samplerCube:"textureCube",samplerCubeArray:"textureCubeArray",sampler3D:"texture3D"},Sw._GpuTextureViewDimensionByWebGPUTextureType={textureCube:GM.TextureViewDimension.Cube,textureCubeArray:GM.TextureViewDimension.CubeArray,texture2D:GM.TextureViewDimension.E2d,texture2DArray:GM.TextureViewDimension.E2dArray,texture3D:GM.TextureViewDimension.E3d},Sw._SamplerTypeByWebGLSamplerType={sampler2DShadow:"samplerShadow",sampler2DArrayShadow:"samplerShadow"},Sw._IsComparisonSamplerByWebGPUSamplerType={samplerShadow:!0,samplerArrayShadow:!0,sampler:!1},Object.defineProperty(Bw.prototype,"isAsync",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(Bw.prototype,"isReady",{get:function(){return!!this.stages},enumerable:!1,configurable:!0}),Bw.prototype._handlesSpectorRebuildCallback=function(){},Bw.prototype._fillEffectInformation=function(e,t,r,n,i,o,s,a){var u=this.engine;e._fragmentSourceCode="",e._vertexSourceCode="";var c,l=this.shaderProcessingContext.availableTextures;for(c=0;c<i.length;c++){var h=i[c],p=l[i[c]];null==p||null==p?(i.splice(c,1),c--):o[h]=c}for(var d=0,f=u.getAttributes(this,s);d<f.length;d++){var A=f[d];a.push(A)}this.buildUniformLayout();var g=[],_=[];for(c=0;c<s.length;c++){var m=a[c];m>=0&&(g.push(s[c]),_.push(m))}this.shaderProcessingContext.attributeNamesFromEffect=g,this.shaderProcessingContext.attributeLocationsFromEffect=_},Bw.prototype.buildUniformLayout=function(){if(this.shaderProcessingContext.leftOverUniforms.length){this.uniformBuffer=new ww(this.engine,void 0,void 0,"leftOver-"+this._name);for(var e=0,t=this.shaderProcessingContext.leftOverUniforms;e<t.length;e++){var r=t[e],n=r.type.replace(/^(.*?)(<.*>)?$/,"$1"),i=Sw.UniformSizes[n];this.uniformBuffer.addUniform(r.name,i,r.length),this._leftOverUniformsByName[r.name]=r.type}this.uniformBuffer.create()}},Bw.prototype.dispose=function(){this.uniformBuffer&&this.uniformBuffer.dispose()},Bw.prototype.setInt=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateInt(e,t)},Bw.prototype.setInt2=function(e,t,r){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateInt2(e,t,r)},Bw.prototype.setInt3=function(e,t,r,n){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateInt3(e,t,r,n)},Bw.prototype.setInt4=function(e,t,r,n,i){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateInt4(e,t,r,n,i)},Bw.prototype.setIntArray=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateIntArray(e,t)},Bw.prototype.setIntArray2=function(e,t){this.setIntArray(e,t)},Bw.prototype.setIntArray3=function(e,t){this.setIntArray(e,t)},Bw.prototype.setIntArray4=function(e,t){this.setIntArray(e,t)},Bw.prototype.setArray=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateArray(e,t)},Bw.prototype.setArray2=function(e,t){this.setArray(e,t)},Bw.prototype.setArray3=function(e,t){this.setArray(e,t)},Bw.prototype.setArray4=function(e,t){this.setArray(e,t)},Bw.prototype.setMatrices=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateMatrices(e,t)},Bw.prototype.setMatrix=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateMatrix(e,t)},Bw.prototype.setMatrix3x3=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateMatrix3x3(e,t)},Bw.prototype.setMatrix2x2=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateMatrix2x2(e,t)},Bw.prototype.setFloat=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateFloat(e,t)},Bw.prototype.setVector2=function(e,t){this.setFloat2(e,t.x,t.y)},Bw.prototype.setFloat2=function(e,t,r){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateFloat2(e,t,r)},Bw.prototype.setVector3=function(e,t){this.setFloat3(e,t.x,t.y,t.z)},Bw.prototype.setFloat3=function(e,t,r,n){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateFloat3(e,t,r,n)},Bw.prototype.setVector4=function(e,t){this.setFloat4(e,t.x,t.y,t.z,t.w)},Bw.prototype.setFloat4=function(e,t,r,n,i){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateFloat4(e,t,r,n,i)},Bw.prototype.setColor3=function(e,t){this.setFloat3(e,t.r,t.g,t.b)},Bw.prototype.setColor4=function(e,t,r){this.setFloat4(e,t.r,t.g,t.b,r)},Bw.prototype.setDirectColor4=function(e,t){this.setFloat4(e,t.r,t.g,t.b,t.a)},Bw.prototype._getVertexShaderCode=function(){var e;return null===(e=this.sources)||void 0===e?void 0:e.vertex},Bw.prototype._getFragmentShaderCode=function(){var e;return null===(e=this.sources)||void 0===e?void 0:e.fragment};var Ow={mat2:2,mat3:3,mat4:4,mat2x2:2,mat3x3:3,mat4x4:4};function Dw(e){this.shaderLanguage=e,this._attributeNextLocation=0,this._varyingNextLocation=0,this.freeGroupIndex=0,this.freeBindingIndex=0,this.availableVaryings={},this.availableAttributes={},this.availableBuffers={},this.availableTextures={},this.availableSamplers={},this.orderedAttributes=[],this.bindGroupLayoutEntries=[],this.bindGroupLayoutEntryInfo=[],this.bindGroupEntries=[],this.bufferNames=[],this.textureNames=[],this.samplerNames=[],this.leftOverUniforms=[],this._findStartingGroupBinding()}function Fw(){var e=Sw.call(this,arguments)||this;return e._missingVaryings=[],e._textureArrayProcessing=[],e.shaderLanguage=Aw.GLSL,e}function Pw(e,t,r,n){for(var i=n,o=0,s="";i<r.length;){var a=r.charAt(i);if(s)a===s?'"'===s||"'"===s?"\\"!==r.charAt(i-1)&&(s=""):s="":"*/"===s&&"*"===a&&i+1<r.length&&("/"===r.charAt(i+1)&&(s=""),""===s&&i++);else switch(a){case e:o++;break;case t:o--;break;case'"':case"'":case"`":s=a;break;case"/":if(i+1<r.length){var u=r.charAt(i+1);"/"===u?s="\n":"*"===u&&(s="*/")}}if(i++,0===o)break}return 0===o?i-1:-1}function Nw(e,t){for(;t<e.length;){var r=e[t];if(" "!==r&&"\n"!==r&&"\r"!==r&&"\t"!==r&&"\n"!==r&&""!==r)break;t++}return t}function Lw(e){var t=e.charCodeAt(0);return t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||95==t}function Uw(e){for(var t=0,r="",n=!1,i=[];t<e.length;){var o=e.charAt(t);if(r)o===r?'"'===r||"'"===r?("\\"!==e.charAt(t-1)&&(r=""),i.push(o)):(r="",n=!1):"*/"===r&&"*"===o&&t+1<e.length?("/"===e.charAt(t+1)&&(r=""),""===r&&(n=!1,t++)):n||i.push(o);else{switch(o){case'"':case"'":case"`":r=o;break;case"/":if(t+1<e.length){var s=e.charAt(t+1);"/"===s?(r="\n",n=!0):"*"===s&&(r="*/",n=!0)}}n||i.push(o)}t++}return i.join("")}function Gw(e,t,r){for(;t>=0&&e.charAt(t)!==r;)t--;return t}Object.defineProperty(Dw,"KnownUBOs",{get:function(){return Dw._SimplifiedKnownBindings?Dw._SimplifiedKnownUBOs:Dw._KnownUBOs},enumerable:!1,configurable:!0}),Dw.prototype._findStartingGroupBinding=function(){var e=Dw.KnownUBOs,t=[];for(var r in e){var n=e[r].binding;-1!==n.groupIndex&&(void 0===t[n.groupIndex]?t[n.groupIndex]=n.bindingIndex:t[n.groupIndex]=Math.max(t[n.groupIndex],n.bindingIndex))}this.freeGroupIndex=t.length-1,0===this.freeGroupIndex?(this.freeGroupIndex++,this.freeBindingIndex=0):this.freeBindingIndex=t[t.length-1]+1},Dw.prototype.getAttributeNextLocation=function(e,t){var r;void 0===t&&(t=0);var n=this._attributeNextLocation;return this._attributeNextLocation+=(null!==(r=Ow[e])&&void 0!==r?r:1)*(t||1),n},Dw.prototype.getVaryingNextLocation=function(e,t){var r;void 0===t&&(t=0);var n=this._varyingNextLocation;return this._varyingNextLocation+=(null!==(r=Ow[e])&&void 0!==r?r:1)*(t||1),n},Dw.prototype.getNextFreeUBOBinding=function(){return this._getNextFreeBinding(1)},Dw.prototype._getNextFreeBinding=function(e){if(this.freeBindingIndex>65536-e&&(this.freeGroupIndex++,this.freeBindingIndex=0),4===this.freeGroupIndex)throw"Too many textures or UBOs have been declared and it is not supported in WebGPU.";var t={groupIndex:this.freeGroupIndex,bindingIndex:this.freeBindingIndex};return this.freeBindingIndex+=e,t},Dw._SimplifiedKnownBindings=!0,Dw._SimplifiedKnownUBOs={Scene:{binding:{groupIndex:0,bindingIndex:0}},Light0:{binding:{groupIndex:-1,bindingIndex:-1}},Light1:{binding:{groupIndex:-1,bindingIndex:-1}},Light2:{binding:{groupIndex:-1,bindingIndex:-1}},Light3:{binding:{groupIndex:-1,bindingIndex:-1}},Light4:{binding:{groupIndex:-1,bindingIndex:-1}},Light5:{binding:{groupIndex:-1,bindingIndex:-1}},Light6:{binding:{groupIndex:-1,bindingIndex:-1}},Light7:{binding:{groupIndex:-1,bindingIndex:-1}},Light8:{binding:{groupIndex:-1,bindingIndex:-1}},Light9:{binding:{groupIndex:-1,bindingIndex:-1}},Light10:{binding:{groupIndex:-1,bindingIndex:-1}},Light11:{binding:{groupIndex:-1,bindingIndex:-1}},Light12:{binding:{groupIndex:-1,bindingIndex:-1}},Light13:{binding:{groupIndex:-1,bindingIndex:-1}},Light14:{binding:{groupIndex:-1,bindingIndex:-1}},Light15:{binding:{groupIndex:-1,bindingIndex:-1}},Light16:{binding:{groupIndex:-1,bindingIndex:-1}},Light17:{binding:{groupIndex:-1,bindingIndex:-1}},Light18:{binding:{groupIndex:-1,bindingIndex:-1}},Light19:{binding:{groupIndex:-1,bindingIndex:-1}},Light20:{binding:{groupIndex:-1,bindingIndex:-1}},Light21:{binding:{groupIndex:-1,bindingIndex:-1}},Light22:{binding:{groupIndex:-1,bindingIndex:-1}},Light23:{binding:{groupIndex:-1,bindingIndex:-1}},Light24:{binding:{groupIndex:-1,bindingIndex:-1}},Light25:{binding:{groupIndex:-1,bindingIndex:-1}},Light26:{binding:{groupIndex:-1,bindingIndex:-1}},Light27:{binding:{groupIndex:-1,bindingIndex:-1}},Light28:{binding:{groupIndex:-1,bindingIndex:-1}},Light29:{binding:{groupIndex:-1,bindingIndex:-1}},Light30:{binding:{groupIndex:-1,bindingIndex:-1}},Light31:{binding:{groupIndex:-1,bindingIndex:-1}},Material:{binding:{groupIndex:-1,bindingIndex:-1}},Mesh:{binding:{groupIndex:-1,bindingIndex:-1}},Internals:{binding:{groupIndex:-1,bindingIndex:-1}}},Dw._KnownUBOs={Scene:{binding:{groupIndex:0,bindingIndex:0}},Light0:{binding:{groupIndex:1,bindingIndex:0}},Light1:{binding:{groupIndex:1,bindingIndex:1}},Light2:{binding:{groupIndex:1,bindingIndex:2}},Light3:{binding:{groupIndex:1,bindingIndex:3}},Light4:{binding:{groupIndex:1,bindingIndex:4}},Light5:{binding:{groupIndex:1,bindingIndex:5}},Light6:{binding:{groupIndex:1,bindingIndex:6}},Light7:{binding:{groupIndex:1,bindingIndex:7}},Light8:{binding:{groupIndex:1,bindingIndex:8}},Light9:{binding:{groupIndex:1,bindingIndex:9}},Light10:{binding:{groupIndex:1,bindingIndex:10}},Light11:{binding:{groupIndex:1,bindingIndex:11}},Light12:{binding:{groupIndex:1,bindingIndex:12}},Light13:{binding:{groupIndex:1,bindingIndex:13}},Light14:{binding:{groupIndex:1,bindingIndex:14}},Light15:{binding:{groupIndex:1,bindingIndex:15}},Light16:{binding:{groupIndex:1,bindingIndex:16}},Light17:{binding:{groupIndex:1,bindingIndex:17}},Light18:{binding:{groupIndex:1,bindingIndex:18}},Light19:{binding:{groupIndex:1,bindingIndex:19}},Light20:{binding:{groupIndex:1,bindingIndex:20}},Light21:{binding:{groupIndex:1,bindingIndex:21}},Light22:{binding:{groupIndex:1,bindingIndex:22}},Light23:{binding:{groupIndex:1,bindingIndex:23}},Light24:{binding:{groupIndex:1,bindingIndex:24}},Light25:{binding:{groupIndex:1,bindingIndex:25}},Light26:{binding:{groupIndex:1,bindingIndex:26}},Light27:{binding:{groupIndex:1,bindingIndex:27}},Light28:{binding:{groupIndex:1,bindingIndex:28}},Light29:{binding:{groupIndex:1,bindingIndex:29}},Light30:{binding:{groupIndex:1,bindingIndex:30}},Light31:{binding:{groupIndex:1,bindingIndex:31}},Material:{binding:{groupIndex:2,bindingIndex:0}},Mesh:{binding:{groupIndex:2,bindingIndex:1}},Internals:{binding:{groupIndex:2,bindingIndex:2}}},Fw.prototype=Object.create(Sw.prototype),Fw.prototype.constructor=Sw,Fw.prototype._getArraySize=function(e,t,r){var n=0,i=e.indexOf("["),o=e.indexOf("]");if(i>0&&o>0){var s=e.substring(i+1,o);n=+s,isNaN(n)&&(n=+r[s.trim()]),e=e.substr(0,i)}return[e,t,n]},Fw.prototype.initializeShaders=function(e){this._webgpuProcessingContext=e,this._missingVaryings.length=0,this._textureArrayProcessing.length=0},Fw.prototype.preProcessShaderCode=function(e,t){var r="uniform ".concat(Sw.InternalsUBOName," {\nfloat yFactor__;\nfloat textureOutputHeight__;\n};\n");return t?r+"##INJECTCODE##\n"+e:r+e},Fw.prototype.varyingProcessor=function(e,t,r){this._preProcessors=r;var n=/\s*varying\s+(?:(?:highp)?|(?:mediump)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm.exec(e);if(null!=n){var i,o=n[1],s=n[2];t?(i=this._webgpuProcessingContext.availableVaryings[s],this._missingVaryings[i]="",void 0===i&&WM.Warn('Invalid fragment shader: The varying named "'.concat(s,'" is not declared in the vertex shader! This declaration will be ignored.'))):(i=this._webgpuProcessingContext.getVaryingNextLocation(o,this._getArraySize(s,o,r)[2]),this._webgpuProcessingContext.availableVaryings[s]=i,this._missingVaryings[i]="layout(location = ".concat(i,") in ").concat(o," ").concat(s,";")),e=e.replace(n[0],void 0===i?"":"layout(location = ".concat(i,") ").concat(t?"in":"out"," ").concat(o," ").concat(s,";"))}return e},Fw.prototype.attributeProcessor=function(e,t){this._preProcessors=t;var r=/\s*attribute\s+(?:(?:highp)?|(?:mediump)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm.exec(e);if(null!=r){var n=r[1],i=r[2],o=this._webgpuProcessingContext.getAttributeNextLocation(n,this._getArraySize(i,n,t)[2]);this._webgpuProcessingContext.availableAttributes[i]=o,this._webgpuProcessingContext.orderedAttributes[o]=i,e=e.replace(r[0],"layout(location = ".concat(o,") in ").concat(n," ").concat(i,";"))}return e},Fw.prototype.uniformProcessor=function(e,t,r){var n,i;this._preProcessors=r;var o=/\s*uniform\s+(?:(?:highp)?|(?:mediump)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm.exec(e);if(null!=o){var s=o[1],a=o[2];if(0===s.indexOf("sampler")||1===s.indexOf("sampler")){var u=0;a=(n=this._getArraySize(a,s,r))[0],s=n[1],u=n[2];var c=this._webgpuProcessingContext.availableTextures[a];if(!c){c={autoBindSampler:!0,isTextureArray:u>0,isStorageTexture:!1,textures:[],sampleType:GM.TextureSampleType.Float};for(var l=0;l<(u||1);++l)c.textures.push(this._webgpuProcessingContext.getNextFreeUBOBinding())}var h=null!==(i=Sw._SamplerTypeByWebGLSamplerType[s])&&void 0!==i?i:"sampler",p=!!Sw._IsComparisonSamplerByWebGPUSamplerType[h];a.indexOf("depth")>=0&&(p=!0);var d=p?GM.SamplerBindingType.Comparison:GM.SamplerBindingType.Filtering,f=a+Sw.AutoSamplerSuffix,A=this._webgpuProcessingContext.availableSamplers[f];A||(A={binding:this._webgpuProcessingContext.getNextFreeUBOBinding(),type:d});var g="u"===s.charAt(0)?"u":"i"===s.charAt(0)?"i":"";g&&(s=s.substr(1));var _=p?GM.TextureSampleType.Depth:"u"===g?GM.TextureSampleType.Uint:"i"===g?GM.TextureSampleType.Sint:GM.TextureSampleType.Float;c.sampleType=_;var m=u>0,y=A.binding.groupIndex,E=A.binding.bindingIndex,x=Sw._SamplerFunctionByWebGLSamplerType[s],C=Sw._TextureTypeByWebGLSamplerType[s],b=Sw._GpuTextureViewDimensionByWebGPUTextureType[C];if(m){var I=[];I.push("layout(set = ".concat(y,", binding = ").concat(E,") uniform ").concat(g).concat(h," ").concat(f,";")),e="\r\n";for(l=0;l<u;++l){var T=c.textures[l].groupIndex,v=c.textures[l].bindingIndex;I.push("layout(set = ".concat(T,", binding = ").concat(v,") uniform ").concat(C," ").concat(a,"Texture").concat(l,";")),e+="".concat(l>0?"\r\n":"","#define ").concat(a).concat(l," ").concat(g).concat(x,"(").concat(a,"Texture").concat(l,", ").concat(f,")")}e=I.join("\r\n")+e,this._textureArrayProcessing.push(a)}else u=1,e="layout(set = ".concat(y,", binding = ").concat(E,") uniform ").concat(g).concat(h," ").concat(f,";\n                        layout(set = ").concat(c.textures[0].groupIndex,", binding = ").concat(c.textures[0].bindingIndex,") uniform ").concat(C," ").concat(a,"Texture;\n                        #define ").concat(a," ").concat(g).concat(x,"(").concat(a,"Texture, ").concat(f,")");this._webgpuProcessingContext.availableTextures[a]=c,this._webgpuProcessingContext.availableSamplers[f]=A,this._addSamplerBindingDescription(f,A,!t);for(l=0;l<u;++l)this._addTextureBindingDescription(a,c,l,b,null,!t)}else this._addUniformToLeftOverUBO(a,s,r),e=""}return e},Fw.prototype.uniformBufferProcessor=function(e,t){var r=/uniform\s+(\w+)/gm.exec(e);if(null!=r){var n=r[1],i=this._webgpuProcessingContext.availableBuffers[n];if(!i){var o=Dw.KnownUBOs[n];i={binding:o&&-1!==o.binding.groupIndex?o.binding:this._webgpuProcessingContext.getNextFreeUBOBinding()},this._webgpuProcessingContext.availableBuffers[n]=i}this._addBufferBindingDescription(n,i,GM.BufferBindingType.Uniform,!t),e=e.replace("uniform","layout(set = ".concat(i.binding.groupIndex,", binding = ").concat(i.binding.bindingIndex,") uniform"))}return e},Fw.prototype.postProcessor=function(e,t,r,n,i){var o=e.search(/#extension.+GL_EXT_draw_buffers.+require/);o=-1!==e.search(/glFragData/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),r){var s,a,u=/##INJECTCODE##/,c=e.split("\n"),l=-1;for(s=0;s<c.length;++s)if(a=c[s],u.test(a)){l=s+1;break}if(l>-1&&function(e,t){for(var r=new RegExp("(^|[^\\w])("+e+")($|[^\\w])","g"),n=t.length,i=0;i<n;++i){var o=t[i];if(r.test(o))return!0}return!1}("gl_FragColor",c)){var h=o?"":"layout(location = 0) out vec4 glFragColor;";c.splice(l,0,h),e=c.join("\n")}var p=e.indexOf("gl_FragCoord")>=0,d=p?"vec4 glFragCoord__;\n":"";e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/gl_FragCoord/g,"glFragCoord__")).replace(/dFdy/g,"(-yFactor__)*dFdy")).replace("##INJECTCODE##",d),p&&(e=this._injectStartingAndEndingCode(e,"void main","\n                glFragCoord__ = gl_FragCoord;\n                if (yFactor__ == 1.) {\n                    glFragCoord__.y = textureOutputHeight__ - glFragCoord__.y;\n                }\n            "))}else{if(e=(e=e.replace(/gl_InstanceID/g,"gl_InstanceIndex")).replace(/gl_VertexID/g,"gl_VertexIndex"),-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e}if(!r&&-1==e.indexOf("gl_Position.y *= yFactor__")){var f=e.lastIndexOf("}");e=e.substring(0,f),e+="gl_Position.y *= yFactor__;\n",i.isNDCHalfZRange||(e+="gl_Position.z = (gl_Position.z + gl_Position.w) / 2.0;\n"),e+="}"}return e},Fw.prototype._applyTextureArrayProcessing=function(e,t){for(var r=new RegExp(t+"\\s*\\[(.+)?\\]","gm"),n=r.exec(e);null!=n;){var i=n[1],o=+i;this._preProcessors&&isNaN(o)&&(o=+this._preProcessors[i.trim()]),e=e.replace(n[0],t+o),n=r.exec(e)}return e},Fw.prototype._generateLeftOverUBOCode=function(e,t){for(var r="layout(set = ".concat(t.binding.groupIndex,", binding = ").concat(t.binding.bindingIndex,") uniform ").concat(e," {\n    "),n=0,i=this._webgpuProcessingContext.leftOverUniforms;n<i.length;n++){var o=i[n];o.length>0?r+="    ".concat(o.type," ").concat(o.name,"[").concat(o.length,"];\n"):r+="    ".concat(o.type," ").concat(o.name,";\n")}return r+="};\n\n"},Fw.prototype.finalizeShaders=function(e,t){for(var r=0;r<this._textureArrayProcessing.length;++r){var n=this._textureArrayProcessing[r];e=this._applyTextureArrayProcessing(e,n),t=this._applyTextureArrayProcessing(t,n)}for(r=0;r<this._missingVaryings.length;++r){var i=this._missingVaryings[r];i&&i.length>0&&(t=i+"\n"+t)}var o=this._buildLeftOverUBO();return e=o+e,t=o+t,this._collectBindingNames(),this._preCreateBindGroupEntries(),this._preProcessors=null,{vertexCode:e,fragmentCode:t}};var Qw="gl_VertexID",kw="gl_InstanceID",zw="gl_Position",jw="gl_FragCoord",Hw="gl_FrontFacing",qw="gl_FragDepth",Vw="gl_FragColor",Yw="gl_FragData",Xw=["gl_FragData0","gl_FragData1","gl_FragData2","gl_FragData3","gl_FragData4","gl_FragData5","gl_FragData6","gl_FragData7"],Ww={texture_1d:GM.TextureViewDimension.E1d,texture_2d:GM.TextureViewDimension.E2d,texture_2d_array:GM.TextureViewDimension.E2dArray,texture_3d:GM.TextureViewDimension.E3d,texture_cube:GM.TextureViewDimension.Cube,texture_cube_array:GM.TextureViewDimension.CubeArray,texture_multisampled_2d:GM.TextureViewDimension.E2d,texture_depth_2d:GM.TextureViewDimension.E2d,texture_depth_2d_array:GM.TextureViewDimension.E2dArray,texture_depth_cube:GM.TextureViewDimension.Cube,texture_depth_cube_array:GM.TextureViewDimension.CubeArray,texture_depth_multisampled_2d:GM.TextureViewDimension.E2d,texture_storage_1d:GM.TextureViewDimension.E1d,texture_storage_2d:GM.TextureViewDimension.E2d,texture_storage_2d_array:GM.TextureViewDimension.E2dArray,texture_storage_3d:GM.TextureViewDimension.E3d,texture_external:null};function Kw(){var e=Sw.call(this,arguments)||this;return e.shaderLanguage=Aw.WGSL,e.uniformRegexp=/uniform\s+(\w+)\s*:\s*(.+)\s*;/,e.textureRegexp=/var\s+(\w+)\s*:\s*((array<\s*)?(texture_\w+)\s*(<\s*(.+)\s*>)?\s*(,\s*\w+\s*>\s*)?);/,e.noPrecision=!0,e}function Jw(){this.colorAttachmentGPUTextures=[],this.reset()}Kw.prototype=Object.create(Sw.prototype),Kw.prototype.constructor=Sw,Kw.prototype._getArraySize=function(e,t,r){var n=0,i=t.lastIndexOf(">");if(t.indexOf("array")>=0&&i>0){for(var o=i;o>0&&" "!==t.charAt(o)&&","!==t.charAt(o);)o--;var s=t.substring(o+1,i);for(n=+s,isNaN(n)&&(n=+r[s.trim()]);o>0&&(" "===t.charAt(o)||","===t.charAt(o));)o--;t=t.substring(t.indexOf("<")+1,o+1)}return[e,t,n]},Kw.prototype.initializeShaders=function(e){this._webgpuProcessingContext=e,this._attributesWGSL=[],this._attributesDeclWGSL=[],this._attributeNamesWGSL=[],this._varyingsWGSL=[],this._varyingsDeclWGSL=[],this._varyingNamesWGSL=[],this._stridedUniformArrays=[]},Kw.prototype.preProcessShaderCode=function(e){return"struct ".concat(Sw.InternalsUBOName," {\nyFactor__: f32,\ntextureOutputHeight__: f32,\n};\nvar<uniform> ").concat("internals"," : ").concat(Sw.InternalsUBOName,";\n")+Uw(e)},Kw.prototype.varyingProcessor=function(e,t,r){var n=/\s*varying\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s*:\s*(.+)\s*;/gm.exec(e);if(null!==n){var i,o=n[2],s=n[1];t?void 0===(i=this._webgpuProcessingContext.availableVaryings[s])&&WM.Warn('Invalid fragment shader: The varying named "'.concat(s,'" is not declared in the vertex shader! This declaration will be ignored.')):(i=this._webgpuProcessingContext.getVaryingNextLocation(o,this._getArraySize(s,o,r)[2]),this._webgpuProcessingContext.availableVaryings[s]=i,this._varyingsWGSL.push("@location(".concat(i,") ").concat(s," : ").concat(o,",")),this._varyingsDeclWGSL.push("var<private> ".concat(s," : ").concat(o,";")),this._varyingNamesWGSL.push(s)),e=""}return e},Kw.prototype.attributeProcessor=function(e,t){var r=/\s*attribute\s+(\S+)\s*:\s*(.+)\s*;/gm.exec(e);if(null!==r){var n=r[2],i=r[1],o=this._webgpuProcessingContext.getAttributeNextLocation(n,this._getArraySize(i,n,t)[2]);this._webgpuProcessingContext.availableAttributes[i]=o,this._webgpuProcessingContext.orderedAttributes[o]=i,this._attributesWGSL.push("@location(".concat(o,") ").concat(i," : ").concat(n,",")),this._attributesDeclWGSL.push("var<private> ".concat(i," : ").concat(n,";")),this._attributeNamesWGSL.push(i),e=""}return e},Kw.prototype.uniformProcessor=function(e,t,r){var n=this.uniformRegexp.exec(e);if(null!==n){var i=n[2],o=n[1];this._addUniformToLeftOverUBO(o,i,r),e=""}return e},Kw.prototype.textureProcessor=function(e,t,r){var n=this.textureRegexp.exec(e);if(null!==n){var i=n[1],o=n[2],s=!!n[3],a=n[4],u=a.indexOf("storage")>0,c=n[6],l=u?c.substring(0,c.indexOf(",")).trim():null,h=s?this._getArraySize(i,o,r)[2]:0,p=this._webgpuProcessingContext.availableTextures[i];if(p)h=p.textures.length;else{p={isTextureArray:h>0,isStorageTexture:u,textures:[],sampleType:GM.TextureSampleType.Float,isMultisampled:!1},h=h||1;for(var d=0;d<h;++d)p.textures.push(this._webgpuProcessingContext.getNextFreeUBOBinding())}this._webgpuProcessingContext.availableTextures[i]=p;var f=a.indexOf("depth")>0,A=Ww[a],g=f?GM.TextureSampleType.Depth:"u32"===c?GM.TextureSampleType.Uint:"i32"===c?GM.TextureSampleType.Sint:GM.TextureSampleType.Float;p.sampleType=g;var _=!!f&&a.indexOf("multisampled")>0;if(p.isMultisampled=_,void 0===A)throw"Can't get the texture dimension corresponding to the texture function \"".concat(a,'"!');if(s){var m=[];for(d=0;d<h;++d){var y=p.textures[d].groupIndex,E=p.textures[d].bindingIndex;m.push("@group(".concat(y,") @binding(").concat(E,") ").concat("var ",i).concat(d," : ").concat(a,"<f32>;"))}e=m.join("\r\n")}else{h=1;var x=p.textures[0],C=x.groupIndex,b=x.bindingIndex;e="@group(".concat(C,") @binding(").concat(b,") ").concat(e)}for(d=0;d<h;++d)this._addTextureBindingDescription(i,p,d,A,l,!t)}return e},Kw.prototype.postProcessor=function(e){return e},Kw.prototype.finalizeShaders=function(e,t){var r=t.indexOf("gl_FragCoord")>=0?"\n            if (internals.yFactor__ == 1.) {\n                gl_FragCoord.y = internals.textureOutputHeight__ - gl_FragCoord.y;\n            }\n        ":"";e=this._processSamplers(e,!0),t=this._processSamplers(t,!1),e=this._processCustomBuffers(e,!0),t=this._processCustomBuffers(t,!1);var n=this._buildLeftOverUBO();t=n+t,e=(e=n+e).replace(/#define /g,"//#define "),e=this._processStridedUniformArrays(e);var i=this._varyingsDeclWGSL.join("\n")+"\n",o="var<private> ".concat(Qw," : u32;\nvar<private> ").concat(kw," : u32;\nvar<private> ").concat(zw," : vec4<f32>;\n"),s=this._attributesDeclWGSL.join("\n")+"\n",a="struct VertexInputs {\n  @builtin(vertex_index) vertexIndex : u32,\n  @builtin(instance_index) instanceIndex : u32,\n";this._attributesWGSL.length>0&&(a+=this._attributesWGSL.join("\n")),a+="\n};\n";var u="struct FragmentInputs {\n  @builtin(position) position : vec4<f32>,\n";this._varyingsWGSL.length>0&&(u+=this._varyingsWGSL.join("\n")),e=o+a+s+(u+="\n};\n")+i+e;for(var c="  var output : FragmentInputs;\n  ".concat(Qw," = input.vertexIndex;\n  ").concat(kw," = input.instanceIndex;\n"),l=0;l<this._attributeNamesWGSL.length;++l){var h=this._attributeNamesWGSL[l];c+="  ".concat(h," = input.").concat(h,";\n")}var p="  output.position = ".concat(zw,";\n  output.position.y = output.position.y * internals.yFactor__;\n");for(l=0;l<this._varyingNamesWGSL.length;++l){var d=this._varyingNamesWGSL[l];p+="  output.".concat(d," = ").concat(d,";\n")}p+="  return output;",e=this._injectStartingAndEndingCode(e,"fn main",c,p),t=t.replace(/#define /g,"//#define "),t=(t=this._processStridedUniformArrays(t)).replace(/dpdy/g,"(-internals.yFactor__)*dpdy");var f="var<private> ".concat(jw," : vec4<f32>;\nvar<private> ").concat(Hw," : bool;\nvar<private> ").concat(Vw," : vec4<f32>;\nvar<private> ").concat(qw," : f32;\n");f+="var<private> ".concat(Xw[0]," : vec4<f32>;\nvar<private> ").concat(Xw[1]," : vec4<f32>;\nvar<private> ").concat(Xw[2]," : vec4<f32>;\nvar<private> ").concat(Xw[3]," : vec4<f32>;\nvar<private> ").concat(Xw[4]," : vec4<f32>;\nvar<private> ").concat(Xw[5]," : vec4<f32>;\nvar<private> ").concat(Xw[6]," : vec4<f32>;\nvar<private> ").concat(Xw[7]," : vec4<f32>;\n");var A="struct FragmentInputs {\n  @builtin(position) position : vec4<f32>,\n  @builtin(front_facing) frontFacing : bool,\n";this._varyingsWGSL.length>0&&(A+=this._varyingsWGSL.join("\n")),A+="\n};\n";for(var g,_=!1,m=0,y=-1;m>=0;)if((m=t.indexOf(Yw,m))>=0){var E=m+11,x=t.substring(E,E+1);x=parseInt(x),y=Math.max(x,y),_=!0,m+=11}if(_){g="struct FragmentOutputs {\n";for(var C=0;C<y+1;C++)g+="  @location ("+C+") "+Xw[C]+" : vec4<f32>,\n"}else g="struct FragmentOutputs {\n  @location(0) color : vec4<f32>,\n";for(var b=!1,I=0;!(b||(I=t.indexOf(qw,I))<0);){var T=I;for(b=!0;I>1&&"\n"!==t.charAt(I);){if("/"===t.charAt(I)&&"/"===t.charAt(I-1)){b=!1;break}I--}I=T+12}b&&(g+="  @builtin(frag_depth) fragDepth: f32,\n"),t=f+A+i+(g+="};\n")+t;var v="  var output : FragmentOutputs;\n  ".concat(jw," = input.position;\n  ").concat(Hw," = input.frontFacing;\n")+r;for(l=0;l<this._varyingNamesWGSL.length;++l){var R=this._varyingNamesWGSL[l];v+="  ".concat(R," = input.").concat(R,";\n")}var M="";if(_)for(C=0;C<y+1;C++)M+="  output."+Xw[C]+" = "+Xw[C]+";\n";else M="  output.color = ".concat(Vw,";\n");return b&&(M+="  output.fragDepth = ".concat(qw,";\n")),M+="  return output;",t=this._injectStartingAndEndingCode(t,"fn main",v,M),this._collectBindingNames(),this._preCreateBindGroupEntries(),{vertexCode:e,fragmentCode:t}},Kw.prototype._generateLeftOverUBOCode=function(e,t){for(var r="",n="struct ".concat(e," {\n"),i=0,o=this._webgpuProcessingContext.leftOverUniforms;i<o.length;i++){var s=o[i],a=s.type.replace(/^(.*?)(<.*>)?$/,"$1"),u=Sw.UniformSizes[a];if(s.length>0)if(u<=2){var c="".concat(e,"_").concat(this._stridedUniformArrays.length,"_strided_arr");r+="struct ".concat(c," {\n                        @size(16)\n                        el: ").concat(a,",\n                    }"),this._stridedUniformArrays.push(s.name),n+=" @align(16) ".concat(s.name," : array<").concat(c,", ").concat(s.length,">,\n")}else n+=" ".concat(s.name," : array<").concat(s.type,", ").concat(s.length,">,\n");else n+="  ".concat(s.name," : ").concat(s.type,",\n")}return n+="};\n",n="".concat(r,"\n").concat(n),n+="@group(".concat(t.binding.groupIndex,") @binding(").concat(t.binding.bindingIndex,") var<uniform> ").concat("uniforms"," : ").concat(e,";\n")},Kw.prototype._processSamplers=function(e,t){for(var r=/var\s+(\w+Sampler)\s*:\s*(sampler|sampler_comparison)\s*;/gm;;){var n=r.exec(e);if(null===n)break;var i,o=n[1],s=n[2],a=o.indexOf(Sw.AutoSamplerSuffix)===o.length-Sw.AutoSamplerSuffix.length?o.substring(0,o.indexOf(Sw.AutoSamplerSuffix)):null,u=(i=this._webgpuProcessingContext.availableTextures[a])&&i.sampleType===GM.TextureSampleType.Depth,c="sampler_comparison"===s?GM.SamplerBindingType.Comparison:u?GM.SamplerBindingType.NonFiltering:GM.SamplerBindingType.Filtering;if(a)(i=this._webgpuProcessingContext.availableTextures[a])&&(i.autoBindSampler=!0);var l=this._webgpuProcessingContext.availableSamplers[o];l||(l={binding:this._webgpuProcessingContext.getNextFreeUBOBinding(),type:c},this._webgpuProcessingContext.availableSamplers[o]=l),this._addSamplerBindingDescription(o,l,t);var h=e.substring(0,n.index),p="@group(".concat(l.binding.groupIndex,") @binding(").concat(l.binding.bindingIndex,") "),d=e.substring(n.index);e=h+p+d,r.lastIndex+=p.length}return e},Kw.prototype._processCustomBuffers=function(e,t){for(var r=/var<\s*(uniform|storage)\s*(,\s*(read|read_write)\s*)?>\s+(\S+)\s*:\s*(\S+)\s*;/gm;;){var n=r.exec(e);if(null===n)break;var i=n[1],o=n[3],s=n[4],a=n[5],u=this._webgpuProcessingContext.availableBuffers[s];if(!u){var c="uniform"===i?Dw.KnownUBOs[a]:null,l=void 0;c?(s=a,-1===(l=c.binding).groupIndex&&(l=this._webgpuProcessingContext.getNextFreeUBOBinding())):l=this._webgpuProcessingContext.getNextFreeUBOBinding(),u={binding:l},this._webgpuProcessingContext.availableBuffers[s]=u}this._addBufferBindingDescription(s,this._webgpuProcessingContext.availableBuffers[s],"read_write"===o?GM.BufferBindingType.Storage:"storage"===i?GM.BufferBindingType.ReadOnlyStorage:GM.BufferBindingType.Uniform,t);var h=u.binding.groupIndex,p=u.binding.bindingIndex,d=e.substring(0,n.index),f="@group(".concat(h,") @binding(").concat(p,") "),A=e.substring(n.index);e=d+f+A,r.lastIndex+=f.length}return e},Kw.prototype._processStridedUniformArrays=function(e){for(var t=0,r=this._stridedUniformArrays;t<r.length;t++){var n=r[t];e=e.replace(new RegExp("".concat(n,"\\s*\\[(.*)\\]"),"g"),"".concat(n,"[$1].el"))}return e},Jw.prototype.reset=function(e){void 0===e&&(e=!1),this.renderPass=null,e&&(this.renderPassDescriptor=null,this.colorAttachmentViewDescriptor=null,this.depthAttachmentViewDescriptor=null,this.colorAttachmentGPUTextures=[],this.depthTextureFormat=void 0)};var Zw,$w=[0,0,3,7,0,2,6,2,4,1,5,3,1],eS=[0,64,32,96,16,80,48,112,8],tS=[0,128,128,0,0,0,0,128,0,0,0,0,128];function rS(e){this._samplers={},this._device=e,this.disabled=!1}rS.GetSamplerHashCode=function(e){var t,r,n,i=e._cachedAnisotropicFilteringLevel&&e._cachedAnisotropicFilteringLevel>1?4:1;return $w[e.samplingMode]+eS[(e._comparisonFunction||514)-512+1]+tS[e.samplingMode]+((null!==(t=e._cachedWrapU)&&void 0!==t?t:1)<<8)+((null!==(r=e._cachedWrapV)&&void 0!==r?r:1)<<10)+((null!==(n=e._cachedWrapR)&&void 0!==n?n:1)<<12)+((e.useMipMaps?1:0)<<14)+(i<<15)},rS._GetSamplerFilterDescriptor=function(e,t){var r,n,i,o,s,a=e.useMipMaps;switch(e.samplingMode){case cp.TEXTURE_LINEAR_LINEAR_MIPNEAREST:r=GM.FilterMode.Linear,n=GM.FilterMode.Linear,i=GM.FilterMode.Nearest,a||(o=s=0);break;case cp.TEXTURE_LINEAR_LINEAR_MIPLINEAR:case cp.TEXTURE_TRILINEAR_SAMPLINGMODE:r=GM.FilterMode.Linear,n=GM.FilterMode.Linear,a?i=GM.FilterMode.Linear:(i=GM.FilterMode.Nearest,o=s=0);break;case cp.TEXTURE_NEAREST_NEAREST_MIPLINEAR:r=GM.FilterMode.Nearest,n=GM.FilterMode.Nearest,a?i=GM.FilterMode.Linear:(i=GM.FilterMode.Nearest,o=s=0);break;case cp.TEXTURE_NEAREST_NEAREST_MIPNEAREST:r=GM.FilterMode.Nearest,n=GM.FilterMode.Nearest,i=GM.FilterMode.Nearest,a||(o=s=0);break;case cp.TEXTURE_NEAREST_LINEAR_MIPNEAREST:r=GM.FilterMode.Nearest,n=GM.FilterMode.Linear,i=GM.FilterMode.Nearest,a||(o=s=0);break;case cp.TEXTURE_NEAREST_LINEAR_MIPLINEAR:r=GM.FilterMode.Nearest,n=GM.FilterMode.Linear,a?i=GM.FilterMode.Linear:(i=GM.FilterMode.Nearest,o=s=0);break;case cp.TEXTURE_NEAREST_LINEAR:r=GM.FilterMode.Nearest,n=GM.FilterMode.Linear,i=GM.FilterMode.Nearest,o=s=0;break;case cp.TEXTURE_NEAREST_NEAREST:case cp.TEXTURE_NEAREST_SAMPLINGMODE:r=GM.FilterMode.Nearest,n=GM.FilterMode.Nearest,i=GM.FilterMode.Nearest,o=s=0;break;case cp.TEXTURE_LINEAR_NEAREST_MIPNEAREST:r=GM.FilterMode.Linear,n=GM.FilterMode.Nearest,i=GM.FilterMode.Nearest,a||(o=s=0);break;case cp.TEXTURE_LINEAR_NEAREST_MIPLINEAR:r=GM.FilterMode.Linear,n=GM.FilterMode.Nearest,a?i=GM.FilterMode.Linear:(i=GM.FilterMode.Nearest,o=s=0);break;case cp.TEXTURE_LINEAR_LINEAR:case cp.TEXTURE_BILINEAR_SAMPLINGMODE:r=GM.FilterMode.Linear,n=GM.FilterMode.Linear,i=GM.FilterMode.Nearest,o=s=0;break;case cp.TEXTURE_LINEAR_NEAREST:r=GM.FilterMode.Linear,n=GM.FilterMode.Nearest,i=GM.FilterMode.Nearest,o=s=0;break;default:r=GM.FilterMode.Nearest,n=GM.FilterMode.Nearest,i=GM.FilterMode.Nearest,o=s=0}return t>1&&(0!==o||0!==s)?{magFilter:GM.FilterMode.Linear,minFilter:GM.FilterMode.Linear,mipmapFilter:GM.FilterMode.Linear,anisotropyEnabled:!0}:{magFilter:r,minFilter:n,mipmapFilter:i,lodMinClamp:o,lodMaxClamp:s}},rS._GetWrappingMode=function(e){switch(e){case cp.TEXTURE_WRAP_ADDRESSMODE:return GM.AddressMode.Repeat;case cp.TEXTURE_CLAMP_ADDRESSMODE:return GM.AddressMode.ClampToEdge;case cp.TEXTURE_MIRROR_ADDRESSMODE:return GM.AddressMode.MirrorRepeat}return GM.AddressMode.Repeat},rS._GetSamplerWrappingDescriptor=function(e){return{addressModeU:this._GetWrappingMode(e._cachedWrapU),addressModeV:this._GetWrappingMode(e._cachedWrapV),addressModeW:this._GetWrappingMode(e._cachedWrapR)}},rS._GetSamplerDescriptor=function(e){var t=e.useMipMaps&&e._cachedAnisotropicFilteringLevel&&e._cachedAnisotropicFilteringLevel>1?4:1,r=this._GetSamplerFilterDescriptor(e,t),n=In(r,this._GetSamplerWrappingDescriptor(e));return n=In(n,{compare:e._comparisonFunction?rS.GetCompareFunction(e._comparisonFunction):void 0,maxAnisotropy:r.anisotropyEnabled?t:1})},rS.GetCompareFunction=function(e){switch(e){case cp.ALWAYS:return GM.CompareFunction.Always;case cp.EQUAL:return GM.CompareFunction.Equal;case cp.GREATER:return GM.CompareFunction.Greater;case cp.GEQUAL:return GM.CompareFunction.GreaterEqual;case cp.LESS:return GM.CompareFunction.Less;case cp.LEQUAL:return GM.CompareFunction.LessEqual;case cp.NEVER:return GM.CompareFunction.Never;case cp.NOTEQUAL:return GM.CompareFunction.NotEqual;default:return GM.CompareFunction.Less}},rS.prototype.getSampler=function(e,t,r){if(void 0===t&&(t=!1),void 0===r&&(r=0),this.disabled)return this._device.createSampler(rS._GetSamplerDescriptor(e));t?r=0:0===r&&(r=rS.GetSamplerHashCode(e));var n=t?void 0:this._samplers[r];return n||(n=this._device.createSampler(rS._GetSamplerDescriptor(e)),t||(this._samplers[r]=n)),n},function(e){e[e.StencilReadMask=0]="StencilReadMask",e[e.StencilWriteMask=1]="StencilWriteMask",e[e.DepthBias=2]="DepthBias",e[e.DepthBiasSlopeScale=3]="DepthBiasSlopeScale",e[e.DepthStencilState=4]="DepthStencilState",e[e.MRTAttachments1=5]="MRTAttachments1",e[e.MRTAttachments2=6]="MRTAttachments2",e[e.RasterizationState=7]="RasterizationState",e[e.ColorStates=8]="ColorStates",e[e.ShaderStage=9]="ShaderStage",e[e.TextureStage=10]="TextureStage",e[e.VertexState=11]="VertexState",e[e.NumStates=12]="NumStates"}(Zw||(Zw={}));var nS={0:1,1:2,768:3,769:4,770:5,771:6,772:7,773:8,774:9,775:10,776:11,32769:12,32770:13,32771:12,32772:13},iS={0:0,7680:1,7681:2,7682:3,7683:4,5386:5,34055:6,34056:7};function oS(e,t,r){this.mrtTextureCount=0,this._device=e,this._useTextureStage=r,this._states=new Array(30),this._statesLength=0,this._stateDirtyLowestIndex=0,this._emptyVertexBuffer=t,this._mrtFormats=[],this._parameter={token:void 0,pipeline:null},this.disabled=!1,this.vertexBuffers=[],this._kMaxVertexBufferStride=e.limits.maxVertexBufferArrayStride||2048,this.reset()}oS.prototype.reset=function(){this._isDirty=!0,this.vertexBuffers.length=0,this.setAlphaToCoverage(!1),this.resetDepthCullingState(),this.setClampDepth(!1),this.setDepthBias(0),this._webgpuColorFormat=[GM.TextureFormat.BGRA8Unorm],this.setColorFormat(GM.TextureFormat.BGRA8Unorm),this.setMRT([]),this.setAlphaBlendEnabled(!1),this.setAlphaBlendFactors([null,null,null,null],[null,null]),this.setWriteMask(15),this.setDepthStencilFormat(GM.TextureFormat.Depth24PlusStencil8),this.setStencilEnabled(!1),this.resetStencilState(),this.setBuffers(null,null,null),this._setTextureState(0)},Object.defineProperty(oS.prototype,"colorFormats",{get:function(){return this._mrtAttachments1>0?this._mrtFormats:this._webgpuColorFormat},enumerable:!1,configurable:!0}),oS.prototype.getRenderPipeline=function(e,t,r,n){if(void 0===n&&(n=0),r>1&&(r=4),this.disabled){var i=oS._GetTopology(e);return this._setVertexState(t),this._parameter.pipeline=this._createRenderPipeline(t,i,r),oS.NumCacheMiss++,oS._NumPipelineCreationCurrentFrame++,this._parameter.pipeline}if(this._setShaderStage(t.uniqueId),this._setRasterizationState(e,r),this._setColorStates(),this._setDepthStencilState(),this._setVertexState(t),this._setTextureState(n),this.lastStateDirtyLowestIndex=this._stateDirtyLowestIndex,!this._isDirty&&this._parameter.pipeline)return this._stateDirtyLowestIndex=this._statesLength,oS.NumCacheHitWithoutHash++,this._parameter.pipeline;if(this._getRenderPipeline(this._parameter),this._isDirty=!1,this._stateDirtyLowestIndex=this._statesLength,this._parameter.pipeline)return oS.NumCacheHitWithHash++,this._parameter.pipeline;var o=oS._GetTopology(e);return this._parameter.pipeline=this._createRenderPipeline(t,o,r),this._setRenderPipeline(this._parameter),oS.NumCacheMiss++,oS._NumPipelineCreationCurrentFrame++,this._parameter.pipeline},oS.prototype.endFrame=function(){oS.NumPipelineCreationLastFrame=oS._NumPipelineCreationCurrentFrame,oS._NumPipelineCreationCurrentFrame=0},oS.prototype.setAlphaToCoverage=function(e){this._alphaToCoverageEnabled=e},oS.prototype.setFrontFace=function(e){this._frontFace=e},oS.prototype.setCullEnabled=function(e){this._cullEnabled=e},oS.prototype.setCullFace=function(e){this._cullFace=e},oS.prototype.setClampDepth=function(e){this._clampDepth=e},oS.prototype.resetDepthCullingState=function(){this.setDepthCullingState(!1,2,1,0,0,!0,!0,cp.ALWAYS)},oS.prototype.setDepthCullingState=function(e,t,r,n,i,o,s,a){this._depthWriteEnabled=s,this._depthTestEnabled=o,this._depthCompare=(null!=a?a:cp.ALWAYS)-512,this._cullFace=r,this._cullEnabled=e,this._frontFace=t,this.setDepthBiasSlopeScale(n),this.setDepthBias(i)},oS.prototype.setDepthBias=function(e){this._depthBias!==e&&(this._depthBias=e,this._states[Zw.DepthBias]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,Zw.DepthBias))},oS.prototype.setDepthBiasSlopeScale=function(e){this._depthBiasSlopeScale!==e&&(this._depthBiasSlopeScale=e,this._states[Zw.DepthBiasSlopeScale]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,Zw.DepthBiasSlopeScale))},oS.prototype.setColorFormat=function(e){this._webgpuColorFormat[0]=e,this._colorFormat=JS[null!=e?e:""]},oS.prototype.setMRTAttachments=function(e){this.mrtAttachments=e;for(var t=0,r=0;r<e.length;++r)0!==e[r]&&(t+=1<<r);this._mrtEnabledMask!==t&&(this._mrtEnabledMask=t,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,Zw.MRTAttachments1))},oS.prototype.setMRT=function(e,t){var r,n;if((t=null!=t?t:e.length)>10)throw"Can't handle more than 10 attachments for a MRT in cache render pipeline!";this.mrtTextureArray=e,this.mrtTextureCount=t,this._mrtEnabledMask=65535;for(var i=[0,0],o=0,s=0,a=0,u=0;u<t;++u){var c=e[u],l=null==c?void 0:c._hardwareTexture;this._mrtFormats[a]=null!==(r=null==l?void 0:l.format)&&void 0!==r?r:this._webgpuColorFormat[0],i[o]+=JS[null!==(n=this._mrtFormats[a])&&void 0!==n?n:""]<<s,a++,(s+=6)>=32&&(s=0,o++)}this._mrtFormats.length=a,this._mrtAttachments1===i[0]&&this._mrtAttachments2===i[1]||(this._mrtAttachments1=i[0],this._mrtAttachments2=i[1],this._states[Zw.MRTAttachments1]=i[0],this._states[Zw.MRTAttachments2]=i[1],this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,Zw.MRTAttachments1))},oS.prototype.setAlphaBlendEnabled=function(e){this._alphaBlendEnabled=e},oS.prototype.setAlphaBlendFactors=function(e,t){this._alphaBlendFuncParams=e,this._alphaBlendEqParams=t},oS.prototype.setWriteMask=function(e){this._writeMask=e},oS.prototype.setDepthStencilFormat=function(e){this._webgpuDepthStencilFormat=e,this._depthStencilFormat=void 0===e?0:JS[e]},oS.prototype.setDepthTestEnabled=function(e){this._depthTestEnabled=e},oS.prototype.setDepthWriteEnabled=function(e){this._depthWriteEnabled=e},oS.prototype.setDepthCompare=function(e){this._depthCompare=(null!=e?e:cp.ALWAYS)-512},oS.prototype.setStencilEnabled=function(e){this._stencilEnabled=e},oS.prototype.setStencilCompare=function(e,t){e===cp.FRONT?this._stencilFrontCompare=(null!=t?t:cp.ALWAYS)-512:this._stencilBackCompare=(null!=t?t:cp.ALWAYS)-512},oS.prototype.setStencilDepthFailOp=function(e,t){e===cp.FRONT?this._stencilFrontDepthFailOp=null===t?1:iS[t]:this._stencilBackDepthFailOp=null===t?1:iS[t]},oS.prototype.setStencilPassOp=function(e,t){e===cp.FRONT?this._stencilFrontPassOp=null===t?2:iS[t]:this._stencilBackPassOp=null===t?2:iS[t]},oS.prototype.setStencilFailOp=function(e,t){e===cp.FRONT?this._stencilFrontFailOp=null===t?1:iS[t]:this._stencilBackFailOp=null===t?1:iS[t]},oS.prototype.setStencilReadMask=function(e){this._stencilReadMask!==e&&(this._stencilReadMask=e,this._states[Zw.StencilReadMask]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,Zw.StencilReadMask))},oS.prototype.setStencilWriteMask=function(e){this._stencilWriteMask!==e&&(this._stencilWriteMask=e,this._states[Zw.StencilWriteMask]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,Zw.StencilWriteMask))},oS.prototype.resetStencilState=function(){this.setStencilState(cp.FRONT,!1,cp.ALWAYS,cp.KEEP,cp.REPLACE,cp.KEEP,255,255),this.setStencilState(cp.BACK,!1,cp.ALWAYS,cp.KEEP,cp.REPLACE,cp.KEEP,255,255)},oS.prototype.setStencilState=function(e,t,r,n,i,o,s,a){this._stencilEnabled=t,e===cp.FRONT?(this._stencilFrontCompare=(null!=r?r:cp.ALWAYS)-512,this._stencilFrontDepthFailOp=null===n?1:iS[n],this._stencilFrontPassOp=null===i?2:iS[i],this._stencilFrontFailOp=null===o?1:iS[o]):(this._stencilBackCompare=(null!=r?r:cp.ALWAYS)-512,this._stencilBackDepthFailOp=null===n?1:iS[n],this._stencilBackPassOp=null===i?2:iS[i],this._stencilBackFailOp=null===o?1:iS[o]),this.setStencilReadMask(s),this.setStencilWriteMask(a)},oS.prototype.setBuffers=function(e,t,r){this._vertexBuffers=e,this._overrideVertexBuffers=r,this._indexBuffer=t},oS._GetTopology=function(e){switch(e){case cp.MATERIAL_TriangleFillMode:return GM.PrimitiveTopology.TriangleList;case cp.MATERIAL_PointFillMode:return GM.PrimitiveTopology.PointList;case cp.MATERIAL_WireFrameFillMode:return GM.PrimitiveTopology.LineList;case cp.MATERIAL_PointListDrawMode:return GM.PrimitiveTopology.PointList;case cp.MATERIAL_LineListDrawMode:return GM.PrimitiveTopology.LineList;case cp.MATERIAL_LineLoopDrawMode:throw"LineLoop is an unsupported fillmode in WebGPU";case cp.MATERIAL_LineStripDrawMode:return GM.PrimitiveTopology.LineStrip;case cp.MATERIAL_TriangleStripDrawMode:return GM.PrimitiveTopology.TriangleStrip;case cp.MATERIAL_TriangleFanDrawMode:throw"TriangleFan is an unsupported fillmode in WebGPU";default:return GM.PrimitiveTopology.TriangleList}},oS._GetAphaBlendOperation=function(e){switch(e){case cp.GL_ALPHA_EQUATION_ADD:return GM.BlendOperation.Add;case cp.GL_ALPHA_EQUATION_SUBTRACT:return GM.BlendOperation.Subtract;case cp.GL_ALPHA_EQUATION_REVERSE_SUBTRACT:return GM.BlendOperation.ReverseSubtract;case cp.GL_ALPHA_EQUATION_MIN:return GM.BlendOperation.Min;case cp.GL_ALPHA_EQUATION_MAX:return GM.BlendOperation.Max;default:return GM.BlendOperation.Add}},oS._GetAphaBlendFactor=function(e){switch(e){case 0:return GM.BlendFactor.Zero;case 1:return GM.BlendFactor.One;case cp.GL_ALPHA_FUNCTION_SRC:return GM.BlendFactor.Src;case cp.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR:return GM.BlendFactor.OneMinusSrc;case cp.GL_ALPHA_FUNCTION_SRC_ALPHA:return GM.BlendFactor.SrcAlpha;case cp.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA:return GM.BlendFactor.OneMinusSrcAlpha;case cp.GL_ALPHA_FUNCTION_DST_ALPHA:return GM.BlendFactor.DstAlpha;case cp.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA:return GM.BlendFactor.OneMinusDstAlpha;case cp.GL_ALPHA_FUNCTION_DST_COLOR:return GM.BlendFactor.Dst;case cp.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR:return GM.BlendFactor.OneMinusDst;case cp.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED:return GM.BlendFactor.SrcAlphaSaturated;case cp.GL_ALPHA_FUNCTION_CONSTANT_COLOR:return GM.BlendFactor.Constant;case cp.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR:return GM.BlendFactor.OneMinusConstant;case cp.GL_ALPHA_FUNCTION_CONSTANT_ALPHA:return GM.BlendFactor.Constant;case cp.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA:return GM.BlendFactor.OneMinusConstant;default:return GM.BlendFactor.One}},oS._GetCompareFunction=function(e){switch(e){case 0:return GM.CompareFunction.Never;case 1:return GM.CompareFunction.Less;case 2:return GM.CompareFunction.Equal;case 3:return GM.CompareFunction.LessEqual;case 4:return GM.CompareFunction.Greater;case 5:return GM.CompareFunction.NotEqual;case 6:return GM.CompareFunction.GreaterEqual;case 7:return GM.CompareFunction.Always}return GM.CompareFunction.Never},oS._GetStencilOpFunction=function(e){switch(e){case 0:return GM.StencilOperation.Zero;case 1:return GM.StencilOperation.Keep;case 2:return GM.StencilOperation.Replace;case 3:return GM.StencilOperation.IncrementClamp;case 4:return GM.StencilOperation.DecrementClamp;case 5:return GM.StencilOperation.Invert;case 6:return GM.StencilOperation.IncrementWrap;case 7:return GM.StencilOperation.DecrementWrap}return GM.StencilOperation.Keep},oS._GetVertexInputDescriptorFormat=function(e){var t=e.type,r=e.normalized,n=e.getSize();switch(t){case pp.BYTE:switch(n){case 1:case 2:return r?GM.VertexFormat.Snorm8x2:GM.VertexFormat.Sint8x2;case 3:case 4:return r?GM.VertexFormat.Snorm8x4:GM.VertexFormat.Sint8x4}break;case pp.UNSIGNED_BYTE:switch(n){case 1:case 2:return r?GM.VertexFormat.Unorm8x2:GM.VertexFormat.Uint8x2;case 3:case 4:return r?GM.VertexFormat.Unorm8x4:GM.VertexFormat.Uint8x4}break;case pp.SHORT:switch(n){case 1:case 2:return r?GM.VertexFormat.Snorm16x2:GM.VertexFormat.Sint16x2;case 3:case 4:return r?GM.VertexFormat.Snorm16x4:GM.VertexFormat.Sint16x4}break;case pp.UNSIGNED_SHORT:switch(n){case 1:case 2:return r?GM.VertexFormat.Unorm16x2:GM.VertexFormat.Uint16x2;case 3:case 4:return r?GM.VertexFormat.Unorm16x4:GM.VertexFormat.Uint16x4}break;case pp.INT:switch(n){case 1:return GM.VertexFormat.Sint32;case 2:return GM.VertexFormat.Sint32x2;case 3:return GM.VertexFormat.Sint32x3;case 4:return GM.VertexFormat.Sint32x4}break;case pp.UNSIGNED_INT:switch(n){case 1:return GM.VertexFormat.Uint32;case 2:return GM.VertexFormat.Uint32x2;case 3:return GM.VertexFormat.Uint32x3;case 4:return GM.VertexFormat.Uint32x4}break;case pp.FLOAT:switch(n){case 1:return GM.VertexFormat.Float32;case 2:return GM.VertexFormat.Float32x2;case 3:return GM.VertexFormat.Float32x3;case 4:return GM.VertexFormat.Float32x4}}throw new Error("Invalid Format '".concat(e.getKind(),"' - type=").concat(t,", normalized=").concat(r,", size=").concat(n))},oS.prototype._getAphaBlendState=function(){return this._alphaBlendEnabled?{srcFactor:oS._GetAphaBlendFactor(this._alphaBlendFuncParams[2]),dstFactor:oS._GetAphaBlendFactor(this._alphaBlendFuncParams[3]),operation:oS._GetAphaBlendOperation(this._alphaBlendEqParams[1])}:null},oS.prototype._getColorBlendState=function(){return this._alphaBlendEnabled?{srcFactor:oS._GetAphaBlendFactor(this._alphaBlendFuncParams[0]),dstFactor:oS._GetAphaBlendFactor(this._alphaBlendFuncParams[1]),operation:oS._GetAphaBlendOperation(this._alphaBlendEqParams[0])}:null},oS.prototype._setShaderStage=function(e){this._shaderId!==e&&(this._shaderId=e,this._states[Zw.ShaderStage]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,Zw.ShaderStage))},oS.prototype._setRasterizationState=function(e,t){var r=this._frontFace-1+((this._cullEnabled?this._cullFace:0)<<1)+((this._clampDepth?1:0)<<3)+((this._alphaToCoverageEnabled?1:0)<<4)+(e<<5)+(t<<8);this._rasterizationState!==r&&(this._rasterizationState=r,this._states[Zw.RasterizationState]=this._rasterizationState,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,Zw.RasterizationState))},oS.prototype._setColorStates=function(){var e=((this._writeMask?1:0)<<22)+(this._colorFormat<<23)+((this._depthWriteEnabled?1:0)<<29);this._alphaBlendEnabled&&(e+=((null===this._alphaBlendFuncParams[0]?2:nS[this._alphaBlendFuncParams[0]])|0)+((null===this._alphaBlendFuncParams[1]?2:nS[this._alphaBlendFuncParams[1]])<<4)+((null===this._alphaBlendFuncParams[2]?2:nS[this._alphaBlendFuncParams[2]])<<8)+((null===this._alphaBlendFuncParams[3]?2:nS[this._alphaBlendFuncParams[3]])<<12)+((null===this._alphaBlendEqParams[0]?1:this._alphaBlendEqParams[0]-32773)<<16)+((null===this._alphaBlendEqParams[1]?1:this._alphaBlendEqParams[1]-32773)<<19)),e!==this._colorStates&&(this._colorStates=e,this._states[Zw.ColorStates]=this._colorStates,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,Zw.ColorStates))},oS.prototype._setDepthStencilState=function(){var e=this._stencilEnabled?this._stencilFrontCompare+(this._stencilFrontDepthFailOp<<3)+(this._stencilFrontPassOp<<6)+(this._stencilFrontFailOp<<9)+(this._stencilBackCompare<<12)+(this._stencilBackDepthFailOp<<15)+(this._stencilBackPassOp<<18)+(this._stencilBackFailOp<<21):2449408,t=this._depthStencilFormat+((this._depthTestEnabled?this._depthCompare:7)<<6)+(e<<10);this._depthStencilState!==t&&(this._depthStencilState=t,this._states[Zw.DepthStencilState]=this._depthStencilState,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,Zw.DepthStencilState))},oS.prototype._setVertexState=function(e){for(var t,r,n,i=this._statesLength,o=Zw.VertexState,s=e._pipelineContext,a=s.shaderProcessingContext.attributeNamesFromEffect,u=s.shaderProcessingContext.attributeLocationsFromEffect,c=0,l=0;l<a.length;l++){var h=u[l],p=null!==(t=this._overrideVertexBuffers&&this._overrideVertexBuffers[a[l]])&&void 0!==t?t:this._vertexBuffers[a[l]];p||(p=this._emptyVertexBuffer);var d=null===(r=p.getBuffer())||void 0===r?void 0:r.underlyingResource;if(void 0===p._validOffsetRange){var f=p.byteOffset,A=p.getSize(!0),g=p.byteStride;p._validOffsetRange=f<=this._kMaxVertexBufferStride-A&&(0===g||f+A<=g)}n&&n===d&&p._validOffsetRange||(this.vertexBuffers[c++]=p,n=p._validOffsetRange?d:null);var _=p.hashCode+(h<<7);this._isDirty=this._isDirty||this._states[o]!==_,this._states[o++]=_}this.vertexBuffers.length=c,this._statesLength=o,this._isDirty=this._isDirty||o!==i,this._isDirty&&(this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,Zw.VertexState))},oS.prototype._setTextureState=function(e){this._textureState!==e&&(this._textureState=e,this._states[Zw.TextureStage]=this._textureState,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,Zw.TextureStage))},oS.prototype._createPipelineLayout=function(e){if(this._useTextureStage)return this._createPipelineLayoutWithTextureStage(e);for(var t=[],r=e.shaderProcessingContext.bindGroupLayoutEntries,n=0;n<r.length;n++){var i=r[n];t[n]=this._device.createBindGroupLayout({entries:i})}return e.bindGroupLayouts=t,this._device.createPipelineLayout({bindGroupLayouts:t})},oS.prototype._createPipelineLayoutWithTextureStage=function(e){for(var t,r=e.shaderProcessingContext,n=r.bindGroupLayoutEntries,i=1,o=0;o<n.length;o++)for(var s=n[o],a=0;a<s.length;a++){var u=n[o][a];if(u.texture){var c=r.bindGroupLayoutEntryInfo[o][u.binding].name,l=r.availableTextures[c],h=l.autoBindSampler?r.availableSamplers[c+Sw.AutoSamplerSuffix]:null,p=l.sampleType,d=null!==(t=null==h?void 0:h.type)&&void 0!==t?t:GM.SamplerBindingType.Filtering;if(this._textureState&i&&p!==GM.TextureSampleType.Depth&&(l.autoBindSampler&&(d=GM.SamplerBindingType.NonFiltering),p=GM.TextureSampleType.UnfilterableFloat),u.texture.sampleType=p,h){var f=r.bindGroupLayoutEntryInfo[h.binding.groupIndex][h.binding.bindingIndex].index;n[h.binding.groupIndex][f].sampler.type=d}i<<=1}}var A=[];for(o=0;o<n.length;++o)A[o]=this._device.createBindGroupLayout({entries:n[o]});return e.bindGroupLayouts=A,this._device.createPipelineLayout({bindGroupLayouts:A})},oS.prototype._getVertexInputDescriptor=function(e){for(var t,r,n,i,o=[],s=e._pipelineContext,a=s.shaderProcessingContext.attributeNamesFromEffect,u=s.shaderProcessingContext.attributeLocationsFromEffect,c=0;c<a.length;c++){var l=u[c],h=null!==(t=this._overrideVertexBuffers&&this._overrideVertexBuffers[a[c]])&&void 0!==t?t:this._vertexBuffers[a[c]];h||(h=this._emptyVertexBuffer);var p=null===(r=h.getBuffer())||void 0===r?void 0:r.underlyingResource,d=h.byteOffset,f=!h._validOffsetRange;if(!n||!i||n!==p||f){var A={arrayStride:h.byteStride,stepMode:h.getIsInstanced()?GM.InputStepMode.Instance:GM.InputStepMode.Vertex,attributes:[]};o.push(A),i=A.attributes,f&&(d=0,p=null)}i.push({shaderLocation:l,offset:d,format:oS._GetVertexInputDescriptorFormat(h)}),n=p}return o},oS.prototype._createRenderPipeline=function(e,t,r){var n=e._pipelineContext,i=this._getVertexInputDescriptor(e),o=this._createPipelineLayout(n),s=[],a=this._getAphaBlendState(),u=this._getColorBlendState();if(this._mrtAttachments1>0)for(var c=0;c<this._mrtFormats.length;++c){var l=this._mrtFormats[c];if(l){var h={format:l,writeMask:this._mrtEnabledMask&1<<c?this._writeMask:0};a&&u&&(h.blend={alpha:a,color:u}),s.push(h)}else s.push(null)}else if(this._webgpuColorFormat[0]){h={format:this._webgpuColorFormat[0],writeMask:this._writeMask};a&&u&&(h.blend={alpha:a,color:u}),s.push(h)}else s.push(null);var p={compare:oS._GetCompareFunction(this._stencilEnabled?this._stencilFrontCompare:7),depthFailOp:oS._GetStencilOpFunction(this._stencilEnabled?this._stencilFrontDepthFailOp:1),failOp:oS._GetStencilOpFunction(this._stencilEnabled?this._stencilFrontFailOp:1),passOp:oS._GetStencilOpFunction(this._stencilEnabled?this._stencilFrontPassOp:1)},d={compare:oS._GetCompareFunction(this._stencilEnabled?this._stencilBackCompare:7),depthFailOp:oS._GetStencilOpFunction(this._stencilEnabled?this._stencilBackDepthFailOp:1),failOp:oS._GetStencilOpFunction(this._stencilEnabled?this._stencilBackFailOp:1),passOp:oS._GetStencilOpFunction(this._stencilEnabled?this._stencilBackPassOp:1)},f=void 0;t!==GM.PrimitiveTopology.LineStrip&&t!==GM.PrimitiveTopology.TriangleStrip||(f=!this._indexBuffer||this._indexBuffer.is32Bits?GM.IndexFormat.Uint32:GM.IndexFormat.Uint16);var A=!!this._webgpuDepthStencilFormat&&ZS.HasStencilAspect(this._webgpuDepthStencilFormat);return this._device.createRenderPipeline({layout:o,vertex:{module:n.stages.vertexStage.module,entryPoint:n.stages.vertexStage.entryPoint,buffers:i},primitive:{topology:t,stripIndexFormat:f,frontFace:1===this._frontFace?GM.FrontFace.CCW:GM.FrontFace.CW,cullMode:this._cullEnabled?2===this._cullFace?GM.CullMode.Front:GM.CullMode.Back:GM.CullMode.None},fragment:n.stages.fragmentStage?{module:n.stages.fragmentStage.module,entryPoint:n.stages.fragmentStage.entryPoint,targets:s}:void 0,multisample:{count:r},depthStencil:void 0===this._webgpuDepthStencilFormat?void 0:{depthWriteEnabled:this._depthWriteEnabled,depthCompare:this._depthTestEnabled?oS._GetCompareFunction(this._depthCompare):GM.CompareFunction.Always,format:this._webgpuDepthStencilFormat,stencilFront:this._stencilEnabled&&A?p:void 0,stencilBack:this._stencilEnabled&&A?d:void 0,stencilReadMask:this._stencilEnabled&&A?this._stencilReadMask:void 0,stencilWriteMask:this._stencilEnabled&&A?this._stencilWriteMask:void 0,depthBias:this._depthBias,depthBiasClamp:this._depthBiasClamp,depthBiasSlopeScale:this._depthBiasSlopeScale}})},oS.NumCacheHitWithoutHash=0,oS.NumCacheHitWithHash=0,oS.NumCacheMiss=0,oS.NumPipelineCreationLastFrame=0,oS._NumPipelineCreationCurrentFrame=0;var sS=function(){function e(){this.values={}}return e.prototype.count=function(){var e=0,t=this.pipeline?1:0;for(var r in this.values){var n=this.values[r].count();e+=n[0],t+=n[1],e++}return[e,t]},e}();function aS(e,t,r){var n=oS.call(this,e,t,r)||this;return n._nodeStack=[],n._nodeStack[0]=aS._Cache,n}function uS(e){var t=$M.call(this,!1)||this;return t._cache=e,t.reset(),t}function cS(e){var t=YM.call(this,!1)||this;return t._cache=e,t.reset(),t}function lS(e,t){void 0===t&&(t=!0),this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}function hS(e){this.useMipMaps=!1,this.type=cp.TEXTURETYPE_UNDEFINED,this._video=e,this.uniqueId=kR._Counter++}function pS(){this.uniqueId=pS._Counter++,this.updateId=0,this.reset()}function dS(e){this._bufferManager=e,this.uniqueId=dS._Counter++,this._useInstancing=!1,this._currentInstanceCount=0,this.reset()}aS.prototype=Object.create(oS.prototype),aS.prototype.constructor=oS,aS.GetNodeCounts=function(){var e=aS._Cache.count();return{nodeCount:e[0],pipelineCount:e[1]}},aS._GetPipelines=function(e,t,r,n){if(e.pipeline){var i=r.slice();i.length=n,t.push(i)}for(var o in e.values){var s=e.values[o];r[n]=parseInt(o),aS._GetPipelines(s,t,r,n+1)}},aS.GetPipelines=function(){var e=[];return aS._GetPipelines(aS._Cache,e,[],0),e},aS.prototype._getRenderPipeline=function(e){for(var t=this._nodeStack[this._stateDirtyLowestIndex],r=this._stateDirtyLowestIndex;r<this._statesLength;++r){var n=t.values[this._states[r]];n||(n=new sS,t.values[this._states[r]]=n),t=n,this._nodeStack[r+1]=t}e.token=t,e.pipeline=t.pipeline},aS.prototype._setRenderPipeline=function(e){e.token.pipeline=e.pipeline},aS._Cache=new sS,uS.prototype=Object.create($M.prototype),uS.prototype.constructor=$M,Object.defineProperty(uS.prototype,"frontFunc",{get:function(){return this._frontFunc},set:function(e){this._frontFunc!==e&&(this._frontFunc=e,this._cache.setStencilCompare(cp.FRONT,e))},enumerable:!1,configurable:!0}),Object.defineProperty(uS.prototype,"backFunc",{get:function(){return this._backFunc},set:function(e){this._backFunc!==e&&(this._backFunc=e,this._cache.setStencilCompare(cp.BACK,e))},enumerable:!1,configurable:!0}),Object.defineProperty(uS.prototype,"funcMask",{get:function(){return this._funcMask},set:function(e){this._funcMask!==e&&(this._funcMask=e,this._cache.setStencilReadMask(e))},enumerable:!1,configurable:!0}),Object.defineProperty(uS.prototype,"frontOpStencilFail",{get:function(){return this._frontOpStencilFail},set:function(e){this._frontOpStencilFail!==e&&(this._frontOpStencilFail=e,this._cache.setStencilFailOp(cp.FRONT,e))},enumerable:!1,configurable:!0}),Object.defineProperty(uS.prototype,"backOpStencilFail",{get:function(){return this._backOpStencilFail},set:function(e){this._backOpStencilFail!==e&&(this._backOpStencilFail=e,this._cache.setStencilFailOp(cp.BACK,e))},enumerable:!1,configurable:!0}),Object.defineProperty(uS.prototype,"frontOpDepthFail",{get:function(){return this._frontOpDepthFail},set:function(e){this._frontOpDepthFail!==e&&(this._frontOpDepthFail=e,this._cache.setStencilDepthFailOp(cp.FRONT,e))},enumerable:!1,configurable:!0}),Object.defineProperty(uS.prototype,"backOpDepthFail",{get:function(){return this._backOpDepthFail},set:function(e){this._backOpDepthFail!==e&&(this._backOpDepthFail=e,this._cache.setStencilDepthFailOp(cp.BACK,e))},enumerable:!1,configurable:!0}),Object.defineProperty(uS.prototype,"frontOpStencilDepthPass",{get:function(){return this._frontOpStencilDepthPass},set:function(e){this._frontOpStencilDepthPass!==e&&(this._frontOpStencilDepthPass=e,this._cache.setStencilPassOp(cp.FRONT,e))},enumerable:!1,configurable:!0}),Object.defineProperty(uS.prototype,"backOpStencilDepthPass",{get:function(){return this._backOpStencilDepthPass},set:function(e){this._backOpStencilDepthPass!==e&&(this._backOpStencilDepthPass=e,this._cache.setStencilPassOp(cp.BACK,e))},enumerable:!1,configurable:!0}),Object.defineProperty(uS.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,this._cache.setStencilWriteMask(e))},enumerable:!1,configurable:!0}),Object.defineProperty(uS.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._cache.setStencilEnabled(e))},enumerable:!1,configurable:!0}),uS.prototype.reset=function(){var e;this.stencilMaterial=void 0,null===(e=this.stencilGlobal)||void 0===e||e.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0,this._cache.resetStencilState()},uS.prototype.apply=function(){var e,t=null===(e=this.stencilMaterial)||void 0===e?void 0:e.enabled;this.enabled=t?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.enabled&&(this.frontFunc=t?this.stencilMaterial.frontFunc:this.stencilGlobal.frontFunc,this.backFunc=t?this.stencilMaterial.backFunc:this.stencilGlobal.backFunc,this.funcRef=t?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=t?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.frontOpStencilFail=t?this.stencilMaterial.frontOpStencilFail:this.stencilGlobal.frontOpStencilFail,this.backOpStencilFail=t?this.stencilMaterial.backOpStencilFail:this.stencilGlobal.backOpStencilFail,this.frontOpDepthFail=t?this.stencilMaterial.frontOpDepthFail:this.stencilGlobal.frontOpDepthFail,this.backOpDepthFail=t?this.stencilMaterial.backOpDepthFail:this.stencilGlobal.backOpDepthFail,this.frontOpStencilDepthPass=t?this.stencilMaterial.frontOpStencilDepthPass:this.stencilGlobal.frontOpStencilDepthPass,this.backOpStencilDepthPass=t?this.stencilMaterial.backOpStencilDepthPass:this.stencilGlobal.backOpStencilDepthPass,this.mask=t?this.stencilMaterial.mask:this.stencilGlobal.mask)},cS.prototype=Object.create(YM.prototype),cS.prototype.constructor=YM,Object.defineProperty(cS.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0,this._cache.setDepthBiasSlopeScale(e))},enumerable:!1,configurable:!0}),Object.defineProperty(cS.prototype,"zOffsetUnits",{get:function(){return this._zOffsetUnits},set:function(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0,this._cache.setDepthBias(e))},enumerable:!1,configurable:!0}),Object.defineProperty(cS.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0,this._cache.setCullFace(null!=e?e:1))},enumerable:!1,configurable:!0}),Object.defineProperty(cS.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0,this._cache.setCullEnabled(!!e))},enumerable:!1,configurable:!0}),Object.defineProperty(cS.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0,this._cache.setDepthCompare(e))},enumerable:!1,configurable:!0}),Object.defineProperty(cS.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0,this._cache.setDepthWriteEnabled(e))},enumerable:!1,configurable:!0}),Object.defineProperty(cS.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0,this._cache.setDepthTestEnabled(e))},enumerable:!1,configurable:!0}),Object.defineProperty(cS.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0,this._cache.setFrontFace(null!=e?e:2))},enumerable:!1,configurable:!0}),cS.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1,this._cache.resetDepthCullingState()},cS.prototype.apply=function(){},lS.IsWrapper=function(e){return void 0===e.getPipelineContext},lS.GetEffect=function(e){return void 0===e.getPipelineContext?e.effect:e},lS.prototype.setEffect=function(e,t,r){var n;void 0===r&&(r=!0),this.effect=e,void 0!==t&&(this.defines=t),r&&(null===(n=this.drawContext)||void 0===n||n.reset())},lS.prototype.dispose=function(){var e;null===(e=this.drawContext)||void 0===e||e.dispose()},hS.IsExternalTexture=function(e){return void 0!==e.underlyingResource},hS.prototype.getClassName=function(){return"ExternalTexture"},Object.defineProperty(hS.prototype,"underlyingResource",{get:function(){return this._video},enumerable:!1,configurable:!0}),hS.prototype.isReady=function(){return this._video.readyState>=this._video.HAVE_CURRENT_DATA},hS.prototype.dispose=function(){},Object.defineProperty(pS.prototype,"forceBindGroupCreation",{get:function(){return this._numExternalTextures>0},enumerable:!1,configurable:!0}),Object.defineProperty(pS.prototype,"hasFloatTextures",{get:function(){return this._numFloatTextures>0},enumerable:!1,configurable:!0}),pS.prototype.reset=function(){this.samplers={},this.textures={},this.isDirty=!0,this._numFloatTextures=0,this._numExternalTextures=0},pS.prototype.setSampler=function(e,t){var r=this.samplers[e],n=-1;r?n=r.hashCode:this.samplers[e]=r={sampler:t,hashCode:0},r.sampler=t,r.hashCode=t?rS.GetSamplerHashCode(t):0;var i=n!==r.hashCode;i&&this.updateId++,this.isDirty||(this.isDirty=i)},pS.prototype.setTexture=function(e,t){var r,n,i,o=this.textures[e],s=-1;o?s=null!==(n=null===(r=o.texture)||void 0===r?void 0:r.uniqueId)&&void 0!==n?n:-1:this.textures[e]=o={texture:t,isFloatTexture:!1,isExternalTexture:!1},o.isExternalTexture&&this._numExternalTextures--,o.isFloatTexture&&this._numFloatTextures--,t?(o.isFloatTexture=t.type===cp.TEXTURETYPE_FLOAT,o.isExternalTexture=hS.IsExternalTexture(t),o.isFloatTexture&&this._numFloatTextures++,o.isExternalTexture&&this._numExternalTextures++):(o.isFloatTexture=!1,o.isExternalTexture=!1),o.texture=t;var a=s!==(null!==(i=null==t?void 0:t.uniqueId)&&void 0!==i?i:-1);a&&this.updateId++,this.isDirty||(this.isDirty=a)},pS._Counter=0,dS.prototype.isDirty=function(e){return this._isDirty||this._materialContextUpdateId!==e},dS.prototype.resetIsDirty=function(e){this._isDirty=!1,this._materialContextUpdateId=e},Object.defineProperty(dS.prototype,"useInstancing",{get:function(){return this._useInstancing},set:function(e){this._useInstancing!==e&&(e?(this.indirectDrawBuffer=this._bufferManager.createRawBuffer(40,GM.BufferUsage.CopyDst|GM.BufferUsage.Indirect),this._indirectDrawData=new Uint32Array(5),this._indirectDrawData[3]=0,this._indirectDrawData[4]=0):(this.indirectDrawBuffer&&this._bufferManager.releaseBuffer(this.indirectDrawBuffer),this.indirectDrawBuffer=void 0,this._indirectDrawData=void 0),this._useInstancing=e,this._currentInstanceCount=-1)},enumerable:!1,configurable:!0}),dS.prototype.reset=function(){this.buffers={},this._isDirty=!0,this._materialContextUpdateId=0,this.fastBundle=void 0,this.bindGroups=void 0},dS.prototype.setBuffer=function(e,t){var r;this._isDirty||(this._isDirty=(null==t?void 0:t.uniqueId)!==(null===(r=this.buffers[e])||void 0===r?void 0:r.uniqueId)),this.buffers[e]=t},dS.prototype.setIndirectData=function(e,t,r){t!==this._currentInstanceCount&&this.indirectDrawBuffer&&this._indirectDrawData&&(this._currentInstanceCount=t,this._indirectDrawData[0]=e,this._indirectDrawData[1]=t,this._indirectDrawData[2]=r,this._bufferManager.setRawData(this.indirectDrawBuffer,0,this._indirectDrawData,0,20))},dS.prototype.dispose=function(){this.indirectDrawBuffer&&(this._bufferManager.releaseBuffer(this.indirectDrawBuffer),this.indirectDrawBuffer=void 0,this._indirectDrawData=void 0),this.fastBundle=void 0,this.bindGroups=void 0,this.buffers=void 0},dS._Counter=0;var fS=function(){this.values={}};function AS(e,t,r){this.disabled=!1,this._device=e,this._cacheSampler=t,this._engine=r}Object.defineProperty(AS,"Statistics",{get:function(){return{totalCreated:AS.NumBindGroupsCreatedTotal,lastFrameCreated:AS.NumBindGroupsCreatedLastFrame,lookupLastFrame:AS.NumBindGroupsLookupLastFrame,noLookupLastFrame:AS.NumBindGroupsNoLookupLastFrame}},enumerable:!1,configurable:!0}),AS.prototype.endFrame=function(){AS.NumBindGroupsCreatedLastFrame=AS._NumBindGroupsCreatedCurrentFrame,AS.NumBindGroupsLookupLastFrame=AS._NumBindGroupsLookupCurrentFrame,AS.NumBindGroupsNoLookupLastFrame=AS._NumBindGroupsNoLookupCurrentFrame,AS._NumBindGroupsCreatedCurrentFrame=0,AS._NumBindGroupsLookupCurrentFrame=0,AS._NumBindGroupsNoLookupCurrentFrame=0},AS.prototype.getBindGroups=function(e,t,r,n){var i,o,s,a=void 0;if(!n&&!t.isDirty(r.updateId)&&!r.isDirty)return AS._NumBindGroupsNoLookupCurrentFrame++,t.bindGroups;if(t.resetIsDirty(r.updateId),r.isDirty=!1,a)return t.bindGroups=a,AS._NumBindGroupsLookupCurrentFrame++,a;a=[],t.bindGroups=a,AS.NumBindGroupsCreatedTotal++,AS._NumBindGroupsCreatedCurrentFrame++;for(var u=e.bindGroupLayouts,c=0;c<e.shaderProcessingContext.bindGroupLayoutEntries.length;c++){for(var l=e.shaderProcessingContext.bindGroupLayoutEntries[c],h=e.shaderProcessingContext.bindGroupEntries[c],p=0;p<l.length;p++){var d=e.shaderProcessingContext.bindGroupLayoutEntries[c][p],f=e.shaderProcessingContext.bindGroupLayoutEntryInfo[c][d.binding],A=null!==(i=f.nameInArrayOfTexture)&&void 0!==i?i:f.name;if(d.sampler)if(m=r.samplers[A]){var g=m.sampler;if(!g){this._engine.dbgSanityChecks&&WM.Error("Trying to bind a null sampler! entry=".concat(JSON.stringify(d),", name=").concat(A,", bindingInfo=").concat(JSON.stringify(m,(function(e,t){return"texture"===e?"<no dump>":t})),", materialContext.uniqueId=").concat(r.uniqueId),50);continue}h[p].resource=this._cacheSampler.getSampler(g,!1,m.hashCode)}else WM.Error('Sampler "'.concat(A,'" could not be bound. entry=').concat(JSON.stringify(d),", materialContext=").concat(JSON.stringify(r,(function(e,t){return"texture"===e||"sampler"===e?"<no dump>":t}))),50);else if(d.texture||d.storageTexture){if(m=r.textures[A]){if(this._engine.dbgSanityChecks&&null===m.texture){WM.Error("Trying to bind a null texture! entry=".concat(JSON.stringify(d),", bindingInfo=").concat(JSON.stringify(m,(function(e,t){return"texture"===e?"<no dump>":t})),", materialContext.uniqueId=").concat(r.uniqueId),50);continue}var _=m.texture._hardwareTexture;if(this._engine.dbgSanityChecks&&(!_||d.texture&&!_.view||d.storageTexture&&!_.viewForWriting)){WM.Error("Trying to bind a null gpu texture or view! entry=".concat(JSON.stringify(d),", name=").concat(A,", bindingInfo=").concat(JSON.stringify(m,(function(e,t){return"texture"===e?"<no dump>":t})),", isReady=").concat(null===(o=m.texture)||void 0===o?void 0:o.isReady,", materialContext.uniqueId=").concat(r.uniqueId),50);continue}h[p].resource=d.storageTexture?_.viewForWriting:d.texture.multisampled?_.msaaView:_.view}else WM.Error('Texture "'.concat(A,'" could not be bound. entry=').concat(JSON.stringify(d),", materialContext=").concat(JSON.stringify(r,(function(e,t){return"texture"===e||"sampler"===e?"<no dump>":t}))),50)}else if(d.externalTexture){var m;if(m=r.textures[A]){if(this._engine.dbgSanityChecks&&null===m.texture){WM.Error("Trying to bind a null external texture! entry=".concat(JSON.stringify(d),", name=").concat(A,", bindingInfo=").concat(JSON.stringify(m,(function(e,t){return"texture"===e?"<no dump>":t})),", materialContext.uniqueId=").concat(r.uniqueId),50);continue}var y=m.texture.underlyingResource;if(this._engine.dbgSanityChecks&&!y){WM.Error("Trying to bind a null gpu external texture! entry=".concat(JSON.stringify(d),", name=").concat(A,", bindingInfo=").concat(JSON.stringify(m,(function(e,t){return"texture"===e?"<no dump>":t})),", isReady=").concat(null===(s=m.texture)||void 0===s?void 0:s.isReady,", materialContext.uniqueId=").concat(r.uniqueId),50);continue}h[p].resource=this._device.importExternalTexture({source:y})}else WM.Error('Texture "'.concat(A,'" could not be bound. entry=').concat(JSON.stringify(d),", materialContext=").concat(JSON.stringify(r,(function(e,t){return"texture"===e||"sampler"===e?"<no dump>":t}))),50)}else if(d.buffer){var E=t.buffers[A];if(E){var x=E.underlyingResource;h[p].resource.buffer=x,h[p].resource.size=E.capacity}else WM.Error("Can't find buffer \"".concat(A,'". entry=').concat(JSON.stringify(d),", buffers=").concat(JSON.stringify(t.buffers),", drawContext.uniqueId=").concat(t.uniqueId),50)}}var C=u[c];a[c]=this._device.createBindGroup({layout:C,entries:h})}return n&&(n.bindGroups=a),a},AS.NumBindGroupsCreatedTotal=0,AS.NumBindGroupsCreatedLastFrame=0,AS.NumBindGroupsLookupLastFrame=0,AS.NumBindGroupsNoLookupLastFrame=0,AS._Cache=new fS,AS._NumBindGroupsCreatedCurrentFrame=0,AS._NumBindGroupsLookupCurrentFrame=0,AS._NumBindGroupsNoLookupCurrentFrame=0;Ew.ShadersStore.clearQuadVertexShader="uniform float depthValue;\nconst vec2 pos[4]={\nvec2(-1.0,1.0),\n    vec2(1.0,1.0),\nvec2(-1.0,-1.0),\n    vec2(1.0,-1.0)\n};\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n    #define CUSTOM_VERTEX_MAIN_BEGIN\n    gl_Position=vec4(pos[gl_VertexID],depthValue,1.0);\n    #define CUSTOM_VERTEX_MAIN_END\n}\n";function gS(e,t,r){this._bindGroups={},this._bundleCache={},this._keyTemp=[],this._device=e,this._engine=t,this._cacheRenderPipeline=new aS(this._device,r,!t._caps.textureFloatLinearFiltering),this._cacheRenderPipeline.setDepthTestEnabled(!1),this._cacheRenderPipeline.setStencilReadMask(255),this._effect=t.createEffect("clearQuad",[],["color","depthValue"])}function _S(e,t,r,n){this.x=Math.floor(e),this.y=Math.floor(t),this.w=Math.floor(r),this.h=Math.floor(n)}function mS(e,t,r,n){this.x=e,this.y=t,this.w=r,this.h=n}function yS(e){this.ref=e}function ES(e){this.color=e}function xS(){this.bundles=[]}function CS(e){this.numDrawCalls=0,this._device=e,this._list=new Array(10),this._listLength=0}function bS(e,t){this._enabled=!1,this._measureDurationState=0,this._device=e,this._bufferManager=t}function IS(e,t,r,n,i){void 0===i&&(i=!0),this._dstBuffers=[],this._device=r,this._bufferManager=n,this._count=e,this._canUseMultipleBuffers=i,this._querySet=r.createQuerySet({type:t,count:e}),this._queryBuffer=n.createRawBuffer(8*e,GM.BufferUsage.QueryResolve|GM.BufferUsage.CopySrc),i||this._dstBuffers.push(this._bufferManager.createRawBuffer(8*this._count,GM.BufferUsage.MapRead|GM.BufferUsage.CopyDst))}Ew.ShadersStore.clearQuadPixelShader="uniform vec4 color;\nvoid main() {\n\tgl_FragColor=color;\n}\n",gS.prototype.setDepthStencilFormat=function(e){this._depthTextureFormat=e,this._cacheRenderPipeline.setDepthStencilFormat(e)},gS.prototype.setColorFormat=function(e){this._cacheRenderPipeline.setColorFormat(e)},gS.prototype.setMRTAttachments=function(e,t,r){this._cacheRenderPipeline.setMRT(t,r),this._cacheRenderPipeline.setMRTAttachments(e)},gS.prototype.clear=function(e,t,r,n,i){var o,s,a;void 0===i&&(i=1);var u,c=null,l=!!this._engine._currentRenderTarget;if(e)a=e;else{var h=0;this._keyTemp.length=0;for(var p=0;p<this._cacheRenderPipeline.colorFormats.length;++p)this._keyTemp[h++]=JS[null!==(o=this._cacheRenderPipeline.colorFormats[p])&&void 0!==o?o:""];var d=JS[null!==(s=this._depthTextureFormat)&&void 0!==s?s:0];if(this._keyTemp[h]=(t?t.r+256*t.g+256*t.b*256+256*t.a*256*256:0)+(r?Math.pow(2,32):0)+(n?Math.pow(2,33):0)+(this._engine.useReverseDepthBuffer?Math.pow(2,34):0)+(l?Math.pow(2,35):0)+(i>1?Math.pow(2,36):0)+d*Math.pow(2,37),u=this._keyTemp.join("_"),c=this._bundleCache[u])return c;a=this._device.createRenderBundleEncoder({colorFormats:this._cacheRenderPipeline.colorFormats,depthStencilFormat:this._depthTextureFormat,sampleCount:i})}this._cacheRenderPipeline.setDepthWriteEnabled(!!r),this._cacheRenderPipeline.setStencilEnabled(!!n&&!!this._depthTextureFormat&&ZS.HasStencilAspect(this._depthTextureFormat)),this._cacheRenderPipeline.setStencilWriteMask(n?255:0),this._cacheRenderPipeline.setStencilCompare(cp.FRONT,n?cp.ALWAYS:cp.NEVER),this._cacheRenderPipeline.setStencilCompare(cp.BACK,n?cp.ALWAYS:cp.NEVER),this._cacheRenderPipeline.setStencilPassOp(cp.FRONT,n?cp.REPLACE:cp.KEEP),this._cacheRenderPipeline.setStencilPassOp(cp.BACK,n?cp.REPLACE:cp.KEEP),this._cacheRenderPipeline.setWriteMask(t?15:0);var f=this._cacheRenderPipeline.getRenderPipeline(cp.MATERIAL_TriangleStripDrawMode,this._effect,i),A=this._effect._pipelineContext;t&&this._effect.setDirectColor4("color",t),this._effect.setFloat("depthValue",this._engine.useReverseDepthBuffer?this._engine._clearReverseDepthValue:this._engine._clearDepthValue),A.uniformBuffer.update();var g=l?this._engine._ubInvertY:this._engine._ubDontInvertY,_=A.uniformBuffer.getBuffer(),m=_.uniqueId+"-"+g.uniqueId,y=this._bindGroups[m];if(!y){var E=A.bindGroupLayouts;(y=this._bindGroups[m]=[]).push(this._device.createBindGroup({layout:E[0],entries:[]})),Dw._SimplifiedKnownBindings||y.push(this._device.createBindGroup({layout:E[1],entries:[]})),y.push(this._device.createBindGroup({layout:E[Dw._SimplifiedKnownBindings?1:2],entries:[{binding:0,resource:{buffer:g.underlyingResource,size:g.capacity}},{binding:1,resource:{buffer:_.underlyingResource,size:_.capacity}}]}))}a.setPipeline(f);for(p=0;p<y.length;++p)a.setBindGroup(p,y[p]);return a.draw(4,1,0,0),e||(c=a.finish(),this._bundleCache[u]=c),c},_S.prototype.run=function(e){e.setViewport(this.x,this.y,this.w,this.h,0,1)},_S.prototype.clone=function(){return new _S(this.x,this.y,this.w,this.h)},mS.prototype.run=function(e){e.setScissorRect(this.x,this.y,this.w,this.h)},mS.prototype.clone=function(){return new mS(this.x,this.y,this.w,this.h)},yS.prototype.run=function(e){e.setStencilReference(this.ref)},yS.prototype.clone=function(){return new yS(this.ref)},ES.prototype.run=function(e){e.setBlendConstant(this.color)},ES.prototype.clone=function(){return new ES(this.color)},xS.prototype.run=function(e){e.executeBundles(this.bundles)},xS.prototype.clone=function(){var e=new xS;return e.bundles=this.bundles,e},CS.prototype.addBundle=function(e){if(!this._currentItemIsBundle){var t=new xS;this._list[this._listLength++]=t,this._currentBundleList=t.bundles,this._currentItemIsBundle=!0}e&&this._currentBundleList.push(e)},CS.prototype._finishBundle=function(){this._currentItemIsBundle&&this._bundleEncoder&&(this._currentBundleList.push(this._bundleEncoder.finish()),this._bundleEncoder=void 0,this._currentItemIsBundle=!1)},CS.prototype.addItem=function(e){this._finishBundle(),this._list[this._listLength++]=e,this._currentItemIsBundle=!1},CS.prototype.getBundleEncoder=function(e,t,r){return this._currentItemIsBundle||(this.addBundle(),this._bundleEncoder=this._device.createRenderBundleEncoder({colorFormats:e,depthStencilFormat:t,sampleCount:r})),this._bundleEncoder},CS.prototype.close=function(){this._finishBundle()},CS.prototype.run=function(e){this.close();for(var t=0;t<this._listLength;++t)this._list[t].run(e)},CS.prototype.reset=function(){this._listLength=0,this._currentItemIsBundle=!1,this.numDrawCalls=0},CS.prototype.clone=function(){this.close();var e=new CS(this._device);e._list=new Array(this._listLength),e._listLength=this._listLength,e.numDrawCalls=this.numDrawCalls;for(var t=0;t<this._listLength;++t)e._list[t]=this._list[t].clone();return e},Object.defineProperty(bS.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTimeCounter},enumerable:!1,configurable:!0}),Object.defineProperty(bS.prototype,"enable",{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._measureDurationState=0,e?this._measureDuration=new WebGPUDurationMeasure(this._device,this._bufferManager):this._measureDuration.dispose())},enumerable:!1,configurable:!0}),bS.prototype.startFrame=function(e){this._enabled&&0===this._measureDurationState&&(this._measureDuration.start(e),this._measureDurationState=1)},bS.prototype.endFrame=function(e){var t=this;1===this._measureDurationState&&(this._measureDurationState=2,this._measureDuration.stop(e).then((function(e){null!==e&&e>=0&&(t._gpuFrameTimeCounter.fetchNewFrame(),t._gpuFrameTimeCounter.addCount(e,!0)),t._measureDurationState=0})))},Object.defineProperty(IS.prototype,"querySet",{get:function(){return this._querySet},enumerable:!1,configurable:!0}),IS.prototype._getBuffer=function(e,t){if(!this._canUseMultipleBuffers&&0===this._dstBuffers.length)return null;var r,n=this._device.createCommandEncoder();return 0===this._dstBuffers.length?r=this._bufferManager.createRawBuffer(8*this._count,GM.BufferUsage.MapRead|GM.BufferUsage.CopyDst):(r=this._dstBuffers[this._dstBuffers.length-1],this._dstBuffers.length--),n.resolveQuerySet(this._querySet,e,t,this._queryBuffer,0),n.copyBufferToBuffer(this._queryBuffer,0,r,0,8*t),this._device.queue.submit([n.finish()]),r},IS.prototype.readValues=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=1),new Promise(((n,i)=>{var o;return null===(o=this._getBuffer(e,t))?i(null):o.mapAsync(GM.MapMode.Read).then((()=>{const e=new BigUint64Array(o.getMappedRange()).slice();o.unmap(),this._dstBuffers[this._dstBuffers.length]=o,n({data:e,frameId:r})}))}))},IS.prototype.readValue=function(e){return void 0===e&&(e=0),new Promise(((t,r)=>{const n=this._getBuffer(e,1);return null===n?t(null):n.mapAsync(GM.MapMode.Read).then((()=>{const e=new BigUint64Array(n.getMappedRange()),r=Number(e[0]);return n.unmap(),this._dstBuffers[this._dstBuffers.length]=n,t(r)}))}))},IS.prototype.readTwoValuesAndSubtract=async function(e){return void 0===e&&(e=0),new Promise(((t,r)=>{const n=this._getBuffer(e,2);return null===n?t(null):n.mapAsync(GM.MapMode.Read).then((()=>{const e=new BigUint64Array(n.getMappedRange()),r=Number(e[1]-e[0]);return n.unmap(),this._dstBuffers[this._dstBuffers.length]=n,t(r)}))}))},IS.prototype.dispose=function(){this._querySet.destroy(),this._bufferManager.releaseBuffer(this._queryBuffer);for(var e=0;e<this._dstBuffers.length;++e)this._bufferManager.releaseBuffer(this._dstBuffers[e])};var TS=0;function vS(e,t,r,n,i){void 0===n&&(n=4096),void 0===i&&(i=100),this._availableIndices=[],this._engine=e,this._device=t,this._bufferManager=r,this._frameLastBuffer=-1,this._lastBufferFrameID=-1,this._currentTotalIndices=0,this._countIncrement=i,this._allocateNewIndices(n)}function RS(e,t){void 0===t&&(t=20),this.debug=!1,this._sourceCode=e,this._numMaxIterations=t,this._functionDescr=[],this.inlineToken="#define inline"}function MS(){this._twgsl=null}function wS(e,t,r,n){this._record=!1,this._play=!1,this._mainPassBundleList=[],this._enabled=!1,this._engine=e,this._mode=t,this._bundleList=r,this._bundleListRenderTarget=n}Object.defineProperty(vS.prototype,"querySet",{get:function(){return this._querySet.querySet},enumerable:!1,configurable:!0}),Object.defineProperty(vS.prototype,"hasQueries",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(vS.prototype,"canBeginQuery",{get:function(){switch(this._engine._getCurrentRenderPassIndex()){case 0:return void 0!==this._engine._mainRenderPassWrapper.renderPassDescriptor.occlusionQuerySet;case 1:return void 0!==this._engine._rttRenderPassWrapper.renderPassDescriptor.occlusionQuerySet}return!1},enumerable:!1,configurable:!0}),vS.prototype.createQuery=function(){0===this._availableIndices.length&&this._allocateNewIndices();var e=this._availableIndices[TS];return TS--,e},vS.prototype.deleteQuery=function(e){TS++,this._availableIndices[TS]=e},vS.prototype.isQueryResultAvailable=function(e){return this._retrieveQueryBuffer(),!!this._lastBuffer&&e<this._lastBuffer.length},vS.prototype.getQueryResult=function(e){var t,r;return Number(null!==(r=null===(t=this._lastBuffer)||void 0===t?void 0:t[e])&&void 0!==r?r:-1)},vS.prototype.getQueryResultFrameID=function(){return this._lastBufferFrameID},vS.prototype._retrieveQueryBuffer=function(){var e=this;this._lastBuffer&&this._frameLastBuffer===this._engine.frameId||this._frameLastBuffer!==this._engine.frameId&&(this._frameLastBuffer=this._engine.frameId,this._querySet.readValues(0,this._currentTotalIndices,this._engine.frameId).then((function(t){e._lastBuffer=t.data,e._lastBufferFrameID=t.frameId})).catch((t=>{e._lastBuffer=null})))},vS.prototype._allocateNewIndices=function(e){e=null!=e?e:this._countIncrement,this._delayQuerySetDispose();for(var t=0;t<e;++t)this._availableIndices.push(this._currentTotalIndices+t);TS=this._availableIndices.length-1,this._currentTotalIndices+=e,this._querySet=new IS(this._currentTotalIndices,GM.QueryType.Occlusion,this._device,this._bufferManager,!1)},vS.prototype._delayQuerySetDispose=function(){var e=this._querySet;e&&setTimeout((function(){return e.dispose}),1e3)},vS.prototype.dispose=function(){var e;null===(e=this._querySet)||void 0===e||e.dispose(),this._availableIndices=[]},Object.defineProperty(RS.prototype,"code",{get:function(){return this._sourceCode},enumerable:!1,configurable:!0}),RS.prototype.processCode=function(){this.debug&&console.log("Start inlining process (code size=".concat(this._sourceCode.length,")...")),this._collectFunctions(),this._processInlining(this._numMaxIterations),this.debug&&console.log("End of inlining process.")},RS.prototype._collectFunctions=function(){for(var e=0;e<this._sourceCode.length;){var t=this._sourceCode.indexOf(this.inlineToken,e);if(t<0)break;var r=this._sourceCode.indexOf("(",t+this.inlineToken.length);if(r<0)this.debug&&console.warn("Could not find the opening parenthesis after the token. startIndex=".concat(e)),e=t+this.inlineToken.length;else{var n=RS._RegexpFindFunctionNameAndType.exec(this._sourceCode.substring(t+this.inlineToken.length,r));if(n){var i=[n[3],n[4]],o=i[0],s=i[1],a=Pw("(",")",this._sourceCode,r);if(a<0)this.debug&&console.warn("Could not extract the parameters the function '".concat(s,"' (type=").concat(o,"). funcParamsStartIndex=").concat(r)),e=t+this.inlineToken.length;else{var u=this._sourceCode.substring(r+1,a),c=Nw(this._sourceCode,a+1);if(c!==this._sourceCode.length){var l=Pw("{","}",this._sourceCode,c);if(l<0)this.debug&&console.warn("Could not extract the body of the function '".concat(s,"' (type=").concat(o,"). funcBodyStartIndex=").concat(c)),e=t+this.inlineToken.length;else{for(var h=this._sourceCode.substring(c,l+1),p=Uw(u).split(","),d=[],f=0;f<p.length;++f){var A=p[f].trim(),g=A.lastIndexOf(" ");g>=0&&d.push(A.substring(g+1))}"void"!==o&&d.push("return"),this._functionDescr.push({name:s,type:o,parameters:d,body:h,callIndex:0}),e=l+1;var _=t>0?this._sourceCode.substring(0,t):"",m=l+1<this._sourceCode.length-1?this._sourceCode.substring(l+1):"";this._sourceCode=_+m,e-=l+1-t}}else this.debug&&console.warn("Could not extract the body of the function '".concat(s,"' (type=").concat(o,"). funcParamsEndIndex=").concat(a)),e=t+this.inlineToken.length}}else this.debug&&console.warn("Could not extract the name/type of the function from: ".concat(this._sourceCode.substring(t+this.inlineToken.length,r))),e=t+this.inlineToken.length}}this.debug&&console.log("Collect functions: ".concat(this._functionDescr.length," functions found. functionDescr="),this._functionDescr)},RS.prototype._processInlining=function(e){for(void 0===e&&(e=20);e-- >=0&&this._replaceFunctionCallsByCode(););return this.debug&&console.log("numMaxIterations is ".concat(e," after inlining process")),e>=0},RS.prototype._replaceFunctionCallsByCode=function(){for(var e=!1,t=0,r=this._functionDescr;t<r.length;t++)for(var n=r[t],i=n.name,o=n.type,s=n.parameters,a=n.body,u=0;u<this._sourceCode.length;){var c=this._sourceCode.indexOf(i,u);if(c<0)break;if(0===c||Lw(this._sourceCode.charAt(c-1)))u=c+i.length;else{var l=Nw(this._sourceCode,c+i.length);if(l!==this._sourceCode.length&&"("===this._sourceCode.charAt(l)){var h=Pw("(",")",this._sourceCode,l);if(h<0)this.debug&&console.warn("Could not extract the parameters of the function call. Function '".concat(i,"' (type=").concat(o,"). callParamsStartIndex=").concat(l)),u=c+i.length;else{var p=this._sourceCode.substring(l+1,h),d=function(e){for(var t=[],r=0,n=0;r<e.length;){if("("===e.charAt(r)){var i=Pw("(",")",e,r);if(i<0)return null;r=i}else","===e.charAt(r)&&(t.push(e.substring(n,r)),n=r+1);r++}return n<r&&t.push(e.substring(n,r)),t}(Uw(p));if(null!==d){for(var f=[],A=0;A<d.length;++A){var g=d[A].trim();f.push(g)}var _="void"!==o?i+"_"+n.callIndex++:null;if(_&&f.push(_+" ="),f.length===s.length){u=h+1;var m=this._replaceNames(a,s,f),y=c>0?this._sourceCode.substring(0,c):"",E=h+1<this._sourceCode.length-1?this._sourceCode.substring(h+1):"";if(_){var x=Gw(this._sourceCode,c-1,"\n");y=this._sourceCode.substring(0,x+1);var C=this._sourceCode.substring(x+1,c);this._sourceCode=y+o+" "+_+";\n"+m+"\n"+C+_+E,this.debug&&console.log("Replace function call by code. Function '".concat(i,"' (type=").concat(o,"). injectDeclarationIndex=").concat(x,", call parameters=").concat(f))}else this._sourceCode=y+m+E,u+=m.length-(h+1-c),this.debug&&console.log("Replace function call by code. Function '".concat(i,"' (type=").concat(o,"). functionCallIndex=").concat(c,", call parameters=").concat(f));e=!0}else this.debug&&console.warn("Invalid function call: not the same number of parameters for the call than the number expected by the function. Function '".concat(i,"' (type=").concat(o,"). function parameters=").concat(s,", call parameters=").concat(f)),u=c+i.length}else this.debug&&console.warn("Invalid function call: can't extract the parameters of the function call. Function '".concat(i,"' (type=").concat(o,"). callParamsStartIndex=").concat(l,", callParams=")+p),u=c+i.length}}else u=c+i.length}}return e},RS.prototype._replaceNames=function(e,t,r){for(var n=function(n){var i=new RegExp(function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(t[n]),"g"),o=t[n].length,s=r[n];e=e.replace(i,(function(r){for(var i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];var u=i[0];return Lw(e.charAt(u-1))||Lw(e.charAt(u+o))?t[n]:s}))},i=0;i<t.length;++i)n(i);return e},RS._RegexpFindFunctionNameAndType=/((\s+?)(\w+)\s+(\w+)\s*?)$/,MS.prototype.initTwgsl=function(e){var t=ro((e=MS._TWgslDefaultOptions).jsPath),r=ro(e.wasmPath),n=this;return HM.LoadScriptAsync(t).then((function(){return self.twgsl(r)})).then((function(e){n._twgsl=e,Promise.resolve()}))},MS.prototype.convertSpirV2WGSL=function(e){var t=this._twgsl.convertSpirV2WGSL(e);return MS.ShowWGSLShaderCode&&(console.log(t),console.log("***********************************************")),t},MS._TWgslDefaultOptions={jsPath:"ThirdParty/twgsl.js",wasmPath:"ThirdParty/twgsl.wasm"},MS.ShowWGSLShaderCode=!1,Object.defineProperty(wS.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._mainPassBundleList.length=0,this._record=this._enabled=e,this._play=!1,e&&(this._modeSaved=this._mode,this._mode=Constants.SNAPSHOTRENDERING_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(wS.prototype,"play",{get:function(){return this._play},enumerable:!1,configurable:!0}),Object.defineProperty(wS.prototype,"record",{get:function(){return this._record},enumerable:!1,configurable:!0}),Object.defineProperty(wS.prototype,"mode",{get:function(){return this._mode},set:function(e){this._record?this._modeSaved=e:this._mode=e},enumerable:!1,configurable:!0}),wS.prototype.endMainRenderPass=function(){this._record&&this._mainPassBundleList.push(this._bundleList.clone())},wS.prototype.endRenderTargetPass=function(e,t){var r,n,i,o;if(this._play)null===(n=null===(r=t._bundleLists)||void 0===r?void 0:r[t._currentLayer])||void 0===n||n.run(e),this._mode===Constants.SNAPSHOTRENDERING_FAST&&this._engine._reportDrawCall(null===(o=null===(i=t._bundleLists)||void 0===i?void 0:i[t._currentLayer])||void 0===o?void 0:o.numDrawCalls);else{if(!this._record)return!1;t._bundleLists||(t._bundleLists=[]),t._bundleLists[t._currentLayer]=this._bundleListRenderTarget.clone(),t._bundleLists[t._currentLayer].run(e),this._bundleListRenderTarget.reset()}return!0},wS.prototype.endFrame=function(e){if(this._record&&(this._mainPassBundleList.push(this._bundleList.clone()),this._record=!1,this._play=!0,this._mode=this._modeSaved),null!==e&&this._play)for(var t=0;t<this._mainPassBundleList.length;++t)this._mainPassBundleList[t].run(e),this._mode===Constants.SNAPSHOTRENDERING_FAST&&this._engine._reportDrawCall(this._mainPassBundleList[t].numDrawCalls)},wS.prototype.reset=function(){this.enabled=!1,this.enabled=!0};var SS,BS=1,OS=2,DS=3;function FS(e){if(!jt(e.name))throw new Ht("options.name is required.");var t=Tn();this.dbname=e.name;var r=indexedDB.open(this.dbname),n=this;return r.onsuccess=function(e){n.db=e.target.result,n.version=n.db.version,jt(n.cachestatus)||(n.cachestatus={}),t.resolve(n)},r.onupgradeneeded=function(e){n.db=e.target.result,n.version=n.db.version,t.resolve(n)},r.onerror=function(e){n.db=null,t.reject("create database fail, error code : "+e.target.errorcode)},this.layer=e.layer||null,this.storageType=e.storageType||"arrayBuffer",this.creatingTable=!1,this.cachestatus={},t.promise}function PS(e,t){void 0===t&&(t={});var r,n,i,o,s=Rw.call(this,null);if((s=this)._uploadEncoderDescriptor={label:"upload"},s._renderEncoderDescriptor={label:"render"},s._renderTargetEncoderDescriptor={label:"renderTarget"},s._clearDepthValue=1,s._clearReverseDepthValue=0,s._clearStencilValue=0,s._defaultSampleCount=4,s._glslang=null,s._tintWASM=null,s._compiledComputeEffects={},s._counters={numEnableEffects:0,numEnableDrawWrapper:0,numBundleCreationNonCompatMode:0,numBundleReuseNonCompatMode:0},s.countersLastFrame={numEnableEffects:0,numEnableDrawWrapper:0,numBundleCreationNonCompatMode:0,numBundleReuseNonCompatMode:0},s.numMaxUncapturedErrors=20,s._commandBuffers=[null,null,null],s._currentRenderPass=null,s._mainRenderPassWrapper=new Jw,s._rttRenderPassWrapper=new Jw,s._pendingDebugCommands=[],s._onAfterUnbindFrameBufferObservable=new UR,s._currentOverrideVertexBuffers=null,s._currentIndexBuffer=null,s._colorWriteLocal=!0,s._forceEnableEffect=!1,s.dbgShowShaderCode=!1,s.dbgSanityChecks=!0,s.dbgVerboseLogsForFirstFrames=!1,s.dbgVerboseLogsNumFrames=10,s.dbgLogIfNotDrawWrapper=!0,s.dbgShowEmptyEnableEffectCalls=!0,s._viewportsCurrent=[{x:0,y:0,w:0,h:0},{x:0,y:0,w:0,h:0}],s._scissorsCurrent=[{x:0,y:0,w:0,h:0},{x:0,y:0,w:0,h:0}],s._scissorCached={x:0,y:0,z:0,w:0},s._stencilRefsCurrent=[-1,-1],s._blendColorsCurrent=[[null,null,null,null],[null,null,null,null]],s._name="WebGPU",s.isNDCHalfZRange=!0,s.hasOriginBottomLeft=!1,t.deviceDescriptor=t.deviceDescriptor||{},t.swapChainFormat=t.swapChainFormat||GM.TextureFormat.BGRA8Unorm,t.antialiasing=void 0===t.antialiasing||t.antialiasing,t.stencil=null===(r=t.stencil)||void 0===r||r,t.enableGPUDebugMarkers=null!==(n=t.enableGPUDebugMarkers)&&void 0!==n&&n,!navigator.gpu)return console.log("WebGPU is not supported by your browser."),s;s._isWebGPU=!0,s._shaderPlatformName="WEBGPU",void 0===t.deterministicLockstep&&(t.deterministicLockstep=!1),void 0===t.lockstepMaxSteps&&(t.lockstepMaxSteps=4),void 0===t.audioEngine&&(t.audioEngine=!0),s._deterministicLockstep=t.deterministicLockstep,s._lockstepMaxSteps=t.lockstepMaxSteps,s._timeStep=t.timeStep||1/60,s._doNotHandleContextLost=!!t.doNotHandleContextLost,s._canvas=e,s._options=t,s.premultipliedAlpha=null===(i=t.premultipliedAlpha)||void 0===i||i;var a=window.devicePixelRatio||1,u=t.limitDeviceRatio||a,c=null!==(o=t.adaptToDeviceRatio)&&void 0!==o&&o;s._hardwareScalingLevel=c?1/Math.min(u,a):1,s._mainPassSampleCount=t.antialiasing?s._defaultSampleCount:1,s._isStencilEnable=t.stencil,s._shaderProcessor=new Fw,s._shaderProcessorWGSL=new Kw;var l=s;return s.saveCompiledShaderInIndexDB=!0,new FS({name:PS.COMPILED_WGSL_STORE_NAME}).then((function(e){e.checkObjectStoreExit(PS.COMPILED_WGSL_TABLE_NAME)?l._indexedDBScheduler=e:e.createObjectStore(PS.COMPILED_WGSL_TABLE_NAME).then((function(){l._indexedDBScheduler=e})).catch((function(e){}))})),s}FS.prototype.checkObjectStoreExit=function(e){return!!jt(this.db)&&this.db.objectStoreNames.contains(e)},FS.prototype.createObjectStore=function(e){var t=Tn();if(this.creatingTable)t.reject(!1);else{if(this.db.objectStoreNames.contains(e))return t.reject(!1),t.promise;this.creatingTable=!0;var r=this,n=parseInt(r.db.version);r.db.close();var i=indexedDB.open(r.dbname,n+1);i.onupgradeneeded=function(n){var i=n.target.result;r.db=i;var o=i.createObjectStore(e,{keyPath:"id"});jt(o)?(o.createIndex("value","value",{unique:!1}),r.creatingTable=!1,jt(r.cachestatus)||(r.cachestatus={}),r.cachestatus[e]={},r.db.close(),indexedDB.open(r.dbname).onsuccess=function(e){var n=e.target.result;r.db=n,t.resolve(!0)}):(r.creatingTable=!1,t.reject(!1))},i.onsuccess=function(e){e.target.result.close(),t.resolve(!0)},i.onerror=function(e){r.creatingTable=!1,t.reject(!1)}}return t.promise},FS.prototype.putElementInDB=function(e,t,r,n){var i,o=Tn();if(!jt(this.db))return o.reject(!1),o.promise;var s=this;if(jt(s.cachestatus[e])&&!jt(n)&&jt(s.cachestatus[e][t])&&(s.cachestatus[e][t]===BS||s.cachestatus[e][t]===OS))return o.resolve(!1),o.promise;if(this.db.objectStoreNames.contains(e)){var a;jt(s.cachestatus[e])||(s.cachestatus[e]={});try{a=this.db.transaction([e],"readwrite")}catch(e){return o.reject(null),o.promise}if(i=a.objectStore(e),jt(n))if(n instanceof Array){for(var u=0,c=n.length;u<c;u++)s.cachestatus[e][n[u].key]!==OS&&(i.add({id:n[u].key,value:n[u].value}),s.cachestatus[e][n[u].key]=OS);o.resolve(!0)}else{for(var t in n)isNaN(1*t)||i.add({id:t,value:n[t]});o.resolve(!0)}else{if(!jt(t)||!jt(r))return;if(t instanceof Array&&r instanceof Array){for(u=0,c=t.length;u<c;u++)s.cachestatus[e][t[u]]!==OS&&(i.add({id:t[u],value:r[u]}),s.cachestatus[e][t[u]]=OS);a.oncomplete=function(e){o.resolve(!0)},a.onerror=function(e){o.reject(!1)}}else{var l=i.put({id:t,value:r});s.cachestatus[e][t]=BS,l.onsuccess=function(r){s.cachestatus[e][t]=OS,o.resolve(!0)},l.onerror=function(r){s.cachestatus[e][t]=DS,o.reject(!1)}}}}else this.createObjectStore(e).then((function(a){var u=s.db.transaction([e],"readwrite");if(i=u.objectStore(e),jt(n)){for(var c=0,l=n.length;c<l;c++)i.add({id:n[c].key,value:n[c].value});o.resolve(!0)}else{var h=i.add({id:t,value:r});h.onsuccess=function(e){o.resolve(!0)},h.onerror=function(e){o.reject(!1)}}}),(function(e){o.reject(!1)}));return o.promise},FS.prototype.getRangeFromDB=function(e,t){var r,n,i=Tn();if(!jt(this.db))return null;if(!this.db.objectStoreNames.contains(e))return null;try{r=this.db.transaction([e])}catch(e){return i.reject(null),i.promise}try{n=r.objectStore(e)}catch(e){i.reject(null)}var o=n.openCursor(IDBKeyRange.bound(t[0],t[1])),s=[];return o.onsuccess=function(e){var t=e.target.result;jt(t)?(s.push(t.value),t.continue()):i.resolve(s)},o.onerror=function(e){i.reject(null)},i.promise},FS.prototype.getElementFromDB=function(e,t){var r,n,i=Tn();if(!jt(this.db))return null;if(!this.db.objectStoreNames.contains(e))return null;try{r=this.db.transaction([e])}catch(e){return i.reject(null),i.promise}try{n=r.objectStore(e)}catch(e){i.reject(null)}var o=n.get(t);return o.onsuccess=function(e){jt(e.target.result)?i.resolve(e.target.result.value):i.reject(null)},o.onerror=function(e){i.reject(null)},i.promise},FS.prototype.getAllElementFromDB=function(e){var t,r,n=Tn();if(!jt(this.db))return null;if(!this.db.objectStoreNames.contains(e))return null;if(null!=this.transaction)t=this.transaction;else try{t=this.db.transaction([e])}catch(e){return n.reject(null),n.promise}try{r=t.objectStore(e)}catch(e){n.reject(null)}var i=r.getAll();return i.onsuccess=function(e){jt(e.target.result)?n.resolve(e.target.result):n.reject(null)},i.onerror=function(e){n.reject(null)},n.promise},FS.prototype.updateElementInDB=function(e,t,r,n){var i=Tn();if(!jt(this.db))return i.resolve(!1),i.promise;if(!this.db.objectStoreNames.contains(e))return i.resolve(!1),i.promise;var o,s=this.db.transaction([e],"readwrite");try{o=s.objectStore(e)}catch(e){i.resolve(!1)}var a=o.get(t);return a.onsuccess=function(e){var s=e.target.result;jt(s)||(s={id:t}),s.value=!0===n?Object.assign(s.value,r):r;var a=o.put(s);a.onsuccess=function(e){i.resolve(!0)},a.onerror=function(e){i.resolve(!1)}},a.onerror=function(e){i.resolve(!1)},i.promise},FS.prototype.removeElementFromDB=function(e,t){var r=Tn();if(!jt(this.db))return r.resolve(!1),r.promise;if(!this.db.objectStoreNames.contains(e))return r.resolve(!1),r.promise;var n,i=this.db.transaction([e],"readwrite");try{n=i.objectStore(e)}catch(e){r.resolve(!1)}var o=n.delete(t);return o.onerror=function(e){r.resolve(!1)},o.onsuccess=function(e){r.resolve(!0)},r.promise},FS.prototype.clear=function(e){var t=Tn();if(!jt(this.db))return t.resolve(!1),t.promise;if(!this.db.objectStoreNames.contains(e))return t.resolve(!1),t.promise;var r,n=this.db.transaction([e],"readwrite");try{r=n.objectStore(e)}catch(e){t.resolve(!1)}var i=r.clear();return i.onerror=function(e){t.resolve(!1)},i.onsuccess=function(e){t.resolve(!0)},t.promise},Rw&&(PS.__proto__=Rw),PS.prototype=Object.create(Rw&&Rw.prototype),PS.prototype.constructor=Rw,Object.defineProperties(PS.prototype,{snapshotRenderingMode:{get:function(){return this._snapshotRendering.mode},set:function(e){this._snapshotRendering.mode=e}},snapshotRendering:{get:function(){return this._snapshotRendering.enabled},set:function(e){this._snapshotRendering.enabled=e}},disableCacheSamplers:{get:function(){return!!this._cacheSampler&&this._cacheSampler.disabled},set:function(e){this._cacheSampler&&(this._cacheSampler.disabled=e)}},disableCacheRenderPipelines:{get:function(){return!!this._cacheRenderPipeline&&this._cacheRenderPipeline.disabled},set:function(e){this._cacheRenderPipeline&&(this._cacheRenderPipeline.disabled=e)}},disableCacheBindGroups:{get:function(){return!!this._cacheBindGroups&&this._cacheBindGroups.disabled},set:function(e){this._cacheBindGroups&&(this._cacheBindGroups.disabled=e)}},IsSupportedAsync:{get:function(){return navigator.gpu?navigator.gpu.requestAdapter().then((function(e){return!!e}),(function(){return!1})).catch((function(){return!1})):Promise.resolve(!1)}},IsSupported:{get:function(){return console.log("You must call IsSupportedAsync for WebGPU!"),!1}},supportsUniformBuffers:{get:function(){return!0}},supportedExtensions:{get:function(){return this._adapterSupportedExtensions}},enabledExtensions:{get:function(){return this._deviceEnabledExtensions}},description:{get:function(){return this.name+this.version}},version:{get:function(){return 1}},compatibilityMode:{get:function(){return this._compatibilityMode},set:function(e){this._compatibilityMode=e}},currentSampleCount:{get:function(){return this._currentRenderTarget?this._currentRenderTarget.samples:this._mainPassSampleCount}},caps:{get:function(){return this._caps}}}),PS.prototype.snapshotRenderingReset=function(){this._snapshotRendering.reset()},PS.prototype.getInfo=function(){return{vendor:"unknown vendor",renderer:"unknown renderer",version:"unknown version"}},PS.CreateAsync=function(e,t){void 0===t&&(t={});var r=new PS(e,t);return new Promise((function(e){r.initAsync(t.glslangOptions,t.twgslOptions).then((function(){return e(r)}))}))},PS.prototype.initAsync=function(e,t){var r,n=this;return this._initGlslang(null!=e?e:null===(r=this._options)||void 0===r?void 0:r.glslangOptions).then((function(e){var r;return n._glslang=e,n._tintWASM=PS.UseTWGSL?new MS:null,n._tintWASM?n._tintWASM.initTwgsl(null!=t?t:null===(r=n._options)||void 0===r?void 0:r.twgslOptions).then((function(){return navigator.gpu.requestAdapter(n._options)}),(function(e){throw console.log("Can not initialize twgsl!"),Error("WebGPU initializations stopped.")})):navigator.gpu.requestAdapter(n._options)}),(function(e){throw console.log("Can not initialize glslang!"),Error("WebGPU initializations stopped.")})).then((function(e){if(e){n._adapter=e,n._adapterSupportedExtensions=[],n._adapter.features.forEach((function(e){return n._adapterSupportedExtensions.push(e)}));var t=n._options.deviceDescriptor;if(null==t?void 0:t.requiredFeatures){for(var r=[],i=0,o=t.requiredFeatures;i<o.length;i++){var s=o[i];-1!==n._adapterSupportedExtensions.indexOf(s)&&r.push(s)}t.requiredFeatures=r}return n._adapter.requestDevice(n._options.deviceDescriptor)}throw"Could not retrieve a WebGPU adapter (adapter is null)."})).then((function(e){var t,r;n._device=e,n._deviceEnabledExtensions=[],null===(t=n._device.features)||void 0===t||t.forEach((function(e){return n._deviceEnabledExtensions.push(e)}));var i=-1;n._device.addEventListener("uncapturederror",(function(e){++i<n.numMaxUncapturedErrors?WM.Warn("WebGPU uncaptured error (".concat(i+1,"): ").concat(e.error," - ").concat(e.error.message)):i++===n.numMaxUncapturedErrors&&WM.Warn("WebGPU uncaptured error: too many warnings (".concat(n.numMaxUncapturedErrors,"), no more warnings will be reported to the console for this engine."))})),n._doNotHandleContextLost||null===(r=n._device.lost)||void 0===r||r.then((function(e){n._contextWasLost=!0,WM.Warn("WebGPU context lost. "+e),n.onContextLostObservable.notifyObservers(n),n._restoreEngineAfterContextLost(n.initAsync.bind(n))}))}),(function(e){console.log("Could not retrieve a WebGPU device.")})).then((function(){n._bufferManager=new nw(n._device),n._textureHelper=new ZS(n._device,n._glslang,n._tintWASM,n._bufferManager,n),n._cacheSampler=new rS(n._device),n._cacheBindGroups=new AS(n._device,n._cacheSampler,n),n._timestampQuery=new bS(n._device,n._bufferManager),n._occlusionQuery=n._device.createQuerySet?new vS(n,n._device,n._bufferManager):void 0,n._bundleList=new CS(n._device),n._bundleListRenderTarget=new CS(n._device),n._snapshotRendering=new wS(n,n._snapshotRenderingMode,n._bundleList,n._bundleListRenderTarget),n._ubInvertY=n._bufferManager.createBuffer(new Float32Array([-1,0]),GM.BufferUsage.Uniform|GM.BufferUsage.CopyDst),n._ubDontInvertY=n._bufferManager.createBuffer(new Float32Array([1,0]),GM.BufferUsage.Uniform|GM.BufferUsage.CopyDst),n.dbgVerboseLogsForFirstFrames&&void 0===n._count&&(n._count=0,console.log("%c frame #"+n._count+" - begin","background: #ffff00")),n._uploadEncoder=n._device.createCommandEncoder(n._uploadEncoderDescriptor),n._renderEncoder=n._device.createCommandEncoder(n._renderEncoderDescriptor),n._renderTargetEncoder=n._device.createCommandEncoder(n._renderTargetEncoderDescriptor),n._emptyVertexBuffer=new pp(n,[0],"",!1,!1,1,!1,0,1),n._initializeLimits(),n._cacheRenderPipeline=new aS(n._device,n._emptyVertexBuffer,!n._caps.textureFloatLinearFiltering),n._depthCullingState=new cS(n._cacheRenderPipeline),n._stencilStateComposer=new uS(n._cacheRenderPipeline),n._stencilStateComposer.stencilGlobal=n._stencilState,n._depthCullingState.depthTest=!0,n._depthCullingState.depthFunc=cp.LEQUAL,n._depthCullingState.depthMask=!0,n._textureHelper.setCommandEncoder(n._uploadEncoder),n._clearQuad=new gS(n._device,n,n._emptyVertexBuffer),n._defaultDrawContext=n.createDrawContext(),n._currentDrawContext=n._defaultDrawContext,n._defaultMaterialContext=n.createMaterialContext(),n._currentMaterialContext=n._defaultMaterialContext,n._initializeContextAndSwapChain(),n._initializeMainAttachments(!0)})).catch((function(e){console.log("Can not create WebGPU Device and/or context."),console.trace&&console.trace()}))},PS.prototype._initGlslang=function(e){if(e=e||{},(e=In(PS._GLSLslangDefaultOptions,e)).glslang)return Promise.resolve(e.glslang);if(self.glslang)return self.glslang(e.wasmPath);if(e.jsPath&&e.wasmPath){var t=ro(e.jsPath),r=ro(e.wasmPath);return"undefined"!=typeof window?HM.LoadScriptAsync(t).then((function(){return self.glslang(r)})):(importScripts(t),self.glslang(r))}return Promise.reject("gslang is not available.")},PS.prototype._initializeLimits=function(){var e=this._adapter;this._caps={maxTexturesImageUnits:e.maxSampledTexturesPerShaderStage,maxVertexTextureImageUnits:e.maxSampledTexturesPerShaderStage,maxCombinedTexturesImageUnits:32,maxTextureSize:e.maxTextureDimension2D,maxCubemapTextureSize:e.maxTextureDimension3D,maxRenderTextureSize:e.maxTextureDimension2D,maxVertexAttribs:e.maxVertexAttributes,maxVaryingVectors:15,maxFragmentUniformVectors:1024,maxVertexUniformVectors:1024,standardDerivatives:!0,astc:this._deviceEnabledExtensions.indexOf(GM.FeatureName.TextureCompressionASTC)>=0||void 0,s3tc:this._deviceEnabledExtensions.indexOf(GM.FeatureName.TextureCompressionBC)>=0||void 0,pvrtc:null,etc1:null,etc2:this._deviceEnabledExtensions.indexOf(GM.FeatureName.TextureCompressionETC2)>=0||void 0,bptc:this._deviceEnabledExtensions.indexOf(GM.FeatureName.TextureCompressionBC)>=0||void 0,maxAnisotropy:4,uintIndices:!0,fragmentDepthSupported:!0,highPrecisionShaderSupported:!0,colorBufferFloat:!0,textureFloat:!0,textureFloatLinearFiltering:!1,textureFloatRender:!0,textureHalfFloat:!0,textureHalfFloatLinearFiltering:!0,textureHalfFloatRender:!0,textureLOD:!0,drawBuffersExtension:!0,depthTextureExtension:!0,vertexArrayObject:!1,instancedArrays:!0,timerQuery:"undefined"!=typeof BigUint64Array&&-1!==this.enabledExtensions.indexOf(GM.FeatureName.TimestampQuery)||void 0,supportOcclusionQuery:"undefined"!=typeof BigUint64Array,canUseTimestampForTimerQuery:!0,multiview:!1,oculusMultiview:!1,parallelShaderCompile:void 0,blendMinMax:!0,maxMSAASamples:4,canUseGLInstanceID:!0,canUseGLVertexID:!0,supportComputeShaders:!0,supportSRGBBuffers:!0,supportTransformFeedbacks:!1,textureMaxLevel:!0,texture2DArrayMaxLayerCount:e.maxTextureArrayLayers,minUniformBufferOffsetAlignment:e.minUniformBufferOffsetAlignment,maxUniformBufferBindingSize:e.maxUniformBufferBindingSize},this._caps.parallelShaderCompile=null,this._features={forceBitmapOverHTMLImageElement:!0,supportRenderAndCopyToLodForFloatTextures:!0,supportDepthStencilTexture:!0,supportShadowSamplers:!0,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:!0,trackUbosInFrame:!0,checkUbosContentBeforeUpload:!0,supportCSM:!0,basisNeedsPOT:!1,support3DTextures:!0,needTypeSuffixInShaderConstants:!0,supportMSAA:!0,supportSSAO2:!0,supportExtendedTextureFormats:!0,supportSwitchCaseInShader:!0,supportSyncTextureRead:!1,needsInvertingBitmap:!1,useUBOBindingCache:!1,needShaderCodeInlining:!0,needToAlwaysBindUniformBuffers:!0,supportRenderPasses:!0,_collectUbosUpdatedInFrame:!1}},PS.prototype._initializeContextAndSwapChain=function(){this._context=this._canvas.getContext("webgpu"),this._configureContext(),this._colorFormat=this._options.swapChainFormat,this._mainRenderPassWrapper.colorAttachmentGPUTextures=[new iw],this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].format=this._colorFormat},PS.prototype._initializeMainAttachments=function(e){var t;void 0===e&&(e=!1),this._mainTextureExtends={width:this.getRenderWidth(e),height:this.getRenderHeight(e),depthOrArrayLayers:1};var r,n=new Float32Array([this.getRenderHeight()]);if(this._bufferManager.setSubData(this._ubInvertY,4,n),this._bufferManager.setSubData(this._ubDontInvertY,4,n),this._options.antialiasing){var i={size:this._mainTextureExtends,mipLevelCount:1,sampleCount:this._mainPassSampleCount,dimension:GM.TextureDimension.E2d,format:this._options.swapChainFormat,usage:GM.TextureUsage.RenderAttachment};null===(t=this._mainTexture)||void 0===t||t.destroy(),this._mainTexture=this._device.createTexture(i),r=[{view:this._mainTexture.createView(),clearValue:new Tp(0,0,0,1),loadOp:GM.LoadOp.Clear,storeOp:GM.StoreOp.Store}]}else r=[{view:void 0,clearValue:new Tp(0,0,0,1),loadOp:GM.LoadOp.Clear,storeOp:GM.StoreOp.Store}];this._mainRenderPassWrapper.depthTextureFormat=this.isStencilEnable?GM.TextureFormat.Depth24PlusStencil8:GM.TextureFormat.Depth32Float,this._setDepthTextureFormat(this._mainRenderPassWrapper);var o={size:this._mainTextureExtends,mipLevelCount:1,sampleCount:this._mainPassSampleCount,dimension:GM.TextureDimension.E2d,format:this._mainRenderPassWrapper.depthTextureFormat,usage:GM.TextureUsage.RenderAttachment};this._depthTexture&&this._depthTexture.destroy(),this._depthTexture=this._device.createTexture(o);var s={view:this._depthTexture.createView(),depthClearValue:this._clearDepthValue,depthLoadOp:GM.LoadOp.Clear,depthStoreOp:GM.StoreOp.Store,stencilClearValue:this._clearStencilValue,stencilLoadOp:this.isStencilEnable?GM.LoadOp.Clear:void 0,stencilStoreOp:this.isStencilEnable?GM.StoreOp.Store:void 0};this._mainRenderPassWrapper.renderPassDescriptor={colorAttachments:r,depthStencilAttachment:s},null!==this._mainRenderPassWrapper.renderPass&&this._endMainRenderPass()},PS.prototype._configureContext=function(){this._context.configure({device:this._device,format:this._options.swapChainFormat,usage:GM.TextureUsage.RenderAttachment|GM.TextureUsage.CopySrc,alphaMode:this.premultipliedAlpha?GM.CanvasCompositingAlphaMode.Premultiplied:GM.CanvasCompositingAlphaMode.Opaque})},PS.prototype.setSize=function(e,t,r){return void 0===r&&(r=!1),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - setSize called -",e,t)),this._initializeMainAttachments(r),this.snapshotRendering&&this.snapshotRenderingReset(),!0},PS.prototype._getShaderProcessor=function(e){return e===Aw.WGSL?this._shaderProcessorWGSL:this._shaderProcessor},PS.prototype._getShaderProcessingContext=function(e){return new Dw(e)},PS.prototype.applyStates=function(){this._stencilStateComposer.apply(),this._cacheRenderPipeline.setAlphaBlendEnabled(this._alphaState.alphaBlend)},PS.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._forceEnableEffect=!0,this._currentIndexBuffer=null,this._currentOverrideVertexBuffers=null,this._cacheRenderPipeline.setBuffers(null,null,null),e&&(this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=cp.LEQUAL,this._alphaState.reset(),this._alphaMode=cp.ALPHA_ADD,this._alphaEquation=cp.ALPHA_DISABLE,this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters,this._alphaState._blendEquationParameters),this._cacheRenderPipeline.setAlphaBlendEnabled(!1),this.setColorWrite(!0)),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},PS.prototype.setColorWrite=function(e){this._colorWriteLocal=e,this._cacheRenderPipeline.setWriteMask(e?15:0)},PS.prototype.getColorWrite=function(){return this._colorWriteLocal},PS.prototype._resetCurrentViewport=function(e){this._viewportsCurrent[e].x=0,this._viewportsCurrent[e].y=0,this._viewportsCurrent[e].w=0,this._viewportsCurrent[e].h=0,1===e&&(this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0)},PS.prototype._mustUpdateViewport=function(e){var t=e===this._mainRenderPassWrapper.renderPass?0:1,r=this._viewportCached.x,n=this._viewportCached.y,i=this._viewportCached.z,o=this._viewportCached.w,s=this._viewportsCurrent[t].x!==r||this._viewportsCurrent[t].y!==n||this._viewportsCurrent[t].w!==i||this._viewportsCurrent[t].h!==o;return s&&(this._viewportsCurrent[t].x=this._viewportCached.x,this._viewportsCurrent[t].y=this._viewportCached.y,this._viewportsCurrent[t].w=this._viewportCached.z,this._viewportsCurrent[t].h=this._viewportCached.w),s},PS.prototype._applyViewport=function(e){var t=Math.floor(this._viewportCached.y),r=Math.floor(this._viewportCached.w);this._currentRenderTarget||(t=this.getRenderHeight()-t-r),e.setViewport(Math.floor(this._viewportCached.x),t,Math.floor(this._viewportCached.z),r,0,1),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - viewport applied - (",this._viewportCached.x,this._viewportCached.y,this._viewportCached.z,this._viewportCached.w,") current pass is main pass="+(e===this._mainRenderPassWrapper.renderPass)))},PS.prototype._viewport=function(e,t,r,n){this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=n},PS.prototype._resetCurrentScissor=function(e){this._scissorsCurrent[e].x=0,this._scissorsCurrent[e].y=0,this._scissorsCurrent[e].w=0,this._scissorsCurrent[e].h=0},PS.prototype._mustUpdateScissor=function(e){var t=e===this._mainRenderPassWrapper.renderPass?0:1,r=this._scissorCached.x,n=this._scissorCached.y,i=this._scissorCached.z,o=this._scissorCached.w,s=this._scissorsCurrent[t].x!==r||this._scissorsCurrent[t].y!==n||this._scissorsCurrent[t].w!==i||this._scissorsCurrent[t].h!==o;return s&&(this._scissorsCurrent[t].x=this._scissorCached.x,this._scissorsCurrent[t].y=this._scissorCached.y,this._scissorsCurrent[t].w=this._scissorCached.z,this._scissorsCurrent[t].h=this._scissorCached.w),s},PS.prototype._applyScissor=function(e){e.setScissorRect(this._scissorCached.x,this._currentRenderTarget?this._scissorCached.y:this.getRenderHeight()-this._scissorCached.w-this._scissorCached.y,this._scissorCached.z,this._scissorCached.w),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - scissor applied - (",this._scissorCached.x,this._scissorCached.y,this._scissorCached.z,this._scissorCached.w,") current pass is main pass="+(e===this._mainRenderPassWrapper.renderPass)))},PS.prototype._scissorIsActive=function(){return 0!==this._scissorCached.x||0!==this._scissorCached.y||0!==this._scissorCached.z||0!==this._scissorCached.w},PS.prototype.enableScissor=function(e,t,r,n){this._scissorCached.x=e,this._scissorCached.y=t,this._scissorCached.z=r,this._scissorCached.w=n},PS.prototype.disableScissor=function(){this._scissorCached.x=0,this._scissorCached.y=0,this._scissorCached.z=0,this._scissorCached.w=0,this._resetCurrentScissor(0),this._resetCurrentScissor(1)},PS.prototype._resetCurrentStencilRef=function(e){this._stencilRefsCurrent[e]=-1},PS.prototype._mustUpdateStencilRef=function(e){var t=e===this._mainRenderPassWrapper.renderPass?0:1,r=this._stencilStateComposer.funcRef!==this._stencilRefsCurrent[t];return r&&(this._stencilRefsCurrent[t]=this._stencilStateComposer.funcRef),r},PS.prototype._applyStencilRef=function(e){var t;e.setStencilReference(null!==(t=this._stencilStateComposer.funcRef)&&void 0!==t?t:0)},PS.prototype._resetCurrentColorBlend=function(e){this._blendColorsCurrent[e][0]=this._blendColorsCurrent[e][1]=this._blendColorsCurrent[e][2]=this._blendColorsCurrent[e][3]=null},PS.prototype._mustUpdateBlendColor=function(e){var t=e===this._mainRenderPassWrapper.renderPass?0:1,r=this._alphaState._blendConstants,n=r[0]!==this._blendColorsCurrent[t][0]||r[1]!==this._blendColorsCurrent[t][1]||r[2]!==this._blendColorsCurrent[t][2]||r[3]!==this._blendColorsCurrent[t][3];return n&&(this._blendColorsCurrent[t][0]=r[0],this._blendColorsCurrent[t][1]=r[1],this._blendColorsCurrent[t][2]=r[2],this._blendColorsCurrent[t][3]=r[3]),n},PS.prototype._applyBlendColor=function(e){e.setBlendConstant(this._alphaState._blendConstants)},PS.prototype.clear=function(e,t,r,n){void 0===n&&(n=!1),e&&void 0===e.a&&(e.a=1);var i=this._scissorIsActive();this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - clear called - backBuffer=",t," depth=",r," stencil=",n," scissor is active=",i)),this._currentRenderTarget?i?(this._rttRenderPassWrapper.renderPass||this._startRenderTargetRenderPass(this._currentRenderTarget,!1,t?e:null,r,n),this.compatibilityMode?this._applyScissor(this._currentRenderPass):this._bundleListRenderTarget.addItem(new mS(this._scissorCached.x,this._scissorCached.y,this._scissorCached.z,this._scissorCached.w)),this._clearFullQuad(t?e:null,r,n)):(this._currentRenderPass&&this._endRenderTargetRenderPass(),this._startRenderTargetRenderPass(this._currentRenderTarget,!0,t?e:null,r,n)):(this._mainRenderPassWrapper.renderPass&&i||this._startMainRenderPass(!i,t?e:null,r,n),i&&(this.compatibilityMode?this._applyScissor(this._currentRenderPass):this._bundleList.addItem(new mS(this._scissorCached.x,this._scissorCached.y,this._scissorCached.z,this._scissorCached.w)),this._clearFullQuad(t?e:null,r,n)))},PS.prototype._clearFullQuad=function(e,t,r){var n,i,o,s=this.compatibilityMode?this._getCurrentRenderPass():null,a=0===this._getCurrentRenderPassIndex()?this._bundleList:this._bundleListRenderTarget;this._clearQuad.setColorFormat(this._colorFormat),this._clearQuad.setDepthStencilFormat(this._depthTextureFormat),this._clearQuad.setMRTAttachments(null!==(n=this._cacheRenderPipeline.mrtAttachments)&&void 0!==n?n:[],null!==(i=this._cacheRenderPipeline.mrtTextureArray)&&void 0!==i?i:[],this._cacheRenderPipeline.mrtTextureCount),this.compatibilityMode?s.setStencilReference(this._clearStencilValue):a.addItem(new yS(this._clearStencilValue));var u=this._clearQuad.clear(s,e,t,r,this.currentSampleCount);this.compatibilityMode?this._applyStencilRef(s):(a.addBundle(u),a.addItem(new yS(null!==(o=this._stencilStateComposer.funcRef)&&void 0!==o?o:0)),this._reportDrawCall())},PS.prototype.createVertexBuffer=function(e){var t;return t=e instanceof Array?new Float32Array(e):e instanceof ArrayBuffer?new Uint8Array(e):e,this._bufferManager.createBufferByMap(t,GM.BufferUsage.Vertex|GM.BufferUsage.CopyDst)},PS.prototype.createDynamicVertexBuffer=function(e){return this.createVertexBuffer(e)},PS.prototype.createIndexBuffer=function(e){var t,r=!0;e instanceof Uint32Array||e instanceof Int32Array?t=e:e instanceof Uint16Array?(t=e,r=!1):e.length>65535?t=new Uint32Array(e):(t=new Uint16Array(e),r=!1);var n=this._bufferManager.createBufferByMap(t,GM.BufferUsage.Index|GM.BufferUsage.CopyDst);return n.is32Bits=r,n},PS.prototype._createBuffer=function(e,t){var r;r=e instanceof Array?new Float32Array(e):e instanceof ArrayBuffer?new Uint8Array(e):e;var n=0;return t&cp.BUFFER_CREATIONFLAG_READ&&(n|=GM.BufferUsage.CopySrc),t&cp.BUFFER_CREATIONFLAG_WRITE&&(n|=GM.BufferUsage.CopyDst),t&cp.BUFFER_CREATIONFLAG_UNIFORM&&(n|=GM.BufferUsage.Uniform),t&cp.BUFFER_CREATIONFLAG_VERTEX&&(n|=GM.BufferUsage.Vertex),t&cp.BUFFER_CREATIONFLAG_INDEX&&(n|=GM.BufferUsage.Index),t&cp.BUFFER_CREATIONFLAG_STORAGE&&(n|=GM.BufferUsage.Storage),this._bufferManager.createBuffer(r,n)},PS.prototype.bindBuffersDirectly=function(){throw"Not implemented on WebGPU"},PS.prototype.updateAndBindInstancesBuffer=function(){throw"Not implemented on WebGPU"},PS.prototype.bindBuffers=function(e,t,r,n){this._currentIndexBuffer=t,this._currentOverrideVertexBuffers=null!=n?n:null,this._cacheRenderPipeline.setBuffers(e,t,this._currentOverrideVertexBuffers)},PS.prototype._releaseBuffer=function(e){return this._bufferManager.releaseBuffer(e)},PS.prototype.createEffect=function(e,t,r,n,i,o,s,a,u,c){var l;void 0===c&&(c=Aw.GLSL);var h=e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e,p=e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e,d=this._getGlobalDefines(),f=null!==(l=null!=i?i:t.defines)&&void 0!==l?l:"";d&&(f+="\n"+d);var A=h+"+"+p+"@"+f;if(this._compiledEffects[A]){var g=this._compiledEffects[A];return s&&g.isReady()&&s(g),g}var _=new Mw(e,t,r,n,this,i,o,s,a,u,A,c);return this._compiledEffects[A]=_,_},PS.prototype._compileRawShaderToSpirV=function(e,t){return this._glslang.compileGLSL(e,t)},PS.prototype._compileShaderToSpirV=function(e,t,r,n){return this._compileRawShaderToSpirV(n+(r?r+"\n":"")+e,t)},PS.prototype._getWGSLShader=function(e,t,r){return(r=r?"//"+r.split("\n").join("\n//")+"\n":"")+e},PS.prototype._getCompiledShaderFromIndexDB=function(e,t,r){this.saveCompiledShaderInIndexDB&&e==Aw.GLSL&&this._indexedDBScheduler?this._indexedDBScheduler.getElementFromDB(PS.COMPILED_WGSL_TABLE_NAME,t).then((e=>{if(null!=e){var t=e[e.length-1],n=e.slice(0,t),i=e.slice(t,e.length-1);r(!0,n,i)}else console.log("shader text from indexDB is null."),r(!1,null,null)}),(e=>{r(!1,null,null)})):r(!1,null,null)},PS.prototype._saveCompiledShaderToIndexDB=function(e,t,r){if(this._indexedDBScheduler&&this.saveCompiledShaderInIndexDB){var n=t.length+r.length,i=new Uint32Array(n+1);i.set(t,0),i.set(r,t.length),i[n]=t.length,this._indexedDBScheduler.putElementInDB(PS.COMPILED_WGSL_TABLE_NAME,e,i)}},PS.prototype._createPipelineStageDescriptor=function(e,t,r,n){return this._tintWASM&&n===Aw.GLSL&&(t=this._tintWASM.convertSpirV2WGSL(t),r=this._tintWASM.convertSpirV2WGSL(r),t=t.replace(/type\s/g,"alias "),r=r.replace(/type\s/g,"alias ")),{vertexStage:{module:this._device.createShaderModule({code:t}),entryPoint:"main"},fragmentStage:{module:this._device.createShaderModule({code:r}),entryPoint:"main"}}},PS.prototype._compileRawPipelineStageDescriptor=function(e,t,r,n){var i=n===Aw.GLSL?this._compileRawShaderToSpirV(t,"vertex"):t,o=n===Aw.GLSL?this._compileRawShaderToSpirV(r,"fragment"):r;return this._createPipelineStageDescriptor(e,i,o,n)},PS.prototype._compilePipelineStageDescriptor=function(e,t,r,n,i){this.onBeforeShaderCompilationObservable.notifyObservers(this);var o="#version 450\n",s=i===Aw.GLSL?this._compileShaderToSpirV(t,"vertex",n,o):this._getWGSLShader(t,"vertex",n),a=i===Aw.GLSL?this._compileShaderToSpirV(r,"fragment",n,o):this._getWGSLShader(r,"fragment",n),u=this._createPipelineStageDescriptor(e,s,a,i);return this.onAfterShaderCompilationObservable.notifyObservers(this),u},PS.prototype.createRawShaderProgram=function(){throw"Not available on WebGPU"},PS.prototype.createShaderProgram=function(){throw"Not available on WebGPU"},PS.prototype.inlineShaderCode=function(e){var t=new RS(e);return t.debug=!1,t.processCode(),t.code},PS.prototype.createPipelineContext=function(e){return new Bw(e,this)},PS.prototype.createMaterialContext=function(){return new pS},PS.prototype.createDrawContext=function(){return new dS(this._bufferManager)},PS.prototype._preparePipelineContext=function(e,t,r,n,i,o,s,a,u,c,l){var h=e,p=l||h.shaderProcessingContext.shaderLanguage;this.dbgShowShaderCode&&(console.log(a),console.log(t),console.log(r)),h.sources={fragment:r,vertex:t,rawVertex:i,rawFragment:o};var d=e._name;h.stages=n?this._compileRawPipelineStageDescriptor(d,t,r,p):this._compilePipelineStageDescriptor(d,t,r,a,p)},PS.prototype.getAttributes=function(e,t){for(var r=new Array(t.length),n=e,i=0;i<t.length;i++){var o=t[i],s=n.shaderProcessingContext.availableAttributes[o];void 0!==s&&(r[i]=s)}return r},PS.prototype.enableEffect=function(e){if(e){var t=!0;if(lS.IsWrapper(e)){if(!e.effect||e.effect===this._currentEffect&&e.materialContext===this._currentMaterialContext&&e.drawContext===this._currentDrawContext&&!this._forceEnableEffect){if(!e.effect&&this.dbgShowEmptyEnableEffectCalls)throw console.error("drawWrapper=",e),"Invalid call to enableEffect: the effect property is empty!";return}if(t=e.effect!==this._currentEffect,this._currentEffect=e.effect,this._currentMaterialContext=e.materialContext,this._currentDrawContext=e.drawContext,this._counters.numEnableDrawWrapper++,!this._currentMaterialContext)throw console.error("drawWrapper=",e),"Invalid call to enableEffect: the materialContext property is empty!"}else t=e!==this._currentEffect,this._currentEffect=e,this._currentMaterialContext=this._defaultMaterialContext,this._currentDrawContext=this._defaultDrawContext,this._counters.numEnableEffects++,this.dbgLogIfNotDrawWrapper&&WM.Warn("enableEffect has been called with an Effect and not a Wrapper! effect.uniqueId=".concat(e.uniqueId,", effect.name=").concat(e.name,", effect.name.vertex=").concat(e.name.vertex,", effect.name.fragment=").concat(e.name.fragment),10);this._stencilStateComposer.stencilMaterial=void 0,this._forceEnableEffect=!t&&!this._forceEnableEffect&&this._forceEnableEffect,t&&(this._currentEffect.onBind&&this._currentEffect.onBind(this._currentEffect),this._currentEffect._onBindObservable&&this._currentEffect._onBindObservable.notifyObservers(this._currentEffect))}},PS.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},PS.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},PS.prototype._deletePipelineContext=function(e){e&&e.dispose()},Object.defineProperty(PS.prototype,"needPOTTextures",{get:function(){return!1},enumerable:!1,configurable:!0}),PS.prototype._createHardwareTexture=function(){return new iw},PS.prototype._releaseTexture=function(e){var t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),this._textureHelper.releaseTexture(e)},PS.prototype._getRGBABufferInternalSizedFormat=function(){return cp.TEXTUREFORMAT_RGBA},PS.prototype.updateTextureComparisonFunction=function(e,t){e._comparisonFunction=t},PS.prototype._createInternalTexture=function(e,t,r,n){var i,o,s;void 0===r&&(r=!0),void 0===n&&(n=QR.Unknown);var a={};void 0!==t&&"object"==typeof t?(a.generateMipMaps=t.generateMipMaps,a.type=void 0===t.type?cp.TEXTURETYPE_UNSIGNED_INT:t.type,a.samplingMode=void 0===t.samplingMode?cp.TEXTURE_TRILINEAR_SAMPLINGMODE:t.samplingMode,a.format=void 0===t.format?cp.TEXTUREFORMAT_RGBA:t.format,a.samples=null!==(i=t.samples)&&void 0!==i?i:1,a.creationFlags=null!==(o=t.creationFlags)&&void 0!==o?o:0,a.useSRGBBuffer=null!==(s=t.useSRGBBuffer)&&void 0!==s&&s):(a.generateMipMaps=t,a.type=cp.TEXTURETYPE_UNSIGNED_INT,a.samplingMode=cp.TEXTURE_TRILINEAR_SAMPLINGMODE,a.format=cp.TEXTUREFORMAT_RGBA,a.samples=1,a.creationFlags=0,a.useSRGBBuffer=!1),(a.type!==cp.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(a.type!==cp.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(a.samplingMode=cp.TEXTURE_NEAREST_SAMPLINGMODE),a.type!==cp.TEXTURETYPE_FLOAT||this._caps.textureFloat||(a.type=cp.TEXTURETYPE_UNSIGNED_INT,WM.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));var u=new kR(this,n),c=e.width||e,l=e.height||e,h=e.layers||0;return u.baseWidth=c,u.baseHeight=l,u.width=c,u.height=l,u.depth=h,u.isReady=!0,u.samples=a.samples,u.generateMipMaps=!!a.generateMipMaps,u.samplingMode=a.samplingMode,u.type=a.type,u.format=a.format,u.is2DArray=h>0,u._cachedWrapU=cp.TEXTURE_CLAMP_ADDRESSMODE,u._cachedWrapV=cp.TEXTURE_CLAMP_ADDRESSMODE,u._useSRGBBuffer=a.useSRGBBuffer,this._internalTexturesCache.push(u),r||this._textureHelper.createGPUTextureForInternalTexture(u,c,l,h||1,a.creationFlags),u},PS.prototype.createTexture=function(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f){var A=this;return void 0===i&&(i=cp.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===l&&(l=null),this._createTextureBase(e,t,r,n,i,o,s,(function(e,t,r,n,i,o,s,a){var u,l=n;if(e.baseWidth=l.width,e.baseHeight=l.height,e.width=l.width,e.height=l.height,e.format=null!=c?c:-1,a(e.width,e.height,l,t,e,(function(){})),null===(u=e._hardwareTexture)||void 0===u?void 0:u.underlyingResource)o||s||A._generateMipmaps(e,A._uploadEncoder);else{var h=A._textureHelper.createGPUTextureForInternalTexture(e,l.width,l.height,void 0,d);ZS.IsImageBitmap(l)&&(A._textureHelper.updateTexture(l,e,l.width,l.height,e.depth,h.format,0,0,i,!1,0,0),o||s||A._generateMipmaps(e,A._uploadEncoder))}r&&r._removePendingData(e),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}),(function(){return!1}),a,u,c,l,h,p,f)},PS.prototype.wrapWebGPUTexture=function(e){var t=new iw(e),r=new kR(this,QR.Unknown,!0);return r._hardwareTexture=t,r.isReady=!0,r},PS.prototype.wrapWebGLTexture=function(){throw new Error("wrapWebGLTexture is not supported, use wrapWebGPUTexture instead.")},PS.prototype.generateMipMapsForCubemap=function(e){var t;e.generateMipMaps&&((null===(t=e._hardwareTexture)||void 0===t?void 0:t.underlyingResource)||this._textureHelper.createGPUTextureForInternalTexture(e),this._generateMipmaps(e,e.source===QR.RenderTarget||e.source===QR.MultiRenderTarget?this._renderTargetEncoder:void 0))},PS.prototype.updateTextureSamplingMode=function(e,t,r){void 0===r&&(r=!1),r&&(t.generateMipMaps=!0,this._generateMipmaps(t)),t.samplingMode=e},PS.prototype.updateTextureWrappingMode=function(e,t,r,n){void 0===r&&(r=null),void 0===n&&(n=null),null!==t&&(e._cachedWrapU=t),null!==r&&(e._cachedWrapV=r),(e.is2DArray||e.is3D)&&null!==n&&(e._cachedWrapR=n)},PS.prototype.updateTextureDimensions=function(e,t,r,n){if(void 0===n&&(n=1),e._hardwareTexture&&(e.width!==t||e.height!==r||e.depth!==n)){var i=e._hardwareTexture.textureAdditionalUsages;e._hardwareTexture.release(),this._textureHelper.createGPUTextureForInternalTexture(e,t,r,n,i)}},PS.prototype._setInternalTexture=function(e,t,r){if(r=null!=r?r:e,this._currentEffect){var n=this._currentEffect._pipelineContext.shaderProcessingContext.availableTextures[r];if(this._currentMaterialContext.setTexture(e,t),n&&n.autoBindSampler){var i=r+Sw.AutoSamplerSuffix;this._currentMaterialContext.setSampler(i,t)}}},PS.prototype.setTexture=function(e,t,r,n){this._setTexture(e,r,!1,!1,n,n)},PS.prototype.setTextureArray=function(e,t,r,n){for(var i=0;i<r.length;i++)this._setTexture(-1,r[i],!0,!1,n+i.toString(),n)},PS.prototype._setTexture=function(e,t,r,n,i,o){if(void 0===n&&(n=!1),void 0===i&&(i=""),o=null!=o?o:i,this._currentEffect){if(!t)return this._currentMaterialContext.setTexture(i,null),!1;if(t.video)t.update();else if(t.delayLoadState===cp.DELAYLOADSTATE_NOTLOADED)return t.delayLoad(),!1;var s=null;if((s=n?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture)&&!s.isMultiview){if(s.isCube&&s._cachedCoordinatesMode!==t.coordinatesMode){s._cachedCoordinatesMode=t.coordinatesMode;var a=t.coordinatesMode!==cp.TEXTURE_CUBIC_MODE&&t.coordinatesMode!==cp.TEXTURE_SKYBOX_MODE?cp.TEXTURE_WRAP_ADDRESSMODE:cp.TEXTURE_CLAMP_ADDRESSMODE;t.wrapU=a,t.wrapV=a}s._cachedWrapU=t.wrapU,s._cachedWrapV=t.wrapV,s.is3D&&(s._cachedWrapR=t.wrapR),this._setAnisotropicLevel(0,s,t.anisotropicFilteringLevel)}this._setInternalTexture(i,s,o)}else this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - _setTexture called with a null _currentEffect! texture=",t));return!0},PS.prototype._setAnisotropicLevel=function(e,t,r){t._cachedAnisotropicFilteringLevel!==r&&(t._cachedAnisotropicFilteringLevel=Math.min(r,this._caps.maxAnisotropy))},PS.prototype._bindTexture=function(e,t,r){void 0!==e&&this._setInternalTexture(r,t)},PS.prototype.generateMipmaps=function(e){this._generateMipmaps(e,this._renderTargetEncoder)},PS.prototype._generateMipmaps=function(e,t){var r=e._hardwareTexture;if(r){t=null!=t?t:this._currentRenderTarget&&!this._currentRenderPass?this._renderTargetEncoder:this._currentRenderPass?this._uploadEncoder:this._renderEncoder;var n=e._hardwareTexture.format,i=ZS.ComputeNumMipmapLevels(e.width,e.height);this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - generate mipmaps called - width=",e.width,"height=",e.height,"isCube=",e.isCube)),e.isCube?this._textureHelper.generateCubeMipmaps(r,n,i,t):this._textureHelper.generateMipmaps(r,n,i,0,t)}},PS.prototype.updateTextureData=function(e,t,r,n,i,o,s,a,u){var c;void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=!1);var l=e._hardwareTexture;(null===(c=e._hardwareTexture)||void 0===c?void 0:c.underlyingResource)||(l=this._textureHelper.createGPUTextureForInternalTexture(e));var h=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(h,e,i,o,e.depth,l.format,s,a,e.invertY,!1,r,n),u&&this._generateMipmaps(e,this._renderTargetEncoder)},PS.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,n,i,o,s){var a;void 0===o&&(o=0),void 0===s&&(s=0);var u=e._hardwareTexture;(null===(a=e._hardwareTexture)||void 0===a?void 0:a.underlyingResource)||(e.format=t,u=this._textureHelper.createGPUTextureForInternalTexture(e,r,n));var c=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);this._textureHelper.updateTexture(c,e,r,n,e.depth,u.format,o,s,!1,!1,0,0)},PS.prototype._uploadDataToTextureDirectly=function(e,t,r,n,i,o){var s;void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=!1);var a=Math.round(Math.log(e.width)*Math.LOG2E),u=Math.round(Math.log(e.height)*Math.LOG2E),c=o?e.width:Math.pow(2,Math.max(a-n,0)),l=o?e.height:Math.pow(2,Math.max(u-n,0)),h=e._hardwareTexture;(null===(s=e._hardwareTexture)||void 0===s?void 0:s.underlyingResource)||(h=this._textureHelper.createGPUTextureForInternalTexture(e,c,l));var p=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(p,e,c,l,e.depth,h.format,r,n,e.invertY,!1,0,0)},PS.prototype._uploadArrayBufferViewToTexture=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this._uploadDataToTextureDirectly(e,t,r,n)},PS.prototype._uploadImageToTexture=function(e,t,r,n){var i;void 0===r&&(r=0),void 0===n&&(n=0);var o=e._hardwareTexture;(null===(i=e._hardwareTexture)||void 0===i?void 0:i.underlyingResource)||(o=this._textureHelper.createGPUTextureForInternalTexture(e));var s=t,a=Math.ceil(e.width/(1<<n)),u=Math.ceil(e.height/(1<<n));this._textureHelper.updateTexture(s,e,a,u,e.depth,o.format,r,n,e.invertY,!1,0,0)},PS.prototype.readPixels=function(e,t,r,n,i,o){void 0===o&&(o=!0);var s=(this._rttRenderPassWrapper.renderPass?this._rttRenderPassWrapper:this._mainRenderPassWrapper).colorAttachmentGPUTextures[0];if(!s)return Promise.resolve(new Uint8Array(0));var a=s.underlyingResource,u=s.format;return a?(o&&this.flushFramebuffer(),this._textureHelper.readPixels(a,e,t,r,n,u)):Promise.resolve(new Uint8Array(0))},PS.prototype.beginFrame=function(){Rw.prototype.beginFrame.call(this)},PS.prototype.endFrame=function(){if(this._snapshotRendering.endFrame(this._mainRenderPassWrapper.renderPass),this._endMainRenderPass(),this._timestampQuery.endFrame(this._renderEncoder),this.flushFramebuffer(!1),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - counters")),this._textureHelper.destroyDeferredTextures(),this._bufferManager.destroyDeferredBuffers(),this._features._collectUbosUpdatedInFrame){if(this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||this._count<this.dbgVerboseLogsNumFrames)){var e=[];for(var t in ww._UpdatedUbosInFrame)e.push(t+":"+ww._UpdatedUbosInFrame[t]);console.log("frame #"+this._count+" - updated ubos -",e.join(", "))}ww._UpdatedUbosInFrame={}}this.countersLastFrame.numEnableEffects=this._counters.numEnableEffects,this.countersLastFrame.numEnableDrawWrapper=this._counters.numEnableDrawWrapper,this.countersLastFrame.numBundleCreationNonCompatMode=this._counters.numBundleCreationNonCompatMode,this.countersLastFrame.numBundleReuseNonCompatMode=this._counters.numBundleReuseNonCompatMode,this._counters.numEnableEffects=0,this._counters.numEnableDrawWrapper=0,this._counters.numBundleCreationNonCompatMode=0,this._counters.numBundleReuseNonCompatMode=0,this._cacheRenderPipeline.endFrame(),this._cacheBindGroups.endFrame(),this._pendingDebugCommands.length=0,Rw.prototype.endFrame.call(this),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),this._count<this.dbgVerboseLogsNumFrames&&console.log("%c frame #"+this._count+" - end","background: #ffff00"),this._count<this.dbgVerboseLogsNumFrames&&(this._count++,this._count!==this.dbgVerboseLogsNumFrames&&console.log("%c frame #"+this._count+" - begin","background: #ffff00")))},PS.prototype.flushFramebuffer=function(e){void 0===e&&(e=!0);var t=!this._currentRenderPass,r=0;this._currentRenderPass&&this._currentRenderTarget&&(r|=1,this._endRenderTargetRenderPass()),this._mainRenderPassWrapper.renderPass&&(r|=2,this._endMainRenderPass()),this._commandBuffers[0]=this._uploadEncoder.finish(),this._commandBuffers[1]=this._renderTargetEncoder.finish(),this._commandBuffers[2]=this._renderEncoder.finish(),this._device.queue.submit(this._commandBuffers),this._uploadEncoder=this._device.createCommandEncoder(this._uploadEncoderDescriptor),this._renderEncoder=this._device.createCommandEncoder(this._renderEncoderDescriptor),this._renderTargetEncoder=this._device.createCommandEncoder(this._renderTargetEncoderDescriptor),this._timestampQuery.startFrame(this._uploadEncoder),this._textureHelper.setCommandEncoder(this._uploadEncoder),this._bundleList.reset(),this._bundleListRenderTarget.reset(),e&&(2&r&&this._startMainRenderPass(!1),1&r&&this._startRenderTargetRenderPass(this._currentRenderTarget,!1,null,!1,!1),t&&this._currentRenderTarget&&(this._currentRenderPass=null))},PS.prototype._currentFrameBufferIsDefaultFrameBuffer=function(){return null===this._currentRenderTarget},PS.prototype._startRenderTargetRenderPass=function(e,t,r,n,i){var o,s,a,u=e,c=u._depthStencilTexture,l=null==c?void 0:c._hardwareTexture,h=null==l?void 0:l.underlyingResource,p=null==l?void 0:l.msaaTexture,d=null==h?void 0:h.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor),f=null==p?void 0:p.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor),A=!!l&&ZS.HasStencilAspect(l.format),g=[];this.useReverseDepthBuffer&&this.setDepthFunctionToGreaterOrEqual();var _=t&&r,m=t&&n,y=t&&i;if(u._attachments&&u.isMulti){this._mrtAttachments&&0!==this._mrtAttachments.length||(this._mrtAttachments=u._defaultAttachments);for(var E=0;E<this._mrtAttachments.length;++E){var x=this._mrtAttachments[E],C=u.textures[E],b=null==C?void 0:C._hardwareTexture,I=null==b?void 0:b.underlyingResource;if(b&&I){var T=In(this._rttRenderPassWrapper.colorAttachmentViewDescriptor,{format:b.format}),v=b.msaaTexture,R=I.createView(T),M=null==v?void 0:v.createView(T);g.push({view:M||R,resolveTarget:v?R:void 0,clearValue:0!==x&&_?r:void 0,loadOp:0!==x&&_?GM.LoadOp.Clear:GM.LoadOp.Load,storeOp:GM.StoreOp.Store})}}this._cacheRenderPipeline.setMRT(u.textures,this._mrtAttachments.length),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments)}else{if(B=u.texture){var w=B._hardwareTexture,S=w.underlyingResource;v=w.msaaTexture,R=S.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor),M=null==v?void 0:v.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor);g.push({view:M||R,resolveTarget:v?R:void 0,clearValue:_?r:void 0,loadOp:_?GM.LoadOp.Clear:GM.LoadOp.Load,storeOp:GM.StoreOp.Store})}else g.push(null)}if(null===(o=this._debugPushGroup)||void 0===o||o.call(this,"render target pass",1),this._rttRenderPassWrapper.renderPassDescriptor={colorAttachments:g,depthStencilAttachment:c&&h?{view:f||d,depthClearValue:m?this.useReverseDepthBuffer?this._clearReverseDepthValue:this._clearDepthValue:void 0,depthLoadOp:m?GM.LoadOp.Clear:GM.LoadOp.Load,depthStoreOp:GM.StoreOp.Store,stencilClearValue:u._depthStencilTextureWithStencil&&y?this._clearStencilValue:void 0,stencilLoadOp:A?u._depthStencilTextureWithStencil&&y?GM.LoadOp.Clear:GM.LoadOp.Load:void 0,stencilStoreOp:A?GM.StoreOp.Store:void 0}:void 0,occlusionQuerySet:(null===(s=this._occlusionQuery)||void 0===s?void 0:s.hasQueries)?this._occlusionQuery.querySet:void 0},this._rttRenderPassWrapper.renderPass=this._renderTargetEncoder.beginRenderPass(this._rttRenderPassWrapper.renderPassDescriptor),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||this._count<this.dbgVerboseLogsNumFrames)){var B=u.texture;console.log("frame #"+this._count+" - render target begin pass - internalTexture.uniqueId=",B.uniqueId,"width=",B.width,"height=",B.height,this._rttRenderPassWrapper.renderPassDescriptor)}this._currentRenderPass=this._rttRenderPassWrapper.renderPass,null===(a=this._debugFlushPendingCommands)||void 0===a||a.call(this),l&&ZS.HasStencilAspect(l.format)||(this._stencilStateComposer.enabled=!1)},PS.prototype._endRenderTargetRenderPass=function(){var e,t,r,n;if(this._currentRenderPass){var i=null===(e=this._currentRenderTarget.texture)||void 0===e?void 0:e._hardwareTexture;!i||this._snapshotRendering.endRenderTargetPass(this._currentRenderPass,i)||this.compatibilityMode||(this._bundleListRenderTarget.run(this._currentRenderPass),this._bundleListRenderTarget.reset()),this._currentRenderPass.end(),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - render target end pass - internalTexture.uniqueId=",null===(r=null===(t=this._currentRenderTarget)||void 0===t?void 0:t.texture)||void 0===r?void 0:r.uniqueId)),null===(n=this._debugPopGroup)||void 0===n||n.call(this,1),this._resetCurrentViewport(1),this._resetCurrentScissor(1),this._resetCurrentStencilRef(1),this._resetCurrentColorBlend(1),this._currentRenderPass=null,this._rttRenderPassWrapper.reset()}},PS.prototype._getCurrentRenderPass=function(){return this._currentRenderTarget&&!this._currentRenderPass?this._startRenderTargetRenderPass(this._currentRenderTarget,!1,null,!1,!1):this._currentRenderPass||this._startMainRenderPass(!1),this._currentRenderPass},PS.prototype._getCurrentRenderPassIndex=function(){return null===this._currentRenderPass?-1:this._currentRenderPass===this._mainRenderPassWrapper.renderPass?0:1},PS.prototype._startMainRenderPass=function(e,t,r,n){var i,o,s;this._mainRenderPassWrapper.renderPass&&this._endMainRenderPass(),this.useReverseDepthBuffer&&this.setDepthFunctionToGreaterOrEqual();var a=e&&t,u=e&&r,c=e&&n;this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].clearValue=a?t:void 0,this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].loadOp=a?GM.LoadOp.Clear:GM.LoadOp.Load,this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.depthClearValue=u?this.useReverseDepthBuffer?this._clearReverseDepthValue:this._clearDepthValue:void 0,this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.depthLoadOp=u?GM.LoadOp.Clear:GM.LoadOp.Load,this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.stencilClearValue=c?this._clearStencilValue:void 0,this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.stencilLoadOp=this.isStencilEnable?c?GM.LoadOp.Clear:GM.LoadOp.Load:void 0,this._mainRenderPassWrapper.renderPassDescriptor.occlusionQuerySet=(null===(i=this._occlusionQuery)||void 0===i?void 0:i.hasQueries)?this._occlusionQuery.querySet:void 0,this._swapChainTexture=this._context.getCurrentTexture(),this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].set(this._swapChainTexture),this._options.antialiasing?this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].resolveTarget=this._swapChainTexture.createView():this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].view=this._swapChainTexture.createView(),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - main begin pass - texture width="+this._mainTextureExtends.width," height="+this._mainTextureExtends.height,this._mainRenderPassWrapper.renderPassDescriptor)),null===(o=this._debugPushGroup)||void 0===o||o.call(this,"main pass",0),this._currentRenderPass=this._renderEncoder.beginRenderPass(this._mainRenderPassWrapper.renderPassDescriptor),this._mainRenderPassWrapper.renderPass=this._currentRenderPass,null===(s=this._debugFlushPendingCommands)||void 0===s||s.call(this),this._resetCurrentViewport(0),this._resetCurrentScissor(0),this._resetCurrentStencilRef(0),this._resetCurrentColorBlend(0),this._isStencilEnable||(this._stencilStateComposer.enabled=!1)},PS.prototype._endMainRenderPass=function(){var e;null!==this._mainRenderPassWrapper.renderPass&&(this._snapshotRendering.endMainRenderPass(),this.compatibilityMode||this._snapshotRendering.play||(this._bundleList.run(this._mainRenderPassWrapper.renderPass),this._bundleList.reset()),this._mainRenderPassWrapper.renderPass.end(),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - main end pass")),null===(e=this._debugPopGroup)||void 0===e||e.call(this,0),this._resetCurrentViewport(0),this._resetCurrentScissor(0),this._resetCurrentStencilRef(0),this._resetCurrentColorBlend(0),this._mainRenderPassWrapper.renderPass===this._currentRenderPass&&(this._currentRenderPass=null),this._mainRenderPassWrapper.reset(!1))},PS.prototype.bindFramebuffer=function(e,t,r,n,i,o,s,a){var u,c;void 0===t&&(t=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0);var l=null===(u=e.texture)||void 0===u?void 0:u._hardwareTexture;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,l&&(l._currentLayer=e.isCube?6*s+t:s),this._rttRenderPassWrapper.colorAttachmentGPUTextures[0]=l,this._rttRenderPassWrapper.depthTextureFormat=this._currentRenderTarget._depthStencilTexture?ZS.GetWebGPUTextureFormat(-1,this._currentRenderTarget._depthStencilTexture.format):void 0,this._setDepthTextureFormat(this._rttRenderPassWrapper),this._setColorFormat(this._rttRenderPassWrapper),this._rttRenderPassWrapper.colorAttachmentViewDescriptor={format:this._colorFormat,dimension:GM.TextureViewDimension.E2d,mipLevelCount:1,baseArrayLayer:e.isCube?6*s+t:s,baseMipLevel:o,arrayLayerCount:1,aspect:GM.TextureAspect.All},this._rttRenderPassWrapper.depthAttachmentViewDescriptor={format:this._depthTextureFormat,dimension:GM.TextureViewDimension.E2d,mipLevelCount:1,baseArrayLayer:e.isCube?6*a+t:a,baseMipLevel:0,arrayLayerCount:1,aspect:GM.TextureAspect.All},this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - bindFramebuffer called - internalTexture.uniqueId=",null===(c=e.texture)||void 0===c?void 0:c.uniqueId,"face=",t,"lodLevel=",o,"layer=",s,this._rttRenderPassWrapper.colorAttachmentViewDescriptor,this._rttRenderPassWrapper.depthAttachmentViewDescriptor)),this._currentRenderPass=null,this.snapshotRendering&&this.snapshotRenderingMode===cp.SNAPSHOTRENDERING_FAST&&this._getCurrentRenderPass(),this._cachedViewport&&!i?this.setViewport(this._cachedViewport,r,n):(r||(r=e.width,o&&(r/=Math.pow(2,o))),n||(n=e.height,o&&(n/=Math.pow(2,o))),this._viewport(0,0,r,n)),this.wipeCaches()},PS.prototype.unBindFramebuffer=function(e,t,r){var n,i;void 0===t&&(t=!1);var o=this._currentRenderTarget;this._currentRenderTarget=null,r&&r(),this._currentRenderTarget=o,this._currentRenderPass&&this._currentRenderPass!==this._mainRenderPassWrapper.renderPass&&this._endRenderTargetRenderPass(),!(null===(n=e.texture)||void 0===n?void 0:n.generateMipMaps)||t||e.isCube||this._generateMipmaps(e.texture),this._currentRenderTarget=null,this._onAfterUnbindFrameBufferObservable.notifyObservers(this),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - unBindFramebuffer called - internalTexture.uniqueId=",null===(i=e.texture)||void 0===i?void 0:i.uniqueId)),this._mrtAttachments=[],this._cacheRenderPipeline.setMRT([]),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments),this._currentRenderPass=this._mainRenderPassWrapper.renderPass,this._setDepthTextureFormat(this._mainRenderPassWrapper),this._setColorFormat(this._mainRenderPassWrapper)},PS.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):(this._currentRenderPass=this._mainRenderPassWrapper.renderPass,this._setDepthTextureFormat(this._mainRenderPassWrapper),this._setColorFormat(this._mainRenderPassWrapper)),this._currentRenderPass&&this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},PS.prototype._setColorFormat=function(e){var t,r,n=null!==(r=null===(t=e.colorAttachmentGPUTextures[0])||void 0===t?void 0:t.format)&&void 0!==r?r:null;this._cacheRenderPipeline.setColorFormat(n),this._colorFormat!==n&&(this._colorFormat=n)},PS.prototype._setDepthTextureFormat=function(e){this._cacheRenderPipeline.setDepthStencilFormat(e.depthTextureFormat),this._depthTextureFormat!==e.depthTextureFormat&&(this._depthTextureFormat=e.depthTextureFormat)},PS.prototype.setDitheringState=function(){},PS.prototype.setRasterizerState=function(){},PS.prototype.setState=function(e,t,r,n,i,o,s){var a,u;void 0===t&&(t=0),void 0===n&&(n=!1),void 0===s&&(s=0),(this._depthCullingState.cull!==e||r)&&(this._depthCullingState.cull=e);var c=null===(u=null!==(a=this.cullBackFaces)&&void 0!==a?a:i)||void 0===u||u?1:2;(this._depthCullingState.cullFace!==c||r)&&(this._depthCullingState.cullFace=c),this.setZOffset(t),this.setZOffsetUnits(s);var l=n?this._currentRenderTarget?1:2:this._currentRenderTarget?2:1;(this._depthCullingState.frontFace!==l||r)&&(this._depthCullingState.frontFace=l),this._stencilStateComposer.stencilMaterial=o},PS.prototype._applyRenderPassChanges=function(e,t){var r,n=this._mustUpdateViewport(e),i=this._mustUpdateScissor(e),o=!!this._stencilStateComposer.enabled&&this._mustUpdateStencilRef(e),s=!!this._alphaState.alphaBlend&&this._mustUpdateBlendColor(e);t?(n&&t.addItem(new _S(this._viewportCached.x,this._viewportCached.y,this._viewportCached.z,this._viewportCached.w)),i&&t.addItem(new mS(this._scissorCached.x,this._scissorCached.y,this._scissorCached.z,this._scissorCached.w)),o&&t.addItem(new yS(null!==(r=this._stencilStateComposer.funcRef)&&void 0!==r?r:0)),s&&t.addItem(new ES(this._alphaState._blendConstants.slice()))):(n&&this._applyViewport(e),i&&this._applyScissor(e),o&&this._applyStencilRef(e),s&&this._applyBlendColor(e))},PS.prototype._draw=function(e,t,r,n,i,o){var s,a=this._getCurrentRenderPass(),u=0===this._getCurrentRenderPassIndex()?this._bundleList:this._bundleListRenderTarget;this.applyStates();var c=this._currentEffect._pipelineContext;if(this.bindUniformBufferBase(this._currentRenderTarget?this._ubInvertY:this._ubDontInvertY,0,Sw.InternalsUBOName),c.uniformBuffer&&(c.uniformBuffer.update(),this.bindUniformBufferBase(c.uniformBuffer.getBuffer(),0,Sw.LeftOvertUBOName)),this._snapshotRendering.play)this._reportDrawCall();else{var l;l=o?o.getActiveBundle():this._currentDrawContext.fastBundle,!this.compatibilityMode&&(this._currentDrawContext.isDirty(this._currentMaterialContext.updateId)||this._currentMaterialContext.isDirty||this._currentMaterialContext.forceBindGroupCreation)&&(this._currentDrawContext.fastBundle=void 0);var h=a;if(!this.compatibilityMode&&l||this._snapshotRendering.record){if(this._applyRenderPassChanges(a,u),!this._snapshotRendering.record)return this._counters.numBundleReuseNonCompatMode++,this._currentDrawContext.indirectDrawBuffer&&this._currentDrawContext.setIndirectData(n,i||1,r),u.addBundle(l),void this._reportDrawCall();h=u.getBundleEncoder(this._cacheRenderPipeline.colorFormats,this._depthTextureFormat,this.currentSampleCount),u.numDrawCalls++}var p=0;if(!this._caps.textureFloatLinearFiltering&&this._currentMaterialContext.hasFloatTextures)for(var d=1,f=0;f<c.shaderProcessingContext.textureNames.length;++f){var A=c.shaderProcessingContext.textureNames[f],g=null===(s=this._currentMaterialContext.textures[A])||void 0===s?void 0:s.texture;(null==g?void 0:g.type)===cp.TEXTURETYPE_FLOAT&&(p|=d),d<<=1}var _,m=this._cacheRenderPipeline.getRenderPipeline(t,this._currentEffect,this.currentSampleCount,p);_=o.bindGroups?o.bindGroups:this._cacheBindGroups.getBindGroups(c,this._currentDrawContext,this._currentMaterialContext,o),this._snapshotRendering.record||(this._applyRenderPassChanges(a,this.compatibilityMode?null:u),this.compatibilityMode||(this._counters.numBundleCreationNonCompatMode++,h=this._device.createRenderBundleEncoder({colorFormats:this._cacheRenderPipeline.colorFormats,depthStencilFormat:this._depthTextureFormat,sampleCount:this.currentSampleCount}))),h.setPipeline(m),this._currentIndexBuffer&&h.setIndexBuffer(this._currentIndexBuffer.underlyingResource,this._currentIndexBuffer.is32Bits?GM.IndexFormat.Uint32:GM.IndexFormat.Uint16,0);for(var y=this._cacheRenderPipeline.vertexBuffers,E=0;E<y.length;E++){var x=y[E],C=x.getBuffer();C&&h.setVertexBuffer(E,C.underlyingResource,x._validOffsetRange?0:x.byteOffset)}for(f=0;f<_.length;f++)h.setBindGroup(f,_[f]);var b=!this.compatibilityMode&&!this._snapshotRendering.record;b&&this._currentDrawContext.indirectDrawBuffer?(this._currentDrawContext.setIndirectData(n,i||1,r),0===e?h.drawIndexedIndirect(this._currentDrawContext.indirectDrawBuffer,0):h.drawIndirect(this._currentDrawContext.indirectDrawBuffer,0)):0===e?h.drawIndexed(n,i||1,r,0,0):h.draw(n,i||1,r,0),b&&(this._currentDrawContext.fastBundle=h.finish(),u.addBundle(this._currentDrawContext.fastBundle),o.setFastBundle(this._currentDrawContext.fastBundle)),this._reportDrawCall()}},PS.prototype.drawElementsType=function(e,t,r,n,i){void 0===n&&(n=1),this._draw(0,e,t,r,n,i)},PS.prototype.drawArraysType=function(e,t,r,n,i){void 0===n&&(n=1),this._currentIndexBuffer=null,this._draw(1,e,t,r,n,i)},PS.prototype.dispose=function(){var e,t,r;null===(e=this._mainTexture)||void 0===e||e.destroy(),null===(t=this._mainTextureLastCopy)||void 0===t||t.destroy(),null===(r=this._depthTexture)||void 0===r||r.destroy(),this._device.destroy(),Rw.prototype.dispose.call(this)},PS.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._canvas.width},PS.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._canvas.height},PS.prototype.getRenderingCanvas=function(){return this._canvas},PS.prototype.getError=function(){return 0},PS.prototype.bindSamplers=function(){},PS.prototype._bindTextureDirectly=function(){return!1},PS.prototype.areAllEffectsReady=function(){return!0},PS.prototype._executeWhenRenderingStateIsCompiled=function(e,t){t()},PS.prototype._isRenderingStateCompiled=function(){return!0},PS.prototype._getUnpackAlignement=function(){return 1},PS.prototype._unpackFlipY=function(){},PS.prototype._bindUnboundFramebuffer=function(){throw"_bindUnboundFramebuffer is not implementedin WebGPU! You probably want to use restoreDefaultFramebuffer or unBindFramebuffer instead"},PS.prototype._getSamplingParameters=function(){throw"_getSamplingParameters is not available in WebGPU"},PS.prototype.getUniforms=function(){return[]},PS.prototype.setIntArray=function(){return!1},PS.prototype.setIntArray2=function(){return!1},PS.prototype.setIntArray3=function(){return!1},PS.prototype.setIntArray4=function(){return!1},PS.prototype.setArray=function(){return!1},PS.prototype.setArray2=function(){return!1},PS.prototype.setArray3=function(){return!1},PS.prototype.setArray4=function(){return!1},PS.prototype.setMatrices=function(){return!1},PS.prototype.setMatrix3x3=function(){return!1},PS.prototype.setMatrix2x2=function(){return!1},PS.prototype.setFloat=function(){return!1},PS.prototype.setFloat2=function(){return!1},PS.prototype.setFloat3=function(){return!1},PS.prototype.setFloat4=function(){return!1},PS._GLSLslangDefaultOptions={jsPath:"ThirdParty/glslang.js",wasmPath:"ThirdParty/glslang.wasm"},PS.UseTWGSL=!0,PS.COMPILED_WGSL_STORE_NAME="wgslStore",PS.COMPILED_WGSL_TABLE_NAME="wgsl",function(e){e[e.Texture=0]="Texture",e[e.StorageTexture=1]="StorageTexture",e[e.UniformBuffer=2]="UniformBuffer",e[e.StorageBuffer=3]="StorageBuffer",e[e.TextureWithoutSampler=4]="TextureWithoutSampler",e[e.Sampler=5]="Sampler"}(SS||(SS={}));const NS=SS;function LS(e,t){this._device=e,this._cacheSampler=t,this.uniqueId=LS._Counter++,this._bindGroupEntries=[],this.clear()}function US(e){this._name="unnamed",this.engine=e,this.computePipeline=null}tw.prototype.createComputeEffect=function(e,t){throw new Error("createComputeEffect: This engine does not support compute shaders!")},tw.prototype.createComputePipelineContext=function(){throw new Error("createComputePipelineContext: This engine does not support compute shaders!")},tw.prototype.createComputeContext=function(){},tw.prototype.computeDispatch=function(e,t,r,n,i,o,s){throw new Error("computeDispatch: This engine does not support compute shaders!")},tw.prototype.areAllComputeEffectsReady=function(){return!0},tw.prototype.releaseComputeEffects=function(){},tw.prototype._prepareComputePipelineContext=function(e,t,r,n,i){},tw.prototype._rebuildComputeEffects=function(){},tw.prototype._executeWhenComputeStateIsCompiled=function(e,t){t()},tw.prototype._releaseComputeEffect=function(e){},tw.prototype._deleteComputePipelineContext=function(e){},LS.prototype.getBindGroups=function(e,t,r){if(!r)throw new Error("WebGPUComputeContext.getBindGroups: bindingsMapping is required until browsers support reflection for wgsl shaders!");if(0===this._bindGroups.length){var n=this._bindGroupEntries.length>0;for(var i in e){var o=e[i],s=r[i],a=s.group,u=s.binding,c=o.type,l=o.object,h=o.indexInGroupEntries;switch((m=this._bindGroupEntries[a])||(m=this._bindGroupEntries[a]=[]),c){case NS.Sampler:var p=l;void 0!==h&&n?m[h].resource=this._cacheSampler.getSampler(p):(o.indexInGroupEntries=m.length,m.push({binding:u,resource:this._cacheSampler.getSampler(p)}));break;case NS.Texture:case NS.TextureWithoutSampler:var d=(f=l)._texture._hardwareTexture;void 0!==h&&n?(c===NS.Texture&&(m[h++].resource=this._cacheSampler.getSampler(f._texture)),m[h].resource=d.view):(o.indexInGroupEntries=m.length,c===NS.Texture&&m.push({binding:u-1,resource:this._cacheSampler.getSampler(f._texture)}),m.push({binding:u,resource:d.view}));break;case NS.StorageTexture:var f;(d=(f=l)._texture._hardwareTexture).textureAdditionalUsages&GM.TextureUsage.StorageBinding||WM.Error("computeDispatch: The texture (name=".concat(f.name,", uniqueId=").concat(f.uniqueId,") is not a storage texture!"),50),void 0!==h&&n?m[h].resource=d.viewForWriting:(o.indexInGroupEntries=m.length,m.push({binding:u,resource:d.viewForWriting}));break;case NS.UniformBuffer:case NS.StorageBuffer:var A=(NS.UniformBuffer,l).getBuffer(),g=A.underlyingResource;void 0!==h&&n?(m[h].resource.buffer=g,m[h].resource.size=A.capacity):(o.indexInGroupEntries=m.length,m.push({binding:u,resource:{buffer:g,offset:0,size:A.capacity}}))}}for(var _=0;_<this._bindGroupEntries.length;++_){var m;(m=this._bindGroupEntries[_])?this._bindGroups[_]=this._device.createBindGroup({layout:t.getBindGroupLayout(_),entries:m}):this._bindGroups[_]=void 0}this._bindGroups.length=this._bindGroupEntries.length}return this._bindGroups},LS.prototype.clear=function(){this._bindGroups=[]},LS._Counter=0,Object.defineProperty(US.prototype,"isAsync",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(US.prototype,"isReady",{get:function(){return!!this.stage},enumerable:!1,configurable:!0}),US.prototype._getComputeShaderCode=function(){var e;return null===(e=this.sources)||void 0===e?void 0:e.compute},US.prototype.dispose=function(){};const GS=0,QS=1,kS=2,zS=3,jS=4,HS=5;function qS(e,t,r,n){void 0===n&&(n={}),this._bindings={},this._samplers={},this._contextIsDirty=!1,this.onCompiled=null,this.onError=null,this.name=e,this._engine=t,this.uniqueId=ow.UniqueId,this._engine.getCaps().supportComputeShaders?n.bindingsMapping?(this._context=t.createComputeContext(),this._shaderPath=r,this._options=n||{bindingsMapping:{},defines:[]}):console.log("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):console.log("This engine does not support compute shaders!")}PS.prototype.createComputeContext=function(){return new LS(this._device,this._cacheSampler)},PS.prototype.createComputeEffect=function(e,t){var r=(e.computeElement||e.compute||e.computeToken||e.computeSource||e)+"@"+t.defines;if(this._compiledComputeEffects[r]){var n=this._compiledComputeEffects[r];return t.onCompiled&&n.isReady()&&t.onCompiled(n),n}var i=new xw(e,t,this,r);return this._compiledComputeEffects[r]=i,i},PS.prototype.createComputePipelineContext=function(){return new US(this)},PS.prototype.areAllComputeEffectsReady=function(){for(var e in this._compiledComputeEffects){if(!this._compiledComputeEffects[e].isReady())return!1}return!0},PS.prototype.computeDispatch=function(e,t,r,n,i,o,s){var a=this;if(this._currentRenderTarget)this._onAfterUnbindFrameBufferObservable.addOnce((function(){a.computeDispatch(e,t,r,n,i,o,s)}));else{var u=e._pipelineContext,c=t;u.computePipeline||(u.computePipeline=this._device.createComputePipeline({layout:GM.AutoLayoutMode.Auto,compute:u.stage}));var l=this._renderTargetEncoder.beginComputePass();l.setPipeline(u.computePipeline);for(var h=c.getBindGroups(r,u.computePipeline,s),p=0;p<h.length;++p){var d=h[p];d&&l.setBindGroup(p,d)}l.dispatchWorkgroups(n,i,o),l.end()}},PS.prototype.releaseComputeEffects=function(){for(var e in this._compiledComputeEffects){var t=this._compiledComputeEffects[e].getPipelineContext();this._deleteComputePipelineContext(t)}this._compiledComputeEffects={}},PS.prototype._prepareComputePipelineContext=function(e,t,r,n,i){var o=e;this.dbgShowShaderCode&&(console.log(n),console.log(t)),o.sources={compute:t,rawCompute:r},o.stage=this._createComputePipelineStageDescriptor(t,n,i)},PS.prototype._releaseComputeEffect=function(e){this._compiledComputeEffects[e._key]&&(delete this._compiledComputeEffects[e._key],this._deleteComputePipelineContext(e.getPipelineContext()))},PS.prototype._rebuildComputeEffects=function(){for(var e in this._compiledComputeEffects){var t=this._compiledComputeEffects[e];t._pipelineContext=null,t._wasPreviouslyReady=!1,t._prepareEffect()}},PS.prototype._deleteComputePipelineContext=function(e){e&&e.dispose()},PS.prototype._createComputePipelineStageDescriptor=function(e,t,r){return t=t?"//"+t.split("\n").join("\n//")+"\n":"",{module:this._device.createShaderModule({code:t+e}),entryPoint:r}},Object.defineProperty(qS.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(qS.prototype,"shaderPath",{get:function(){return this._shaderPath},enumerable:!1,configurable:!0}),qS.prototype.getClassName=function(){return"ComputeShader"},qS.prototype.setTexture=function(e,t,r){void 0===r&&(r=!0);var n=this._bindings[e];this._bindings[e]={type:r?GS:jS,object:t,indexInGroupEntries:null==n?void 0:n.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!n||n.object!==t||n.type!==this._bindings[e].type)},qS.prototype.setStorageTexture=function(e,t){var r=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!r||r.object!==t),this._bindings[e]={type:QS,object:t,indexInGroupEntries:null==r?void 0:r.indexInGroupEntries}},qS.prototype.setUniformBuffer=function(e,t){var r=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!r||r.object!==t),this._bindings[e]={type:kS,object:t,indexInGroupEntries:null==r?void 0:r.indexInGroupEntries}},qS.prototype.setStorageBuffer=function(e,t){var r=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!r||r.object!==t),this._bindings[e]={type:zS,object:t,indexInGroupEntries:null==r?void 0:r.indexInGroupEntries}},qS.prototype.setTextureSampler=function(e,t){var r=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!r||!t.compareSampler(r.object)),this._bindings[e]={type:HS,object:t,indexInGroupEntries:null==r?void 0:r.indexInGroupEntries}},qS.prototype.isReady=function(){var e=this._effect;for(var t in this._bindings){var r=this._bindings[t],n=r.type,i=r.object;switch(n){case GS:case jS:case QS:if(!i.isReady)return!1}}var o=[],s=this._shaderPath;if(this._options.defines)for(var a=0;a<this._options.defines.length;a++)o.push(this._options.defines[a]);var u=o.join("\n");return this._cachedDefines!==u&&(this._cachedDefines=u,e=this._engine.createComputeEffect(s,{defines:u,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=e),!!e.isReady()},qS.prototype.dispatch=function(e,t,r){var n;if(!this.isReady())return!1;for(var i in this._bindings){var o=this._bindings[i];if(!this._options.bindingsMapping[i])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+i+"'");if(o.type===GS){var s=this._samplers[i],a=o.object;s&&a._texture&&s.compareSampler(a._texture)||(this._samplers[i]=(new GR).setParameters(a.wrapU,a.wrapV,a.wrapR,a.anisotropicFilteringLevel,a._texture.samplingMode,null===(n=a._texture)||void 0===n?void 0:n._comparisonFunction),this._contextIsDirty=!0)}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),this._engine.computeDispatch(this._effect,this._context,this._bindings,e,t,r,this._options.bindingsMapping),!0},qS.prototype.dispatchWhenReady=function(e,t,r,n){var i=this;return void 0===n&&(n=10),new Promise((function(o){var s=function(){i.dispatch(e,t,r)?o():setTimeout(s,n)};s()}))};var VS,YS,XS="\n    #extension GL_EXT_samplerless_texture_functions : enable\n\n    const vec2 pos[4] = vec2[4](vec2(-1.0f, 1.0f), vec2(1.0f, 1.0f), vec2(-1.0f, -1.0f), vec2(1.0f, -1.0f));\n    const vec2 tex[4] = vec2[4](vec2(0.0f, 0.0f), vec2(1.0f, 0.0f), vec2(0.0f, 1.0f), vec2(1.0f, 1.0f));\n\n    layout(set = 0, binding = 0) uniform texture2D img;\n\n    #ifdef INVERTY\n        layout(location = 0) out flat ivec2 vTextureSize;\n    #endif\n\n    void main() {\n        #ifdef INVERTY\n            vTextureSize = textureSize(img, 0);\n        #endif\n        gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n    }\n    ",WS=XS;!function(e){e[e.MipMap=0]="MipMap",e[e.InvertYPremultiplyAlpha=1]="InvertYPremultiplyAlpha",e[e.Clear=2]="Clear",e[e.InvertYPremultiplyAlphaWithOfst=3]="InvertYPremultiplyAlphaWithOfst"}(VS||(VS={})),function(e){e[e.DontInvertY=0]="DontInvertY",e[e.InvertY=1]="InvertY"}(YS||(YS={}));var KS=[{vertex:"\n    const vec2 pos[4] = vec2[4](vec2(-1.0f, 1.0f), vec2(1.0f, 1.0f), vec2(-1.0f, -1.0f), vec2(1.0f, -1.0f));\n    const vec2 tex[4] = vec2[4](vec2(0.0f, 0.0f), vec2(1.0f, 0.0f), vec2(0.0f, 1.0f), vec2(1.0f, 1.0f));\n\n    layout(location = 0) out vec2 vTex;\n\n    void main() {\n        vTex = tex[gl_VertexIndex];\n        gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n    }\n    ",fragment:"\n    layout(set = 0, binding = 0) uniform sampler imgSampler;\n    layout(set = 0, binding = 1) uniform texture2D img;\n\n    layout(location = 0) in vec2 vTex;\n    layout(location = 0) out vec4 outColor;\n\n    void main() {\n        outColor = texture(sampler2D(img, imgSampler), vTex);\n    }\n    "},{vertex:XS,fragment:"\n    #extension GL_EXT_samplerless_texture_functions : enable\n\n    layout(set = 0, binding = 0) uniform texture2D img;\n\n    #ifdef INVERTY\n        layout(location = 0) in flat ivec2 vTextureSize;\n    #endif\n    layout(location = 0) out vec4 outColor;\n\n    void main() {\n    #ifdef INVERTY\n        vec4 color = texelFetch(img, ivec2(gl_FragCoord.x, vTextureSize.y - gl_FragCoord.y), 0);\n    #else\n        vec4 color = texelFetch(img, ivec2(gl_FragCoord.xy), 0);\n    #endif\n    #ifdef PREMULTIPLYALPHA\n        color.rgb *= color.a;\n    #endif\n        outColor = color;\n    }\n    "},{vertex:"\n    const vec2 pos[4] = vec2[4](vec2(-1.0f, 1.0f), vec2(1.0f, 1.0f), vec2(-1.0f, -1.0f), vec2(1.0f, -1.0f));\n\n    void main() {\n        gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n    }\n    ",fragment:"\n    layout(set = 0, binding = 0) uniform Uniforms {\n        uniform vec4 color;\n    };\n\n    layout(location = 0) out vec4 outColor;\n\n    void main() {\n        outColor = color;\n    }\n    "},{vertex:WS,fragment:"\n    #extension GL_EXT_samplerless_texture_functions : enable\n\n    layout(set = 0, binding = 0) uniform texture2D img;\n    layout(set = 0, binding = 1) uniform Params {\n        float ofstX;\n        float ofstY;\n        float width;\n        float height;\n    };\n\n    #ifdef INVERTY\n        layout(location = 0) in flat ivec2 vTextureSize;\n    #endif\n    layout(location = 0) out vec4 outColor;\n\n    void main() {\n        if (gl_FragCoord.x < ofstX || gl_FragCoord.x >= ofstX + width) {\n            discard;\n        }\n        if (gl_FragCoord.y < ofstY || gl_FragCoord.y >= ofstY + height) {\n            discard;\n        }\n    #ifdef INVERTY\n        vec4 color = texelFetch(img, ivec2(gl_FragCoord.x, ofstY + height - (gl_FragCoord.y - ofstY)), 0);\n    #else\n        vec4 color = texelFetch(img, ivec2(gl_FragCoord.xy), 0);\n    #endif\n    #ifdef PREMULTIPLYALPHA\n        color.rgb *= color.a;\n    #endif\n        outColor = color;\n    }\n    "}];const JS={"":0,r8unorm:1,r8uint:2,r8sint:3,r16uint:4,r16sint:5,r16float:6,rg8unorm:7,rg8uint:8,rg8sint:9,r32uint:10,r32sint:11,r32float:12,rg16uint:13,rg16sint:14,rg16float:15,rgba8unorm:16,"rgba8unorm-srgb":17,rgba8uint:18,rgba8sint:19,bgra8unorm:20,"bgra8unorm-srgb":21,rgb10a2unorm:22,rg32uint:23,rg32sint:24,rg32float:25,rgba16uint:26,rgba16sint:27,rgba16float:28,rgba32uint:29,rgba32sint:30,rgba32float:31,stencil8:32,depth16unorm:33,depth24plus:34,"depth24plus-stencil8":35,depth32float:36,"depth24unorm-stencil8":37,"depth32float-stencil8":38};function ZS(e,t,r,n,i=void 0){this._pipelines={},this._compiledShaders=[],this._deferredReleaseTextures=[],this._videoPipelines={},this._videoCompiledShaders=[],this._userEngine=i,this._device=e,this._glslang=t,this._tintWASM=r,this._bufferManager=n,this._mipmapSampler=e.createSampler({minFilter:GM.FilterMode.Linear}),this._videoSampler=e.createSampler({minFilter:GM.FilterMode.Linear}),this._ubCopyWithOfst=this._bufferManager.createBuffer(16,GM.BufferUsage.Uniform|GM.BufferUsage.CopyDst).underlyingResource,this._getPipeline(GM.TextureFormat.RGBA8Unorm)}ZS.ComputeNumMipmapLevels=function(e,t){return QM.ILog2(Math.max(e,t))+1},ZS.prototype._getPipeline=function(e,t,r){void 0===t&&(t=VS.MipMap);var n=t===VS.MipMap?1:t===VS.InvertYPremultiplyAlpha?((r.invertY?1:0)<<1)+((r.premultiplyAlpha?1:0)<<2):t===VS.Clear?8:t===VS.InvertYPremultiplyAlphaWithOfst?((r.invertY?1:0)<<4)+((r.premultiplyAlpha?1:0)<<5):0;this._pipelines[e]||(this._pipelines[e]=[]);var i=this._pipelines[e][n];if(!i){var o="#version 450\r\n";t!==VS.InvertYPremultiplyAlpha&&t!==VS.InvertYPremultiplyAlphaWithOfst||(r.invertY&&(o+="#define INVERTY\r\n"),r.premultiplyAlpha&&(o+="#define PREMULTIPLYALPHA\r\n"));var s=this._compiledShaders[n];if(!s){var a=this._glslang.compileGLSL(o+KS[t].vertex,"vertex"),u=this._glslang.compileGLSL(o+KS[t].fragment,"fragment");this._tintWASM&&(a=this._tintWASM.convertSpirV2WGSL(a),u=this._tintWASM.convertSpirV2WGSL(u));var c=this._device.createShaderModule({code:a}),l=this._device.createShaderModule({code:u});s=this._compiledShaders[n]=[c,l]}var h=this._device.createRenderPipeline({layout:GM.AutoLayoutMode.Auto,vertex:{module:s[0],entryPoint:"main"},fragment:{module:s[1],entryPoint:"main",targets:[{format:e}]},primitive:{topology:GM.PrimitiveTopology.TriangleStrip,stripIndexFormat:GM.IndexFormat.Uint16}});i=this._pipelines[e][n]=[h,h.getBindGroupLayout(0)]}return i},ZS.prototype._getVideoPipeline=function(e,t){void 0===t&&(t=YS.DontInvertY);var r=t===YS.InvertY?1:0;this._videoPipelines[e]||(this._videoPipelines[e]=[]);var n=this._videoPipelines[e][r];if(!n){var i=this._videoCompiledShaders[r];if(!i){var o=this._device.createShaderModule({code:"\n    struct VertexOutput {\n        @builtin(position) Position : vec4<f32>,\n        @location(0) fragUV : vec2<f32>\n    }\n  \n    @vertex\n    fn main(\n        @builtin(vertex_index) VertexIndex : u32\n    ) -> VertexOutput {\n        var pos = array<vec2<f32>, 4>(\n            vec2(-1.0,  1.0),\n            vec2( 1.0,  1.0),\n            vec2(-1.0, -1.0),\n            vec2( 1.0, -1.0)\n        );\n        var tex = array<vec2<f32>, 4>(\n            vec2(0.0, 0.0),\n            vec2(1.0, 0.0),\n            vec2(0.0, 1.0),\n            vec2(1.0, 1.0)\n        );\n\n        var output: VertexOutput;\n\n        output.Position = vec4<f32>(pos[VertexIndex], 0.0, 1.0);\n        output.fragUV = tex[VertexIndex];\n\n        return output;\n    }\n    "}),s=this._device.createShaderModule({code:0===r?"\n   @group(0) @binding(0) var videoTexture: texture_external;\n\n    @fragment\n    fn main(\n        @location(0) fragUV: vec2<f32>\n    ) -> @location(0) vec4<f32> {\n        let uv : vec2<i32> = vec2<i32>(i32(fragUV.x), i32(fragUV.y));\n   return textureLoad(videoTexture, uv);\n    }\n":"\n @group(0) @binding(0) var videoTexture: texture_external;\n\n    @fragment\n    fn main(\n        @location(0) fragUV: vec2<f32>\n    ) -> @location(0) vec4<f32> {\n        let uv : vec2<i32> = vec2<i32>(i32(fragUV.x), i32(1 - fragUV.y));\n    return textureLoad(videoTexture, uv);\n    }\n    "});i=this._videoCompiledShaders[r]=[o,s]}var a=this._device.createRenderPipeline({label:"CopyVideoToTexture_".concat(e,"_").concat(0===r?"DontInvertY":"InvertY"),layout:GM.AutoLayoutMode.Auto,vertex:{module:i[0],entryPoint:"main"},fragment:{module:i[1],entryPoint:"main",targets:[{format:e}]},primitive:{topology:GM.PrimitiveTopology.TriangleStrip,stripIndexFormat:GM.IndexFormat.Uint16}});n=this._videoPipelines[e][r]=[a,a.getBindGroupLayout(0)]}return n},ZS._GetTextureTypeFromFormat=function(e){switch(e){case GM.TextureFormat.R8Unorm:case GM.TextureFormat.R8Snorm:case GM.TextureFormat.R8Uint:case GM.TextureFormat.R8Sint:case GM.TextureFormat.RG8Unorm:case GM.TextureFormat.RG8Snorm:case GM.TextureFormat.RG8Uint:case GM.TextureFormat.RG8Sint:case GM.TextureFormat.RGBA8Unorm:case GM.TextureFormat.RGBA8UnormSRGB:case GM.TextureFormat.RGBA8Snorm:case GM.TextureFormat.RGBA8Uint:case GM.TextureFormat.RGBA8Sint:case GM.TextureFormat.BGRA8Unorm:case GM.TextureFormat.BGRA8UnormSRGB:case GM.TextureFormat.RGB10A2Unorm:case GM.TextureFormat.RGB9E5UFloat:case GM.TextureFormat.RG11B10UFloat:case GM.TextureFormat.Depth24UnormStencil8:case GM.TextureFormat.Depth32FloatStencil8:case GM.TextureFormat.BC7RGBAUnorm:case GM.TextureFormat.BC7RGBAUnormSRGB:case GM.TextureFormat.BC6HRGBUFloat:case GM.TextureFormat.BC6HRGBFloat:case GM.TextureFormat.BC5RGUnorm:case GM.TextureFormat.BC5RGSnorm:case GM.TextureFormat.BC3RGBAUnorm:case GM.TextureFormat.BC3RGBAUnormSRGB:case GM.TextureFormat.BC2RGBAUnorm:case GM.TextureFormat.BC2RGBAUnormSRGB:case GM.TextureFormat.BC4RUnorm:case GM.TextureFormat.BC4RSnorm:case GM.TextureFormat.BC1RGBAUnorm:case GM.TextureFormat.BC1RGBAUnormSRGB:case GM.TextureFormat.ETC2RGB8Unorm:case GM.TextureFormat.ETC2RGB8UnormSRGB:case GM.TextureFormat.ETC2RGB8A1Unorm:case GM.TextureFormat.ETC2RGB8A1UnormSRGB:case GM.TextureFormat.ETC2RGBA8Unorm:case GM.TextureFormat.ETC2RGBA8UnormSRGB:case GM.TextureFormat.EACR11Unorm:case GM.TextureFormat.EACR11Snorm:case GM.TextureFormat.EACRG11Unorm:case GM.TextureFormat.EACRG11Snorm:case GM.TextureFormat.ASTC4x4Unorm:case GM.TextureFormat.ASTC4x4UnormSRGB:case GM.TextureFormat.ASTC5x4Unorm:case GM.TextureFormat.ASTC5x4UnormSRGB:case GM.TextureFormat.ASTC5x5Unorm:case GM.TextureFormat.ASTC5x5UnormSRGB:case GM.TextureFormat.ASTC6x5Unorm:case GM.TextureFormat.ASTC6x5UnormSRGB:case GM.TextureFormat.ASTC6x6Unorm:case GM.TextureFormat.ASTC6x6UnormSRGB:case GM.TextureFormat.ASTC8x5Unorm:case GM.TextureFormat.ASTC8x5UnormSRGB:case GM.TextureFormat.ASTC8x6Unorm:case GM.TextureFormat.ASTC8x6UnormSRGB:case GM.TextureFormat.ASTC8x8Unorm:case GM.TextureFormat.ASTC8x8UnormSRGB:case GM.TextureFormat.ASTC10x5Unorm:case GM.TextureFormat.ASTC10x5UnormSRGB:case GM.TextureFormat.ASTC10x6Unorm:case GM.TextureFormat.ASTC10x6UnormSRGB:case GM.TextureFormat.ASTC10x8Unorm:case GM.TextureFormat.ASTC10x8UnormSRGB:case GM.TextureFormat.ASTC10x10Unorm:case GM.TextureFormat.ASTC10x10UnormSRGB:case GM.TextureFormat.ASTC12x10Unorm:case GM.TextureFormat.ASTC12x10UnormSRGB:case GM.TextureFormat.ASTC12x12Unorm:case GM.TextureFormat.ASTC12x12UnormSRGB:return cp.TEXTURETYPE_UNSIGNED_BYTE;case GM.TextureFormat.R16Uint:case GM.TextureFormat.R16Sint:case GM.TextureFormat.RG16Uint:case GM.TextureFormat.RG16Sint:case GM.TextureFormat.RGBA16Uint:case GM.TextureFormat.RGBA16Sint:case GM.TextureFormat.Depth16Unorm:return cp.TEXTURETYPE_UNSIGNED_SHORT;case GM.TextureFormat.R16Float:case GM.TextureFormat.RG16Float:case GM.TextureFormat.RGBA16Float:return cp.TEXTURETYPE_HALF_FLOAT;case GM.TextureFormat.R32Uint:case GM.TextureFormat.R32Sint:case GM.TextureFormat.RG32Uint:case GM.TextureFormat.RG32Sint:case GM.TextureFormat.RGBA32Uint:case GM.TextureFormat.RGBA32Sint:return cp.TEXTURETYPE_UNSIGNED_INTEGER;case GM.TextureFormat.R32Float:case GM.TextureFormat.RG32Float:case GM.TextureFormat.RGBA32Float:case GM.TextureFormat.Depth32Float:return cp.TEXTURETYPE_FLOAT;case GM.TextureFormat.Stencil8:throw"No fixed size for Stencil8 format!";case GM.TextureFormat.Depth24Plus:throw"No fixed size for Depth24Plus format!";case GM.TextureFormat.Depth24PlusStencil8:throw"No fixed size for Depth24PlusStencil8 format!"}return cp.TEXTURETYPE_UNSIGNED_BYTE},ZS._GetBlockInformationFromFormat=function(e){switch(e){case GM.TextureFormat.R8Unorm:case GM.TextureFormat.R8Snorm:case GM.TextureFormat.R8Uint:case GM.TextureFormat.R8Sint:return{width:1,height:1,length:1};case GM.TextureFormat.R16Uint:case GM.TextureFormat.R16Sint:case GM.TextureFormat.R16Float:case GM.TextureFormat.RG8Unorm:case GM.TextureFormat.RG8Snorm:case GM.TextureFormat.RG8Uint:case GM.TextureFormat.RG8Sint:return{width:1,height:1,length:2};case GM.TextureFormat.R32Uint:case GM.TextureFormat.R32Sint:case GM.TextureFormat.R32Float:case GM.TextureFormat.RG16Uint:case GM.TextureFormat.RG16Sint:case GM.TextureFormat.RG16Float:case GM.TextureFormat.RGBA8Unorm:case GM.TextureFormat.RGBA8UnormSRGB:case GM.TextureFormat.RGBA8Snorm:case GM.TextureFormat.RGBA8Uint:case GM.TextureFormat.RGBA8Sint:case GM.TextureFormat.BGRA8Unorm:case GM.TextureFormat.BGRA8UnormSRGB:case GM.TextureFormat.RGB9E5UFloat:case GM.TextureFormat.RGB10A2Unorm:case GM.TextureFormat.RG11B10UFloat:return{width:1,height:1,length:4};case GM.TextureFormat.RG32Uint:case GM.TextureFormat.RG32Sint:case GM.TextureFormat.RG32Float:case GM.TextureFormat.RGBA16Uint:case GM.TextureFormat.RGBA16Sint:case GM.TextureFormat.RGBA16Float:return{width:1,height:1,length:8};case GM.TextureFormat.RGBA32Uint:case GM.TextureFormat.RGBA32Sint:case GM.TextureFormat.RGBA32Float:return{width:1,height:1,length:16};case GM.TextureFormat.Stencil8:throw"No fixed size for Stencil8 format!";case GM.TextureFormat.Depth16Unorm:return{width:1,height:1,length:2};case GM.TextureFormat.Depth24Plus:throw"No fixed size for Depth24Plus format!";case GM.TextureFormat.Depth24PlusStencil8:throw"No fixed size for Depth24PlusStencil8 format!";case GM.TextureFormat.Depth32Float:case GM.TextureFormat.Depth24UnormStencil8:return{width:1,height:1,length:4};case GM.TextureFormat.Depth32FloatStencil8:return{width:1,height:1,length:5};case GM.TextureFormat.BC7RGBAUnorm:case GM.TextureFormat.BC7RGBAUnormSRGB:case GM.TextureFormat.BC6HRGBUFloat:case GM.TextureFormat.BC6HRGBFloat:case GM.TextureFormat.BC5RGUnorm:case GM.TextureFormat.BC5RGSnorm:case GM.TextureFormat.BC3RGBAUnorm:case GM.TextureFormat.BC3RGBAUnormSRGB:case GM.TextureFormat.BC2RGBAUnorm:case GM.TextureFormat.BC2RGBAUnormSRGB:return{width:4,height:4,length:16};case GM.TextureFormat.BC4RUnorm:case GM.TextureFormat.BC4RSnorm:case GM.TextureFormat.BC1RGBAUnorm:case GM.TextureFormat.BC1RGBAUnormSRGB:case GM.TextureFormat.ETC2RGB8Unorm:case GM.TextureFormat.ETC2RGB8UnormSRGB:case GM.TextureFormat.ETC2RGB8A1Unorm:case GM.TextureFormat.ETC2RGB8A1UnormSRGB:case GM.TextureFormat.EACR11Unorm:case GM.TextureFormat.EACR11Snorm:return{width:4,height:4,length:8};case GM.TextureFormat.ETC2RGBA8Unorm:case GM.TextureFormat.ETC2RGBA8UnormSRGB:case GM.TextureFormat.EACRG11Unorm:case GM.TextureFormat.EACRG11Snorm:case GM.TextureFormat.ASTC4x4Unorm:case GM.TextureFormat.ASTC4x4UnormSRGB:return{width:4,height:4,length:16};case GM.TextureFormat.ASTC5x4Unorm:case GM.TextureFormat.ASTC5x4UnormSRGB:return{width:5,height:4,length:16};case GM.TextureFormat.ASTC5x5Unorm:case GM.TextureFormat.ASTC5x5UnormSRGB:return{width:5,height:5,length:16};case GM.TextureFormat.ASTC6x5Unorm:case GM.TextureFormat.ASTC6x5UnormSRGB:return{width:6,height:5,length:16};case GM.TextureFormat.ASTC6x6Unorm:case GM.TextureFormat.ASTC6x6UnormSRGB:return{width:6,height:6,length:16};case GM.TextureFormat.ASTC8x5Unorm:case GM.TextureFormat.ASTC8x5UnormSRGB:return{width:8,height:5,length:16};case GM.TextureFormat.ASTC8x6Unorm:case GM.TextureFormat.ASTC8x6UnormSRGB:return{width:8,height:6,length:16};case GM.TextureFormat.ASTC8x8Unorm:case GM.TextureFormat.ASTC8x8UnormSRGB:return{width:8,height:8,length:16};case GM.TextureFormat.ASTC10x5Unorm:case GM.TextureFormat.ASTC10x5UnormSRGB:return{width:10,height:5,length:16};case GM.TextureFormat.ASTC10x6Unorm:case GM.TextureFormat.ASTC10x6UnormSRGB:return{width:10,height:6,length:16};case GM.TextureFormat.ASTC10x8Unorm:case GM.TextureFormat.ASTC10x8UnormSRGB:return{width:10,height:8,length:16};case GM.TextureFormat.ASTC10x10Unorm:case GM.TextureFormat.ASTC10x10UnormSRGB:return{width:10,height:10,length:16};case GM.TextureFormat.ASTC12x10Unorm:case GM.TextureFormat.ASTC12x10UnormSRGB:return{width:12,height:10,length:16};case GM.TextureFormat.ASTC12x12Unorm:case GM.TextureFormat.ASTC12x12UnormSRGB:return{width:12,height:12,length:16}}return{width:1,height:1,length:4}},ZS._IsHardwareTexture=function(e){return!!e.release},ZS._IsInternalTexture=function(e){return!!e.dispose},ZS.IsImageBitmap=function(e){return void 0!==e.close},ZS.IsImageBitmapArray=function(e){return Array.isArray(e)&&void 0!==e[0].close},ZS.prototype.setCommandEncoder=function(e){this._commandEncoderForCreation=e},ZS.IsCompressedFormat=function(e){switch(e){case GM.TextureFormat.BC7RGBAUnormSRGB:case GM.TextureFormat.BC7RGBAUnorm:case GM.TextureFormat.BC6HRGBFloat:case GM.TextureFormat.BC6HRGBUFloat:case GM.TextureFormat.BC5RGSnorm:case GM.TextureFormat.BC5RGUnorm:case GM.TextureFormat.BC4RSnorm:case GM.TextureFormat.BC4RUnorm:case GM.TextureFormat.BC3RGBAUnormSRGB:case GM.TextureFormat.BC3RGBAUnorm:case GM.TextureFormat.BC2RGBAUnormSRGB:case GM.TextureFormat.BC2RGBAUnorm:case GM.TextureFormat.BC1RGBAUnormSRGB:case GM.TextureFormat.BC1RGBAUnorm:case GM.TextureFormat.ETC2RGB8Unorm:case GM.TextureFormat.ETC2RGB8UnormSRGB:case GM.TextureFormat.ETC2RGB8A1Unorm:case GM.TextureFormat.ETC2RGB8A1UnormSRGB:case GM.TextureFormat.ETC2RGBA8Unorm:case GM.TextureFormat.ETC2RGBA8UnormSRGB:case GM.TextureFormat.EACR11Unorm:case GM.TextureFormat.EACR11Snorm:case GM.TextureFormat.EACRG11Unorm:case GM.TextureFormat.EACRG11Snorm:case GM.TextureFormat.ASTC4x4Unorm:case GM.TextureFormat.ASTC4x4UnormSRGB:case GM.TextureFormat.ASTC5x4Unorm:case GM.TextureFormat.ASTC5x4UnormSRGB:case GM.TextureFormat.ASTC5x5Unorm:case GM.TextureFormat.ASTC5x5UnormSRGB:case GM.TextureFormat.ASTC6x5Unorm:case GM.TextureFormat.ASTC6x5UnormSRGB:case GM.TextureFormat.ASTC6x6Unorm:case GM.TextureFormat.ASTC6x6UnormSRGB:case GM.TextureFormat.ASTC8x5Unorm:case GM.TextureFormat.ASTC8x5UnormSRGB:case GM.TextureFormat.ASTC8x6Unorm:case GM.TextureFormat.ASTC8x6UnormSRGB:case GM.TextureFormat.ASTC8x8Unorm:case GM.TextureFormat.ASTC8x8UnormSRGB:case GM.TextureFormat.ASTC10x5Unorm:case GM.TextureFormat.ASTC10x5UnormSRGB:case GM.TextureFormat.ASTC10x6Unorm:case GM.TextureFormat.ASTC10x6UnormSRGB:case GM.TextureFormat.ASTC10x8Unorm:case GM.TextureFormat.ASTC10x8UnormSRGB:case GM.TextureFormat.ASTC10x10Unorm:case GM.TextureFormat.ASTC10x10UnormSRGB:case GM.TextureFormat.ASTC12x10Unorm:case GM.TextureFormat.ASTC12x10UnormSRGB:case GM.TextureFormat.ASTC12x12Unorm:case GM.TextureFormat.ASTC12x12UnormSRGB:return!0}return!1},ZS.GetWebGPUTextureFormat=function(e,t,r){switch(void 0===r&&(r=!1),t){case cp.TEXTUREFORMAT_DEPTH16:return GM.TextureFormat.Depth16Unorm;case cp.TEXTUREFORMAT_DEPTH24:return GM.TextureFormat.Depth24Plus;case cp.TEXTUREFORMAT_DEPTH24_STENCIL8:return GM.TextureFormat.Depth24PlusStencil8;case cp.TEXTUREFORMAT_DEPTH32_FLOAT:return GM.TextureFormat.Depth32Float;case cp.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8:return GM.TextureFormat.Depth24UnormStencil8;case cp.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8:return GM.TextureFormat.Depth32FloatStencil8;case cp.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM:return r?GM.TextureFormat.BC7RGBAUnormSRGB:GM.TextureFormat.BC7RGBAUnorm;case cp.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT:return GM.TextureFormat.BC6HRGBUFloat;case cp.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT:return GM.TextureFormat.BC6HRGBFloat;case cp.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5:return r?GM.TextureFormat.BC3RGBAUnormSRGB:GM.TextureFormat.BC3RGBAUnorm;case cp.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3:return r?GM.TextureFormat.BC2RGBAUnormSRGB:GM.TextureFormat.BC2RGBAUnorm;case cp.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1:case cp.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1:return r?GM.TextureFormat.BC1RGBAUnormSRGB:GM.TextureFormat.BC1RGBAUnorm;case cp.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4:return r?GM.TextureFormat.ASTC4x4UnormSRGB:GM.TextureFormat.ASTC4x4Unorm;case cp.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL:case cp.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2:return r?GM.TextureFormat.ETC2RGB8UnormSRGB:GM.TextureFormat.ETC2RGB8Unorm;case cp.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC:return r?GM.TextureFormat.ETC2RGBA8UnormSRGB:GM.TextureFormat.ETC2RGBA8Unorm}switch(e){case cp.TEXTURETYPE_BYTE:switch(t){case cp.TEXTUREFORMAT_RED:return GM.TextureFormat.R8Snorm;case cp.TEXTUREFORMAT_RG:return GM.TextureFormat.RG8Snorm;case cp.TEXTUREFORMAT_RGB:throw"RGB format not supported in WebGPU";case cp.TEXTUREFORMAT_RED_INTEGER:return GM.TextureFormat.R8Sint;case cp.TEXTUREFORMAT_RG_INTEGER:return GM.TextureFormat.RG8Sint;case cp.TEXTUREFORMAT_RGB_INTEGER:throw"RGB_INTEGER format not supported in WebGPU";case cp.TEXTUREFORMAT_RGBA_INTEGER:return GM.TextureFormat.RGBA8Sint;default:return GM.TextureFormat.RGBA8Snorm}case cp.TEXTURETYPE_UNSIGNED_BYTE:switch(t){case cp.TEXTUREFORMAT_RED:return GM.TextureFormat.R8Unorm;case cp.TEXTUREFORMAT_RG:return GM.TextureFormat.RG8Unorm;case cp.TEXTUREFORMAT_RGB:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";case cp.TEXTUREFORMAT_RGBA:return r?GM.TextureFormat.RGBA8UnormSRGB:GM.TextureFormat.RGBA8Unorm;case cp.TEXTUREFORMAT_BGRA:return r?GM.TextureFormat.BGRA8UnormSRGB:GM.TextureFormat.BGRA8Unorm;case cp.TEXTUREFORMAT_RED_INTEGER:return GM.TextureFormat.R8Uint;case cp.TEXTUREFORMAT_RG_INTEGER:return GM.TextureFormat.RG8Uint;case cp.TEXTUREFORMAT_RGB_INTEGER:throw"RGB_INTEGER format not supported in WebGPU";case cp.TEXTUREFORMAT_RGBA_INTEGER:return GM.TextureFormat.RGBA8Uint;case cp.TEXTUREFORMAT_ALPHA:throw"TEXTUREFORMAT_ALPHA format not supported in WebGPU";case cp.TEXTUREFORMAT_LUMINANCE:throw"TEXTUREFORMAT_LUMINANCE format not supported in WebGPU";case cp.TEXTUREFORMAT_LUMINANCE_ALPHA:throw"TEXTUREFORMAT_LUMINANCE_ALPHA format not supported in WebGPU";default:return GM.TextureFormat.RGBA8Unorm}case cp.TEXTURETYPE_SHORT:switch(t){case cp.TEXTUREFORMAT_RED_INTEGER:return GM.TextureFormat.R16Sint;case cp.TEXTUREFORMAT_RG_INTEGER:return GM.TextureFormat.RG16Sint;case cp.TEXTUREFORMAT_RGB_INTEGER:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";case cp.TEXTUREFORMAT_RGBA_INTEGER:default:return GM.TextureFormat.RGBA16Sint}case cp.TEXTURETYPE_UNSIGNED_SHORT:switch(t){case cp.TEXTUREFORMAT_RED_INTEGER:return GM.TextureFormat.R16Uint;case cp.TEXTUREFORMAT_RG_INTEGER:return GM.TextureFormat.RG16Uint;case cp.TEXTUREFORMAT_RGB_INTEGER:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";case cp.TEXTUREFORMAT_RGBA_INTEGER:default:return GM.TextureFormat.RGBA16Uint}case cp.TEXTURETYPE_INT:switch(t){case cp.TEXTUREFORMAT_RED_INTEGER:return GM.TextureFormat.R32Sint;case cp.TEXTUREFORMAT_RG_INTEGER:return GM.TextureFormat.RG32Sint;case cp.TEXTUREFORMAT_RGB_INTEGER:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";case cp.TEXTUREFORMAT_RGBA_INTEGER:default:return GM.TextureFormat.RGBA32Sint}case cp.TEXTURETYPE_UNSIGNED_INTEGER:switch(t){case cp.TEXTUREFORMAT_RED_INTEGER:return GM.TextureFormat.R32Uint;case cp.TEXTUREFORMAT_RG_INTEGER:return GM.TextureFormat.RG32Uint;case cp.TEXTUREFORMAT_RGB_INTEGER:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";case cp.TEXTUREFORMAT_RGBA_INTEGER:default:return GM.TextureFormat.RGBA32Uint}case cp.TEXTURETYPE_FLOAT:switch(t){case cp.TEXTUREFORMAT_RED:return GM.TextureFormat.R32Float;case cp.TEXTUREFORMAT_RG:return GM.TextureFormat.RG32Float;case cp.TEXTUREFORMAT_RGB:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";case cp.TEXTUREFORMAT_RGBA:default:return GM.TextureFormat.RGBA32Float}case cp.TEXTURETYPE_HALF_FLOAT:switch(t){case cp.TEXTUREFORMAT_RED:return GM.TextureFormat.R16Float;case cp.TEXTUREFORMAT_RG:return GM.TextureFormat.RG16Float;case cp.TEXTUREFORMAT_RGB:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";case cp.TEXTUREFORMAT_RGBA:default:return GM.TextureFormat.RGBA16Float}case cp.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:throw"TEXTURETYPE_UNSIGNED_SHORT_5_6_5 format not supported in WebGPU";case cp.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:throw"TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV format not supported in WebGPU";case cp.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:throw"TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV format not supported in WebGPU";case cp.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:throw"TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4 format not supported in WebGPU";case cp.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:throw"TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1 format not supported in WebGPU";case cp.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(t){case cp.TEXTUREFORMAT_RGBA:return GM.TextureFormat.RGB10A2Unorm;case cp.TEXTUREFORMAT_RGBA_INTEGER:throw"TEXTUREFORMAT_RGBA_INTEGER format not supported in WebGPU when type is TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV";default:return GM.TextureFormat.RGB10A2Unorm}}return r?GM.TextureFormat.RGBA8UnormSRGB:GM.TextureFormat.RGBA8Unorm},ZS.GetNumChannelsFromWebGPUTextureFormat=function(e){switch(e){case GM.TextureFormat.R8Unorm:case GM.TextureFormat.R8Snorm:case GM.TextureFormat.R8Uint:case GM.TextureFormat.R8Sint:case GM.TextureFormat.BC4RUnorm:case GM.TextureFormat.BC4RSnorm:case GM.TextureFormat.R16Uint:case GM.TextureFormat.R16Sint:case GM.TextureFormat.Depth16Unorm:case GM.TextureFormat.R16Float:case GM.TextureFormat.R32Uint:case GM.TextureFormat.R32Sint:case GM.TextureFormat.R32Float:case GM.TextureFormat.Depth32Float:case GM.TextureFormat.Stencil8:case GM.TextureFormat.Depth24Plus:case GM.TextureFormat.EACR11Unorm:case GM.TextureFormat.EACR11Snorm:return 1;case GM.TextureFormat.RG8Unorm:case GM.TextureFormat.RG8Snorm:case GM.TextureFormat.RG8Uint:case GM.TextureFormat.RG8Sint:case GM.TextureFormat.Depth24UnormStencil8:case GM.TextureFormat.Depth32FloatStencil8:case GM.TextureFormat.BC5RGUnorm:case GM.TextureFormat.BC5RGSnorm:case GM.TextureFormat.RG16Uint:case GM.TextureFormat.RG16Sint:case GM.TextureFormat.RG16Float:case GM.TextureFormat.RG32Uint:case GM.TextureFormat.RG32Sint:case GM.TextureFormat.RG32Float:case GM.TextureFormat.Depth24PlusStencil8:case GM.TextureFormat.EACRG11Unorm:case GM.TextureFormat.EACRG11Snorm:return 2;case GM.TextureFormat.RGB9E5UFloat:case GM.TextureFormat.RG11B10UFloat:case GM.TextureFormat.BC6HRGBUFloat:case GM.TextureFormat.BC6HRGBFloat:case GM.TextureFormat.ETC2RGB8Unorm:case GM.TextureFormat.ETC2RGB8UnormSRGB:return 3;case GM.TextureFormat.RGBA8Unorm:case GM.TextureFormat.RGBA8UnormSRGB:case GM.TextureFormat.RGBA8Snorm:case GM.TextureFormat.RGBA8Uint:case GM.TextureFormat.RGBA8Sint:case GM.TextureFormat.BGRA8Unorm:case GM.TextureFormat.BGRA8UnormSRGB:case GM.TextureFormat.RGB10A2Unorm:case GM.TextureFormat.BC7RGBAUnorm:case GM.TextureFormat.BC7RGBAUnormSRGB:case GM.TextureFormat.BC3RGBAUnorm:case GM.TextureFormat.BC3RGBAUnormSRGB:case GM.TextureFormat.BC2RGBAUnorm:case GM.TextureFormat.BC2RGBAUnormSRGB:case GM.TextureFormat.BC1RGBAUnorm:case GM.TextureFormat.BC1RGBAUnormSRGB:case GM.TextureFormat.RGBA16Uint:case GM.TextureFormat.RGBA16Sint:case GM.TextureFormat.RGBA16Float:case GM.TextureFormat.RGBA32Uint:case GM.TextureFormat.RGBA32Sint:case GM.TextureFormat.RGBA32Float:case GM.TextureFormat.ETC2RGB8A1Unorm:case GM.TextureFormat.ETC2RGB8A1UnormSRGB:case GM.TextureFormat.ETC2RGBA8Unorm:case GM.TextureFormat.ETC2RGBA8UnormSRGB:case GM.TextureFormat.ASTC4x4Unorm:case GM.TextureFormat.ASTC4x4UnormSRGB:case GM.TextureFormat.ASTC5x4Unorm:case GM.TextureFormat.ASTC5x4UnormSRGB:case GM.TextureFormat.ASTC5x5Unorm:case GM.TextureFormat.ASTC5x5UnormSRGB:case GM.TextureFormat.ASTC6x5Unorm:case GM.TextureFormat.ASTC6x5UnormSRGB:case GM.TextureFormat.ASTC6x6Unorm:case GM.TextureFormat.ASTC6x6UnormSRGB:case GM.TextureFormat.ASTC8x5Unorm:case GM.TextureFormat.ASTC8x5UnormSRGB:case GM.TextureFormat.ASTC8x6Unorm:case GM.TextureFormat.ASTC8x6UnormSRGB:case GM.TextureFormat.ASTC8x8Unorm:case GM.TextureFormat.ASTC8x8UnormSRGB:case GM.TextureFormat.ASTC10x5Unorm:case GM.TextureFormat.ASTC10x5UnormSRGB:case GM.TextureFormat.ASTC10x6Unorm:case GM.TextureFormat.ASTC10x6UnormSRGB:case GM.TextureFormat.ASTC10x8Unorm:case GM.TextureFormat.ASTC10x8UnormSRGB:case GM.TextureFormat.ASTC10x10Unorm:case GM.TextureFormat.ASTC10x10UnormSRGB:case GM.TextureFormat.ASTC12x10Unorm:case GM.TextureFormat.ASTC12x10UnormSRGB:case GM.TextureFormat.ASTC12x12Unorm:case GM.TextureFormat.ASTC12x12UnormSRGB:return 4}throw"Unknown format ".concat(e,"!")},ZS.HasStencilAspect=function(e){switch(e){case GM.TextureFormat.Stencil8:case GM.TextureFormat.Depth24UnormStencil8:case GM.TextureFormat.Depth32FloatStencil8:case GM.TextureFormat.Depth24PlusStencil8:return!0}return!1},ZS.HasDepthAndStencilAspects=function(e){switch(e){case GM.TextureFormat.Depth24UnormStencil8:case GM.TextureFormat.Depth32FloatStencil8:case GM.TextureFormat.Depth24PlusStencil8:return!0}return!1},ZS.prototype.copyVideoToTexture=function(e,t,r,n,i){var o,s,a,u;void 0===n&&(n=!1);var c=void 0===i,l=this._getVideoPipeline(r,n?YS.InvertY:YS.DontInvertY),h=l[0],p=l[1];c&&(i=this._device.createCommandEncoder({})),null===(s=(o=i).pushDebugGroup)||void 0===s||s.call(o,"copy video to texture - invertY=".concat(n));var d={colorAttachments:[{view:t._hardwareTexture.underlyingResource.createView({format:r,dimension:GM.TextureViewDimension.E2d,mipLevelCount:1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:1,aspect:GM.TextureAspect.All}),loadOp:GM.LoadOp.Load,storeOp:GM.StoreOp.Store}]},f=i.beginRenderPass(d),A={layout:p,entries:[{binding:0,resource:this._device.importExternalTexture({source:e.underlyingResource})}]},g=this._device.createBindGroup(A);f.setPipeline(h),f.setBindGroup(0,g),f.draw(4,1,0,0),f.end(),null===(u=(a=i).popDebugGroup)||void 0===u||u.call(a),c&&(this._device.queue.submit([i.finish()]),i=null)},ZS.prototype.invertYPreMultiplyAlpha=function(e,t,r,n,i,o,s,a,u,c,l,h,p,d,f){var A,g,_,m,y,E;void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=1),void 0===c&&(c=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===p&&(p=0);var x,C=0!==h,b=void 0===d,I=this._getPipeline(n,C?VS.InvertYPremultiplyAlphaWithOfst:VS.InvertYPremultiplyAlpha,{invertY:i,premultiplyAlpha:o}),T=I[0],v=I[1];if(s=Math.max(s,0),b&&(d=this._device.createCommandEncoder({})),null===(g=(A=d).pushDebugGroup)||void 0===g||g.call(A,"internal process texture - invertY=".concat(i," premultiplyAlpha=").concat(o)),ZS._IsHardwareTexture(e)?(x=e.underlyingResource,i&&!o&&1===u&&0===s||(e=void 0)):(x=e,e=void 0),x){C&&this._bufferManager.setRawData(this._ubCopyWithOfst,0,new Float32Array([c,l,h,p]),0,16);var R=e,M=null!==(_=null==R?void 0:R._copyInvertYTempTexture)&&void 0!==_?_:this.createTexture({width:t,height:r,layers:1},!1,!1,!1,!1,!1,n,1,d,GM.TextureUsage.CopySrc|GM.TextureUsage.RenderAttachment|GM.TextureUsage.TextureBinding),w=null!==(m=null==R?void 0:R._copyInvertYRenderPassDescr)&&void 0!==m?m:{colorAttachments:[{view:M.createView({format:n,dimension:GM.TextureViewDimension.E2d,baseMipLevel:0,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:0}),loadOp:GM.LoadOp.Load,storeOp:GM.StoreOp.Store}]},S=d.beginRenderPass(w),B=C?null==R?void 0:R._copyInvertYBindGroupWithOfst:null==R?void 0:R._copyInvertYBindGroup;if(!B){var O={layout:v,entries:[{binding:0,resource:x.createView({format:n,dimension:GM.TextureViewDimension.E2d,baseMipLevel:a,mipLevelCount:1,arrayLayerCount:u,baseArrayLayer:s})}]};C&&O.entries.push({binding:1,resource:{buffer:this._ubCopyWithOfst}}),B=this._device.createBindGroup(O)}S.setPipeline(T),S.setBindGroup(0,B),S.draw(4,1,0,0),S.end(),d.copyTextureToTexture({texture:M},{texture:x,mipLevel:a,origin:{x:0,y:0,z:s}},{width:t,height:r,depthOrArrayLayers:1}),R?(R._copyInvertYTempTexture=M,R._copyInvertYRenderPassDescr=w,C?R._copyInvertYBindGroupWithOfst=B:R._copyInvertYBindGroup=B):this._deferredReleaseTextures.push([M,null]),null===(E=(y=d).popDebugGroup)||void 0===E||E.call(y),b&&(this._device.queue.submit([d.finish()]),d=null)}},ZS.prototype.copyWithInvertY=function(e,t,r,n){var i,o,s,a,u=void 0===n,c=this._getPipeline(t,VS.InvertYPremultiplyAlpha,{invertY:!0,premultiplyAlpha:!1}),l=c[0],h=c[1];u&&(n=this._device.createCommandEncoder({})),null===(o=(i=n).pushDebugGroup)||void 0===o||o.call(i,"internal copy texture with invertY");var p=n.beginRenderPass(r),d=this._device.createBindGroup({layout:h,entries:[{binding:0,resource:e}]});p.setPipeline(l),p.setBindGroup(0,d),p.draw(4,1,0,0),p.end(),null===(a=(s=n).popDebugGroup)||void 0===a||a.call(s),u&&(this._device.queue.submit([n.finish()]),n=null)},ZS.prototype.createTexture=function(e,t,r,n,i,o,s,a,u,c,l,h){void 0===t&&(t=!1),void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===s&&(s=GM.TextureFormat.RGBA8Unorm),void 0===a&&(a=1),void 0===c&&(c=-1),void 0===l&&(l=0),void 0===h&&(h=1),a>1&&(a=4);var p=e.layers||1,d={width:e.width,height:e.height,depthOrArrayLayers:p},f=ZS.IsCompressedFormat(s),A=t?ZS.ComputeNumMipmapLevels(e.width,e.height):1;h>1&&(A=h);var g=c>=0?c:GM.TextureUsage.CopySrc|GM.TextureUsage.CopyDst|GM.TextureUsage.TextureBinding;l|=t&&!f?GM.TextureUsage.CopySrc|GM.TextureUsage.RenderAttachment:0,f||o||(l|=GM.TextureUsage.RenderAttachment|GM.TextureUsage.CopyDst);var _=this._device.createTexture({size:d,dimension:o?GM.TextureDimension.E3d:GM.TextureDimension.E2d,format:s,usage:g|l,sampleCount:a,mipLevelCount:A});return ZS.IsImageBitmap(e)&&(this.updateTexture(e,_,e.width,e.height,p,s,0,0,n,i,0,0),t&&r&&this.generateMipmaps(_,s,A,0,u)),_},ZS.prototype.createCubeTexture=function(e,t,r,n,i,o,s,a,u,c){void 0===t&&(t=!1),void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===i&&(i=!1),void 0===o&&(o=GM.TextureFormat.RGBA8Unorm),void 0===s&&(s=1),void 0===u&&(u=-1),void 0===c&&(c=0),s>1&&(s=4);var l=ZS.IsImageBitmapArray(e)?e[0].width:e.width,h=ZS.IsImageBitmapArray(e)?e[0].height:e.height,p=ZS.IsCompressedFormat(o),d=t?ZS.ComputeNumMipmapLevels(l,h):1,f=u>=0?u:GM.TextureUsage.CopySrc|GM.TextureUsage.CopyDst|GM.TextureUsage.TextureBinding;c|=t&&!p?GM.TextureUsage.CopySrc|GM.TextureUsage.RenderAttachment:0,p||(c|=GM.TextureUsage.RenderAttachment|GM.TextureUsage.CopyDst);var A=this._device.createTexture({size:{width:l,height:h,depthOrArrayLayers:6},dimension:GM.TextureDimension.E2d,format:o,usage:f|c,sampleCount:s,mipLevelCount:d});return ZS.IsImageBitmapArray(e)&&(this.updateCubeTextures(e,A,l,h,o,n,i,0,0),t&&r&&this.generateCubeMipmaps(A,o,d,a)),A},ZS.prototype.generateCubeMipmaps=function(e,t,r,n){var i,o,s,a,u=void 0===n;u&&(n=this._device.createCommandEncoder({})),null===(o=(i=n).pushDebugGroup)||void 0===o||o.call(i,"create cube mipmaps - ".concat(r," levels"));for(var c=0;c<6;++c)this.generateMipmaps(e,t,r,c,n);null===(a=(s=n).popDebugGroup)||void 0===a||a.call(s),u&&(this._device.queue.submit([n.finish()]),n=null)},ZS.prototype.generateMipmaps=function(e,t,r,n,i){var o,s,a,u,c,l,h,p;void 0===n&&(n=0);var d,f=void 0===i,A=this._getPipeline(t),g=A[0],_=A[1];if(n=Math.max(n,0),f&&(i=this._device.createCommandEncoder({})),null===(s=(o=i).pushDebugGroup)||void 0===s||s.call(o,"create mipmaps for face #".concat(n," - ").concat(r," levels")),ZS._IsHardwareTexture(e)?(d=e.underlyingResource,e._mipmapGenRenderPassDescr=e._mipmapGenRenderPassDescr||[],e._mipmapGenBindGroup=e._mipmapGenBindGroup||[]):(d=e,e=void 0),d){for(var m=e,y=1;y<r;++y){var E=null!==(u=null===(a=null==m?void 0:m._mipmapGenRenderPassDescr[n])||void 0===a?void 0:a[y-1])&&void 0!==u?u:{colorAttachments:[{view:d.createView({format:t,dimension:GM.TextureViewDimension.E2d,baseMipLevel:y,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:n}),loadOp:GM.LoadOp.Load,storeOp:GM.StoreOp.Store}]};m&&(m._mipmapGenRenderPassDescr[n]=m._mipmapGenRenderPassDescr[n]||[],m._mipmapGenRenderPassDescr[n][y-1]=E);var x=i.beginRenderPass(E),C=null!==(l=null===(c=null==m?void 0:m._mipmapGenBindGroup[n])||void 0===c?void 0:c[y-1])&&void 0!==l?l:this._device.createBindGroup({layout:_,entries:[{binding:0,resource:this._mipmapSampler},{binding:1,resource:d.createView({format:t,dimension:GM.TextureViewDimension.E2d,baseMipLevel:y-1,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:n})}]});m&&(m._mipmapGenBindGroup[n]=m._mipmapGenBindGroup[n]||[],m._mipmapGenBindGroup[n][y-1]=C),x.setPipeline(g),x.setBindGroup(0,C),x.draw(4,1,0,0),x.end()}null===(p=(h=i).popDebugGroup)||void 0===p||p.call(h),f&&(this._device.queue.submit([i.finish()]),i=null)}},ZS.prototype.generateMipmapsByCS=async function(e,t,r,n,i){var o=t._texture._hardwareTexture.underlyingResource,s=this._userEngine;const a=e,u=new ww(s);u.addUniform("srcDimension",1),u.addUniform("texelSize",2);var c=new ww(s);c.addUniform("texelSize",2);var l=a._texture.width,h=a._texture.height,p=new dp(s,l*h*4*4),d=new dp(s,l*h*4*4),f=new qS("texSamplerCS",s,{computeSource:"\nstruct Rgba {\n    R : f32,\n    G : f32,\n    B : f32,\n    A : f32,\n};\n\nstruct ColorBuffer {\n    colors : array<Rgba>,\n};\n\nstruct Params {\n    srcDimension : u32,\n    texelSize : vec2<f32>, \n};\n\n\nfn linear2Gamma(linearRGB : vec3<f32>) -> vec3<f32>\n{\n    if(linearRGB.x < 0.0031308 && linearRGB.y < 0.0031308\n    && linearRGB.z < 0.0031308){\n        return 12.92 * linearRGB;\n    }else{\n        return 1.13005 * sqrt(abs(linearRGB - vec3<f32>(0.00228,0.00228,0.00228))) - 0.13448 * linearRGB \n        +  vec3<f32>(0.005719,0.005719,0.005719);   \n    }\n}\n\nfn packColor(srcColor : vec4<f32>) -> vec4<f32>\n{\n#ifdef CONVERT_TO_SRGB\n    return float4(linear2Gamma(srcColor.xyz), srcColor.w);\n#else\n    return srcColor;\n#endif\n}\n\n@group(0) @binding(0) var<uniform> params : Params;\n@group(0) @binding(1) var<storage, read_write> buffer_out : ColorBuffer;\n@group(0) @binding(2) var oriDepthTexture : texture_depth_2d;\n@group(0) @binding(2) var oriTexture : texture_2d<f32>;\n@group(0) @binding(3) var mip0Texture : texture_storage_2d<rgba8unorm, write>;\n\n// pass0 Mip\n@compute @workgroup_size(8, 8, 1)\nfn main(@builtin(global_invocation_id) global_id : vec3<u32>) \n{\n    var texelSize = params.texelSize;\n\n    // 2n\n    var srcDimension : u32 = params.srcDimension;\n    var pix : vec4<f32> = vec4<f32>(0, 0, 0, 1);\n\n    #if _useDepthTexture\n        let depth : f32 = textureLoad(oriDepthTexture, vec2<i32>(global_id.xy), 0);\n        pix = vec4<f32>(depth, 0., 0., 1.);\n    #else\n        pix= packColor(textureLoad(oriTexture, vec2<i32>(global_id.xy), 0));\n    #endif\n   \n    let offSet = global_id.x + global_id.y * u32(texelSize.x);\n    let rgba : Rgba = Rgba(pix.x, pix.y, pix.z, pix.w);\n    buffer_out.colors[offSet] = rgba;\n    textureStore(mip0Texture, vec2<i32>(global_id.xy), pix);\n}\n"},{bindingsMapping:r?{params:{group:0,binding:0},buffer_out:{group:0,binding:1},oriDepthTexture:{group:0,binding:2},mip0Texture:{group:0,binding:3}}:{params:{group:0,binding:0},buffer_out:{group:0,binding:1},oriTexture:{group:0,binding:2},mip0Texture:{group:0,binding:3}},defines:[r?"_useDepthTexture":""]}),A=new qS("generateMipCS",s,{computeSource:"\nstruct Rgba {\n    R : f32,\n    G : f32,\n    B : f32,\n    A : f32,\n};\n\n\nstruct ColorBuffer {\n    colors : array<Rgba>,\n};\n\nstruct Params {\n    texelSize : vec2<f32>, \n};\n\nfn nearAverage(a : Rgba, b : Rgba, c : Rgba, d : Rgba) -> Rgba\n{\n    let sumR  = dot(vec4<f32>(a.R, b.R, c.R, d.R), vec4<f32>(1.0));\n    let sumG  = dot(vec4<f32>(a.G, b.G, c.G, d.G), vec4<f32>(1.0));\n    let sumB  = dot(vec4<f32>(a.B, b.B, c.B, d.B), vec4<f32>(1.0));\n    let sumA  = dot(vec4<f32>(a.A, b.A, c.A, d.A), vec4<f32>(1.0));\n\n    return Rgba(sumR/4.0, sumG/4.0, sumB/4.0, sumA/4.0);\n}\n\nfn maxDepthValue(a : Rgba, b : Rgba, c : Rgba, d : Rgba) -> Rgba\n{\n    var resColor : vec4<f32> = max(max(vec4<f32>(a.R, a.G, a.B, a.A), vec4<f32>(b.R, b.G, b.B, b.A)), max(vec4<f32>(c.R, c.G, c.B, c.A), vec4<f32>(d.R, d.G, d.B, d.A)));\n    return Rgba(resColor.x, resColor.y, resColor.z, resColor.w);\n}\n\n@group(0) @binding(0) var<uniform> params : Params;\n@group(0) @binding(1) var<storage, read> buffer_in : ColorBuffer;\n@group(0) @binding(2) var<storage, read_write> buffer_out : ColorBuffer;\n@group(0) @binding(3) var mipMapsTexture : texture_storage_2d<rgba8unorm, write>;\n\n// pass1 mip\n@compute @workgroup_size(8, 8, 1)\nfn main(@builtin(global_invocation_id) global_id : vec3<u32>) \n{\n    if(all(global_id.xy < vec2<u32>(textureDimensions(mipMapsTexture)))){\n        let width = u32(params.texelSize.x);\n        let dst_offSet = global_id.x + global_id.y * width;\n        let src_offSet = global_id.x*2u + global_id.y*2u * width*2u;\n\n        let texel1 : Rgba = buffer_in.colors[src_offSet + 0u];\n        let texel2 : Rgba = buffer_in.colors[src_offSet + 1u];\n        let texel3 : Rgba = buffer_in.colors[src_offSet + 0u +  width*2u];\n        let texel4 : Rgba = buffer_in.colors[src_offSet + 1u +  width*2u];\n\n        var resColor : Rgba = Rgba(1,1,1,1);\n        #if _isHizDepthTex\n            resColor = maxDepthValue(texel1, texel2, texel3, texel4);\n        #else\n            resColor = nearAverage(texel1, texel2, texel3, texel4);\n        #endif\n        buffer_out.colors[dst_offSet] = resColor;\n\n        textureStore(mipMapsTexture, vec2<i32>(global_id.xy), vec4<f32>(resColor.R, resColor.G, resColor.B, resColor.A));\n    }\n}\n"},{bindingsMapping:{params:{group:0,binding:0},buffer_in:{group:0,binding:1},buffer_out:{group:0,binding:2},mipMapsTexture:{group:0,binding:3}},defines:[n?"_isHizDepthTex":""]}),g=f;for(let e=0;e<i;e++){let n=l>>e,f=h>>e;if(e>0&&(g=A),0==e){let e=(1&f)<<1|1&n;u.updateInt("srcDimension",e),u.updateFloat2("texelSize",n,f),u.update(),g.setUniformBuffer("params",u),r?g.setTexture("oriDepthTexture",a,!1):g.setTexture("oriTexture",a,!1),g.setStorageTexture("mip0Texture",t)}else{c.updateFloat2("texelSize",n,f),c.update(),g.setUniformBuffer("params",c);let r=o.createView({format:"rgba8unorm",dimension:GM.TextureViewDimension.E2d,mipLevelCount:1,baseArrayLayer:0,baseMipLevel:e});t._texture._hardwareTexture.viewForWriting=r,g.setStorageTexture("mipMapsTexture",t)}1&e?(g.setStorageBuffer("buffer_in",p),g.setStorageBuffer("buffer_out",d)):(e>0&&g.setStorageBuffer("buffer_in",d),g.setStorageBuffer("buffer_out",p)),await g.dispatchWhenReady(Math.ceil(n/8),Math.ceil(f/8),1),e!=i-1&&s._currentRenderTarget&&s.unBindFramebuffer(s._currentRenderTarget)}p.dispose(),d.dispose(),c.dispose(),u.dispose()},ZS.prototype.createGPUTextureForInternalTexture=function(e,t,r,n,i){e._hardwareTexture||(e._hardwareTexture=new iw),void 0===t&&(t=e.width),void 0===r&&(r=e.height),void 0===n&&(n=e.depth);var o=e._hardwareTexture,s=!!((null!=i?i:0)&cp.TEXTURE_CREATIONFLAG_STORAGE);o.format=ZS.GetWebGPUTextureFormat(e.type,e.format,e._useSRGBBuffer),o.textureUsages=e._source===QR.RenderTarget||e.source===QR.MultiRenderTarget?GM.TextureUsage.TextureBinding|GM.TextureUsage.CopySrc|GM.TextureUsage.RenderAttachment:e._source===QR.DepthStencil?GM.TextureUsage.TextureBinding|GM.TextureUsage.RenderAttachment:-1,o.textureAdditionalUsages=s?GM.TextureUsage.StorageBinding:0;var a,u=e.generateMipMaps,c=n||1;if(a=null!==e._maxLodLevel?e._maxLodLevel:e.mipmapCount>1?e.mipmapCount:u?ZS.ComputeNumMipmapLevels(t,r):1,e.isCube){var l=this.createCubeTexture({width:t,height:r},e.generateMipMaps,e.generateMipMaps,e.invertY,!1,o.format,1,this._commandEncoderForCreation,o.textureUsages,o.textureAdditionalUsages);o.set(l),o.createView({format:o.format,dimension:GM.TextureViewDimension.Cube,mipLevelCount:a,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:6,aspect:ZS.HasDepthAndStencilAspects(o.format)?GM.TextureAspect.DepthOnly:GM.TextureAspect.All},s)}else{l=this.createTexture({width:t,height:r,layers:c},e.generateMipMaps,e.generateMipMaps,e.invertY,!1,e.is3D,o.format,1,this._commandEncoderForCreation,o.textureUsages,o.textureAdditionalUsages,a);o.set(l);var h=o.format;"depth24plus-stencil8"==h&&(h="depth24plus"),o.createView({format:h,dimension:e.is2DArray?GM.TextureViewDimension.E2dArray:e.is3D?GM.TextureDimension.E3d:GM.TextureViewDimension.E2d,mipLevelCount:a,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:e.is3D?1:c,aspect:ZS.HasDepthAndStencilAspects(o.format)?GM.TextureAspect.DepthOnly:GM.TextureAspect.All},s)}return e.width=e.baseWidth=t,e.height=e.baseHeight=r,e.depth=e.baseDepth=n,this.createMSAATexture(e,e.samples),o},ZS.prototype.createMSAATexture=function(e,t){var r=e._hardwareTexture;if((null==r?void 0:r.msaaTexture)&&(this.releaseTexture(r.msaaTexture),r.msaaTexture=null),r&&!((null!=t?t:1)<=1)){var n=e.width,i=e.height,o=e.depth||1;if(e.isCube){var s=this.createCubeTexture({width:n,height:i},!1,!1,e.invertY,!1,r.format,t,this._commandEncoderForCreation,r.textureUsages,r.textureAdditionalUsages);r.msaaTexture=s}else{s=this.createTexture({width:n,height:i,layers:o},!1,!1,e.invertY,!1,e.is3D,r.format,t,this._commandEncoderForCreation,r.textureUsages,r.textureAdditionalUsages);r.msaaTexture=s}var a=r.format;"depth24plus-stencil8"==a&&(a="depth24plus"),r.createMSAAView({format:a,dimension:e.is2DArray?GM.TextureViewDimension.E2dArray:e.is3D?GM.TextureDimension.E3d:GM.TextureViewDimension.E2d,mipLevelCount:1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:e.is3D?1:o,aspect:ZS.HasDepthAndStencilAspects(r.format)?GM.TextureAspect.DepthOnly:GM.TextureAspect.All})}},ZS.prototype.updateCubeTextures=function(e,t,r,n,i,o,s,a,u){void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===a&&(a=0),void 0===u&&(u=0);for(var c=[0,3,1,4,2,5],l=0;l<c.length;++l){var h=e[c[l]];this.updateTexture(h,t,r,n,1,i,l,0,o,s,a,u)}},ZS.prototype.updateTexture=function(e,t,r,n,i,o,s,a,u,c,l,h,p){void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=!1),void 0===c&&(c=!1),void 0===l&&(l=0),void 0===h&&(h=0);var d=ZS._IsInternalTexture(t)?t._hardwareTexture.underlyingResource:t,f=ZS._GetBlockInformationFromFormat(o),A=ZS._IsInternalTexture(t)?t._hardwareTexture:t,g={texture:d,origin:{x:l,y:h,z:Math.max(s,0)},mipLevel:a,premultipliedAlpha:c},_={width:Math.ceil(r/f.width)*f.width,height:Math.ceil(n/f.height)*f.height,depthOrArrayLayers:i||1};if(void 0!==e.byteLength){var m=Math.ceil(r/f.width)*f.length,y=256*Math.ceil(m/256)===m;if(o==GM.TextureFormat.RGBA16Float&&(y=!1),y){var E=this._device.createCommandEncoder({}),x=this._bufferManager.createRawBuffer(e.byteLength,GM.BufferUsage.MapWrite|GM.BufferUsage.CopySrc,!0),C=x.getMappedRange();new Uint8Array(C).set(e),x.unmap(),E.copyBufferToTexture({buffer:x,offset:0,bytesPerRow:m,rowsPerImage:n},g,_),this._device.queue.submit([E.finish()]),this._bufferManager.releaseBuffer(x)}else this._device.queue.writeTexture(g,e,{offset:0,bytesPerRow:m,rowsPerImage:n},_);if(u||c){if(!ZS._IsInternalTexture(t))throw"updateTexture: Can't process the texture data because a GPUTexture was provided instead of an InternalTexture!";var b=0===l&&0===h&&r===t.width&&n===t.height;this.invertYPreMultiplyAlpha(A,t.width,t.height,o,u,c,s,a,i||1,l,h,b?0:r,b?0:n,void 0,p)}}else if(u)if(g.premultipliedAlpha=!1,ZS._IsInternalTexture(t)&&0===l&&0===h&&r===t.width&&n===t.height)this._device.queue.copyExternalImageToTexture({source:e},g,_),this.invertYPreMultiplyAlpha(A,r,n,o,u,c,s,a,i||1,0,0,0,0,void 0,p);else{E=this._device.createCommandEncoder({});var I=this.createTexture({width:r,height:n,layers:1},!1,!1,!1,!1,!1,o,1,E,GM.TextureUsage.CopySrc|GM.TextureUsage.TextureBinding);this._deferredReleaseTextures.push([I,null]),_.depthOrArrayLayers=1,this._device.queue.copyExternalImageToTexture({source:e},{texture:I},_),_.depthOrArrayLayers=i||1;this.invertYPreMultiplyAlpha(I,r,n,o,u,c,0,a,i||1,0,0,0,0,E,p),E.copyTextureToTexture({texture:I},g,_),this._device.queue.submit([E.finish()])}else this._device.queue.copyExternalImageToTexture({source:e},g,_)},ZS.prototype.readPixels=function(e,t,r,n,i,o,s,a,u,c){void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=null),void 0===c&&(c=!1);var l=ZS._GetBlockInformationFromFormat(o),h=Math.ceil(n/l.width)*l.length,p=256*Math.ceil(h/256),d=p*i,f=this._bufferManager.createRawBuffer(d,GM.BufferUsage.MapRead|GM.BufferUsage.CopyDst),A=this._device.createCommandEncoder({});return A.copyTextureToBuffer({texture:e,mipLevel:a,origin:{x:t,y:r,z:Math.max(s,0)}},{buffer:f,offset:0,bytesPerRow:p},{width:n,height:i,depthOrArrayLayers:1}),this._device.queue.submit([A.finish()]),this._bufferManager.readDataFromBuffer(f,d,n,i,h,p,ZS._GetTextureTypeFromFormat(o),0,u,!0,c)},ZS.prototype.releaseTexture=function(e){if(ZS._IsInternalTexture(e)){var t=e._hardwareTexture,r=e._irradianceTexture;this._deferredReleaseTextures.push([t,r])}else this._deferredReleaseTextures.push([e,null])},ZS.prototype.destroyDeferredTextures=function(){for(var e=0;e<this._deferredReleaseTextures.length;++e){var t=this._deferredReleaseTextures[e],r=t[0],n=t[1];r&&(ZS._IsHardwareTexture(r)?r.release():r.destroy()),null==n||n.dispose()}this._deferredReleaseTextures.length=0};var $S=0;function eB(e){e=Yt(e,Yt.EMPTY_OBJECT),qt.defined("options.context",e.context);var t=e.context,r=e.width,n=e.height,i=e.source;jt(i)&&(jt(r)||(r=Yt(i.videoWidth,i.width)),jt(n)||(n=Yt(i.videoHeight,i.height)));var o=Yt(e.pixelFormat,Pp.RGBA),s=Yt(e.pixelDatatype,Dp.UNSIGNED_BYTE),a=o,u=Pp.isCompressedFormat(a);this._needGenerateMipmap=Yt(e.generateMipmap,!1);var c=Yt(e.flipY,!0),l=e.context.engine,h=zp.toPixelFormat(o),p=zp.toPixelType(s);this._sampler=jt(e.sampler)?e.sampler:new OR,this._samples=Yt(e.samples,1);var d,f=zp.toAddressMode(this._sampler.wrapS),A=zp.toAddressMode(this._sampler.wrapT),g=zp.toSamplerMode(s,this._sampler),_=null;if(jt(i))if(jt(i.arrayBufferView)){var m=i.arrayBufferView;!u&&c&&(m=Pp.flipY(m,o,s,r,n)),_=l.createRawTexture(m,r,n,h,this._needGenerateMipmap,!1,g,null,p,0,!1,1,this._samples),this._texture=new VR(_),_.wrapU=f,_.wrapV=A}else if(jt(i.framebuffer))console.log("defined(source.framebuffer)");else if(void 0!==i.close)c=!1,_=l.createTexture("",!this._needGenerateMipmap,c,null,g,null,null,i,null,a,"",null,null,null,null),this._texture=new VR(_),_.wrapU=f,_.wrapV=A;else{var y=this;createImageBitmap(i).then((function(e){_=l.createTexture("",!y._needGenerateMipmap,c,null,g,null,null,e,null,a,"",null,null,null,null),y._texture=new VR(_),_.wrapU=f,_.wrapV=A})).catch((e=>{console.log("createImageBitmap")}))}else{if(o==Pp.DEPTH_COMPONENT||o==Pp.DEPTH_COMPONENT16||o==Pp.DEPTH_COMPONENT32F||o==Pp.DEPTH_STENCIL){var E={width:r,height:n},x={generateStencil:o==Pp.DEPTH_STENCIL,bilinearFiltering:!1,isCube:!1,depthTextureFormat:h,samples:this._samples,comparisonFunction:this._sampler._comparisonFunction};_=l.createDepthStencilTexture(E,x),l._textureHelper.createGPUTextureForInternalTexture(_),this._texture=new VR(_)}else _=l.createRawTexture(m,r,n,h,this._needGenerateMipmap,c,g,!1,p,0,!1,0,this._samples),this._texture=new VR(_);_.wrapU=f,_.wrapV=A}d=u?Pp.compressedTextureSizeInBytes(o,r,n):Pp.textureSizeInBytes(o,s,r,n),this._id=$S++,this._context=t,this._pixelFormat=o,this._pixelDatatype=s,this._width=r,this._height=n,this._dimensions=new _r(r,n),this._size=[r,n],this._mipmapTexture,this._sizeInBytes=d,this._flipY=c,this._ownerName=e.owner,t.memorySize+=d,t.memoryAnalyzer.allocateGPUMemory(sp,e.owner,d)}function tB(e){e=Yt(e,Yt.EMPTY_OBJECT),qt.defined("options.context",e.context),e.context.webgpu?this._inner=new eB(e):this._inner=new NM(e)}eB.fromFramebuffer=function(e){e=Yt(e,Yt.EMPTY_OBJECT),qt.defined("options.context",e.context),e.context},Object.defineProperties(eB.prototype,{id:{set:function(e){this._id=e},get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(e){this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},size:{get:function(){return this._size}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}},thinTexture:{get:function(){return this._texture}},internalTexture:{get:function(){return this._texture._texture}},GPUTexture:{get:function(){return this._texture._texture._hardwareTexture.underlyingResource}}}),eB.prototype.copyFrom=function(e,t,r){var n=e.width,i=e.height,o=e.arrayBufferView;if(jt(o))this._context.engine.updateTextureData(this.internalTexture,o,t,r,n,i);else{var s=this.internalTexture,a=s._hardwareTexture;e instanceof HTMLVideoElement?this._context.engine.updateVideoTexture(s,e,!1):this._context.engine._textureHelper.updateTexture(e,s,n,i,s.depth,a.format,0,0,!0,!1,t,r)}},eB.prototype.copyFromFramebuffer=function(e,t,r,n,i,o){console.log("TextureGPU.prototype.copyFromFramebuffer")},eB.prototype.copyFromTexture=function(e,t,r,n,i,o,s){var a=this._context.engine._device,u=this.GPUTexture,c=e._inner.GPUTexture,l=a.createCommandEncoder({});l.copyTextureToTexture({texture:c,origin:{x:n,y:i,z:0}},{texture:u,origin:{x:t,y:r,z:0}},{width:c.width,height:c.height,depthOrArrayLayers:1}),a.queue.submit([l.finish()])},eB.prototype.generateMipmap=function(e){if(this._needGenerateMipmap&&jt(this._texture)){var t=ZS.ComputeNumMipmapLevels(this._width,this._height),r=this.GPUTexture;this._context.engine._textureHelper.generateMipmaps(r,r.format,t,0)}else this._needGenerateMipmap=!0},eB.prototype.generateMipmapTextureByCS=function(){if(jt(this.thinTexture)){if(this._context.engine._currentRenderTarget){var e=this;return void this._context.engine._onAfterUnbindFrameBufferObservable.addOnce((function(){e._afterCreate(!1)}))}this._afterCreate(!1)}},eB.prototype.generateHizDepthTextureByCS=function(){if(jt(this.thinTexture)){if(this._context.engine._currentRenderTarget){var e=this;return void this._context.engine._onAfterUnbindFrameBufferObservable.addOnce((function(){e._afterCreate(!0)}))}this._afterCreate(!0)}},eB.prototype._afterCreate=function(e){var t=ZS.ComputeNumMipmapLevels(this._width,this._height),r=this.pixelFormat==Pp.DEPTH_COMPONENT||this.pixelFormat==Pp.DEPTH_STENCIL;let n=this._context.engine.createRawTexture(null,this._width,this._height,cp.TEXTUREFORMAT_RGBA,!0,this.internalTexture.invertY,this.internalTexture.samplingMode,!1,0,cp.TEXTURE_CREATIONFLAG_STORAGE,!1,t,this.internalTexture.samples);this._mipmapTexture=new VR(n),this._context.engine._textureHelper.generateMipmapsByCS(this._texture,this._mipmapTexture,r,e,t)},eB.prototype.isDestroyed=function(){return!1},eB.prototype.destroy=function(){return this._context.memorySize-=this._sizeInBytes,this._context.memoryAnalyzer.releaseGPUMemory(sp,this._ownerName,this._sizeInBytes),this._texture.dispose(),op(this)},tB.create=function(e){return new tB(e)},tB.fromFramebuffer=function(e){e=Yt(e,Yt.EMPTY_OBJECT),qt.defined("options.context",e.context);var t=e.context,r=t._gl,n=Yt(e.pixelFormat,Pp.RGB),i=Yt(e.framebufferXOffset,0),o=Yt(e.framebufferYOffset,0),s=Yt(e.width,r.drawingBufferWidth),a=Yt(e.height,r.drawingBufferHeight),u=e.framebuffer;if(!Pp.validate(n))throw new Ht("Invalid pixelFormat.");if(Pp.isDepthFormat(n)||Pp.isCompressedFormat(n))throw new Ht("pixelFormat cannot be DEPTH_COMPONENT, DEPTH_STENCIL or a compressed format.");if(qt.defined("options.context",e.context),qt.typeOf.number.greaterThanOrEquals("framebufferXOffset",i,0),qt.typeOf.number.greaterThanOrEquals("framebufferYOffset",o,0),i+s>r.drawingBufferWidth)throw new Ht("framebufferXOffset + width must be less than or equal to drawingBufferWidth");if(o+a>r.drawingBufferHeight)throw new Ht("framebufferYOffset + height must be less than or equal to drawingBufferHeight.");return new tB({context:t,width:s,height:a,pixelFormat:n,source:{framebuffer:jt(u)?u:t.defaultFramebuffer,xOffset:i,yOffset:o,width:s,height:a}})},Object.defineProperties(tB.prototype,{id:{set:function(e){this._inner.id=e},get:function(){return this._inner.id}},sampler:{get:function(){return this._inner.sampler},set:function(e){this._inner.sampler=e}},pixelFormat:{get:function(){return this._inner.pixelFormat}},pixelDatatype:{get:function(){return this._inner.pixelDatatype}},dimensions:{get:function(){return this._inner.dimensions}},size:{get:function(){return this._inner.size}},preMultiplyAlpha:{get:function(){return this._inner.preMultiplyAlpha}},flipY:{get:function(){return this._inner.flipY}},width:{get:function(){return this._inner.width}},height:{get:function(){return this._inner.height}},sizeInBytes:{get:function(){return this._inner.sizeInBytes}},_target:{get:function(){return this._inner._target}},_texture:{get:function(){return this._inner._texture}},is3D:{get:function(){return!1}},is2DArray:{get:function(){return!1}},samples:{get:function(){return this._inner._samples}}}),tB.prototype.copyFrom=function(e,t,r){this._inner.copyFrom(e,t,r)},tB.prototype.copyFromFramebuffer=function(e,t,r,n,i,o){this._inner.copyFromFramebuffer(e,t,r,n,i,o)},tB.prototype.copyFromTexture=function(e,t,r,n,i,o,s){this._inner.copyFromTexture(e,t,r,n,i,o,s)},tB.prototype.generateMipmap=function(e){this._inner.generateMipmap(e)},tB.prototype.isDestroyed=function(){return!1},tB.prototype.destroy=function(){return this._inner.destroy(),op(this)};const rB=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,r=0,n=0,i=0,o=0,s=0,a=0;for(1&t?i=o=s=32:r=n=a=32;(t>>=1)>1;){const e=r+i>>1,u=n+o>>1;1&t?(i=r,o=n,r=s,n=a):(r=i,n=o,i=s,o=a),s=e,a=u}const u=4*e;rB[u+0]=r,rB[u+1]=n,rB[u+2]=i,rB[u+3]=o}nh([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),nh([{name:"a_pos",type:"Int16",components:2}]),new wa;class nB{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new e(va,16,0),this.featureIndexArray=new Vh,this.promoteId=r}insert(e,t,r,n,i,o=0){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i,o);const a=this.grid;for(let e=0;e<t.length;e++){const r=t[e],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<r.length;e++){const t=r[e];n[0]=Math.min(n[0],t.x),n[1]=Math.min(n[1],va-t.y),n[2]=Math.max(n[2],t.x),n[3]=Math.max(n[3],va-t.y)}n[0]<va&&n[1]<va&&n[2]>=0&&n[3]>=0&&a.insert(s,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new IR(new Wy(this.rawTileData)).layers,this.sourceLayerCoder=new vR(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,r,n){this.loadVTLayers();const i=e.params||{},o=Qd(i.filter),s=e.tileResult;e.transform;const a=s.bufferedTilespaceBounds,u=this.grid.query(a.min.x,a.min.y,a.max.x,a.max.y,((e,t,r,n)=>function(e,t,r,n,i){for(const o of e)if(t<=o.x&&r<=o.y&&n>=o.x&&i>=o.y)return!0;const o=[new zt(t,r),new zt(t,i),new zt(n,i),new zt(n,r)];if(e.length>2)for(const t of o)if(Cf(e,t))return!0;for(let t=0;t<e.length-1;t++)if(bf(e[t],e[t+1],o))return!0;return!1}(s.bufferedTilespaceGeometry,e,t,r,n)));u.sort(oB);const c={};let l;for(let a=0;a<u.length;a++){const h=u[a];if(h===l)continue;l=h;const p=this.featureIndexArray.get(h);let d=null;this.loadMatchingFeature(c,p,o,i.layers,i.availableImages,t,r,n,((t,r,n,i=0)=>(d||(d=sf(t,!1)),r.queryIntersectsFeature(s,t,n,d,this.z,e.transform,e.pixelPosMatrix,null,i))))}return c}loadMatchingFeature(e,t,r,n,i,o,s,a,u){const{featureIndex:c,bucketIndex:l,sourceLayerIndex:h,layoutVertexArrayOffset:p}=t,d=this.bucketLayerIDs[l];if(n&&!function(e,t){for(let r=0;r<e.length;r++)if(t.indexOf(e[r])>=0)return!0;return!1}(n,d))return;const f=this.sourceLayerCoder.decode(h),A=this.vtLayers[f].feature(c);if(r.needGeometry){const e=af(A,!0);if(!r.filter(new Ql(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!r.filter(new Ql(this.tileID.overscaledZ),A))return;const g=this.getId(A,f);for(let t=0;t<d.length;t++){const r=d[t];if(n&&n.indexOf(r)<0)continue;const l=o[r];if(!l)continue;let h={};void 0!==g&&a&&(h=a.getState(l.sourceLayer||"_geojsonTileLayer",g));const f=ul({},s[r]);f.paint=iB(f.paint,l.paint,A,h,i),f.layout=iB(f.layout,l.layout,A,h,i);const _=!u||u(A,l,h,p);if(!_)continue;const m=new MR(A,this.z,this.x,this.y,g);m.layer=f;let y=e[r];void 0===y&&(y=e[r]=[]),y.push({featureIndex:c,feature:m,intersectionZ:_})}}lookupSymbolFeatures(e,t,r,n,i,o,s,a){const u={};this.loadVTLayers();const c=Qd(i);for(const i of e)this.loadMatchingFeature(u,{bucketIndex:r,sourceLayerIndex:n,featureIndex:i,layoutVertexArrayOffset:0},c,o,s,a,t);return u}loadFeature(e){const{featureIndex:t,sourceLayerIndex:r}=e;this.loadVTLayers();const n=this.sourceLayerCoder.decode(r),i=this.vtFeatures[n];if(i[t])return i[t];const o=this.vtLayers[n].feature(t);return i[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;if(this.promoteId){const n="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=n&&(r=e.properties[n]),"boolean"==typeof r&&(r=Number(r))}return r}}function iB(e,t,r,n,i){return hl(e,((e,o)=>{const s=t instanceof Xl?t.get(o):null;return s&&s.evaluate?s.evaluate(r,n,i):s}))}function oB(e,t){return t-e}Ml(nB,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class sB{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new F_({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const r=this.getKey(e,t);return this.positions[r]}trim(){const e=this.width,t=this.height=(r=this.nextRow)<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2));var r;this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,r){const n=[];let i=e.length%2==1?-e[e.length-1]*r:0,o=e[0]*r,s=!0;n.push({left:i,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){s=!s;const u=e[t];i=a*r,a+=u,o=a*r,n.push({left:i,right:o,isDash:s,zeroLength:0===u})}return n}addRoundDash(e,t,r){const n=t/2;for(let t=-r;t<=r;t++){const i=this.nextRow+r+t,o=this.width*i;let s=0,a=e[s];for(let i=0;i<this.width;i++){i/a.right>1&&(a=e[++s]);const u=Math.abs(i-a.left),c=Math.abs(i-a.right),l=Math.min(u,c);let h;const p=t/r*(n+1);if(a.isDash){const e=n-Math.abs(p);h=Math.sqrt(l*l+e*e)}else h=n-Math.sqrt(l*l+p*p);this.image.data[o+i]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let t=e.length-1;t>=0;--t){const r=e[t],n=e[t+1];r.zeroLength?e.splice(t,1):n&&n.isDash===r.isDash&&(n.left=r.left,e.splice(t,1))}const r=e[0],n=e[e.length-1];r.isDash===n.isDash&&(r.left=n.left-this.width,n.right=r.right+this.width);const i=this.width*this.nextRow;let o=0,s=e[o];for(let r=0;r<this.width;r++){r/s.right>1&&(s=e[++o]);const n=Math.abs(r-s.left),a=Math.abs(r-s.right),u=Math.min(n,a),c=(s.isDash?u:-u)+t;this.image.data[i+r]=Math.max(0,Math.min(255,c+128))}}addDash(e,t){const r=this.getKey(e,t);if(this.positions[r])return this.positions[r];const n="round"===t,i=n?7:0,o=2*i+1;if(this.nextRow+o>this.height)return fl("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let t=0;t<e.length;t++)e[t]<0&&(fl("Negative value is found in line dasharray, replacing values with 0"),e[t]=0),s+=e[t];if(0!==s){const r=this.width/s,o=this.getDashRanges(e,this.width,r);if(n)this.addRoundDash(o,r,i);else{const e="square"===t?.5*r:0;this.addRegularDash(o,e)}}const a=this.nextRow+i;this.nextRow+=o;const u={tl:[a,i],br:[s,0]};return this.positions[r]=u,u}}Ml(sB,"LineAtlas");class aB{constructor(e){const t={},r=[];for(const n in e){const i=e[n],o=t[n]={};for(const e in i.glyphs){const t=i.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n=t.metrics.localGlyph?2:1,s={x:0,y:0,w:t.bitmap.width+2*n,h:t.bitmap.height+2*n};r.push(s),o[e]=s}}const{w:n,h:i}=dE(r),o=new F_({width:n||1,height:i||1});for(const r in e){const n=e[r];for(const e in n.glyphs){const i=n.glyphs[+e];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const s=t[r][e],a=i.metrics.localGlyph?2:1;F_.copy(i.bitmap,o,{x:0,y:0},{x:s.x+a,y:s.y+a},i.bitmap)}}this.image=o,this.positions=t}}Ml(aB,"GlyphAtlas");class uB{constructor(e){this.tileID=new aI(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y,e.tileID.canonical.indexExtent),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=cI(e.tileID.canonical,e.projection),this.projection=e.projection,this.crs=e.crs}parse(e,t,r,n,i,o){this.status="parsing",this.data=t,this.collisionBoxArray=new Uh;const s=new vR(Object.keys(t.layers).sort()),a=new nB(this.tileID,this.promoteId);a.bucketLayerIDs=[];const u={},c=new sB(256,256),l={featureIndex:a,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:c,availableImages:n,crs:this.crs},h=r.familiesBySource[this.source];for(const r in h){const i=t.layers[r];if(!i)continue;let o=!1,c=!1;for(const e of h[r])"symbol"===e[0].type?o=!0:c=!0;if(!0===this.isSymbolTile&&!o)continue;if(!1===this.isSymbolTile&&!c)continue;1===i.version&&fl(`Vector tile source "${this.source}" layer "${r}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const p=s.encode(r),d=[];for(let e=0;e<i.length;e++){const t=i.feature(e),n=a.getId(t,r);d.push({feature:t,id:n,index:e,sourceLayerIndex:p})}for(const t of h[r]){const r=t[0];if(void 0!==this.isSymbolTile&&"symbol"===r.type!==this.isSymbolTile)continue;if(r.minzoom&&this.zoom<Math.floor(r.minzoom))continue;if(r.maxzoom&&this.zoom>=r.maxzoom)continue;if("none"===r.visibility)continue;cB(t,this.zoom,n);(u[r.id]=r.createBucket({index:a.bucketLayerIDs.length,layers:t,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:p,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:n,webgpu:e.webgpu})).populate(d,l,this.tileID.canonical,this.tileTransform),a.bucketLayerIDs.push(t.map((e=>e.id)))}}let p,d,f,A;c.trim();const g={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},_=()=>{if(p)return o(p);if(d&&f&&A){const e=new aB(d),t=new AE(f,A);for(const r in u){const i=u[r];if(i instanceof oR)cB(i.layers,this.zoom,n),$E(i,d,e.positions,f,t.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection,this.crs);else if(i.hasPattern&&(i instanceof xm||i instanceof Y_)){cB(i.layers,this.zoom,n);const e=t.patternPositions;i.addFeatures(l,this.tileID.canonical,e,n,this.tileTransform)}}this.status="done",o(null,{buckets:al(u).filter((e=>!e.isEmpty())),featureIndex:a,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:c,imageAtlas:t,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?e.positions:null})}},m=hl(l.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(m).length?i.send("getGlyphs",{uid:this.uid,stacks:m,source:this.source},((e,t)=>{p||(p=e,d=t,_())}),void 0,!1,g):d={};const y=Object.keys(l.iconDependencies);y.length?i.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},((e,t)=>{p||(p=e,f=t,_())}),void 0,!1,g):f={};const E=Object.keys(l.patternDependencies);E.length?i.send("getImages",{icons:E,source:this.source,tileID:this.tileID,type:"patterns"},((e,t)=>{p||(p=e,A=t,_())}),void 0,!1,g):A={},_()}}function cB(e,t,r){const n=new Ql(t);for(const t of e)t.recalculate(n,r)}var lB,hB,pB=void 0!==pB?pB:{},dB=Object.assign({},pB),fB="object"==typeof window,AB="function"==typeof importScripts,gB="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,_B="";if(gB){var mB=require("fs"),yB=require("path");_B=AB?yB.dirname(_B)+"/":__dirname+"/",lB=(e,t)=>(e=LB(e)?new URL(e):yB.normalize(e),mB.readFileSync(e,t?void 0:"utf8")),hB=e=>{var t=lB(e,!0);return t.buffer||(t=new Uint8Array(t)),t},!pB.thisProgram&&process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),"undefined"!=typeof module&&(module.exports=pB),process.on("uncaughtException",(e=>{if(!("unwind"===e||e instanceof QB||e.context instanceof QB))throw e})),pB.inspect=()=>"[Emscripten Module object]"}else(fB||AB)&&(AB?_B=self.location.href:"undefined"!=typeof document&&document.currentScript&&(_B=document.currentScript.src),_B=0!==_B.indexOf("blob:")?_B.substr(0,_B.replace(/[?#].*/,"").lastIndexOf("/")+1):"",lB=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},AB&&(hB=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}));pB.print||console.log.bind(console);var EB,xB,CB=pB.printErr||console.error.bind(console);function bB(e){if(NB(e))return function(e){if(void 0!==gB&&gB){var t=Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.length)}for(var r=atob(e),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n}(e.slice(PB.length))}Object.assign(pB,dB),dB=null,pB.arguments&&pB.arguments,pB.thisProgram&&pB.thisProgram,pB.quit&&pB.quit,pB.wasmBinary&&(EB=pB.wasmBinary),"object"!=typeof WebAssembly&&OB("no native wasm support detected");var IB,TB=!1;function vB(){var e=xB.buffer;pB.HEAP8=new Int8Array(e),pB.HEAP16=new Int16Array(e),pB.HEAPU8=IB=new Uint8Array(e),pB.HEAPU16=new Uint16Array(e),pB.HEAP32=new Int32Array(e),pB.HEAPU32=new Uint32Array(e),pB.HEAPF32=new Float32Array(e),pB.HEAPF64=new Float64Array(e)}var RB=[],MB=[],wB=[];var SB=0,BB=null;function OB(e){throw pB.onAbort&&pB.onAbort(e),CB(e="Aborted("+e+")"),TB=!0,e+=". Build with -sASSERTIONS for more info.",new WebAssembly.RuntimeError(e)}var DB,FB,PB="data:application/octet-stream;base64,",NB=e=>e.startsWith(PB),LB=e=>e.startsWith("file://");function UB(e){return Promise.resolve().then((()=>function(e){if(e==DB&&EB)return new Uint8Array(EB);var t=bB(e);if(t)return t;if(hB)return hB(e);throw"both async and sync fetching of the wasm failed"}(e)))}function GB(e,t,r,n){return function(e,t,r){return UB(e).then((e=>WebAssembly.instantiate(e,t))).then((e=>e)).then(r,(e=>{CB(`failed to asynchronously prepare wasm: ${e}`),OB(e)}))}(t,r,n)}function QB(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}NB(DB="data:application/octet-stream;base64,AGFzbQEAAAABHwZgAX8Bf2ABfwBgAABgA39/fwBgA39/fwF/YAJ/fwACDQIBYQFhAAABYQFiAAIDExIAAwAAAgEBAQUDAAMFAQQEAQQEBQFwAQEBBQcBAYACgIACBggBfwFBkJAECwchCAFjAgABZAAGAWUAEwFmABEBZwAQAWgBAAFpAAwBagASCuZdEioBAX8jAEEQayIBIAA6AA8gAS0ADyIAQQF0IABBB3VBAXFBG2xzQf8BcQufAQEBfyMAQRBrIgMgADoADyADIAE2AgggAyACNgIEIANBADoAAwNAIAMtAANBBE9FBEAgA0EAOgACA0AgAy0AAiIBQQRPRQRAIAEgAy0AA0ECdCICIAMoAghqaiIAIAMoAgQgASACIAMtAA9BBHRqamotAAAgAC0AAHM6AAAgAyADLQACQQFqOgACDAELCyADIAMtAANBAWo6AAMMAQsLC08BAn9BkAwoAgAiASAAQQdqQXhxIgJqIQACQCACQQAgACABTRsNACAAPwBBEHRLBEAgABAARQ0BC0GQDCAANgIAIAEPC0GUDEEwNgIAQX8LNQEBf0EBIAAgAEEBTRshAAJAA0AgABAMIgENAUGIECgCACIBBEAgARECAAwBCwsQAQALIAELAgAL+AEBAX8jAEEQayIBIAA2AgwgASABKAIMLQANOgALIAEoAgwgASgCDC0ACToADSABKAIMIAEoAgwtAAU6AAkgASgCDCABKAIMLQABOgAFIAEoAgwgAS0ACzoAASABIAEoAgwtAAI6AAsgASgCDCABKAIMLQAKOgACIAEoAgwgAS0ACzoACiABIAEoAgwtAAY6AAsgASgCDCABKAIMLQAOOgAGIAEoAgwgAS0ACzoADiABIAEoAgwtAAM6AAsgASgCDCABKAIMLQAHOgADIAEoAgwgASgCDC0ACzoAByABKAIMIAEoAgwtAA86AAsgASgCDCABLQALOgAPC/gBAQF/IwBBEGsiASAANgIMIAEgASgCDC0AAToACyABKAIMIAEoAgwtAAU6AAEgASgCDCABKAIMLQAJOgAFIAEoAgwgASgCDC0ADToACSABKAIMIAEtAAs6AA0gASABKAIMLQACOgALIAEoAgwgASgCDC0ACjoAAiABKAIMIAEtAAs6AAogASABKAIMLQAGOgALIAEoAgwgASgCDC0ADjoABiABKAIMIAEtAAs6AA4gASABKAIMLQADOgALIAEoAgwgASgCDC0ADzoAAyABKAIMIAEoAgwtAAs6AA8gASgCDCABKAIMLQAHOgALIAEoAgwgAS0ACzoABwt7AQF/IwBBEGsiASAANgIMIAFBADoACwNAIAEtAAtBBE9FBEAgAUEAOgAKA0AgAS0ACiIAQQRPRQRAIAEtAAsgASgCDCAAQQJ0amoiACAALQAALQCACDoAACABIAEtAApBAWo6AAoMAQsLIAEgAS0AC0EBajoACwwBCwsL6wQBAX8jAEEQayICJAAgAiAANgIMIAIgATYCCCACQQA6AAdBACACKAIMIAIoAggQAyACQQE6AAcDQCACLQAHQQ5JBEAgAigCDBAJIAIoAgwQCCACKAIMIQEjAEEQayIAJAAgACABNgIMIABBADoACwNAIAAtAAsiAUEESQRAIAAgACgCDCABQQJ0ai0AADoACCAAIAAoAgwgAC0AC0ECdGoiAS0AAyABLQACIAEtAAAgAS0AAXNzczoACiAAIAAoAgwgAC0AC0ECdGotAAAgACgCDCAALQALQQJ0ai0AAXM6AAkgACAALQAJEAI6AAkgACgCDCAALQALQQJ0aiIBIAEtAAAgAC0ACSAALQAKc3M6AAAgACAAKAIMIAAtAAtBAnRqLQABIAAoAgwgAC0AC0ECdGotAAJzOgAJIAAgAC0ACRACOgAJIAAoAgwgAC0AC0ECdGoiASABLQABIAAtAAkgAC0ACnNzOgABIAAgACgCDCAALQALQQJ0ai0AAiAAKAIMIAAtAAtBAnRqLQADczoACSAAIAAtAAkQAjoACSAAKAIMIAAtAAtBAnRqIgEgAS0AAiAALQAJIAAtAApzczoAAiAAIAAoAgwgAC0AC0ECdGotAAMgAC0ACHM6AAkgACAALQAJEAI6AAkgACgCDCAALQALQQJ0aiIBIAEtAAMgAC0ACSAALQAKc3M6AAMgACAALQALQQFqOgALDAELCyAAQRBqJAAgAi0AByACKAIMIAIoAggQAyACIAItAAdBAWo6AAcMAQsLIAIoAgwQCSACKAIMEAhBDiACKAIMIAIoAggQAyACQRBqJAALmwYBAX8jAEEQayIDJAAgAyAANgIMIAMgATYCCCADIAI2AgQgAygCCCEBIwBBIGsiACADKAIMNgIcIAAgATYCGCAAQQA2AhQDQCAAKAIUIgFBCEkEQCABQQJ0IgEgACgCHGogASAAKAIYai0AADoAACAAKAIUQQJ0QQFqIgEgACgCHGogASAAKAIYai0AADoAACAAKAIUQQJ0QQJqIgEgACgCHGogASAAKAIYai0AADoAACAAKAIUQQJ0QQNqIgEgACgCHGogASAAKAIYai0AADoAACAAIAAoAhRBAWo2AhQMAQsLIABBCDYCFANAIAAoAhQiAUE8SQRAIAAgAUEBa0ECdDYCDCAAIAAoAhwgACgCDGotAAA6AAggACAAKAIcIAAoAgxBAWpqLQAAOgAJIAAgACgCHCAAKAIMQQJqai0AADoACiAAIAAoAhwgACgCDEEDamotAAA6AAsgACgCFEEHcUUEQCAAIAAtAAg6AAcgACAALQAJOgAIIAAgAC0ACjoACSAAIAAtAAs6AAogACAALQAHOgALIAAgAC0ACC0AgAg6AAggACAALQAJLQCACDoACSAAIAAtAAotAIAIOgAKIAAgAC0ACy0AgAg6AAsgACAALQAIIAAoAhRBA3YtAIAKczoACAsgACgCFEEHcUEERgRAIAAgAC0ACC0AgAg6AAggACAALQAJLQCACDoACSAAIAAtAAotAIAIOgAKIAAgAC0ACy0AgAg6AAsLIAAgACgCFEECdDYCECAAIAAoAhRBCGtBAnQ2AgwgACgCHCIBIAAoAhBqIAAoAgwgAWotAAAgAC0ACHM6AAAgACgCHCAAKAIQQQFqaiAAKAIcIAAoAgxBAWpqLQAAIAAtAAlzOgAAIAAoAhwgACgCEEECamogACgCHCAAKAIMQQJqai0AACAALQAKczoAACAAKAIcIAAoAhBBA2pqIAAoAhwgACgCDEEDamotAAAgAC0AC3M6AAAgACAAKAIUQQFqNgIUDAELCyADKAIMIgAgAygCBCIBKQAANwDwASAAIAEpAAg3APgBIANBEGokAAvOJwEMfyMAQRBrIgokAAJAAkACQAJAAkACQAJAAkACQCAAQfQBTQRAQZgMKAIAIgZBECAAQQtqQXhxIABBC0kbIgVBA3YiAHYiAUEDcQRAAkAgAUF/c0EBcSAAaiICQQN0IgFBwAxqIgAgAUHIDGooAgAiASgCCCIDRgRAQZgMIAZBfiACd3E2AgAMAQsgAyAANgIMIAAgAzYCCAsgAUEIaiEAIAEgAkEDdCICQQNyNgIEIAEgAmoiASABKAIEQQFyNgIEDAoLIAVBoAwoAgAiB00NASABBEACQEECIAB0IgJBACACa3IgASAAdHFoIgFBA3QiAEHADGoiAiAAQcgMaigCACIAKAIIIgNGBEBBmAwgBkF+IAF3cSIGNgIADAELIAMgAjYCDCACIAM2AggLIAAgBUEDcjYCBCAAIAVqIgQgAUEDdCIBIAVrIgNBAXI2AgQgACABaiADNgIAIAcEQCAHQXhxQcAMaiEBQawMKAIAIQICfyAGQQEgB0EDdnQiBXFFBEBBmAwgBSAGcjYCACABDAELIAEoAggLIQUgASACNgIIIAUgAjYCDCACIAE2AgwgAiAFNgIICyAAQQhqIQBBrAwgBDYCAEGgDCADNgIADAoLQZwMKAIAIgtFDQEgC2hBAnRByA5qKAIAIgIoAgRBeHEgBWshBCACIQEDQAJAIAEoAhAiAEUEQCABKAIUIgBFDQELIAAoAgRBeHEgBWsiASAEIAEgBEkiARshBCAAIAIgARshAiAAIQEMAQsLIAIoAhghCSACIAIoAgwiA0cEQEGoDCgCABogAigCCCIAIAM2AgwgAyAANgIIDAkLIAJBFGoiASgCACIARQRAIAIoAhAiAEUNAyACQRBqIQELA0AgASEIIAAiA0EUaiIBKAIAIgANACADQRBqIQEgAygCECIADQALIAhBADYCAAwIC0F/IQUgAEG/f0sNACAAQQtqIgBBeHEhBUGcDCgCACIIRQ0AQQAgBWshBAJAAkACQAJ/QQAgBUGAAkkNABpBHyAFQf///wdLDQAaIAVBJiAAQQh2ZyIAa3ZBAXEgAEEBdGtBPmoLIgdBAnRByA5qKAIAIgFFBEBBACEADAELQQAhACAFQRkgB0EBdmtBACAHQR9HG3QhAgNAAkAgASgCBEF4cSAFayIGIARPDQAgASEDIAYiBA0AQQAhBCABIQAMAwsgACABKAIUIgYgBiABIAJBHXZBBHFqKAIQIgFGGyAAIAYbIQAgAkEBdCECIAENAAsLIAAgA3JFBEBBACEDQQIgB3QiAEEAIABrciAIcSIARQ0DIABoQQJ0QcgOaigCACEACyAARQ0BCwNAIAAoAgRBeHEgBWsiAiAESSEBIAIgBCABGyEEIAAgAyABGyEDIAAoAhAiAQR/IAEFIAAoAhQLIgANAAsLIANFDQAgBEGgDCgCACAFa08NACADKAIYIQcgAyADKAIMIgJHBEBBqAwoAgAaIAMoAggiACACNgIMIAIgADYCCAwHCyADQRRqIgEoAgAiAEUEQCADKAIQIgBFDQMgA0EQaiEBCwNAIAEhBiAAIgJBFGoiASgCACIADQAgAkEQaiEBIAIoAhAiAA0ACyAGQQA2AgAMBgsgBUGgDCgCACIDTQRAQawMKAIAIQACQCADIAVrIgFBEE8EQCAAIAVqIgIgAUEBcjYCBCAAIANqIAE2AgAgACAFQQNyNgIEDAELIAAgA0EDcjYCBCAAIANqIgEgASgCBEEBcjYCBEEAIQJBACEBC0GgDCABNgIAQawMIAI2AgAgAEEIaiEADAgLIAVBpAwoAgAiAkkEQEGkDCACIAVrIgE2AgBBsAxBsAwoAgAiACAFaiICNgIAIAIgAUEBcjYCBCAAIAVBA3I2AgQgAEEIaiEADAgLQQAhACAFQS9qIgQCf0HwDygCAARAQfgPKAIADAELQfwPQn83AgBB9A9CgKCAgICABDcCAEHwDyAKQQxqQXBxQdiq1aoFczYCAEGEEEEANgIAQdQPQQA2AgBBgCALIgFqIgZBACABayIIcSIBIAVNDQdB0A8oAgAiAwRAQcgPKAIAIgcgAWoiCSAHTQ0IIAMgCUkNCAsCQEHUDy0AAEEEcUUEQAJAAkACQAJAQbAMKAIAIgMEQEHYDyEAA0AgAyAAKAIAIgdPBEAgByAAKAIEaiADSw0DCyAAKAIIIgANAAsLQQAQBCICQX9GDQMgASEGQfQPKAIAIgBBAWsiAyACcQRAIAEgAmsgAiADakEAIABrcWohBgsgBSAGTw0DQdAPKAIAIgAEQEHIDygCACIDIAZqIgggA00NBCAAIAhJDQQLIAYQBCIAIAJHDQEMBQsgBiACayAIcSIGEAQiAiAAKAIAIAAoAgRqRg0BIAIhAAsgAEF/Rg0BIAVBMGogBk0EQCAAIQIMBAtB+A8oAgAiAiAEIAZrakEAIAJrcSICEARBf0YNASACIAZqIQYgACECDAMLIAJBf0cNAgtB1A9B1A8oAgBBBHI2AgALIAEQBCECQQAQBCEAIAJBf0YNBSAAQX9GDQUgACACTQ0FIAAgAmsiBiAFQShqTQ0FC0HID0HIDygCACAGaiIANgIAQcwPKAIAIABJBEBBzA8gADYCAAsCQEGwDCgCACIEBEBB2A8hAANAIAIgACgCACIBIAAoAgQiA2pGDQIgACgCCCIADQALDAQLQagMKAIAIgBBACAAIAJNG0UEQEGoDCACNgIAC0EAIQBB3A8gBjYCAEHYDyACNgIAQbgMQX82AgBBvAxB8A8oAgA2AgBB5A9BADYCAANAIABBA3QiAUHIDGogAUHADGoiAzYCACABQcwMaiADNgIAIABBAWoiAEEgRw0AC0GkDCAGQShrIgBBeCACa0EHcSIBayIDNgIAQbAMIAEgAmoiATYCACABIANBAXI2AgQgACACakEoNgIEQbQMQYAQKAIANgIADAQLIAIgBE0NAiABIARLDQIgACgCDEEIcQ0CIAAgAyAGajYCBEGwDCAEQXggBGtBB3EiAGoiATYCAEGkDEGkDCgCACAGaiICIABrIgA2AgAgASAAQQFyNgIEIAIgBGpBKDYCBEG0DEGAECgCADYCAAwDC0EAIQMMBQtBACECDAMLQagMKAIAIAJLBEBBqAwgAjYCAAsgAiAGaiEBQdgPIQACQAJAAkADQCABIAAoAgBHBEAgACgCCCIADQEMAgsLIAAtAAxBCHFFDQELQdgPIQADQAJAIAQgACgCACIBTwRAIAEgACgCBGoiAyAESw0BCyAAKAIIIQAMAQsLQaQMIAZBKGsiAEF4IAJrQQdxIgFrIgg2AgBBsAwgASACaiIBNgIAIAEgCEEBcjYCBCAAIAJqQSg2AgRBtAxBgBAoAgA2AgAgBCADQScgA2tBB3FqQS9rIgAgACAEQRBqSRsiAUEbNgIEIAFB4A8pAgA3AhAgAUHYDykCADcCCEHgDyABQQhqNgIAQdwPIAY2AgBB2A8gAjYCAEHkD0EANgIAIAFBGGohAANAIABBBzYCBCAAQQhqIQwgAEEEaiEAIAwgA0kNAAsgASAERg0CIAEgASgCBEF+cTYCBCAEIAEgBGsiAkEBcjYCBCABIAI2AgAgAkH/AU0EQCACQXhxQcAMaiEAAn9BmAwoAgAiAUEBIAJBA3Z0IgJxRQRAQZgMIAEgAnI2AgAgAAwBCyAAKAIICyEBIAAgBDYCCCABIAQ2AgwgBCAANgIMIAQgATYCCAwDC0EfIQAgAkH///8HTQRAIAJBJiACQQh2ZyIAa3ZBAXEgAEEBdGtBPmohAAsgBCAANgIcIARCADcCECAAQQJ0QcgOaiEBAkBBnAwoAgAiA0EBIAB0IgZxRQRAQZwMIAMgBnI2AgAgASAENgIADAELIAJBGSAAQQF2a0EAIABBH0cbdCEAIAEoAgAhAwNAIAMiASgCBEF4cSACRg0DIABBHXYhAyAAQQF0IQAgASADQQRxaiIGKAIQIgMNAAsgBiAENgIQCyAEIAE2AhggBCAENgIMIAQgBDYCCAwCCyAAIAI2AgAgACAAKAIEIAZqNgIEIAJBeCACa0EHcWoiByAFQQNyNgIEIAFBeCABa0EHcWoiBCAFIAdqIgVrIQYCQEGwDCgCACAERgRAQbAMIAU2AgBBpAxBpAwoAgAgBmoiADYCACAFIABBAXI2AgQMAQtBrAwoAgAgBEYEQEGsDCAFNgIAQaAMQaAMKAIAIAZqIgA2AgAgBSAAQQFyNgIEIAAgBWogADYCAAwBCyAEKAIEIgJBA3FBAUYEQCACQXhxIQkCQCACQf8BTQRAIAQoAgwiACAEKAIIIgFGBEBBmAxBmAwoAgBBfiACQQN2d3E2AgAMAgsgASAANgIMIAAgATYCCAwBCyAEKAIYIQgCQCAEIAQoAgwiAEcEQEGoDCgCABogBCgCCCIBIAA2AgwgACABNgIIDAELAkAgBEEUaiIBKAIAIgJFBEAgBCgCECICRQ0BIARBEGohAQsDQCABIQMgAiIAQRRqIgEoAgAiAg0AIABBEGohASAAKAIQIgINAAsgA0EANgIADAELQQAhAAsgCEUNAAJAIAQoAhwiAUECdEHIDmoiAigCACAERgRAIAIgADYCACAADQFBnAxBnAwoAgBBfiABd3E2AgAMAgsgCEEQQRQgCCgCECAERhtqIAA2AgAgAEUNAQsgACAINgIYIAQoAhAiAQRAIAAgATYCECABIAA2AhgLIAQoAhQiAUUNACAAIAE2AhQgASAANgIYCyAGIAlqIQYgBCAJaiIEKAIEIQILIAQgAkF+cTYCBCAFIAZBAXI2AgQgBSAGaiAGNgIAIAZB/wFNBEAgBkF4cUHADGohAAJ/QZgMKAIAIgFBASAGQQN2dCICcUUEQEGYDCABIAJyNgIAIAAMAQsgACgCCAshASAAIAU2AgggASAFNgIMIAUgADYCDCAFIAE2AggMAQtBHyECIAZB////B00EQCAGQSYgBkEIdmciAGt2QQFxIABBAXRrQT5qIQILIAUgAjYCHCAFQgA3AhAgAkECdEHIDmohAQJAAkBBnAwoAgAiAEEBIAJ0IgNxRQRAQZwMIAAgA3I2AgAgASAFNgIADAELIAZBGSACQQF2a0EAIAJBH0cbdCECIAEoAgAhAANAIAAiASgCBEF4cSAGRg0CIAJBHXYhACACQQF0IQIgASAAQQRxaiIDKAIQIgANAAsgAyAFNgIQCyAFIAE2AhggBSAFNgIMIAUgBTYCCAwBCyABKAIIIgAgBTYCDCABIAU2AgggBUEANgIYIAUgATYCDCAFIAA2AggLIAdBCGohAAwFCyABKAIIIgAgBDYCDCABIAQ2AgggBEEANgIYIAQgATYCDCAEIAA2AggLQaQMKAIAIgAgBU0NAEGkDCAAIAVrIgE2AgBBsAxBsAwoAgAiACAFaiICNgIAIAIgAUEBcjYCBCAAIAVBA3I2AgQgAEEIaiEADAMLQZQMQTA2AgBBACEADAILAkAgB0UNAAJAIAMoAhwiAEECdEHIDmoiASgCACADRgRAIAEgAjYCACACDQFBnAwgCEF+IAB3cSIINgIADAILIAdBEEEUIAcoAhAgA0YbaiACNgIAIAJFDQELIAIgBzYCGCADKAIQIgAEQCACIAA2AhAgACACNgIYCyADKAIUIgBFDQAgAiAANgIUIAAgAjYCGAsCQCAEQQ9NBEAgAyAEIAVqIgBBA3I2AgQgACADaiIAIAAoAgRBAXI2AgQMAQsgAyAFQQNyNgIEIAMgBWoiAiAEQQFyNgIEIAIgBGogBDYCACAEQf8BTQRAIARBeHFBwAxqIQACf0GYDCgCACIBQQEgBEEDdnQiBXFFBEBBmAwgASAFcjYCACAADAELIAAoAggLIQEgACACNgIIIAEgAjYCDCACIAA2AgwgAiABNgIIDAELQR8hACAEQf///wdNBEAgBEEmIARBCHZnIgBrdkEBcSAAQQF0a0E+aiEACyACIAA2AhwgAkIANwIQIABBAnRByA5qIQECQAJAIAhBASAAdCIFcUUEQEGcDCAFIAhyNgIAIAEgAjYCAAwBCyAEQRkgAEEBdmtBACAAQR9HG3QhACABKAIAIQUDQCAFIgEoAgRBeHEgBEYNAiAAQR12IQUgAEEBdCEAIAEgBUEEcWoiBigCECIFDQALIAYgAjYCEAsgAiABNgIYIAIgAjYCDCACIAI2AggMAQsgASgCCCIAIAI2AgwgASACNgIIIAJBADYCGCACIAE2AgwgAiAANgIICyADQQhqIQAMAQsCQCAJRQ0AAkAgAigCHCIAQQJ0QcgOaiIBKAIAIAJGBEAgASADNgIAIAMNAUGcDCALQX4gAHdxNgIADAILIAlBEEEUIAkoAhAgAkYbaiADNgIAIANFDQELIAMgCTYCGCACKAIQIgAEQCADIAA2AhAgACADNgIYCyACKAIUIgBFDQAgAyAANgIUIAAgAzYCGAsCQCAEQQ9NBEAgAiAEIAVqIgBBA3I2AgQgACACaiIAIAAoAgRBAXI2AgQMAQsgAiAFQQNyNgIEIAIgBWoiAyAEQQFyNgIEIAMgBGogBDYCACAHBEAgB0F4cUHADGohAEGsDCgCACEBAn9BASAHQQN2dCIFIAZxRQRAQZgMIAUgBnI2AgAgAAwBCyAAKAIICyEFIAAgATYCCCAFIAE2AgwgASAANgIMIAEgBTYCCAtBrAwgAzYCAEGgDCAENgIACyACQQhqIQALIApBEGokACAAC60CAQF/IwBBMGsiAyQAIAMgADYCLCADIAE2AiggAyACNgIkIANBADYCDCADQRA2AggDQCADKAIMIAMoAiRJBEAgAygCCEEQRgRAIANBEGoiACADKAIsIgEpAPABNwAAIAAgASkA+AE3AAggACADKAIsEAogA0EPNgIIA0ACQCADKAIIIgBBAEgNAAJAIAAgAygCLEHwAWpqIgAtAABB/wFGBEAgAEEAOgAADAELIAMoAgggAygCLEHwAWpqIgAgAC0AAEEBajoAAAwBCyADIAMoAghBAWs2AggMAQsLIANBADYCCAsgAygCKCADKAIMaiIAIAAtAAAgAygCCCADQRBqai0AAHM6AAAgAyADKAIMQQFqNgIMIAMgAygCCEEBajYCCAwBCwsgA0EwaiQAC1wBAX8jAEEQayICIAA2AgwgAiABNgIIIAJBADoABwNAIAItAAciAUEQT0UEQCABIAIoAgxqIgAgASACKAIIai0AACAALQAAczoAACACIAItAAdBAWo6AAcMAQsLC3sBAX8jAEEQayIBIAA2AgwgAUEAOgALA0AgAS0AC0EET0UEQCABQQA6AAoDQCABLQAKIgBBBE9FBEAgAS0ACyABKAIMIABBAnRqaiIAIAAtAAAtAJAKOgAAIAEgAS0ACkEBajoACgwBCwsgASABLQALQQFqOgALDAELCwuCEQEDfyMAQYACayIFJAACQCABRQ0AIAJFDQAgBSAAKAIEIAAoAggQCwJAAkACQCAAKAIAQQFrDgIAAQILIwBBIGsiAyQAIAMgBTYCHCADIAE2AhggAyACNgIUIANBADYCEANAIAMoAhAgAygCFEkEQCADIAMoAhgiACkAADcAACADIAApAAg3AAggAygCGCEAIAMoAhwhBCMAQRBrIgEkACABIAA2AgwgASAENgIIIAFBADoAB0EOIAEoAgwgASgCCBADIAFBDToABwNAIAEtAAcEQCABKAIMEAcgASgCDBAPIAEtAAcgASgCDCABKAIIEAMgASgCDCEEIwBBEGsiACQAIAAgBDYCDCAAQQA2AggDQCAAKAIIIgRBBEgEQCAAIAAoAgwgBEECdGotAAA6AAcgACAAKAIMIAAoAghBAnRqLQABOgAGIAAgACgCDCAAKAIIQQJ0ai0AAjoABSAAIAAoAgwgACgCCEECdGotAAM6AAQgAC0AByIEQQBsIAQQAkH/AXFzIAAtAAcQAkH/AXEQAkH/AXFzIAAtAAcQAkH/AXEQAkH/AXEQAkH/AXFzIAAtAAcQAkH/AXEQAkH/AXEQAkH/AXEQAkH/AXFBAGxzIAAtAAYiBCAEEAJB/wFxcyAALQAGEAJB/wFxEAJB/wFxQQBscyAALQAGEAJB/wFxEAJB/wFxEAJB/wFxcyAALQAGEAJB/wFxEAJB/wFxEAJB/wFxEAJB/wFxQQBsc3MgAC0ABSIEIAQQAkH/AXFBAGxzIAAtAAUQAkH/AXEQAkH/AXFzIAAtAAUQAkH/AXEQAkH/AXEQAkH/AXFzIAAtAAUQAkH/AXEQAkH/AXEQAkH/AXEQAkH/AXFBAGxzcyAALQAEIgQgBBACQf8BcUEAbHMgAC0ABBACQf8BcRACQf8BcUEAbHMgAC0ABBACQf8BcRACQf8BcRACQf8BcXMgAC0ABBACQf8BcRACQf8BcRACQf8BcRACQf8BcUEAbHNzIQQgACgCDCAAKAIIQQJ0aiAEOgAAIAAtAAcgAC0ABxACQf8BcUEAbHMgAC0ABxACQf8BcRACQf8BcUEAbHMgAC0ABxACQf8BcRACQf8BcRACQf8BcXMgAC0ABxACQf8BcRACQf8BcRACQf8BcRACQf8BcUEAbHMgAC0ABkEAbCAALQAGEAJB/wFxcyAALQAGEAJB/wFxEAJB/wFxcyAALQAGEAJB/wFxEAJB/wFxEAJB/wFxcyAALQAGEAJB/wFxEAJB/wFxEAJB/wFxEAJB/wFxQQBsc3MgAC0ABSAALQAFEAJB/wFxcyAALQAFEAJB/wFxEAJB/wFxQQBscyAALQAFEAJB/wFxEAJB/wFxEAJB/wFxcyAALQAFEAJB/wFxEAJB/wFxEAJB/wFxEAJB/wFxQQBsc3MgAC0ABCAALQAEEAJB/wFxQQBscyAALQAEEAJB/wFxEAJB/wFxcyAALQAEEAJB/wFxEAJB/wFxEAJB/wFxcyAALQAEEAJB/wFxEAJB/wFxEAJB/wFxEAJB/wFxQQBsc3MhBCAAKAIMIAAoAghBAnRqIAQ6AAEgAC0AByAALQAHEAJB/wFxQQBscyAALQAHEAJB/wFxEAJB/wFxcyAALQAHEAJB/wFxEAJB/wFxEAJB/wFxcyAALQAHEAJB/wFxEAJB/wFxEAJB/wFxEAJB/wFxQQBscyAALQAGIAAtAAYQAkH/AXFBAGxzIAAtAAYQAkH/AXEQAkH/AXFBAGxzIAAtAAYQAkH/AXEQAkH/AXEQAkH/AXFzIAAtAAYQAkH/AXEQAkH/AXEQAkH/AXEQAkH/AXFBAGxzcyAALQAFQQBsIAAtAAUQAkH/AXFzIAAtAAUQAkH/AXEQAkH/AXFzIAAtAAUQAkH/AXEQAkH/AXEQAkH/AXFzIAAtAAUQAkH/AXEQAkH/AXEQAkH/AXEQAkH/AXFBAGxzcyAALQAEIAAtAAQQAkH/AXFzIAAtAAQQAkH/AXEQAkH/AXFBAGxzIAAtAAQQAkH/AXEQAkH/AXEQAkH/AXFzIAAtAAQQAkH/AXEQAkH/AXEQAkH/AXEQAkH/AXFBAGxzcyEEIAAoAgwgACgCCEECdGogBDoAAiAALQAHIAAtAAcQAkH/AXFzIAAtAAcQAkH/AXEQAkH/AXFBAGxzIAAtAAcQAkH/AXEQAkH/AXEQAkH/AXFzIAAtAAcQAkH/AXEQAkH/AXEQAkH/AXEQAkH/AXFBAGxzIAAtAAYgAC0ABhACQf8BcUEAbHMgAC0ABhACQf8BcRACQf8BcXMgAC0ABhACQf8BcRACQf8BcRACQf8BcXMgAC0ABhACQf8BcRACQf8BcRACQf8BcRACQf8BcUEAbHNzIAAtAAUgAC0ABRACQf8BcUEAbHMgAC0ABRACQf8BcRACQf8BcUEAbHMgAC0ABRACQf8BcRACQf8BcRACQf8BcXMgAC0ABRACQf8BcRACQf8BcRACQf8BcRACQf8BcUEAbHNzIAAtAARBAGwgAC0ABBACQf8BcXMgAC0ABBACQf8BcRACQf8BcXMgAC0ABBACQf8BcRACQf8BcRACQf8BcXMgAC0ABBACQf8BcRACQf8BcRACQf8BcRACQf8BcUEAbHNzIQQgACgCDCAAKAIIQQJ0aiAEOgADIAAgACgCCEEBajYCCAwBCwsgAEEQaiQAIAEgAS0AB0EBazoABwwBCwsgASgCDBAHIAEoAgwQD0EAIAEoAgwgASgCCBADIAFBEGokACADKAIYIAMoAhxB8AFqEA4gAygCHCIAIAMpAAA3APABIAAgAykACDcA+AEgAyADKAIYQRBqNgIYIAMgAygCEEEQajYCEAwBCwsgA0EgaiQADAELIAUgASACEA0LIAIhAwsgBUGAAmokACADC4ACAQJ/IwBBgAJrIgMkAAJAIAFFDQAgAkUNACADIAAoAgQgACgCCBALAkACQAJAIAAoAgBBAWsOAgABAgsjAEEgayIAJAAgACADNgIcIAAgATYCGCAAIAI2AhQgACAAKAIcQfABajYCDCAAQQA2AhADQCAAKAIQIAAoAhRJBEAgACgCGCAAKAIMEA4gACgCGCAAKAIcEAogACAAKAIYNgIMIAAgACgCGEEQajYCGCAAIAAoAhBBEGo2AhAMAQsLIAAoAhwiASAAKAIMIgQpAAA3APABIAEgBCkACDcA+AEgAEEgaiQADAELIAMgASACEA0LIAIhBAsgA0GAAmokACAEC9ILAQd/AkAgAEUNACAAQQhrIgIgAEEEaygCACIBQXhxIgBqIQUCQCABQQFxDQAgAUEDcUUNASACIAIoAgAiAWsiAkGoDCgCAEkNASAAIAFqIQACQAJAQawMKAIAIAJHBEAgAUH/AU0EQCABQQN2IQQgAigCDCIBIAIoAggiA0YEQEGYDEGYDCgCAEF+IAR3cTYCAAwFCyADIAE2AgwgASADNgIIDAQLIAIoAhghBiACIAIoAgwiAUcEQCACKAIIIgMgATYCDCABIAM2AggMAwsgAkEUaiIEKAIAIgNFBEAgAigCECIDRQ0CIAJBEGohBAsDQCAEIQcgAyIBQRRqIgQoAgAiAw0AIAFBEGohBCABKAIQIgMNAAsgB0EANgIADAILIAUoAgQiAUEDcUEDRw0CQaAMIAA2AgAgBSABQX5xNgIEIAIgAEEBcjYCBCAFIAA2AgAPC0EAIQELIAZFDQACQCACKAIcIgNBAnRByA5qIgQoAgAgAkYEQCAEIAE2AgAgAQ0BQZwMQZwMKAIAQX4gA3dxNgIADAILIAZBEEEUIAYoAhAgAkYbaiABNgIAIAFFDQELIAEgBjYCGCACKAIQIgMEQCABIAM2AhAgAyABNgIYCyACKAIUIgNFDQAgASADNgIUIAMgATYCGAsgAiAFTw0AIAUoAgQiAUEBcUUNAAJAAkACQAJAIAFBAnFFBEBBsAwoAgAgBUYEQEGwDCACNgIAQaQMQaQMKAIAIABqIgA2AgAgAiAAQQFyNgIEIAJBrAwoAgBHDQZBoAxBADYCAEGsDEEANgIADwtBrAwoAgAgBUYEQEGsDCACNgIAQaAMQaAMKAIAIABqIgA2AgAgAiAAQQFyNgIEIAAgAmogADYCAA8LIAFBeHEgAGohACABQf8BTQRAIAFBA3YhBCAFKAIMIgEgBSgCCCIDRgRAQZgMQZgMKAIAQX4gBHdxNgIADAULIAMgATYCDCABIAM2AggMBAsgBSgCGCEGIAUgBSgCDCIBRwRAQagMKAIAGiAFKAIIIgMgATYCDCABIAM2AggMAwsgBUEUaiIEKAIAIgNFBEAgBSgCECIDRQ0CIAVBEGohBAsDQCAEIQcgAyIBQRRqIgQoAgAiAw0AIAFBEGohBCABKAIQIgMNAAsgB0EANgIADAILIAUgAUF+cTYCBCACIABBAXI2AgQgACACaiAANgIADAMLQQAhAQsgBkUNAAJAIAUoAhwiA0ECdEHIDmoiBCgCACAFRgRAIAQgATYCACABDQFBnAxBnAwoAgBBfiADd3E2AgAMAgsgBkEQQRQgBigCECAFRhtqIAE2AgAgAUUNAQsgASAGNgIYIAUoAhAiAwRAIAEgAzYCECADIAE2AhgLIAUoAhQiA0UNACABIAM2AhQgAyABNgIYCyACIABBAXI2AgQgACACaiAANgIAIAJBrAwoAgBHDQBBoAwgADYCAA8LIABB/wFNBEAgAEF4cUHADGohAQJ/QZgMKAIAIgNBASAAQQN2dCIAcUUEQEGYDCAAIANyNgIAIAEMAQsgASgCCAshACABIAI2AgggACACNgIMIAIgATYCDCACIAA2AggPC0EfIQMgAEH///8HTQRAIABBJiAAQQh2ZyIBa3ZBAXEgAUEBdGtBPmohAwsgAiADNgIcIAJCADcCECADQQJ0QcgOaiEBAkACQAJAQZwMKAIAIgRBASADdCIHcUUEQEGcDCAEIAdyNgIAIAEgAjYCACACIAE2AhgMAQsgAEEZIANBAXZrQQAgA0EfRxt0IQMgASgCACEBA0AgASIEKAIEQXhxIABGDQIgA0EddiEBIANBAXQhAyAEIAFBBHFqIgdBEGooAgAiAQ0ACyAHIAI2AhAgAiAENgIYCyACIAI2AgwgAiACNgIIDAELIAQoAggiACACNgIMIAQgAjYCCCACQQA2AhggAiAENgIMIAIgADYCCAtBuAxBuAwoAgBBAWsiAEF/IAAbNgIACwtjAQF/QQwQBSIDIAA2AgAgA0EgEAUiADYCBCAAIAEpABg3ABggACABKQAQNwAQIAAgASkACDcACCAAIAEpAAA3AAAgA0EQEAUiADYCCCAAIAIpAAg3AAggACACKQAANwAAIAMLC6EEAgBBgAgLkARjfHd78mtvxTABZyv+16t2yoLJffpZR/Ct1KKvnKRywLf9kyY2P/fMNKXl8XHYMRUExyPDGJYFmgcSgOLrJ7J1CYMsGhtuWqBSO9azKeMvhFPRAO0g/LFbasu+OUpMWM/Q76r7Q00zhUX5An9QPJ+oUaNAj5KdOPW8ttohEP/z0s0ME+xfl0QXxKd+PWRdGXNggU/cIiqQiEbuuBTeXgvb4DI6CkkGJFzC06xikZXkeefIN22N1U6pbFb06mV6rgi6eCUuHKa0xujddB9LvYuKcD61ZkgD9g5hNVe5hsEdnuH4mBFp2Y6Umx6H6c5VKN+MoYkNv+ZCaEGZLQ+wVLsWjQECBAgQIECAGzYAAAAAAFIJatUwNqU4v0CjnoHz1/t84zmCmy//hzSOQ0TE3unLVHuUMqbCIz3uTJULQvrDTgguoWYo2SSydluiSW2L0SVy+PZkhmiYFtSkXMxdZbaSbHBIUP3tudpeFUZXp42dhJDYqwCMvNMK9+RYBbizRQbQLB6Pyj8PAsGvvQMBE4prOpERQU9n3OqX8s/O8LTmc5asdCLnrTWF4vk36Bx1325H8RpxHSnFiW+3Yg6qGL4b/FY+S8bSeSCa28D+eM1a9B/dqDOIB8cxsRIQWSeA7F9gUX+pGbVKDS3lep+TyZzvoOA7Ta4q9bDI67s8g1OZYRcrBH66d9Ym4WkUY1UhDH0AQZAMCwMQCAE=")||(FB=DB,DB=pB.locateFile?pB.locateFile(FB,_B):_B+FB);var kB=e=>{for(;e.length>0;)e.shift()(pB)};pB.noExitRuntime;var zB,jB=e=>{var t=(e-xB.buffer.byteLength+65535)/65536;try{return xB.grow(t),vB(),1}catch(e){}},HB={b:()=>{OB("")},a:e=>{var t=IB.length,r=2147483648;if((e>>>=0)>r)return!1;for(var n=(e,t)=>e+(t-e%t)%t,i=1;i<=4;i*=2){var o=t*(1+.2/i);o=Math.min(o,e+100663296);var s=Math.min(r,n(Math.max(e,o),65536));if(jB(s))return!0}return!1}},qB=function(){var e={a:HB};function t(e,t){var r;return qB=e.exports,xB=qB.c,vB(),r=qB.d,MB.unshift(r),function(){if(SB--,pB.monitorRunDependencies&&pB.monitorRunDependencies(SB),0==SB&&BB){var e=BB;BB=null,e()}}(),qB}if(SB++,pB.monitorRunDependencies&&pB.monitorRunDependencies(SB),pB.instantiateWasm)try{return pB.instantiateWasm(e,t)}catch(e){return CB(`Module.instantiateWasm callback failed with error: ${e}`),!1}return GB(0,DB,e,(function(e){t(e.instance)})),{}}();function VB(){function e(){zB||(zB=!0,pB.calledRun=!0,TB||(kB(MB),pB.onRuntimeInitialized&&pB.onRuntimeInitialized(),function(){if(pB.postRun)for("function"==typeof pB.postRun&&(pB.postRun=[pB.postRun]);pB.postRun.length;)e=pB.postRun.shift(),wB.unshift(e);var e;kB(wB)}()))}SB>0||(!function(){if(pB.preRun)for("function"==typeof pB.preRun&&(pB.preRun=[pB.preRun]);pB.preRun.length;)e=pB.preRun.shift(),RB.unshift(e);var e;kB(RB)}(),SB>0||(pB.setStatus?(pB.setStatus("Running..."),setTimeout((function(){setTimeout((function(){pB.setStatus("")}),1),e()}),1)):e()))}if(pB._UGCWasm_CipherAES_New=(e,t,r)=>(pB._UGCWasm_CipherAES_New=qB.e)(e,t,r),pB._UGCWasm_CipherAES_Encrypt=(e,t,r)=>(pB._UGCWasm_CipherAES_Encrypt=qB.f)(e,t,r),pB._UGCWasm_CipherAES_Decrypt=(e,t,r)=>(pB._UGCWasm_CipherAES_Decrypt=qB.g)(e,t,r),pB._malloc=e=>(pB._malloc=qB.i)(e),pB._free=e=>(pB._free=qB.j)(e),BB=function e(){zB||VB(),zB||(BB=e)},pB.preInit)for("function"==typeof pB.preInit&&(pB.preInit=[pB.preInit]);pB.preInit.length>0;)pB.preInit.pop()();VB();var YB=function(e){e=void 0!==e?e:{};var t,r,n=Object.assign({},e),i="object"==typeof window,o="function"==typeof importScripts,s="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,a="";if(s){var u=require("fs"),c=require("path");a=o?c.dirname(a)+"/":__dirname+"/",t=(e,t)=>(e=T(e)?new URL(e):c.normalize(e),u.readFileSync(e,t?void 0:"utf8")),r=e=>{var r=t(e,!0);return r.buffer||(r=new Uint8Array(r)),r},!e.thisProgram&&process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),"undefined"!=typeof module&&(module.exports=e),process.on("uncaughtException",(e=>{if(!("unwind"===e||e instanceof M||e.context instanceof M))throw e})),e.inspect=()=>"[Emscripten Module object]"}else(i||o)&&(o?a=self.location.href:"undefined"!=typeof document&&document.currentScript&&(a=document.currentScript.src),a=0!==a.indexOf("blob:")?a.substr(0,a.replace(/[?#].*/,"").lastIndexOf("/")+1):"",t=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},o&&(r=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}));e.print||console.log.bind(console);var l,h,p=e.printErr||console.error.bind(console);Object.assign(e,n),n=null,e.arguments&&e.arguments,e.thisProgram&&e.thisProgram,e.quit&&e.quit,e.wasmBinary&&(l=e.wasmBinary),"object"!=typeof WebAssembly&&x("no native wasm support detected");var d,f=!1;function A(){var t=h.buffer;e.HEAP8=new Int8Array(t),e.HEAP16=new Int16Array(t),e.HEAPU8=d=new Uint8Array(t),e.HEAPU16=new Uint16Array(t),e.HEAP32=new Int32Array(t),e.HEAPU32=new Uint32Array(t),e.HEAPF32=new Float32Array(t),e.HEAPF64=new Float64Array(t)}var g=[],_=[],m=[],y=0,E=null;function x(t){throw e.onAbort&&e.onAbort(t),p(t="Aborted("+t+")"),f=!0,t+=". Build with -sASSERTIONS for more info.",new WebAssembly.RuntimeError(t)}var C,b="data:application/octet-stream;base64,",I=e=>e.startsWith(b),T=e=>e.startsWith("file://");function v(e){if(e==C&&l)return new Uint8Array(l);var t=function(e){if(I(e))return function(e){if(void 0!==s&&s){var t=Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.length)}for(var r=atob(e),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n}(e.slice(37))}(e);if(t)return t;if(r)return r(e);throw"both async and sync fetching of the wasm failed"}function R(e,t,r){return function(e){return Promise.resolve().then((()=>v(e)))}(e).then((e=>WebAssembly.instantiate(e,t))).then((e=>e)).then(r,(e=>{p(`failed to asynchronously prepare wasm: ${e}`),x(e)}))}function M(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}I(C="data:application/octet-stream;base64,AGFzbQEAAAABLghgAX8Bf2AAAGADf39/AGADf39/AX9gAX8AYAR/f39/AGACf38AYAV/f39/fwACEwMBYQFhAAEBYQFiAAABYQFjAAIDDw4EAAACAQIFBgcABAMDAwQFAXABAQEFBwEBgAKAgAIGCAF/AUGQlwQLByUJAWQCAAFlAAcBZgAQAWcADwFoAA4BaQANAWoBAAFrAAwBbAADCuvpAQ7SCwEHfwJAIABFDQAgAEEIayICIABBBGsoAgAiAUF4cSIAaiEFAkAgAUEBcQ0AIAFBA3FFDQEgAiACKAIAIgFrIgJBqBMoAgBJDQEgACABaiEAAkACQEGsEygCACACRwRAIAFB/wFNBEAgAUEDdiEEIAIoAgwiASACKAIIIgNGBEBBmBNBmBMoAgBBfiAEd3E2AgAMBQsgAyABNgIMIAEgAzYCCAwECyACKAIYIQYgAiACKAIMIgFHBEAgAigCCCIDIAE2AgwgASADNgIIDAMLIAJBFGoiBCgCACIDRQRAIAIoAhAiA0UNAiACQRBqIQQLA0AgBCEHIAMiAUEUaiIEKAIAIgMNACABQRBqIQQgASgCECIDDQALIAdBADYCAAwCCyAFKAIEIgFBA3FBA0cNAkGgEyAANgIAIAUgAUF+cTYCBCACIABBAXI2AgQgBSAANgIADwtBACEBCyAGRQ0AAkAgAigCHCIDQQJ0QcgVaiIEKAIAIAJGBEAgBCABNgIAIAENAUGcE0GcEygCAEF+IAN3cTYCAAwCCyAGQRBBFCAGKAIQIAJGG2ogATYCACABRQ0BCyABIAY2AhggAigCECIDBEAgASADNgIQIAMgATYCGAsgAigCFCIDRQ0AIAEgAzYCFCADIAE2AhgLIAIgBU8NACAFKAIEIgFBAXFFDQACQAJAAkACQCABQQJxRQRAQbATKAIAIAVGBEBBsBMgAjYCAEGkE0GkEygCACAAaiIANgIAIAIgAEEBcjYCBCACQawTKAIARw0GQaATQQA2AgBBrBNBADYCAA8LQawTKAIAIAVGBEBBrBMgAjYCAEGgE0GgEygCACAAaiIANgIAIAIgAEEBcjYCBCAAIAJqIAA2AgAPCyABQXhxIABqIQAgAUH/AU0EQCABQQN2IQQgBSgCDCIBIAUoAggiA0YEQEGYE0GYEygCAEF+IAR3cTYCAAwFCyADIAE2AgwgASADNgIIDAQLIAUoAhghBiAFIAUoAgwiAUcEQEGoEygCABogBSgCCCIDIAE2AgwgASADNgIIDAMLIAVBFGoiBCgCACIDRQRAIAUoAhAiA0UNAiAFQRBqIQQLA0AgBCEHIAMiAUEUaiIEKAIAIgMNACABQRBqIQQgASgCECIDDQALIAdBADYCAAwCCyAFIAFBfnE2AgQgAiAAQQFyNgIEIAAgAmogADYCAAwDC0EAIQELIAZFDQACQCAFKAIcIgNBAnRByBVqIgQoAgAgBUYEQCAEIAE2AgAgAQ0BQZwTQZwTKAIAQX4gA3dxNgIADAILIAZBEEEUIAYoAhAgBUYbaiABNgIAIAFFDQELIAEgBjYCGCAFKAIQIgMEQCABIAM2AhAgAyABNgIYCyAFKAIUIgNFDQAgASADNgIUIAMgATYCGAsgAiAAQQFyNgIEIAAgAmogADYCACACQawTKAIARw0AQaATIAA2AgAPCyAAQf8BTQRAIABBeHFBwBNqIQECf0GYEygCACIDQQEgAEEDdnQiAHFFBEBBmBMgACADcjYCACABDAELIAEoAggLIQAgASACNgIIIAAgAjYCDCACIAE2AgwgAiAANgIIDwtBHyEDIABB////B00EQCAAQSYgAEEIdmciAWt2QQFxIAFBAXRrQT5qIQMLIAIgAzYCHCACQgA3AhAgA0ECdEHIFWohAQJAAkACQEGcEygCACIEQQEgA3QiB3FFBEBBnBMgBCAHcjYCACABIAI2AgAgAiABNgIYDAELIABBGSADQQF2a0EAIANBH0cbdCEDIAEoAgAhAQNAIAEiBCgCBEF4cSAARg0CIANBHXYhASADQQF0IQMgBCABQQRxaiIHQRBqKAIAIgENAAsgByACNgIQIAIgBDYCGAsgAiACNgIMIAIgAjYCCAwBCyAEKAIIIgAgAjYCDCAEIAI2AgggAkEANgIYIAIgBDYCDCACIAA2AggLQbgTQbgTKAIAQQFrIgBBfyAAGzYCAAsLTwECf0GQEygCACIBIABBB2pBeHEiAmohAAJAIAJBACAAIAFNGw0AIAA/AEEQdEsEQCAAEAFFDQELQZATIAA2AgAgAQ8LQZQTQTA2AgBBfws1AQF/QQEgACAAQQFNGyEAAkADQCAAEAwiAQ0BQYgXKAIAIgEEQCABEQEADAELCxAAAAsgAQuOTwEBfyMAQTBrIgMgADYCLCADIAE2AiggAyACNgIkIAMgAygCLDYCICADIAMoAigiAC0AAEEYdCAALQABQRB0ciAALQACQQh0ciAALQADcjYCHCADIAMoAigtAAcgAygCKC0ABEEYdCADKAIoLQAFQRB0ciADKAIoLQAGQQh0cnI2AhggAyADKAIoLQALIAMoAigtAAhBGHQgAygCKC0ACUEQdHIgAygCKC0ACkEIdHJyNgIUIAMgAygCKC0ADyADKAIoLQAMQRh0IAMoAigtAA1BEHRyIAMoAigtAA5BCHRycjYCECADIAMoAiAoAgAgAygCECADKAIYIAMoAhRzc3M2AgwgAyADKAIMQf8BcUECdEGACmooAgAiAEEIdCAAQRh2cjYCCCADIAMoAgxBCHY2AgwgAyADKAIIIAMoAhxzNgIcIAMgAygCDEH/AXFBAnRBgApqKAIAQRB0IAMoAgxB/wFxQQJ0QYAKaigCAEEQdnI2AgggAyADKAIMQQh2NgIMIAMgAygCCCADKAIcczYCHCADIAMoAgxB/wFxQQJ0QYAKaigCAEEYdCADKAIMQf8BcUECdEGACmooAgBBCHZyNgIIIAMgAygCDEEIdjYCDCADIAMoAgggAygCHHM2AhwgAyADKAIMQQJ0QYAKaigCADYCBCADIAMoAhwgAygCBHM2AgwgAyADKAIgKAIEIAMoAgwgAygCFCADKAIQc3NzNgIcIAMgAygCHEH/AXFBAnRBgApqKAIAIgBBCHQgAEEYdnI2AgggAyADKAIcQQh2NgIcIAMgAygCCCADKAIYczYCGCADIAMoAhxB/wFxQQJ0QYAKaigCAEEQdCADKAIcQf8BcUECdEGACmooAgBBEHZyNgIIIAMgAygCHEEIdjYCHCADIAMoAgggAygCGHM2AhggAyADKAIcQf8BcUECdEGACmooAgBBGHQgAygCHEH/AXFBAnRBgApqKAIAQQh2cjYCCCADIAMoAhxBCHY2AhwgAyADKAIIIAMoAhhzNgIYIAMgAygCHEECdEGACmooAgA2AgQgAyADKAIYIAMoAgRzNgIcIAMgAygCICgCCCADKAIcIAMoAhAgAygCDHNzczYCGCADIAMoAhhB/wFxQQJ0QYAKaigCACIAQQh0IABBGHZyNgIIIAMgAygCGEEIdjYCGCADIAMoAgggAygCFHM2AhQgAyADKAIYQf8BcUECdEGACmooAgBBEHQgAygCGEH/AXFBAnRBgApqKAIAQRB2cjYCCCADIAMoAhhBCHY2AhggAyADKAIIIAMoAhRzNgIUIAMgAygCGEH/AXFBAnRBgApqKAIAQRh0IAMoAhhB/wFxQQJ0QYAKaigCAEEIdnI2AgggAyADKAIYQQh2NgIYIAMgAygCCCADKAIUczYCFCADIAMoAhhBAnRBgApqKAIANgIEIAMgAygCFCADKAIEczYCGCADIAMoAiAoAgwgAygCGCADKAIMIAMoAhxzc3M2AhQgAyADKAIUQf8BcUECdEGACmooAgAiAEEIdCAAQRh2cjYCCCADIAMoAhRBCHY2AhQgAyADKAIIIAMoAhBzNgIQIAMgAygCFEH/AXFBAnRBgApqKAIAQRB0IAMoAhRB/wFxQQJ0QYAKaigCAEEQdnI2AgggAyADKAIUQQh2NgIUIAMgAygCCCADKAIQczYCECADIAMoAhRB/wFxQQJ0QYAKaigCAEEYdCADKAIUQf8BcUECdEGACmooAgBBCHZyNgIIIAMgAygCFEEIdjYCFCADIAMoAgggAygCEHM2AhAgAyADKAIUQQJ0QYAKaigCADYCBCADIAMoAhAgAygCBHM2AhQgAyADKAIgKAIQIAMoAhQgAygCHCADKAIYc3NzNgIQIAMgAygCEEH/AXFBAnRBgApqKAIAIgBBCHQgAEEYdnI2AgggAyADKAIQQQh2NgIQIAMgAygCCCADKAIMczYCDCADIAMoAhBB/wFxQQJ0QYAKaigCAEEQdCADKAIQQf8BcUECdEGACmooAgBBEHZyNgIIIAMgAygCEEEIdjYCECADIAMoAgggAygCDHM2AgwgAyADKAIQQf8BcUECdEGACmooAgBBGHQgAygCEEH/AXFBAnRBgApqKAIAQQh2cjYCCCADIAMoAhBBCHY2AhAgAyADKAIIIAMoAgxzNgIMIAMgAygCEEECdEGACmooAgA2AgQgAyADKAIMIAMoAgRzNgIQIAMgAygCICgCFCADKAIQIAMoAhggAygCFHNzczYCDCADIAMoAgxB/wFxQQJ0QYAKaigCAEEIdCADKAIMQf8BcUECdEGACmooAgBBGHZyNgIIIAMgAygCDEEIdjYCDCADIAMoAgggAygCHHM2AhwgAyADKAIMQf8BcUECdEGACmooAgBBEHQgAygCDEH/AXFBAnRBgApqKAIAQRB2cjYCCCADIAMoAgxBCHY2AgwgAyADKAIIIAMoAhxzNgIcIAMgAygCDEH/AXFBAnRBgApqKAIAQRh0IAMoAgxB/wFxQQJ0QYAKaigCAEEIdnI2AgggAyADKAIMQQh2NgIMIAMgAygCCCADKAIcczYCHCADIAMoAgxBAnRBgApqKAIANgIEIAMgAygCHCADKAIEczYCDCADIAMoAiAoAhggAygCDCADKAIUIAMoAhBzc3M2AhwgAyADKAIcQf8BcUECdEGACmooAgBBCHQgAygCHEH/AXFBAnRBgApqKAIAQRh2cjYCCCADIAMoAhxBCHY2AhwgAyADKAIIIAMoAhhzNgIYIAMgAygCHEH/AXFBAnRBgApqKAIAQRB0IAMoAhxB/wFxQQJ0QYAKaigCAEEQdnI2AgggAyADKAIcQQh2NgIcIAMgAygCCCADKAIYczYCGCADIAMoAhxB/wFxQQJ0QYAKaigCAEEYdCADKAIcQf8BcUECdEGACmooAgBBCHZyNgIIIAMgAygCHEEIdjYCHCADIAMoAgggAygCGHM2AhggAyADKAIcQQJ0QYAKaigCADYCBCADIAMoAhggAygCBHM2AhwgAyADKAIgKAIcIAMoAhwgAygCECADKAIMc3NzNgIYIAMgAygCGEH/AXFBAnRBgApqKAIAQQh0IAMoAhhB/wFxQQJ0QYAKaigCAEEYdnI2AgggAyADKAIYQQh2NgIYIAMgAygCCCADKAIUczYCFCADIAMoAhhB/wFxQQJ0QYAKaigCAEEQdCADKAIYQf8BcUECdEGACmooAgBBEHZyNgIIIAMgAygCGEEIdjYCGCADIAMoAgggAygCFHM2AhQgAyADKAIYQf8BcUECdEGACmooAgBBGHQgAygCGEH/AXFBAnRBgApqKAIAQQh2cjYCCCADIAMoAhhBCHY2AhggAyADKAIIIAMoAhRzNgIUIAMgAygCGEECdEGACmooAgA2AgQgAyADKAIUIAMoAgRzNgIYIAMgAygCICgCICADKAIYIAMoAgwgAygCHHNzczYCFCADIAMoAhRB/wFxQQJ0QYAKaigCAEEIdCADKAIUQf8BcUECdEGACmooAgBBGHZyNgIIIAMgAygCFEEIdjYCFCADIAMoAgggAygCEHM2AhAgAyADKAIUQf8BcUECdEGACmooAgBBEHQgAygCFEH/AXFBAnRBgApqKAIAQRB2cjYCCCADIAMoAhRBCHY2AhQgAyADKAIIIAMoAhBzNgIQIAMgAygCFEH/AXFBAnRBgApqKAIAQRh0IAMoAhRB/wFxQQJ0QYAKaigCAEEIdnI2AgggAyADKAIUQQh2NgIUIAMgAygCCCADKAIQczYCECADIAMoAhRBAnRBgApqKAIANgIEIAMgAygCECADKAIEczYCFCADIAMoAiAoAiQgAygCFCADKAIcIAMoAhhzc3M2AhAgAyADKAIQQf8BcUECdEGACmooAgBBCHQgAygCEEH/AXFBAnRBgApqKAIAQRh2cjYCCCADIAMoAhBBCHY2AhAgAyADKAIIIAMoAgxzNgIMIAMgAygCEEH/AXFBAnRBgApqKAIAQRB0IAMoAhBB/wFxQQJ0QYAKaigCAEEQdnI2AgggAyADKAIQQQh2NgIQIAMgAygCCCADKAIMczYCDCADIAMoAhBB/wFxQQJ0QYAKaigCAEEYdCADKAIQQf8BcUECdEGACmooAgBBCHZyNgIIIAMgAygCEEEIdjYCECADIAMoAgggAygCDHM2AgwgAyADKAIQQQJ0QYAKaigCADYCBCADIAMoAgwgAygCBHM2AhAgAyADKAIgKAIoIAMoAhAgAygCGCADKAIUc3NzNgIMIAMgAygCDEH/AXFBAnRBgApqKAIAQQh0IAMoAgxB/wFxQQJ0QYAKaigCAEEYdnI2AgggAyADKAIMQQh2NgIMIAMgAygCCCADKAIcczYCHCADIAMoAgxB/wFxQQJ0QYAKaigCAEEQdCADKAIMQf8BcUECdEGACmooAgBBEHZyNgIIIAMgAygCDEEIdjYCDCADIAMoAgggAygCHHM2AhwgAyADKAIMQf8BcUECdEGACmooAgBBGHQgAygCDEH/AXFBAnRBgApqKAIAQQh2cjYCCCADIAMoAgxBCHY2AgwgAyADKAIIIAMoAhxzNgIcIAMgAygCDEECdEGACmooAgA2AgQgAyADKAIcIAMoAgRzNgIMIAMgAygCICgCLCADKAIMIAMoAhQgAygCEHNzczYCHCADIAMoAhxB/wFxQQJ0QYAKaigCAEEIdCADKAIcQf8BcUECdEGACmooAgBBGHZyNgIIIAMgAygCHEEIdjYCHCADIAMoAgggAygCGHM2AhggAyADKAIcQf8BcUECdEGACmooAgBBEHQgAygCHEH/AXFBAnRBgApqKAIAQRB2cjYCCCADIAMoAhxBCHY2AhwgAyADKAIIIAMoAhhzNgIYIAMgAygCHEH/AXFBAnRBgApqKAIAQRh0IAMoAhxB/wFxQQJ0QYAKaigCAEEIdnI2AgggAyADKAIcQQh2NgIcIAMgAygCCCADKAIYczYCGCADIAMoAhxBAnRBgApqKAIANgIEIAMgAygCGCADKAIEczYCHCADIAMoAiAoAjAgAygCHCADKAIQIAMoAgxzc3M2AhggAyADKAIYQf8BcUECdEGACmooAgBBCHQgAygCGEH/AXFBAnRBgApqKAIAQRh2cjYCCCADIAMoAhhBCHY2AhggAyADKAIIIAMoAhRzNgIUIAMgAygCGEH/AXFBAnRBgApqKAIAQRB0IAMoAhhB/wFxQQJ0QYAKaigCAEEQdnI2AgggAyADKAIYQQh2NgIYIAMgAygCCCADKAIUczYCFCADIAMoAhhB/wFxQQJ0QYAKaigCAEEYdCADKAIYQf8BcUECdEGACmooAgBBCHZyNgIIIAMgAygCGEEIdjYCGCADIAMoAgggAygCFHM2AhQgAyADKAIYQQJ0QYAKaigCADYCBCADIAMoAhQgAygCBHM2AhggAyADKAIgKAI0IAMoAhggAygCDCADKAIcc3NzNgIUIAMgAygCFEH/AXFBAnRBgApqKAIAQQh0IAMoAhRB/wFxQQJ0QYAKaigCAEEYdnI2AgggAyADKAIUQQh2NgIUIAMgAygCCCADKAIQczYCECADIAMoAhRB/wFxQQJ0QYAKaigCAEEQdCADKAIUQf8BcUECdEGACmooAgBBEHZyNgIIIAMgAygCFEEIdjYCFCADIAMoAgggAygCEHM2AhAgAyADKAIUQf8BcUECdEGACmooAgBBGHQgAygCFEH/AXFBAnRBgApqKAIAQQh2cjYCCCADIAMoAhRBCHY2AhQgAyADKAIIIAMoAhBzNgIQIAMgAygCFEECdEGACmooAgA2AgQgAyADKAIQIAMoAgRzNgIUIAMgAygCICgCOCADKAIUIAMoAhwgAygCGHNzczYCECADIAMoAhBB/wFxQQJ0QYAKaigCAEEIdCADKAIQQf8BcUECdEGACmooAgBBGHZyNgIIIAMgAygCEEEIdjYCECADIAMoAgggAygCDHM2AgwgAyADKAIQQf8BcUECdEGACmooAgBBEHQgAygCEEH/AXFBAnRBgApqKAIAQRB2cjYCCCADIAMoAhBBCHY2AhAgAyADKAIIIAMoAgxzNgIMIAMgAygCEEH/AXFBAnRBgApqKAIAQRh0IAMoAhBB/wFxQQJ0QYAKaigCAEEIdnI2AgggAyADKAIQQQh2NgIQIAMgAygCCCADKAIMczYCDCADIAMoAhBBAnRBgApqKAIANgIEIAMgAygCDCADKAIEczYCECADIAMoAiAoAjwgAygCECADKAIYIAMoAhRzc3M2AgwgAyADKAIMQf8BcUECdEGACmooAgBBCHQgAygCDEH/AXFBAnRBgApqKAIAQRh2cjYCCCADIAMoAgxBCHY2AgwgAyADKAIIIAMoAhxzNgIcIAMgAygCDEH/AXFBAnRBgApqKAIAQRB0IAMoAgxB/wFxQQJ0QYAKaigCAEEQdnI2AgggAyADKAIMQQh2NgIMIAMgAygCCCADKAIcczYCHCADIAMoAgxB/wFxQQJ0QYAKaigCAEEYdCADKAIMQf8BcUECdEGACmooAgBBCHZyNgIIIAMgAygCDEEIdjYCDCADIAMoAgggAygCHHM2AhwgAyADKAIMQQJ0QYAKaigCADYCBCADIAMoAhwgAygCBHM2AgwgAyADKAIgKAJAIAMoAgwgAygCFCADKAIQc3NzNgIcIAMgAygCHEH/AXFBAnRBgApqKAIAQQh0IAMoAhxB/wFxQQJ0QYAKaigCAEEYdnI2AgggAyADKAIcQQh2NgIcIAMgAygCCCADKAIYczYCGCADIAMoAhxB/wFxQQJ0QYAKaigCAEEQdCADKAIcQf8BcUECdEGACmooAgBBEHZyNgIIIAMgAygCHEEIdjYCHCADIAMoAgggAygCGHM2AhggAyADKAIcQf8BcUECdEGACmooAgBBGHQgAygCHEH/AXFBAnRBgApqKAIAQQh2cjYCCCADIAMoAhxBCHY2AhwgAyADKAIIIAMoAhhzNgIYIAMgAygCHEECdEGACmooAgA2AgQgAyADKAIYIAMoAgRzNgIcIAMgAygCICgCRCADKAIcIAMoAhAgAygCDHNzczYCGCADIAMoAhhB/wFxQQJ0QYAKaigCAEEIdCADKAIYQf8BcUECdEGACmooAgBBGHZyNgIIIAMgAygCGEEIdjYCGCADIAMoAgggAygCFHM2AhQgAyADKAIYQf8BcUECdEGACmooAgBBEHQgAygCGEH/AXFBAnRBgApqKAIAQRB2cjYCCCADIAMoAhhBCHY2AhggAyADKAIIIAMoAhRzNgIUIAMgAygCGEH/AXFBAnRBgApqKAIAQRh0IAMoAhhB/wFxQQJ0QYAKaigCAEEIdnI2AgggAyADKAIYQQh2NgIYIAMgAygCCCADKAIUczYCFCADIAMoAhhBAnRBgApqKAIANgIEIAMgAygCFCADKAIEczYCGCADIAMoAiAoAkggAygCGCADKAIMIAMoAhxzc3M2AhQgAyADKAIUQf8BcUECdEGACmooAgBBCHQgAygCFEH/AXFBAnRBgApqKAIAQRh2cjYCCCADIAMoAhRBCHY2AhQgAyADKAIIIAMoAhBzNgIQIAMgAygCFEH/AXFBAnRBgApqKAIAQRB0IAMoAhRB/wFxQQJ0QYAKaigCAEEQdnI2AgggAyADKAIUQQh2NgIUIAMgAygCCCADKAIQczYCECADIAMoAhRB/wFxQQJ0QYAKaigCAEEYdCADKAIUQf8BcUECdEGACmooAgBBCHZyNgIIIAMgAygCFEEIdjYCFCADIAMoAgggAygCEHM2AhAgAyADKAIUQQJ0QYAKaigCADYCBCADIAMoAhAgAygCBHM2AhQgAyADKAIgKAJMIAMoAhQgAygCHCADKAIYc3NzNgIQIAMgAygCEEH/AXFBAnRBgApqKAIAQQh0IAMoAhBB/wFxQQJ0QYAKaigCAEEYdnI2AgggAyADKAIQQQh2NgIQIAMgAygCCCADKAIMczYCDCADIAMoAhBB/wFxQQJ0QYAKaigCAEEQdCADKAIQQf8BcUECdEGACmooAgBBEHZyNgIIIAMgAygCEEEIdjYCECADIAMoAgggAygCDHM2AgwgAyADKAIQQf8BcUECdEGACmooAgBBGHQgAygCEEH/AXFBAnRBgApqKAIAQQh2cjYCCCADIAMoAhBBCHY2AhAgAyADKAIIIAMoAgxzNgIMIAMgAygCEEECdEGACmooAgA2AgQgAyADKAIMIAMoAgRzNgIQIAMgAygCICgCUCADKAIQIAMoAhggAygCFHNzczYCDCADIAMoAgxB/wFxQQJ0QYAKaigCAEEIdCADKAIMQf8BcUECdEGACmooAgBBGHZyNgIIIAMgAygCDEEIdjYCDCADIAMoAgggAygCHHM2AhwgAyADKAIMQf8BcUECdEGACmooAgBBEHQgAygCDEH/AXFBAnRBgApqKAIAQRB2cjYCCCADIAMoAgxBCHY2AgwgAyADKAIIIAMoAhxzNgIcIAMgAygCDEH/AXFBAnRBgApqKAIAQRh0IAMoAgxB/wFxQQJ0QYAKaigCAEEIdnI2AgggAyADKAIMQQh2NgIMIAMgAygCCCADKAIcczYCHCADIAMoAgxBAnRBgApqKAIANgIEIAMgAygCHCADKAIEczYCDCADIAMoAiAoAlQgAygCDCADKAIUIAMoAhBzc3M2AhwgAyADKAIcQf8BcUECdEGACmooAgBBCHQgAygCHEH/AXFBAnRBgApqKAIAQRh2cjYCCCADIAMoAhxBCHY2AhwgAyADKAIIIAMoAhhzNgIYIAMgAygCHEH/AXFBAnRBgApqKAIAQRB0IAMoAhxB/wFxQQJ0QYAKaigCAEEQdnI2AgggAyADKAIcQQh2NgIcIAMgAygCCCADKAIYczYCGCADIAMoAhxB/wFxQQJ0QYAKaigCAEEYdCADKAIcQf8BcUECdEGACmooAgBBCHZyNgIIIAMgAygCHEEIdjYCHCADIAMoAgggAygCGHM2AhggAyADKAIcQQJ0QYAKaigCADYCBCADIAMoAhggAygCBHM2AhwgAyADKAIgKAJYIAMoAhwgAygCECADKAIMc3NzNgIYIAMgAygCGEH/AXFBAnRBgApqKAIAQQh0IAMoAhhB/wFxQQJ0QYAKaigCAEEYdnI2AgggAyADKAIYQQh2NgIYIAMgAygCCCADKAIUczYCFCADIAMoAhhB/wFxQQJ0QYAKaigCAEEQdCADKAIYQf8BcUECdEGACmooAgBBEHZyNgIIIAMgAygCGEEIdjYCGCADIAMoAgggAygCFHM2AhQgAyADKAIYQf8BcUECdEGACmooAgBBGHQgAygCGEH/AXFBAnRBgApqKAIAQQh2cjYCCCADIAMoAhhBCHY2AhggAyADKAIIIAMoAhRzNgIUIAMgAygCGEECdEGACmooAgA2AgQgAyADKAIUIAMoAgRzNgIYIAMgAygCICgCXCADKAIYIAMoAgwgAygCHHNzczYCFCADIAMoAhRB/wFxQQJ0QYAKaigCAEEIdCADKAIUQf8BcUECdEGACmooAgBBGHZyNgIIIAMgAygCFEEIdjYCFCADIAMoAgggAygCEHM2AhAgAyADKAIUQf8BcUECdEGACmooAgBBEHQgAygCFEH/AXFBAnRBgApqKAIAQRB2cjYCCCADIAMoAhRBCHY2AhQgAyADKAIIIAMoAhBzNgIQIAMgAygCFEH/AXFBAnRBgApqKAIAQRh0IAMoAhRB/wFxQQJ0QYAKaigCAEEIdnI2AgggAyADKAIUQQh2NgIUIAMgAygCCCADKAIQczYCECADIAMoAhRBAnRBgApqKAIANgIEIAMgAygCECADKAIEczYCFCADIAMoAiAoAmAgAygCFCADKAIcIAMoAhhzc3M2AhAgAyADKAIQQf8BcUECdEGACmooAgBBCHQgAygCEEH/AXFBAnRBgApqKAIAQRh2cjYCCCADIAMoAhBBCHY2AhAgAyADKAIIIAMoAgxzNgIMIAMgAygCEEH/AXFBAnRBgApqKAIAQRB0IAMoAhBB/wFxQQJ0QYAKaigCAEEQdnI2AgggAyADKAIQQQh2NgIQIAMgAygCCCADKAIMczYCDCADIAMoAhBB/wFxQQJ0QYAKaigCAEEYdCADKAIQQf8BcUECdEGACmooAgBBCHZyNgIIIAMgAygCEEEIdjYCECADIAMoAgggAygCDHM2AgwgAyADKAIQQQJ0QYAKaigCADYCBCADIAMoAgwgAygCBHM2AhAgAyADKAIgKAJkIAMoAhAgAygCGCADKAIUc3NzNgIMIAMgAygCDEH/AXFBAnRBgApqKAIAQQh0IAMoAgxB/wFxQQJ0QYAKaigCAEEYdnI2AgggAyADKAIMQQh2NgIMIAMgAygCCCADKAIcczYCHCADIAMoAgxB/wFxQQJ0QYAKaigCAEEQdCADKAIMQf8BcUECdEGACmooAgBBEHZyNgIIIAMgAygCDEEIdjYCDCADIAMoAgggAygCHHM2AhwgAyADKAIMQf8BcUECdEGACmooAgBBGHQgAygCDEH/AXFBAnRBgApqKAIAQQh2cjYCCCADIAMoAgxBCHY2AgwgAyADKAIIIAMoAhxzNgIcIAMgAygCDEECdEGACmooAgA2AgQgAyADKAIcIAMoAgRzNgIMIAMgAygCICgCaCADKAIMIAMoAhQgAygCEHNzczYCHCADIAMoAhxB/wFxQQJ0QYAKaigCAEEIdCADKAIcQf8BcUECdEGACmooAgBBGHZyNgIIIAMgAygCHEEIdjYCHCADIAMoAgggAygCGHM2AhggAyADKAIcQf8BcUECdEGACmooAgBBEHQgAygCHEH/AXFBAnRBgApqKAIAQRB2cjYCCCADIAMoAhxBCHY2AhwgAyADKAIIIAMoAhhzNgIYIAMgAygCHEH/AXFBAnRBgApqKAIAQRh0IAMoAhxB/wFxQQJ0QYAKaigCAEEIdnI2AgggAyADKAIcQQh2NgIcIAMgAygCCCADKAIYczYCGCADIAMoAhxBAnRBgApqKAIANgIEIAMgAygCGCADKAIEczYCHCADIAMoAiAoAmwgAygCHCADKAIQIAMoAgxzc3M2AhggAyADKAIYQf8BcUECdEGACmooAgBBCHQgAygCGEH/AXFBAnRBgApqKAIAQRh2cjYCCCADIAMoAhhBCHY2AhggAyADKAIIIAMoAhRzNgIUIAMgAygCGEH/AXFBAnRBgApqKAIAQRB0IAMoAhhB/wFxQQJ0QYAKaigCAEEQdnI2AgggAyADKAIYQQh2NgIYIAMgAygCCCADKAIUczYCFCADIAMoAhhB/wFxQQJ0QYAKaigCAEEYdCADKAIYQf8BcUECdEGACmooAgBBCHZyNgIIIAMgAygCGEEIdjYCGCADIAMoAgggAygCFHM2AhQgAyADKAIYQQJ0QYAKaigCADYCBCADIAMoAhQgAygCBHM2AhggAyADKAIgKAJwIAMoAhggAygCDCADKAIcc3NzNgIUIAMgAygCFEH/AXFBAnRBgApqKAIAQQh0IAMoAhRB/wFxQQJ0QYAKaigCAEEYdnI2AgggAyADKAIUQQh2NgIUIAMgAygCCCADKAIQczYCECADIAMoAhRB/wFxQQJ0QYAKaigCAEEQdCADKAIUQf8BcUECdEGACmooAgBBEHZyNgIIIAMgAygCFEEIdjYCFCADIAMoAgggAygCEHM2AhAgAyADKAIUQf8BcUECdEGACmooAgBBGHQgAygCFEH/AXFBAnRBgApqKAIAQQh2cjYCCCADIAMoAhRBCHY2AhQgAyADKAIIIAMoAhBzNgIQIAMgAygCFEECdEGACmooAgA2AgQgAyADKAIQIAMoAgRzNgIUIAMgAygCICgCdCADKAIUIAMoAhwgAygCGHNzczYCECADIAMoAhBB/wFxQQJ0QYAKaigCAEEIdCADKAIQQf8BcUECdEGACmooAgBBGHZyNgIIIAMgAygCEEEIdjYCECADIAMoAgggAygCDHM2AgwgAyADKAIQQf8BcUECdEGACmooAgBBEHQgAygCEEH/AXFBAnRBgApqKAIAQRB2cjYCCCADIAMoAhBBCHY2AhAgAyADKAIIIAMoAgxzNgIMIAMgAygCEEH/AXFBAnRBgApqKAIAQRh0IAMoAhBB/wFxQQJ0QYAKaigCAEEIdnI2AgggAyADKAIQQQh2NgIQIAMgAygCCCADKAIMczYCDCADIAMoAhBBAnRBgApqKAIANgIEIAMgAygCDCADKAIEczYCECADIAMoAiAoAnggAygCECADKAIYIAMoAhRzc3M2AgwgAyADKAIMQf8BcUECdEGACmooAgBBCHQgAygCDEH/AXFBAnRBgApqKAIAQRh2cjYCCCADIAMoAgxBCHY2AgwgAyADKAIIIAMoAhxzNgIcIAMgAygCDEH/AXFBAnRBgApqKAIAQRB0IAMoAgxB/wFxQQJ0QYAKaigCAEEQdnI2AgggAyADKAIMQQh2NgIMIAMgAygCCCADKAIcczYCHCADIAMoAgxB/wFxQQJ0QYAKaigCAEEYdCADKAIMQf8BcUECdEGACmooAgBBCHZyNgIIIAMgAygCDEEIdjYCDCADIAMoAgggAygCHHM2AhwgAyADKAIMQQJ0QYAKaigCADYCBCADIAMoAhwgAygCBHM2AgwgAyADKAIgKAJ8IAMoAgwgAygCFCADKAIQc3NzNgIcIAMgAygCHEH/AXFBAnRBgApqKAIAQQh0IAMoAhxB/wFxQQJ0QYAKaigCAEEYdnI2AgggAyADKAIcQQh2NgIcIAMgAygCCCADKAIYczYCGCADIAMoAhxB/wFxQQJ0QYAKaigCAEEQdCADKAIcQf8BcUECdEGACmooAgBBEHZyNgIIIAMgAygCHEEIdjYCHCADIAMoAgggAygCGHM2AhggAyADKAIcQf8BcUECdEGACmooAgBBGHQgAygCHEH/AXFBAnRBgApqKAIAQQh2cjYCCCADIAMoAhxBCHY2AhwgAyADKAIIIAMoAhhzNgIYIAMgAygCHEECdEGACmooAgA2AgQgAyADKAIYIAMoAgRzNgIcIAMoAiQgAygCHEEYdjoAACADKAIkIAMoAhxBEHY6AAEgAygCJCADKAIcQQh2OgACIAMoAiQgAygCHDoAAyADKAIkIAMoAgxBGHY6AAQgAygCJCADKAIMQRB2OgAFIAMoAiQgAygCDEEIdjoABiADKAIkIAMoAgw6AAcgAygCJCADKAIQQRh2OgAIIAMoAiQgAygCEEEQdjoACSADKAIkIAMoAhBBCHY6AAogAygCJCADKAIQOgALIAMoAiQgAygCFEEYdjoADCADKAIkIAMoAhRBEHY6AA0gAygCJCADKAIUQQh2OgAOIAMoAiQgAygCFDoADwsCAAv8AwECfyACQYAETwRAIAAgASACEAIPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAEEDcUUEQCAAIQIMAQsgAkUEQCAAIQIMAQsgACECA0AgAiABLQAAOgAAIAFBAWohASACQQFqIgJBA3FFDQEgAiADSQ0ACwsCQCADQXxxIgBBwABJDQAgAiAAQUBqIgRLDQADQCACIAEoAgA2AgAgAiABKAIENgIEIAIgASgCCDYCCCACIAEoAgw2AgwgAiABKAIQNgIQIAIgASgCFDYCFCACIAEoAhg2AhggAiABKAIcNgIcIAIgASgCIDYCICACIAEoAiQ2AiQgAiABKAIoNgIoIAIgASgCLDYCLCACIAEoAjA2AjAgAiABKAI0NgI0IAIgASgCODYCOCACIAEoAjw2AjwgAUFAayEBIAJBQGsiAiAETQ0ACwsgACACTQ0BA0AgAiABKAIANgIAIAFBBGohASACQQRqIgIgAEkNAAsMAQsgA0EESQRAIAAhAgwBCyAAIANBBGsiBEsEQCAAIQIMAQsgACECA0AgAiABLQAAOgAAIAIgAS0AAToAASACIAEtAAI6AAIgAiABLQADOgADIAFBBGohASACQQRqIgIgBE0NAAsLIAIgA0kEQANAIAIgAS0AADoAACABQQFqIQEgAkEBaiICIANHDQALCwuPAQEBfyMAQSBrIgQgADYCHCAEIAE2AhggBCACNgIUIAQgAzYCECAEIAQoAhw2AgwgBCAEKAIYNgIIIAQgBCgCFDYCBCAEQQA2AgADQCAEKAIAIgAgBCgCEE9FBEAgACAEKAIMaiAAIAQoAghqLQAAIAAgBCgCBGotAABzOgAAIAQgBCgCAEEBajYCAAwBCwsLkSwBAX8jAEEgayICIAA2AhwgAiABNgIYIAIgAigCHDYCFCACQYASKAIAIAIoAhgiAC0AAEEYdCAALQABQRB0ciAALQACQQh0ciAALQADcnM2AhAgAkGEEigCACACKAIYLQAHIAIoAhgtAARBGHQgAigCGC0ABUEQdHIgAigCGC0ABkEIdHJyczYCDCACQYgSKAIAIAIoAhgtAAsgAigCGC0ACEEYdCACKAIYLQAJQRB0ciACKAIYLQAKQQh0cnJzNgIIIAJBjBIoAgAgAigCGC0ADyACKAIYLQAMQRh0IAIoAhgtAA1BEHRyIAIoAhgtAA5BCHRycnM2AgQgAkGQEigCACACKAIEIAIoAgwgAigCCHNzczYCACACIAIoAgAiAEEYdi0AgAhBGHQgAEEQdkH/AXEtAIAIQRB0cyAAQQh2Qf8BcS0AgAhBCHRzIABB/wFxLQCACHM2AgAgAiACKAIQIAIoAgAgAigCAEENdCACKAIAIgBBE3ZycyACKAIAQRd0IABBCXZyc3M2AgAgAigCFCACKAIANgIAIAJBlBIoAgAgAigCACACKAIIIAIoAgRzc3M2AhAgAiACKAIQQf8BcS0AgAggAigCEEEYdi0AgAhBGHQgAigCEEEQdkH/AXEtAIAIQRB0cyACKAIQQQh2Qf8BcS0AgAhBCHRzczYCECACIAIoAgwgAigCECACKAIQQQ10IAIoAhAiAEETdnJzIAIoAhBBF3QgAEEJdnJzczYCECACKAIUIAIoAhA2AgQgAkGYEigCACACKAIQIAIoAgQgAigCAHNzczYCDCACIAIoAgxB/wFxLQCACCACKAIMQRh2LQCACEEYdCACKAIMQRB2Qf8BcS0AgAhBEHRzIAIoAgxBCHZB/wFxLQCACEEIdHNzNgIMIAIgAigCCCACKAIMIAIoAgxBDXQgAigCDCIAQRN2cnMgAigCDEEXdCAAQQl2cnNzNgIMIAIoAhQgAigCDDYCCCACQZwSKAIAIAIoAgwgAigCACACKAIQc3NzNgIIIAIgAigCCEH/AXEtAIAIIAIoAghBGHYtAIAIQRh0IAIoAghBEHZB/wFxLQCACEEQdHMgAigCCEEIdkH/AXEtAIAIQQh0c3M2AgggAiACKAIEIAIoAgggAigCCEENdCACKAIIIgBBE3ZycyACKAIIQRd0IABBCXZyc3M2AgggAigCFCACKAIINgIMIAJBoBIoAgAgAigCCCACKAIQIAIoAgxzc3M2AgQgAiACKAIEQf8BcS0AgAggAigCBEEYdi0AgAhBGHQgAigCBEEQdkH/AXEtAIAIQRB0cyACKAIEQQh2Qf8BcS0AgAhBCHRzczYCBCACIAIoAgAgAigCBCACKAIEQQ10IAIoAgQiAEETdnJzIAIoAgRBF3QgAEEJdnJzczYCBCACKAIUIAIoAgQ2AhAgAkGkEigCACACKAIEIAIoAgwgAigCCHNzczYCACACIAIoAgBB/wFxLQCACCACKAIAQRh2LQCACEEYdCACKAIAQRB2Qf8BcS0AgAhBEHRzIAIoAgBBCHZB/wFxLQCACEEIdHNzNgIAIAIgAigCECACKAIAQRd0IAIoAgBBCXZyIAIoAgAgAigCAEENdCACKAIAQRN2cnNzczYCACACKAIUIAIoAgA2AhQgAkGoEigCACACKAIAIAIoAgggAigCBHNzczYCECACIAIoAhBB/wFxLQCACCACKAIQQRh2LQCACEEYdCACKAIQQRB2Qf8BcS0AgAhBEHRzIAIoAhBBCHZB/wFxLQCACEEIdHNzNgIQIAIgAigCDCACKAIQQRd0IAIoAhBBCXZyIAIoAhAgAigCEEENdCACKAIQQRN2cnNzczYCECACKAIUIAIoAhA2AhggAkGsEigCACACKAIQIAIoAgQgAigCAHNzczYCDCACIAIoAgxB/wFxLQCACCACKAIMQRh2LQCACEEYdCACKAIMQRB2Qf8BcS0AgAhBEHRzIAIoAgxBCHZB/wFxLQCACEEIdHNzNgIMIAIgAigCCCACKAIMQRd0IAIoAgxBCXZyIAIoAgwgAigCDEENdCACKAIMQRN2cnNzczYCDCACKAIUIAIoAgw2AhwgAkGwEigCACACKAIMIAIoAgAgAigCEHNzczYCCCACIAIoAghB/wFxLQCACCACKAIIQRh2LQCACEEYdCACKAIIQRB2Qf8BcS0AgAhBEHRzIAIoAghBCHZB/wFxLQCACEEIdHNzNgIIIAIgAigCBCACKAIIQRd0IAIoAghBCXZyIAIoAgggAigCCEENdCACKAIIQRN2cnNzczYCCCACKAIUIAIoAgg2AiAgAkG0EigCACACKAIIIAIoAhAgAigCDHNzczYCBCACIAIoAgRB/wFxLQCACCACKAIEQRh2LQCACEEYdCACKAIEQRB2Qf8BcS0AgAhBEHRzIAIoAgRBCHZB/wFxLQCACEEIdHNzNgIEIAIgAigCACACKAIEQRd0IAIoAgRBCXZyIAIoAgQgAigCBEENdCACKAIEQRN2cnNzczYCBCACKAIUIAIoAgQ2AiQgAkG4EigCACACKAIEIAIoAgwgAigCCHNzczYCACACIAIoAgBB/wFxLQCACCACKAIAQRh2LQCACEEYdCACKAIAQRB2Qf8BcS0AgAhBEHRzIAIoAgBBCHZB/wFxLQCACEEIdHNzNgIAIAIgAigCECACKAIAQRd0IAIoAgBBCXZyIAIoAgAgAigCAEENdCACKAIAQRN2cnNzczYCACACKAIUIAIoAgA2AiggAkG8EigCACACKAIAIAIoAgggAigCBHNzczYCECACIAIoAhBB/wFxLQCACCACKAIQQRh2LQCACEEYdCACKAIQQRB2Qf8BcS0AgAhBEHRzIAIoAhBBCHZB/wFxLQCACEEIdHNzNgIQIAIgAigCDCACKAIQQRd0IAIoAhBBCXZyIAIoAhAgAigCEEENdCACKAIQQRN2cnNzczYCECACKAIUIAIoAhA2AiwgAkHAEigCACACKAIQIAIoAgQgAigCAHNzczYCDCACIAIoAgxB/wFxLQCACCACKAIMQRh2LQCACEEYdCACKAIMQRB2Qf8BcS0AgAhBEHRzIAIoAgxBCHZB/wFxLQCACEEIdHNzNgIMIAIgAigCCCACKAIMQRd0IAIoAgxBCXZyIAIoAgwgAigCDEENdCACKAIMQRN2cnNzczYCDCACKAIUIAIoAgw2AjAgAkHEEigCACACKAIMIAIoAgAgAigCEHNzczYCCCACIAIoAghB/wFxLQCACCACKAIIQRh2LQCACEEYdCACKAIIQRB2Qf8BcS0AgAhBEHRzIAIoAghBCHZB/wFxLQCACEEIdHNzNgIIIAIgAigCBCACKAIIQRd0IAIoAghBCXZyIAIoAgggAigCCEENdCACKAIIQRN2cnNzczYCCCACKAIUIAIoAgg2AjQgAkHIEigCACACKAIIIAIoAhAgAigCDHNzczYCBCACIAIoAgRB/wFxLQCACCACKAIEQRh2LQCACEEYdCACKAIEQRB2Qf8BcS0AgAhBEHRzIAIoAgRBCHZB/wFxLQCACEEIdHNzNgIEIAIgAigCACACKAIEQRd0IAIoAgRBCXZyIAIoAgQgAigCBEENdCACKAIEQRN2cnNzczYCBCACKAIUIAIoAgQ2AjggAkHMEigCACACKAIEIAIoAgwgAigCCHNzczYCACACIAIoAgBB/wFxLQCACCACKAIAQRh2LQCACEEYdCACKAIAQRB2Qf8BcS0AgAhBEHRzIAIoAgBBCHZB/wFxLQCACEEIdHNzNgIAIAIgAigCECACKAIAQRd0IAIoAgBBCXZyIAIoAgAgAigCAEENdCACKAIAQRN2cnNzczYCACACKAIUIAIoAgA2AjwgAkHQEigCACACKAIAIAIoAgggAigCBHNzczYCECACIAIoAhBB/wFxLQCACCACKAIQQRh2LQCACEEYdCACKAIQQRB2Qf8BcS0AgAhBEHRzIAIoAhBBCHZB/wFxLQCACEEIdHNzNgIQIAIgAigCDCACKAIQQRd0IAIoAhBBCXZyIAIoAhAgAigCEEENdCACKAIQQRN2cnNzczYCECACKAIUIAIoAhA2AkAgAkHUEigCACACKAIQIAIoAgQgAigCAHNzczYCDCACIAIoAgxB/wFxLQCACCACKAIMQRh2LQCACEEYdCACKAIMQRB2Qf8BcS0AgAhBEHRzIAIoAgxBCHZB/wFxLQCACEEIdHNzNgIMIAIgAigCCCACKAIMQRd0IAIoAgxBCXZyIAIoAgwgAigCDEENdCACKAIMQRN2cnNzczYCDCACKAIUIAIoAgw2AkQgAkHYEigCACACKAIMIAIoAgAgAigCEHNzczYCCCACIAIoAghB/wFxLQCACCACKAIIQRh2LQCACEEYdCACKAIIQRB2Qf8BcS0AgAhBEHRzIAIoAghBCHZB/wFxLQCACEEIdHNzNgIIIAIgAigCBCACKAIIQRd0IAIoAghBCXZyIAIoAgggAigCCEENdCACKAIIQRN2cnNzczYCCCACKAIUIAIoAgg2AkggAkHcEigCACACKAIIIAIoAhAgAigCDHNzczYCBCACIAIoAgRB/wFxLQCACCACKAIEQRh2LQCACEEYdCACKAIEQRB2Qf8BcS0AgAhBEHRzIAIoAgRBCHZB/wFxLQCACEEIdHNzNgIEIAIgAigCACACKAIEQRd0IAIoAgRBCXZyIAIoAgQgAigCBEENdCACKAIEQRN2cnNzczYCBCACKAIUIAIoAgQ2AkwgAkHgEigCACACKAIEIAIoAgwgAigCCHNzczYCACACIAIoAgBB/wFxLQCACCACKAIAQRh2LQCACEEYdCACKAIAQRB2Qf8BcS0AgAhBEHRzIAIoAgBBCHZB/wFxLQCACEEIdHNzNgIAIAIgAigCECACKAIAQRd0IAIoAgBBCXZyIAIoAgAgAigCAEENdCACKAIAQRN2cnNzczYCACACKAIUIAIoAgA2AlAgAkHkEigCACACKAIAIAIoAgggAigCBHNzczYCECACIAIoAhBB/wFxLQCACCACKAIQQRh2LQCACEEYdCACKAIQQRB2Qf8BcS0AgAhBEHRzIAIoAhBBCHZB/wFxLQCACEEIdHNzNgIQIAIgAigCDCACKAIQQRd0IAIoAhBBCXZyIAIoAhAgAigCEEENdCACKAIQQRN2cnNzczYCECACKAIUIAIoAhA2AlQgAkHoEigCACACKAIQIAIoAgQgAigCAHNzczYCDCACIAIoAgxB/wFxLQCACCACKAIMQRh2LQCACEEYdCACKAIMQRB2Qf8BcS0AgAhBEHRzIAIoAgxBCHZB/wFxLQCACEEIdHNzNgIMIAIgAigCCCACKAIMQRd0IAIoAgxBCXZyIAIoAgwgAigCDEENdCACKAIMQRN2cnNzczYCDCACKAIUIAIoAgw2AlggAkHsEigCACACKAIMIAIoAgAgAigCEHNzczYCCCACIAIoAghB/wFxLQCACCACKAIIQRh2LQCACEEYdCACKAIIQRB2Qf8BcS0AgAhBEHRzIAIoAghBCHZB/wFxLQCACEEIdHNzNgIIIAIgAigCBCACKAIIQRd0IAIoAghBCXZyIAIoAgggAigCCEENdCACKAIIQRN2cnNzczYCCCACKAIUIAIoAgg2AlwgAkHwEigCACACKAIIIAIoAhAgAigCDHNzczYCBCACIAIoAgRB/wFxLQCACCACKAIEQRh2LQCACEEYdCACKAIEQRB2Qf8BcS0AgAhBEHRzIAIoAgRBCHZB/wFxLQCACEEIdHNzNgIEIAIgAigCACACKAIEQRd0IAIoAgRBCXZyIAIoAgQgAigCBEENdCACKAIEQRN2cnNzczYCBCACKAIUIAIoAgQ2AmAgAkH0EigCACACKAIEIAIoAgwgAigCCHNzczYCACACIAIoAgBB/wFxLQCACCACKAIAQRh2LQCACEEYdCACKAIAQRB2Qf8BcS0AgAhBEHRzIAIoAgBBCHZB/wFxLQCACEEIdHNzNgIAIAIgAigCECACKAIAQRd0IAIoAgBBCXZyIAIoAgAgAigCAEENdCACKAIAQRN2cnNzczYCACACKAIUIAIoAgA2AmQgAkH4EigCACACKAIAIAIoAgggAigCBHNzczYCECACIAIoAhBB/wFxLQCACCACKAIQQRh2LQCACEEYdCACKAIQQRB2Qf8BcS0AgAhBEHRzIAIoAhBBCHZB/wFxLQCACEEIdHNzNgIQIAIgAigCDCACKAIQQRd0IAIoAhBBCXZyIAIoAhAgAigCEEENdCACKAIQQRN2cnNzczYCECACKAIUIAIoAhA2AmggAkH8EigCACACKAIQIAIoAgQgAigCAHNzczYCDCACIAIoAgxB/wFxLQCACCACKAIMQRh2LQCACEEYdCACKAIMQRB2Qf8BcS0AgAhBEHRzIAIoAgxBCHZB/wFxLQCACEEIdHNzNgIMIAIgAigCCCACKAIMQRd0IAIoAgxBCXZyIAIoAgwgAigCDEENdCACKAIMQRN2cnNzczYCDCACKAIUIAIoAgw2AmwgAkGAEygCACACKAIMIAIoAgAgAigCEHNzczYCCCACIAIoAghB/wFxLQCACCACKAIIQRh2LQCACEEYdCACKAIIQRB2Qf8BcS0AgAhBEHRzIAIoAghBCHZB/wFxLQCACEEIdHNzNgIIIAIgAigCBCACKAIIQRd0IAIoAghBCXZyIAIoAgggAigCCEENdCACKAIIQRN2cnNzczYCCCACKAIUIAIoAgg2AnAgAkGEEygCACACKAIIIAIoAhAgAigCDHNzczYCBCACIAIoAgRB/wFxLQCACCACKAIEQRh2LQCACEEYdCACKAIEQRB2Qf8BcS0AgAhBEHRzIAIoAgRBCHZB/wFxLQCACEEIdHNzNgIEIAIgAigCACACKAIEQRd0IAIoAgRBCXZyIAIoAgQgAigCBEENdCACKAIEQRN2cnNzczYCBCACKAIUIAIoAgQ2AnQgAkGIEygCACACKAIEIAIoAgwgAigCCHNzczYCACACIAIoAgBB/wFxLQCACCACKAIAQRh2LQCACEEYdCACKAIAQRB2Qf8BcS0AgAhBEHRzIAIoAgBBCHZB/wFxLQCACEEIdHNzNgIAIAIgAigCECACKAIAQRd0IAIoAgBBCXZyIAIoAgAgAigCAEENdCACKAIAQRN2cnNzczYCACACKAIUIAIoAgA2AnggAkGMEygCACACKAIAIAIoAgggAigCBHNzczYCECACIAIoAhBB/wFxLQCACCACKAIQQRh2LQCACEEYdCACKAIQQRB2Qf8BcS0AgAhBEHRzIAIoAhBBCHZB/wFxLQCACEEIdHNzNgIQIAIgAigCDCACKAIQQRd0IAIoAhBBCXZyIAIoAhAgAigCEEENdCACKAIQQRN2cnNzczYCECACKAIUIAIoAhA2AnwgAkEANgIAIAJBADYCBCACQQA2AgggAkEANgIMIAJBADYCEAuHAgEBfyMAQUBqIgUkACAFIAA2AjwgBSABNgI4IAUgAjYCNCAFIAM2AjAgBSAENgIsA0AgBSgCMCIABEAgBUEQIAAgAEEQTxs2AgwgBSgCPCAFKAI4IAVBEGoiABAGIAUoAiwgBSgCNCAAIAUoAgwQCSMAQRBrIgAgBSgCODYCDCAAQQ82AggDQAJAIAAoAggiAUEASA0AIAEgACgCDGoiASABLQAAQQFqOgAAIAAoAgwgACgCCGotAAANACAAIAAoAghBAWs2AggMAQsLIAUgBSgCDCAFKAI0ajYCNCAFIAUoAgwgBSgCLGo2AiwgBSAFKAIwIAUoAgxrNgIwDAELCyAFQUBrJAALxicBDH8jAEEQayIKJAACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAIABB9AFNBEBBmBMoAgAiBkEQIABBC2pBeHEgAEELSRsiBUEDdiIAdiIBQQNxBEACQCABQX9zQQFxIABqIgJBA3QiAUHAE2oiACABQcgTaigCACIBKAIIIgRGBEBBmBMgBkF+IAJ3cTYCAAwBCyAEIAA2AgwgACAENgIICyABQQhqIQAgASACQQN0IgJBA3I2AgQgASACaiIBIAEoAgRBAXI2AgQMDwsgBUGgEygCACIHTQ0BIAEEQAJAQQIgAHQiAkEAIAJrciABIAB0cWgiAUEDdCIAQcATaiICIABByBNqKAIAIgAoAggiBEYEQEGYEyAGQX4gAXdxIgY2AgAMAQsgBCACNgIMIAIgBDYCCAsgACAFQQNyNgIEIAAgBWoiCCABQQN0IgEgBWsiBEEBcjYCBCAAIAFqIAQ2AgAgBwRAIAdBeHFBwBNqIQFBrBMoAgAhAgJ/IAZBASAHQQN2dCIDcUUEQEGYEyADIAZyNgIAIAEMAQsgASgCCAshAyABIAI2AgggAyACNgIMIAIgATYCDCACIAM2AggLIABBCGohAEGsEyAINgIAQaATIAQ2AgAMDwtBnBMoAgAiC0UNASALaEECdEHIFWooAgAiAigCBEF4cSAFayEDIAIhAQNAAkAgASgCECIARQRAIAEoAhQiAEUNAQsgACgCBEF4cSAFayIBIAMgASADSSIBGyEDIAAgAiABGyECIAAhAQwBCwsgAigCGCEJIAIgAigCDCIERwRAQagTKAIAGiACKAIIIgAgBDYCDCAEIAA2AggMDgsgAkEUaiIBKAIAIgBFBEAgAigCECIARQ0DIAJBEGohAQsDQCABIQggACIEQRRqIgEoAgAiAA0AIARBEGohASAEKAIQIgANAAsgCEEANgIADA0LQX8hBSAAQb9/Sw0AIABBC2oiAEF4cSEFQZwTKAIAIghFDQBBACAFayEDAkACQAJAAn9BACAFQYACSQ0AGkEfIAVB////B0sNABogBUEmIABBCHZnIgBrdkEBcSAAQQF0a0E+agsiB0ECdEHIFWooAgAiAUUEQEEAIQAMAQtBACEAIAVBGSAHQQF2a0EAIAdBH0cbdCECA0ACQCABKAIEQXhxIAVrIgYgA08NACABIQQgBiIDDQBBACEDIAEhAAwDCyAAIAEoAhQiBiAGIAEgAkEddkEEcWooAhAiAUYbIAAgBhshACACQQF0IQIgAQ0ACwsgACAEckUEQEEAIQRBAiAHdCIAQQAgAGtyIAhxIgBFDQMgAGhBAnRByBVqKAIAIQALIABFDQELA0AgACgCBEF4cSAFayICIANJIQEgAiADIAEbIQMgACAEIAEbIQQgACgCECIBBH8gAQUgACgCFAsiAA0ACwsgBEUNACADQaATKAIAIAVrTw0AIAQoAhghByAEIAQoAgwiAkcEQEGoEygCABogBCgCCCIAIAI2AgwgAiAANgIIDAwLIARBFGoiASgCACIARQRAIAQoAhAiAEUNAyAEQRBqIQELA0AgASEGIAAiAkEUaiIBKAIAIgANACACQRBqIQEgAigCECIADQALIAZBADYCAAwLCyAFQaATKAIAIgRNBEBBrBMoAgAhAAJAIAQgBWsiAUEQTwRAIAAgBWoiAiABQQFyNgIEIAAgBGogATYCACAAIAVBA3I2AgQMAQsgACAEQQNyNgIEIAAgBGoiASABKAIEQQFyNgIEQQAhAkEAIQELQaATIAE2AgBBrBMgAjYCACAAQQhqIQAMDQsgBUGkEygCACICSQRAQaQTIAIgBWsiATYCAEGwE0GwEygCACIAIAVqIgI2AgAgAiABQQFyNgIEIAAgBUEDcjYCBCAAQQhqIQAMDQtBACEAIAVBL2oiAwJ/QfAWKAIABEBB+BYoAgAMAQtB/BZCfzcCAEH0FkKAoICAgIAENwIAQfAWIApBDGpBcHFB2KrVqgVzNgIAQYQXQQA2AgBB1BZBADYCAEGAIAsiAWoiBkEAIAFrIghxIgEgBU0NDEHQFigCACIEBEBByBYoAgAiByABaiIJIAdNDQ0gBCAJSQ0NCwJAQdQWLQAAQQRxRQRAAkACQAJAAkBBsBMoAgAiBARAQdgWIQADQCAEIAAoAgAiB08EQCAHIAAoAgRqIARLDQMLIAAoAggiAA0ACwtBABAEIgJBf0YNAyABIQZB9BYoAgAiAEEBayIEIAJxBEAgASACayACIARqQQAgAGtxaiEGCyAFIAZPDQNB0BYoAgAiAARAQcgWKAIAIgQgBmoiCCAETQ0EIAAgCEkNBAsgBhAEIgAgAkcNAQwFCyAGIAJrIAhxIgYQBCICIAAoAgAgACgCBGpGDQEgAiEACyAAQX9GDQEgBUEwaiAGTQRAIAAhAgwEC0H4FigCACICIAMgBmtqQQAgAmtxIgIQBEF/Rg0BIAIgBmohBiAAIQIMAwsgAkF/Rw0CC0HUFkHUFigCAEEEcjYCAAsgARAEIQJBABAEIQAgAkF/Rg0FIABBf0YNBSAAIAJNDQUgACACayIGIAVBKGpNDQULQcgWQcgWKAIAIAZqIgA2AgBBzBYoAgAgAEkEQEHMFiAANgIACwJAQbATKAIAIgMEQEHYFiEAA0AgAiAAKAIAIgEgACgCBCIEakYNAiAAKAIIIgANAAsMBAtBqBMoAgAiAEEAIAAgAk0bRQRAQagTIAI2AgALQQAhAEHcFiAGNgIAQdgWIAI2AgBBuBNBfzYCAEG8E0HwFigCADYCAEHkFkEANgIAA0AgAEEDdCIBQcgTaiABQcATaiIENgIAIAFBzBNqIAQ2AgAgAEEBaiIAQSBHDQALQaQTIAZBKGsiAEF4IAJrQQdxIgFrIgQ2AgBBsBMgASACaiIBNgIAIAEgBEEBcjYCBCAAIAJqQSg2AgRBtBNBgBcoAgA2AgAMBAsgAiADTQ0CIAEgA0sNAiAAKAIMQQhxDQIgACAEIAZqNgIEQbATIANBeCADa0EHcSIAaiIBNgIAQaQTQaQTKAIAIAZqIgIgAGsiADYCACABIABBAXI2AgQgAiADakEoNgIEQbQTQYAXKAIANgIADAMLQQAhBAwKC0EAIQIMCAtBqBMoAgAgAksEQEGoEyACNgIACyACIAZqIQFB2BYhAAJAAkACQANAIAEgACgCAEcEQCAAKAIIIgANAQwCCwsgAC0ADEEIcUUNAQtB2BYhAANAIAMgACgCACIBTwRAIAEgACgCBGoiBCADSw0DCyAAKAIIIQAMAAsACyAAIAI2AgAgACAAKAIEIAZqNgIEIAJBeCACa0EHcWoiByAFQQNyNgIEIAFBeCABa0EHcWoiBiAFIAdqIgVrIQAgAyAGRgRAQbATIAU2AgBBpBNBpBMoAgAgAGoiADYCACAFIABBAXI2AgQMCAtBrBMoAgAgBkYEQEGsEyAFNgIAQaATQaATKAIAIABqIgA2AgAgBSAAQQFyNgIEIAAgBWogADYCAAwICyAGKAIEIgNBA3FBAUcNBiADQXhxIQkgA0H/AU0EQCAGKAIMIgEgBigCCCICRgRAQZgTQZgTKAIAQX4gA0EDdndxNgIADAcLIAIgATYCDCABIAI2AggMBgsgBigCGCEIIAYgBigCDCICRwRAIAYoAggiASACNgIMIAIgATYCCAwFCyAGQRRqIgEoAgAiA0UEQCAGKAIQIgNFDQQgBkEQaiEBCwNAIAEhBCADIgJBFGoiASgCACIDDQAgAkEQaiEBIAIoAhAiAw0ACyAEQQA2AgAMBAtBpBMgBkEoayIAQXggAmtBB3EiAWsiCDYCAEGwEyABIAJqIgE2AgAgASAIQQFyNgIEIAAgAmpBKDYCBEG0E0GAFygCADYCACADIARBJyAEa0EHcWpBL2siACAAIANBEGpJGyIBQRs2AgQgAUHgFikCADcCECABQdgWKQIANwIIQeAWIAFBCGo2AgBB3BYgBjYCAEHYFiACNgIAQeQWQQA2AgAgAUEYaiEAA0AgAEEHNgIEIABBCGohDCAAQQRqIQAgDCAESQ0ACyABIANGDQAgASABKAIEQX5xNgIEIAMgASADayICQQFyNgIEIAEgAjYCACACQf8BTQRAIAJBeHFBwBNqIQACf0GYEygCACIBQQEgAkEDdnQiAnFFBEBBmBMgASACcjYCACAADAELIAAoAggLIQEgACADNgIIIAEgAzYCDCADIAA2AgwgAyABNgIIDAELQR8hACACQf///wdNBEAgAkEmIAJBCHZnIgBrdkEBcSAAQQF0a0E+aiEACyADIAA2AhwgA0IANwIQIABBAnRByBVqIQECQAJAQZwTKAIAIgRBASAAdCIGcUUEQEGcEyAEIAZyNgIAIAEgAzYCAAwBCyACQRkgAEEBdmtBACAAQR9HG3QhACABKAIAIQQDQCAEIgEoAgRBeHEgAkYNAiAAQR12IQQgAEEBdCEAIAEgBEEEcWoiBigCECIEDQALIAYgAzYCEAsgAyABNgIYIAMgAzYCDCADIAM2AggMAQsgASgCCCIAIAM2AgwgASADNgIIIANBADYCGCADIAE2AgwgAyAANgIIC0GkEygCACIAIAVNDQBBpBMgACAFayIBNgIAQbATQbATKAIAIgAgBWoiAjYCACACIAFBAXI2AgQgACAFQQNyNgIEIABBCGohAAwIC0GUE0EwNgIAQQAhAAwHC0EAIQILIAhFDQACQCAGKAIcIgFBAnRByBVqIgQoAgAgBkYEQCAEIAI2AgAgAg0BQZwTQZwTKAIAQX4gAXdxNgIADAILIAhBEEEUIAgoAhAgBkYbaiACNgIAIAJFDQELIAIgCDYCGCAGKAIQIgEEQCACIAE2AhAgASACNgIYCyAGKAIUIgFFDQAgAiABNgIUIAEgAjYCGAsgACAJaiEAIAYgCWoiBigCBCEDCyAGIANBfnE2AgQgBSAAQQFyNgIEIAAgBWogADYCACAAQf8BTQRAIABBeHFBwBNqIQECf0GYEygCACICQQEgAEEDdnQiAHFFBEBBmBMgACACcjYCACABDAELIAEoAggLIQAgASAFNgIIIAAgBTYCDCAFIAE2AgwgBSAANgIIDAELQR8hAyAAQf///wdNBEAgAEEmIABBCHZnIgFrdkEBcSABQQF0a0E+aiEDCyAFIAM2AhwgBUIANwIQIANBAnRByBVqIQECQAJAQZwTKAIAIgJBASADdCIEcUUEQEGcEyACIARyNgIAIAEgBTYCAAwBCyAAQRkgA0EBdmtBACADQR9HG3QhAyABKAIAIQIDQCACIgEoAgRBeHEgAEYNAiADQR12IQIgA0EBdCEDIAEgAkEEcWoiBCgCECICDQALIAQgBTYCEAsgBSABNgIYIAUgBTYCDCAFIAU2AggMAQsgASgCCCIAIAU2AgwgASAFNgIIIAVBADYCGCAFIAE2AgwgBSAANgIICyAHQQhqIQAMAgsCQCAHRQ0AAkAgBCgCHCIAQQJ0QcgVaiIBKAIAIARGBEAgASACNgIAIAINAUGcEyAIQX4gAHdxIgg2AgAMAgsgB0EQQRQgBygCECAERhtqIAI2AgAgAkUNAQsgAiAHNgIYIAQoAhAiAARAIAIgADYCECAAIAI2AhgLIAQoAhQiAEUNACACIAA2AhQgACACNgIYCwJAIANBD00EQCAEIAMgBWoiAEEDcjYCBCAAIARqIgAgACgCBEEBcjYCBAwBCyAEIAVBA3I2AgQgBCAFaiICIANBAXI2AgQgAiADaiADNgIAIANB/wFNBEAgA0F4cUHAE2ohAAJ/QZgTKAIAIgFBASADQQN2dCIDcUUEQEGYEyABIANyNgIAIAAMAQsgACgCCAshASAAIAI2AgggASACNgIMIAIgADYCDCACIAE2AggMAQtBHyEAIANB////B00EQCADQSYgA0EIdmciAGt2QQFxIABBAXRrQT5qIQALIAIgADYCHCACQgA3AhAgAEECdEHIFWohAQJAAkAgCEEBIAB0IgZxRQRAQZwTIAYgCHI2AgAgASACNgIADAELIANBGSAAQQF2a0EAIABBH0cbdCEAIAEoAgAhBQNAIAUiASgCBEF4cSADRg0CIABBHXYhBiAAQQF0IQAgASAGQQRxaiIGKAIQIgUNAAsgBiACNgIQCyACIAE2AhggAiACNgIMIAIgAjYCCAwBCyABKAIIIgAgAjYCDCABIAI2AgggAkEANgIYIAIgATYCDCACIAA2AggLIARBCGohAAwBCwJAIAlFDQACQCACKAIcIgBBAnRByBVqIgEoAgAgAkYEQCABIAQ2AgAgBA0BQZwTIAtBfiAAd3E2AgAMAgsgCUEQQRQgCSgCECACRhtqIAQ2AgAgBEUNAQsgBCAJNgIYIAIoAhAiAARAIAQgADYCECAAIAQ2AhgLIAIoAhQiAEUNACAEIAA2AhQgACAENgIYCwJAIANBD00EQCACIAMgBWoiAEEDcjYCBCAAIAJqIgAgACgCBEEBcjYCBAwBCyACIAVBA3I2AgQgAiAFaiIEIANBAXI2AgQgAyAEaiADNgIAIAcEQCAHQXhxQcATaiEAQawTKAIAIQECf0EBIAdBA3Z0IgUgBnFFBEBBmBMgBSAGcjYCACAADAELIAAoAggLIQYgACABNgIIIAYgATYCDCABIAA2AgwgASAGNgIIC0GsEyAENgIAQaATIAM2AgALIAJBCGohAAsgCkEQaiQAIAALNwEBfyAABEAgACgCBCIBBEAgARADIABBADYCBAsgACgCCCIBBEAgARADIABBADYCCAsLIAAQAwu7LwEGfyMAQZABayIFJAACQCABRQ0AIAJFDQAgAhAFIQYCQAJAAkACQAJAIAAoAgBBAWsOAgIAAQsgBUEQaiIDIAAoAgQQCiAFIAAoAggiACkAADcDACAFIAApAAg3AwggAyAFIAEgAiAGEAsMAgsgBhADQX8hAgwCCyAAKAIEIQQjAEEgayIIIgMgBUEQaiIHNgIcIAMgBDYCGCADIAMoAhw2AhQgA0GAEigCACADKAIYIgQtAABBGHQgBC0AAUEQdHIgBC0AAkEIdHIgBC0AA3JzNgIQIANBhBIoAgAgAygCGC0AByADKAIYLQAEQRh0IAMoAhgtAAVBEHRyIAMoAhgtAAZBCHRycnM2AgwgA0GIEigCACADKAIYLQALIAMoAhgtAAhBGHQgAygCGC0ACUEQdHIgAygCGC0ACkEIdHJyczYCCCADQYwSKAIAIAMoAhgtAA8gAygCGC0ADEEYdCADKAIYLQANQRB0ciADKAIYLQAOQQh0cnJzNgIEIANBkBIoAgAgAygCBCADKAIMIAMoAghzc3M2AgAgAyADKAIAIgRBGHYtAIAIQRh0IARBEHZB/wFxLQCACEEQdHMgBEEIdkH/AXEtAIAIQQh0cyAEQf8BcS0AgAhzNgIAIAMgAygCECADKAIAIAMoAgBBDXQgAygCACIEQRN2cnMgAygCAEEXdCAEQQl2cnNzNgIAIAMoAhQgAygCADYCfCADQZQSKAIAIAMoAgAgAygCCCADKAIEc3NzNgIQIAMgAygCEEH/AXEtAIAIIAMoAhBBGHYtAIAIQRh0IAMoAhBBEHZB/wFxLQCACEEQdHMgAygCEEEIdkH/AXEtAIAIQQh0c3M2AhAgAyADKAIMIAMoAhAgAygCEEENdCADKAIQIgRBE3ZycyADKAIQQRd0IARBCXZyc3M2AhAgAygCFCADKAIQNgJ4IANBmBIoAgAgAygCECADKAIEIAMoAgBzc3M2AgwgAyADKAIMQf8BcS0AgAggAygCDEEYdi0AgAhBGHQgAygCDEEQdkH/AXEtAIAIQRB0cyADKAIMQQh2Qf8BcS0AgAhBCHRzczYCDCADIAMoAgggAygCDCADKAIMQQ10IAMoAgwiBEETdnJzIAMoAgxBF3QgBEEJdnJzczYCDCADKAIUIAMoAgw2AnQgA0GcEigCACADKAIMIAMoAgAgAygCEHNzczYCCCADIAMoAghB/wFxLQCACCADKAIIQRh2LQCACEEYdCADKAIIQRB2Qf8BcS0AgAhBEHRzIAMoAghBCHZB/wFxLQCACEEIdHNzNgIIIAMgAygCBCADKAIIIAMoAghBDXQgAygCCCIEQRN2cnMgAygCCEEXdCAEQQl2cnNzNgIIIAMoAhQgAygCCDYCcCADQaASKAIAIAMoAgggAygCECADKAIMc3NzNgIEIAMgAygCBEH/AXEtAIAIIAMoAgRBGHYtAIAIQRh0IAMoAgRBEHZB/wFxLQCACEEQdHMgAygCBEEIdkH/AXEtAIAIQQh0c3M2AgQgAyADKAIAIAMoAgQgAygCBEENdCADKAIEIgRBE3ZycyADKAIEQRd0IARBCXZyc3M2AgQgAygCFCADKAIENgJsIANBpBIoAgAgAygCBCADKAIMIAMoAghzc3M2AgAgAyADKAIAQf8BcS0AgAggAygCAEEYdi0AgAhBGHQgAygCAEEQdkH/AXEtAIAIQRB0cyADKAIAQQh2Qf8BcS0AgAhBCHRzczYCACADIAMoAhAgAygCAEEXdCADKAIAQQl2ciADKAIAIAMoAgBBDXQgAygCAEETdnJzc3M2AgAgAygCFCADKAIANgJoIANBqBIoAgAgAygCACADKAIIIAMoAgRzc3M2AhAgAyADKAIQQf8BcS0AgAggAygCEEEYdi0AgAhBGHQgAygCEEEQdkH/AXEtAIAIQRB0cyADKAIQQQh2Qf8BcS0AgAhBCHRzczYCECADIAMoAgwgAygCEEEXdCADKAIQQQl2ciADKAIQIAMoAhBBDXQgAygCEEETdnJzc3M2AhAgAygCFCADKAIQNgJkIANBrBIoAgAgAygCECADKAIEIAMoAgBzc3M2AgwgAyADKAIMQf8BcS0AgAggAygCDEEYdi0AgAhBGHQgAygCDEEQdkH/AXEtAIAIQRB0cyADKAIMQQh2Qf8BcS0AgAhBCHRzczYCDCADIAMoAgggAygCDEEXdCADKAIMQQl2ciADKAIMIAMoAgxBDXQgAygCDEETdnJzc3M2AgwgAygCFCADKAIMNgJgIANBsBIoAgAgAygCDCADKAIAIAMoAhBzc3M2AgggAyADKAIIQf8BcS0AgAggAygCCEEYdi0AgAhBGHQgAygCCEEQdkH/AXEtAIAIQRB0cyADKAIIQQh2Qf8BcS0AgAhBCHRzczYCCCADIAMoAgQgAygCCEEXdCADKAIIQQl2ciADKAIIIAMoAghBDXQgAygCCEETdnJzc3M2AgggAygCFCADKAIINgJcIANBtBIoAgAgAygCCCADKAIQIAMoAgxzc3M2AgQgAyADKAIEQf8BcS0AgAggAygCBEEYdi0AgAhBGHQgAygCBEEQdkH/AXEtAIAIQRB0cyADKAIEQQh2Qf8BcS0AgAhBCHRzczYCBCADIAMoAgAgAygCBEEXdCADKAIEQQl2ciADKAIEIAMoAgRBDXQgAygCBEETdnJzc3M2AgQgAygCFCADKAIENgJYIANBuBIoAgAgAygCBCADKAIMIAMoAghzc3M2AgAgAyADKAIAQf8BcS0AgAggAygCAEEYdi0AgAhBGHQgAygCAEEQdkH/AXEtAIAIQRB0cyADKAIAQQh2Qf8BcS0AgAhBCHRzczYCACADIAMoAhAgAygCAEEXdCADKAIAQQl2ciADKAIAIAMoAgBBDXQgAygCAEETdnJzc3M2AgAgAygCFCADKAIANgJUIANBvBIoAgAgAygCACADKAIIIAMoAgRzc3M2AhAgAyADKAIQQf8BcS0AgAggAygCEEEYdi0AgAhBGHQgAygCEEEQdkH/AXEtAIAIQRB0cyADKAIQQQh2Qf8BcS0AgAhBCHRzczYCECADIAMoAgwgAygCEEEXdCADKAIQQQl2ciADKAIQIAMoAhBBDXQgAygCEEETdnJzc3M2AhAgAygCFCADKAIQNgJQIANBwBIoAgAgAygCECADKAIEIAMoAgBzc3M2AgwgAyADKAIMQf8BcS0AgAggAygCDEEYdi0AgAhBGHQgAygCDEEQdkH/AXEtAIAIQRB0cyADKAIMQQh2Qf8BcS0AgAhBCHRzczYCDCADIAMoAgggAygCDEEXdCADKAIMQQl2ciADKAIMIAMoAgxBDXQgAygCDEETdnJzc3M2AgwgAygCFCADKAIMNgJMIANBxBIoAgAgAygCDCADKAIAIAMoAhBzc3M2AgggAyADKAIIQf8BcS0AgAggAygCCEEYdi0AgAhBGHQgAygCCEEQdkH/AXEtAIAIQRB0cyADKAIIQQh2Qf8BcS0AgAhBCHRzczYCCCADIAMoAgQgAygCCEEXdCADKAIIQQl2ciADKAIIIAMoAghBDXQgAygCCEETdnJzc3M2AgggAygCFCADKAIINgJIIANByBIoAgAgAygCCCADKAIQIAMoAgxzc3M2AgQgAyADKAIEQf8BcS0AgAggAygCBEEYdi0AgAhBGHQgAygCBEEQdkH/AXEtAIAIQRB0cyADKAIEQQh2Qf8BcS0AgAhBCHRzczYCBCADIAMoAgAgAygCBEEXdCADKAIEQQl2ciADKAIEIAMoAgRBDXQgAygCBEETdnJzc3M2AgQgAygCFCADKAIENgJEIANBzBIoAgAgAygCBCADKAIMIAMoAghzc3M2AgAgAyADKAIAQf8BcS0AgAggAygCAEEYdi0AgAhBGHQgAygCAEEQdkH/AXEtAIAIQRB0cyADKAIAQQh2Qf8BcS0AgAhBCHRzczYCACADIAMoAhAgAygCAEEXdCADKAIAQQl2ciADKAIAIAMoAgBBDXQgAygCAEETdnJzc3M2AgAgAygCFEFAayADKAIANgIAIANB0BIoAgAgAygCACADKAIIIAMoAgRzc3M2AhAgAyADKAIQQf8BcS0AgAggAygCEEEYdi0AgAhBGHQgAygCEEEQdkH/AXEtAIAIQRB0cyADKAIQQQh2Qf8BcS0AgAhBCHRzczYCECADIAMoAgwgAygCEEEXdCADKAIQQQl2ciADKAIQIAMoAhBBDXQgAygCEEETdnJzc3M2AhAgAygCFCADKAIQNgI8IANB1BIoAgAgAygCECADKAIEIAMoAgBzc3M2AgwgAyADKAIMQf8BcS0AgAggAygCDEEYdi0AgAhBGHQgAygCDEEQdkH/AXEtAIAIQRB0cyADKAIMQQh2Qf8BcS0AgAhBCHRzczYCDCADIAMoAgggAygCDEEXdCADKAIMQQl2ciADKAIMIAMoAgxBDXQgAygCDEETdnJzc3M2AgwgAygCFCADKAIMNgI4IANB2BIoAgAgAygCDCADKAIAIAMoAhBzc3M2AgggAyADKAIIQf8BcS0AgAggAygCCEEYdi0AgAhBGHQgAygCCEEQdkH/AXEtAIAIQRB0cyADKAIIQQh2Qf8BcS0AgAhBCHRzczYCCCADIAMoAgQgAygCCEEXdCADKAIIQQl2ciADKAIIIAMoAghBDXQgAygCCEETdnJzc3M2AgggAygCFCADKAIINgI0IANB3BIoAgAgAygCCCADKAIQIAMoAgxzc3M2AgQgAyADKAIEQf8BcS0AgAggAygCBEEYdi0AgAhBGHQgAygCBEEQdkH/AXEtAIAIQRB0cyADKAIEQQh2Qf8BcS0AgAhBCHRzczYCBCADIAMoAgAgAygCBEEXdCADKAIEQQl2ciADKAIEIAMoAgRBDXQgAygCBEETdnJzc3M2AgQgAygCFCADKAIENgIwIANB4BIoAgAgAygCBCADKAIMIAMoAghzc3M2AgAgAyADKAIAQf8BcS0AgAggAygCAEEYdi0AgAhBGHQgAygCAEEQdkH/AXEtAIAIQRB0cyADKAIAQQh2Qf8BcS0AgAhBCHRzczYCACADIAMoAhAgAygCAEEXdCADKAIAQQl2ciADKAIAIAMoAgBBDXQgAygCAEETdnJzc3M2AgAgAygCFCADKAIANgIsIANB5BIoAgAgAygCACADKAIIIAMoAgRzc3M2AhAgAyADKAIQQf8BcS0AgAggAygCEEEYdi0AgAhBGHQgAygCEEEQdkH/AXEtAIAIQRB0cyADKAIQQQh2Qf8BcS0AgAhBCHRzczYCECADIAMoAgwgAygCEEEXdCADKAIQQQl2ciADKAIQIAMoAhBBDXQgAygCEEETdnJzc3M2AhAgAygCFCADKAIQNgIoIANB6BIoAgAgAygCECADKAIEIAMoAgBzc3M2AgwgAyADKAIMQf8BcS0AgAggAygCDEEYdi0AgAhBGHQgAygCDEEQdkH/AXEtAIAIQRB0cyADKAIMQQh2Qf8BcS0AgAhBCHRzczYCDCADIAMoAgggAygCDEEXdCADKAIMQQl2ciADKAIMIAMoAgxBDXQgAygCDEETdnJzc3M2AgwgAygCFCADKAIMNgIkIANB7BIoAgAgAygCDCADKAIAIAMoAhBzc3M2AgggAyADKAIIQf8BcS0AgAggAygCCEEYdi0AgAhBGHQgAygCCEEQdkH/AXEtAIAIQRB0cyADKAIIQQh2Qf8BcS0AgAhBCHRzczYCCCADIAMoAgQgAygCCEEXdCADKAIIQQl2ciADKAIIIAMoAghBDXQgAygCCEETdnJzc3M2AgggAygCFCADKAIINgIgIANB8BIoAgAgAygCCCADKAIQIAMoAgxzc3M2AgQgAyADKAIEQf8BcS0AgAggAygCBEEYdi0AgAhBGHQgAygCBEEQdkH/AXEtAIAIQRB0cyADKAIEQQh2Qf8BcS0AgAhBCHRzczYCBCADIAMoAgAgAygCBEEXdCADKAIEQQl2ciADKAIEIAMoAgRBDXQgAygCBEETdnJzc3M2AgQgAygCFCADKAIENgIcIANB9BIoAgAgAygCBCADKAIMIAMoAghzc3M2AgAgAyADKAIAQf8BcS0AgAggAygCAEEYdi0AgAhBGHQgAygCAEEQdkH/AXEtAIAIQRB0cyADKAIAQQh2Qf8BcS0AgAhBCHRzczYCACADIAMoAhAgAygCAEEXdCADKAIAQQl2ciADKAIAIAMoAgBBDXQgAygCAEETdnJzc3M2AgAgAygCFCADKAIANgIYIANB+BIoAgAgAygCACADKAIIIAMoAgRzc3M2AhAgAyADKAIQQf8BcS0AgAggAygCEEEYdi0AgAhBGHQgAygCEEEQdkH/AXEtAIAIQRB0cyADKAIQQQh2Qf8BcS0AgAhBCHRzczYCECADIAMoAgwgAygCEEEXdCADKAIQQQl2ciADKAIQIAMoAhBBDXQgAygCEEETdnJzc3M2AhAgAygCFCADKAIQNgIUIANB/BIoAgAgAygCECADKAIEIAMoAgBzc3M2AgwgAyADKAIMQf8BcS0AgAggAygCDEEYdi0AgAhBGHQgAygCDEEQdkH/AXEtAIAIQRB0cyADKAIMQQh2Qf8BcS0AgAhBCHRzczYCDCADIAMoAgggAygCDEEXdCADKAIMQQl2ciADKAIMIAMoAgxBDXQgAygCDEETdnJzc3M2AgwgAygCFCADKAIMNgIQIANBgBMoAgAgAygCDCADKAIAIAMoAhBzc3M2AgggAyADKAIIQf8BcS0AgAggAygCCEEYdi0AgAhBGHQgAygCCEEQdkH/AXEtAIAIQRB0cyADKAIIQQh2Qf8BcS0AgAhBCHRzczYCCCADIAMoAgQgAygCCEEXdCADKAIIQQl2ciADKAIIIAMoAghBDXQgAygCCEETdnJzc3M2AgggAygCFCADKAIINgIMIANBhBMoAgAgAygCCCADKAIQIAMoAgxzc3M2AgQgAyADKAIEQf8BcS0AgAggAygCBEEYdi0AgAhBGHQgAygCBEEQdkH/AXEtAIAIQRB0cyADKAIEQQh2Qf8BcS0AgAhBCHRzczYCBCADIAMoAgAgAygCBEEXdCADKAIEQQl2ciADKAIEIAMoAgRBDXQgAygCBEETdnJzc3M2AgQgAygCFCADKAIENgIIIANBiBMoAgAgAygCBCADKAIMIAMoAghzc3M2AgAgAyADKAIAQf8BcS0AgAggAygCAEEYdi0AgAhBGHQgAygCAEEQdkH/AXEtAIAIQRB0cyADKAIAQQh2Qf8BcS0AgAhBCHRzczYCACADIAMoAhAgAygCAEEXdCADKAIAQQl2ciADKAIAIAMoAgBBDXQgAygCAEETdnJzc3M2AgAgAygCFCADKAIANgIEIANBjBMoAgAgAygCACADKAIIIAMoAgRzc3M2AhAgAyADKAIQQf8BcS0AgAggAygCEEEYdi0AgAhBGHQgAygCEEEQdkH/AXEtAIAIQRB0cyADKAIQQQh2Qf8BcS0AgAhBCHRzczYCECADIAMoAgwgAygCEEEXdCADKAIQQQl2ciADKAIQIAMoAhBBDXQgAygCEEETdnJzc3M2AhAgAygCFCADKAIQNgIAIANBADYCACADQQA2AgQgA0EANgIIIANBADYCDCADQQA2AhAgACgCCCEDIAgiACQAIAAgBzYCHCAAIAM2AhggACABNgIUIAAgAkEEdjYCECAAIAY2AgwDQCAAIAAoAhAiA0EBazYCECADBEAgACgCHCAAKAIUIAAoAgwQBiAAKAIYIQQjAEEgayIDIAAoAgw2AhwgAyAENgIYIANBEDYCFCADIAMoAhw2AhAgAyADKAIYNgIMIANBADYCCANAIAMoAggiBCADKAIUSQRAIAQgAygCEGoiByAEIAMoAgxqLQAAIActAABzOgAAIAMgAygCCEEBajYCCAwBCwsgACAAKAIUNgIYIAAgACgCFEEQajYCFCAAIAAoAgxBEGo2AgwMAQsLIABBIGokAAsgASAGIAIQCCAGEAMLIAIhAwsgBUGQAWokACADC68CAQN/IwBBkAFrIgMkAAJAIAFFDQAgAkUNACADQRBqIAAoAgQQCiACEAUhBUF/IQQCQAJAAkACQCAAKAIAQQFrDgIAAQMLIAAoAgghBCMAQSBrIgAkACAAIANBEGo2AhwgACAENgIYIAAgATYCFCAAIAJBBHY2AhAgACAFNgIMA0AgACAAKAIQIgRBAWs2AhAgBARAIAAoAgwgACgCFCAAKAIYQRAQCSAAKAIcIAAoAgwgACgCDBAGIAAgACgCDDYCGCAAIAAoAhRBEGo2AhQgACAAKAIMQRBqNgIMDAELCyAAQSBqJAAMAQsgAyAAKAIIIgApAAA3AwAgAyAAKQAINwMIIANBEGogAyABIAIgBRALCyABIAUgAhAIIAIhBAsgBRADCyADQZABaiQAIAQLYwEBf0EMEAUiAyAANgIAIANBIBAFIgA2AgQgACABKQAYNwAYIAAgASkAEDcAECAAIAEpAAg3AAggACABKQAANwAAIANBEBAFIgA2AgggACACKQAINwAIIAAgAikAADcAACADCwuiCwIAQYAIC4AK1pDp/szhPbcWthTCKPssBStnmnYqvgTDqkQTJkmGBpmcQlD0ke+YejNUC0Ptz6xi5LMcqckI6JWA35T6dY8/pkcHp/zzcxe6g1k8GeaFT6hoa4GycWTai/jrD0twVp01HiQOXmNY0aIlInw7ASF4h9QARlef0ydSTDYC56DEyJ7qv4rSQMc4taP38s75YRWh4K5dpJs0GlWtkzIw9Yyx4x324i6CZspgwCkjqw1TTm/V2zdF3v2OLwP/anJtbFtRjRuvkrvdvH8R2VxBHxBa2ArBMYilzXu9LXTQErjltLCJaZdKDJZ3fmW58QnFbsaEGPB97DrcTSB57l8+18s5SFtb1Y5CQpLQp6fqTfv7/QYzM8/8h4fiZfT0Pcne3rVrWFgWTtratG5QUBRECwvByqCgKIjv7/gXsLAsnBQUBRGsrCuHnZ1m+2pqmPLZ2XeuqKgqgvr6vEYQEAQUDw/Az6qqqAIREUVUTEwTX5iYJr4lJUhtGhqEnhgYBh5mZpv9cnKe7AkJQ0pBQVEQ09P3JEZGk9W/v+xTYmKa+Onpe5LMzDP/UVFVBCwsCycNDUJPt7fuWT8/zPOysq4ciYlj6pOT53TOzrF/cHAcbKamqw0nJ8rtICAIKKOj60hWVpfBAgKCgH9/3KNSUpbE6+v5EtXVdKE+Po2z/Pw/w5qapD4dHUZbHBwHG56epTvz8/8Mz8/wP83Ncr9cXBdL6uq4Ug4OgY9lZVg98PA8zGRkGX2bm+V+FhaHkT09TnOioqoIoaFpyK2tascGBoOFysqwesXFcLWRkWX0a2vZsi4uiafj4/sYr6/oRzw8DzMtLUpnwcFxsFlZVw52dp/p1NQ14Xh4HmaQkCS0ODgONnl5XyaNjWLvYWFZOEdH0pWKiqAqlJQlsYiIIqrx8X2M7Ow71wQEAQWEhCGl4eF5mB4ehZtTU9eEAAAAABkZR15dXVYLfn6d409P0J+cnCe7SUlTGjExTXzY2DbuCAgCCp+f5HuCgqIgExPH1CMjy+h6epzmq6vpQv7+vUMqKoiiS0vRmgEBQUAfH8Tb4OA42NbWt2GOjqEv39/0K8vL8To7O8325+f6HYWFYOVUVBVBhoajJYOD42C6uqwWdXVcKZKSpjRubpn30NA05GhoGnJVVVQBtravGU5Okd/IyDL6wMAw8NfX9iEyMo68xsazdY+P4G90dB1p29v1LouL4Wq4uC6WCgqAipmZZ/4rK8nigYFh4AMDw8CkpCmNjIwjr66uqQc0NA05TU1SHzk5T3a9vW7TV1fWgW9v2Lfc3DfrFRVEUXt73ab39/4JOjqMtry8L5MMDAMP///8A6mpa8LJyXO6tbVs2bGxbdxtbVo3RUVQFTY2j7lsbBt3vr6tE0pKkNru7rlXd3feqfLyvkz9/X6DREQRVWdn2r1xcV0sBQVARXx8H2NAQBBQaWlbMmNj27goKAoiBwfCxcTEMfUiIoqolpanMTc3zvnt7XqX9va/SbS0LZnR0XWkQ0PTkEhIElri4rpYl5fmcdLStmTCwrJwJiaLraWlaM1eXpXLKSlLYjAwDDxaWpTO3d12q/n5f4aVlWTx5ua7XcfH8jUkJAktFxfG0bm5b9YbG8XeEhKGlGBgGHjDw/Mw9fV8ibOz71zo6DrSc3PfrDU1THmAgCCg5eV4nbu77VZ9fV4j+Pg+xl9f1IsvL8jn5OQ53SEhSWgAQYASC5MBxrqxo1AzqlaXkX1n3CJwshUOBwAxKiMcTUY/OGliW1SFfndwoZqTjL22r6jZ0svE9e7n4BEKA/wtJh8YSUI7NGVeV1CBenNsnZaPiLmyq6TVzsfA8erj3A0G//gpIhsURT43MGFaU0x9dm9omZKLhLWup6DRysO87ebf2AkC+/QlHhcQQTozLF1WT0h5cmtkkAsB")||(C=function(t){return e.locateFile?e.locateFile(t,a):a+t}(C));var w=t=>{for(;t.length>0;)t.shift()(e)};e.noExitRuntime;var S,B=e=>{var t=(e-h.buffer.byteLength+65535)/65536;try{return h.grow(t),A(),1}catch(e){}},O={a:()=>{x("")},c:(e,t,r)=>d.copyWithin(e,t,t+r),b:e=>{var t=d.length,r=2147483648;if((e>>>=0)>r)return!1;for(var n=(e,t)=>e+(t-e%t)%t,i=1;i<=4;i*=2){var o=t*(1+.2/i);o=Math.min(o,e+100663296);var s=Math.min(r,n(Math.max(e,o),65536));if(B(s))return!0}return!1}},D=function(){var t={a:O};function r(t,r){var n;return D=t.exports,h=D.d,A(),n=D.e,_.unshift(n),function(){if(y--,e.monitorRunDependencies&&e.monitorRunDependencies(y),0==y&&E){var t=E;E=null,t()}}(),D}if(y++,e.monitorRunDependencies&&e.monitorRunDependencies(y),e.instantiateWasm)try{return e.instantiateWasm(t,r)}catch(e){return p(`Module.instantiateWasm callback failed with error: ${e}`),!1}return R(C,t,(function(e){r(e.instance)})),{}}();function F(){function t(){S||(S=!0,e.calledRun=!0,f||(w(_),e.onRuntimeInitialized&&e.onRuntimeInitialized(),function(){if(e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;)t=e.postRun.shift(),m.unshift(t);var t;w(m)}()))}y>0||(function(){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)t=e.preRun.shift(),g.unshift(t);var t;w(g)}(),y>0||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),t()}),1)):t()))}if(e._UGCWasm_CipherSM4_New=(t,r,n)=>(e._UGCWasm_CipherSM4_New=D.f)(t,r,n),e._UGCWasm_CipherSM4_Encrypt=(t,r,n)=>(e._UGCWasm_CipherSM4_Encrypt=D.g)(t,r,n),e._UGCWasm_CipherSM4_Decrypt=(t,r,n)=>(e._UGCWasm_CipherSM4_Decrypt=D.h)(t,r,n),e._UGCWasm_CipherSM4_Delete=t=>(e._UGCWasm_CipherSM4_Delete=D.i)(t),e._malloc=t=>(e._malloc=D.k)(t),e._free=t=>(e._free=D.l)(t),E=function e(){S||F(),S||(E=e)},e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return F(),e}();function XB(){}var WB=!1,KB=!1,JB=!1;function ZB(e,t){if(e.byteLength<=t)return e;return e.subarray(0,t)}function $B(e,t){for(let r=0;r<e.length;r++)t[r]=e[r];return t}pB.onRuntimeInitialized=()=>{(WB=!0)&&KB&&(JB=!0)},YB.onRuntimeInitialized=()=>{KB=!0,WB&&KB&&(JB=!0)},XB.parse=function(e,t){return JB?t="SM4"===e.type?function(e,t){const r=new Uint8Array(t),n=ZB(r,256),i=new Uint8Array(e),o=YB._malloc(i.length*i.BYTES_PER_ELEMENT);YB.HEAPU8.set(i,o/i.BYTES_PER_ELEMENT);const s=new Uint8Array([48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102]),a=YB._malloc(s.length*s.BYTES_PER_ELEMENT);YB.HEAPU8.set(s,a/s.BYTES_PER_ELEMENT);const u=YB._UGCWasm_CipherSM4_New(2,o,a);YB._free(o),YB._free(a);const c=YB._malloc(n.length*n.BYTES_PER_ELEMENT);YB.HEAPU8.set(n,c/n.BYTES_PER_ELEMENT),YB._UGCWasm_CipherSM4_Decrypt(u,c,n.length);const l=$B(YB.HEAPU8.subarray(c,c+n.length),r);return YB._UGCWasm_CipherSM4_Delete(u),YB._free(c),l.buffer}(e.key,t):function(e,t){var r=new Uint8Array(t);const n=new Uint8Array(e),i=pB._malloc(n.length*n.BYTES_PER_ELEMENT);pB.HEAPU8.set(n,i/n.BYTES_PER_ELEMENT);var o=new Uint8Array([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),s=pB._malloc(o.length*o.BYTES_PER_ELEMENT);pB.HEAPU8.set(o,s/o.BYTES_PER_ELEMENT);var a=pB._UGCWasm_CipherAES_New(2,i,s);pB._free(i),pB._free(s);const u=ZB(r,256);return function(e,t,r){const n=pB._malloc(e.length*e.BYTES_PER_ELEMENT);pB.HEAPU8.set(e,n/e.BYTES_PER_ELEMENT),pB._UGCWasm_CipherAES_Encrypt(t,n,e.length);let i=pB.HEAPU8.subarray(n,n+e.length);const o=$B(i,r);return pB._free(n),o}(u,a,r).buffer}(e.key,t):null};class eO{constructor(e){this.entries={},this.scheduler=e}request(e,t,r,n){const i=this.entries[e]=this.entries[e]||{callbacks:[]};if(i.result){const[e,r]=i.result;return this.scheduler?this.scheduler.add((()=>{n(e,r)}),t):n(e,r),()=>{}}return i.callbacks.push(n),i.cancel||(i.cancel=r(((r,n)=>{i.result=[r,n];for(const e of i.callbacks)this.scheduler?this.scheduler.add((()=>{e(r,n)}),t):e(r,n);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{i.result||(i.callbacks=i.callbacks.filter((e=>e!==n)),i.callbacks.length||(i.cancel(),delete this.entries[e]))}}}function tO(e,t,r){const n=JSON.stringify(e.request);e.data&&(this.deduped.entries[n]={result:[null,e.data]});const i={type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom};return this.deduped.request(n,i,(t=>{const r=vl(e.request,((r,n,i,o)=>{if(r)t(r);else if(n){if(jt(e.encryptInfo)&&null==(n=XB.parse(e.encryptInfo,n)))return void t(null);n.byteLength,t(null,{vectorTile:new IR(new Wy(n)),rawData:n,cacheControl:i,expires:o})}}));return()=>{r.cancel(),t()}}),t)}class rO extends Ul{constructor(e,t,r,n,i){super(),this.actor=e,this.layerIndex=t,this.availableImages=r,this.loadVectorData=i||tO,this.loading={},this.loaded={},this.deduped=new eO(e.scheduler),this.isSpriteLoaded=n,this.scheduler=e.scheduler}loadTile(e,t){const r=e.uid,n=e&&e.request;n&&n.collectResourceTiming;const i=this.loading[r]=new uB(e);i.abort=this.loadVectorData(e,((n,o)=>{const s=!this.loading[r];if(delete this.loading[r],s||n||!o)return i.status="done",s||(this.loaded[r]=i),t(n);const a=o.rawData,u={};o.expires&&(u.expires=o.expires),o.cacheControl&&(u.cacheControl=o.cacheControl),i.vectorTile=o.vectorTile||new IR(new Wy(a));const c=()=>{i.parse(e,i.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,r)=>{if(e||!r)return t(e);t(null,ul({rawTileData:a.slice(0)},r,u,{}))}))};this.isSpriteLoaded?c():this.once("isSpriteLoaded",(()=>{if(this.scheduler){const t={type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom};this.scheduler.add(c,t)}else c()})),this.loaded=this.loaded||{},this.loaded[r]=i}))}reloadTile(e,t){const r=this.loaded,n=e.uid,i=this;if(r&&r[n]){const o=r[n];o.showCollisionBoxes=e.showCollisionBoxes,o.enableTerrain=!!e.enableTerrain,o.projection=e.projection,o.tileTransform=cI(e.tileID.canonical,e.projection);const s=(r,n)=>{const s=o.reloadCallback;s&&(delete o.reloadCallback,o.parse(e,o.vectorTile,i.layerIndex,this.availableImages,i.actor,s)),t(r,n)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(e,o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}abortTile(e,t){const r=e.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),t()}removeTile(e,t){const r=this.loaded,n=e.uid;r&&r[n]&&delete r[n],t()}}function nO(e,t){var r,n=e&&e.type;if("FeatureCollection"===n)for(r=0;r<e.features.length;r++)nO(e.features[r],t);else if("GeometryCollection"===n)for(r=0;r<e.geometries.length;r++)nO(e.geometries[r],t);else if("Feature"===n)nO(e.geometry,t);else if("Polygon"===n)iO(e.coordinates,t);else if("MultiPolygon"===n)for(r=0;r<e.coordinates.length;r++)iO(e.coordinates[r],t);return e}function iO(e,t){if(0!==e.length){oO(e[0],t);for(var r=1;r<e.length;r++)oO(e[r],!t)}}function oO(e,t){for(var r=0,n=0,i=0,o=e.length,s=o-1;i<o;s=i++){var a=(e[i][0]-e[s][0])*(e[s][1]+e[i][1]),u=r+a;n+=Math.abs(r)>=Math.abs(a)?r-u+a:a-u+r,r=u}r+n>=0!=!!t&&e.reverse()}class sO{constructor(e){this._feature=e,this.extent=va,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const t of this._feature.geometry)e.push([new zt(t[0],t[1])]);return e}{const e=[];for(const t of this._feature.geometry){const r=[];for(const e of t)r.push(new zt(e[0],e[1]));e.push(r)}return e}}toGeoJSON(e,t,r){return yR.prototype.toGeoJSON.call(this,e,t,r)}}class aO{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=va,this.length=e.length,this._features=e}feature(e){return new sO(this._features[e])}}function uO(e){var t=new Wy;return function(e,t){for(var r in e.layers)t.writeMessage(3,cO,e.layers[r])}(e,t),t.finish()}function cO(e,t){var r;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<e.length;r++)n.feature=e.feature(r),t.writeMessage(2,lO,n);var i=n.keys;for(r=0;r<i.length;r++)t.writeStringField(3,i[r]);var o=n.values;for(r=0;r<o.length;r++)t.writeMessage(4,AO,o[r])}function lO(e,t){var r=e.feature;void 0!==r.id&&t.writeVarintField(1,r.id),t.writeMessage(2,hO,e),t.writeVarintField(3,r.type),t.writeMessage(4,fO,r)}function hO(e,t){var r=e.feature,n=e.keys,i=e.values,o=e.keycache,s=e.valuecache;for(var a in r.properties){var u=r.properties[a],c=o[a];if(null!==u){void 0===c&&(n.push(a),c=n.length-1,o[a]=c),t.writeVarint(c);var l=typeof u;"string"!==l&&"boolean"!==l&&"number"!==l&&(u=JSON.stringify(u));var h=l+":"+u,p=s[h];void 0===p&&(i.push(u),p=i.length-1,s[h]=p),t.writeVarint(p)}}}function pO(e,t){return(t<<3)+(7&e)}function dO(e){return e<<1^e>>31}function fO(e,t){for(var r=e.loadGeometry(),n=e.type,i=0,o=0,s=r.length,a=0;a<s;a++){var u=r[a],c=1;1===n&&(c=u.length),t.writeVarint(pO(1,c));for(var l=3===n?u.length-1:u.length,h=0;h<l;h++){1===h&&1!==n&&t.writeVarint(pO(2,l-1));var p=u[h].x-i,d=u[h].y-o;t.writeVarint(dO(p)),t.writeVarint(dO(d)),i+=p,o+=d}3===n&&t.writeVarint(pO(7,1))}}function AO(e,t){var r=typeof e;"string"===r?t.writeStringField(1,e):"boolean"===r?t.writeBooleanField(7,e):"number"===r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}const gO=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];function _O(e,t=64,r=Float64Array,n){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const i=gO.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(i<0)throw new Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}function mO(e,t,r,n,i,o){if(i-n<=r)return;const s=n+i>>1;yO(e,t,s,n,i,o),mO(e,t,r,n,s-1,1-o),mO(e,t,r,s+1,i,1-o)}function yO(e,t,r,n,i,o){for(;i>n;){if(i-n>600){const s=i-n+1,a=r-n+1,u=Math.log(s),c=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*c*(s-c)/s)*(a-s/2<0?-1:1);yO(e,t,r,Math.max(n,Math.floor(r-a*c/s+l)),Math.min(i,Math.floor(r+(s-a)*c/s+l)),o)}const s=t[2*r+o];let a=n,u=i;for(EO(e,t,n,r),t[2*i+o]>s&&EO(e,t,n,i);a<u;){for(EO(e,t,a,u),a++,u--;t[2*a+o]<s;)a++;for(;t[2*u+o]>s;)u--}t[2*n+o]===s?EO(e,t,n,u):(u++,EO(e,t,u,i)),u<=r&&(n=u+1),r<=u&&(i=u-1)}}function EO(e,t,r,n){xO(e,r,n),xO(t,2*r,2*n),xO(t,2*r+1,2*n+1)}function xO(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function CO(e,t,r,n){const i=e-r,o=t-n;return i*i+o*o}function bO(e,t,r,n,i,o){var s=i-r,a=o-n,u={x:e-.5*s,y:t-.5*a,width:s,height:a},c={x:r,y:n,width:s,height:a},l=u.x,h=u.y,p=c.x,d=c.y;return!(l>p+c.width||l+u.width<p||h+u.height<d||h>d+c.height)}_O.prototype.add=function(e,t){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r},_O.prototype.finish=function(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return mO(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this},_O.prototype.range=function(e,t,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:o,nodeSize:s}=this,a=[0,i.length-1,0],u=[];for(;a.length;){const c=a.pop()||0,l=a.pop()||0,h=a.pop()||0;if(l-h<=s){for(let s=h;s<=l;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=r&&c>=t&&c<=n&&u.push(i[s])}continue}const p=h+l>>1,d=o[2*p],f=o[2*p+1];d>=e&&d<=r&&f>=t&&f<=n&&u.push(i[p]),(0===c?e<=d:t<=f)&&(a.push(h),a.push(p-1),a.push(1-c)),(0===c?r>=d:n>=f)&&(a.push(p+1),a.push(l),a.push(1-c))}return u},_O.prototype.within=function(e,t,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:i,nodeSize:o}=this,s=[0,n.length-1,0],a=[],u=r*r;for(;s.length;){const c=s.pop()||0,l=s.pop()||0,h=s.pop()||0;if(l-h<=o){for(let r=h;r<=l;r++)CO(i[2*r],i[2*r+1],e,t)<=u&&a.push(n[r]);continue}const p=h+l>>1,d=i[2*p],f=i[2*p+1];CO(d,f,e,t)<=u&&a.push(n[p]),(0===c?e-r<=d:t-r<=f)&&(s.push(h),s.push(p-1),s.push(1-c)),(0===c?e+r>=d:t+r>=f)&&(s.push(p+1),s.push(l),s.push(1-c))}return a},_O.prototype.intersect=function(e,t,r,n,i){const{ids:o,coords:s,nodeSize:a}=this;var u,c,l=[0,o.length-1,0],h=[];for(i=i||bO;l.length;){var p=l.pop(),d=l.pop(),f=l.pop();if(d-f<=a)for(var A=f;A<=d;A++)i(u=s[2*A],c=s[2*A+1],e,t,r,n,A,o[A])&&h.push(o[A]);else{var g=f+d>>1;i(u=s[2*g],c=s[2*g+1],e,t,r,n,g,o[g])&&h.push(o[g]);var _=1-p;(0===p?e<=u:t<=c)&&(l.push(f),l.push(g-1),l.push(_)),(0===p?r>=u:n>=c)&&(l.push(g+1),l.push(d),l.push(_))}}return h},_O.from=function(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,r]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const n=r>>4;if(1!==n)throw new Error(`Got v${n} data when expected v1.`);const i=gO[15&r];if(!i)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new _O(s,o,i,e)};const IO={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},TO=Math.fround||(e=>t=>(e[0]=+t,e[0]))(new Float32Array(1));class vO{constructor(e){this.options=Object.assign(Object.create(IO),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:r,maxZoom:n}=this.options;t&&console.time("total time");const i=`prepare ${e.length} points`;t&&console.time(i),this.points=e;const o=[];for(let t=0;t<e.length;t++){const r=e[t];if(!r.geometry)continue;const[n,i]=r.geometry.coordinates,s=TO(wO(n)),a=TO(SO(i));o.push(s,a,1/0,t,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[n+1]=this._createTree(o);t&&console.timeEnd(i);for(let e=n;e>=r;e--){const r=+Date.now();s=this.trees[e]=this._createTree(this._cluster(s,e)),t&&console.log("z%d: %d clusters in %dms",e,s.numItems,+Date.now()-r)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,e[1]));let i=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,i=180;else if(r>i){const e=this.getClusters([r,n,180,o],t),s=this.getClusters([-180,n,i,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(wO(r),SO(o),wO(i),SO(n)),u=s.data,c=[];for(const e of a){const t=this.stride*e;c.push(u[t+5]>1?RO(u,t,this.clusterProps):this.points[u[t+3]])}return c}getChildren(e){const t=this._getOriginId(e),r=this._getOriginZoom(e),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);const o=i.data;if(t*this.stride>=o.length)throw new Error(n);const s=this.options.radius/(this.options.extent*Math.pow(2,r-1)),a=o[t*this.stride],u=o[t*this.stride+1],c=i.within(a,u,s),l=[];for(const t of c){const r=t*this.stride;o[r+4]===e&&l.push(o[r+5]>1?RO(o,r,this.clusterProps):this.points[o[r+3]])}if(0===l.length)throw new Error(n);return l}getLeaves(e,t,r){t=t||10,r=r||0;const n=[];return this._appendLeaves(n,e,t,r,0),n}getTile(e,t,r){const n=this.trees[this._limitZoom(e)],i=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,u=(r-a)/i,c=(r+1+a)/i,l={features:[]};return this._addTileFeatures(n.range((t-a)/i,u,(t+1+a)/i,c),n.data,t,r,i,l),0===t&&this._addTileFeatures(n.range(1-a/i,u,1,c),n.data,i,r,i,l),t===i-1&&this._addTileFeatures(n.range(0,u,a/i,c),n.data,-1,r,i,l),l.features.length?l:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,n,i){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?i+o.point_count<=n?i+=o.point_count:i=this._appendLeaves(e,o.cluster_id,r,n,i):i<n?i++:e.push(t),e.length===r)break}return i}_createTree(e){const t=new _O(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let r=0;r<e.length;r+=this.stride)t.add(e[r],e[r+1]);return t.finish(),t.data=e,t}_addTileFeatures(e,t,r,n,i,o){for(const s of e){const e=s*this.stride,a=t[e+5]>1;let u,c,l;if(a)u=MO(t,e,this.clusterProps),c=t[e],l=t[e+1];else{const r=this.points[t[e+3]];u=r.properties;const[n,i]=r.geometry.coordinates;c=wO(n),l=SO(i)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*i-r)),Math.round(this.options.extent*(l*i-n))]],tags:u};let p;p=a||this.options.generateId?t[e+3]:this.points[t[e+3]].id,void 0!==p&&(h.id=p),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:r,extent:n,reduce:i,minPoints:o}=this.options,s=r/(n*Math.pow(2,t)),a=e.data,u=[],c=this.stride;for(let r=0;r<a.length;r+=c){if(a[r+2]<=t)continue;a[r+2]=t;const n=a[r],l=a[r+1],h=e.within(a[r],a[r+1],s),p=a[r+5];let d=p;for(const e of h){const r=e*c;a[r+2]>t&&(d+=a[r+5])}if(d>p&&d>=o){let e,o=n*p,s=l*p,f=-1;const A=(r/c<<5)+(t+1)+this.points.length;for(const n of h){const u=n*c;if(a[u+2]<=t)continue;a[u+2]=t;const l=a[u+5];o+=a[u]*l,s+=a[u+1]*l,a[u+4]=A,i&&(e||(e=this._map(a,r,!0),f=this.clusterProps.length,this.clusterProps.push(e)),i(e,this._map(a,u)))}a[r+4]=A,u.push(o/d,s/d,1/0,A,-1,d),i&&u.push(f)}else{for(let e=0;e<c;e++)u.push(a[r+e]);if(d>1)for(const e of h){const r=e*c;if(!(a[r+2]<=t)){a[r+2]=t;for(let e=0;e<c;e++)u.push(a[r+e])}}}}return u}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,r){if(e[t+5]>1){const n=this.clusterProps[e[t+6]];return r?Object.assign({},n):n}const n=this.points[e[t+3]].properties,i=this.options.map(n);return r&&i===n?Object.assign({},i):i}}function RO(e,t,r){return{type:"Feature",id:e[t+3],properties:MO(e,t,r),geometry:{type:"Point",coordinates:[BO(e[t]),OO(e[t+1])]}}}function MO(e,t,r){const n=e[t+5],i=n>=1e4?`${Math.round(n/1e3)}k`:n>=1e3?Math.round(n/100)/10+"k":n,o=e[t+6],s=-1===o?{}:Object.assign({},r[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+3],point_count:n,point_count_abbreviated:i})}function wO(e){return e/360+.5}function SO(e){const t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function BO(e){return 360*(e-.5)}function OO(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function DO(e,t,r,n){for(var i,o=n,s=r-t>>1,a=r-t,u=e[t],c=e[t+1],l=e[r],h=e[r+1],p=t+3;p<r;p+=3){var d=FO(e[p],e[p+1],u,c,l,h);if(d>o)i=p,o=d;else if(d===o){var f=Math.abs(p-s);f<a&&(i=p,a=f)}}o>n&&(i-t>3&&DO(e,t,i,n),e[i+2]=o,r-i>3&&DO(e,i,r,n))}function FO(e,t,r,n,i,o){var s=i-r,a=o-n;if(0!==s||0!==a){var u=((e-r)*s+(t-n)*a)/(s*s+a*a);u>1?(r=i,n=o):u>0&&(r+=s*u,n+=a*u)}return(s=e-r)*s+(a=t-n)*a}function PO(e,t,r,n){var i={id:void 0===e?null:e,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,r=e.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)NO(e,t);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<t.length;n++)NO(e,t[n]);else if("MultiPolygon"===r)for(n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)NO(e,t[n][i])}(i),i}function NO(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function LO(e,t,r,n,i){if(t.geometry){var o=t.geometry.coordinates,s=t.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),u=[],c=t.id;if(r.promoteId?c=t.properties[r.promoteId]:r.generateId&&(c=n||0),"Point"===s)UO(o,u,i);else if("MultiPoint"===s)for(var l=0;l<o.length;l++)UO(o[l],u,i);else if("LineString"===s)GO(o,u,a,!1,i);else if("MultiLineString"===s){if(r.lineMetrics){for(l=0;l<o.length;l++)u=[],GO(o[l],u,a,!1,i),e.push(PO(c,"LineString",u,t.properties));return}QO(o,u,a,!1,i)}else if("Polygon"===s)QO(o,u,a,!0,i);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(l=0;l<t.geometry.geometries.length;l++)LO(e,{id:c,geometry:t.geometry.geometries[l],properties:t.properties},r,n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<o.length;l++){var h=[];QO(o[l],h,a,!0,i),u.push(h)}}e.push(PO(c,s,u,t.properties))}}function UO(e,t,r){var{x:n,y:i}=r.fromLngLat(e);t.push(n,i),t.push(0)}function GO(e,t,r,n,i){for(var o,s,a=0,u=0;u<e.length;u++){var{x:c,y:l}=i.fromLngLat(e[u]);t.push(c,l),t.push(0),u>0&&(a+=n?(o*l-c*s)/2:Math.sqrt(Math.pow(c-o,2)+Math.pow(l-s,2))),o=c,s=l}var h=t.length-3;t[2]=1,DO(t,0,h,r),t[h+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function QO(e,t,r,n,i){for(var o=0;o<e.length;o++){var s=[];GO(e[o],s,r,n,i),t.push(s)}}function kO(e,t,r,n,i,o,s,a){if(n/=t,o>=(r/=t)&&s<n)return e;if(s<r||o>=n)return null;for(var u=[],c=0;c<e.length;c++){var l=e[c],h=l.geometry,p=l.type,d=0===i?l.minX:l.minY,f=0===i?l.maxX:l.maxY;if(d>=r&&f<n)u.push(l);else if(!(f<r||d>=n)){var A=[];if("Point"===p||"MultiPoint"===p)zO(h,A,r,n,i);else if("LineString"===p)jO(h,A,r,n,i,!1,a.lineMetrics);else if("MultiLineString"===p)qO(h,A,r,n,i,!1);else if("Polygon"===p)qO(h,A,r,n,i,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var _=[];qO(h[g],_,r,n,i,!0),_.length&&A.push(_)}if(A.length){if(a.lineMetrics&&"LineString"===p){for(g=0;g<A.length;g++)u.push(PO(l.id,p,A[g],l.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===A.length?(p="LineString",A=A[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===A.length?"Point":"MultiPoint"),u.push(PO(l.id,p,A,l.tags))}}}return u.length?u:null}function zO(e,t,r,n,i){for(var o=0;o<e.length;o+=3){var s=e[o+i];s>=r&&s<=n&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function jO(e,t,r,n,i,o,s){for(var a,u,c=HO(e),l=0===i?YO:XO,h=e.start,p=0;p<e.length-3;p+=3){var d=e[p],f=e[p+1],A=e[p+2],g=e[p+3],_=e[p+4],m=0===i?d:f,y=0===i?g:_,E=!1;s&&(a=Math.sqrt(Math.pow(d-g,2)+Math.pow(f-_,2))),m<r?y>r&&(u=l(c,d,f,g,_,r),s&&(c.start=h+a*u)):m>n?y<n&&(u=l(c,d,f,g,_,n),s&&(c.start=h+a*u)):VO(c,d,f,A),y<r&&m>=r&&(u=l(c,d,f,g,_,r),E=!0),y>n&&m<=n&&(u=l(c,d,f,g,_,n),E=!0),!o&&E&&(s&&(c.end=h+a*u),t.push(c),c=HO(e)),s&&(h+=a)}var x=e.length-3;d=e[x],f=e[x+1],A=e[x+2],(m=0===i?d:f)>=r&&m<=n&&VO(c,d,f,A),x=c.length-3,o&&x>=3&&(c[x]!==c[0]||c[x+1]!==c[1])&&VO(c,c[0],c[1],c[2]),c.length&&t.push(c)}function HO(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function qO(e,t,r,n,i,o){for(var s=0;s<e.length;s++)jO(e[s],t,r,n,i,o,!1)}function VO(e,t,r,n){e.push(t),e.push(r),e.push(n)}function YO(e,t,r,n,i,o){var s=(o-t)/(n-t);return e.push(o),e.push(r+(i-r)*s),e.push(1),s}function XO(e,t,r,n,i,o){var s=(o-r)/(i-r);return e.push(t+(n-t)*s),e.push(o),e.push(1),s}function WO(e,t){for(var r=[],n=0;n<e.length;n++){var i,o=e[n],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)i=KO(o.geometry,t);else if("MultiLineString"===s||"Polygon"===s){i=[];for(var a=0;a<o.geometry.length;a++)i.push(KO(o.geometry[a],t))}else if("MultiPolygon"===s)for(i=[],a=0;a<o.geometry.length;a++){for(var u=[],c=0;c<o.geometry[a].length;c++)u.push(KO(o.geometry[a][c],t));i.push(u)}r.push(PO(o.id,s,i,o.tags))}return r}function KO(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function JO(e,t){if(e.transformed)return e;var r,n,i,o=1<<e.z,s=e.x,a=e.y;for(r=0;r<e.features.length;r++){var u=e.features[r],c=u.geometry,l=u.type;if(u.geometry=[],1===l)for(n=0;n<c.length;n+=2)u.geometry.push(ZO(c[n],c[n+1],t,o,s,a));else for(n=0;n<c.length;n++){var h=[];for(i=0;i<c[n].length;i+=2)h.push(ZO(c[n][i],c[n][i+1],t,o,s,a));u.geometry.push(h)}}return e.transformed=!0,e}function ZO(e,t,r,n,i,o){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-o))]}function $O(e,t,r,n,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,eD(s,e[a],o,i);var u=e[a].minX,c=e[a].minY,l=e[a].maxX,h=e[a].maxY;u<s.minX&&(s.minX=u),c<s.minY&&(s.minY=c),l>s.maxX&&(s.maxX=l),h>s.maxY&&(s.maxY=h)}return s}function eD(e,t,r,n){var i=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<i.length;a+=3)s.push(i[a]),s.push(i[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)tD(s,i,e,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<i.length;a++)tD(s,i[a],e,r,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var c=i[u];for(a=0;a<c.length;a++)tD(s,c[a],e,r,!0,0===a)}if(s.length){var l=t.tags||null;if("LineString"===o&&n.lineMetrics){for(var h in l={},t.tags)l[h]=t.tags[h];l.mapbox_clip_start=i.start/i.size,l.mapbox_clip_end=i.end/i.size}var p={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:l};null!==t.id&&(p.id=t.id),e.features.push(p)}}function tD(e,t,r,n,i,o){var s=n*n;if(n>0&&t.size<(i?s:n))r.numPoints+=t.length/3;else{for(var a=[],u=0;u<t.length;u+=3)(0===n||t[u+2]>s)&&(r.numSimplified++,a.push(t[u]),a.push(t[u+1])),r.numPoints++;i&&function(e,t){for(var r=0,n=0,i=e.length,o=i-2;n<i;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===t)for(n=0,i=e.length;n<i/2;n+=2){var s=e[n],a=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=s,e[i-1-n]=a}}(a,o),e.push(a)}}function rD(e,t){t=this.options=function(e,t){for(var r in t)e[r]=t[r];return e}(Object.create(this.options),t);var r=t.debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(e,t){var r=[],n=t.epsgCode||3857,i=rI.fromEpsgCode(n);if("FeatureCollection"===e.type)for(var o=0;o<e.features.length;o++)LO(r,e.features[o],t,o,i);else"Feature"===e.type?LO(r,e,t,void 0,i):LO(r,{geometry:e},t,void 0,i);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(e,t){var r=t.buffer/t.extent,n=e,i=kO(e,1,-1-r,r,0,-1,2,t),o=kO(e,1,1-r,2+r,0,-1,2,t);return(i||o)&&(n=kO(e,1,-r,1+r,0,-1,2,t)||[],i&&(n=WO(i,1).concat(n)),o&&(n=n.concat(WO(o,-1)))),n}(n,t),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function nD(e,t,r){return 32*((1<<e)*r+t)+e}function iD(e,t){const r=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return t(null,null);const i=new aO(n.features);let o=uO(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),t(null,{vectorTile:i,rawData:o.buffer})}rD.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},rD.prototype.splitTile=function(e,t,r,n,i,o,s){for(var a=[e,t,r,n],u=this.options,c=u.debug;a.length;){n=a.pop(),r=a.pop(),t=a.pop(),e=a.pop();var l=1<<t,h=nD(t,r,n),p=this.tiles[h];if(!p&&(c>1&&console.time("creation"),p=this.tiles[h]=$O(e,t,r,n,u),this.tileCoords.push({z:t,x:r,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var d="z"+t;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(p.source=e,i){if(t===u.maxZoom||t===i)continue;var f=1<<i-t;if(r!==Math.floor(o/f)||n!==Math.floor(s/f))continue}else if(t===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==e.length){c>1&&console.time("clipping");var A,g,_,m,y,E,x=.5*u.buffer/u.extent,C=.5-x,b=.5+x,I=1+x;A=g=_=m=null,y=kO(e,l,r-x,r+b,0,p.minX,p.maxX,u),E=kO(e,l,r+C,r+I,0,p.minX,p.maxX,u),e=null,y&&(A=kO(y,l,n-x,n+b,1,p.minY,p.maxY,u),g=kO(y,l,n+C,n+I,1,p.minY,p.maxY,u),y=null),E&&(_=kO(E,l,n-x,n+b,1,p.minY,p.maxY,u),m=kO(E,l,n+C,n+I,1,p.minY,p.maxY,u),E=null),c>1&&console.timeEnd("clipping"),a.push(A||[],t+1,2*r,2*n),a.push(g||[],t+1,2*r,2*n+1),a.push(_||[],t+1,2*r+1,2*n),a.push(m||[],t+1,2*r+1,2*n+1)}}},rD.prototype.getTile=function(e,t,r){var n=this.options,i=n.extent,o=n.debug;if(e<0||e>24)return null;var s=1<<e,a=nD(e,t=(t%s+s)%s,r);if(this.tiles[a])return JO(this.tiles[a],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var u,c=e,l=t,h=r;!u&&c>0;)c--,l=Math.floor(l/2),h=Math.floor(h/2),u=this.tiles[nD(c,l,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,l,h),o>1&&console.time("drilling down"),this.splitTile(u.source,c,l,h,e,t,r),o>1&&console.timeEnd("drilling down"),this.tiles[a]?JO(this.tiles[a],i):null):null};class oD extends rO{constructor(e,t,r,n,i){super(e,t,r,n,iD),i&&(this.loadGeoJSON=i)}loadData(e,t){const r=e&&e.request;r&&r.collectResourceTiming,this.loadGeoJSON(e,((r,n)=>{if(r||!n)return t(r);if("object"!=typeof n)return t(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));nO(n,!0);try{if(e.filter){const t=Nt(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const r=n.features.filter((e=>t.value.evaluate({zoom:0},e)));n={type:"FeatureCollection",features:r}}e.geojsonVtOptions.epsgCode=e.epsgCode,this._geoJSONIndex=e.cluster?new vO(function({superclusterOptions:e,clusterProperties:t}){if(!t||!e)return e;const r={},n={},i={accumulated:null,zoom:0},o={properties:null},s=Object.keys(t);for(const e of s){const[i,o]=t[e],s=Nt(o),a=Nt("string"==typeof i?[i,["accumulated"],["get",e]]:i);r[e]=s.value,n[e]=a.value}return e.map=e=>{o.properties=e;const t={};for(const e of s)t[e]=r[e].evaluate(i,o);return t},e.reduce=(e,t)=>{o.properties=t;for(const t of s)i.accumulated=e[t],e[t]=n[t].evaluate(i,o)},e}(e)).load(n.features):function(e,t){return new rD(e,t)}(n,e.geojsonVtOptions)}catch(r){return t(r)}this.loaded={};t(null,{})}))}reloadTile(e,t){const r=this.loaded,n=e.uid;return r&&r[n]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(e,t){if(e.request)!function(e,t){Tl(ul(e,{type:"json"}),t)}(e.request,t);else{if("string"!=typeof e.data)return t(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return t(null,JSON.parse(e.data))}catch(r){return t(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class sD{constructor(e){this.self=e,this.actor=new Dl(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.coordinateReferenceSystems={},this.defaultProjection=wI({name:"mercator"}),this.defaultCrs=rI.EPSG3857,this.webgpu=!1,this.workerSourceTypes={vector:rO,geojson:oD},this.workerSources={},this.demWorkerSources={}}clearCaches(e,t,r){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],r()}checkIfReady(e,t,r){r()}setReferrer(e,t){this.referrer=t}spriteLoaded(e,t){this.isSpriteLoaded[e]=t;for(const r in this.workerSources[e]){const n=this.workerSources[e][r];for(const e in n)n[e]instanceof rO&&(n[e].isSpriteLoaded=t,n[e].fire(new Nl("isSpriteLoaded")))}}setImages(e,t,r){this.availableImages[e]=t,r()}enableTerrain(e,t,r){this.terrain=t,r()}setProjection(e,t){this.projections[e]=wI(t)}setCrs(e,t){let r=rI.fromEpsgCode(t.epsgCode,t.WKT,t.extent);r.extent[2]==t.extent[2]&&r.extent[3]==t.extent[3]||(r=new rI(t.epsgCode,t.extent)),this.coordinateReferenceSystems[e]=r,this.setSceneMode(e,t.sceneMode)}setSceneMode(e,t){this.coordinateReferenceSystems[e].sceneMode=t}setLayers(e,t,r){this.getLayerIndex(e).replace(t),r()}updateLayers(e,t,r){this.getLayerIndex(e).update(t.layers,t.removedIds),r()}loadTile(e,t,r){const n=t;n.projection=this.projections[e]||this.defaultProjection,n.crs=this.coordinateReferenceSystems[e]||this.defaultCrs,n.webgpu=this.webgpu,this.getWorkerSource(e,t.type,t.source).loadTile(n,r)}reloadTile(e,t,r){const n=t;n.projection=this.projections[e]||this.defaultProjection,n.crs=this.coordinateReferenceSystems[e]||this.defaultCrs,n.webgpu=this.webgpu,this.getWorkerSource(e,t.type,t.source).reloadTile(t,r)}abortTile(e,t,r){this.getWorkerSource(e,t.type,t.source).abortTile(t,r)}removeTile(e,t,r){this.getWorkerSource(e,t.type,t.source).removeTile(t,r)}removeSource(e,t,r){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;const n=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==n.removeSource?n.removeSource(t,r):r()}loadWorkerSource(e,t,r){try{this.self.importScripts(t.url),r()}catch(e){r(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new mR),t}getWorkerSource(e,t,r){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][r]){const n={send:(t,r,n)=>{this.actor.send(t,r,n,e)}};this.workerSourceTypes[t]||console.log("no "+t),this.workerSources[e][t][r]=new this.workerSourceTypes[t](n,this.getLayerIndex(e),this.getAvailableImages(e),this.isSpriteLoaded[e])}return this.workerSources[e][t][r]}enforceCacheSizeLimit(e,t){}setUseWebgpu(e,t){this.webgpu=t}}"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new sD(self))}));
