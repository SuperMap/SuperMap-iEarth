import{a as Te}from"./chunk-XYWAVEQ2.js";import{a as te,b as ne}from"./chunk-MPSLJKIO.js";import{a as be}from"./chunk-UWLNAHLB.js";import{a as j}from"./chunk-RYEDLSXB.js";import{a as B}from"./chunk-6XL2J7NU.js";import{a as X}from"./chunk-SP6GVFX5.js";import{b as le}from"./chunk-LA5E7NVT.js";import{a as ge,b as I}from"./chunk-5MCHN7YC.js";import"./chunk-D45ASFTR.js";import"./chunk-6X6ULKRC.js";import{a as ie}from"./chunk-UPTNMXYL.js";import{a as Ae}from"./chunk-JV52GS34.js";import"./chunk-MQMYX2JZ.js";import"./chunk-KW5QJXXE.js";import"./chunk-5YCA7L25.js";import"./chunk-4J7EQ5UP.js";import{a as se}from"./chunk-44AFRGCG.js";import"./chunk-UIA2BV6O.js";import{d as He,g as fe,k as _e,l as J}from"./chunk-CWROUHP4.js";import"./chunk-NPAFDOYL.js";import"./chunk-F5UB2CPM.js";import{a as Z}from"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import{a as V}from"./chunk-KJYJTW2V.js";import"./chunk-6NA2GRXE.js";import"./chunk-EHDXVZQM.js";import{a as pe}from"./chunk-NLYLRNUA.js";import{a as ue,b as F}from"./chunk-7TOCOFC3.js";import"./chunk-ZVKIUA3Y.js";import{b as x}from"./chunk-3HZNWEV7.js";import{a as s}from"./chunk-LBR6REQR.js";import{a as O}from"./chunk-GXFCHGTA.js";import{a as T}from"./chunk-UBHQMGET.js";import{a as K}from"./chunk-EDZQSM3T.js";import{a as ve}from"./chunk-PJGSCWXZ.js";import{a as R}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";var Le=new x,Ne=new x;function Se(e,r,a,i){var t=i.cartesianToCartographic(e,Le),c=t.height,u=i.cartesianToCartographic(r,Ne);u.height=c,i.cartographicToCartesian(u,r);var h=i.cartesianToCartographic(a,Ne);h.height=c-100,i.cartographicToCartesian(h,a)}var Ve=new be,Be=new s,ke=new s,ze=new s,Ue=new s,je=new s,Ye=new s,me=new s,Q=new s,ee=new s,We=new ue,Me=new ue,Qe=new s,De=new fe,qe=new V,Ke=new V;function de(e){var r=e.vertexFormat,a=e.geometry,i=e.shadowVolume,t=a.attributes.position.values,c=t.length,u=e.wall,h=e.top||u,f=e.bottom||u;if(r.st||r.normal||r.tangent||r.bitangent||i){var _=e.boundingRectangle,l=e.tangentPlane,o=e.ellipsoid,P=e.stRotation,N=e.perPositionHeight,H=We;H.x=_.x,H.y=_.y;var L=e.isComputeTexCoord?new Float32Array(c):new Float32Array(2*(c/3)),m=r.st?L:void 0,g;r.normal&&(N&&h&&!u?g=a.attributes.normal.values:g=new Float32Array(c));var d=r.tangent?new Float32Array(c):void 0,D=r.bitangent?new Float32Array(c):void 0,y=i?new Float32Array(c):void 0,A=0,w=0,v=ke,n=ze,E=Ue,k=!0,b=qe,C=Ke;if(P!==0){var q=fe.fromAxisAngle(l._plane.normal,P,De);b=V.fromQuaternion(q,b),q=fe.fromAxisAngle(l._plane.normal,-P,De),C=V.fromQuaternion(q,C)}else b=V.clone(V.IDENTITY,b),C=V.clone(V.IDENTITY,C);var p=0,S=0;h&&f&&(p=c/2,S=c/3,c/=2);for(var W=0;W<c;W+=3){var M=s.fromArray(t,W,Qe);if(r.st){var oe=V.multiplyByVector(b,M,Be);oe=o.scaleToGeodeticSurface(oe,oe);var ce=l.projectPointOntoPlane(oe,Me);ue.subtract(ce,H,ce);var we=O.clamp(ce.x/_.width,0,1),Pe=O.clamp(ce.y/_.height,0,1);f&&(m[A+S]=we,m[A+1+S]=Pe),h&&(m[A]=we,m[A+1]=Pe),A+=2}if(r.normal||r.tangent||r.bitangent||i){var z=w+1,U=w+2;if(u){if(W+3<c){var ae=s.fromArray(t,W+3,je);if(k){var he=s.fromArray(t,W+c,Ye);N&&Se(M,ae,he,o),s.subtract(ae,M,ae),s.subtract(he,M,he),v=s.normalize(s.cross(he,ae,v),v),k=!1}s.equalsEpsilon(ae,M,O.EPSILON10)&&(k=!0)}(r.tangent||r.bitangent)&&(E=o.geodeticSurfaceNormal(M,E),r.tangent&&(n=s.normalize(s.cross(E,v,n),n)))}else v=o.geodeticSurfaceNormal(M,v),(r.tangent||r.bitangent)&&(N&&(me=s.fromArray(g,w,me),Q=s.cross(s.UNIT_Z,me,Q),Q=s.normalize(V.multiplyByVector(C,Q,Q),Q),r.bitangent&&(ee=s.normalize(s.cross(me,Q,ee),ee))),n=s.cross(s.UNIT_Z,v,n),n=s.normalize(V.multiplyByVector(C,n,n),n),r.bitangent&&(E=s.normalize(s.cross(v,n,E),E)));r.normal&&(e.wall?(g[w+p]=v.x,g[z+p]=v.y,g[U+p]=v.z):f&&(g[w+p]=-v.x,g[z+p]=-v.y,g[U+p]=-v.z),(h&&!N||u)&&(g[w]=v.x,g[z]=v.y,g[U]=v.z)),i&&(u&&(v=o.geodeticSurfaceNormal(M,v)),y[w+p]=-v.x,y[z+p]=-v.y,y[U+p]=-v.z),r.tangent&&(e.wall?(d[w+p]=n.x,d[z+p]=n.y,d[U+p]=n.z):f&&(d[w+p]=-n.x,d[z+p]=-n.y,d[U+p]=-n.z),h&&(N?(d[w]=Q.x,d[z]=Q.y,d[U]=Q.z):(d[w]=n.x,d[z]=n.y,d[U]=n.z))),r.bitangent&&(f&&(D[w+p]=E.x,D[z+p]=E.y,D[U+p]=E.z),h&&(N?(D[w]=ee.x,D[z]=ee.y,D[U]=ee.z):(D[w]=E.x,D[z]=E.y,D[U]=E.z))),w+=3}}r.st&&(a.attributes.st=new J({componentDatatype:Z.FLOAT,componentsPerAttribute:2,values:m})),r.normal&&(a.attributes.normal=new J({componentDatatype:Z.FLOAT,componentsPerAttribute:3,values:g})),r.tangent&&(a.attributes.tangent=new J({componentDatatype:Z.FLOAT,componentsPerAttribute:3,values:d})),r.bitangent&&(a.attributes.bitangent=new J({componentDatatype:Z.FLOAT,componentsPerAttribute:3,values:D})),i&&(a.attributes.extrudeDirection=new J({componentDatatype:Z.FLOAT,componentsPerAttribute:3,values:y}))}if(e.extrude&&R(e.offsetAttribute)){var Ee=t.length/3,G=new Uint8Array(Ee);if(e.offsetAttribute===ne.TOP)h&&f||u?G=te(G,1,0,Ee/2):h&&(G=te(G,1));else{var Re=e.offsetAttribute===ne.NONE?0:1;G=te(G,Re)}a.attributes.applyOffset=new J({componentDatatype:Z.UNSIGNED_BYTE,componentsPerAttribute:1,values:G})}return a}var Ze=new x,Je=new x,$={westOverIDL:0,eastOverIDL:0},re=new Te;function Ce(e,r,a,i,t){if(t=T(t,new pe),!R(e)||e.length<3)return t.west=0,t.north=0,t.south=0,t.east=0,t;if(a===X.RHUMB)return pe.fromCartesianArray(e,r,t);re.ellipsoid.equals(r)||(re=new Te(void 0,void 0,r)),t.west=Number.POSITIVE_INFINITY,t.east=Number.NEGATIVE_INFINITY,t.south=Number.POSITIVE_INFINITY,t.north=Number.NEGATIVE_INFINITY,$.westOverIDL=Number.POSITIVE_INFINITY,$.eastOverIDL=Number.NEGATIVE_INFINITY;for(var c=1/O.chordLength(i,r.maximumRadius),u=e.length,h=r.cartesianToCartographic(e[0],Je),f=Ze,_,l=1;l<u;l++)_=f,f=h,h=r.cartesianToCartographic(e[l],_),re.setEndPoints(f,h),Oe(re,c,t,$);return _=f,f=h,h=r.cartesianToCartographic(e[0],_),re.setEndPoints(f,h),Oe(re,c,t,$),t.east-t.west>$.eastOverIDL-$.westOverIDL&&(t.west=$.westOverIDL,t.east=$.eastOverIDL,t.east>O.PI&&(t.east=t.east-O.TWO_PI),t.west>O.PI&&(t.west=t.west-O.TWO_PI)),t}var Xe=new x;function Oe(e,r,a,i){for(var t=e.surfaceDistance,c=Math.ceil(t*r),u=c>0?t/(c-1):Number.POSITIVE_INFINITY,h=0,f=0;f<c;f++){var _=e.interpolateUsingSurfaceDistance(h,Xe);h+=u;var l=_.longitude,o=_.latitude;a.west=Math.min(a.west,l),a.east=Math.max(a.east,l),a.south=Math.min(a.south,o),a.north=Math.max(a.north,o);let P=l>=0?l:l+O.TWO_PI;i.westOverIDL=Math.min(i.westOverIDL,P),i.eastOverIDL=Math.max(i.eastOverIDL,P)}}var Fe=[];function $e(e,r,a,i,t,c,u,h,f,_){var l={walls:[]},o;if(c||u){var P=B.createGeometryFromPositions(e,r,a,t,h,f),N=P.attributes.position.values,H=P.indices,L,m;if(c&&u){var g=N.concat(N);L=g.length/3,m=se.createTypedArray(L,H.length*2),m.set(H);var d=H.length,D=L/2;for(o=0;o<d;o+=3){var y=m[o]+D,A=m[o+1]+D,w=m[o+2]+D;m[o+d]=w,m[o+1+d]=A,m[o+2+d]=y}if(P.attributes.position.values=g,t&&h.normal){var v=P.attributes.normal.values;P.attributes.normal.values=new Float32Array(g.length),P.attributes.normal.values.set(v)}P.indices=m}else if(u){for(L=N.length/3,m=se.createTypedArray(L,H.length),o=0;o<H.length;o+=3)m[o]=H[o+2],m[o+1]=H[o+1],m[o+2]=H[o];P.indices=m}l.topAndBottom=new ie({geometry:P})}var n=i.outerRing,E=le.fromPoints(n,e),k=E.projectPointsOntoPlane(n,Fe),b=I.computeWindingOrder2D(k);b===ge.CLOCKWISE&&(n=n.slice().reverse());var C;_&&(C=B.computeWallGeometry(n,e,a,t,f),l.walls.push(new ie({geometry:C})));var q=i.holes;for(o=0;o<q.length;o++){var p=q[o];E=le.fromPoints(p,e),k=E.projectPointsOntoPlane(p,Fe),b=I.computeWindingOrder2D(k),b===ge.COUNTER_CLOCKWISE&&(p=p.slice().reverse()),C=B.computeWallGeometry(p,e,a,t,f),l.walls.push(new ie({geometry:C}))}return l}function Y(e){if(K.typeOf.object("options",e),K.typeOf.object("options.polygonHierarchy",e.polygonHierarchy),R(e.perPositionHeight)&&e.perPositionHeight&&R(e.height))throw new ve("Cannot use both options.perPositionHeight and options.height");if(R(e.arcType)&&e.arcType!==X.GEODESIC&&e.arcType!==X.RHUMB)throw new ve("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var r=e.polygonHierarchy,a=T(e.vertexFormat,j.DEFAULT),i=T(e.ellipsoid,F.WGS84),t=T(e.granularity,O.RADIANS_PER_DEGREE),c=T(e.stRotation,0),u=T(e.perPositionHeight,!1),h=u&&R(e.extrudedHeight),f=T(e.height,0),_=T(e.extrudedHeight,f);if(!h){var l=Math.max(f,_);_=Math.min(f,_),f=l}this._vertexFormat=j.clone(a),this._ellipsoid=F.clone(i),this._granularity=t,this._stRotation=c,this._height=f,this._extrudedHeight=_,this._closeTop=T(e.closeTop,!0),this._closeBottom=T(e.closeBottom,!0),this._extrudeOutering=T(e.extrudeOutering,!0),this._polygonHierarchy=r,this._perPositionHeight=u,this._perPositionHeightExtrude=h,this._shadowVolume=T(e.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=e.offsetAttribute,this._arcType=T(e.arcType,X.GEODESIC),this._groundBottomAltitude=T(e.groundBottomAltitude,0),this._groundExtrudedHeight=T(e.groundExtrudedHeight,0),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=B.computeHierarchyPackedLength(r)+F.packedLength+j.packedLength+12}Y.fromPositions=function(e){e=T(e,T.EMPTY_OBJECT),K.defined("options.positions",e.positions);var r={polygonHierarchy:{positions:e.positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType};return new Y(r)};Y.pack=function(e,r,a){return K.typeOf.object("value",e),K.defined("array",r),a=T(a,0),a=B.packPolygonHierarchy(e._polygonHierarchy,r,a),F.pack(e._ellipsoid,r,a),a+=F.packedLength,j.pack(e._vertexFormat,r,a),a+=j.packedLength,r[a++]=e._height,r[a++]=e._extrudedHeight,r[a++]=e._granularity,r[a++]=e._stRotation,r[a++]=e._perPositionHeightExtrude?1:0,r[a++]=e._perPositionHeight?1:0,r[a++]=e._closeTop?1:0,r[a++]=e._closeBottom?1:0,r[a++]=e._shadowVolume?1:0,r[a++]=T(e._offsetAttribute,-1),r[a++]=e._arcType,r[a]=e.packedLength,r};var Ge=F.clone(F.UNIT_SPHERE),xe=new j,Ie={polygonHierarchy:{}};Y.unpack=function(e,r,a){K.defined("array",e),r=T(r,0);var i=B.unpackPolygonHierarchy(e,r);r=i.startingIndex,delete i.startingIndex;var t=F.unpack(e,r,Ge);r+=F.packedLength;var c=j.unpack(e,r,xe);r+=j.packedLength;var u=e[r++],h=e[r++],f=e[r++],_=e[r++],l=e[r++]===1,o=e[r++]===1,P=e[r++]===1,N=e[r++]===1,H=e[r++]===1,L=e[r++],m=e[r++],g=e[r];return R(a)||(a=new Y(Ie)),a._polygonHierarchy=i,a._ellipsoid=F.clone(t,a._ellipsoid),a._vertexFormat=j.clone(c,a._vertexFormat),a._height=u,a._extrudedHeight=h,a._granularity=f,a._stRotation=_,a._perPositionHeightExtrude=l,a._perPositionHeight=o,a._closeTop=P,a._closeBottom=N,a._shadowVolume=H,a._offsetAttribute=L===-1?void 0:L,a._arcType=m,a.packedLength=g,a};Y.computeRectangle=function(e,r){K.typeOf.object("options",e),K.typeOf.object("options.polygonHierarchy",e.polygonHierarchy);var a=T(e.granularity,O.RADIANS_PER_DEGREE),i=T(e.arcType,X.GEODESIC);if(i!==X.GEODESIC&&i!==X.RHUMB)throw new ve("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var t=e.polygonHierarchy,c=T(e.ellipsoid,F.WGS84);return Ce(t.positions,c,i,a,r)};Y.createGeometry=function(e){var r=e._vertexFormat,a=e._ellipsoid,i=e._granularity,t=e._stRotation,c=e._polygonHierarchy,u=e._perPositionHeight,h=e._closeTop,f=e._closeBottom,_=e._arcType,l=c.positions;if(!(l.length<3)){var o=le.fromPoints(l,a),P=B.polygonsFromHierarchy(c,o.projectPointsOntoPlane.bind(o),!u,a),N=P.hierarchy,H=P.polygons;if(N.length!==0){l=N[0].outerRing;var L=B.computeBoundingRectangle(o.plane.normal,o.projectPointOntoPlane.bind(o),l,t,Ve),m=[],g=e._height,d=e._extrudedHeight,D=e._perPositionHeightExtrude||!O.equalsEpsilon(g,d,0,O.EPSILON2),y={perPositionHeight:u,vertexFormat:r,geometry:void 0,tangentPlane:o,boundingRectangle:L,ellipsoid:a,stRotation:t,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:_},A;if(D)for(y.extrude=!0,y.top=h,y.bottom=f,y.shadowVolume=e._shadowVolume,y.offsetAttribute=e._offsetAttribute,A=0;A<H.length;A++){var w=$e(a,H[A],i,N[A],u,h,f,r,_,e._extrudeOutering),v;h&&f?(v=w.topAndBottom,y.geometry=B.scaleToGeodeticHeightExtruded(v.geometry,g,d,a,u)):h?(v=w.topAndBottom,v.geometry.attributes.position.values=I.scaleToGeodeticHeight(v.geometry.attributes.position.values,g,a,!u),y.geometry=v.geometry):f&&(v=w.topAndBottom,v.geometry.attributes.position.values=I.scaleToGeodeticHeight(v.geometry.attributes.position.values,d,a,!0),y.geometry=v.geometry),(h||f)&&(y.wall=!1,v.geometry=de(y),m.push(v));var n=w.walls;y.wall=!0;for(var E=0;E<n.length;E++){var k=n[E];y.geometry=B.scaleToGeodeticHeightExtruded(k.geometry,g,d,a,u),k.geometry=de(y),m.push(k)}}else for(A=0;A<H.length;A++){var b=new ie({geometry:B.createGeometryFromPositions(a,H[A],i,u,r,_)});if(b.geometry.attributes.position.values=I.scaleToGeodeticHeight(b.geometry.attributes.position.values,g,a,!u),y.geometry=b.geometry,b.geometry=de(y),R(e._offsetAttribute)){var C=b.geometry.attributes.position.values.length,q=new Uint8Array(C/3),p=e._offsetAttribute===ne.NONE?0:1;te(q,p),b.geometry.attributes.applyOffset=new J({componentDatatype:Z.UNSIGNED_BYTE,componentsPerAttribute:1,values:q})}m.push(b)}var S=Ae.combineInstances(m)[0];S.attributes.position.values=new Float64Array(S.attributes.position.values),S.indices=se.createTypedArray(S.attributes.position.values.length/3,S.indices);var W=S.attributes,M=He.fromVertices(W.position.values);return r.position||delete W.position,new _e({attributes:W,indices:S.indices,primitiveType:S.primitiveType,boundingSphere:M,offsetAttribute:e._offsetAttribute})}}};Y.createShadowVolume=function(e,r,a){var i=e._granularity,t=e._ellipsoid,c=e._groundBottomAltitude+e._groundExtrudedHeight,u=e._groundBottomAltitude?e._groundBottomAltitude:r(i,t),h=c!==e._groundBottomAltitude?c:a(i,t);return new Y({polygonHierarchy:e._polygonHierarchy,ellipsoid:t,stRotation:e._stRotation,granularity:i,perPositionHeight:!1,extrudedHeight:u,height:h,vertexFormat:j.POSITION_ONLY,shadowVolume:!e._groundBottomAltitude,arcType:e._arcType})};function er(e){var r=-e._stRotation;if(r===0)return[0,0,0,1,1,0];var a=e._ellipsoid,i=e._polygonHierarchy.positions,t=e.rectangle;return _e._textureCoordinateRotationPoints(i,r,a,t)}Object.defineProperties(Y.prototype,{rectangle:{get:function(){if(!R(this._rectangle)){var e=this._polygonHierarchy.positions;this._rectangle=Ce(e,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return R(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=er(this)),this._textureCoordinateRotationPoints}}});var ye=Y;function rr(e,r){return R(r)&&(e=ye.unpack(e,r)),e._ellipsoid=F.clone(e._ellipsoid),ye.createGeometry(e)}var Vr=rr;export{Vr as default};
