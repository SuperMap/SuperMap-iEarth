define(["./when-39df26e1","./Cartesian2-59a54ee7","./ArcType-31298545","./arrayFill-9b55d6b2","./BoundingRectangle-2b853aa7","./buildModuleUrl-1b968a9d","./Cartographic-81e9e8b2","./Check-ff445961","./ComponentDatatype-7d28dd1c","./EllipsoidGeodesic-840abdf5","./EllipsoidTangentPlane-ee91c10e","./GeometryAttribute-9b3921a3","./GeometryInstance-67860833","./GeometryOffsetAttribute-b4d599f5","./GeometryPipeline-91e3b4f0","./IndexDatatype-be421fbf","./Math-5e067eb3","./FeatureDetection-2d4141ff","./PolygonGeometryLibrary-5c2a3058","./PolygonPipeline-ae195f4e","./VertexFormat-79ab0d67","./Event-e109b23e","./RuntimeError-251a1d8d","./WebGLConstants-42651efd","./Cartesian4-a56bd360","./IntersectionTests-036daea1","./Plane-775a5120","./AttributeCompression-4cf880dc","./EncodedCartesian3-003b996c","./arrayRemoveDuplicates-3deab545","./EllipsoidRhumbLine-61b02483","./GeometryAttributes-11421d3c"],(function(t,e,o,r,i,n,a,s,l,u,p,c,g,d,y,h,m,f,v,_,b,w,T,A,P,x,E,I,H,N,O,C){"use strict";var R=new a.a,D=new a.a;function F(t,e,o,r){var i=r.cartesianToCartographic(t,R).height,n=r.cartesianToCartographic(e,D);n.height=i,r.cartographicToCartesian(n,e);var a=r.cartesianToCartographic(o,D);a.height=i-100,r.cartographicToCartesian(a,o)}var G=new i.f,L=new a.o,B=new a.o,S=new a.o,V=new a.o,k=new a.o,z=new a.o,M=new a.o,U=new a.o,Y=new a.o,j=new e.o,W=new e.o,$=new a.o,q=new c.n,K=new f.p$1,Q=new f.p$1;function Z(o){var i=o.vertexFormat,n=o.geometry,s=o.shadowVolume,u=n.attributes.position.values,p=u.length,g=o.wall,y=o.top||g,h=o.bottom||g;if(i.st||i.normal||i.tangent||i.bitangent||s){var v=o.boundingRectangle,_=o.tangentPlane,b=o.ellipsoid,w=o.stRotation,T=o.perPositionHeight,A=j;A.x=v.x,A.y=v.y;var P,x=o.isComputeTexCoord?new Float32Array(p):new Float32Array(p/3*2),E=i.st?x:void 0;i.normal&&(P=T&&y&&!g?n.attributes.normal.values:new Float32Array(p));var I=i.tangent?new Float32Array(p):void 0,H=i.bitangent?new Float32Array(p):void 0,N=s?new Float32Array(p):void 0,O=0,C=0,R=B,D=S,G=V,Z=!0,J=K,X=Q;if(0!==w){var tt=c.n.fromAxisAngle(_._plane.normal,w,q);J=f.p$1.fromQuaternion(tt,J),tt=c.n.fromAxisAngle(_._plane.normal,-w,q),X=f.p$1.fromQuaternion(tt,X)}else J=f.p$1.clone(f.p$1.IDENTITY,J),X=f.p$1.clone(f.p$1.IDENTITY,X);var et=0,ot=0;y&&h&&(et=p/2,ot=p/3,p/=2);for(var rt=0;rt<p;rt+=3){var it=a.o.fromArray(u,rt,$);if(i.st){var nt=f.p$1.multiplyByVector(J,it,L);nt=b.scaleToGeodeticSurface(nt,nt);var at=_.projectPointOntoPlane(nt,W);e.o.subtract(at,A,at);var st=m.e.clamp(at.x/v.width,0,1),lt=m.e.clamp(at.y/v.height,0,1);h&&(E[O+ot]=st,E[O+1+ot]=lt),y&&(E[O]=st,E[O+1]=lt),O+=2}if(i.normal||i.tangent||i.bitangent||s){var ut=C+1,pt=C+2;if(g){if(rt+3<p){var ct=a.o.fromArray(u,rt+3,k);if(Z){var gt=a.o.fromArray(u,rt+p,z);T&&F(it,ct,gt,b),a.o.subtract(ct,it,ct),a.o.subtract(gt,it,gt),R=a.o.normalize(a.o.cross(gt,ct,R),R),Z=!1}a.o.equalsEpsilon(ct,it,m.e.EPSILON10)&&(Z=!0)}(i.tangent||i.bitangent)&&(G=b.geodeticSurfaceNormal(it,G),i.tangent&&(D=a.o.normalize(a.o.cross(G,R,D),D)))}else R=b.geodeticSurfaceNormal(it,R),(i.tangent||i.bitangent)&&(T&&(M=a.o.fromArray(P,C,M),U=a.o.cross(a.o.UNIT_Z,M,U),U=a.o.normalize(f.p$1.multiplyByVector(X,U,U),U),i.bitangent&&(Y=a.o.normalize(a.o.cross(M,U,Y),Y))),D=a.o.cross(a.o.UNIT_Z,R,D),D=a.o.normalize(f.p$1.multiplyByVector(X,D,D),D),i.bitangent&&(G=a.o.normalize(a.o.cross(R,D,G),G)));i.normal&&(o.wall?(P[C+et]=R.x,P[ut+et]=R.y,P[pt+et]=R.z):h&&(P[C+et]=-R.x,P[ut+et]=-R.y,P[pt+et]=-R.z),(y&&!T||g)&&(P[C]=R.x,P[ut]=R.y,P[pt]=R.z)),s&&(g&&(R=b.geodeticSurfaceNormal(it,R)),N[C+et]=-R.x,N[ut+et]=-R.y,N[pt+et]=-R.z),i.tangent&&(o.wall?(I[C+et]=D.x,I[ut+et]=D.y,I[pt+et]=D.z):h&&(I[C+et]=-D.x,I[ut+et]=-D.y,I[pt+et]=-D.z),y&&(T?(I[C]=U.x,I[ut]=U.y,I[pt]=U.z):(I[C]=D.x,I[ut]=D.y,I[pt]=D.z))),i.bitangent&&(h&&(H[C+et]=G.x,H[ut+et]=G.y,H[pt+et]=G.z),y&&(T?(H[C]=Y.x,H[ut]=Y.y,H[pt]=Y.z):(H[C]=G.x,H[ut]=G.y,H[pt]=G.z))),C+=3}}i.st&&(n.attributes.st=new c.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:E})),i.normal&&(n.attributes.normal=new c.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P})),i.tangent&&(n.attributes.tangent=new c.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:I})),i.bitangent&&(n.attributes.bitangent=new c.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:H})),s&&(n.attributes.extrudeDirection=new c.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:N}))}if(o.extrude&&t.e(o.offsetAttribute)){var dt=u.length/3,yt=new Uint8Array(dt);if(o.offsetAttribute===d.z.TOP)y&&h||g?yt=r.d(yt,1,0,dt/2):y&&(yt=r.d(yt,1));else{var ht=o.offsetAttribute===d.z.NONE?0:1;yt=r.d(yt,ht)}n.attributes.applyOffset=new c.o({componentDatatype:l.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:yt})}return n}var J=new a.a,X=new a.a,tt={west:0,east:0},et=new u.E;function ot(r,i,n,a,s){if(s=t.u(s,new e.h),!t.e(r)||r.length<3)return s.west=0,s.north=0,s.south=0,s.east=0,s;if(n===o.L.RHUMB)return e.h.fromCartesianArray(r,i,s);et.ellipsoid.equals(i)||(et=new u.E(void 0,void 0,i)),s.west=Number.POSITIVE_INFINITY,s.east=Number.NEGATIVE_INFINITY,s.south=Number.POSITIVE_INFINITY,s.north=Number.NEGATIVE_INFINITY,tt.west=Number.POSITIVE_INFINITY,tt.east=Number.NEGATIVE_INFINITY;for(var l,p=1/m.e.chordLength(a,i.maximumRadius),c=r.length,g=i.cartesianToCartographic(r[0],X),d=J,y=1;y<c;y++)l=d,d=g,g=i.cartesianToCartographic(r[y],l),et.setEndPoints(d,g),it(et,p,s,tt);return l=d,d=g,g=i.cartesianToCartographic(r[0],l),et.setEndPoints(d,g),it(et,p,s,tt),s.east-s.west>tt.west-tt.east&&(s.east=tt.east,s.west=tt.west),s}var rt=new a.a;function it(t,e,o,r){for(var i=t.surfaceDistance,n=Math.ceil(i*e),a=n>0?i/(n-1):Number.POSITIVE_INFINITY,s=0,l=0;l<n;l++){var u=t.interpolateUsingSurfaceDistance(s,rt);s+=a;var p=u.longitude,c=u.latitude;o.west=Math.min(o.west,p),o.east=Math.max(o.east,p),o.south=Math.min(o.south,c),o.north=Math.max(o.north,c),r.west=p>0?Math.min(p,r.west):r.west,r.east=p<0?Math.max(p,r.east):r.east}}var nt=[];function at(t,e,o,r,i,n,a,s,l,u){var c,d={walls:[]};if(n||a){var y,m,f=v.y.createGeometryFromPositions(t,e,o,i,s,l),b=f.attributes.position.values,w=f.indices;if(n&&a){var T=b.concat(b);y=T.length/3,(m=h.IndexDatatype.createTypedArray(y,2*w.length)).set(w);var A=w.length,P=y/2;for(c=0;c<A;c+=3){var x=m[c]+P,E=m[c+1]+P,I=m[c+2]+P;m[c+A]=I,m[c+1+A]=E,m[c+2+A]=x}if(f.attributes.position.values=T,i&&s.normal){var H=f.attributes.normal.values;f.attributes.normal.values=new Float32Array(T.length),f.attributes.normal.values.set(H)}f.indices=m}else if(a){for(y=b.length/3,m=h.IndexDatatype.createTypedArray(y,w.length),c=0;c<w.length;c+=3)m[c]=w[c+2],m[c+1]=w[c+1],m[c+2]=w[c];f.indices=m}d.topAndBottom=new g.d({geometry:f})}var N,O=r.outerRing,C=p.f.fromPoints(O,t),R=C.projectPointsOntoPlane(O,nt),D=_.A.computeWindingOrder2D(R);D===_.W.CLOCKWISE&&(O=O.slice().reverse()),u&&(N=v.y.computeWallGeometry(O,t,o,i,l),d.walls.push(new g.d({geometry:N})));var F=r.holes;for(c=0;c<F.length;c++){var G=F[c];R=(C=p.f.fromPoints(G,t)).projectPointsOntoPlane(G,nt),(D=_.A.computeWindingOrder2D(R))===_.W.COUNTER_CLOCKWISE&&(G=G.slice().reverse()),N=v.y.computeWallGeometry(G,t,o,i,l),d.walls.push(new g.d({geometry:N}))}return d}function st(r){if(s.o.typeOf.object("options",r),s.o.typeOf.object("options.polygonHierarchy",r.polygonHierarchy),t.e(r.perPositionHeight)&&r.perPositionHeight&&t.e(r.height))throw new s.t("Cannot use both options.perPositionHeight and options.height");if(t.e(r.arcType)&&r.arcType!==o.L.GEODESIC&&r.arcType!==o.L.RHUMB)throw new s.t("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var i=r.polygonHierarchy,n=t.u(r.vertexFormat,b.n.DEFAULT),a=t.u(r.ellipsoid,e.t.WGS84),l=t.u(r.granularity,m.e.RADIANS_PER_DEGREE),u=t.u(r.stRotation,0),p=t.u(r.perPositionHeight,!1),c=p&&t.e(r.extrudedHeight),g=t.u(r.height,0),d=t.u(r.extrudedHeight,g);if(!c){var y=Math.max(g,d);d=Math.min(g,d),g=y}this._vertexFormat=b.n.clone(n),this._ellipsoid=e.t.clone(a),this._granularity=l,this._stRotation=u,this._height=g,this._extrudedHeight=d,this._closeTop=t.u(r.closeTop,!0),this._closeBottom=t.u(r.closeBottom,!0),this._extrudeOutering=t.u(r.extrudeOutering,!0),this._polygonHierarchy=i,this._perPositionHeight=p,this._perPositionHeightExtrude=c,this._shadowVolume=t.u(r.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=r.offsetAttribute,this._arcType=t.u(r.arcType,o.L.GEODESIC),this._groundBottomAltitude=t.u(r.groundBottomAltitude,0),this._groundExtrudedHeight=t.u(r.groundExtrudedHeight,0),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=v.y.computeHierarchyPackedLength(i)+e.t.packedLength+b.n.packedLength+12}st.fromPositions=function(e){return e=t.u(e,t.u.EMPTY_OBJECT),s.o.defined("options.positions",e.positions),new st({polygonHierarchy:{positions:e.positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType})},st.pack=function(o,r,i){return s.o.typeOf.object("value",o),s.o.defined("array",r),i=t.u(i,0),i=v.y.packPolygonHierarchy(o._polygonHierarchy,r,i),e.t.pack(o._ellipsoid,r,i),i+=e.t.packedLength,b.n.pack(o._vertexFormat,r,i),i+=b.n.packedLength,r[i++]=o._height,r[i++]=o._extrudedHeight,r[i++]=o._granularity,r[i++]=o._stRotation,r[i++]=o._perPositionHeightExtrude?1:0,r[i++]=o._perPositionHeight?1:0,r[i++]=o._closeTop?1:0,r[i++]=o._closeBottom?1:0,r[i++]=o._shadowVolume?1:0,r[i++]=t.u(o._offsetAttribute,-1),r[i++]=o._arcType,r[i]=o.packedLength,r};var lt=e.t.clone(e.t.UNIT_SPHERE),ut=new b.n,pt={polygonHierarchy:{}};return st.unpack=function(o,r,i){s.o.defined("array",o),r=t.u(r,0);var n=v.y.unpackPolygonHierarchy(o,r);r=n.startingIndex,delete n.startingIndex;var a=e.t.unpack(o,r,lt);r+=e.t.packedLength;var l=b.n.unpack(o,r,ut);r+=b.n.packedLength;var u=o[r++],p=o[r++],c=o[r++],g=o[r++],d=1===o[r++],y=1===o[r++],h=1===o[r++],m=1===o[r++],f=1===o[r++],_=o[r++],w=o[r++],T=o[r];return t.e(i)||(i=new st(pt)),i._polygonHierarchy=n,i._ellipsoid=e.t.clone(a,i._ellipsoid),i._vertexFormat=b.n.clone(l,i._vertexFormat),i._height=u,i._extrudedHeight=p,i._granularity=c,i._stRotation=g,i._perPositionHeightExtrude=d,i._perPositionHeight=y,i._closeTop=h,i._closeBottom=m,i._shadowVolume=f,i._offsetAttribute=-1===_?void 0:_,i._arcType=w,i.packedLength=T,i},st.computeRectangle=function(r,i){s.o.typeOf.object("options",r),s.o.typeOf.object("options.polygonHierarchy",r.polygonHierarchy);var n=t.u(r.granularity,m.e.RADIANS_PER_DEGREE),a=t.u(r.arcType,o.L.GEODESIC);if(a!==o.L.GEODESIC&&a!==o.L.RHUMB)throw new s.t("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var l=r.polygonHierarchy,u=t.u(r.ellipsoid,e.t.WGS84);return ot(l.positions,u,a,n,i)},st.createGeometry=function(e){var o=e._vertexFormat,i=e._ellipsoid,a=e._granularity,s=e._stRotation,u=e._polygonHierarchy,f=e._perPositionHeight,b=e._closeTop,w=e._closeBottom,T=e._arcType,A=u.positions;if(!(A.length<3)){var P=p.f.fromPoints(A,i),x=v.y.polygonsFromHierarchy(u,P.projectPointsOntoPlane.bind(P),!f,i),E=x.hierarchy,I=x.polygons;if(0!==E.length){A=E[0].outerRing;var H,N=v.y.computeBoundingRectangle(P.plane.normal,P.projectPointOntoPlane.bind(P),A,s,G),O=[],C=e._height,R=e._extrudedHeight,D={perPositionHeight:f,vertexFormat:o,geometry:void 0,tangentPlane:P,boundingRectangle:N,ellipsoid:i,stRotation:s,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:T};if(e._perPositionHeightExtrude||!m.e.equalsEpsilon(C,R,0,m.e.EPSILON2))for(D.extrude=!0,D.top=b,D.bottom=w,D.shadowVolume=e._shadowVolume,D.offsetAttribute=e._offsetAttribute,H=0;H<I.length;H++){var F,L=at(i,I[H],a,E[H],f,b,w,o,T,e._extrudeOutering);b&&w?(F=L.topAndBottom,D.geometry=v.y.scaleToGeodeticHeightExtruded(F.geometry,C,R,i,f)):b?((F=L.topAndBottom).geometry.attributes.position.values=_.A.scaleToGeodeticHeight(F.geometry.attributes.position.values,C,i,!f),D.geometry=F.geometry):w&&((F=L.topAndBottom).geometry.attributes.position.values=_.A.scaleToGeodeticHeight(F.geometry.attributes.position.values,R,i,!0),D.geometry=F.geometry),(b||w)&&(D.wall=!1,F.geometry=Z(D),O.push(F));var B=L.walls;D.wall=!0;for(var S=0;S<B.length;S++){var V=B[S];D.geometry=v.y.scaleToGeodeticHeightExtruded(V.geometry,C,R,i,f),V.geometry=Z(D),O.push(V)}}else for(H=0;H<I.length;H++){var k=new g.d({geometry:v.y.createGeometryFromPositions(i,I[H],a,f,o,T)});if(k.geometry.attributes.position.values=_.A.scaleToGeodeticHeight(k.geometry.attributes.position.values,C,i,!f),D.geometry=k.geometry,k.geometry=Z(D),t.e(e._offsetAttribute)){var z=k.geometry.attributes.position.values.length,M=new Uint8Array(z/3),U=e._offsetAttribute===d.z.NONE?0:1;r.d(M,U),k.geometry.attributes.applyOffset=new c.o({componentDatatype:l.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:M})}O.push(k)}var Y=y.k.combineInstances(O)[0];Y.attributes.position.values=new Float64Array(Y.attributes.position.values),Y.indices=h.IndexDatatype.createTypedArray(Y.attributes.position.values.length/3,Y.indices);var j=Y.attributes,W=n.i.fromVertices(j.position.values);return o.position||delete j.position,new c.I({attributes:j,indices:Y.indices,primitiveType:Y.primitiveType,boundingSphere:W,offsetAttribute:e._offsetAttribute})}}},st.createShadowVolume=function(t,e,o){var r=t._granularity,i=t._ellipsoid,n=t._groundBottomAltitude+t._groundExtrudedHeight,a=t._groundBottomAltitude?t._groundBottomAltitude:e(r,i),s=n!==t._groundBottomAltitude?n:o(r,i);return new st({polygonHierarchy:t._polygonHierarchy,ellipsoid:i,stRotation:t._stRotation,granularity:r,perPositionHeight:!1,extrudedHeight:a,height:s,vertexFormat:b.n.POSITION_ONLY,shadowVolume:!0,arcType:t._arcType})},Object.defineProperties(st.prototype,{rectangle:{get:function(){if(!t.e(this._rectangle)){var e=this._polygonHierarchy.positions;this._rectangle=ot(e,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return t.e(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){var e=-t._stRotation;if(0===e)return[0,0,0,1,1,0];var o=t._ellipsoid,r=t._polygonHierarchy.positions,i=t.rectangle;return c.I._textureCoordinateRotationPoints(r,e,o,i)}(this)),this._textureCoordinateRotationPoints}}}),function(o,r){return t.e(r)&&(o=st.unpack(o,r)),o._ellipsoid=e.t.clone(o._ellipsoid),st.createGeometry(o)}}));
