define(["./when-92c6cf3c","./Cartesian2-b72655a5","./ArcType-31298545","./arrayFill-0358accf","./BoundingRectangle-44af9dd4","./buildModuleUrl-cbcc8c56","./Cartesian3-3a8bdb0b","./Cartographic-a2c313d7","./Check-52a7d806","./ComponentDatatype-98414d16","./EllipsoidGeodesic-03c935a0","./EllipsoidTangentPlane-c500945e","./GeometryAttribute-65cf868d","./GeometryInstance-20be787d","./GeometryOffsetAttribute-b4d599f5","./GeometryPipeline-50805727","./IndexDatatype-86677ec4","./Math-ecf82623","./FeatureDetection-fd297af4","./PolygonGeometryLibrary-eea5d80b","./PolygonPipeline-c329dec3","./VertexFormat-f496a3f1","./Event-3390cd7d","./RuntimeError-c6a62a80","./WebGLConstants-42651efd","./Cartesian4-72b88c9e","./IntersectionTests-9ff29c98","./Plane-a2c6da7b","./AttributeCompression-b5a80a71","./EncodedCartesian3-4f120b1b","./arrayRemoveDuplicates-a6924649","./EllipsoidRhumbLine-b1a766ae","./GeometryAttributes-7f66ea53"],(function(e,t,o,r,a,i,n,s,l,u,p,c,g,d,y,h,m,f,v,_,b,w,T,I,A,P,x,E,O,H,D,N,C){"use strict";var L=new s.a,R=new s.a;function F(e,t,o,r){var a=r.cartesianToCartographic(e,L).height,i=r.cartesianToCartographic(t,R);i.height=a,r.cartographicToCartesian(i,t);var n=r.cartesianToCartographic(o,R);n.height=a-100,r.cartographicToCartesian(n,o)}var G=new a.f,B=new n.o,S=new n.o,V=new n.o,k=new n.o,z=new n.o,M=new n.o,U=new n.o,W=new n.o,Y=new n.o,j=new t.o,$=new t.o,q=new n.o,K=new g.n,Q=new v.p$1,Z=new v.p$1;function J(o){var a=o.vertexFormat,i=o.geometry,s=o.shadowVolume,l=i.attributes.position.values,p=l.length,c=o.wall,d=o.top||c,h=o.bottom||c;if(a.st||a.normal||a.tangent||a.bitangent||s){var m=o.boundingRectangle,_=o.tangentPlane,b=o.ellipsoid,w=o.stRotation,T=o.perPositionHeight,I=j;I.x=m.x,I.y=m.y;var A,P=o.isComputeTexCoord?new Float32Array(p):new Float32Array(p/3*2),x=a.st?P:void 0;a.normal&&(A=T&&d&&!c?i.attributes.normal.values:new Float32Array(p));var E=a.tangent?new Float32Array(p):void 0,O=a.bitangent?new Float32Array(p):void 0,H=s?new Float32Array(p):void 0,D=0,N=0,C=S,L=V,R=k,G=!0,J=Q,X=Z;if(0!==w){var ee=g.n.fromAxisAngle(_._plane.normal,w,K);J=v.p$1.fromQuaternion(ee,J),ee=g.n.fromAxisAngle(_._plane.normal,-w,K),X=v.p$1.fromQuaternion(ee,X)}else J=v.p$1.clone(v.p$1.IDENTITY,J),X=v.p$1.clone(v.p$1.IDENTITY,X);var te=0,oe=0;d&&h&&(te=p/2,oe=p/3,p/=2);for(var re=0;re<p;re+=3){var ae=n.o.fromArray(l,re,q);if(a.st){var ie=v.p$1.multiplyByVector(J,ae,B);ie=b.scaleToGeodeticSurface(ie,ie);var ne=_.projectPointOntoPlane(ie,$);t.o.subtract(ne,I,ne);var se=f.e.clamp(ne.x/m.width,0,1),le=f.e.clamp(ne.y/m.height,0,1);h&&(x[D+oe]=se,x[D+1+oe]=le),d&&(x[D]=se,x[D+1]=le),D+=2}if(a.normal||a.tangent||a.bitangent||s){var ue=N+1,pe=N+2;if(c){if(re+3<p){var ce=n.o.fromArray(l,re+3,z);if(G){var ge=n.o.fromArray(l,re+p,M);T&&F(ae,ce,ge,b),n.o.subtract(ce,ae,ce),n.o.subtract(ge,ae,ge),C=n.o.normalize(n.o.cross(ge,ce,C),C),G=!1}n.o.equalsEpsilon(ce,ae,f.e.EPSILON10)&&(G=!0)}(a.tangent||a.bitangent)&&(R=b.geodeticSurfaceNormal(ae,R),a.tangent&&(L=n.o.normalize(n.o.cross(R,C,L),L)))}else C=b.geodeticSurfaceNormal(ae,C),(a.tangent||a.bitangent)&&(T&&(U=n.o.fromArray(A,N,U),W=n.o.cross(n.o.UNIT_Z,U,W),W=n.o.normalize(v.p$1.multiplyByVector(X,W,W),W),a.bitangent&&(Y=n.o.normalize(n.o.cross(U,W,Y),Y))),L=n.o.cross(n.o.UNIT_Z,C,L),L=n.o.normalize(v.p$1.multiplyByVector(X,L,L),L),a.bitangent&&(R=n.o.normalize(n.o.cross(C,L,R),R)));a.normal&&(o.wall?(A[N+te]=C.x,A[ue+te]=C.y,A[pe+te]=C.z):h&&(A[N+te]=-C.x,A[ue+te]=-C.y,A[pe+te]=-C.z),(d&&!T||c)&&(A[N]=C.x,A[ue]=C.y,A[pe]=C.z)),s&&(c&&(C=b.geodeticSurfaceNormal(ae,C)),H[N+te]=-C.x,H[ue+te]=-C.y,H[pe+te]=-C.z),a.tangent&&(o.wall?(E[N+te]=L.x,E[ue+te]=L.y,E[pe+te]=L.z):h&&(E[N+te]=-L.x,E[ue+te]=-L.y,E[pe+te]=-L.z),d&&(T?(E[N]=W.x,E[ue]=W.y,E[pe]=W.z):(E[N]=L.x,E[ue]=L.y,E[pe]=L.z))),a.bitangent&&(h&&(O[N+te]=R.x,O[ue+te]=R.y,O[pe+te]=R.z),d&&(T?(O[N]=Y.x,O[ue]=Y.y,O[pe]=Y.z):(O[N]=R.x,O[ue]=R.y,O[pe]=R.z))),N+=3}}a.st&&(i.attributes.st=new g.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:x})),a.normal&&(i.attributes.normal=new g.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:A})),a.tangent&&(i.attributes.tangent=new g.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E})),a.bitangent&&(i.attributes.bitangent=new g.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:O})),s&&(i.attributes.extrudeDirection=new g.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:H}))}if(o.extrude&&e.e(o.offsetAttribute)){var de=l.length/3,ye=new Uint8Array(de);if(o.offsetAttribute===y.z.TOP)d&&h||c?ye=r.d(ye,1,0,de/2):d&&(ye=r.d(ye,1));else{var he=o.offsetAttribute===y.z.NONE?0:1;ye=r.d(ye,he)}i.attributes.applyOffset=new g.o({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:ye})}return i}var X=new s.a,ee=new s.a,te=(X=new s.a,ee=new s.a,{westOverIDL:0,eastOverIDL:0}),oe=new p.E;function re(r,a,i,n,s){if(s=e.u(s,new t.h),!e.e(r)||r.length<3)return s.west=0,s.north=0,s.south=0,s.east=0,s;if(i===o.L.RHUMB)return t.h.fromCartesianArray(r,a,s);oe.ellipsoid.equals(a)||(oe=new p.E(void 0,void 0,a)),s.west=Number.POSITIVE_INFINITY,s.east=Number.NEGATIVE_INFINITY,s.south=Number.POSITIVE_INFINITY,s.north=Number.NEGATIVE_INFINITY,te.westOverIDL=Number.POSITIVE_INFINITY,te.eastOverIDL=Number.NEGATIVE_INFINITY;for(var l,u=1/f.e.chordLength(n,a.maximumRadius),c=r.length,g=a.cartesianToCartographic(r[0],ee),d=X,y=1;y<c;y++)l=d,d=g,g=a.cartesianToCartographic(r[y],l),oe.setEndPoints(d,g),ie(oe,u,s,te);return l=d,d=g,g=a.cartesianToCartographic(r[0],l),oe.setEndPoints(d,g),ie(oe,u,s,te),s.east-s.west>te.eastOverIDL-te.westOverIDL&&(s.west=te.westOverIDL,s.east=te.eastOverIDL,s.east>f.e.PI&&(s.east=s.east-f.e.TWO_PI),s.west>f.e.PI&&(s.west=s.west-f.e.TWO_PI)),s}var ae=new s.a;function ie(e,t,o,r){for(var a=e.surfaceDistance,i=Math.ceil(a*t),n=i>0?a/(i-1):Number.POSITIVE_INFINITY,s=0,l=0;l<i;l++){var u=e.interpolateUsingSurfaceDistance(s,ae);s+=n;var p=u.longitude,c=u.latitude;o.west=Math.min(o.west,p),o.east=Math.max(o.east,p),o.south=Math.min(o.south,c),o.north=Math.max(o.north,c);var g=p>=0?p:p+f.e.TWO_PI;r.westOverIDL=Math.min(r.westOverIDL,g),r.eastOverIDL=Math.max(r.eastOverIDL,g)}}var ne=[];function se(e,t,o,r,a,i,n,s,l,u){var p,g={walls:[]};if(i||n){var y,h,f=_.y.createGeometryFromPositions(e,t,o,a,s,l),v=f.attributes.position.values,w=f.indices;if(i&&n){var T=v.concat(v);y=T.length/3,(h=m.IndexDatatype.createTypedArray(y,2*w.length)).set(w);var I=w.length,A=y/2;for(p=0;p<I;p+=3){var P=h[p]+A,x=h[p+1]+A,E=h[p+2]+A;h[p+I]=E,h[p+1+I]=x,h[p+2+I]=P}if(f.attributes.position.values=T,a&&s.normal){var O=f.attributes.normal.values;f.attributes.normal.values=new Float32Array(T.length),f.attributes.normal.values.set(O)}f.indices=h}else if(n){for(y=v.length/3,h=m.IndexDatatype.createTypedArray(y,w.length),p=0;p<w.length;p+=3)h[p]=w[p+2],h[p+1]=w[p+1],h[p+2]=w[p];f.indices=h}g.topAndBottom=new d.d({geometry:f})}var H,D=r.outerRing,N=c.f.fromPoints(D,e),C=N.projectPointsOntoPlane(D,ne),L=b.A.computeWindingOrder2D(C);L===b.W.CLOCKWISE&&(D=D.slice().reverse()),u&&(H=_.y.computeWallGeometry(D,e,o,a,l),g.walls.push(new d.d({geometry:H})));var R=r.holes;for(p=0;p<R.length;p++){var F=R[p];C=(N=c.f.fromPoints(F,e)).projectPointsOntoPlane(F,ne),(L=b.A.computeWindingOrder2D(C))===b.W.COUNTER_CLOCKWISE&&(F=F.slice().reverse()),H=_.y.computeWallGeometry(F,e,o,a,l),g.walls.push(new d.d({geometry:H}))}return g}function le(r){if(l.o.typeOf.object("options",r),l.o.typeOf.object("options.polygonHierarchy",r.polygonHierarchy),e.e(r.perPositionHeight)&&r.perPositionHeight&&e.e(r.height))throw new l.t("Cannot use both options.perPositionHeight and options.height");if(e.e(r.arcType)&&r.arcType!==o.L.GEODESIC&&r.arcType!==o.L.RHUMB)throw new l.t("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var a=r.polygonHierarchy,i=e.u(r.vertexFormat,w.n.DEFAULT),n=e.u(r.ellipsoid,t.t.WGS84),s=e.u(r.granularity,f.e.RADIANS_PER_DEGREE),u=e.u(r.stRotation,0),p=e.u(r.perPositionHeight,!1),c=p&&e.e(r.extrudedHeight),g=e.u(r.height,0),d=e.u(r.extrudedHeight,g);if(!c){var y=Math.max(g,d);d=Math.min(g,d),g=y}this._vertexFormat=w.n.clone(i),this._ellipsoid=t.t.clone(n),this._granularity=s,this._stRotation=u,this._height=g,this._extrudedHeight=d,this._closeTop=e.u(r.closeTop,!0),this._closeBottom=e.u(r.closeBottom,!0),this._extrudeOutering=e.u(r.extrudeOutering,!0),this._polygonHierarchy=a,this._perPositionHeight=p,this._perPositionHeightExtrude=c,this._shadowVolume=e.u(r.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=r.offsetAttribute,this._arcType=e.u(r.arcType,o.L.GEODESIC),this._groundBottomAltitude=e.u(r.groundBottomAltitude,0),this._groundExtrudedHeight=e.u(r.groundExtrudedHeight,0),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=_.y.computeHierarchyPackedLength(a)+t.t.packedLength+w.n.packedLength+12}le.fromPositions=function(t){return t=e.u(t,e.u.EMPTY_OBJECT),l.o.defined("options.positions",t.positions),new le({polygonHierarchy:{positions:t.positions},height:t.height,extrudedHeight:t.extrudedHeight,vertexFormat:t.vertexFormat,stRotation:t.stRotation,ellipsoid:t.ellipsoid,granularity:t.granularity,perPositionHeight:t.perPositionHeight,closeTop:t.closeTop,closeBottom:t.closeBottom,offsetAttribute:t.offsetAttribute,arcType:t.arcType})},le.pack=function(o,r,a){return l.o.typeOf.object("value",o),l.o.defined("array",r),a=e.u(a,0),a=_.y.packPolygonHierarchy(o._polygonHierarchy,r,a),t.t.pack(o._ellipsoid,r,a),a+=t.t.packedLength,w.n.pack(o._vertexFormat,r,a),a+=w.n.packedLength,r[a++]=o._height,r[a++]=o._extrudedHeight,r[a++]=o._granularity,r[a++]=o._stRotation,r[a++]=o._perPositionHeightExtrude?1:0,r[a++]=o._perPositionHeight?1:0,r[a++]=o._closeTop?1:0,r[a++]=o._closeBottom?1:0,r[a++]=o._shadowVolume?1:0,r[a++]=e.u(o._offsetAttribute,-1),r[a++]=o._arcType,r[a]=o.packedLength,r};var ue=t.t.clone(t.t.UNIT_SPHERE),pe=new w.n,ce={polygonHierarchy:{}};return le.unpack=function(o,r,a){l.o.defined("array",o),r=e.u(r,0);var i=_.y.unpackPolygonHierarchy(o,r);r=i.startingIndex,delete i.startingIndex;var n=t.t.unpack(o,r,ue);r+=t.t.packedLength;var s=w.n.unpack(o,r,pe);r+=w.n.packedLength;var u=o[r++],p=o[r++],c=o[r++],g=o[r++],d=1===o[r++],y=1===o[r++],h=1===o[r++],m=1===o[r++],f=1===o[r++],v=o[r++],b=o[r++],T=o[r];return e.e(a)||(a=new le(ce)),a._polygonHierarchy=i,a._ellipsoid=t.t.clone(n,a._ellipsoid),a._vertexFormat=w.n.clone(s,a._vertexFormat),a._height=u,a._extrudedHeight=p,a._granularity=c,a._stRotation=g,a._perPositionHeightExtrude=d,a._perPositionHeight=y,a._closeTop=h,a._closeBottom=m,a._shadowVolume=f,a._offsetAttribute=-1===v?void 0:v,a._arcType=b,a.packedLength=T,a},le.computeRectangle=function(r,a){l.o.typeOf.object("options",r),l.o.typeOf.object("options.polygonHierarchy",r.polygonHierarchy);var i=e.u(r.granularity,f.e.RADIANS_PER_DEGREE),n=e.u(r.arcType,o.L.GEODESIC);if(n!==o.L.GEODESIC&&n!==o.L.RHUMB)throw new l.t("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var s=r.polygonHierarchy,u=e.u(r.ellipsoid,t.t.WGS84);return re(s.positions,u,n,i,a)},le.createGeometry=function(t){var o=t._vertexFormat,a=t._ellipsoid,n=t._granularity,s=t._stRotation,l=t._polygonHierarchy,p=t._perPositionHeight,v=t._closeTop,w=t._closeBottom,T=t._arcType,I=l.positions;if(!(I.length<3)){var A=c.f.fromPoints(I,a),P=_.y.polygonsFromHierarchy(l,A.projectPointsOntoPlane.bind(A),!p,a),x=P.hierarchy,E=P.polygons;if(0!==x.length){I=x[0].outerRing;var O,H=_.y.computeBoundingRectangle(A.plane.normal,A.projectPointOntoPlane.bind(A),I,s,G),D=[],N=t._height,C=t._extrudedHeight,L={perPositionHeight:p,vertexFormat:o,geometry:void 0,tangentPlane:A,boundingRectangle:H,ellipsoid:a,stRotation:s,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:T};if(t._perPositionHeightExtrude||!f.e.equalsEpsilon(N,C,0,f.e.EPSILON2))for(L.extrude=!0,L.top=v,L.bottom=w,L.shadowVolume=t._shadowVolume,L.offsetAttribute=t._offsetAttribute,O=0;O<E.length;O++){var R,F=se(a,E[O],n,x[O],p,v,w,o,T,t._extrudeOutering);v&&w?(R=F.topAndBottom,L.geometry=_.y.scaleToGeodeticHeightExtruded(R.geometry,N,C,a,p)):v?((R=F.topAndBottom).geometry.attributes.position.values=b.A.scaleToGeodeticHeight(R.geometry.attributes.position.values,N,a,!p),L.geometry=R.geometry):w&&((R=F.topAndBottom).geometry.attributes.position.values=b.A.scaleToGeodeticHeight(R.geometry.attributes.position.values,C,a,!0),L.geometry=R.geometry),(v||w)&&(L.wall=!1,R.geometry=J(L),D.push(R));var B=F.walls;L.wall=!0;for(var S=0;S<B.length;S++){var V=B[S];L.geometry=_.y.scaleToGeodeticHeightExtruded(V.geometry,N,C,a,p),V.geometry=J(L),D.push(V)}}else for(O=0;O<E.length;O++){var k=new d.d({geometry:_.y.createGeometryFromPositions(a,E[O],n,p,o,T)});if(k.geometry.attributes.position.values=b.A.scaleToGeodeticHeight(k.geometry.attributes.position.values,N,a,!p),L.geometry=k.geometry,k.geometry=J(L),e.e(t._offsetAttribute)){var z=k.geometry.attributes.position.values.length,M=new Uint8Array(z/3),U=t._offsetAttribute===y.z.NONE?0:1;r.d(M,U),k.geometry.attributes.applyOffset=new g.o({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:M})}D.push(k)}var W=h.k.combineInstances(D)[0];W.attributes.position.values=new Float64Array(W.attributes.position.values),W.indices=m.IndexDatatype.createTypedArray(W.attributes.position.values.length/3,W.indices);var Y=W.attributes,j=i.i.fromVertices(Y.position.values);return o.position||delete Y.position,new g.I({attributes:Y,indices:W.indices,primitiveType:W.primitiveType,boundingSphere:j,offsetAttribute:t._offsetAttribute})}}},le.createShadowVolume=function(e,t,o){var r=e._granularity,a=e._ellipsoid,i=e._groundBottomAltitude+e._groundExtrudedHeight,n=e._groundBottomAltitude?e._groundBottomAltitude:t(r,a),s=i!==e._groundBottomAltitude?i:o(r,a);return new le({polygonHierarchy:e._polygonHierarchy,ellipsoid:a,stRotation:e._stRotation,granularity:r,perPositionHeight:!1,extrudedHeight:n,height:s,vertexFormat:w.n.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(le.prototype,{rectangle:{get:function(){if(!e.e(this._rectangle)){var t=this._polygonHierarchy.positions;this._rectangle=re(t,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return e.e(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];var o=e._ellipsoid,r=e._polygonHierarchy.positions,a=e.rectangle;return g.I._textureCoordinateRotationPoints(r,t,o,a)}(this)),this._textureCoordinateRotationPoints}}}),function(o,r){return e.e(r)&&(o=le.unpack(o,r)),o._ellipsoid=t.t.clone(o._ellipsoid),le.createGeometry(o)}}));
