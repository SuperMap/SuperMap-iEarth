define(["exports","./ArcType-31298545","./arrayRemoveDuplicates-a6924649","./Cartesian2-b72655a5","./Cartesian3-3a8bdb0b","./Cartographic-a2c313d7","./ComponentDatatype-98414d16","./when-92c6cf3c","./EllipsoidRhumbLine-b1a766ae","./GeometryAttribute-f47bd1cb","./GeometryAttributes-7f66ea53","./GeometryPipeline-7ffd3f60","./IndexDatatype-86677ec4","./Math-ecf82623","./FeatureDetection-cec0163f","./PolygonPipeline-425528b3"],(function(e,t,r,o,n,i,a,s,u,h,c,l,f,p,v,g){"use strict";function y(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(y.prototype,{length:{get:function(){return this._length}}}),y.prototype.enqueue=function(e){this._array.push(e),this._length++},y.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,r=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,r}},y.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},y.prototype.contains=function(e){return-1!==this._array.indexOf(e)},y.prototype.clear=function(){this._array.length=this._offset=this._length=0},y.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var d={computeHierarchyPackedLength:function(e){for(var t=0,r=[e];r.length>0;){var o=r.pop();if(s.e(o)){t+=2;var i=o.positions,a=o.holes;if(s.e(i)&&(t+=i.length*n.o.packedLength),s.e(a))for(var u=a.length,h=0;h<u;++h)r.push(a[h])}}return t},packPolygonHierarchy:function(e,t,r){for(var o=[e];o.length>0;){var i=o.pop();if(s.e(i)){var a=i.positions,u=i.holes;if(t[r++]=s.e(a)?a.length:0,t[r++]=s.e(u)?u.length:0,s.e(a))for(var h=a.length,c=0;c<h;++c,r+=3)n.o.pack(a[c],t,r);if(s.e(u))for(var l=u.length,f=0;f<l;++f)o.push(u[f])}}return r},unpackPolygonHierarchy:function(e,t){for(var r=e[t++],o=e[t++],i=new Array(r),a=o>0?new Array(o):void 0,s=0;s<r;++s,t+=n.o.packedLength)i[s]=n.o.unpack(e,t);for(var u=0;u<o;++u)a[u]=d.unpackPolygonHierarchy(e,t),t=a[u].startingIndex,delete a[u].startingIndex;return{positions:i,holes:a,startingIndex:t}}},m=new n.o;function b(e,t,r,o){return n.o.subtract(t,e,m),n.o.multiplyByScalar(m,r/o,m),n.o.add(e,m,m),[m.x,m.y,m.z]}d.subdivideLineCount=function(e,t,r){var o=n.o.distance(e,t)/r,i=Math.max(0,Math.ceil(p.e.log2(o)));return Math.pow(2,i)};var I=new i.a,w=new i.a,_=new i.a,L=new n.o;d.subdivideRhumbLineCount=function(e,t,r,o){var n=e.cartesianToCartographic(t,I),i=e.cartesianToCartographic(r,w),a=new u.P(n,i,e).surfaceDistance/o,s=Math.max(0,Math.ceil(p.e.log2(a)));return Math.pow(2,s)},d.subdivideLine=function(e,t,r,o){var i=d.subdivideLineCount(e,t,r),a=n.o.distance(e,t),u=a/i;s.e(o)||(o=[]);var h=o;h.length=3*i;for(var c=0,l=0;l<i;l++){var f=b(e,t,l*u,a);h[c++]=f[0],h[c++]=f[1],h[c++]=f[2]}return h},d.subdivideRhumbLine=function(e,t,r,o,n){var i=e.cartesianToCartographic(t,I),a=e.cartesianToCartographic(r,w),h=new u.P(i,a,e),c=h.surfaceDistance/o,l=Math.max(0,Math.ceil(p.e.log2(c))),f=Math.pow(2,l),v=h.surfaceDistance/f;s.e(n)||(n=[]);var g=n;g.length=3*f;for(var y=0,d=0;d<f;d++){var m=h.interpolateUsingSurfaceDistance(d*v,_),b=e.cartographicToCartesian(m,L);g[y++]=b.x,g[y++]=b.y,g[y++]=b.z}return g};var x=new n.o,E=new n.o,D=new n.o,S=new n.o;d.scaleToGeodeticHeightExtruded=function(e,t,r,i,a){i=s.u(i,o.t.WGS84);var u=x,h=E,c=D,l=S;if(s.e(e)&&s.e(e.attributes)&&s.e(e.attributes.position))for(var f=e.attributes.position.values,p=f.length/2,v=0;v<p;v+=3)n.o.fromArray(f,v,c),i.geodeticSurfaceNormal(c,u),l=i.scaleToGeodeticSurface(c,l),h=n.o.multiplyByScalar(u,r,h),h=n.o.add(l,h,h),f[v+p]=h.x,f[v+1+p]=h.y,f[v+2+p]=h.z,a&&(l=n.o.clone(c,l)),h=n.o.multiplyByScalar(u,t,h),h=n.o.add(l,h,h),f[v]=h.x,f[v+1]=h.y,f[v+2]=h.z;return e},d.polygonOutlinesFromHierarchy=function(e,t,o){var i,a,u,h=[],c=new y;for(c.enqueue(e);0!==c.length;){var l=c.dequeue(),f=l.positions;if(t)for(u=f.length,i=0;i<u;i++)o.scaleToGeodeticSurface(f[i],f[i]);if(!((f=r.D(f,n.o.equalsEpsilon,!0)).length<3)){var p=l.holes?l.holes.length:0;for(i=0;i<p;i++){var v=l.holes[i],g=v.positions;if(t)for(u=g.length,a=0;a<u;++a)o.scaleToGeodeticSurface(g[a],g[a]);if(!((g=r.D(g,n.o.equalsEpsilon,!0)).length<3)){h.push(g);var d=0;for(s.e(v.holes)&&(d=v.holes.length),a=0;a<d;a++)c.enqueue(v.holes[a])}}h.push(f)}}return h};var A=new n.o(6378137,6378137,6378137);d.polygonsFromHierarchy=function(e,t,o,i){var a=[],u=[],h=new y;for(h.enqueue(e);0!==h.length;){var c,l,f,v=h.dequeue(),d=v.positions,m=v.holes,b=d.slice();if(o)for(l=d.length,c=0;c<l;c++)i.scaleToGeodeticSurface(d[c],b[c]);if(s.e(i)&&!n.o.equals(i._radii,A)&&(f=p.e.EPSILON7),!((d=r.D(b,n.o.equalsEpsilon,!0,f)).length<3)){var I=t(d);if(s.e(I)){var w=[],_=g.A.computeWindingOrder2D(I);_===g.W.CLOCKWISE&&(I.reverse(),d=d.slice().reverse());var L,x=d.slice(),E=s.e(m)?m.length:0,D=[];for(c=0;c<E;c++){var S=m[c],T=S.positions;if(o)for(l=T.length,L=0;L<l;++L)i.scaleToGeodeticSurface(T[L],T[L]);if(!((T=r.D(T,n.o.equalsEpsilon,!0,p.e.EPSILON7)).length<3)){var C=t(T);if(s.e(C)){(_=g.A.computeWindingOrder2D(C))===g.W.CLOCKWISE&&(C.reverse(),T=T.slice().reverse()),D.push(T),w.push(x.length),x=x.concat(T),I=I.concat(C);var N=0;for(s.e(S.holes)&&(N=S.holes.length),L=0;L<N;L++)h.enqueue(S.holes[L])}}}a.push({outerRing:d,holes:D}),u.push({positions:x,positions2D:I,holes:w})}}}return{hierarchy:a,polygons:u}};var T=new o.o,C=new n.o,N=new h.n,G=new v.p$1;d.computeBoundingRectangle=function(e,t,r,o,i){for(var a=h.n.fromAxisAngle(e,o,N),u=v.p$1.fromQuaternion(a,G),c=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,g=r.length,y=0;y<g;++y){var d=n.o.clone(r[y],C);v.p$1.multiplyByVector(u,d,d);var m=t(d,T);s.e(m)&&(c=Math.min(c,m.x),l=Math.max(l,m.x),f=Math.min(f,m.y),p=Math.max(p,m.y))}return i.x=c,i.y=f,i.width=l-c,i.height=p-f,i},d.createGeometryFromPositions=function(e,r,o,n,i,s){var u=g.A.triangulate(r.positions2D,r.holes);u.length<3&&(u=[0,1,2]);var c=r.positions;if(n){for(var f=c.length,p=new Array(3*f),y=0,d=0;d<f;d++){var m=c[d];p[y++]=m.x,p[y++]=m.y,p[y++]=m.z}var b=new h.I({attributes:{position:new h.o({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:p})},indices:u,primitiveType:v._0x4b6a27.TRIANGLES});return i.normal?l.k.computeNormal(b):b}return s===t.L.GEODESIC?g.A.computeSubdivision(e,c,u,o):s===t.L.RHUMB?g.A.computeRhumbLineSubdivision(e,c,u,o):void 0};var P=[],O=new n.o,M=new n.o;d.computeWallGeometry=function(e,r,o,i,s){var u,l,g,y,m,b=e.length,I=0;if(i)for(l=3*b*2,u=new Array(2*l),g=0;g<b;g++)y=e[g],m=e[(g+1)%b],u[I]=u[I+l]=y.x,u[++I]=u[I+l]=y.y,u[++I]=u[I+l]=y.z,u[++I]=u[I+l]=m.x,u[++I]=u[I+l]=m.y,u[++I]=u[I+l]=m.z,++I;else{var w=p.e.chordLength(o,r.maximumRadius),_=0;if(s===t.L.GEODESIC)for(g=0;g<b;g++)_+=d.subdivideLineCount(e[g],e[(g+1)%b],w);else if(s===t.L.RHUMB)for(g=0;g<b;g++)_+=d.subdivideRhumbLineCount(r,e[g],e[(g+1)%b],w);for(l=3*(_+b),u=new Array(2*l),g=0;g<b;g++){var L;y=e[g],m=e[(g+1)%b],s===t.L.GEODESIC?L=d.subdivideLine(y,m,w,P):s===t.L.RHUMB&&(L=d.subdivideRhumbLine(r,y,m,w,P));for(var x=L.length,E=0;E<x;++E,++I)u[I]=L[E],u[I+l]=L[E];u[I]=m.x,u[I+l]=m.x,u[++I]=m.y,u[I+l]=m.y,u[++I]=m.z,u[I+l]=m.z,++I}}b=u.length;var D=f.IndexDatatype.createTypedArray(b/3,b-6*e.length),S=0;for(b/=6,g=0;g<b;g++){var A=g,T=A+1,C=A+b,N=C+1;y=n.o.fromArray(u,3*A,O),m=n.o.fromArray(u,3*T,M),!n.o.equalsEpsilon(y,m,p.e.EPSILON10,p.e.EPSILON10)&&(D[S++]=A,D[S++]=C,D[S++]=T,D[S++]=T,D[S++]=C,D[S++]=N)}return new h.I({attributes:new c.a({position:new h.o({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:u})}),indices:D,primitiveType:v._0x4b6a27.TRIANGLES})},e.y=d}));
