define(["exports","./Cartesian3-3a8bdb0b","./PolylineVolumeGeometryLibrary-c2c6fa8a","./when-92c6cf3c","./Math-ecf82623","./FeatureDetection-9827a02d","./PolylinePipeline-828830ee","./GeometryAttribute-1689f5ef"],(function(o,e,a,r,n,t,i,l){"use strict";var s={},c=new e.o,u=new e.o,y=new e.o,d=new e.o,m=[new e.o,new e.o],p=new e.o,g=new e.o,f=new e.o,h=new e.o,w=new e.o,z=new e.o,S=new e.o,v=new e.o,x=new e.o,A=new e.o,B=new l.n,E=new t.p$1;function b(o,r,i,s,y){var d,m=e.o.angleBetween(e.o.subtract(r,o,c),e.o.subtract(i,o,u)),p=s===a.S.BEVELED?1:Math.ceil(m/n.e.toRadians(5))+1,g=3*p,f=new Array(g);f[g-3]=i.x,f[g-2]=i.y,f[g-1]=i.z,d=y?t.p$1.fromQuaternion(l.n.fromAxisAngle(e.o.negate(o,c),m/p,B),E):t.p$1.fromQuaternion(l.n.fromAxisAngle(o,m/p,B),E);var h=0;r=e.o.clone(r,c);for(var w=0;w<p;w++)r=t.p$1.multiplyByVector(d,r,r),f[h++]=r.x,f[h++]=r.y,f[h++]=r.z;return f}function D(o,a,r,n){var t=c;return n||(a=e.o.negate(a,a)),[(t=e.o.add(o,a,t)).x,t.y,t.z,r.x,r.y,r.z]}function P(o,a,r,n){for(var t=new Array(o.length),i=new Array(o.length),l=e.o.multiplyByScalar(a,r,c),s=e.o.negate(l,u),m=0,p=o.length-1,g=0;g<o.length;g+=3){var f=e.o.fromArray(o,g,y),h=e.o.add(f,s,d);t[m++]=h.x,t[m++]=h.y,t[m++]=h.z;var w=e.o.add(f,l,d);i[p--]=w.z,i[p--]=w.y,i[p--]=w.x}return n.push(t,i),n}s.addAttribute=function(o,e,a,n){var t=e.x,i=e.y,l=e.z;r.e(a)&&(o[a]=t,o[a+1]=i,o[a+2]=l),r.e(n)&&(o[n]=l,o[n-1]=i,o[n-2]=t)};var N=new e.o,O=new e.o;s.computePositions=function(o){var r=o.granularity,t=o.positions,l=o.ellipsoid,s=o.width/2,u=o.cornerType,y=o.saveAttributes,d=p,B=g,E=f,R=h,L=w,U=z,V=S,M=v,$=x,G=A,I=[],Q=y?[]:void 0,T=y?[]:void 0,q=t[0],C=t[1];B=e.o.normalize(e.o.subtract(C,q,B),B),d=l.geodeticSurfaceNormal(q,d),R=e.o.normalize(e.o.cross(d,B,R),R),y&&(Q.push(R.x,R.y,R.z),T.push(d.x,d.y,d.z)),V=e.o.clone(q,V),q=C,E=e.o.negate(B,E);var F,J,j=[],k=t.length;for(F=1;F<k-1;F++){d=l.geodeticSurfaceNormal(q,d),C=t[F+1],B=e.o.normalize(e.o.subtract(C,q,B),B),L=e.o.normalize(e.o.add(B,E,L),L);var H=e.o.multiplyByScalar(d,e.o.dot(B,d),N);e.o.subtract(B,H,H),e.o.normalize(H,H);var K=e.o.multiplyByScalar(d,e.o.dot(E,d),O);if(e.o.subtract(E,K,K),e.o.normalize(K,K),!n.e.equalsEpsilon(Math.abs(e.o.dot(H,K)),1,n.e.EPSILON7)){L=e.o.cross(L,d,L),L=e.o.cross(d,L,L),L=e.o.normalize(L,L);var W=s/Math.max(.25,e.o.magnitude(e.o.cross(L,E,c))),X=a.J.angleIsGreaterThanPi(B,E,q,l);L=e.o.multiplyByScalar(L,W,L),X?(M=e.o.add(q,L,M),G=e.o.add(M,e.o.multiplyByScalar(R,s,G),G),$=e.o.add(M,e.o.multiplyByScalar(R,2*s,$),$),m[0]=e.o.clone(V,m[0]),m[1]=e.o.clone(G,m[1]),I=P(i.m.generateArc({positions:m,granularity:r,ellipsoid:l}),R,s,I),y&&(Q.push(R.x,R.y,R.z),T.push(d.x,d.y,d.z)),U=e.o.clone($,U),R=e.o.normalize(e.o.cross(d,B,R),R),$=e.o.add(M,e.o.multiplyByScalar(R,2*s,$),$),V=e.o.add(M,e.o.multiplyByScalar(R,s,V),V),u===a.S.ROUNDED||u===a.S.BEVELED?j.push({leftPositions:b(M,U,$,u,X)}):j.push({leftPositions:D(q,e.o.negate(L,L),$,X)})):($=e.o.add(q,L,$),G=e.o.add($,e.o.negate(e.o.multiplyByScalar(R,s,G),G),G),M=e.o.add($,e.o.negate(e.o.multiplyByScalar(R,2*s,M),M),M),m[0]=e.o.clone(V,m[0]),m[1]=e.o.clone(G,m[1]),I=P(i.m.generateArc({positions:m,granularity:r,ellipsoid:l}),R,s,I),y&&(Q.push(R.x,R.y,R.z),T.push(d.x,d.y,d.z)),U=e.o.clone(M,U),R=e.o.normalize(e.o.cross(d,B,R),R),M=e.o.add($,e.o.negate(e.o.multiplyByScalar(R,2*s,M),M),M),V=e.o.add($,e.o.negate(e.o.multiplyByScalar(R,s,V),V),V),u===a.S.ROUNDED||u===a.S.BEVELED?j.push({rightPositions:b($,U,M,u,X)}):j.push({rightPositions:D(q,L,M,X)})),E=e.o.negate(B,E)}q=C}return d=l.geodeticSurfaceNormal(q,d),m[0]=e.o.clone(V,m[0]),m[1]=e.o.clone(q,m[1]),I=P(i.m.generateArc({positions:m,granularity:r,ellipsoid:l}),R,s,I),y&&(Q.push(R.x,R.y,R.z),T.push(d.x,d.y,d.z)),u===a.S.ROUNDED&&(J=function(o){var r=p,n=g,t=f,i=o[1];n=e.o.fromArray(o[1],i.length-3,n),t=e.o.fromArray(o[0],0,t);var l=b(r=e.o.midpoint(n,t,r),n,t,a.S.ROUNDED,!1),s=o.length-1,c=o[s-1];return i=o[s],n=e.o.fromArray(c,c.length-3,n),t=e.o.fromArray(i,0,t),[l,b(r=e.o.midpoint(n,t,r),n,t,a.S.ROUNDED,!1)]}(I)),{positions:I,corners:j,lefts:Q,normals:T,endPositions:J}},o.b=s}));
