define(["exports","./Cartesian3-3a8bdb0b","./Cartographic-a2c313d7","./when-92c6cf3c","./Check-52a7d806","./Cartesian2-b72655a5","./EllipsoidGeodesic-03c935a0","./EllipsoidRhumbLine-b1a766ae","./IntersectionTests-9ff29c98","./Math-ecf82623","./FeatureDetection-fd297af4","./Plane-a2c6da7b"],(function(r,a,e,t,n,o,i,c,s,u,h,f){"use strict";var l={numberOfPoints:function(r,e,t){var n=a.o.distance(r,e);return Math.ceil(n/t)},numberOfPointsRhumbLine:function(r,a,e){var t=Math.pow(r.longitude-a.longitude,2)+Math.pow(r.latitude-a.latitude,2);return Math.ceil(Math.sqrt(t/(e*e)))}},g=new e.a;l.extractHeights=function(r,a){for(var e=r.length,t=new Array(e),n=0;n<e;n++){var o=r[n];t[n]=a.cartesianToCartographic(o,g).height}return t};var p=new h.p,v=new a.o,d=new a.o,m=new f.o(a.o.UNIT_X,0),w=new a.o,T=new f.o(a.o.UNIT_X,0),y=new a.o,P=new a.o,A=[];function C(r,a,e){var t,n=A;if(n.length=r,a===e){for(t=0;t<r;t++)n[t]=a;return n}var o=(e-a)/r;for(t=0;t<r;t++){var i=a+t*o;n[t]=i}return n}var b=new e.a,S=new e.a,E=new a.o,R=new a.o,D=new a.o,G=new i.E,N=new c.P;function I(r,e,t,n,o,i,c,s,u){var h=n.scaleToGeodeticSurface(r,R),f=n.scaleToGeodeticSurface(e,D),g=l.numberOfPoints(r,e,t),p=n.cartesianToCartographic(h,b),v=n.cartesianToCartographic(f,S),d=C(g,o,i);u>0&&(d=function(r,a){var e=A;e.length=r;for(var t=0;t<r;t++)e[t]+=a*Math.sin(Math.PI*t/r);return e}(g,u)),G.setEndPoints(p,v);var m=G.surfaceDistance/g,w=s;p.height=o;var T=n.cartographicToCartesian(p,E);a.o.pack(T,c,w),w+=3;for(var y=1;y<g;y++){var P=G.interpolateUsingSurfaceDistance(y*m,S);P.height=d[y],T=n.cartographicToCartesian(P,E),a.o.pack(T,c,w),w+=3}return w}function k(r,e,t,n,o,i,s,u){var h=n.scaleToGeodeticSurface(r,R),f=n.scaleToGeodeticSurface(e,D),g=n.cartesianToCartographic(h,b),p=n.cartesianToCartographic(f,S),v=l.numberOfPointsRhumbLine(g,p,t),d=C(v,o,i);N.ellipsoid.equals(n)||(N=new c.P(void 0,void 0,n)),N.setEndPoints(g,p);var m=N.surfaceDistance/v,w=u;g.height=o;var T=n.cartographicToCartesian(g,E);a.o.pack(T,s,w),w+=3;for(var y=1;y<v;y++){var P=N.interpolateUsingSurfaceDistance(y*m,S);P.height=d[y],T=n.cartographicToCartesian(P,E),a.o.pack(T,s,w),w+=3}return w}l.wrapLongitude=function(r,e){var n=[],o=[];if(t.e(r)&&r.length>0){e=t.u(e,h.p.IDENTITY);var i=h.p.inverseTransformation(e,p),c=h.p.multiplyByPoint(i,a.o.ZERO,v),u=a.o.normalize(h.p.multiplyByPointAsVector(i,a.o.UNIT_Y,d),d),l=f.o.fromPointNormal(c,u,m),g=a.o.normalize(h.p.multiplyByPointAsVector(i,a.o.UNIT_X,w),w),A=f.o.fromPointNormal(c,g,T),C=1;n.push(a.o.clone(r[0]));for(var b=n[0],S=r.length,E=1;E<S;++E){var R=r[E];if(f.o.getPointDistance(A,b)<0||f.o.getPointDistance(A,R)<0){var D=s.g.lineSegmentPlane(b,R,l,y);if(t.e(D)){var G=a.o.multiplyByScalar(u,5e-9,P);f.o.getPointDistance(l,b)<0&&a.o.negate(G,G),n.push(a.o.add(D,G,new a.o)),o.push(C+1),a.o.negate(G,G),n.push(a.o.add(D,G,new a.o)),C=1}}n.push(a.o.clone(r[E])),C++,b=R}o.push(C)}return{positions:n,lengths:o}},l.generateArc=function(r){t.e(r)||(r={});var e=r.positions;if(!t.e(e))throw new n.t("options.positions is required.");var i=e.length,c=t.u(r.ellipsoid,o.t.WGS84),s=t.u(r.height,0),h=Array.isArray(s);if(i<1)return[];if(1===i){var f=c.scaleToGeodeticSurface(e[0],R);if(0!==(s=h?s[0]:s)){var g=c.geodeticSurfaceNormal(f,E);a.o.multiplyByScalar(g,s,g),a.o.add(f,g,f)}return[f.x,f.y,f.z]}var p=r.minDistance;if(!t.e(p)){var v=t.u(r.granularity,u.e.RADIANS_PER_DEGREE);p=u.e.chordLength(v,c.maximumRadius)}var d,m=0;for(d=0;d<i-1;d++)m+=l.numberOfPoints(e[d],e[d+1],p);var w=r.hMax,T=3*(m+1),y=new Array(T),P=0;for(d=0;d<i-1;d++){P=I(e[d],e[d+1],p,c,h?s[d]:s,h?s[d+1]:s,y,P,w)}A.length=0;var C=e[i-1],S=c.cartesianToCartographic(C,b);S.height=h?s[i-1]:s;var D=c.cartographicToCartesian(S,E);return a.o.pack(D,y,T-3),y};var M=new e.a,_=new e.a;l.generateRhumbArc=function(r){t.e(r)||(r={});var i=r.positions;if(!t.e(i))throw new n.t("options.positions is required.");var c=i.length,s=t.u(r.ellipsoid,o.t.WGS84),h=t.u(r.height,0),f=Array.isArray(h);if(c<1)return[];if(1===c){var g=s.scaleToGeodeticSurface(i[0],R);if(0!==(h=f?h[0]:h)){var p=s.geodeticSurfaceNormal(g,E);a.o.multiplyByScalar(p,h,p),a.o.add(g,p,g)}return[g.x,g.y,g.z]}var v,d,m=t.u(r.granularity,u.e.RADIANS_PER_DEGREE),w=0,T=s.cartesianToCartographic(i[0],M);for(v=0;v<c-1;v++)d=s.cartesianToCartographic(i[v+1],_),w+=l.numberOfPointsRhumbLine(T,d,m),T=e.a.clone(d,M);var y=3*(w+1),P=new Array(y),C=0;for(v=0;v<c-1;v++){C=k(i[v],i[v+1],m,s,f?h[v]:h,f?h[v+1]:h,P,C)}A.length=0;var S=i[c-1],D=s.cartesianToCartographic(S,b);D.height=f?h[c-1]:h;var G=s.cartographicToCartesian(D,E);return a.o.pack(G,P,y-3),P},l.generateCartesianArc=function(r){for(var e=l.generateArc(r),t=e.length/3,n=new Array(t),o=0;o<t;o++)n[o]=a.o.unpack(e,3*o);return n},l.generateCartesianRhumbArc=function(r){for(var e=l.generateRhumbArc(r),t=e.length/3,n=new Array(t),o=0;o<t;o++)n[o]=a.o.unpack(e,3*o);return n},r.m=l}));
