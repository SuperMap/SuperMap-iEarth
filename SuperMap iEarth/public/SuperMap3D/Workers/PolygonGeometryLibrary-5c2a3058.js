define(["exports","./ArcType-31298545","./arrayRemoveDuplicates-3deab545","./Cartesian2-59a54ee7","./Cartographic-81e9e8b2","./ComponentDatatype-7d28dd1c","./when-39df26e1","./EllipsoidRhumbLine-61b02483","./GeometryAttribute-9b3921a3","./GeometryAttributes-11421d3c","./GeometryPipeline-91e3b4f0","./IndexDatatype-be421fbf","./Math-5e067eb3","./FeatureDetection-2d4141ff","./PolygonPipeline-ae195f4e"],(function(e,t,r,o,n,i,a,s,u,h,l,c,f,p,v){"use strict";function g(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(g.prototype,{length:{get:function(){return this._length}}}),g.prototype.enqueue=function(e){this._array.push(e),this._length++},g.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,r=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,r}},g.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},g.prototype.contains=function(e){return-1!==this._array.indexOf(e)},g.prototype.clear=function(){this._array.length=this._offset=this._length=0},g.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var y={computeHierarchyPackedLength:function(e){for(var t=0,r=[e];r.length>0;){var o=r.pop();if(a.e(o)){t+=2;var i=o.positions,s=o.holes;if(a.e(i)&&(t+=i.length*n.o.packedLength),a.e(s))for(var u=s.length,h=0;h<u;++h)r.push(s[h])}}return t},packPolygonHierarchy:function(e,t,r){for(var o=[e];o.length>0;){var i=o.pop();if(a.e(i)){var s=i.positions,u=i.holes;if(t[r++]=a.e(s)?s.length:0,t[r++]=a.e(u)?u.length:0,a.e(s))for(var h=s.length,l=0;l<h;++l,r+=3)n.o.pack(s[l],t,r);if(a.e(u))for(var c=u.length,f=0;f<c;++f)o.push(u[f])}}return r},unpackPolygonHierarchy:function(e,t){for(var r=e[t++],o=e[t++],i=new Array(r),a=o>0?new Array(o):void 0,s=0;s<r;++s,t+=n.o.packedLength)i[s]=n.o.unpack(e,t);for(var u=0;u<o;++u)a[u]=y.unpackPolygonHierarchy(e,t),t=a[u].startingIndex,delete a[u].startingIndex;return{positions:i,holes:a,startingIndex:t}}},d=new n.o;function m(e,t,r,o){return n.o.subtract(t,e,d),n.o.multiplyByScalar(d,r/o,d),n.o.add(e,d,d),[d.x,d.y,d.z]}y.subdivideLineCount=function(e,t,r){var o=n.o.distance(e,t)/r,i=Math.max(0,Math.ceil(f.e.log2(o)));return Math.pow(2,i)};var b=new n.a,I=new n.a,w=new n.a,_=new n.o;y.subdivideRhumbLineCount=function(e,t,r,o){var n=e.cartesianToCartographic(t,b),i=e.cartesianToCartographic(r,I),a=new s.P(n,i,e).surfaceDistance/o,u=Math.max(0,Math.ceil(f.e.log2(a)));return Math.pow(2,u)},y.subdivideLine=function(e,t,r,o){var i=y.subdivideLineCount(e,t,r),s=n.o.distance(e,t),u=s/i;a.e(o)||(o=[]);var h=o;h.length=3*i;for(var l=0,c=0;c<i;c++){var f=m(e,t,c*u,s);h[l++]=f[0],h[l++]=f[1],h[l++]=f[2]}return h},y.subdivideRhumbLine=function(e,t,r,o,n){var i=e.cartesianToCartographic(t,b),u=e.cartesianToCartographic(r,I),h=new s.P(i,u,e),l=h.surfaceDistance/o,c=Math.max(0,Math.ceil(f.e.log2(l))),p=Math.pow(2,c),v=h.surfaceDistance/p;a.e(n)||(n=[]);var g=n;g.length=3*p;for(var y=0,d=0;d<p;d++){var m=h.interpolateUsingSurfaceDistance(d*v,w),L=e.cartographicToCartesian(m,_);g[y++]=L.x,g[y++]=L.y,g[y++]=L.z}return g};var L=new n.o,x=new n.o,E=new n.o,D=new n.o;y.scaleToGeodeticHeightExtruded=function(e,t,r,i,s){i=a.u(i,o.t.WGS84);var u=L,h=x,l=E,c=D;if(a.e(e)&&a.e(e.attributes)&&a.e(e.attributes.position))for(var f=e.attributes.position.values,p=f.length/2,v=0;v<p;v+=3)n.o.fromArray(f,v,l),i.geodeticSurfaceNormal(l,u),c=i.scaleToGeodeticSurface(l,c),h=n.o.multiplyByScalar(u,r,h),h=n.o.add(c,h,h),f[v+p]=h.x,f[v+1+p]=h.y,f[v+2+p]=h.z,s&&(c=n.o.clone(l,c)),h=n.o.multiplyByScalar(u,t,h),h=n.o.add(c,h,h),f[v]=h.x,f[v+1]=h.y,f[v+2]=h.z;return e},y.polygonOutlinesFromHierarchy=function(e,t,o){var i,s,u,h=[],l=new g;for(l.enqueue(e);0!==l.length;){var c=l.dequeue(),f=c.positions;if(t)for(u=f.length,i=0;i<u;i++)o.scaleToGeodeticSurface(f[i],f[i]);if(!((f=r.D(f,n.o.equalsEpsilon,!0)).length<3)){var p=c.holes?c.holes.length:0;for(i=0;i<p;i++){var v=c.holes[i],y=v.positions;if(t)for(u=y.length,s=0;s<u;++s)o.scaleToGeodeticSurface(y[s],y[s]);if(!((y=r.D(y,n.o.equalsEpsilon,!0)).length<3)){h.push(y);var d=0;for(a.e(v.holes)&&(d=v.holes.length),s=0;s<d;s++)l.enqueue(v.holes[s])}}h.push(f)}}return h};var S=new n.o(6378137,6378137,6378137);y.polygonsFromHierarchy=function(e,t,o,i){var s=[],u=[],h=new g;for(h.enqueue(e);0!==h.length;){var l,c,p,y=h.dequeue(),d=y.positions,m=y.holes,b=d.slice();if(o)for(c=d.length,l=0;l<c;l++)i.scaleToGeodeticSurface(d[l],b[l]);if(a.e(i)&&!n.o.equals(i._radii,S)&&(p=f.e.EPSILON7),!((d=r.D(b,n.o.equalsEpsilon,!0,p)).length<3)){var I=t(d);if(a.e(I)){var w=[],_=v.A.computeWindingOrder2D(I);_===v.W.CLOCKWISE&&(I.reverse(),d=d.slice().reverse());var L,x=d.slice(),E=a.e(m)?m.length:0,D=[];for(l=0;l<E;l++){var A=m[l],T=A.positions;if(o)for(c=T.length,L=0;L<c;++L)i.scaleToGeodeticSurface(T[L],T[L]);if(!((T=r.D(T,n.o.equalsEpsilon,!0,f.e.EPSILON7)).length<3)){var C=t(T);if(a.e(C)){(_=v.A.computeWindingOrder2D(C))===v.W.CLOCKWISE&&(C.reverse(),T=T.slice().reverse()),D.push(T),w.push(x.length),x=x.concat(T),I=I.concat(C);var N=0;for(a.e(A.holes)&&(N=A.holes.length),L=0;L<N;L++)h.enqueue(A.holes[L])}}}s.push({outerRing:d,holes:D}),u.push({positions:x,positions2D:I,holes:w})}}}return{hierarchy:s,polygons:u}};var A=new o.o,T=new n.o,C=new u.n,N=new p.p$1;y.computeBoundingRectangle=function(e,t,r,o,i){for(var s=u.n.fromAxisAngle(e,o,C),h=p.p$1.fromQuaternion(s,N),l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,g=r.length,y=0;y<g;++y){var d=n.o.clone(r[y],T);p.p$1.multiplyByVector(h,d,d);var m=t(d,A);a.e(m)&&(l=Math.min(l,m.x),c=Math.max(c,m.x),f=Math.min(f,m.y),v=Math.max(v,m.y))}return i.x=l,i.y=f,i.width=c-l,i.height=v-f,i},y.createGeometryFromPositions=function(e,r,o,n,a,s){var h=v.A.triangulate(r.positions2D,r.holes);h.length<3&&(h=[0,1,2]);var c=r.positions;if(n){for(var f=c.length,g=new Array(3*f),y=0,d=0;d<f;d++){var m=c[d];g[y++]=m.x,g[y++]=m.y,g[y++]=m.z}var b=new u.I({attributes:{position:new u.o({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:g})},indices:h,primitiveType:p._0x2355b9.TRIANGLES});return a.normal?l.k.computeNormal(b):b}return s===t.L.GEODESIC?v.A.computeSubdivision(e,c,h,o):s===t.L.RHUMB?v.A.computeRhumbLineSubdivision(e,c,h,o):void 0};var G=[],P=new n.o,O=new n.o;y.computeWallGeometry=function(e,r,o,a,s){var l,v,g,d,m,b=e.length,I=0;if(a)for(v=3*b*2,l=new Array(2*v),g=0;g<b;g++)d=e[g],m=e[(g+1)%b],l[I]=l[I+v]=d.x,l[++I]=l[I+v]=d.y,l[++I]=l[I+v]=d.z,l[++I]=l[I+v]=m.x,l[++I]=l[I+v]=m.y,l[++I]=l[I+v]=m.z,++I;else{var w=f.e.chordLength(o,r.maximumRadius),_=0;if(s===t.L.GEODESIC)for(g=0;g<b;g++)_+=y.subdivideLineCount(e[g],e[(g+1)%b],w);else if(s===t.L.RHUMB)for(g=0;g<b;g++)_+=y.subdivideRhumbLineCount(r,e[g],e[(g+1)%b],w);for(v=3*(_+b),l=new Array(2*v),g=0;g<b;g++){var L;d=e[g],m=e[(g+1)%b],s===t.L.GEODESIC?L=y.subdivideLine(d,m,w,G):s===t.L.RHUMB&&(L=y.subdivideRhumbLine(r,d,m,w,G));for(var x=L.length,E=0;E<x;++E,++I)l[I]=L[E],l[I+v]=L[E];l[I]=m.x,l[I+v]=m.x,l[++I]=m.y,l[I+v]=m.y,l[++I]=m.z,l[I+v]=m.z,++I}}b=l.length;var D=c.IndexDatatype.createTypedArray(b/3,b-6*e.length),S=0;for(b/=6,g=0;g<b;g++){var A=g,T=A+1,C=A+b,N=C+1;d=n.o.fromArray(l,3*A,P),m=n.o.fromArray(l,3*T,O),!n.o.equalsEpsilon(d,m,f.e.EPSILON10,f.e.EPSILON10)&&(D[S++]=A,D[S++]=C,D[S++]=T,D[S++]=T,D[S++]=C,D[S++]=N)}return new u.I({attributes:new h.a({position:new u.o({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:l})}),indices:D,primitiveType:p._0x2355b9.TRIANGLES})},e.y=y}));
