define(["exports","./Cartographic-81e9e8b2","./when-39df26e1","./Check-ff445961","./buildModuleUrl-1b968a9d","./Math-5e067eb3","./FeatureDetection-2d4141ff"],(function(e,r,t,n,i,o,a){"use strict";var u={};function s(e,r,t){var n=e+r;return o.e.sign(e)!==o.e.sign(r)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(r)))<t?0:n}u.computeDiscriminant=function(e,r,t){if("number"!=typeof e)throw new n.t("a is a required number.");if("number"!=typeof r)throw new n.t("b is a required number.");if("number"!=typeof t)throw new n.t("c is a required number.");return r*r-4*e*t},u.computeRealRoots=function(e,r,t){if("number"!=typeof e)throw new n.t("a is a required number.");if("number"!=typeof r)throw new n.t("b is a required number.");if("number"!=typeof t)throw new n.t("c is a required number.");var i;if(0===e)return 0===r?[]:[-t/r];if(0===r){if(0===t)return[0,0];var a=Math.abs(t),u=Math.abs(e);if(a<u&&a/u<o.e.EPSILON14)return[0,0];if(a>u&&u/a<o.e.EPSILON14)return[];if((i=-t/e)<0)return[];var f=Math.sqrt(i);return[-f,f]}if(0===t)return(i=-r/e)<0?[i,0]:[0,i];var c=s(r*r,-(4*e*t),o.e.EPSILON14);if(c<0)return[];var w=-.5*s(r,o.e.sign(r)*Math.sqrt(c),o.e.EPSILON14);return r>0?[w/e,t/w]:[t/w,w/e]};var f={};function c(e,r,t,n){var i,o,a=e,u=r/3,s=t/3,f=n,c=a*s,w=u*f,h=u*u,l=s*s,d=a*s-h,p=a*f-u*s,m=u*f-l,b=4*d*m-p*p;if(b<0){var g,v,q;h*w>=c*l?(g=a,v=d,q=-2*u*d+a*p):(g=f,v=m,q=-f*p+2*s*m);var M=-(q<0?-1:1)*Math.abs(g)*Math.sqrt(-b),y=(o=-q+M)/2,R=y<0?-Math.pow(-y,1/3):Math.pow(y,1/3),S=o===M?-R:-v/R;return i=v<=0?R+S:-q/(R*R+S*S+v),h*w>=c*l?[(i-u)/a]:[-f/(i+s)]}var O=d,P=-2*u*d+a*p,N=m,L=-f*p+2*s*m,$=Math.sqrt(b),E=Math.sqrt(3)/2,I=Math.abs(Math.atan2(a*$,-P)/3);i=2*Math.sqrt(-O);var C=Math.cos(I);o=i*C;var x=i*(-C/2-E*Math.sin(I)),z=o+x>2*u?o-u:x-u,U=a,T=z/U;I=Math.abs(Math.atan2(f*$,-L)/3);var W=-f,B=(o=(i=2*Math.sqrt(-N))*(C=Math.cos(I)))+(x=i*(-C/2-E*Math.sin(I)))<2*s?o+s:x+s,Z=W/B,D=-z*B-U*W,V=(s*D-u*(z*W))/(-u*D+s*(U*B));return T<=V?T<=Z?V<=Z?[T,V,Z]:[T,Z,V]:[Z,T,V]:T<=Z?[V,T,Z]:V<=Z?[V,Z,T]:[Z,V,T]}f.computeDiscriminant=function(e,r,t,i){if("number"!=typeof e)throw new n.t("a is a required number.");if("number"!=typeof r)throw new n.t("b is a required number.");if("number"!=typeof t)throw new n.t("c is a required number.");if("number"!=typeof i)throw new n.t("d is a required number.");var o=r*r,a=t*t;return 18*e*r*t*i+o*a-27*(e*e)*(i*i)-4*(e*a*t+o*r*i)},f.computeRealRoots=function(e,r,t,i){if("number"!=typeof e)throw new n.t("a is a required number.");if("number"!=typeof r)throw new n.t("b is a required number.");if("number"!=typeof t)throw new n.t("c is a required number.");if("number"!=typeof i)throw new n.t("d is a required number.");var o,a;if(0===e)return u.computeRealRoots(r,t,i);if(0===r){if(0===t){if(0===i)return[0,0,0];var s=(a=-i/e)<0?-Math.pow(-a,1/3):Math.pow(a,1/3);return[s,s,s]}return 0===i?0===(o=u.computeRealRoots(e,0,t)).Length?[0]:[o[0],0,o[1]]:c(e,0,t,i)}return 0===t?0===i?(a=-r/e)<0?[a,0,0]:[0,0,a]:c(e,r,0,i):0===i?0===(o=u.computeRealRoots(e,r,t)).length?[0]:o[1]<=0?[o[0],o[1],0]:o[0]>=0?[0,o[0],o[1]]:[o[0],0,o[1]]:c(e,r,t,i)};var w={};function h(e,r,t,n){var i=e*e,a=r-3*i/8,s=t-r*e/2+i*e/8,c=n-t*e/4+r*i/16-3*i*i/256,w=f.computeRealRoots(1,2*a,a*a-4*c,-s*s);if(w.length>0){var h=-e/4,l=w[w.length-1];if(Math.abs(l)<o.e.EPSILON14){var d=u.computeRealRoots(1,a,c);if(2===d.length){var p,m=d[0],b=d[1];if(m>=0&&b>=0){var g=Math.sqrt(m),v=Math.sqrt(b);return[h-v,h-g,h+g,h+v]}if(m>=0&&b<0)return[h-(p=Math.sqrt(m)),h+p];if(m<0&&b>=0)return[h-(p=Math.sqrt(b)),h+p]}return[]}if(l>0){var q=Math.sqrt(l),M=(a+l-s/q)/2,y=(a+l+s/q)/2,R=u.computeRealRoots(1,q,M),S=u.computeRealRoots(1,-q,y);return 0!==R.length?(R[0]+=h,R[1]+=h,0!==S.length?(S[0]+=h,S[1]+=h,R[1]<=S[0]?[R[0],R[1],S[0],S[1]]:S[1]<=R[0]?[S[0],S[1],R[0],R[1]]:R[0]>=S[0]&&R[1]<=S[1]?[S[0],R[0],R[1],S[1]]:S[0]>=R[0]&&S[1]<=R[1]?[R[0],S[0],S[1],R[1]]:R[0]>S[0]&&R[0]<S[1]?[S[0],R[0],S[1],R[1]]:[R[0],S[0],R[1],S[1]]):R):0!==S.length?(S[0]+=h,S[1]+=h,S):[]}}return[]}function l(e,r,t,n){var i=e*e,a=-2*r,s=t*e+r*r-4*n,c=i*n-t*r*e+t*t,w=f.computeRealRoots(1,a,s,c);if(w.length>0){var h,l,d,p,m,b,g=w[0],v=r-g,q=v*v,M=e/2,y=v/2,R=q-4*n,S=q+4*Math.abs(n),O=i-4*g,P=i+4*Math.abs(g);if(g<0||R*P<O*S){var N=Math.sqrt(O);h=N/2,l=0===N?0:(e*y-t)/N}else{var L=Math.sqrt(R);h=0===L?0:(e*y-t)/L,l=L/2}0===M&&0===h?(d=0,p=0):o.e.sign(M)===o.e.sign(h)?p=g/(d=M+h):d=g/(p=M-h),0===y&&0===l?(m=0,b=0):o.e.sign(y)===o.e.sign(l)?b=n/(m=y+l):m=n/(b=y-l);var $=u.computeRealRoots(1,d,m),E=u.computeRealRoots(1,p,b);if(0!==$.length)return 0!==E.length?$[1]<=E[0]?[$[0],$[1],E[0],E[1]]:E[1]<=$[0]?[E[0],E[1],$[0],$[1]]:$[0]>=E[0]&&$[1]<=E[1]?[E[0],$[0],$[1],E[1]]:E[0]>=$[0]&&E[1]<=$[1]?[$[0],E[0],E[1],$[1]]:$[0]>E[0]&&$[0]<E[1]?[E[0],$[0],E[1],$[1]]:[$[0],E[0],$[1],E[1]]:$;if(0!==E.length)return E}return[]}function d(e,n){n=r.o.clone(t.u(n,r.o.ZERO)),r.o.equals(n,r.o.ZERO)||r.o.normalize(n,n),this.origin=r.o.clone(t.u(e,r.o.ZERO)),this.direction=n}w.computeDiscriminant=function(e,r,t,i,o){if("number"!=typeof e)throw new n.t("a is a required number.");if("number"!=typeof r)throw new n.t("b is a required number.");if("number"!=typeof t)throw new n.t("c is a required number.");if("number"!=typeof i)throw new n.t("d is a required number.");if("number"!=typeof o)throw new n.t("e is a required number.");var a=e*e,u=r*r,s=u*r,f=t*t,c=f*t,w=i*i,h=w*i,l=o*o;return u*f*w-4*s*h-4*e*c*w+18*e*r*t*h-27*a*w*w+256*(a*e)*(l*o)+o*(18*s*t*i-4*u*c+16*e*f*f-80*e*r*f*i-6*e*u*w+144*a*t*w)+l*(144*e*u*t-27*u*u-128*a*f-192*a*r*i)},w.computeRealRoots=function(e,r,t,i,a){if("number"!=typeof e)throw new n.t("a is a required number.");if("number"!=typeof r)throw new n.t("b is a required number.");if("number"!=typeof t)throw new n.t("c is a required number.");if("number"!=typeof i)throw new n.t("d is a required number.");if("number"!=typeof a)throw new n.t("e is a required number.");if(Math.abs(e)<o.e.EPSILON15)return f.computeRealRoots(r,t,i,a);var u=r/e,s=t/e,c=i/e,w=a/e,d=u<0?1:0;switch(d+=s<0?d+1:d,d+=c<0?d+1:d,d+=w<0?d+1:d){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return h(u,s,c,w);case 1:case 2:case 5:case 8:case 11:return l(u,s,c,w);default:return}},d.clone=function(e,n){if(t.e(e))return t.e(n)?(n.origin=r.o.clone(e.origin),n.direction=r.o.clone(e.direction),n):new d(e.origin,e.direction)},d.getPoint=function(e,i,o){return n.o.typeOf.object("ray",e),n.o.typeOf.number("t",i),t.e(o)||(o=new r.o),o=r.o.multiplyByScalar(e.direction,i,o),r.o.add(e.origin,o,o)};var p={rayPlane:function(e,i,a){if(!t.e(e))throw new n.t("ray is required.");if(!t.e(i))throw new n.t("plane is required.");t.e(a)||(a=new r.o);var u=e.origin,s=e.direction,f=i.normal,c=r.o.dot(f,s);if(!(Math.abs(c)<o.e.EPSILON15)){var w=(-i.distance-r.o.dot(f,u))/c;if(!(w<0))return a=r.o.multiplyByScalar(s,w,a),r.o.add(u,a,a)}}},m=new r.o,b=new r.o,g=new r.o,v=new r.o,q=new r.o;p.rayTriangleParametric=function(e,i,a,u,s){if(!t.e(e))throw new n.t("ray is required.");if(!t.e(i))throw new n.t("p0 is required.");if(!t.e(a))throw new n.t("p1 is required.");if(!t.e(u))throw new n.t("p2 is required.");s=t.u(s,!1);var f,c,w,h,l,d=e.origin,p=e.direction,M=r.o.subtract(a,i,m),y=r.o.subtract(u,i,b),R=r.o.cross(p,y,g),S=r.o.dot(M,R);if(s){if(S<o.e.EPSILON6||(f=r.o.subtract(d,i,v),(w=r.o.dot(f,R))<0||w>S)||(c=r.o.cross(f,M,q),(h=r.o.dot(p,c))<0||w+h>S))return;l=r.o.dot(y,c)/S}else{if(Math.abs(S)<o.e.EPSILON6)return;var O=1/S;if(f=r.o.subtract(d,i,v),(w=r.o.dot(f,R)*O)<0||w>1||(c=r.o.cross(f,M,q),(h=r.o.dot(p,c)*O)<0||w+h>1))return;l=r.o.dot(y,c)*O}return l},p.rayTriangle=function(e,n,i,o,a,u){var s=p.rayTriangleParametric(e,n,i,o,a);if(t.e(s)&&!(s<0))return t.e(u)||(u=new r.o),r.o.multiplyByScalar(e.direction,s,u),r.o.add(e.origin,u,u)};var M=new d;p.lineSegmentTriangle=function(e,i,o,a,u,s,f){if(!t.e(e))throw new n.t("v0 is required.");if(!t.e(i))throw new n.t("v1 is required.");if(!t.e(o))throw new n.t("p0 is required.");if(!t.e(a))throw new n.t("p1 is required.");if(!t.e(u))throw new n.t("p2 is required.");var c=M;r.o.clone(e,c.origin),r.o.subtract(i,e,c.direction),r.o.normalize(c.direction,c.direction);var w=p.rayTriangleParametric(c,o,a,u,s);if(!(!t.e(w)||w<0||w>r.o.distance(e,i)))return t.e(f)||(f=new r.o),r.o.multiplyByScalar(c.direction,w,f),r.o.add(c.origin,f,f)};var y={root0:0,root1:0};function R(e,n,o){t.e(o)||(o=new i.o);var a=e.origin,u=e.direction,s=n.center,f=n.radius*n.radius,c=r.o.subtract(a,s,g),w=function(e,r,t,n){var i=r*r-4*e*t;if(!(i<0)){if(i>0){var o=1/(2*e),a=Math.sqrt(i),u=(-r+a)*o,s=(-r-a)*o;return u<s?(n.root0=u,n.root1=s):(n.root0=s,n.root1=u),n}var f=-r/(2*e);if(0!==f)return n.root0=n.root1=f,n}}(r.o.dot(u,u),2*r.o.dot(u,c),r.o.magnitudeSquared(c)-f,y);if(t.e(w))return o.start=w.root0,o.stop=w.root1,o}p.raySphere=function(e,r,i){if(!t.e(e))throw new n.t("ray is required.");if(!t.e(r))throw new n.t("sphere is required.");if(i=R(e,r,i),t.e(i)&&!(i.stop<0))return i.start=Math.max(i.start,0),i};var S=new d;p.lineSegmentSphere=function(e,i,o,a){if(!t.e(e))throw new n.t("p0 is required.");if(!t.e(i))throw new n.t("p1 is required.");if(!t.e(o))throw new n.t("sphere is required.");var u=S;r.o.clone(e,u.origin);var s=r.o.subtract(i,e,u.direction),f=r.o.magnitude(s);if(r.o.normalize(s,s),a=R(u,o,a),!(!t.e(a)||a.stop<0||a.start>f))return a.start=Math.max(a.start,0),a.stop=Math.min(a.stop,f),a};var O=new r.o,P=new r.o;function N(e,r,t){var n=e+r;return o.e.sign(e)!==o.e.sign(r)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(r)))<t?0:n}function L(e,t,n,i,s){var f,c=i*i,h=s*s,l=(e[a.p$1.COLUMN1ROW1]-e[a.p$1.COLUMN2ROW2])*h,d=s*(i*N(e[a.p$1.COLUMN1ROW0],e[a.p$1.COLUMN0ROW1],o.e.EPSILON15)+t.y),p=e[a.p$1.COLUMN0ROW0]*c+e[a.p$1.COLUMN2ROW2]*h+i*t.x+n,m=h*N(e[a.p$1.COLUMN2ROW1],e[a.p$1.COLUMN1ROW2],o.e.EPSILON15),b=s*(i*N(e[a.p$1.COLUMN2ROW0],e[a.p$1.COLUMN0ROW2])+t.z),g=[];if(0===b&&0===m){if(0===(f=u.computeRealRoots(l,d,p)).length)return g;var v=f[0],q=Math.sqrt(Math.max(1-v*v,0));if(g.push(new r.o(i,s*v,s*-q)),g.push(new r.o(i,s*v,s*q)),2===f.length){var M=f[1],y=Math.sqrt(Math.max(1-M*M,0));g.push(new r.o(i,s*M,s*-y)),g.push(new r.o(i,s*M,s*y))}return g}var R=b*b,S=m*m,O=b*m,P=l*l+S,L=2*(d*l+O),$=2*p*l+d*d-S+R,E=2*(p*d-O),I=p*p-R;if(0===P&&0===L&&0===$&&0===E)return g;var C=(f=w.computeRealRoots(P,L,$,E,I)).length;if(0===C)return g;for(var x=0;x<C;++x){var z=f[x],U=z*z,T=Math.max(1-U,0),W=Math.sqrt(T),B=(o.e.sign(l)===o.e.sign(p)?N(l*U+p,d*z,o.e.EPSILON12):o.e.sign(p)===o.e.sign(d*z)?N(l*U,d*z+p,o.e.EPSILON12):N(l*U+d*z,p,o.e.EPSILON12))*N(m*z,b,o.e.EPSILON15);B<0?g.push(new r.o(i,s*z,s*W)):B>0?g.push(new r.o(i,s*z,s*-W)):0!==W?(g.push(new r.o(i,s*z,s*-W)),g.push(new r.o(i,s*z,s*W)),++x):g.push(new r.o(i,s*z,s*W))}return g}p.rayEllipsoid=function(e,o){if(!t.e(e))throw new n.t("ray is required.");if(!t.e(o))throw new n.t("ellipsoid is required.");var a,u,s,f,c,w=o.oneOverRadii,h=r.o.multiplyComponents(w,e.origin,O),l=r.o.multiplyComponents(w,e.direction,P),d=r.o.magnitudeSquared(h),p=r.o.dot(h,l);if(d>1){if(p>=0)return;var m=p*p;if(a=d-1,m<(s=(u=r.o.magnitudeSquared(l))*a))return;if(m>s){f=p*p-s;var b=(c=-p+Math.sqrt(f))/u,g=a/c;return b<g?new i.o(b,g):{start:g,stop:b}}var v=Math.sqrt(a/u);return new i.o(v,v)}return d<1?(a=d-1,f=p*p-(s=(u=r.o.magnitudeSquared(l))*a),c=-p+Math.sqrt(f),new i.o(0,c/u)):p<0?(u=r.o.magnitudeSquared(l),new i.o(0,-p/u)):void 0};var $=new r.o,E=new r.o,I=new r.o,C=new r.o,x=new r.o,z=new a.p$1,U=new a.p$1,T=new a.p$1,W=new a.p$1,B=new a.p$1,Z=new a.p$1,D=new a.p$1,V=new r.o,A=new r.o,F=new r.a;p.grazingAltitudeLocation=function(e,i){if(!t.e(e))throw new n.t("ray is required.");if(!t.e(i))throw new n.t("ellipsoid is required.");var u=e.origin,s=e.direction;if(!r.o.equals(u,r.o.ZERO)){var f=i.geodeticSurfaceNormal(u,$);if(r.o.dot(s,f)>=0)return u}var c=t.e(this.rayEllipsoid(e,i)),w=i.transformPositionToScaledSpace(s,$),h=r.o.normalize(w,w),l=r.o.mostOrthogonalAxis(w,C),d=r.o.normalize(r.o.cross(l,h,E),E),p=r.o.normalize(r.o.cross(h,d,I),I),m=z;m[0]=h.x,m[1]=h.y,m[2]=h.z,m[3]=d.x,m[4]=d.y,m[5]=d.z,m[6]=p.x,m[7]=p.y,m[8]=p.z;var b=a.p$1.transpose(m,U),g=a.p$1.fromScale(i.radii,T),v=a.p$1.fromScale(i.oneOverRadii,W),q=B;q[0]=0,q[1]=-s.z,q[2]=s.y,q[3]=s.z,q[4]=0,q[5]=-s.x,q[6]=-s.y,q[7]=s.x,q[8]=0;var M,y,R=a.p$1.multiply(a.p$1.multiply(b,v,Z),q,Z),S=a.p$1.multiply(a.p$1.multiply(R,g,D),m,D),O=a.p$1.multiplyByVector(R,u,x),P=L(S,r.o.negate(O,$),0,0,1),N=P.length;if(N>0){for(var j=r.o.clone(r.o.ZERO,A),k=Number.NEGATIVE_INFINITY,G=0;G<N;++G){M=a.p$1.multiplyByVector(g,a.p$1.multiplyByVector(m,P[G],V),V);var Y=r.o.normalize(r.o.subtract(M,u,C),C),_=r.o.dot(Y,s);_>k&&(k=_,j=r.o.clone(M,j))}var H=i.cartesianToCartographic(j,F);return k=o.e.clamp(k,0,1),y=r.o.magnitude(r.o.subtract(j,u,C))*Math.sqrt(1-k*k),y=c?-y:y,H.height=y,i.cartographicToCartesian(H,new r.o)}};var j=new r.o;p.lineSegmentPlane=function(e,i,a,u){if(!t.e(e))throw new n.t("endPoint0 is required.");if(!t.e(i))throw new n.t("endPoint1 is required.");if(!t.e(a))throw new n.t("plane is required.");t.e(u)||(u=new r.o);var s=r.o.subtract(i,e,j),f=a.normal,c=r.o.dot(f,s);if(!(Math.abs(c)<o.e.EPSILON6)){var w=r.o.dot(f,e),h=-(a.distance+w)/c;if(!(h<0||h>1))return r.o.multiplyByScalar(s,h,u),r.o.add(e,u,u),u}},p.trianglePlaneIntersection=function(e,i,o,a){if(!(t.e(e)&&t.e(i)&&t.e(o)&&t.e(a)))throw new n.t("p0, p1, p2, and plane are required.");var u,s,f=a.normal,c=a.distance,w=r.o.dot(f,e)+c<0,h=r.o.dot(f,i)+c<0,l=r.o.dot(f,o)+c<0,d=0;if(d+=w?1:0,d+=h?1:0,(1===(d+=l?1:0)||2===d)&&(u=new r.o,s=new r.o),1===d){if(w)return p.lineSegmentPlane(e,i,a,u),p.lineSegmentPlane(e,o,a,s),{positions:[e,i,o,u,s],indices:[0,3,4,1,2,4,1,4,3]};if(h)return p.lineSegmentPlane(i,o,a,u),p.lineSegmentPlane(i,e,a,s),{positions:[e,i,o,u,s],indices:[1,3,4,2,0,4,2,4,3]};if(l)return p.lineSegmentPlane(o,e,a,u),p.lineSegmentPlane(o,i,a,s),{positions:[e,i,o,u,s],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===d){if(!w)return p.lineSegmentPlane(i,e,a,u),p.lineSegmentPlane(o,e,a,s),{positions:[e,i,o,u,s],indices:[1,2,4,1,4,3,0,3,4]};if(!h)return p.lineSegmentPlane(o,i,a,u),p.lineSegmentPlane(e,i,a,s),{positions:[e,i,o,u,s],indices:[2,0,4,2,4,3,1,3,4]};if(!l)return p.lineSegmentPlane(e,o,a,u),p.lineSegmentPlane(i,o,a,s),{positions:[e,i,o,u,s],indices:[0,1,4,0,4,3,2,3,4]}}},e.f=d,e.g=p}));
