define(["./AttributeCompression-4cf880dc","./Cartographic-81e9e8b2","./Color-3ecb6d08","./when-39df26e1","./Cartesian2-59a54ee7","./IndexDatatype-be421fbf","./Math-5e067eb3","./OrientedBoundingBox-7144be8f","./createTaskProcessorWorker","./Check-ff445961","./FeatureDetection-2d4141ff","./Cartesian4-a56bd360","./RuntimeError-251a1d8d","./WebGLConstants-42651efd","./buildModuleUrl-1b968a9d","./Event-e109b23e","./EllipsoidTangentPlane-ee91c10e","./IntersectionTests-036daea1","./Plane-775a5120","./GeometryAttribute-9b3921a3","./PolygonPipeline-ae195f4e","./ComponentDatatype-7d28dd1c","./EllipsoidRhumbLine-61b02483"],(function(e,r,a,t,n,o,i,f,s,d,c,h,u,l,b,p,y,g,v,I,m,w,x){"use strict";var A=new r.o,N=new n.t,k=new n.h,E={min:void 0,max:void 0,indexBytesPerElement:void 0};function T(e,r,t){var n=r.length,o=2+n*f.y.packedLength+1+function(e){for(var r=e.length,t=0,n=0;n<r;++n)t+=a.e.packedLength+3+e[n].batchIds.length;return t}(t),i=new Float64Array(o),s=0;i[s++]=e,i[s++]=n;for(var d=0;d<n;++d)f.y.pack(r[d],i,s),s+=f.y.packedLength;var c=t.length;i[s++]=c;for(var h=0;h<c;++h){var u=t[h];a.e.pack(u.color,i,s),s+=a.e.packedLength,i[s++]=u.offset,i[s++]=u.count;var l=u.batchIds,b=l.length;i[s++]=b;for(var p=0;p<b;++p)i[s++]=l[p]}return i}var L=new r.o,C=new r.o,P=new r.o,U=new r.o,O=new r.o,F=new r.a,B=new n.h;return s((function(s,d){var c;!function(e){var a=new Float64Array(e),t=0;E.indexBytesPerElement=a[t++],E.min=a[t++],E.max=a[t++],r.o.unpack(a,t,A),t+=r.o.packedLength,n.t.unpack(a,t,N),t+=n.t.packedLength,n.h.unpack(a,t,k)}(s.packedBuffer),c=2===E.indexBytesPerElement?new Uint16Array(s.indices):new Uint32Array(s.indices);var h,u,l,b=new Uint16Array(s.positions),p=new Uint32Array(s.counts),y=new Uint32Array(s.indexCounts),g=new Uint32Array(s.batchIds),v=new Uint32Array(s.batchTableColors),I=new Array(p.length),m=A,w=N,x=k,D=E.min,S=E.max,_=s.minimumHeights,G=s.maximumHeights;t.e(_)&&t.e(G)&&(_=new Float32Array(_),G=new Float32Array(G));var M=b.length/2,R=b.subarray(0,M),Y=b.subarray(M,2*M);e.t.zigZagDeltaDecode(R,Y);var V=new Float32Array(3*M);for(h=0;h<M;++h){var H=R[h],W=Y[h],z=i.e.lerp(x.west,x.east,H/32767),Z=i.e.lerp(x.south,x.north,W/32767),j=r.a.fromRadians(z,Z,0,F),q=w.cartographicToCartesian(j,L);r.o.pack(q,V,3*h)}var J=p.length,K=new Array(J),Q=new Array(J),X=0,$=0;for(h=0;h<J;++h)K[h]=X,Q[h]=$,X+=p[h],$+=y[h];var ee,re=new Float32Array(3*M*2),ae=new Uint16Array(2*M),te=new Uint32Array(Q.length),ne=new Uint32Array(y.length),oe=[],ie={};for(h=0;h<J;++h)l=v[h],t.e(ie[l])?(ie[l].positionLength+=p[h],ie[l].indexLength+=y[h],ie[l].batchIds.push(h)):ie[l]={positionLength:p[h],indexLength:y[h],offset:0,indexOffset:0,batchIds:[h]};var fe=0,se=0;for(l in ie)if(ie.hasOwnProperty(l)){(ee=ie[l]).offset=fe,ee.indexOffset=se;var de=2*ee.positionLength,ce=2*ee.indexLength+6*ee.positionLength;fe+=de,se+=ce,ee.indexLength=ce}var he=[];for(l in ie)ie.hasOwnProperty(l)&&(ee=ie[l],he.push({color:a.e.fromRgba(parseInt(l)),offset:ee.indexOffset,count:ee.indexLength,batchIds:ee.batchIds}));for(h=0;h<J;++h){var ue=(ee=ie[l=v[h]]).offset,le=3*ue,be=ue,pe=K[h],ye=p[h],ge=g[h],ve=D,Ie=S;t.e(_)&&t.e(G)&&(ve=_[h],Ie=G[h]);var me=Number.POSITIVE_INFINITY,we=Number.NEGATIVE_INFINITY,xe=Number.POSITIVE_INFINITY,Ae=Number.NEGATIVE_INFINITY;for(u=0;u<ye;++u){var Ne=r.o.unpack(V,3*pe+3*u,L);w.scaleToGeodeticSurface(Ne,Ne);var ke=w.cartesianToCartographic(Ne,F),Ee=ke.latitude,Te=ke.longitude;me=Math.min(Ee,me),we=Math.max(Ee,we),xe=Math.min(Te,xe),Ae=Math.max(Te,Ae);var Le=w.geodeticSurfaceNormal(Ne,C),Ce=r.o.multiplyByScalar(Le,ve,P),Pe=r.o.add(Ne,Ce,U);Ce=r.o.multiplyByScalar(Le,Ie,Ce);var Ue=r.o.add(Ne,Ce,O);r.o.subtract(Ue,m,Ue),r.o.subtract(Pe,m,Pe),r.o.pack(Ue,re,le),r.o.pack(Pe,re,le+3),ae[be]=ge,ae[be+1]=ge,le+=6,be+=2}(x=B).west=xe,x.east=Ae,x.south=me,x.north=we,I[h]=f.y.fromRectangle(x,D,S,w);var Oe=ee.indexOffset,Fe=Q[h],Be=y[h];for(te[h]=Oe,u=0;u<Be;u+=3){var De=c[Fe+u]-pe,Se=c[Fe+u+1]-pe,_e=c[Fe+u+2]-pe;oe[Oe++]=2*De+ue,oe[Oe++]=2*Se+ue,oe[Oe++]=2*_e+ue,oe[Oe++]=2*_e+1+ue,oe[Oe++]=2*Se+1+ue,oe[Oe++]=2*De+1+ue}for(u=0;u<ye;++u){var Ge=u,Me=(u+1)%ye;oe[Oe++]=2*Ge+1+ue,oe[Oe++]=2*Me+ue,oe[Oe++]=2*Ge+ue,oe[Oe++]=2*Ge+1+ue,oe[Oe++]=2*Me+1+ue,oe[Oe++]=2*Me+ue}ee.offset+=2*ye,ee.indexOffset=Oe,ne[h]=Oe-te[h]}oe=o.IndexDatatype.createTypedArray(re.length/3,oe);for(var Re=he.length,Ye=0;Ye<Re;++Ye){for(var Ve=he[Ye].batchIds,He=0,We=Ve.length,ze=0;ze<We;++ze)He+=ne[Ve[ze]];he[Ye].count=He}var Ze=T(2===oe.BYTES_PER_ELEMENT?o.IndexDatatype.UNSIGNED_SHORT:o.IndexDatatype.UNSIGNED_INT,I,he);return d.push(re.buffer,oe.buffer,te.buffer,ne.buffer,ae.buffer,Ze.buffer),{positions:re.buffer,indices:oe.buffer,indexOffsets:te.buffer,indexCounts:ne.buffer,batchIds:ae.buffer,packedBuffer:Ze.buffer}}))}));
