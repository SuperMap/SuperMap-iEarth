define(["./AttributeCompression-e8590010","./Cartesian3-fecb63f1","./Cartographic-d606c511","./Color-9f7c6a0d","./when-92c6cf3c","./Cartesian2-21b2f76f","./IndexDatatype-86677ec4","./Math-ecf82623","./OrientedBoundingBox-3b7efc31","./createTaskProcessorWorker","./Check-52a7d806","./FeatureDetection-7479e310","./Cartesian4-72b88c9e","./RuntimeError-c6a62a80","./WebGLConstants-42651efd","./buildModuleUrl-d80eb436","./Event-3390cd7d","./EllipsoidTangentPlane-8fa0b2bb","./IntersectionTests-d75410df","./Plane-11c91fbf","./GeometryAttribute-60174428","./PolygonPipeline-d4333960","./ComponentDatatype-98414d16","./EllipsoidRhumbLine-79383554"],(function(e,r,t,a,n,o,i,f,s,c,d,h,u,l,p,b,y,g,v,I,m,w,x,A){"use strict";var N=new r.o,k=new o.t,E=new o.h,T={min:void 0,max:void 0,indexBytesPerElement:void 0};function L(e,r,t){var n=r.length,o=2+n*s.y.packedLength+1+function(e){for(var r=e.length,t=0,n=0;n<r;++n)t+=a.e.packedLength+3+e[n].batchIds.length;return t}(t),i=new Float64Array(o),f=0;i[f++]=e,i[f++]=n;for(var c=0;c<n;++c)s.y.pack(r[c],i,f),f+=s.y.packedLength;var d=t.length;i[f++]=d;for(var h=0;h<d;++h){var u=t[h];a.e.pack(u.color,i,f),f+=a.e.packedLength,i[f++]=u.offset,i[f++]=u.count;var l=u.batchIds,p=l.length;i[f++]=p;for(var b=0;b<p;++b)i[f++]=l[b]}return i}var C=new r.o,P=new r.o,U=new r.o,O=new r.o,F=new r.o,B=new t.a,D=new o.h;return c((function(c,d){var h;!function(e){var t=new Float64Array(e),a=0;T.indexBytesPerElement=t[a++],T.min=t[a++],T.max=t[a++],r.o.unpack(t,a,N),a+=r.o.packedLength,o.t.unpack(t,a,k),a+=o.t.packedLength,o.h.unpack(t,a,E)}(c.packedBuffer),h=2===T.indexBytesPerElement?new Uint16Array(c.indices):new Uint32Array(c.indices);var u,l,p,b=new Uint16Array(c.positions),y=new Uint32Array(c.counts),g=new Uint32Array(c.indexCounts),v=new Uint32Array(c.batchIds),I=new Uint32Array(c.batchTableColors),m=new Array(y.length),w=N,x=k,A=E,S=T.min,_=T.max,G=c.minimumHeights,M=c.maximumHeights;n.e(G)&&n.e(M)&&(G=new Float32Array(G),M=new Float32Array(M));var R=b.length/2,Y=b.subarray(0,R),V=b.subarray(R,2*R);e.t.zigZagDeltaDecode(Y,V);var H=new Float32Array(3*R);for(u=0;u<R;++u){var W=Y[u],z=V[u],Z=f.e.lerp(A.west,A.east,W/32767),j=f.e.lerp(A.south,A.north,z/32767),q=t.a.fromRadians(Z,j,0,B),J=x.cartographicToCartesian(q,C);r.o.pack(J,H,3*u)}var K=y.length,Q=new Array(K),X=new Array(K),$=0,ee=0;for(u=0;u<K;++u)Q[u]=$,X[u]=ee,$+=y[u],ee+=g[u];var re,te=new Float32Array(3*R*2),ae=new Uint16Array(2*R),ne=new Uint32Array(X.length),oe=new Uint32Array(g.length),ie=[],fe={};for(u=0;u<K;++u)p=I[u],n.e(fe[p])?(fe[p].positionLength+=y[u],fe[p].indexLength+=g[u],fe[p].batchIds.push(u)):fe[p]={positionLength:y[u],indexLength:g[u],offset:0,indexOffset:0,batchIds:[u]};var se=0,ce=0;for(p in fe)if(fe.hasOwnProperty(p)){(re=fe[p]).offset=se,re.indexOffset=ce;var de=2*re.positionLength,he=2*re.indexLength+6*re.positionLength;se+=de,ce+=he,re.indexLength=he}var ue=[];for(p in fe)fe.hasOwnProperty(p)&&(re=fe[p],ue.push({color:a.e.fromRgba(parseInt(p)),offset:re.indexOffset,count:re.indexLength,batchIds:re.batchIds}));for(u=0;u<K;++u){var le=(re=fe[p=I[u]]).offset,pe=3*le,be=le,ye=Q[u],ge=y[u],ve=v[u],Ie=S,me=_;n.e(G)&&n.e(M)&&(Ie=G[u],me=M[u]);var we=Number.POSITIVE_INFINITY,xe=Number.NEGATIVE_INFINITY,Ae=Number.POSITIVE_INFINITY,Ne=Number.NEGATIVE_INFINITY;for(l=0;l<ge;++l){var ke=r.o.unpack(H,3*ye+3*l,C);x.scaleToGeodeticSurface(ke,ke);var Ee=x.cartesianToCartographic(ke,B),Te=Ee.latitude,Le=Ee.longitude;we=Math.min(Te,we),xe=Math.max(Te,xe),Ae=Math.min(Le,Ae),Ne=Math.max(Le,Ne);var Ce=x.geodeticSurfaceNormal(ke,P),Pe=r.o.multiplyByScalar(Ce,Ie,U),Ue=r.o.add(ke,Pe,O);Pe=r.o.multiplyByScalar(Ce,me,Pe);var Oe=r.o.add(ke,Pe,F);r.o.subtract(Oe,w,Oe),r.o.subtract(Ue,w,Ue),r.o.pack(Oe,te,pe),r.o.pack(Ue,te,pe+3),ae[be]=ve,ae[be+1]=ve,pe+=6,be+=2}(A=D).west=Ae,A.east=Ne,A.south=we,A.north=xe,m[u]=s.y.fromRectangle(A,S,_,x);var Fe=re.indexOffset,Be=X[u],De=g[u];for(ne[u]=Fe,l=0;l<De;l+=3){var Se=h[Be+l]-ye,_e=h[Be+l+1]-ye,Ge=h[Be+l+2]-ye;ie[Fe++]=2*Se+le,ie[Fe++]=2*_e+le,ie[Fe++]=2*Ge+le,ie[Fe++]=2*Ge+1+le,ie[Fe++]=2*_e+1+le,ie[Fe++]=2*Se+1+le}for(l=0;l<ge;++l){var Me=l,Re=(l+1)%ge;ie[Fe++]=2*Me+1+le,ie[Fe++]=2*Re+le,ie[Fe++]=2*Me+le,ie[Fe++]=2*Me+1+le,ie[Fe++]=2*Re+1+le,ie[Fe++]=2*Re+le}re.offset+=2*ge,re.indexOffset=Fe,oe[u]=Fe-ne[u]}ie=i.IndexDatatype.createTypedArray(te.length/3,ie);for(var Ye=ue.length,Ve=0;Ve<Ye;++Ve){for(var He=ue[Ve].batchIds,We=0,ze=He.length,Ze=0;Ze<ze;++Ze)We+=oe[He[Ze]];ue[Ve].count=We}var je=L(2===ie.BYTES_PER_ELEMENT?i.IndexDatatype.UNSIGNED_SHORT:i.IndexDatatype.UNSIGNED_INT,m,ue);return d.push(te.buffer,ie.buffer,ne.buffer,oe.buffer,ae.buffer,je.buffer),{positions:te.buffer,indices:ie.buffer,indexOffsets:ne.buffer,indexCounts:oe.buffer,batchIds:ae.buffer,packedBuffer:je.buffer}}))}));
