define(["./AttributeCompression-b5a80a71","./Cartesian3-3a8bdb0b","./Cartographic-a2c313d7","./Color-98063b35","./when-92c6cf3c","./Cartesian2-b72655a5","./IndexDatatype-86677ec4","./Math-ecf82623","./OrientedBoundingBox-d2eb0b92","./createTaskProcessorWorker","./Check-52a7d806","./FeatureDetection-cec0163f","./Cartesian4-72b88c9e","./RuntimeError-c6a62a80","./WebGLConstants-42651efd","./buildModuleUrl-9eef8841","./Event-3390cd7d","./EllipsoidTangentPlane-d6b88a1f","./IntersectionTests-6e80d61c","./Plane-33393da8","./GeometryAttribute-f47bd1cb","./PolygonPipeline-425528b3","./ComponentDatatype-98414d16","./EllipsoidRhumbLine-b1a766ae"],(function(e,a,r,t,n,o,i,f,s,c,d,h,u,l,b,p,y,g,v,I,m,w,x,A){"use strict";var N=new a.o,k=new o.t,E=new o.h,T={min:void 0,max:void 0,indexBytesPerElement:void 0};function L(e,a,r){var n=a.length,o=2+n*s.y.packedLength+1+function(e){for(var a=e.length,r=0,n=0;n<a;++n)r+=t.e.packedLength+3+e[n].batchIds.length;return r}(r),i=new Float64Array(o),f=0;i[f++]=e,i[f++]=n;for(var c=0;c<n;++c)s.y.pack(a[c],i,f),f+=s.y.packedLength;var d=r.length;i[f++]=d;for(var h=0;h<d;++h){var u=r[h];t.e.pack(u.color,i,f),f+=t.e.packedLength,i[f++]=u.offset,i[f++]=u.count;var l=u.batchIds,b=l.length;i[f++]=b;for(var p=0;p<b;++p)i[f++]=l[p]}return i}var C=new a.o,P=new a.o,U=new a.o,O=new a.o,F=new a.o,B=new r.a,D=new o.h;return c((function(c,d){var h;!function(e){var r=new Float64Array(e),t=0;T.indexBytesPerElement=r[t++],T.min=r[t++],T.max=r[t++],a.o.unpack(r,t,N),t+=a.o.packedLength,o.t.unpack(r,t,k),t+=o.t.packedLength,o.h.unpack(r,t,E)}(c.packedBuffer),h=2===T.indexBytesPerElement?new Uint16Array(c.indices):new Uint32Array(c.indices);var u,l,b,p=new Uint16Array(c.positions),y=new Uint32Array(c.counts),g=new Uint32Array(c.indexCounts),v=new Uint32Array(c.batchIds),I=new Uint32Array(c.batchTableColors),m=new Array(y.length),w=N,x=k,A=E,S=T.min,_=T.max,G=c.minimumHeights,M=c.maximumHeights;n.e(G)&&n.e(M)&&(G=new Float32Array(G),M=new Float32Array(M));var R=p.length/2,Y=p.subarray(0,R),V=p.subarray(R,2*R);e.t.zigZagDeltaDecode(Y,V);var H=new Float32Array(3*R);for(u=0;u<R;++u){var W=Y[u],z=V[u],Z=f.e.lerp(A.west,A.east,W/32767),j=f.e.lerp(A.south,A.north,z/32767),q=r.a.fromRadians(Z,j,0,B),J=x.cartographicToCartesian(q,C);a.o.pack(J,H,3*u)}var K=y.length,Q=new Array(K),X=new Array(K),$=0,ee=0;for(u=0;u<K;++u)Q[u]=$,X[u]=ee,$+=y[u],ee+=g[u];var ae,re=new Float32Array(3*R*2),te=new Uint16Array(2*R),ne=new Uint32Array(X.length),oe=new Uint32Array(g.length),ie=[],fe={};for(u=0;u<K;++u)b=I[u],n.e(fe[b])?(fe[b].positionLength+=y[u],fe[b].indexLength+=g[u],fe[b].batchIds.push(u)):fe[b]={positionLength:y[u],indexLength:g[u],offset:0,indexOffset:0,batchIds:[u]};var se=0,ce=0;for(b in fe)if(fe.hasOwnProperty(b)){(ae=fe[b]).offset=se,ae.indexOffset=ce;var de=2*ae.positionLength,he=2*ae.indexLength+6*ae.positionLength;se+=de,ce+=he,ae.indexLength=he}var ue=[];for(b in fe)fe.hasOwnProperty(b)&&(ae=fe[b],ue.push({color:t.e.fromRgba(parseInt(b)),offset:ae.indexOffset,count:ae.indexLength,batchIds:ae.batchIds}));for(u=0;u<K;++u){var le=(ae=fe[b=I[u]]).offset,be=3*le,pe=le,ye=Q[u],ge=y[u],ve=v[u],Ie=S,me=_;n.e(G)&&n.e(M)&&(Ie=G[u],me=M[u]);var we=Number.POSITIVE_INFINITY,xe=Number.NEGATIVE_INFINITY,Ae=Number.POSITIVE_INFINITY,Ne=Number.NEGATIVE_INFINITY;for(l=0;l<ge;++l){var ke=a.o.unpack(H,3*ye+3*l,C);x.scaleToGeodeticSurface(ke,ke);var Ee=x.cartesianToCartographic(ke,B),Te=Ee.latitude,Le=Ee.longitude;we=Math.min(Te,we),xe=Math.max(Te,xe),Ae=Math.min(Le,Ae),Ne=Math.max(Le,Ne);var Ce=x.geodeticSurfaceNormal(ke,P),Pe=a.o.multiplyByScalar(Ce,Ie,U),Ue=a.o.add(ke,Pe,O);Pe=a.o.multiplyByScalar(Ce,me,Pe);var Oe=a.o.add(ke,Pe,F);a.o.subtract(Oe,w,Oe),a.o.subtract(Ue,w,Ue),a.o.pack(Oe,re,be),a.o.pack(Ue,re,be+3),te[pe]=ve,te[pe+1]=ve,be+=6,pe+=2}(A=D).west=Ae,A.east=Ne,A.south=we,A.north=xe,m[u]=s.y.fromRectangle(A,S,_,x);var Fe=ae.indexOffset,Be=X[u],De=g[u];for(ne[u]=Fe,l=0;l<De;l+=3){var Se=h[Be+l]-ye,_e=h[Be+l+1]-ye,Ge=h[Be+l+2]-ye;ie[Fe++]=2*Se+le,ie[Fe++]=2*_e+le,ie[Fe++]=2*Ge+le,ie[Fe++]=2*Ge+1+le,ie[Fe++]=2*_e+1+le,ie[Fe++]=2*Se+1+le}for(l=0;l<ge;++l){var Me=l,Re=(l+1)%ge;ie[Fe++]=2*Me+1+le,ie[Fe++]=2*Re+le,ie[Fe++]=2*Me+le,ie[Fe++]=2*Me+1+le,ie[Fe++]=2*Re+1+le,ie[Fe++]=2*Re+le}ae.offset+=2*ge,ae.indexOffset=Fe,oe[u]=Fe-ne[u]}ie=i.IndexDatatype.createTypedArray(re.length/3,ie);for(var Ye=ue.length,Ve=0;Ve<Ye;++Ve){for(var He=ue[Ve].batchIds,We=0,ze=He.length,Ze=0;Ze<ze;++Ze)We+=oe[He[Ze]];ue[Ve].count=We}var je=L(2===ie.BYTES_PER_ELEMENT?i.IndexDatatype.UNSIGNED_SHORT:i.IndexDatatype.UNSIGNED_INT,m,ue);return d.push(re.buffer,ie.buffer,ne.buffer,oe.buffer,te.buffer,je.buffer),{positions:re.buffer,indices:ie.buffer,indexOffsets:ne.buffer,indexCounts:oe.buffer,batchIds:te.buffer,packedBuffer:je.buffer}}))}));
