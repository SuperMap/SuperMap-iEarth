import{a as F}from"./chunk-MMOQDUXZ.js";import{a as Sr}from"./chunk-AMRCVYIA.js";import{a as L}from"./chunk-I6IKQZ7N.js";import"./chunk-HOZ5IOFP.js";import"./chunk-ZMHH4UFY.js";import"./chunk-6X6ULKRC.js";import{a as Pr}from"./chunk-MQMYX2JZ.js";import"./chunk-REXJO6A6.js";import"./chunk-EUSYH4JF.js";import{a as z}from"./chunk-44AFRGCG.js";import"./chunk-CJHFPVIB.js";import"./chunk-NPAFDOYL.js";import"./chunk-SSYG2MIY.js";import"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import"./chunk-Z4SOZDEW.js";import"./chunk-MX7ZM7WW.js";import"./chunk-EHDXVZQM.js";import{a as H}from"./chunk-NLYLRNUA.js";import{b as Y}from"./chunk-7TOCOFC3.js";import"./chunk-ZVKIUA3Y.js";import{b as vr}from"./chunk-3HZNWEV7.js";import{a as e}from"./chunk-LBR6REQR.js";import{a as tr}from"./chunk-GXFCHGTA.js";import"./chunk-UBHQMGET.js";import"./chunk-EDZQSM3T.js";import"./chunk-PJGSCWXZ.js";import{a as A}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";var Fr=new e,Rr=new Y,Vr=new H,B={min:void 0,max:void 0,indexBytesPerElement:void 0};function Jr(t){var l=new Float64Array(t),a=0;B.indexBytesPerElement=l[a++],B.min=l[a++],B.max=l[a++],e.unpack(l,a,Fr),a+=e.packedLength,Y.unpack(l,a,Rr),a+=Y.packedLength,H.unpack(l,a,Vr)}function Kr(t){for(var l=t.length,a=0,d=0;d<l;++d)a+=F.packedLength+3+t[d].batchIds.length;return a}function Or(t,l,a){var d=l.length,T=1+1+d*L.packedLength+1+Kr(a),v=new Float64Array(T),n=0;v[n++]=t,v[n++]=d;for(var E=0;E<d;++E)L.pack(l[E],v,n),n+=L.packedLength;var N=a.length;v[n++]=N;for(var y=0;y<N;++y){var w=a[y];F.pack(w.color,v,n),n+=F.packedLength,v[n++]=w.offset,v[n++]=w.count;var b=w.batchIds,g=b.length;v[n++]=g;for(var p=0;p<g;++p)v[n++]=b[p]}return v}var Ur=32767,Ir=new e,Qr=new e,Xr=new e,$r=new e,jr=new e,Lr=new vr,ra=new H;function aa(t,l){Jr(t.packedBuffer);var a,d=B.indexBytesPerElement;d===2?a=new Uint16Array(t.indices):a=new Uint32Array(t.indices);var T=new Uint16Array(t.positions),v=new Uint32Array(t.counts),n=new Uint32Array(t.indexCounts),E=new Uint32Array(t.batchIds),N=new Uint32Array(t.batchTableColors),y=new Array(v.length),w=Fr,b=Rr,g=Vr,p=B.min,nr=B.max,C=t.minimumHeights,P=t.maximumHeights;A(C)&&A(P)&&(C=new Float32Array(C),P=new Float32Array(P));var r,h,o,m=T.length/2,fr=T.subarray(0,m),cr=T.subarray(m,2*m);Pr.zigZagDeltaDecode(fr,cr);var hr=new Float32Array(m*3);for(r=0;r<m;++r){var _r=fr[r],Dr=cr[r],xr=tr.lerp(g.west,g.east,_r/Ur),Mr=tr.lerp(g.south,g.north,Dr/Ur),Gr=vr.fromRadians(xr,Mr,0,Lr),Yr=b.cartographicToCartesian(Gr,Ir);e.pack(Yr,hr,r*3)}var S=v.length,or=new Array(S),W=new Array(S),ur=0,sr=0;for(r=0;r<S;++r)or[r]=ur,W[r]=sr,ur+=v[r],sr+=n[r];var U=new Float32Array(m*3*2),R=new Uint16Array(m*2),V=new Uint32Array(W.length),_=new Uint32Array(n.length),f=[],i={};for(r=0;r<S;++r)o=N[r],A(i[o])?(i[o].positionLength+=v[r],i[o].indexLength+=n[r],i[o].batchIds.push(r)):i[o]={positionLength:v[r],indexLength:n[r],offset:0,indexOffset:0,batchIds:[r]};var c,lr=0,gr=0;for(o in i)if(i.hasOwnProperty(o)){c=i[o],c.offset=lr,c.indexOffset=gr;var Hr=c.positionLength*2,ir=c.indexLength*2+c.positionLength*6;lr+=Hr,gr+=ir,c.indexLength=ir}var I=[];for(o in i)i.hasOwnProperty(o)&&(c=i[o],I.push({color:F.fromRgba(parseInt(o)),offset:c.indexOffset,count:c.indexLength,batchIds:c.batchIds}));for(r=0;r<S;++r){o=N[r],c=i[o];var s=c.offset,Z=s*3,q=s,D=or[r],x=v[r],dr=E[r],br=p,wr=nr;A(C)&&A(P)&&(br=C[r],wr=P[r]);var J=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY,O=Number.POSITIVE_INFINITY,Q=Number.NEGATIVE_INFINITY;for(h=0;h<x;++h){var k=e.unpack(hr,D*3+h*3,Ir);b.scaleToGeodeticSurface(k,k);var mr=b.cartesianToCartographic(k,Lr),yr=mr.latitude,pr=mr.longitude;J=Math.min(yr,J),K=Math.max(yr,K),O=Math.min(pr,O),Q=Math.max(pr,Q);var kr=b.geodeticSurfaceNormal(k,Qr),M=e.multiplyByScalar(kr,br,Xr),X=e.add(k,M,$r);M=e.multiplyByScalar(kr,wr,M);var $=e.add(k,M,jr);e.subtract($,w,$),e.subtract(X,w,X),e.pack($,U,Z),e.pack(X,U,Z+3),R[q]=dr,R[q+1]=dr,Z+=6,q+=2}g=ra,g.west=O,g.east=Q,g.south=J,g.north=K,y[r]=L.fromRectangle(g,p,nr,b);var u=c.indexOffset,j=W[r],zr=n[r];for(V[r]=u,h=0;h<zr;h+=3){var Ar=a[j+h]-D,Br=a[j+h+1]-D,Tr=a[j+h+2]-D;f[u++]=Ar*2+s,f[u++]=Br*2+s,f[u++]=Tr*2+s,f[u++]=Tr*2+1+s,f[u++]=Br*2+1+s,f[u++]=Ar*2+1+s}for(h=0;h<x;++h){var rr=h,ar=(h+1)%x;f[u++]=rr*2+1+s,f[u++]=ar*2+s,f[u++]=rr*2+s,f[u++]=rr*2+1+s,f[u++]=ar*2+1+s,f[u++]=ar*2+s}c.offset+=x*2,c.indexOffset=u,_[r]=u-V[r]}f=z.createTypedArray(U.length/3,f);for(var Wr=I.length,G=0;G<Wr;++G){for(var Er=I[G].batchIds,Nr=0,Zr=Er.length,er=0;er<Zr;++er)Nr+=_[Er[er]];I[G].count=Nr}var qr=f.BYTES_PER_ELEMENT===2?z.UNSIGNED_SHORT:z.UNSIGNED_INT,Cr=Or(qr,y,I);return l.push(U.buffer,f.buffer,V.buffer,_.buffer,R.buffer,Cr.buffer),{positions:U.buffer,indices:f.buffer,indexOffsets:V.buffer,indexCounts:_.buffer,batchIds:R.buffer,packedBuffer:Cr.buffer}}var ga=Sr(aa);export{ga as default};
