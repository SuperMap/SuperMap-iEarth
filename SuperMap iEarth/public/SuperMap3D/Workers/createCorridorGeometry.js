define(["./arrayFill-0358accf","./arrayRemoveDuplicates-a6924649","./buildModuleUrl-9eef8841","./Cartesian3-3a8bdb0b","./Cartographic-a2c313d7","./Check-52a7d806","./ComponentDatatype-98414d16","./PolylineVolumeGeometryLibrary-d96626d0","./CorridorGeometryLibrary-2b5c693d","./when-92c6cf3c","./Cartesian2-b72655a5","./GeometryAttribute-f47bd1cb","./GeometryAttributes-7f66ea53","./GeometryOffsetAttribute-b4d599f5","./IndexDatatype-86677ec4","./Math-ecf82623","./PolygonPipeline-425528b3","./FeatureDetection-cec0163f","./VertexFormat-f496a3f1","./Event-3390cd7d","./RuntimeError-c6a62a80","./WebGLConstants-42651efd","./Cartesian4-72b88c9e","./EllipsoidTangentPlane-d6b88a1f","./IntersectionTests-6e80d61c","./Plane-33393da8","./PolylinePipeline-f0970409","./EllipsoidGeodesic-03c935a0","./EllipsoidRhumbLine-b1a766ae"],(function(t,e,o,r,a,n,i,s,l,d,u,c,f,m,h,p,g,b,v,y,A,_,w,T,E,N,D,P,I){"use strict";var x=new r.o,F=new r.o,O=new r.o,M=new r.o,S=new r.o,C=new r.o,L=new r.o,V=new r.o;function G(t,e){for(var o=0;o<t.length;o++)t[o]=e.scaleToGeodeticSurface(t[o],t[o]);return t}function k(t,e,o,a,n,i){var s=t.normals,d=t.tangents,u=t.bitangents,c=r.o.normalize(r.o.cross(o,e,L),L);i.normal&&l.b.addAttribute(s,e,a,n),i.tangent&&l.b.addAttribute(d,c,a,n),i.bitangent&&l.b.addAttribute(u,o,a,n)}function R(t,e,o){var a,n,s,u=t.positions,m=t.corners,g=t.endPositions,b=t.lefts,v=t.normals,y=new f.a,A=0,_=0,w=0;for(n=0;n<u.length;n+=2)A+=s=u[n].length-3,w+=2*s,_+=u[n+1].length-3;for(A+=3,_+=3,n=0;n<m.length;n++){a=m[n];var T=m[n].leftPositions;d.e(T)?(A+=s=T.length,w+=s):(_+=s=m[n].rightPositions.length,w+=s)}var E,N=d.e(g);N&&(A+=E=g[0].length-3,_+=E,w+=6*(E/=3));var D,P,I,S,G,R,z=A+_,H=new Float64Array(z),U={normals:e.normal?new Float32Array(z):void 0,tangents:e.tangent?new Float32Array(z):void 0,bitangents:e.bitangent?new Float32Array(z):void 0},Y=0,B=z-1,W=x,q=F,J=E/2,j=h.IndexDatatype.createTypedArray(z/3,w),K=0;if(N){R=O,G=M;var Q=g[0];for(W=r.o.fromArray(v,0,W),q=r.o.fromArray(b,0,q),n=0;n<J;n++)R=r.o.fromArray(Q,3*(J-1-n),R),G=r.o.fromArray(Q,3*(J+n),G),l.b.addAttribute(H,G,Y),l.b.addAttribute(H,R,void 0,B),k(U,W,q,Y,B,e),S=(P=Y/3)+1,I=(D=(B-2)/3)-1,j[K++]=D,j[K++]=P,j[K++]=I,j[K++]=I,j[K++]=P,j[K++]=S,Y+=3,B-=3}var X,Z,$=0,tt=0,et=u[$++],ot=u[$++];for(H.set(et,Y),H.set(ot,B-ot.length+1),q=r.o.fromArray(b,tt,q),s=ot.length-3,n=0;n<s;n+=3)X=o.geodeticSurfaceNormal(r.o.fromArray(et,n,L),L),Z=o.geodeticSurfaceNormal(r.o.fromArray(ot,s-n,V),V),k(U,W=r.o.normalize(r.o.add(X,Z,W),W),q,Y,B,e),S=(P=Y/3)+1,I=(D=(B-2)/3)-1,j[K++]=D,j[K++]=P,j[K++]=I,j[K++]=I,j[K++]=P,j[K++]=S,Y+=3,B-=3;for(X=o.geodeticSurfaceNormal(r.o.fromArray(et,s,L),L),Z=o.geodeticSurfaceNormal(r.o.fromArray(ot,s,V),V),W=r.o.normalize(r.o.add(X,Z,W),W),tt+=3,n=0;n<m.length;n++){var rt,at,nt,it=(a=m[n]).leftPositions,st=a.rightPositions,lt=C,dt=O,ut=M;if(W=r.o.fromArray(v,tt,W),d.e(it)){for(k(U,W,q,void 0,B,e),B-=3,at=S,nt=I,rt=0;rt<it.length/3;rt++)lt=r.o.fromArray(it,3*rt,lt),j[K++]=at,j[K++]=nt-rt-1,j[K++]=nt-rt,l.b.addAttribute(H,lt,void 0,B),dt=r.o.fromArray(H,3*(nt-rt-1),dt),ut=r.o.fromArray(H,3*at,ut),k(U,W,q=r.o.normalize(r.o.subtract(dt,ut,q),q),void 0,B,e),B-=3;lt=r.o.fromArray(H,3*at,lt),dt=r.o.subtract(r.o.fromArray(H,3*nt,dt),lt,dt),ut=r.o.subtract(r.o.fromArray(H,3*(nt-rt),ut),lt,ut),k(U,W,q=r.o.normalize(r.o.add(dt,ut,q),q),Y,void 0,e),Y+=3}else{for(k(U,W,q,Y,void 0,e),Y+=3,at=I,nt=S,rt=0;rt<st.length/3;rt++)lt=r.o.fromArray(st,3*rt,lt),j[K++]=at,j[K++]=nt+rt,j[K++]=nt+rt+1,l.b.addAttribute(H,lt,Y),dt=r.o.fromArray(H,3*at,dt),ut=r.o.fromArray(H,3*(nt+rt),ut),k(U,W,q=r.o.normalize(r.o.subtract(dt,ut,q),q),Y,void 0,e),Y+=3;lt=r.o.fromArray(H,3*at,lt),dt=r.o.subtract(r.o.fromArray(H,3*(nt+rt),dt),lt,dt),ut=r.o.subtract(r.o.fromArray(H,3*nt,ut),lt,ut),k(U,W,q=r.o.normalize(r.o.negate(r.o.add(ut,dt,q),q),q),void 0,B,e),B-=3}for(et=u[$++],ot=u[$++],et.splice(0,3),ot.splice(ot.length-3,3),H.set(et,Y),H.set(ot,B-ot.length+1),s=ot.length-3,tt+=3,q=r.o.fromArray(b,tt,q),rt=0;rt<ot.length;rt+=3)X=o.geodeticSurfaceNormal(r.o.fromArray(et,rt,L),L),Z=o.geodeticSurfaceNormal(r.o.fromArray(ot,s-rt,V),V),k(U,W=r.o.normalize(r.o.add(X,Z,W),W),q,Y,B,e),P=(S=Y/3)-1,D=(I=(B-2)/3)+1,j[K++]=D,j[K++]=P,j[K++]=I,j[K++]=I,j[K++]=P,j[K++]=S,Y+=3,B-=3;Y-=3,B+=3}if(k(U,W=r.o.fromArray(v,v.length-3,W),q,Y,B,e),N){Y+=3,B-=3,R=O,G=M;var ct=g[1];for(n=0;n<J;n++)R=r.o.fromArray(ct,3*(E-n-1),R),G=r.o.fromArray(ct,3*n,G),l.b.addAttribute(H,R,void 0,B),l.b.addAttribute(H,G,Y),k(U,W,q,Y,B,e),P=(S=Y/3)-1,D=(I=(B-2)/3)+1,j[K++]=D,j[K++]=P,j[K++]=I,j[K++]=I,j[K++]=P,j[K++]=S,Y+=3,B-=3}if(y.position=new c.o({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:H}),e.st){var ft,mt,ht=new Float32Array(z/3*2),pt=0;if(N){A/=3,_/=3;var gt=Math.PI/(E+1);mt=1/(A-E+1),ft=1/(_-E+1);var bt,vt=E/2;for(n=vt+1;n<E+1;n++)bt=p.e.PI_OVER_TWO+gt*n,ht[pt++]=ft*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(n=1;n<_-E+1;n++)ht[pt++]=n*ft,ht[pt++]=0;for(n=E;n>vt;n--)bt=p.e.PI_OVER_TWO-n*gt,ht[pt++]=1-ft*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(n=vt;n>0;n--)bt=p.e.PI_OVER_TWO-gt*n,ht[pt++]=1-mt*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(n=A-E;n>0;n--)ht[pt++]=n*mt,ht[pt++]=1;for(n=1;n<vt+1;n++)bt=p.e.PI_OVER_TWO+gt*n,ht[pt++]=mt*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt))}else{for(mt=1/((A/=3)-1),ft=1/((_/=3)-1),n=0;n<_;n++)ht[pt++]=n*ft,ht[pt++]=0;for(n=A;n>0;n--)ht[pt++]=(n-1)*mt,ht[pt++]=1}y.st=new c.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:ht})}return e.normal&&(y.normal=new c.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.normals})),e.tangent&&(y.tangent=new c.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.tangents})),e.bitangent&&(y.bitangent=new c.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.bitangents})),{attributes:y,indices:j}}function z(t,e,o){o[e++]=t[0],o[e++]=t[1],o[e++]=t[2];for(var r=3;r<t.length;r+=3){var a=t[r],n=t[r+1],i=t[r+2];o[e++]=a,o[e++]=n,o[e++]=i,o[e++]=a,o[e++]=n,o[e++]=i}return o[e++]=t[0],o[e++]=t[1],o[e++]=t[2],o}function H(e,o){var a=new v.n({position:o.position,normal:o.normal||o.bitangent||e.shadowVolume,tangent:o.tangent,bitangent:o.normal||o.bitangent,st:o.st}),n=e.ellipsoid,s=R(l.b.computePositions(e),a,n),u=e.height,f=e.extrudedHeight,p=s.attributes,b=s.indices,y=p.position.values,A=y.length,_=new Float64Array(6*A),w=new Float64Array(A);w.set(y);var T=new Float64Array(4*A);T=z(y=g.A.scaleToGeodeticHeight(y,u,n),0,T),T=z(w=g.A.scaleToGeodeticHeight(w,f,n),2*A,T),_.set(y),_.set(w,A),_.set(T,2*A),p.position.values=_,p=function(t,e){if(!(e.normal||e.tangent||e.bitangent||e.st))return t;var o,a,n=t.position.values;(e.normal||e.bitangent)&&(o=t.normal.values,a=t.bitangent.values);var i,s=t.position.values.length/18,d=3*s,u=2*s,c=2*d;if(e.normal||e.bitangent||e.tangent){var f=e.normal?new Float32Array(6*d):void 0,m=e.tangent?new Float32Array(6*d):void 0,h=e.bitangent?new Float32Array(6*d):void 0,p=x,g=F,b=O,v=M,y=S,A=C,_=c;for(i=0;i<d;i+=3){var w=_+c;p=r.o.fromArray(n,i,p),g=r.o.fromArray(n,i+d,g),b=r.o.fromArray(n,(i+3)%d,b),g=r.o.subtract(g,p,g),b=r.o.subtract(b,p,b),v=r.o.normalize(r.o.cross(g,b,v),v),e.normal&&(l.b.addAttribute(f,v,w),l.b.addAttribute(f,v,w+3),l.b.addAttribute(f,v,_),l.b.addAttribute(f,v,_+3)),(e.tangent||e.bitangent)&&(A=r.o.fromArray(o,i,A),e.bitangent&&(l.b.addAttribute(h,A,w),l.b.addAttribute(h,A,w+3),l.b.addAttribute(h,A,_),l.b.addAttribute(h,A,_+3)),e.tangent&&(y=r.o.normalize(r.o.cross(A,v,y),y),l.b.addAttribute(m,y,w),l.b.addAttribute(m,y,w+3),l.b.addAttribute(m,y,_),l.b.addAttribute(m,y,_+3))),_+=6}if(e.normal){for(f.set(o),i=0;i<d;i+=3)f[i+d]=-o[i],f[i+d+1]=-o[i+1],f[i+d+2]=-o[i+2];t.normal.values=f}else t.normal=void 0;if(e.bitangent?(h.set(a),h.set(a,d),t.bitangent.values=h):t.bitangent=void 0,e.tangent){var T=t.tangent.values;m.set(T),m.set(T,d),t.tangent.values=m}}if(e.st){var E=t.st.values,N=new Float32Array(6*u);N.set(E),N.set(E,u);for(var D=2*u,P=0;P<2;P++){for(N[D++]=E[0],N[D++]=E[1],i=2;i<u;i+=2){var I=E[i],L=E[i+1];N[D++]=I,N[D++]=L,N[D++]=I,N[D++]=L}N[D++]=E[0],N[D++]=E[1]}t.st.values=N}return t}(p,o);var E,N=A/3;if(e.shadowVolume){var D=p.normal.values;A=D.length;var P=new Float32Array(6*A);for(E=0;E<A;E++)D[E]=-D[E];P.set(D,A),P=z(D,4*A,P),p.extrudeDirection=new c.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P}),o.normal||(p.normal=void 0)}if(d.e(e.offsetAttribute)){var I=new Uint8Array(6*N);if(e.offsetAttribute===m.z.TOP)I=t.d(I,1,0,N),I=t.d(I,1,2*N,4*N);else{var L=e.offsetAttribute===m.z.NONE?0:1;I=t.d(I,L)}p.applyOffset=new c.o({componentDatatype:i.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:I})}var V=b.length,G=N+N,k=h.IndexDatatype.createTypedArray(_.length/3,2*V+3*G);k.set(b);var H,U,Y,B,W=V;for(E=0;E<V;E+=3){var q=b[E],J=b[E+1],j=b[E+2];k[W++]=j+N,k[W++]=J+N,k[W++]=q+N}for(E=0;E<G;E+=2)Y=(H=E+G)+1,B=(U=H+G)+1,k[W++]=H,k[W++]=U,k[W++]=Y,k[W++]=Y,k[W++]=U,k[W++]=B;return{attributes:p,indices:k}}var U=new r.o,Y=new r.o,B=new a.a;function W(t,e,o,a,n,i){var s=r.o.subtract(e,t,U);r.o.normalize(s,s);var l=o.geodeticSurfaceNormal(t,Y),d=r.o.cross(s,l,U);r.o.multiplyByScalar(d,a,d);var u=n.latitude,c=n.longitude,f=i.latitude,m=i.longitude;r.o.add(t,d,Y),o.cartesianToCartographic(Y,B);var h=B.latitude,p=B.longitude;u=Math.min(u,h),c=Math.min(c,p),f=Math.max(f,h),m=Math.max(m,p),r.o.subtract(t,d,Y),o.cartesianToCartographic(Y,B),h=B.latitude,p=B.longitude,u=Math.min(u,h),c=Math.min(c,p),f=Math.max(f,h),m=Math.max(m,p),n.latitude=u,n.longitude=c,i.latitude=f,i.longitude=m}var q=new r.o,J=new r.o,j=new a.a,K=new a.a;function Q(t,o,a,n,i){t=G(t,o);var l=e.D(t,r.o.equalsEpsilon),c=l.length;if(c<2||a<=0)return new u.h;var f,m,h=.5*a;if(j.latitude=Number.POSITIVE_INFINITY,j.longitude=Number.POSITIVE_INFINITY,K.latitude=Number.NEGATIVE_INFINITY,K.longitude=Number.NEGATIVE_INFINITY,n===s.S.ROUNDED){var p=l[0];r.o.subtract(p,l[1],q),r.o.normalize(q,q),r.o.multiplyByScalar(q,h,q),r.o.add(p,q,J),o.cartesianToCartographic(J,B),f=B.latitude,m=B.longitude,j.latitude=Math.min(j.latitude,f),j.longitude=Math.min(j.longitude,m),K.latitude=Math.max(K.latitude,f),K.longitude=Math.max(K.longitude,m)}for(var g=0;g<c-1;++g)W(l[g],l[g+1],o,h,j,K);var b=l[c-1];r.o.subtract(b,l[c-2],q),r.o.normalize(q,q),r.o.multiplyByScalar(q,h,q),r.o.add(b,q,J),W(b,J,o,h,j,K),n===s.S.ROUNDED&&(o.cartesianToCartographic(J,B),f=B.latitude,m=B.longitude,j.latitude=Math.min(j.latitude,f),j.longitude=Math.min(j.longitude,m),K.latitude=Math.max(K.latitude,f),K.longitude=Math.max(K.longitude,m));var v=d.e(i)?i:new u.h;return v.north=K.latitude,v.south=j.latitude,v.east=K.longitude,v.west=j.longitude,v}function X(t){var e=(t=d.u(t,d.u.EMPTY_OBJECT)).positions,o=t.width;n.o.defined("options.positions",e),n.o.defined("options.width",o);var a=d.u(t.height,0),i=d.u(t.extrudedHeight,a);this._positions=e,this._ellipsoid=u.t.clone(d.u(t.ellipsoid,u.t.WGS84)),this._vertexFormat=v.n.clone(d.u(t.vertexFormat,v.n.DEFAULT)),this._width=o,this._height=Math.max(a,i),this._extrudedHeight=Math.min(a,i),this._cornerType=d.u(t.cornerType,s.S.ROUNDED),this._granularity=d.u(t.granularity,p.e.RADIANS_PER_DEGREE),this._shadowVolume=d.u(t.shadowVolume,!1),this._workerName="createCorridorGeometry",this._offsetAttribute=t.offsetAttribute,this._rectangle=void 0,this.packedLength=1+e.length*r.o.packedLength+u.t.packedLength+v.n.packedLength+7}X.pack=function(t,e,o){n.o.defined("value",t),n.o.defined("array",e),o=d.u(o,0);var a=t._positions,i=a.length;e[o++]=i;for(var s=0;s<i;++s,o+=r.o.packedLength)r.o.pack(a[s],e,o);return u.t.pack(t._ellipsoid,e,o),o+=u.t.packedLength,v.n.pack(t._vertexFormat,e,o),o+=v.n.packedLength,e[o++]=t._width,e[o++]=t._height,e[o++]=t._extrudedHeight,e[o++]=t._cornerType,e[o++]=t._granularity,e[o++]=t._shadowVolume?1:0,e[o]=d.u(t._offsetAttribute,-1),e};var Z=u.t.clone(u.t.UNIT_SPHERE),$=new v.n,tt={positions:void 0,ellipsoid:Z,vertexFormat:$,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};return X.unpack=function(t,e,o){n.o.defined("array",t),e=d.u(e,0);for(var a=t[e++],i=new Array(a),s=0;s<a;++s,e+=r.o.packedLength)i[s]=r.o.unpack(t,e);var l=u.t.unpack(t,e,Z);e+=u.t.packedLength;var c=v.n.unpack(t,e,$);e+=v.n.packedLength;var f=t[e++],m=t[e++],h=t[e++],p=t[e++],g=t[e++],b=1===t[e++],y=t[e];return d.e(o)?(o._positions=i,o._ellipsoid=u.t.clone(l,o._ellipsoid),o._vertexFormat=v.n.clone(c,o._vertexFormat),o._width=f,o._height=m,o._extrudedHeight=h,o._cornerType=p,o._granularity=g,o._shadowVolume=b,o._offsetAttribute=-1===y?void 0:y,o):(tt.positions=i,tt.width=f,tt.height=m,tt.extrudedHeight=h,tt.cornerType=p,tt.granularity=g,tt.shadowVolume=b,tt.offsetAttribute=-1===y?void 0:y,new X(tt))},X.computeRectangle=function(t,e){var o=(t=d.u(t,d.u.EMPTY_OBJECT)).positions,r=t.width;return n.o.defined("options.positions",o),n.o.defined("options.width",r),Q(o,d.u(t.ellipsoid,u.t.WGS84),r,d.u(t.cornerType,s.S.ROUNDED),e)},X.createGeometry=function(a){var n=a._positions,s=a._width,u=a._ellipsoid;n=G(n,u);var f=e.D(n,r.o.equalsEpsilon);if(!(f.length<2||s<=0)){var h,v=a._height,y=a._extrudedHeight,A=!p.e.equalsEpsilon(v,y,0,p.e.EPSILON2),_=a._vertexFormat,w={ellipsoid:u,positions:f,width:s,cornerType:a._cornerType,granularity:a._granularity,saveAttributes:!0};if(A)w.height=v,w.extrudedHeight=y,w.shadowVolume=a._shadowVolume,w.offsetAttribute=a._offsetAttribute,h=H(w,_);else if((h=R(l.b.computePositions(w),_,u)).attributes.position.values=g.A.scaleToGeodeticHeight(h.attributes.position.values,v,u),d.e(a._offsetAttribute)){var T=a._offsetAttribute===m.z.NONE?0:1,E=h.attributes.position.values.length,N=new Uint8Array(E/3);t.d(N,T),h.attributes.applyOffset=new c.o({componentDatatype:i.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:N})}var D=h.attributes,P=o.i.fromVertices(D.position.values,void 0,3);return _.position||(h.attributes.position.values=void 0),new c.I({attributes:D,indices:h.indices,primitiveType:b._0x4b6a27.TRIANGLES,boundingSphere:P,offsetAttribute:a._offsetAttribute})}},X.createShadowVolume=function(t,e,o){var r=t._granularity,a=t._ellipsoid,n=e(r,a),i=o(r,a);return new X({positions:t._positions,width:t._width,cornerType:t._cornerType,ellipsoid:a,granularity:r,extrudedHeight:n,height:i,vertexFormat:v.n.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(X.prototype,{rectangle:{get:function(){return d.e(this._rectangle)||(this._rectangle=Q(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}}),function(t,e){return d.e(e)&&(t=X.unpack(t,e)),t._ellipsoid=u.t.clone(t._ellipsoid),X.createGeometry(t)}}));
