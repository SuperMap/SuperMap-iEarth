define(["./arrayFill-c1a6b724","./arrayRemoveDuplicates-5016d6bb","./buildModuleUrl-36ce0ebc","./Cartesian3-c1138337","./Cartographic-630e5de6","./Check-92c551fb","./ComponentDatatype-3cfb1146","./PolylineVolumeGeometryLibrary-8564ed0e","./CorridorGeometryLibrary-8d72b3ab","./defaultValue-2110bb17","./Ellipsoid-ca2b8eb1","./GeometryAttribute-b12ab6bd","./GeometryAttributes-3cad3ff9","./GeometryOffsetAttribute-da5a1d35","./IndexDatatype-d833345d","./Math-cd1437d9","./PolygonPipeline-478e7e0d","./PrimitiveType-d9ba7368","./Rectangle-52f780a9","./VertexFormat-295b1d1f","./FeatureDetection-e7fb956a","./defer-a21481c0","./Event-589349b0","./RuntimeError-6daf0e01","./WebGLConstants-92042d9e","./Cartesian4-5c264813","./EllipsoidTangentPlane-6f479ced","./IntersectionTests-88230423","./Plane-8f19018a","./PolylinePipeline-92dcfbc3","./EllipsoidGeodesic-262ae711","./EllipsoidRhumbLine-89d13f20"],(function(t,e,o,r,a,i,n,s,d,l,u,c,f,m,h,p,g,b,v,y,A,_,w,T,E,N,D,P,I,x,F,O){"use strict";var M=new r.o,S=new r.o,L=new r.o,V=new r.o,C=new r.o,G=new r.o,k=new r.o,R=new r.o;function z(t,e){for(var o=0;o<t.length;o++)t[o]=e.scaleToGeodeticSurface(t[o],t[o]);return t}function H(t,e,o,a,i,n){var s=t.normals,l=t.tangents,u=t.bitangents,c=r.o.normalize(r.o.cross(o,e,k),k);n.normal&&d.b.addAttribute(s,e,a,i),n.tangent&&d.b.addAttribute(l,c,a,i),n.bitangent&&d.b.addAttribute(u,o,a,i)}function U(t,e,o){var a,i,s,u=t.positions,m=t.corners,g=t.endPositions,b=t.lefts,v=t.normals,y=new f.a,A=0,_=0,w=0;for(i=0;i<u.length;i+=2)A+=s=u[i].length-3,w+=2*s,_+=u[i+1].length-3;for(A+=3,_+=3,i=0;i<m.length;i++){a=m[i];var T=m[i].leftPositions;l.e(T)?(A+=s=T.length,w+=s):(_+=s=m[i].rightPositions.length,w+=s)}var E,N=l.e(g);N&&(A+=E=g[0].length-3,_+=E,w+=6*(E/=3));var D,P,I,x,F,O,C=A+_,z=new Float64Array(C),U={normals:e.normal?new Float32Array(C):void 0,tangents:e.tangent?new Float32Array(C):void 0,bitangents:e.bitangent?new Float32Array(C):void 0},Y=0,B=C-1,W=M,q=S,J=E/2,j=h.IndexDatatype.createTypedArray(C/3,w),K=0;if(N){O=L,F=V;var Q=g[0];for(W=r.o.fromArray(v,0,W),q=r.o.fromArray(b,0,q),i=0;i<J;i++)O=r.o.fromArray(Q,3*(J-1-i),O),F=r.o.fromArray(Q,3*(J+i),F),d.b.addAttribute(z,F,Y),d.b.addAttribute(z,O,void 0,B),H(U,W,q,Y,B,e),x=(P=Y/3)+1,I=(D=(B-2)/3)-1,j[K++]=D,j[K++]=P,j[K++]=I,j[K++]=I,j[K++]=P,j[K++]=x,Y+=3,B-=3}var X,Z,$=0,tt=0,et=u[$++],ot=u[$++];for(z.set(et,Y),z.set(ot,B-ot.length+1),q=r.o.fromArray(b,tt,q),s=ot.length-3,i=0;i<s;i+=3)X=o.geodeticSurfaceNormal(r.o.fromArray(et,i,k),k),Z=o.geodeticSurfaceNormal(r.o.fromArray(ot,s-i,R),R),H(U,W=r.o.normalize(r.o.add(X,Z,W),W),q,Y,B,e),x=(P=Y/3)+1,I=(D=(B-2)/3)-1,j[K++]=D,j[K++]=P,j[K++]=I,j[K++]=I,j[K++]=P,j[K++]=x,Y+=3,B-=3;for(X=o.geodeticSurfaceNormal(r.o.fromArray(et,s,k),k),Z=o.geodeticSurfaceNormal(r.o.fromArray(ot,s,R),R),W=r.o.normalize(r.o.add(X,Z,W),W),tt+=3,i=0;i<m.length;i++){var rt,at,it,nt=(a=m[i]).leftPositions,st=a.rightPositions,dt=G,lt=L,ut=V;if(W=r.o.fromArray(v,tt,W),l.e(nt)){for(H(U,W,q,void 0,B,e),B-=3,at=x,it=I,rt=0;rt<nt.length/3;rt++)dt=r.o.fromArray(nt,3*rt,dt),j[K++]=at,j[K++]=it-rt-1,j[K++]=it-rt,d.b.addAttribute(z,dt,void 0,B),lt=r.o.fromArray(z,3*(it-rt-1),lt),ut=r.o.fromArray(z,3*at,ut),H(U,W,q=r.o.normalize(r.o.subtract(lt,ut,q),q),void 0,B,e),B-=3;dt=r.o.fromArray(z,3*at,dt),lt=r.o.subtract(r.o.fromArray(z,3*it,lt),dt,lt),ut=r.o.subtract(r.o.fromArray(z,3*(it-rt),ut),dt,ut),H(U,W,q=r.o.normalize(r.o.add(lt,ut,q),q),Y,void 0,e),Y+=3}else{for(H(U,W,q,Y,void 0,e),Y+=3,at=I,it=x,rt=0;rt<st.length/3;rt++)dt=r.o.fromArray(st,3*rt,dt),j[K++]=at,j[K++]=it+rt,j[K++]=it+rt+1,d.b.addAttribute(z,dt,Y),lt=r.o.fromArray(z,3*at,lt),ut=r.o.fromArray(z,3*(it+rt),ut),H(U,W,q=r.o.normalize(r.o.subtract(lt,ut,q),q),Y,void 0,e),Y+=3;dt=r.o.fromArray(z,3*at,dt),lt=r.o.subtract(r.o.fromArray(z,3*(it+rt),lt),dt,lt),ut=r.o.subtract(r.o.fromArray(z,3*it,ut),dt,ut),H(U,W,q=r.o.normalize(r.o.negate(r.o.add(ut,lt,q),q),q),void 0,B,e),B-=3}for(et=u[$++],ot=u[$++],et.splice(0,3),ot.splice(ot.length-3,3),z.set(et,Y),z.set(ot,B-ot.length+1),s=ot.length-3,tt+=3,q=r.o.fromArray(b,tt,q),rt=0;rt<ot.length;rt+=3)X=o.geodeticSurfaceNormal(r.o.fromArray(et,rt,k),k),Z=o.geodeticSurfaceNormal(r.o.fromArray(ot,s-rt,R),R),H(U,W=r.o.normalize(r.o.add(X,Z,W),W),q,Y,B,e),P=(x=Y/3)-1,D=(I=(B-2)/3)+1,j[K++]=D,j[K++]=P,j[K++]=I,j[K++]=I,j[K++]=P,j[K++]=x,Y+=3,B-=3;Y-=3,B+=3}if(H(U,W=r.o.fromArray(v,v.length-3,W),q,Y,B,e),N){Y+=3,B-=3,O=L,F=V;var ct=g[1];for(i=0;i<J;i++)O=r.o.fromArray(ct,3*(E-i-1),O),F=r.o.fromArray(ct,3*i,F),d.b.addAttribute(z,O,void 0,B),d.b.addAttribute(z,F,Y),H(U,W,q,Y,B,e),P=(x=Y/3)-1,D=(I=(B-2)/3)+1,j[K++]=D,j[K++]=P,j[K++]=I,j[K++]=I,j[K++]=P,j[K++]=x,Y+=3,B-=3}if(y.position=new c.o({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:z}),e.st){var ft,mt,ht=new Float32Array(C/3*2),pt=0;if(N){A/=3,_/=3;var gt=Math.PI/(E+1);mt=1/(A-E+1),ft=1/(_-E+1);var bt,vt=E/2;for(i=vt+1;i<E+1;i++)bt=p.e.PI_OVER_TWO+gt*i,ht[pt++]=ft*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(i=1;i<_-E+1;i++)ht[pt++]=i*ft,ht[pt++]=0;for(i=E;i>vt;i--)bt=p.e.PI_OVER_TWO-i*gt,ht[pt++]=1-ft*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(i=vt;i>0;i--)bt=p.e.PI_OVER_TWO-gt*i,ht[pt++]=1-mt*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(i=A-E;i>0;i--)ht[pt++]=i*mt,ht[pt++]=1;for(i=1;i<vt+1;i++)bt=p.e.PI_OVER_TWO+gt*i,ht[pt++]=mt*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt))}else{for(mt=1/((A/=3)-1),ft=1/((_/=3)-1),i=0;i<_;i++)ht[pt++]=i*ft,ht[pt++]=0;for(i=A;i>0;i--)ht[pt++]=(i-1)*mt,ht[pt++]=1}y.st=new c.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:ht})}return e.normal&&(y.normal=new c.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.normals})),e.tangent&&(y.tangent=new c.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.tangents})),e.bitangent&&(y.bitangent=new c.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.bitangents})),{attributes:y,indices:j}}function Y(t,e,o){o[e++]=t[0],o[e++]=t[1],o[e++]=t[2];for(var r=3;r<t.length;r+=3){var a=t[r],i=t[r+1],n=t[r+2];o[e++]=a,o[e++]=i,o[e++]=n,o[e++]=a,o[e++]=i,o[e++]=n}return o[e++]=t[0],o[e++]=t[1],o[e++]=t[2],o}function B(e,o){var a=new y.n({position:o.position,normal:o.normal||o.bitangent||e.shadowVolume,tangent:o.tangent,bitangent:o.normal||o.bitangent,st:o.st}),i=e.ellipsoid,s=U(d.b.computePositions(e),a,i),u=e.height,f=e.extrudedHeight,p=s.attributes,b=s.indices,v=p.position.values,A=v.length,_=new Float64Array(6*A),w=new Float64Array(A);w.set(v);var T=new Float64Array(4*A);T=Y(v=g.A.scaleToGeodeticHeight(v,u,i),0,T),T=Y(w=g.A.scaleToGeodeticHeight(w,f,i),2*A,T),_.set(v),_.set(w,A),_.set(T,2*A),p.position.values=_,p=function(t,e){if(!(e.normal||e.tangent||e.bitangent||e.st))return t;var o,a,i=t.position.values;(e.normal||e.bitangent)&&(o=t.normal.values,a=t.bitangent.values);var n,s=t.position.values.length/18,l=3*s,u=2*s,c=2*l;if(e.normal||e.bitangent||e.tangent){var f=e.normal?new Float32Array(6*l):void 0,m=e.tangent?new Float32Array(6*l):void 0,h=e.bitangent?new Float32Array(6*l):void 0,p=M,g=S,b=L,v=V,y=C,A=G,_=c;for(n=0;n<l;n+=3){var w=_+c;p=r.o.fromArray(i,n,p),g=r.o.fromArray(i,n+l,g),b=r.o.fromArray(i,(n+3)%l,b),g=r.o.subtract(g,p,g),b=r.o.subtract(b,p,b),v=r.o.normalize(r.o.cross(g,b,v),v),e.normal&&(d.b.addAttribute(f,v,w),d.b.addAttribute(f,v,w+3),d.b.addAttribute(f,v,_),d.b.addAttribute(f,v,_+3)),(e.tangent||e.bitangent)&&(A=r.o.fromArray(o,n,A),e.bitangent&&(d.b.addAttribute(h,A,w),d.b.addAttribute(h,A,w+3),d.b.addAttribute(h,A,_),d.b.addAttribute(h,A,_+3)),e.tangent&&(y=r.o.normalize(r.o.cross(A,v,y),y),d.b.addAttribute(m,y,w),d.b.addAttribute(m,y,w+3),d.b.addAttribute(m,y,_),d.b.addAttribute(m,y,_+3))),_+=6}if(e.normal){for(f.set(o),n=0;n<l;n+=3)f[n+l]=-o[n],f[n+l+1]=-o[n+1],f[n+l+2]=-o[n+2];t.normal.values=f}else t.normal=void 0;if(e.bitangent?(h.set(a),h.set(a,l),t.bitangent.values=h):t.bitangent=void 0,e.tangent){var T=t.tangent.values;m.set(T),m.set(T,l),t.tangent.values=m}}if(e.st){var E=t.st.values,N=new Float32Array(6*u);N.set(E),N.set(E,u);for(var D=2*u,P=0;P<2;P++){for(N[D++]=E[0],N[D++]=E[1],n=2;n<u;n+=2){var I=E[n],x=E[n+1];N[D++]=I,N[D++]=x,N[D++]=I,N[D++]=x}N[D++]=E[0],N[D++]=E[1]}t.st.values=N}return t}(p,o);var E,N=A/3;if(e.shadowVolume){var D=p.normal.values;A=D.length;var P=new Float32Array(6*A);for(E=0;E<A;E++)D[E]=-D[E];P.set(D,A),P=Y(D,4*A,P),p.extrudeDirection=new c.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P}),o.normal||(p.normal=void 0)}if(l.e(e.offsetAttribute)){var I=new Uint8Array(6*N);if(e.offsetAttribute===m.z.TOP)I=t.d(I,1,0,N),I=t.d(I,1,2*N,4*N);else{var x=e.offsetAttribute===m.z.NONE?0:1;I=t.d(I,x)}p.applyOffset=new c.o({componentDatatype:n.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:I})}var F=b.length,O=N+N,k=h.IndexDatatype.createTypedArray(_.length/3,2*F+3*O);k.set(b);var R,z,H,B,W=F;for(E=0;E<F;E+=3){var q=b[E],J=b[E+1],j=b[E+2];k[W++]=j+N,k[W++]=J+N,k[W++]=q+N}for(E=0;E<O;E+=2)H=(R=E+O)+1,B=(z=R+O)+1,k[W++]=R,k[W++]=z,k[W++]=H,k[W++]=H,k[W++]=z,k[W++]=B;return{attributes:p,indices:k}}var W=new r.o,q=new r.o,J=new a.a;function j(t,e,o,a,i,n){var s=r.o.subtract(e,t,W);r.o.normalize(s,s);var d=o.geodeticSurfaceNormal(t,q),l=r.o.cross(s,d,W);r.o.multiplyByScalar(l,a,l);var u=i.latitude,c=i.longitude,f=n.latitude,m=n.longitude;r.o.add(t,l,q),o.cartesianToCartographic(q,J);var h=J.latitude,p=J.longitude;u=Math.min(u,h),c=Math.min(c,p),f=Math.max(f,h),m=Math.max(m,p),r.o.subtract(t,l,q),o.cartesianToCartographic(q,J),h=J.latitude,p=J.longitude,u=Math.min(u,h),c=Math.min(c,p),f=Math.max(f,h),m=Math.max(m,p),i.latitude=u,i.longitude=c,n.latitude=f,n.longitude=m}var K=new r.o,Q=new r.o,X=new a.a,Z=new a.a;function $(t,o,a,i,n){t=z(t,o);var d=e.D(t,r.o.equalsEpsilon),u=d.length;if(u<2||a<=0)return new v.h;var c,f,m=.5*a;if(X.latitude=Number.POSITIVE_INFINITY,X.longitude=Number.POSITIVE_INFINITY,Z.latitude=Number.NEGATIVE_INFINITY,Z.longitude=Number.NEGATIVE_INFINITY,i===s.S.ROUNDED){var h=d[0];r.o.subtract(h,d[1],K),r.o.normalize(K,K),r.o.multiplyByScalar(K,m,K),r.o.add(h,K,Q),o.cartesianToCartographic(Q,J),c=J.latitude,f=J.longitude,X.latitude=Math.min(X.latitude,c),X.longitude=Math.min(X.longitude,f),Z.latitude=Math.max(Z.latitude,c),Z.longitude=Math.max(Z.longitude,f)}for(var p=0;p<u-1;++p)j(d[p],d[p+1],o,m,X,Z);var g=d[u-1];r.o.subtract(g,d[u-2],K),r.o.normalize(K,K),r.o.multiplyByScalar(K,m,K),r.o.add(g,K,Q),j(g,Q,o,m,X,Z),i===s.S.ROUNDED&&(o.cartesianToCartographic(Q,J),c=J.latitude,f=J.longitude,X.latitude=Math.min(X.latitude,c),X.longitude=Math.min(X.longitude,f),Z.latitude=Math.max(Z.latitude,c),Z.longitude=Math.max(Z.longitude,f));var b=l.e(n)?n:new v.h;return b.north=Z.latitude,b.south=X.latitude,b.east=Z.longitude,b.west=X.longitude,b}function tt(t){var e=(t=l.u(t,l.u.EMPTY_OBJECT)).positions,o=t.width;i.o.defined("options.positions",e),i.o.defined("options.width",o);var a=l.u(t.height,0),n=l.u(t.extrudedHeight,a);this._positions=e,this._ellipsoid=u.t.clone(l.u(t.ellipsoid,u.t.WGS84)),this._vertexFormat=y.n.clone(l.u(t.vertexFormat,y.n.DEFAULT)),this._width=o,this._height=Math.max(a,n),this._extrudedHeight=Math.min(a,n),this._cornerType=l.u(t.cornerType,s.S.ROUNDED),this._granularity=l.u(t.granularity,p.e.RADIANS_PER_DEGREE),this._shadowVolume=l.u(t.shadowVolume,!1),this._workerName="createCorridorGeometry",this._offsetAttribute=t.offsetAttribute,this._rectangle=void 0,this.packedLength=1+e.length*r.o.packedLength+u.t.packedLength+y.n.packedLength+7}tt.pack=function(t,e,o){i.o.defined("value",t),i.o.defined("array",e),o=l.u(o,0);var a=t._positions,n=a.length;e[o++]=n;for(var s=0;s<n;++s,o+=r.o.packedLength)r.o.pack(a[s],e,o);return u.t.pack(t._ellipsoid,e,o),o+=u.t.packedLength,y.n.pack(t._vertexFormat,e,o),o+=y.n.packedLength,e[o++]=t._width,e[o++]=t._height,e[o++]=t._extrudedHeight,e[o++]=t._cornerType,e[o++]=t._granularity,e[o++]=t._shadowVolume?1:0,e[o]=l.u(t._offsetAttribute,-1),e};var et=u.t.clone(u.t.UNIT_SPHERE),ot=new y.n,rt={positions:void 0,ellipsoid:et,vertexFormat:ot,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};return tt.unpack=function(t,e,o){i.o.defined("array",t),e=l.u(e,0);for(var a=t[e++],n=new Array(a),s=0;s<a;++s,e+=r.o.packedLength)n[s]=r.o.unpack(t,e);var d=u.t.unpack(t,e,et);e+=u.t.packedLength;var c=y.n.unpack(t,e,ot);e+=y.n.packedLength;var f=t[e++],m=t[e++],h=t[e++],p=t[e++],g=t[e++],b=1===t[e++],v=t[e];return l.e(o)?(o._positions=n,o._ellipsoid=u.t.clone(d,o._ellipsoid),o._vertexFormat=y.n.clone(c,o._vertexFormat),o._width=f,o._height=m,o._extrudedHeight=h,o._cornerType=p,o._granularity=g,o._shadowVolume=b,o._offsetAttribute=-1===v?void 0:v,o):(rt.positions=n,rt.width=f,rt.height=m,rt.extrudedHeight=h,rt.cornerType=p,rt.granularity=g,rt.shadowVolume=b,rt.offsetAttribute=-1===v?void 0:v,new tt(rt))},tt.computeRectangle=function(t,e){var o=(t=l.u(t,l.u.EMPTY_OBJECT)).positions,r=t.width;return i.o.defined("options.positions",o),i.o.defined("options.width",r),$(o,l.u(t.ellipsoid,u.t.WGS84),r,l.u(t.cornerType,s.S.ROUNDED),e)},tt.createGeometry=function(a){var i=a._positions,s=a._width,u=a._ellipsoid;i=z(i,u);var f=e.D(i,r.o.equalsEpsilon);if(!(f.length<2||s<=0)){var h,v=a._height,y=a._extrudedHeight,A=!p.e.equalsEpsilon(v,y,0,p.e.EPSILON2),_=a._vertexFormat,w={ellipsoid:u,positions:f,width:s,cornerType:a._cornerType,granularity:a._granularity,saveAttributes:!0};if(A)w.height=v,w.extrudedHeight=y,w.shadowVolume=a._shadowVolume,w.offsetAttribute=a._offsetAttribute,h=B(w,_);else if((h=U(d.b.computePositions(w),_,u)).attributes.position.values=g.A.scaleToGeodeticHeight(h.attributes.position.values,v,u),l.e(a._offsetAttribute)){var T=a._offsetAttribute===m.z.NONE?0:1,E=h.attributes.position.values.length,N=new Uint8Array(E/3);t.d(N,T),h.attributes.applyOffset=new c.o({componentDatatype:n.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:N})}var D=h.attributes,P=o.i.fromVertices(D.position.values,void 0,3);return _.position||(h.attributes.position.values=void 0),new c.I({attributes:D,indices:h.indices,primitiveType:b._0xa706e5.TRIANGLES,boundingSphere:P,offsetAttribute:a._offsetAttribute})}},tt.createShadowVolume=function(t,e,o){var r=t._granularity,a=t._ellipsoid,i=e(r,a),n=o(r,a);return new tt({positions:t._positions,width:t._width,cornerType:t._cornerType,ellipsoid:a,granularity:r,extrudedHeight:i,height:n,vertexFormat:y.n.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(tt.prototype,{rectangle:{get:function(){return l.e(this._rectangle)||(this._rectangle=$(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}}),function(t,e){return l.e(e)&&(t=tt.unpack(t,e)),t._ellipsoid=u.t.clone(t._ellipsoid),tt.createGeometry(t)}}));
