define(["./arrayFill-9b55d6b2","./arrayRemoveDuplicates-3deab545","./buildModuleUrl-1b968a9d","./Cartographic-81e9e8b2","./Check-ff445961","./ComponentDatatype-7d28dd1c","./PolylineVolumeGeometryLibrary-cc9025df","./CorridorGeometryLibrary-c82a5271","./when-39df26e1","./Cartesian2-59a54ee7","./GeometryAttribute-9b3921a3","./GeometryAttributes-11421d3c","./GeometryOffsetAttribute-b4d599f5","./IndexDatatype-be421fbf","./Math-5e067eb3","./PolygonPipeline-ae195f4e","./FeatureDetection-2d4141ff","./VertexFormat-79ab0d67","./Event-e109b23e","./RuntimeError-251a1d8d","./WebGLConstants-42651efd","./Cartesian4-a56bd360","./EllipsoidTangentPlane-ee91c10e","./IntersectionTests-036daea1","./Plane-775a5120","./PolylinePipeline-0d72c6c0","./EllipsoidGeodesic-840abdf5","./EllipsoidRhumbLine-61b02483"],(function(t,e,o,r,a,n,i,s,d,l,u,c,f,m,h,p,g,b,v,y,A,_,w,T,E,N,D,P){"use strict";var I=new r.o,x=new r.o,F=new r.o,O=new r.o,M=new r.o,S=new r.o,L=new r.o,C=new r.o;function V(t,e){for(var o=0;o<t.length;o++)t[o]=e.scaleToGeodeticSurface(t[o],t[o]);return t}function G(t,e,o,a,n,i){var d=t.normals,l=t.tangents,u=t.bitangents,c=r.o.normalize(r.o.cross(o,e,L),L);i.normal&&s.b.addAttribute(d,e,a,n),i.tangent&&s.b.addAttribute(l,c,a,n),i.bitangent&&s.b.addAttribute(u,o,a,n)}function k(t,e,o){var a,i,l,f=t.positions,p=t.corners,g=t.endPositions,b=t.lefts,v=t.normals,y=new c.a,A=0,_=0,w=0;for(i=0;i<f.length;i+=2)A+=l=f[i].length-3,w+=2*l,_+=f[i+1].length-3;for(A+=3,_+=3,i=0;i<p.length;i++){a=p[i];var T=p[i].leftPositions;d.e(T)?(A+=l=T.length,w+=l):(_+=l=p[i].rightPositions.length,w+=l)}var E,N=d.e(g);N&&(A+=E=g[0].length-3,_+=E,w+=6*(E/=3));var D,P,M,V,k,R,z=A+_,H=new Float64Array(z),U={normals:e.normal?new Float32Array(z):void 0,tangents:e.tangent?new Float32Array(z):void 0,bitangents:e.bitangent?new Float32Array(z):void 0},Y=0,B=z-1,W=I,q=x,J=E/2,j=m.IndexDatatype.createTypedArray(z/3,w),K=0;if(N){R=F,k=O;var Q=g[0];for(W=r.o.fromArray(v,0,W),q=r.o.fromArray(b,0,q),i=0;i<J;i++)R=r.o.fromArray(Q,3*(J-1-i),R),k=r.o.fromArray(Q,3*(J+i),k),s.b.addAttribute(H,k,Y),s.b.addAttribute(H,R,void 0,B),G(U,W,q,Y,B,e),V=(P=Y/3)+1,M=(D=(B-2)/3)-1,j[K++]=D,j[K++]=P,j[K++]=M,j[K++]=M,j[K++]=P,j[K++]=V,Y+=3,B-=3}var X,Z,$=0,tt=0,et=f[$++],ot=f[$++];for(H.set(et,Y),H.set(ot,B-ot.length+1),q=r.o.fromArray(b,tt,q),l=ot.length-3,i=0;i<l;i+=3)X=o.geodeticSurfaceNormal(r.o.fromArray(et,i,L),L),Z=o.geodeticSurfaceNormal(r.o.fromArray(ot,l-i,C),C),G(U,W=r.o.normalize(r.o.add(X,Z,W),W),q,Y,B,e),V=(P=Y/3)+1,M=(D=(B-2)/3)-1,j[K++]=D,j[K++]=P,j[K++]=M,j[K++]=M,j[K++]=P,j[K++]=V,Y+=3,B-=3;for(X=o.geodeticSurfaceNormal(r.o.fromArray(et,l,L),L),Z=o.geodeticSurfaceNormal(r.o.fromArray(ot,l,C),C),W=r.o.normalize(r.o.add(X,Z,W),W),tt+=3,i=0;i<p.length;i++){var rt,at,nt,it=(a=p[i]).leftPositions,st=a.rightPositions,dt=S,lt=F,ut=O;if(W=r.o.fromArray(v,tt,W),d.e(it)){for(G(U,W,q,void 0,B,e),B-=3,at=V,nt=M,rt=0;rt<it.length/3;rt++)dt=r.o.fromArray(it,3*rt,dt),j[K++]=at,j[K++]=nt-rt-1,j[K++]=nt-rt,s.b.addAttribute(H,dt,void 0,B),lt=r.o.fromArray(H,3*(nt-rt-1),lt),ut=r.o.fromArray(H,3*at,ut),G(U,W,q=r.o.normalize(r.o.subtract(lt,ut,q),q),void 0,B,e),B-=3;dt=r.o.fromArray(H,3*at,dt),lt=r.o.subtract(r.o.fromArray(H,3*nt,lt),dt,lt),ut=r.o.subtract(r.o.fromArray(H,3*(nt-rt),ut),dt,ut),G(U,W,q=r.o.normalize(r.o.add(lt,ut,q),q),Y,void 0,e),Y+=3}else{for(G(U,W,q,Y,void 0,e),Y+=3,at=M,nt=V,rt=0;rt<st.length/3;rt++)dt=r.o.fromArray(st,3*rt,dt),j[K++]=at,j[K++]=nt+rt,j[K++]=nt+rt+1,s.b.addAttribute(H,dt,Y),lt=r.o.fromArray(H,3*at,lt),ut=r.o.fromArray(H,3*(nt+rt),ut),G(U,W,q=r.o.normalize(r.o.subtract(lt,ut,q),q),Y,void 0,e),Y+=3;dt=r.o.fromArray(H,3*at,dt),lt=r.o.subtract(r.o.fromArray(H,3*(nt+rt),lt),dt,lt),ut=r.o.subtract(r.o.fromArray(H,3*nt,ut),dt,ut),G(U,W,q=r.o.normalize(r.o.negate(r.o.add(ut,lt,q),q),q),void 0,B,e),B-=3}for(et=f[$++],ot=f[$++],et.splice(0,3),ot.splice(ot.length-3,3),H.set(et,Y),H.set(ot,B-ot.length+1),l=ot.length-3,tt+=3,q=r.o.fromArray(b,tt,q),rt=0;rt<ot.length;rt+=3)X=o.geodeticSurfaceNormal(r.o.fromArray(et,rt,L),L),Z=o.geodeticSurfaceNormal(r.o.fromArray(ot,l-rt,C),C),G(U,W=r.o.normalize(r.o.add(X,Z,W),W),q,Y,B,e),P=(V=Y/3)-1,D=(M=(B-2)/3)+1,j[K++]=D,j[K++]=P,j[K++]=M,j[K++]=M,j[K++]=P,j[K++]=V,Y+=3,B-=3;Y-=3,B+=3}if(G(U,W=r.o.fromArray(v,v.length-3,W),q,Y,B,e),N){Y+=3,B-=3,R=F,k=O;var ct=g[1];for(i=0;i<J;i++)R=r.o.fromArray(ct,3*(E-i-1),R),k=r.o.fromArray(ct,3*i,k),s.b.addAttribute(H,R,void 0,B),s.b.addAttribute(H,k,Y),G(U,W,q,Y,B,e),P=(V=Y/3)-1,D=(M=(B-2)/3)+1,j[K++]=D,j[K++]=P,j[K++]=M,j[K++]=M,j[K++]=P,j[K++]=V,Y+=3,B-=3}if(y.position=new u.o({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:H}),e.st){var ft,mt,ht=new Float32Array(z/3*2),pt=0;if(N){A/=3,_/=3;var gt=Math.PI/(E+1);mt=1/(A-E+1),ft=1/(_-E+1);var bt,vt=E/2;for(i=vt+1;i<E+1;i++)bt=h.e.PI_OVER_TWO+gt*i,ht[pt++]=ft*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(i=1;i<_-E+1;i++)ht[pt++]=i*ft,ht[pt++]=0;for(i=E;i>vt;i--)bt=h.e.PI_OVER_TWO-i*gt,ht[pt++]=1-ft*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(i=vt;i>0;i--)bt=h.e.PI_OVER_TWO-gt*i,ht[pt++]=1-mt*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(i=A-E;i>0;i--)ht[pt++]=i*mt,ht[pt++]=1;for(i=1;i<vt+1;i++)bt=h.e.PI_OVER_TWO+gt*i,ht[pt++]=mt*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt))}else{for(mt=1/((A/=3)-1),ft=1/((_/=3)-1),i=0;i<_;i++)ht[pt++]=i*ft,ht[pt++]=0;for(i=A;i>0;i--)ht[pt++]=(i-1)*mt,ht[pt++]=1}y.st=new u.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:ht})}return e.normal&&(y.normal=new u.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.normals})),e.tangent&&(y.tangent=new u.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.tangents})),e.bitangent&&(y.bitangent=new u.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.bitangents})),{attributes:y,indices:j}}function R(t,e,o){o[e++]=t[0],o[e++]=t[1],o[e++]=t[2];for(var r=3;r<t.length;r+=3){var a=t[r],n=t[r+1],i=t[r+2];o[e++]=a,o[e++]=n,o[e++]=i,o[e++]=a,o[e++]=n,o[e++]=i}return o[e++]=t[0],o[e++]=t[1],o[e++]=t[2],o}function z(e,o){var a=new b.n({position:o.position,normal:o.normal||o.bitangent||e.shadowVolume,tangent:o.tangent,bitangent:o.normal||o.bitangent,st:o.st}),i=e.ellipsoid,l=k(s.b.computePositions(e),a,i),c=e.height,h=e.extrudedHeight,g=l.attributes,v=l.indices,y=g.position.values,A=y.length,_=new Float64Array(6*A),w=new Float64Array(A);w.set(y);var T=new Float64Array(4*A);T=R(y=p.A.scaleToGeodeticHeight(y,c,i),0,T),T=R(w=p.A.scaleToGeodeticHeight(w,h,i),2*A,T),_.set(y),_.set(w,A),_.set(T,2*A),g.position.values=_,g=function(t,e){if(!(e.normal||e.tangent||e.bitangent||e.st))return t;var o,a,n=t.position.values;(e.normal||e.bitangent)&&(o=t.normal.values,a=t.bitangent.values);var i,d=t.position.values.length/18,l=3*d,u=2*d,c=2*l;if(e.normal||e.bitangent||e.tangent){var f=e.normal?new Float32Array(6*l):void 0,m=e.tangent?new Float32Array(6*l):void 0,h=e.bitangent?new Float32Array(6*l):void 0,p=I,g=x,b=F,v=O,y=M,A=S,_=c;for(i=0;i<l;i+=3){var w=_+c;p=r.o.fromArray(n,i,p),g=r.o.fromArray(n,i+l,g),b=r.o.fromArray(n,(i+3)%l,b),g=r.o.subtract(g,p,g),b=r.o.subtract(b,p,b),v=r.o.normalize(r.o.cross(g,b,v),v),e.normal&&(s.b.addAttribute(f,v,w),s.b.addAttribute(f,v,w+3),s.b.addAttribute(f,v,_),s.b.addAttribute(f,v,_+3)),(e.tangent||e.bitangent)&&(A=r.o.fromArray(o,i,A),e.bitangent&&(s.b.addAttribute(h,A,w),s.b.addAttribute(h,A,w+3),s.b.addAttribute(h,A,_),s.b.addAttribute(h,A,_+3)),e.tangent&&(y=r.o.normalize(r.o.cross(A,v,y),y),s.b.addAttribute(m,y,w),s.b.addAttribute(m,y,w+3),s.b.addAttribute(m,y,_),s.b.addAttribute(m,y,_+3))),_+=6}if(e.normal){for(f.set(o),i=0;i<l;i+=3)f[i+l]=-o[i],f[i+l+1]=-o[i+1],f[i+l+2]=-o[i+2];t.normal.values=f}else t.normal=void 0;if(e.bitangent?(h.set(a),h.set(a,l),t.bitangent.values=h):t.bitangent=void 0,e.tangent){var T=t.tangent.values;m.set(T),m.set(T,l),t.tangent.values=m}}if(e.st){var E=t.st.values,N=new Float32Array(6*u);N.set(E),N.set(E,u);for(var D=2*u,P=0;P<2;P++){for(N[D++]=E[0],N[D++]=E[1],i=2;i<u;i+=2){var L=E[i],C=E[i+1];N[D++]=L,N[D++]=C,N[D++]=L,N[D++]=C}N[D++]=E[0],N[D++]=E[1]}t.st.values=N}return t}(g,o);var E,N=A/3;if(e.shadowVolume){var D=g.normal.values;A=D.length;var P=new Float32Array(6*A);for(E=0;E<A;E++)D[E]=-D[E];P.set(D,A),P=R(D,4*A,P),g.extrudeDirection=new u.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P}),o.normal||(g.normal=void 0)}if(d.e(e.offsetAttribute)){var L=new Uint8Array(6*N);if(e.offsetAttribute===f.z.TOP)L=t.d(L,1,0,N),L=t.d(L,1,2*N,4*N);else{var C=e.offsetAttribute===f.z.NONE?0:1;L=t.d(L,C)}g.applyOffset=new u.o({componentDatatype:n.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:L})}var V=v.length,G=N+N,z=m.IndexDatatype.createTypedArray(_.length/3,2*V+3*G);z.set(v);var H,U,Y,B,W=V;for(E=0;E<V;E+=3){var q=v[E],J=v[E+1],j=v[E+2];z[W++]=j+N,z[W++]=J+N,z[W++]=q+N}for(E=0;E<G;E+=2)Y=(H=E+G)+1,B=(U=H+G)+1,z[W++]=H,z[W++]=U,z[W++]=Y,z[W++]=Y,z[W++]=U,z[W++]=B;return{attributes:g,indices:z}}var H=new r.o,U=new r.o,Y=new r.a;function B(t,e,o,a,n,i){var s=r.o.subtract(e,t,H);r.o.normalize(s,s);var d=o.geodeticSurfaceNormal(t,U),l=r.o.cross(s,d,H);r.o.multiplyByScalar(l,a,l);var u=n.latitude,c=n.longitude,f=i.latitude,m=i.longitude;r.o.add(t,l,U),o.cartesianToCartographic(U,Y);var h=Y.latitude,p=Y.longitude;u=Math.min(u,h),c=Math.min(c,p),f=Math.max(f,h),m=Math.max(m,p),r.o.subtract(t,l,U),o.cartesianToCartographic(U,Y),h=Y.latitude,p=Y.longitude,u=Math.min(u,h),c=Math.min(c,p),f=Math.max(f,h),m=Math.max(m,p),n.latitude=u,n.longitude=c,i.latitude=f,i.longitude=m}var W=new r.o,q=new r.o,J=new r.a,j=new r.a;function K(t,o,a,n,s){t=V(t,o);var u=e.D(t,r.o.equalsEpsilon),c=u.length;if(c<2||a<=0)return new l.h;var f,m,h=.5*a;if(J.latitude=Number.POSITIVE_INFINITY,J.longitude=Number.POSITIVE_INFINITY,j.latitude=Number.NEGATIVE_INFINITY,j.longitude=Number.NEGATIVE_INFINITY,n===i.S.ROUNDED){var p=u[0];r.o.subtract(p,u[1],W),r.o.normalize(W,W),r.o.multiplyByScalar(W,h,W),r.o.add(p,W,q),o.cartesianToCartographic(q,Y),f=Y.latitude,m=Y.longitude,J.latitude=Math.min(J.latitude,f),J.longitude=Math.min(J.longitude,m),j.latitude=Math.max(j.latitude,f),j.longitude=Math.max(j.longitude,m)}for(var g=0;g<c-1;++g)B(u[g],u[g+1],o,h,J,j);var b=u[c-1];r.o.subtract(b,u[c-2],W),r.o.normalize(W,W),r.o.multiplyByScalar(W,h,W),r.o.add(b,W,q),B(b,q,o,h,J,j),n===i.S.ROUNDED&&(o.cartesianToCartographic(q,Y),f=Y.latitude,m=Y.longitude,J.latitude=Math.min(J.latitude,f),J.longitude=Math.min(J.longitude,m),j.latitude=Math.max(j.latitude,f),j.longitude=Math.max(j.longitude,m));var v=d.e(s)?s:new l.h;return v.north=j.latitude,v.south=J.latitude,v.east=j.longitude,v.west=J.longitude,v}function Q(t){var e=(t=d.u(t,d.u.EMPTY_OBJECT)).positions,o=t.width;a.o.defined("options.positions",e),a.o.defined("options.width",o);var n=d.u(t.height,0),s=d.u(t.extrudedHeight,n);this._positions=e,this._ellipsoid=l.t.clone(d.u(t.ellipsoid,l.t.WGS84)),this._vertexFormat=b.n.clone(d.u(t.vertexFormat,b.n.DEFAULT)),this._width=o,this._height=Math.max(n,s),this._extrudedHeight=Math.min(n,s),this._cornerType=d.u(t.cornerType,i.S.ROUNDED),this._granularity=d.u(t.granularity,h.e.RADIANS_PER_DEGREE),this._shadowVolume=d.u(t.shadowVolume,!1),this._workerName="createCorridorGeometry",this._offsetAttribute=t.offsetAttribute,this._rectangle=void 0,this.packedLength=1+e.length*r.o.packedLength+l.t.packedLength+b.n.packedLength+7}Q.pack=function(t,e,o){a.o.defined("value",t),a.o.defined("array",e),o=d.u(o,0);var n=t._positions,i=n.length;e[o++]=i;for(var s=0;s<i;++s,o+=r.o.packedLength)r.o.pack(n[s],e,o);return l.t.pack(t._ellipsoid,e,o),o+=l.t.packedLength,b.n.pack(t._vertexFormat,e,o),o+=b.n.packedLength,e[o++]=t._width,e[o++]=t._height,e[o++]=t._extrudedHeight,e[o++]=t._cornerType,e[o++]=t._granularity,e[o++]=t._shadowVolume?1:0,e[o]=d.u(t._offsetAttribute,-1),e};var X=l.t.clone(l.t.UNIT_SPHERE),Z=new b.n,$={positions:void 0,ellipsoid:X,vertexFormat:Z,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};return Q.unpack=function(t,e,o){a.o.defined("array",t),e=d.u(e,0);for(var n=t[e++],i=new Array(n),s=0;s<n;++s,e+=r.o.packedLength)i[s]=r.o.unpack(t,e);var u=l.t.unpack(t,e,X);e+=l.t.packedLength;var c=b.n.unpack(t,e,Z);e+=b.n.packedLength;var f=t[e++],m=t[e++],h=t[e++],p=t[e++],g=t[e++],v=1===t[e++],y=t[e];return d.e(o)?(o._positions=i,o._ellipsoid=l.t.clone(u,o._ellipsoid),o._vertexFormat=b.n.clone(c,o._vertexFormat),o._width=f,o._height=m,o._extrudedHeight=h,o._cornerType=p,o._granularity=g,o._shadowVolume=v,o._offsetAttribute=-1===y?void 0:y,o):($.positions=i,$.width=f,$.height=m,$.extrudedHeight=h,$.cornerType=p,$.granularity=g,$.shadowVolume=v,$.offsetAttribute=-1===y?void 0:y,new Q($))},Q.computeRectangle=function(t,e){var o=(t=d.u(t,d.u.EMPTY_OBJECT)).positions,r=t.width;return a.o.defined("options.positions",o),a.o.defined("options.width",r),K(o,d.u(t.ellipsoid,l.t.WGS84),r,d.u(t.cornerType,i.S.ROUNDED),e)},Q.createGeometry=function(a){var i=a._positions,l=a._width,c=a._ellipsoid;i=V(i,c);var m=e.D(i,r.o.equalsEpsilon);if(!(m.length<2||l<=0)){var b,v=a._height,y=a._extrudedHeight,A=!h.e.equalsEpsilon(v,y,0,h.e.EPSILON2),_=a._vertexFormat,w={ellipsoid:c,positions:m,width:l,cornerType:a._cornerType,granularity:a._granularity,saveAttributes:!0};if(A)w.height=v,w.extrudedHeight=y,w.shadowVolume=a._shadowVolume,w.offsetAttribute=a._offsetAttribute,b=z(w,_);else if((b=k(s.b.computePositions(w),_,c)).attributes.position.values=p.A.scaleToGeodeticHeight(b.attributes.position.values,v,c),d.e(a._offsetAttribute)){var T=a._offsetAttribute===f.z.NONE?0:1,E=b.attributes.position.values.length,N=new Uint8Array(E/3);t.d(N,T),b.attributes.applyOffset=new u.o({componentDatatype:n.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:N})}var D=b.attributes,P=o.i.fromVertices(D.position.values,void 0,3);return _.position||(b.attributes.position.values=void 0),new u.I({attributes:D,indices:b.indices,primitiveType:g._0x2355b9.TRIANGLES,boundingSphere:P,offsetAttribute:a._offsetAttribute})}},Q.createShadowVolume=function(t,e,o){var r=t._granularity,a=t._ellipsoid,n=e(r,a),i=o(r,a);return new Q({positions:t._positions,width:t._width,cornerType:t._cornerType,ellipsoid:a,granularity:r,extrudedHeight:n,height:i,vertexFormat:b.n.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(Q.prototype,{rectangle:{get:function(){return d.e(this._rectangle)||(this._rectangle=K(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}}),function(t,e){return d.e(e)&&(t=Q.unpack(t,e)),t._ellipsoid=l.t.clone(t._ellipsoid),Q.createGeometry(t)}}));
